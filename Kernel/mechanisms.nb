(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1354454,      34814]
NotebookOptionsPosition[   1277084,      33635]
NotebookOutlinePosition[   1277476,      33651]
CellTagsIndexPosition[   1277433,      33648]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Mechanisms package", "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],

Cell["\<\
version 0.9
Christian Santangelo, Physics Department, Syracuse University
Copyright 2021\
\>", "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],

Cell[CellGroupData[{

Cell["Package organization", "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],

Cell[TextData[{
 StyleBox["mechanisms: ",
  FontWeight->"Bold"],
 "The mechanisms main package contains functions for manipulating and using \
mechanisms."
}], "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],

Cell[TextData[{
 StyleBox["geometry ",
  FontWeight->"Bold"],
 ": Mechanism geometry subpackage."
}], "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],

Cell[TextData[{
 StyleBox["rigidity",
  FontWeight->"Bold"],
 ": This subpackage contains functions for basic rigidity of mechanisms and \
some functions for linkages"
}], "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],

Cell[TextData[{
 StyleBox["origami",
  FontWeight->"Bold"],
 ": this sub package contains functions for handling origami specifically."
}], "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],

Cell[TextData[{
 StyleBox["graphics",
  FontWeight->"Bold"],
 " : this sub package contains functions for handling graphics."
}], "Text",ExpressionUUID->"85ea895a-171e-480f-b701-c119aed055d6"],

Cell["\<\
These packages also use the Mathematica Developer package to take advantage \
of packed arrays when possible. A C compiler is recommended to improve the \
speed of some numeric algorithms but isn\[CloseCurlyQuote]t strictly \
necessary.\
\>", "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],

Cell[CellGroupData[{

Cell["To do list and known bug list", "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],

Cell[TextData[{
 "Is there a better way to do minimization with compiled functions ",
 StyleBox["and",
  FontSlant->"Italic"],
 " specified constraints? The algorithms are slow and that means fixed joints \
are poorly handled with compiled functions. Unrestrained minimization is \
still faster with compiled functions."
}], "Text",ExpressionUUID->"01e0f39a-cdd3-4398-9885-4e9122d860da"],

Cell["\<\
The function removeOverlappingVertices[] may sometimes fail if two vertices \
have exactly the same distance apart and those distances are within tolerance.\
\>", "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"],

Cell["\<\
Sometimes ToGraphicsComplex[] produces something that should be a polyhedron \
but cannot be Canonicalized? I applied a fix that just cleans those up and \
hopes for the best.\
\>", "Text",ExpressionUUID->"3c29e79e-c97c-45d3-a1ea-174eedb8cf96"],

Cell["\<\
Should consider adding a function to make a rigid face by adding rigid bars \
in 3D. This is called blockFaces[] and is still experimental.\
\>", "Text",ExpressionUUID->"33457689-1538-46a7-a7b4-32e05e4d1dbb"],

Cell["\<\
ElasticTriangle[] must check that it is a triangle or expand into several \
triangles.\
\>", "Text",ExpressionUUID->"50f80464-0989-4dbe-adb2-45b20020c8a6"],

Cell["Use this code to install yourself as a Paclet:", "Text",ExpressionUUID->"de519dea-c6ba-4b6e-b9b8-68b8224f3d40"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"location", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Dropbox\>\"", ",", "\"\<Mathematica Packages\>\"", ",", 
      "\"\<Mechanisms\>\"", ",", "\"\<v0p9\>\""}], "}"}], "]"}]}], ";", 
  RowBox[{"PacletInstall", "[", 
   RowBox[{"CreatePacletArchive", "[", "location", "]"}], "]"}]}]], "Input",
 CellLabel->
  "In[106]:=",ExpressionUUID->"bdc64312-753d-4eb5-8a7c-c436ed551c43"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   TagBox["PacletObject",
    "SummaryHead"], "[", 
   DynamicModuleBox[{Typeset`open$$ = False, Typeset`embedState$$ = "Ready"}, 
    
    TemplateBox[{
      PaneSelectorBox[{False -> GridBox[{{
            PaneBox[
             ButtonBox[
              DynamicBox[
               FEPrivate`FrontEndResource["FEBitmaps", "SummaryBoxOpener"]], 
              ButtonFunction :> (Typeset`open$$ = True), Appearance -> None, 
              BaseStyle -> {}, Evaluator -> Automatic, Method -> 
              "Preemptive"], Alignment -> {Center, Center}, ImageSize -> 
             Dynamic[{
               Automatic, 
                3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                 Magnification])}]], 
            GraphicsBox[{
              Thickness[0.0416667], {
               FaceForm[{
                 RGBColor[0.961, 0.961, 0.961], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.5454, 
                22.5972}, {7.5464, 20.5002}, {2.5454, 18.4022}, {2.5454, 
                12.5982}, {2.5454, 12.5972}, {2.5454, 6.7952}, {7.5454, 
                4.6962}, {7.546, 4.6972}, {12.5454, 2.5992}, {17.5454, 
                4.6972}, {17.5454, 4.6962}, {22.5454, 6.7952}, {22.5454, 
                12.5972}, {22.5454, 12.5982}, {22.5454, 18.4022}}}]}, {
               FaceForm[{
                 RGBColor[0.898, 0.898, 0.898], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 8.3359}, {17.125, 
                14.0569}, {16.875, 14.0569}, {16.875, 8.3359}, {17., 
                8.1169}, {21.952, 6.0399}, {22.049, 6.2709}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 8.3359}, {7.125, 14.0569}, {
                6.875, 14.0569}, {6.875, 8.3359}, {1.952, 6.2709}, {2.048, 
                6.0399}, {7., 8.1169}}}], 
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8745, 6.2383}, {6.9515, 4.1733}, {7.0475, 
                3.9423}, {11.9995, 6.0193}, {16.9515, 3.9423}, {17.0475, 
                4.1733}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 14.1392}, {17.125, 
                19.8602}, {16.875, 19.8602}, {16.875, 14.1392}, {17., 
                13.9202}, {21.952, 11.8432}, {22.049, 12.0742}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 14.1392}, {7.125, 19.8602}, {
                6.875, 19.8602}, {6.875, 14.1392}, {1.952, 12.0742}, {2.048, 
                11.8432}, {7., 13.9202}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8746, 21.3633}, {11.8746, 18.3563}, {
                11.9996, 18.3033}, {12.1246, 18.3563}, {12.1246, 21.3633}, {
                11.9996, 21.4153}}}]}, {
               FaceForm[{
                 RGBColor[0.749, 0.749, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
                 3}}}, {{{8.292, 19.8594}, {12., 21.4154}, {15.707, 
                 19.8594}, {12., 18.3034}}, {{17.5, 19.5274}, {17.5, 
                 20.1924}, {12., 22.5004}, {6.5, 20.1924}, {6.5, 19.5284}, {
                 12., 17.2194}, {12., 17.2194}, {15.7, 18.7724}, {17.5, 
                 19.5274}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.5, 8.5156}, {11.5, 6.4876}, {11.5, 
                5.4026}, {12.5, 5.8226}, {12.5, 8.5156}, {12., 8.3056}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{21.5, 6.4873}, {17.5, 4.8083}, {17.5, 
                 9.5283}, {21.5, 11.2073}}, {{21.5, 12.7113}, {21.5, 
                 12.2913}, {17., 10.4033}, {16.5, 10.6133}, {16.5, 10.1943}, {
                 15.707, 9.8613}, {16.5, 9.5283}, {16.5, 4.8083}, {16.5, 
                 4.8093}, {16.5, 4.3903}, {15.707, 4.0573}, {17., 3.5143}, {
                 22.5, 5.8223}, {22.5, 12.2913}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{6.5, 4.8086}, {2.5, 6.4876}, {2.5, 
                 11.2066}, {6.5, 9.5286}}, {{7.5, 9.1096}, {7.5, 9.1096}, {
                 7.5, 9.5286}, {8.292, 9.8616}, {7.5, 10.1936}, {7.5, 
                 10.6136}, {7., 10.4036}, {2.5, 12.2906}, {2.5, 12.7106}, {
                 1.5, 12.2916}, {1.5, 5.8226}, {7., 3.5146}, {8.293, 
                 4.0576}, {7.5, 4.3906}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{3.2925, 17.7622}, {7.0005, 
                 19.3182}, {10.7075, 17.7622}, {7.0005, 16.2062}}, {{6.5005, 
                 10.6122}, {2.5005, 12.2912}, {2.5005, 17.0102}, {6.5005, 
                 15.3322}}, {{7.5005, 10.1932}, {7.5005, 10.6122}, {7.5005, 
                 15.3322}, {12.0005, 17.2202}, {12.5005, 17.0102}, {12.5005, 
                 18.0952}, {7.0005, 20.4032}, {1.5005, 18.0952}, {1.5005, 
                 11.6262}, {7.0005, 9.3182}, {8.2935, 9.8612}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{21.5, 12.291}, {17.5, 10.612}, {
                 17.5, 15.332}, {21.5, 17.01}}, {{13.293, 17.762}, {17., 
                 19.318}, {20.708, 17.762}, {17., 16.207}}, {{17., 20.403}, {
                 11.5, 18.095}, {11.5, 17.01}, {12., 17.22}, {16.5, 15.332}, {
                 16.5, 10.612}, {16.5, 10.194}, {15.706, 9.861}, {17., 
                 9.318}, {22.5, 11.626}, {22.5, 18.095}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{16.4995, 4.3906}, {12.4995, 
                 2.7116}, {12.4995, 7.4316}, {16.4995, 9.1096}}, {{11.4995, 
                 2.7116}, {7.4995, 4.3906}, {7.4995, 9.1096}, {11.4995, 
                 7.4316}}, {{16.4995, 10.6136}, {16.4995, 10.1946}, {11.9995, 
                 8.3056}, {8.2915, 9.8616}, {7.4995, 10.1936}, {7.4995, 
                 10.6146}, {6.4995, 10.1946}, {6.4995, 3.7256}, {11.9995, 
                 1.4176}, {17.4995, 3.7256}, {17.4995, 10.1946}}}]}, {
               FaceForm[{
                 RGBColor[0.965, 0.765, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{12., 17.6616}, {16.945, 15.5856}, {16.945, 
                9.9376}, {12., 7.8636}, {7.055, 9.9376}, {7.055, 
                15.5856}}}]}, {
               FaceForm[{
                 RGBColor[0.91, 0.655, 0.635], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.125, 
                17.7627}, {11.875, 17.7627}, {11.875, 12.0407}, {6.952, 
                9.9757}, {7.048, 9.7447}, {12., 11.8227}, {16.952, 9.7447}, {
                17.048, 9.9757}, {12.125, 12.0407}}}]}, {
               FaceForm[{
                 RGBColor[0.867, 0.067, 0.], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}}}, {{{12.5, 8.5146}, {12.5, 13.2336}, {16.5, 14.9116}, {
                 16.5, 10.1926}}, {{7.5, 14.9116}, {11.5, 13.2336}, {11.5, 
                 8.5146}, {7.5, 10.1926}}, {{15.708, 15.6636}, {12., 
                 14.1086}, {8.292, 15.6636}, {12., 17.2206}}, {{12., 
                 18.3046}, {6.5, 15.9956}, {6.5, 9.5286}, {12., 7.2206}, {
                 17.5, 9.5286}, {17.5, 15.9956}}}]}}, AspectRatio -> 
             Automatic, ImageSize -> {24., 24.}, 
             PlotRange -> {{0., 24.}, {0., 24.}}], 
            GridBox[{{
               RowBox[{
                 TagBox["\"Name: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"Mechanisms\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Version: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"0.9\"", "SummaryItem"]}]}}, 
             GridBoxAlignment -> {
              "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
             False, GridBoxItemSize -> {
              "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
             GridBoxSpacings -> {"Columns" -> {{2}}, "Rows" -> {{Automatic}}},
              BaseStyle -> {
              ShowStringCharacters -> False, NumberMarks -> False, 
               PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
          GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
          AutoDelete -> False, 
          GridBoxItemSize -> {
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
          BaselinePosition -> {1, 1}], True -> GridBox[{{
            PaneBox[
             ButtonBox[
              DynamicBox[
               FEPrivate`FrontEndResource["FEBitmaps", "SummaryBoxCloser"]], 
              ButtonFunction :> (Typeset`open$$ = False), Appearance -> None, 
              BaseStyle -> {}, Evaluator -> Automatic, Method -> 
              "Preemptive"], Alignment -> {Center, Center}, ImageSize -> 
             Dynamic[{
               Automatic, 
                3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                 Magnification])}]], 
            GraphicsBox[{
              Thickness[0.0416667], {
               FaceForm[{
                 RGBColor[0.961, 0.961, 0.961], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.5454, 
                22.5972}, {7.5464, 20.5002}, {2.5454, 18.4022}, {2.5454, 
                12.5982}, {2.5454, 12.5972}, {2.5454, 6.7952}, {7.5454, 
                4.6962}, {7.546, 4.6972}, {12.5454, 2.5992}, {17.5454, 
                4.6972}, {17.5454, 4.6962}, {22.5454, 6.7952}, {22.5454, 
                12.5972}, {22.5454, 12.5982}, {22.5454, 18.4022}}}]}, {
               FaceForm[{
                 RGBColor[0.898, 0.898, 0.898], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 8.3359}, {17.125, 
                14.0569}, {16.875, 14.0569}, {16.875, 8.3359}, {17., 
                8.1169}, {21.952, 6.0399}, {22.049, 6.2709}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 8.3359}, {7.125, 14.0569}, {
                6.875, 14.0569}, {6.875, 8.3359}, {1.952, 6.2709}, {2.048, 
                6.0399}, {7., 8.1169}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8745, 6.2383}, {6.9515, 4.1733}, {7.0475, 
                3.9423}, {11.9995, 6.0193}, {16.9515, 3.9423}, {17.0475, 
                4.1733}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 14.1392}, {17.125, 
                19.8602}, {16.875, 19.8602}, {16.875, 14.1392}, {17., 
                13.9202}, {21.952, 11.8432}, {22.049, 12.0742}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 14.1392}, {7.125, 19.8602}, {
                6.875, 19.8602}, {6.875, 14.1392}, {1.952, 12.0742}, {2.048, 
                11.8432}, {7., 13.9202}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8746, 21.3633}, {11.8746, 18.3563}, {
                11.9996, 18.3033}, {12.1246, 18.3563}, {12.1246, 21.3633}, {
                11.9996, 21.4153}}}]}, {
               FaceForm[{
                 RGBColor[0.749, 0.749, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
                 3}}}, {{{8.292, 19.8594}, {12., 21.4154}, {15.707, 
                 19.8594}, {12., 18.3034}}, {{17.5, 19.5274}, {17.5, 
                 20.1924}, {12., 22.5004}, {6.5, 20.1924}, {6.5, 19.5284}, {
                 12., 17.2194}, {12., 17.2194}, {15.7, 18.7724}, {17.5, 
                 19.5274}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.5, 8.5156}, {11.5, 6.4876}, {11.5, 
                5.4026}, {12.5, 5.8226}, {12.5, 8.5156}, {12., 8.3056}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{21.5, 6.4873}, {17.5, 4.8083}, {17.5, 
                 9.5283}, {21.5, 11.2073}}, {{21.5, 12.7113}, {21.5, 
                 12.2913}, {17., 10.4033}, {16.5, 10.6133}, {16.5, 10.1943}, {
                 15.707, 9.8613}, {16.5, 9.5283}, {16.5, 4.8083}, {16.5, 
                 4.8093}, {16.5, 4.3903}, {15.707, 4.0573}, {17., 3.5143}, {
                 22.5, 5.8223}, {22.5, 12.2913}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{6.5, 4.8086}, {2.5, 6.4876}, {2.5, 
                 11.2066}, {6.5, 9.5286}}, {{7.5, 9.1096}, {7.5, 9.1096}, {
                 7.5, 9.5286}, {8.292, 9.8616}, {7.5, 10.1936}, {7.5, 
                 10.6136}, {7., 10.4036}, {2.5, 12.2906}, {2.5, 12.7106}, {
                 1.5, 12.2916}, {1.5, 5.8226}, {7., 3.5146}, {8.293, 
                 4.0576}, {7.5, 4.3906}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{3.2925, 17.7622}, {7.0005, 
                 19.3182}, {10.7075, 17.7622}, {7.0005, 16.2062}}, {{6.5005, 
                 10.6122}, {2.5005, 12.2912}, {2.5005, 17.0102}, {6.5005, 
                 15.3322}}, {{7.5005, 10.1932}, {7.5005, 10.6122}, {7.5005, 
                 15.3322}, {12.0005, 17.2202}, {12.5005, 17.0102}, {12.5005, 
                 18.0952}, {7.0005, 20.4032}, {1.5005, 18.0952}, {1.5005, 
                 11.6262}, {7.0005, 9.3182}, {8.2935, 9.8612}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{21.5, 12.291}, {17.5, 10.612}, {
                 17.5, 15.332}, {21.5, 17.01}}, {{13.293, 17.762}, {17., 
                 19.318}, {20.708, 17.762}, {17., 16.207}}, {{17., 20.403}, {
                 11.5, 18.095}, {11.5, 17.01}, {12., 17.22}, {16.5, 15.332}, {
                 16.5, 10.612}, {16.5, 10.194}, {15.706, 9.861}, {17., 
                 9.318}, {22.5, 11.626}, {22.5, 18.095}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{16.4995, 4.3906}, {12.4995, 
                 2.7116}, {12.4995, 7.4316}, {16.4995, 9.1096}}, {{11.4995, 
                 2.7116}, {7.4995, 4.3906}, {7.4995, 9.1096}, {11.4995, 
                 7.4316}}, {{16.4995, 10.6136}, {16.4995, 10.1946}, {11.9995, 
                 8.3056}, {8.2915, 9.8616}, {7.4995, 10.1936}, {7.4995, 
                 10.6146}, {6.4995, 10.1946}, {6.4995, 3.7256}, {11.9995, 
                 1.4176}, {17.4995, 3.7256}, {17.4995, 10.1946}}}]}, {
               FaceForm[{
                 RGBColor[0.965, 0.765, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{12., 17.6616}, {16.945, 15.5856}, {16.945, 
                9.9376}, {12., 7.8636}, {7.055, 9.9376}, {7.055, 
                15.5856}}}]}, {
               FaceForm[{
                 RGBColor[0.91, 0.655, 0.635], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.125, 
                17.7627}, {11.875, 17.7627}, {11.875, 12.0407}, {6.952, 
                9.9757}, {7.048, 9.7447}, {12., 11.8227}, {16.952, 9.7447}, {
                17.048, 9.9757}, {12.125, 12.0407}}}]}, {
               FaceForm[{
                 RGBColor[0.867, 0.067, 0.], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}}}, {{{12.5, 8.5146}, {12.5, 13.2336}, {16.5, 14.9116}, {
                 16.5, 10.1926}}, {{7.5, 14.9116}, {11.5, 13.2336}, {11.5, 
                 8.5146}, {7.5, 10.1926}}, {{15.708, 15.6636}, {12., 
                 14.1086}, {8.292, 15.6636}, {12., 17.2206}}, {{12., 
                 18.3046}, {6.5, 15.9956}, {6.5, 9.5286}, {12., 7.2206}, {
                 17.5, 9.5286}, {17.5, 15.9956}}}]}}, AspectRatio -> 
             Automatic, ImageSize -> {24., 24.}, 
             PlotRange -> {{0., 24.}, {0., 24.}}], 
            GridBox[{{
               RowBox[{
                 TagBox["\"Name: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"Mechanisms\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Version: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"0.9\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Location: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox[
                 "\"/Users/cdsantan/Library/Mathematica/Paclets/Repository/\
Mechanisms-0.9\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Description: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox[
                  TagBox["\"Mechanisms package\"", Short], "SummaryItem"]}]}},
              GridBoxAlignment -> {
              "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
             False, GridBoxItemSize -> {
              "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
             GridBoxSpacings -> {"Columns" -> {{2}}, "Rows" -> {{Automatic}}},
              BaseStyle -> {
              ShowStringCharacters -> False, NumberMarks -> False, 
               PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
          GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
          AutoDelete -> False, 
          GridBoxItemSize -> {
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
          BaselinePosition -> {1, 1}]}, 
       Dynamic[Typeset`open$$], ImageSize -> Automatic]},
     "SummaryPanel"],
    DynamicModuleValues:>{}], "]"}],
  PacletObject[
   Association[
   "Name" -> "Mechanisms", "Version" -> "0.9", "Creator" -> 
    "cdsantan@syr.edu", "Description" -> "Mechanisms package", 
    "WolframVersion" -> "11+", 
    "Extensions" -> {{
      "Kernel", "Root" -> "Kernel", "Context" -> {"mechanisms`"}}, {
      "Resource", "Root" -> "Resources", 
       "Resources" -> {{"CrinkledPaper", "Textures/crinkled-paper.jpg"}}}, {
      "Documentation", "Language" -> "English", "MainPage" -> 
       "Guides/Mechanisms"}}, "Location" -> 
    "/Users/cdsantan/Library/Mathematica/Paclets/Repository/Mechanisms-0.9"]],
  
  Editable->False,
  SelectWithContents->True,
  Selectable->False]], "Output",
 CellLabel->
  "Out[106]=",ExpressionUUID->"9fea80e9-1356-43be-ba3e-b39fa3d6a1d9"]
}, Open  ]],

Cell["Use this to uninstall the paclet.", "Text",ExpressionUUID->"8c0f275a-0a6f-49f8-8b27-df573f355ff7"],

Cell[BoxData[
 RowBox[{"PacletUninstall", "[", "\"\<Mechanisms\>\"", "]"}]], "Input",
 CellLabel->
  "In[105]:=",ExpressionUUID->"bae0a72b-16f7-4640-9196-dd8e0df27892"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms: internal code for handling structures", "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<Mechanisms`\>\"", ",", 
    RowBox[{"{", "\"\<Developer`\>\"", "}"}]}], "]"}], ";"}]], "Code",
 CellLabel->
  "In[3201]:=",ExpressionUUID->"19f747a5-46c1-4c74-9468-5aa2b9f8da15"],

Cell[CellGroupData[{

Cell["Version definitions", "Section",ExpressionUUID->"e8755456-61af-4d01-a4b3-3c63afdd42db"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$MechanismsVersion", "::", "usage"}], " ", "=", " ", 
   "\"\<$MechanismsVersion returns the version number of the package.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$MechanismsVersionText", "::", "usage"}], " ", "=", " ", 
    "\"\<$MechanismsVersionText returns the version number of the package as \
a string.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"$MechanismsVersion", "=", "0.9"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$MechanismsVersionText", "=", "\"\<Mechanisms version 0.9\>\""}], 
   ";"}], "\n", "\n", 
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "We", " ", "use", " ", "MeshRegion", " ", "in", " ", "this", " ", 
    "package", " ", "to", " ", "work", " ", "so", " ", "make", " ", "sure", 
    " ", "we", " ", "are", " ", "using", " ", "at", " ", "least", " ", 
    "version", " ", "10", " ", "of", " ", "Mathematica"}], "\n", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mechanism", "::", "usage"}], " ", "=", " ", 
    "\"\<Keyword used to report some errors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "version"}], "=", 
   "\"\<Mathematica version may be too low.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"$VersionNumber", "<", "10"}], ",", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"Mechanism", "::", "version"}], "]"}]}], " ", "]"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3202]:=",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Usage", "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"mechanism", " ", "cells"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"RigidBar", "::", "usage"}], "=", 
     "\"\<RigidBar[ {v1, v2} ] is a rigid bar. Use DefaultCellData[ RigidBar \
] to see its associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Spring", "::", "usage"}], "=", 
     "\"\<Spring[ {v1, v2} ] is a Spring allowing you to set an arbitrary \
force. Use DefaultCellData[ Spring ] to see its associated data.\>\""}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Face", "::", "usage"}], "=", 
     "\"\<Face[ {v1,v2,...} ] is a Face. Use DefaultCellData[ Face ] to see \
its associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ElasticTriangle", "::", "usage"}], "=", 
     "\"\<ElasticTriangle[ {v1,v2,...} ] is an elastic Face. Use \
DefaultCellData[ Face ] to see its associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"TorsionalFold", "::", "usage"}], "=", 
     "\"\<TorsionalFold[ {v1,v2} ] is a TorsionalFold with torsional Spring \
controlling its angle. Use DefaultCellData[ TorsionalFold ] to see its \
associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJoint", "::", "usage"}], "=", 
     "\"\<FreeJoint[v1] is a FreeJoint.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AngleJoint", "::", "usage"}], "=", 
     "\"\<AngleJoint[v1] is a torsional FreeJoint. Use DefaultCellData[ \
AngleJoint ] to see its associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PinnedJoint", "::", "usage"}], "=", 
     "\"\<PinnedJoint[v1] is a pinned FreeJoint. Use DefaultCellData[ \
PinnedJoint ] to see its associated data.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AnyJoint", "::", "usage"}], "=", 
     "\"\<AnyJoint is a head that represents either a PinnedJoint or a \
FreeJoint.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3209]:=",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"VertexPosition", "::", "usage"}], "=", "\n", 
   "\"\<VertexPosition[v, c] represents the position of vertex v along a \
particular component c.\nv is either an integer or a list of integers.\nc is \
one of \\\"x\\\", \\\"y\\\", \\\"z\\\", a list of these components, or \
All[d], which represents all components in a vector of dimension d.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"VertexPosition", ",", 
    RowBox[{"{", 
     RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexDisplacement", "::", "usage"}], "=", "\n", 
   "\"\<VertexDisplacement[v, c] represents the displacement of vertex v \
along a particular component c.\nv is either an integer or a list of \
integers.\nc is one of \\\"x\\\", \\\"y\\\", \\\"z\\\", a list of these \
components, or All[d], which represents all components in a vector of \
dimension d.\>\""}], ";"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"VertexDisplacement", ",", 
   RowBox[{"{", 
    RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}]}], "Code",
 CellLabel->
  "In[3218]:=",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DefaultCellData", "::", "usage"}], "=", 
   "\"\<DefaultCellData[ component ] returns the default data associated with \
a component.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[3222]:=",ExpressionUUID->"4350ea39-be9f-4263-bb1e-6f86b8d011ef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFaces", "::", "usage"}], "=", 
    "\"\<MechanismFaces[ m ] returns a list of Faces in the Mechanism.\n\
MechanismFaces[ m , {Face1, Face2, ...} ] returns an index with the location \
the specific Face would appear in a list of all Faces.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEdges", "::", "usage"}], "=", 
    "\"\<MechanismEdges[ m ] returns a list of edges in the Mechanism.\n\
MechanismEdges[ m , {edge1, edge2, ...} ] returns an index with the location \
the specific edge would appear in a list of all edges.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismVertices", "::", "usage"}], "=", 
    "\"\<MechanismVertices[ m ] returns a list of vertices in the \
Mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCells", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCells[m] lists all labels and cell types. Labels are all \
Strings.\nMechanismCells[ m, label ] lists cells with a certain label.\n\
MechanismCells[ m, celltype ] lists cells of a certain cell type.\n\
MechanismCells[ m, celltype1, celltype2, ... ] lists all cells of a certain \
cell type.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdgeQ", "::", "usage"}], "=", 
   "\"\<MechanismEdgeQ[m,{{v1,v2},...}] returns True if all edges are in the \
Mechanism m.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFaceQ", "::", "usage"}], "=", 
    "\"\<MechanismFaceQ[m,{{v1,...},...}] returns True if all Faces are in \
the Mechanism m.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismEdgeQ", "::", "usage"}], "=", 
   "\"\<ValidMechanismEdgeQ[m,{{v1,v2},...}] returns True if all edges could \
be an edge in Mechanism m.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ValidMechanismFaceQ", "::", "usage"}], "=", 
    "\"\<ValidMechanismFaceQ[m,{{v1,...},...}] returns True if all Faces \
could be a Face in Mechanism m.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismCellQ", "::", "usage"}], "=", 
   "\"\<ValidMechanismCellQ[ cellSpec ] returns True if cellSpec is a \
properly specified cell.\nValidMechanismCellQ[] returns a pattern that can be \
used to test if a cell has a valid specification.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismCellHeadQ", "::", "usage"}], "=", 
   "\"\<ValidMechanismCellHeadQ[ cell ] returns True if cell is a cell type. \
Use DefaultCellData[] to see a list of cell types.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3223]:=",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismPositions", "::", "usage"}], "=", "\n", 
    "\"\<MechanismPositions[ m ] returns the coordinates of the vertices of \
mechanism m.\nMechanismPositions[ m -> pos ] returns a new Mechanism with \
coordinates given by positions.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellList", "::", "usage"}], "=", " ", 
   "\"\<MechanismCellList[m] returns all the cells in Mechanism m.\n\
MechanismCellList[ m , cellSpec ] returns a list of cells matching a certain \
specification.\n  cellSpec can be either {cellType, {index1, index2, ...}} or \
a pattern.\nMechanismCellList[ m, cellSpec, dataType -> function ] returns a \
list of cells returning True when function f returns True when applied to \
dataType. f must be a pure function.\nMechanismCellList[ m, cellSpec, \
dataType -> pattern ] returns a list of cells whose dataType matches pattern.\
\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3233]:=",ExpressionUUID->"9273de87-effd-4686-9b2e-608fcb430619"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "::", "usage"}], " ", "=", " ", 
    "\"\<Linkage[ { {x1, y1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] returns a \
linkage in 2D with vertices at {{x1, y1}, ..} and made from the specified \
cells.\nLinkage[ { {x1, y1, z1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] \
returns a linkage in 3D with vertices at {{x1, y1}, ..} and made from the \
specified cells.\\n\nProperties:\\n\nCell properties can be specified by \
Property[ cell1[ {i1, ...} ], {property1 -> value1, ... } ].\nProperties are \
\\\"Style\\\", \\\"Shape\\\" (to specify a shape function), \\\"Label\\\". \
DefaultCellData[cell] will list additional properties that can be \
specified.\\n\nOptions:\\n\nLinkage[] takes the option OverlapPrecision which \
determines how close vertices need to be in order to be mapped onto each \
other. This could be set to 0 (or None).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "::", "usage"}], "=", "\n", 
    "\"\<Origami[ { {x1, y1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] returns \
an Origami in 3D (displayed in 2D) with vertices at {{x1, y1}, ..} and made \
from the specified cells.\nOrigami[ { {x1, y1, z1}, ...}, {cell1[ {i1, i2, \
..} ], ... } ] returns an Origami in 3D with vertices at {{x1, y1}, ..} and \
made from the specified cells.\n\nProperties:\n\nCell properties can be \
specified by Property[ cell1[ {i1, ...} ], {property1 -> value1, ... } ].\n\
Properties are \\\"Style\\\", \\\"Shape\\\" (to specify a shape function), \\\
\"Label\\\". DefaultCellData[cell] will list additional properties that can \
be specified.\n\nOptions:\n\nOrigami[] takes the option OverlapPrecision \
which determines how close vertices need to be in order to be mapped onto \
each other. This could be set to 0 (or None).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismQ", "::", "usage"}], "=", 
   "\"\<MechanismQ[ m ] returns True if m is a Mechanism.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3235]:=",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OverlapPrecision", "::", "usage"}], "=", 
   "\"\<OverlapPrecision is an option that indicates how close points have to \
be to be considered identical.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[3238]:=",ExpressionUUID->"22907678-8e63-445b-bf88-1cf1b4802c34"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"cell", " ", "modifiers"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"LabelCells", "::", "usage"}], "=", " ", 
     "\"\<LabelCells[ m , label , {index1, index2,...} ] labels cells with \
the string label.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SelectCells", "::", "usage"}], "=", "\n", 
     "\"\<SelectCells[ m, pattern ] selects a sub-Mechanism with cell \
specification matching pattern.\nSelectCells[m, pattern, data, f] selects a \
sub-Mechanism with cells matching pattern and f evaluating True when applied \
to the data. Use dataForm[] to find data that is available for a given \
component.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteCells", "::", "usage"}], "=", 
     "\"\<DeleteCells[ m, pattern ] deletes a sub-Mechanism with cell \
specification matching pattern.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AddCells", "::", "usage"}], "=", 
     "\"\<AddCells[ m, {cell1, cell2, ... } ] adds cells to a \
Mechanism.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "::", "usage"}], " ", "=", " ", 
     "\"\<ChangeCellData[ m , pattern, { data1 -> value1, ... } ] changes the \
data of cells matching pattern.\nChangeCellData[ m, type, {cell1, cell2, \
...}, data1 -> { value1, value2, ...} ] changes the data of one type \
corresponding to cells.\nChangeCellData[ m , type, {cell1, cell2, ...}, data \
-> value ] changes the data of a number of cells to one value.\ndata is \
either appropriate data for the cells or one of \\\"Style\\\", \\\"Shape\\\", \
or \\\"Label\\\".\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "::", "usage"}], "=", 
     "\"\<SubdivideCells[ m, cell list, label ] adds a vertex to a cell at \
the centroid.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DivideFaces", "::", "usage"}], "=", 
     "\"\<DivideFaces[ m, edge list ] divides Faces along the listed edges, \
read from left to right.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"TriangulateFaces", "::", "usage"}], "=", 
     "\"\<TriangulateFaces[m] triangulates all Faces along the shortest \
diagonal recursively.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaceVertices", "::", "usage"}], "=", 
     "\"\<PlaceVertices[m, {v1 -> new position 1, ...} ] moves vertices to \
new positions.\nPlaceVertices[m, { pos1, pos2, ... } ] replaces all vertex \
positions by a list of new positions.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DisplaceVertices", "::", "usage"}], "=", 
     "\"\<DisplaceVertices[m, {v1 -> displacement 1, ...} ] displaces \
vertices by a displacement.\nDisplaceVertices[m, { disp1, disp2, ... } ] \
displaces all vertices by a list of displacements.\>\""}], ";"}], "\n", "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"DeleteVertices", "::", "usage"}], "=", 
     "\"\<DeleteVertices[ m, {v1, ...} ] deletes a list of vertices and all \
cells associated with those vertices.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MapCells", "::", "usage"}], "=", 
     "\"\<MapCells[m, f] applies a map f to a Mechanism.\>\""}], ";"}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"JoinMechanism", "::", "usage"}], "=", 
     "\"\<JoinMechanism[ m1, m2, ... ] joins a list of Mechanisms of the same \
type together.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3239]:=",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "usage"}], "=", "\n", 
   "\"\<TesselateMechanism[m, primitive vector, n1 ], TesselateMechanism[m, \
{vector 1, vector 2}, {n1, n2}],  TesselateMechanism[m, {vector 1, vector 2, \
vector 3}, {n1, n2, n3}] tesselates a mechanism using a set of 2D or 3D \
primitive vectors as an n1, n1 x n2 or n1 x n2 x n3 celled mechanism.\>\""}], 
  ";"}]], "Code",
 CellLabel->
  "In[3252]:=",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Code",
 CellLabel->
  "In[3253]:=",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$meshRegionProperties", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MeshCellStyle", " ", "\[Rule]", " ", "\"\<Style\>\""}], ",", 
      " ", 
      RowBox[{"MeshCellLabel", " ", "\[Rule]", " ", "\"\<Label\>\""}], " ", 
      ",", " ", 
      RowBox[{
      "MeshCellShapeFunction", " ", "\[Rule]", " ", "\"\<Shape\>\""}]}], 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"packedCellPattern", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "[", 
      RowBox[{"_", ",", "_"}], "]"}], "..."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"labelPattern", " ", "=", " ", 
    RowBox[{"{", "___Rule", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern2D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern3D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern", " ", "=", " ", 
   RowBox[{"coordinatePattern2D", " ", "|", " ", "coordinatePattern3D"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3254]:=",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"],

Cell[CellGroupData[{

Cell["MechanismQ[]", "Subsection",ExpressionUUID->"eff07146-d872-4431-837d-c7f0a6ec7629"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPattern", " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"Linkage", "|", "Origami"}], ")"}], "[", " ", 
     RowBox[{
     "coordinatePattern", ",", " ", "_", " ", ",", " ", "packedCellPattern", 
      ",", " ", "labelPattern"}], " ", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismQ", "[", " ", "mechanismPattern", " ", "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"MechanismQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "In[3260]:=",ExpressionUUID->"a5aa8b49-bcf0-48ef-881c-d1ffc63e1b4c"]
}, Closed]],

Cell[CellGroupData[{

Cell["ValidMechanismCellHeadQ[], ValidMechanismCellQ[]", "Subsection",ExpressionUUID->"d1bfb2ec-05b0-4a63-91f8-fcaf3033211d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"celltypePattern", " ", "=", " ", 
   RowBox[{
   "RigidBar", "|", "Spring", "|", "Face", "|", "ElasticTriangle", "|", 
    "TorsionalFold", "|", "FreeJoint", "|", "PinnedJoint", "|", 
    "AngleJoint"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"inputCellPattern", " ", "=", " ", 
   RowBox[{"Alternatives", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"RigidBar", "|", "Spring", "|", "TorsionalFold"}], ")"}], "[", 
      " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Except", "[", "_List", "]"}], ",", 
        RowBox[{"Except", "[", "_List", "]"}]}], "}"}], " ", "]"}], ",", "\n",
      "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"ElasticTriangle", "|", "AngleJoint"}], ")"}], "[", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Except", "[", "_List", "]"}], ",", 
        RowBox[{"Except", "[", "_List", "]"}], ",", 
        RowBox[{"Except", "[", "_List", "]"}]}], "}"}], " ", "]"}], ",", "\n",
      "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"FreeJoint", "|", "PinnedJoint"}], ")"}], "[", " ", 
      RowBox[{"Except", "[", "_List", "]"}], " ", "]"}], ",", "\n", "\t", 
     RowBox[{"Face", "[", " ", 
      RowBox[{"_", "?", "VectorQ"}], " ", "]"}]}], "\n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"exactInputCellPattern", " ", "=", " ", 
    RowBox[{"Alternatives", "[", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"RigidBar", "|", "Spring", "|", "TorsionalFold"}], ")"}], "[",
        " ", 
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}], " ", "]"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"ElasticTriangle", "|", "AngleJoint"}], ")"}], "[", " ", 
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer", ",", "_Integer"}], "}"}], " ", 
       "]"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"FreeJoint", "|", "PinnedJoint"}], ")"}], "[", " ", 
       "_Integer", " ", "]"}], ",", "\n", "\t", 
      RowBox[{"Face", "[", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"VectorQ", "[", 
           RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], " ", 
       "]"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismCellHeadQ", "[", " ", "cell_", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"MatchQ", "[", " ", 
    RowBox[{"cell", ",", " ", "celltypePattern"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismCellQ", "[", " ", "cell_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"MatchQ", "[", " ", 
   RowBox[{"cell", ",", " ", "exactInputCellPattern"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismCellQ", "[", "]"}], " ", ":=", " ", 
  RowBox[{"MatchQ", "[", " ", "exactInputCellPattern", " ", "]"}]}]}], "Code",\

 CellLabel->
  "In[3263]:=",ExpressionUUID->"b000fe75-98e0-4db2-803d-1d40f1814007"]
}, Closed]],

Cell[CellGroupData[{

Cell["DefaultCellData[]", "Subsection",ExpressionUUID->"5cf74a85-b4c1-4085-b474-db69e3569d24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "default", " ", "data", " ", "in", " ", "all", " ", "cell", " ", "types"}],
    " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "RigidBar", ",", " ", "Spring", ",", " ", "Face", ",", " ", 
       "ElasticTriangle", " ", ",", " ", "TorsionalFold", ",", " ", 
       "FreeJoint", ",", " ", "PinnedJoint", ",", "AngleJoint"}], "}"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "RigidBar", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
       "\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
       " ", 
       RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}]}], 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "Spring", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
       "\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
       " ", 
       RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",", 
       " ", 
       RowBox[{
       "\"\<Strain\>\"", " ", "\[Rule]", " ", "\"\<LinearStrain\>\""}]}], 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "Face", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "ElasticTriangle", "]"}], " ", "=", " ", 
     
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"\"\<YoungsModulus\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       " ", ",", " ", 
       RowBox[{"\"\<PoissonRatio\>\"", " ", "\[Rule]", " ", 
        RowBox[{"1", "/", "3"}]}]}], " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "TorsionalFold", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{
       "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",", 
       " ", 
       RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "FreeJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "PinnedJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"\"\<PinningStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       ",", " ", 
       RowBox[{
       "\"\<ConstraintFunction\>\"", " ", "\[Rule]", " ", "Automatic"}]}], 
      " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "AngleJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<AngleStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       ",", " ", 
       RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], " ", 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellData", "[", "_", "]"}], " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3269]:=",ExpressionUUID->"f5ce23c9-dd88-49e3-8ce9-d15ea2f4a0f2"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["private functions to manipulate cells", "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],

Cell[CellGroupData[{

Cell["dataForm[]", "Subsection",ExpressionUUID->"af8d39d2-e6d6-4050-8965-bc05f40569d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "data", " ", "that", " ", "will", " ", "be", " ", "stored", " ", "for", 
    " ", "each", " ", "of", " ", "these", " ", "components", " ", "and", " ", 
    "in", " ", "what", " ", "order"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "RigidBar", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Stiffness\>\"", ",", "\"\<EquilibriumLength\>\"", ",", 
       "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], "}"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "Spring", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Stiffness\>\"", ",", "\"\<EquilibriumLength\>\"", ",", 
       "\"\<Strain\>\"", ",", "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", 
       "\"\<Style\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "Face", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<FaceStiffness\>\"", ",", "\"\<Shape\>\"", ",", "\"\<Label\>\"", 
       ",", "\"\<Style\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "ElasticTriangle", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<YoungsModulus\>\"", ",", "\"\<PoissonRatio\>\"", ",", 
       "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], "}"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "TorsionalFold", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<TorsionalStiffness\>\"", ",", "\"\<Angle\>\"", ",", 
       "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], "}"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "FreeJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{"\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], 
      " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "PinnedJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{
      "\"\<PinningStiffness\>\"", ",", " ", "\"\<ConstraintFunction\>\"", 
       ",", "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], 
      " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "AngleJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "\"\<AngleStiffness\>\"", ",", " ", "\"\<Angle\>\"", ",", 
       "\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], " ", 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"dataForm", "[", "_", "]"}], " ", ":=", " ", 
     RowBox[{"{", "}"}]}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3279]:=",ExpressionUUID->"e1c8906d-3061-4fe8-9994-991ef705e42c"]
}, Closed]],

Cell[CellGroupData[{

Cell["packCells[]", "Subsection",ExpressionUUID->"3140d306-2fe3-4d80-8519-e5c1a3a2179c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"packCells", "[", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "[", 
        RowBox[{"_", ",", "_"}], "]"}], "..."}], "}"}]}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"groupedCells", " ", "=", " ", 
       RowBox[{"GatherBy", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"pullTags", " ", "/@", " ", "cells"}], "]"}], ",", " ", 
         "Head"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"packCellType", "[", "  ", 
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], " ", "]"}], "&"}], " ", 
      "/@", " ", "groupedCells"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"packCellType", "[", " ", 
   RowBox[{"s_String", ",", " ", "indices_", ",", " ", "data_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"s", "[", 
   RowBox[{
    RowBox[{"ToPackedArray", "[", "indices", "]"}], ",", 
    RowBox[{"{", "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"packCellType", "[", " ", 
   RowBox[{"head_Symbol", ",", " ", "indices_", ",", " ", "data_"}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"head", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"ToPackedArray", "[", "indices", "]"}], " ", ",", " ", "\n", 
    "\t\t", 
    RowBox[{"compressCellData", "[", " ", 
     RowBox[{"head", ",", " ", "data"}], " ", "]"}]}], "\n", "\t", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3288]:=",ExpressionUUID->"d441c2cb-db4c-4b3c-be58-c401dbbf458e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"pullTags", "[", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "properties_"}], " ", "]"}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", 
      RowBox[{
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", " ", "\[Rule]", " ", "_"}], " ", "&"}], ")"}], " ", "/@",
          " ", 
         RowBox[{"dataForm", "[", "head", "]"}]}]}], ",", " ", "\n", 
       RowBox[{"untagged", " ", "=", " ", 
        RowBox[{"DeleteCases", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", " ", "@", " ", 
           RowBox[{"{", "properties", "}"}]}], ",", " ", "_String"}], " ", 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"indices", ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "properties", "}"}]}], ",", " ", "_String"}], " ", 
         "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"head", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"untagged", ",", " ", "rules"}], " ", "]"}]}], " ", "]"}]}],
       "\n", "\t", "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "badprop"}], " ", "=", " ", 
   "\"\<Properties `1` do not exist for cell `2`.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3291]:=",ExpressionUUID->"c533ba08-40c1-4f85-a5d9-ebd3d51e166d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"combineDataList", "[", " ", 
   RowBox[{"default_", " ", ",", " ", "data_"}], "  ", "]"}], " ", ":=", " ", 
  
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Last", " ", "/@", " ", 
      RowBox[{"GatherBy", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"default", ",", " ", "#"}], "}"}], " ", "]"}], ",", " ", 
        "directiveQ"}], " ", "]"}]}], ")"}], "&"}], " ", "/@", " ", 
   "data"}]}], "\n", 
 RowBox[{
  RowBox[{"directiveQ", "[", " ", 
   RowBox[{"_", "?", "ColorQ"}], " ", "]"}], " ", ":=", " ", 
  "\"\<color\>\""}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"directiveQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Head", "[", "x", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"combineData", "[", " ", 
   RowBox[{
   "dataType_", ",", " ", "DefaultCellData_", ",", " ", "data_", " ", ",", 
    " ", "f_"}], " ", "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"SparseArray", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"f", " ", "/@", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"dataType", " ", "/.", " ", "data"}], " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{"dataType", " ", "\[Rule]", " ", 
          RowBox[{"{", "DefaultCellData", "}"}]}], "}"}]}], " ", "/.", " ", 
       RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
      ")"}]}], ",", "\n", "\t\t", 
    RowBox[{"Length", "[", "data", "]"}], ",", "\n", "\t\t", 
    "DefaultCellData"}], "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[3293]:=",ExpressionUUID->"a16e7b04-ada9-4bb9-a6c0-e1b705fe5e06"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"RigidBar", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Flatten", "[", "#", "]"}], "&"}]}], "]"}], "&"}], " ", "/@",
          " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "RigidBar", "]"}]}]}]}], "\n", "}"}],
      ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Stiffness\>\"", ",", " ", "Infinity", ",", " ", "mergedData", 
         " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<EquilibriumLength\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"Spring", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "Spring", "]"}]}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Stiffness\>\"", ",", " ", "Infinity", ",", " ", "mergedData", 
         " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<EquilibriumLength\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{"\"\<Strain\>\"", ",", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#1", "-", "#2"}], ")"}], "/", "#2"}], ")"}], "&"}], ",",
          " ", "mergedData", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"FreeJoint", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "FreeJoint", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"PinnedJoint", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "PinnedJoint", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<PinningStiffness\>\"", ",", " ", "Infinity", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<ConstraintFunction\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ",
          "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"TorsionalFold", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "TorsionalFold", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<TorsionalStiffness\>\"", ",", " ", "Infinity", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Angle\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"AngleJoint", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "AngleJoint", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<AngleStiffness\>\"", ",", " ", "Infinity", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Angle\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"Face", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], 
          "&"}], " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"DefaultCellData", "[", "Face", "]"}]}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "0", " ", ",", " ", "mergedData", " ", ",",
          " ", "Last"}], " ", "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
         "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineData", "[", " ", 
        RowBox[{
        "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
         " ", "Last"}], "]"}], ",", "\n", "\t", 
       RowBox[{"combineDataList", "[", " ", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
            " ", "default"}], " ", "/.", " ", 
          RowBox[{"\"\<Style\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"compressCellData", "[", " ", 
   RowBox[{"ElasticTriangle", ",", " ", "data_"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", " ", "\n", 
   RowBox[{
    RowBox[{"{", " ", "\n", "\t", 
     RowBox[{
      RowBox[{"mergedData", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Merge", "[", 
          RowBox[{"#", ",", " ", 
           RowBox[{
            RowBox[{"Reverse", "[", 
             RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}]}], "]"}], "&"}],
         " ", "/@", " ", "data"}]}], ",", "\n", "\t", 
      RowBox[{"default", " ", "=", " ", 
       RowBox[{"Dispatch", " ", "@", " ", 
        RowBox[{"DefaultCellData", "[", "ElasticTriangle", "]"}]}]}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"combineData", "[", " ", 
       RowBox[{
       "\"\<YoungsModulus\>\"", ",", " ", "Infinity", ",", " ", "mergedData", 
        " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
      RowBox[{"combineData", "[", " ", 
       RowBox[{"\"\<PoissonRatio\>\"", ",", " ", 
        RowBox[{"1", "/", "3"}], ",", " ", "mergedData", " ", ",", " ", 
        "Last"}], "]"}], ",", "\n", "\n", "\t", 
      RowBox[{"combineData", "[", " ", 
       RowBox[{
       "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", "mergedData",
         " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t", 
      RowBox[{"combineData", "[", " ", 
       RowBox[{
       "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",", 
        " ", "Last"}], "]"}], ",", "\n", "\t", 
      RowBox[{"combineDataList", "[", " ", 
       RowBox[{
        RowBox[{"{", "}"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.", 
          " ", "default"}], " ", "/.", " ", 
         RowBox[{"\"\<Style\>\"", "\[Rule]", 
          RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3297]:=",ExpressionUUID->"86e4ac4f-371a-4d0e-8ec5-01840aa47eca"]
}, Open  ]],

Cell[CellGroupData[{

Cell["unpackCells[]", "Subsection",ExpressionUUID->"ee5265f2-5b85-4a46-a28b-a243bc9ff076"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"unpackCells", "[", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Flatten", "[", 
    RowBox[{"unpackCellType", " ", "/@", " ", "cells"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"unpackCellType", "[", " ", 
    RowBox[{"s_String", "[", " ", "indices_", " ", "]"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"s", " ", "/@", " ", "indices"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"unpackCellType", "[", " ", 
    RowBox[{"head_Symbol", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"MapThread", "[", "\n", "\t\t", 
    RowBox[{"head", ",", "\n", "\t\t\t", 
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{"indices", ",", "\n", "\t\t\t", 
       RowBox[{"Transpose", " ", "@", " ", 
        RowBox[{"uncompressCellData", "[", " ", 
         RowBox[{"head", ",", " ", "indices", ",", " ", "data"}], " ", 
         "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"uncompressCellData", "[", " ", 
   RowBox[{"head_", " ", ",", " ", "indices_", ",", " ", "data_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"dataNames", "=", 
       RowBox[{"dataForm", "[", "head", "]"}]}], " ", ",", " ", 
      RowBox[{"length", " ", "=", " ", 
       RowBox[{"Length", "[", "indices", "]"}]}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Thread", "[", " ", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"#1", ",", " ", "length"}], "]"}], " ", "->", " ", "#2"}], 
        " ", "]"}], " ", "&"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"dataNames", " ", ",", " ", "data"}], "}"}]}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3305]:=",ExpressionUUID->"4875f961-32d2-4913-98ea-6cdd16c6277c"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
replaceCellIndices[], replaceRepeatedCellIndices[], replaceCellData[]\
\>", "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"replaceCellIndices", "[", " ", 
   RowBox[{
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
    "rules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "#", "]"}], "[", " ", 
     RowBox[{
      RowBox[{"ReplaceAll", "[", " ", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], ",",
       " ", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
   "cells"}]}]], "Code",
 CellLabel->
  "In[3309]:=",ExpressionUUID->"f1139107-b69c-4fd4-8921-cbf950ea380f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"replaceRepeatedCellIndices", "[", " ", 
   RowBox[{
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
    "rules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "#", "]"}], "[", " ", 
     RowBox[{
      RowBox[{"ReplaceRepeated", "[", " ", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], ",",
       " ", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
   "cells"}]}]], "Code",
 CellLabel->
  "In[3310]:=",ExpressionUUID->"aedb8fbc-7b63-4e91-8f14-89eba922e5be"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellData", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "#", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"replaceElement", "[", " ", 
          RowBox[{"#", ",", " ", "rules"}], " ", "]"}], " ", "&"}], " ", "/@",
         " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}], "&"}], " ", "/@", 
    " ", "cells"}]}], "\n", "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"from", ":", " ", "https", ":"}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "13790"}], "/", "using"}], "-", "replaceall", "-",
      "on", "-", "sparsearray"}]}], "\n", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceElement", "[", 
    RowBox[{"s_SparseArray", ",", " ", "rule_"}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", "    ", 
    RowBox[{
     RowBox[{"{", "\n", "    ", 
      RowBox[{
       RowBox[{"elem", " ", "=", " ", 
        RowBox[{"ReplaceAll", "[", 
         RowBox[{
          RowBox[{"s", "[", "\"\<NonzeroValues\>\"", "]"}], ",", " ", 
          "rule"}], "]"}]}], ",", "\n", "    ", 
       RowBox[{"def", " ", "=", " ", 
        RowBox[{"ReplaceAll", "[", 
         RowBox[{
          RowBox[{"s", "[", "\"\<Background\>\"", "]"}], ",", " ", "rule"}], 
         "]"}]}]}], "\n", "    ", "}"}], ",", "\n", "\n", "    ", 
     RowBox[{"Replace", "[", "\n", "        ", 
      RowBox[{"s", ",", "\n", "        ", 
       RowBox[{
        RowBox[{
         RowBox[{"Verbatim", "[", "SparseArray", "]"}], "[", 
         RowBox[{"a__", ",", " ", "_", ",", " ", 
          RowBox[{"{", 
           RowBox[{"b__", ",", " ", "_"}], "}"}]}], "]"}], " ", 
        "\[RuleDelayed]", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"a", ",", " ", "def", ",", " ", 
          RowBox[{"{", 
           RowBox[{"b", ",", " ", "elem"}], "}"}]}], "]"}]}]}], "\n", "    ", 
      "]"}]}], "\n", "]"}]}], "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{"if", " ", "the", " ", "data", " ", 
    RowBox[{"isn", "'"}], "t", " ", "a", " ", "SparseArray"}], "\n", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"replaceElement", "[", " ", 
   RowBox[{"s_", ",", " ", "rule_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"s", ",", " ", "rule"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3311]:=",ExpressionUUID->"b5a4e93b-03e7-40af-85c4-fe8ffd3be9b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["sortCellType[], orderCellType[]", "Subsection",ExpressionUUID->"530c0200-8cec-4ba0-ac9d-8bb8ee2048af"],

Cell["Functions for sorting cells internally.", "Text",ExpressionUUID->"30722304-63f8-45bb-856c-187e452eb61d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"sortCellType", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], ",", " ", 
    RowBox[{"sortingFunction_", " ", ":", " ", "Identity"}]}], " ", "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"order", " ", "=", " ", 
      RowBox[{"OrderingBy", "[", " ", 
       RowBox[{"indices", ",", " ", "sortingFunction"}], " ", "]"}]}], " ", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", " ", "order", " ", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", " ", "order", " ", "]"}], "]"}], "&"}], " ", "/@", " ", 
       "data"}]}], " ", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3314]:=",ExpressionUUID->"3dcbb299-d60d-4ccd-b0a6-8765b702245a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "ordering", " ", "is", " ", "a", " ", "list", " ", "of", " ", "integers"}],
    "*)"}], "\n", 
  RowBox[{
   RowBox[{"orderCellType", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", "data_"}], " ", "]"}], ",", " ", "ordering_"}],
     " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"head", "[", " ", 
    RowBox[{
     RowBox[{"indices", "[", 
      RowBox[{"[", " ", "ordering", " ", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", " ", "ordering", " ", "]"}], "]"}], "&"}], " ", "/@", 
      " ", "data"}]}], " ", "]"}]}]}]], "Code",
 CellLabel->
  "In[3315]:=",ExpressionUUID->"102c4a3c-1dcf-48e5-af1a-6ac1cb37098a"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDuplicateCells[]", "Subsection",ExpressionUUID->"66a4fa93-b1cb-408a-b53d-07229a966a10"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"this", " ", "function", " ", "unpacked", " ", "arrays"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"deleteDuplicateCells", "[", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"deleteDuplicateCells", " ", "/@", " ", "cells"}]}], "\n", 
   RowBox[{
    RowBox[{"deleteDuplicateCells", "[", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"indexList", " ", "=", " ", 
        RowBox[{
         RowBox[{"DeleteDuplicatesBy", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"Range", "[", " ", 
               RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], ",", " ", 
              "indices"}], " ", "}"}], " ", "]"}], ",", " ", "\n", "\t\t", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"Last", "[", "#", "]"}], "}"}], "]"}], "]"}], "&"}]}], 
          " ", "\n", "\t", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"head", "[", " ", 
       RowBox[{
        RowBox[{"ToPackedArray", " ", "@", " ", 
         RowBox[{"indices", "[", 
          RowBox[{"[", " ", "indexList", " ", "]"}], "]"}]}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", " ", "indexList", " ", "]"}], "]"}], "&"}], " ", "/@",
          " ", "data"}]}], " ", "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3316]:=",ExpressionUUID->"64d17235-533b-4916-b535-0ebabd865c68"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDegenerateCells[]", "Subsection",ExpressionUUID->"31a2a4ca-20a8-4cbc-b01c-74d8e07dc5cb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deleteDegenerateCells", "[", " ", 
   RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"deleteDegenerateCells", " ", "/@", " ", "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"deleteDegenerateCells", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"id", " ", "=", " ", 
      RowBox[{"Pick", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"DuplicateFreeQ", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "#", "}"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "indices"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "id", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "id", "]"}], "]"}], "&"}], "/@", "data"}]}], " ", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3318]:=",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],

Cell[CellGroupData[{

Cell["joinCells[]", "Subsection",ExpressionUUID->"9b7efb19-fa3f-458c-b10d-055c4761c19a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"joinCells", "[", " ", "cells_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"joinCellType", " ", "/@", " ", 
    RowBox[{"GatherBy", "[", " ", 
     RowBox[{
      RowBox[{"Flatten", "[", "cells", "]"}], ",", " ", "Head"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"joinCellType", "[", " ", 
   RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"Head", "[", 
        RowBox[{"cells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"indices", " ", "=", " ", 
       RowBox[{"cells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
    
    RowBox[{"sortCellType", " ", "@", " ", 
     RowBox[{"deleteDegenerateCells", " ", "@", " ", 
      RowBox[{"deleteDuplicateCells", " ", "@", " ", 
       RowBox[{"head", "[", " ", 
        RowBox[{
         RowBox[{"Join", " ", "@@", " ", "indices"}], " ", ",", " ", 
         RowBox[{"Join", " ", "@@@", " ", 
          RowBox[{"Transpose", "[", " ", "data", " ", "]"}]}]}], " ", 
        "]"}]}]}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3320]:=",ExpressionUUID->"b44baf22-b49e-49eb-8d47-48ae6f6bc8b6"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseCells[], unparseCells[]", "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"facePattern", " ", "=", " ", 
   RowBox[{"Face", "|", "ElasticTriangle"}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"edgePattern", " ", "=", " ", 
   RowBox[{"RigidBar", "|", "TorsionalFold", "|", "Spring"}]}], " ", 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"vertexPattern", " ", "=", " ", 
   RowBox[{"FreeJoint", "|", "PinnedJoint"}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"triplePattern", " ", "=", " ", "AngleJoint"}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellSpecPattern", " ", "=", " ", 
    RowBox[{
    "facePattern", "|", "edgePattern", "|", "vertexPattern", "|", 
     "triplePattern", "|", "_String"}]}], " ", ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"edgeLoopQ", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"VectorQ", "[", "#", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], " ", "&"}], ")"}]}], 
  " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"faceListQ", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", " ", "VectorQ"}], "]"}], "&"}], ")"}]}], " ", 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tripleListQ", " ", "=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&"}], ")"}]}], " ", ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"distributePropertyRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "cellSpecPattern"}], ")"}], "[", " ", 
        "indices_", " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "cellSpecPattern"}], ")"}], "[", " ", 
        RowBox[{"indices_", ",", " ", "properties_Rule"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"{", "properties", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{"h_List", ",", " ", "properties_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Property", "[", " ", 
           RowBox[{"#", ",", " ", "properties"}], " ", "]"}], "&"}], " ", "/@",
          " ", "h"}], ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"h", " ", ":", " ", "cellSpecPattern"}], ")"}], "[", " ", 
          RowBox[{"indices_", ",", " ", "properties_"}], " ", "]"}], " ", ",",
          " ", "newProperties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"{", " ", 
           RowBox[{"properties", ",", " ", "newProperties"}], " ", "}"}], " ",
           "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "vertexPattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "VectorQ"}], " ", ",", " ", "properties_"}],
         " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "edgePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "faceListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "edgePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "edgeLoopQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", 
         RowBox[{"Partition", "[", 
          RowBox[{"indices", ",", "2", ",", "1"}], "]"}]}], " ", ")"}]}], ",",
       "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "facePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "faceListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "triplePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "tripleListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", ":>", " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], " ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "vertexPattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"label_", " ", "\[Rule]", " ", "coordinates_"}], " ", ",", 
         " ", "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"h", "[", " ", 
          RowBox[{"label", ",", " ", "properties"}], " ", "]"}], ",", " ", 
         RowBox[{"add", "[", " ", 
          RowBox[{"label", " ", ",", " ", "coordinates"}], " ", "]"}]}], " ", 
        "}"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expansionRules", " ", "=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"Face", "[", " ", 
      RowBox[{"i_", " ", ",", " ", "properties_"}], " ", "]"}], " ", 
     "\[RuleDelayed]", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"Face", "[", " ", 
        RowBox[{"i", " ", ",", " ", "properties"}], " ", "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"RigidBar", "[", " ", 
          RowBox[{"#", ",", " ", "properties"}], " ", "]"}], " ", "&"}], " ", 
        "/@", " ", 
        RowBox[{"Partition", "[", " ", 
         RowBox[{"i", " ", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], " ",
          "]"}]}]}], " ", "}"}]}], "\n", "}"}]}], ";"}]}], "Code",
 CellLabel->
  "In[3322]:=",ExpressionUUID->"eb718079-61c4-4ca0-995a-7b96ba132a18"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"properCellPattern", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "vertexPattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"Except", "[", "_List", "]"}], ",", " ", "_"}], " ", "]"}], 
     " ", "|", " ", 
     RowBox[{
      RowBox[{"(", "edgePattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], "==", "2"}]}], "&"}], ")"}]}], 
       ",", " ", "_"}], " ", "]"}], " ", "|", " ", 
     RowBox[{
      RowBox[{"(", "facePattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], "&"}], ")"}]}], 
       " ", ",", " ", "_"}], "]"}], "|", 
     RowBox[{"(", 
      RowBox[{"triplePattern", "[", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "==", "3"}]}], "&"}], ")"}]}],
         ",", "_"}], "]"}], ")"}], "|", 
     RowBox[{"_String", "[", 
      RowBox[{"_", ",", "_"}], "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseCells", "[", " ", "cells_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"parseCells", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}]}], "}"}], ",", " ", "cells"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseCells", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "oldcoordinates_", ",", " ", "oldcells_", " ", ",", " ", "oldlabels_"}], 
     "}"}], ",", " ", "cells_List"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
     "expandedCells", " ", ",", " ", "goodCells", ",", " ", "badCells", ",", 
      " ", "newcoordinates", " ", ",", " ", "labels", ",", " ", "newlabels", 
      ",", " ", "coordinateCells"}], "}"}], ",", "\n", "\n", "\t", 
    RowBox[{
     RowBox[{"expandedCells", " ", "=", " ", 
      RowBox[{"Flatten", " ", "@", " ", 
       RowBox[{"ReplaceAll", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"ReplaceRepeated", "[", " ", 
           RowBox[{
            RowBox[{"Flatten", "[", "cells", "]"}], ",", " ", 
            "distributePropertyRules"}], "]"}]}], " ", ",", " ", 
         "expansionRules"}], " ", "]"}]}]}], " ", ";", "\n", "\t", 
     RowBox[{"coordinateCells", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"expandedCells", ",", " ", 
        RowBox[{"add", "[", 
         RowBox[{"_", ",", "_"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"goodCells", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"expandedCells", ",", " ", "properCellPattern"}], " ", "]"}]}],
      ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"if", " ", "there", " ", "are", " ", "bad", " ", "cells"}], 
       ",", " ", 
       RowBox[{"report", " ", "a", " ", "warning"}]}], "*)"}], "\n", "\t", 
     RowBox[{"badCells", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{"expandedCells", ",", " ", 
        RowBox[{"properCellPattern", "|", "_add"}]}], " ", "]"}]}], ";", "\n",
      "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "badCells", "]"}], ">", "0"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"Mechanism", "::", "badcells"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], "/@", 
          "badCells"}]}], " ", "]"}]}], " ", "]"}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "any", " ", "vertices", " ", "that", " ", "got", " ", "added", " ", 
       "as", " ", "cells", " ", "get", " ", "taken", " ", "care", " ", "of", 
       " ", "here"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"{", "  ", 
       RowBox[{"labels", " ", ",", " ", "newcoordinates"}], " ", "}"}], " ", 
      "=", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinateCells", "]"}], " ", ">", " ", 
         "0"}], ",", "\n", "\t\t", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"List", " ", "@@@", " ", "coordinateCells"}], "]"}], " ", 
        ",", "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"{", "}"}]}], " ", "}"}]}], "\n", "\t", "]"}]}], ";", "\n", 
     "\n", "\t", 
     RowBox[{"newlabels", " ", "=", " ", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{"oldlabels", ",", "\n", "\t\t", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"labels", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "oldcoordinates", "]"}], " ", "+", " ", 
             "1"}], " ", ",", " ", 
            RowBox[{
             RowBox[{"Length", "[", "oldcoordinates", "]"}], " ", "+", " ", 
             RowBox[{"Length", "[", "newcoordinates", "]"}]}]}], " ", "]"}]}],
          " ", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{"(*", " ", 
       RowBox[{"new", " ", "coordinates"}], " ", "*)"}], "\n", "\t\t", 
      RowBox[{
       RowBox[{"ToPackedArray", " ", "@", " ", 
        RowBox[{"PadRight", "[", 
         RowBox[{"Join", "[", " ", 
          RowBox[{"oldcoordinates", ",", " ", "newcoordinates"}], " ", "]"}], 
         "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"(*", " ", "cells", " ", "*)"}], "\n", "\t\t", 
       RowBox[{"sortCellType", " ", "/@", " ", 
        RowBox[{"joinCells", "[", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"replaceCellIndices", "[", " ", 
             RowBox[{
              RowBox[{"packCells", "[", " ", "goodCells", " ", "]"}], ",", 
              " ", 
              RowBox[{"Dispatch", " ", "@", " ", "newlabels"}]}], "]"}], ",", 
            " ", "oldcells"}], " ", "}"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
       "newlabels"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3332]:=",ExpressionUUID->"3e48711c-51f0-4af3-a14f-17eb5878f2bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "badcells"}], " ", "=", " ", 
   "\"\<Cells `1` cannot be parsed and will be ignored.\>\""}], ";"}]], "Code",\

 CellLabel->
  "In[3335]:=",ExpressionUUID->"18f7d81c-3e4a-4d14-8b8f-8a0d0cf9a5fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"unparseCells", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
     RowBox[{"head", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{"unparseCellType", " ", "/@", " ", 
     RowBox[{"Pick", "[", " ", 
      RowBox[{"cells", ",", " ", 
       RowBox[{"Head", "/@", "cells"}], ",", " ", "head"}], " ", "]"}]}], " ",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"unparseCellType", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", " ", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"head", " ", "/@", " ", "indices"}]}], "\n", 
 RowBox[{
  RowBox[{"unparseCellType", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ",
   ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"dataRules", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", "#"}], 
         " ", "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"Transpose", "[", "data", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"head", "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{"indices", ",", " ", "dataRules"}], " ", "}"}]}], " ", "]"}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3336]:=",ExpressionUUID->"e760c130-8b29-4ddc-8403-453272bb4643"]
}, Open  ]],

Cell[CellGroupData[{

Cell["cellPattern[]", "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cellPattern", "[", " ", "r_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"groupedByHead", " ", "=", " ", 
       RowBox[{"GatherBy", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"recursiveCellPattern", "[", " ", "r", " ", "]"}], " ", 
          "]"}], ",", " ", "Head"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", " ", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "===", "List"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "1"}]}], ",", 
           "Alternatives", ",", " ", "Identity"}], "]"}], " ", "@@", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}], "&"}], " ", 
      "/@", " ", "groupedByHead"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "r_Alternatives", " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"recursiveCellPattern", " ", "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "r"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"recursiveCellPattern", "[", " ", "x_Blank", " ", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", "x", "]"}], "==", "0"}]}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"_", "[", "_", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"recursiveCellPattern", "[", 
   RowBox[{
    RowBox[{"x", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "[", " ", "_", " ", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "x_String", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"{", 
   RowBox[{"x", "[", "_", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"AnyJoint", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"recursiveCellPattern", " ", "/@", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"FreeJoint", "[", " ", "ind", " ", "]"}], ",", " ", 
     RowBox[{"PinnedJoint", "[", " ", "ind", " ", "]"}]}], "}"}]}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"head_", "[", " ", "ind_Alternatives", " ", "]"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"recursiveCellPattern", "[", " ", 
     RowBox[{"head", "[", "#", "]"}], " ", "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "ind"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"head_Alternatives", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"recursiveCellPattern", "[", " ", 
     RowBox[{"#", "[", "ind", "]"}], "]"}], "&"}], "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "head"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"recursiveCellPattern", "[", " ", 
    RowBox[{"head_", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"head", "[", " ", 
     RowBox[{"indexPattern", "[", " ", "ind", " ", "]"}], " ", "]"}], "}"}]}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", " ", 
  "x"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "r_Alternatives", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"indexPattern", " ", "/@", " ", "r"}]}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "n_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"numbers", " ", "=", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "n", "]"}], "]"}]}], " ", "}"}], ",", " ", 
    RowBox[{"Alternatives", " ", "@@", " ", 
     RowBox[{"Map", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"n", ",", "#"}], "]"}], "&"}], ",", " ", "numbers"}], " ", 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", 
   RowBox[{"n", " ", ":", " ", 
    RowBox[{"Except", "[", 
     RowBox[{"_Alternatives", "|", "_List"}], "]"}]}], " ", "]"}], " ", ":=", 
  " ", "n"}]}], "Code",
 CellLabel->
  "In[3339]:=",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
casesCellType[], selectCellType[], identifyCellFromList[], \
casesCellFromDataType[], selectCellFromDataType[]\
\>", "Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"casesCellType", "[", " ", 
   RowBox[{"pattern_", " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"Pick", "[", " ", 
   RowBox[{
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
    RowBox[{"head", "/@", "indices"}], " ", ",", " ", 
    RowBox[{"Alternatives", " ", "@@", " ", "pattern"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selectCellType", "[", " ", 
    RowBox[{"f_", " ", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"Pick", "[", " ", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"head", "[", "#", "]"}], "]"}], "&"}], " ", "/@", " ", 
      "indices"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"identifyCellFromList", "[", " ", 
    RowBox[{"headSpec_", " ", ",", " ", 
     RowBox[{"indexList_", "?", "VectorQ"}], " ", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{
       RowBox[{"indices_", "?", "VectorQ"}], ",", " ", "data_"}], " ", 
      "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"table", " ", "=", " ", 
        RowBox[{"Association", " ", "@@", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{"Rule", "[", 
           RowBox[{"indices", " ", ",", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], 
          " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"DeleteMissing", "[", " ", 
       RowBox[{"table", " ", "/@", " ", "indexList"}], " ", "]"}]}], "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{"MatchQ", "[", 
     RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"identifyCellFromList", "[", " ", 
   RowBox[{"headSpec_", " ", ",", " ", 
    RowBox[{"indexList", " ", ":", " ", 
     RowBox[{"{", "___List", "}"}]}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{
      RowBox[{"indices", " ", ":", " ", 
       RowBox[{"{", "___List", "}"}]}], ",", " ", "data_"}], " ", "]"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"table", " ", "=", " ", 
       RowBox[{"Association", " ", "@@", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"Rule", "[", " ", 
          RowBox[{
           RowBox[{"Sort", " ", "/@", " ", "indices"}], " ", ",", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], " ",
          "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteMissing", "[", " ", 
      RowBox[{"table", " ", "/@", " ", 
       RowBox[{"(", 
        RowBox[{"Sort", " ", "/@", " ", "indexList"}], ")"}]}], " ", "]"}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{"MatchQ", "[", 
    RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"identifyCellFromList", "[", " ", 
    RowBox[{"_", " ", ",", " ", "indexList_", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"_", ",", " ", "_"}], " ", "]"}]}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"casesCellFromDataType", "[", " ", 
   RowBox[{
    RowBox[{"dataSpec_", " ", "\[Rule]", " ", "dataPattern_"}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"datalist", " ", "=", " ", 
      RowBox[{"dataForm", "[", "head", "]"}]}], " ", "}"}], ",", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"dataIndex", " ", "=", " ", 
        RowBox[{"dataSpec", " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"datalist", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "datalist", "]"}], "]"}]}], "]"}]}]}], " ",
        "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", " ", "\n", "\t\t", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          RowBox[{"Normal", "@", 
           RowBox[{"data", "[", 
            RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}]}], " ", ",", " ",
           "dataPattern"}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"selectCellFromDataType", "[", " ", 
   RowBox[{
    RowBox[{"dataSpec_", " ", "\[Rule]", " ", "selector_"}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"datalist", " ", "=", " ", 
      RowBox[{"dataForm", "[", "head", "]"}]}], " ", "}"}], ",", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"dataIndex", " ", "=", " ", 
        RowBox[{"datalist", " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"datalist", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "datalist", "]"}], "]"}]}], "]"}]}]}], " ",
        "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", " ", "\n", "\t\t", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          RowBox[{"selector", " ", "/@", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}]}]}], " ", "]"}], 
        ",", "\n", "\t\t", 
        RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3352]:=",ExpressionUUID->"58cae39b-f26e-4c92-93be-35567681d0c7"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeCells[], takeCells[]", "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"removeCells", "[", " ", 
   RowBox[{
    RowBox[{"deletedCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"remainingCells", " ", "=", " ", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", " ", 
         RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], " ", ",", " ", 
        "deletedCells"}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
       "0"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{"head", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}]}], "\n", 
       "\t\t", "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3359]:=",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"takeCells", "[", " ", 
   RowBox[{
    RowBox[{"remainingCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
     "0"}], ",", "\n", "\t\t", 
    RowBox[{"{", "}"}], ",", "\n", "\t\t", 
    RowBox[{"head", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}]}], "\n", 
     "\t\t", "]"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "In[3360]:=",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],

Cell[CellGroupData[{

Cell["changeCellDataInternal[]", "Subsection",ExpressionUUID->"27f84a4e-e698-437b-94f5-cbe3588f169d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"data1", ",", " ", "data2", ",", " ", "..."}], "}"}], ",", 
       " ", "cells"}], " ", "]"}], " ", "replaces", " ", "the", " ", "old", 
     " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{"...", " ", "with", " ", "data1"}], ",", " ", 
    RowBox[{"...", "\n", 
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", 
       RowBox[{"{", "data", "}"}], ",", " ", "cells"}], " ", "]"}], " ", 
     "replaces", " ", "the", " ", "old", " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{"...", " ", "all", " ", "with", " ", 
     RowBox[{"data", ".", "\n", 
      RowBox[{"ChangeCellData", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", "dataFunc", 
        ",", " ", "cells"}], " ", "]"}]}], " ", "replaces", " ", "the", " ", 
     "old", " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{
    "...", " ", "by", " ", "applying", " ", "dataFunc", " ", "to", " ", "the",
      " ", "old", " ", 
     RowBox[{"data", "."}]}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"changeCellDataInternal", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"spec", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"_", " ", ",", " ", "_"}], "}"}]}], ",", " ", 
      "specifiedData_List", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"ChangeCellDataType", "[", " ", 
       RowBox[{
       "changingCells", ",", " ", "spec", ",", " ", "specifiedData", ",", " ",
         "#"}], " ", "]"}], "&"}], " ", "/@", " ", "cells"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"ChangeCellDataType", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"headSpec_", ",", " ", "dataSpec_"}], "}"}], ",", " ", 
      "specifiedData_", " ", ",", " ", 
      RowBox[{"headSpec_", "[", " ", 
       RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}],
     " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"length", " ", "=", " ", 
         RowBox[{"Length", "[", "indices", "]"}]}], ",", "\n", 
        RowBox[{"newData", " ", "=", " ", 
         RowBox[{"If", "[", "\n", "\t", 
          RowBox[{
           RowBox[{
            RowBox[{"ListQ", "[", "specifiedData", "]"}], " ", "&&", " ", 
            RowBox[{
             RowBox[{"Length", "[", "specifiedData", "]"}], "\[Equal]", 
             "1"}]}], ",", "  ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"specifiedData", ",", 
             RowBox[{"Length", "[", "changingCells", "]"}]}], "]"}], ",", " ",
            "\n", "\t", "specifiedData"}], "\n", "\t", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"dataIndex", " ", "=", " ", 
         RowBox[{"dataSpec", " ", "/.", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"dataForm", "[", "headSpec", "]"}], " ", "\[Rule]", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"dataForm", "[", "headSpec", "]"}], "]"}], "]"}]}], 
           "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", "\n", "\t\t", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"changedCells", " ", "=", " ", 
            RowBox[{"Select", "[", " ", 
             RowBox[{"changingCells", ",", " ", 
              RowBox[{
               RowBox[{
               "0", " ", "<", " ", "#", " ", "\[LessEqual]", " ", "length"}], 
               "&"}]}], "]"}]}], " ", 
           RowBox[{"(*", 
            RowBox[{
            "these", " ", "are", " ", "the", " ", "cells", " ", "within", " ",
              "range"}], "*)"}], "}"}], ",", "\n", "\t\t\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "changedCells", "]"}], ">", "0"}], ",", 
            "\n", "\t\t\t\t", 
            RowBox[{"headSpec", "[", "\n", "\t\t\t\t\t", 
             RowBox[{"indices", ",", "\n", "\t\t\t\t\t", 
              RowBox[{"ReplacePart", "[", " ", 
               RowBox[{"data", ",", " ", 
                RowBox[{"dataIndex", " ", "\[Rule]", " ", 
                 RowBox[{"changeData", "[", " ", "\n", "\t\t\t\t\t\t\t", 
                  RowBox[{"changedCells", ",", " ", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}], ",", 
                   " ", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"if", " ", "its", " ", "a", " ", "list"}], ",", 
                    " ", 
                    RowBox[{"use", " ", "it"}], ",", " ", 
                    RowBox[{"if", " ", "not", " ", "map", " ", "it"}]}], 
                    "*)"}], " ", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"ListQ", "[", "newData", "]"}], ",", " ", 
                    "newData", ",", " ", 
                    RowBox[{"newData", " ", "/@", " ", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}]}]}], " ",
                     "]"}]}], " ", "\n", "\t\t\t\t\t\t\t", "]"}]}]}], " ", 
               "]"}]}], "\n", "\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"headSpec", "[", " ", 
             RowBox[{"indices", ",", " ", "data"}], " ", "]"}]}], "\n", 
           "\t\t\t", "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"headSpec", "[", 
         RowBox[{"indices", ",", "data"}], "]"}]}], "\n", "\t", "]"}]}], "\n",
      "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"ChangeCellDataType", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"headSpec_", ",", " ", "dataSpec_"}], "}"}], ",", " ", 
      "newData_", " ", ",", " ", 
      RowBox[{"spec", " ", ":", " ", 
       RowBox[{"_", "[", " ", 
        RowBox[{"_", " ", ",", " ", "data_"}], " ", "]"}]}]}], " ", "]"}], 
    " ", ":=", " ", "spec"}]}]}]], "Code",
 CellLabel->
  "In[3361]:=",ExpressionUUID->"31a72297-71f7-4b0b-a689-6535b1e08576"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"changeData", "[", " ", 
    RowBox[{
     RowBox[{"changedCells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", "data_SparseArray", ",", 
     " ", "newdata_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"processedData", " ", "=", " ", 
        RowBox[{"newdata", " ", "/.", " ", 
         RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
       ",", "\n", "\t", 
       RowBox[{"processedIndices", " ", "=", " ", 
        RowBox[{"List", " ", "/@", " ", "changedCells"}]}], ",", "\n", "\t", 
       "newRules"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newRules", " ", "=", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{"processedIndices", " ", "\[Rule]", " ", "processedData"}], 
        " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"SparseArray", "[", " ", 
       RowBox[{
        RowBox[{"Join", "[", " ", 
         RowBox[{"newRules", " ", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"ArrayRules", "[", " ", "data", " ", "]"}], ",", " ", 
            RowBox[{"Except", "[", "newRules", "]"}]}], "]"}]}], " ", "]"}], 
        " ", ",", " ", 
        RowBox[{"Length", "[", " ", "data", " ", "]"}]}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"changeData", "[", " ", 
    RowBox[{
     RowBox[{"changedCells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
     RowBox[{"data", " ", ":", " ", 
      RowBox[{"{", "__List", "}"}]}], ",", " ", "newdata_"}], " ", "]"}], " ",
    ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"processedData", " ", "=", " ", 
        RowBox[{"ArrayRules", "[", " ", 
         RowBox[{"\"\<data\>\"", " ", "/@", " ", "data"}], " ", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"processedIndices", " ", "=", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", " ", "/@", " ", "changedCells"}], ")"}], " ", 
          "\[Rule]", " ", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<data\>\"", "[", 
              RowBox[{"mergeDataList", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}], "]"}], "&"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"data", "[", 
               RowBox[{"[", " ", "changedCells", " ", "]"}], "]"}], ",", " ", 
              
              RowBox[{"newdata", " ", "/.", " ", 
               RowBox[{
               "Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
             "}"}]}], " ", "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Normal", "[", " ", 
       RowBox[{"SparseArray", "[", " ", 
        RowBox[{
         RowBox[{"Join", "[", " ", 
          RowBox[{"processedIndices", ",", " ", "processedData"}], "]"}], " ",
          ",", " ", 
         RowBox[{"Length", "[", "data", "]"}]}], " ", "]"}], " ", "]"}], "[", 
      
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"changeData", "[", " ", 
   RowBox[{
    RowBox[{"changedCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", "data_List", ",", " ", 
    "newdata_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"processedData", " ", "=", " ", 
       RowBox[{"ArrayRules", "[", " ", 
        RowBox[{"\"\<data\>\"", " ", "/@", " ", "data"}], " ", "]"}]}], ",", 
      "\n", "\t", 
      RowBox[{"processedIndices", " ", "=", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"List", " ", "/@", " ", "changedCells"}], ")"}], " ", 
         "\[Rule]", " ", 
         RowBox[{"MapThread", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"\"\<data\>\"", "[", "#2", "]"}], "&"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"data", "[", 
              RowBox[{"[", " ", "changedCells", " ", "]"}], "]"}], ",", " ", 
             RowBox[{"newdata", " ", "/.", " ", 
              RowBox[{
              "Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
            "}"}]}], " ", "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"Normal", "[", " ", 
      RowBox[{"SparseArray", "[", " ", 
       RowBox[{
        RowBox[{"Join", "[", " ", 
         RowBox[{"processedIndices", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{"processedData", ",", " ", 
            RowBox[{"Except", "[", "processedIndices", "]"}]}], "]"}]}], 
         "]"}], " ", ",", " ", 
        RowBox[{"Length", "[", "data", "]"}]}], " ", "]"}], " ", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "Code",\

 CellLabel->
  "In[3364]:=",ExpressionUUID->"3302b513-e9fe-45e5-b7f9-d675ecefb2c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mergeDataList", "[", " ", 
   RowBox[{"data1_", " ", ",", " ", "data2_"}], "  ", "]"}], " ", ":=", " ", 
  RowBox[{"Last", " ", "/@", " ", 
   RowBox[{"GatherBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"data1", ",", " ", "data2"}], "}"}], " ", "]"}], ",", " ", 
     "directiveQ"}], " ", "]"}]}]}]], "Code",
 CellLabel->
  "In[3367]:=",ExpressionUUID->"2b8c3df9-7cd3-41f4-b20d-28cb2d4c46bc"]
}, Closed]],

Cell[CellGroupData[{

Cell["mapCellsInternal[]", "Subsection",ExpressionUUID->"5a94c171-934c-4d12-ad62-4dfa84b8a359"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mapCellsInternal", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"mapCellType", "[", 
     RowBox[{"f", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
   "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"mapCellType", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"celltype", " ", ":", " ", 
     RowBox[{"_", "[", 
      RowBox[{"_", ",", "_"}], "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"parseCells", "[", " ", 
    RowBox[{"f", " ", "/@", " ", 
     RowBox[{"unparseCells", "[", "celltype", "]"}]}], " ", "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[3368]:=",ExpressionUUID->"0e91cd52-98a9-4991-bd33-c8a77649afb7"]
}, Closed]],

Cell[CellGroupData[{

Cell["outputCells[]", "Subsection",ExpressionUUID->"b05847f7-0cfe-43d6-88c4-014ef3ddb0dd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"outputCells", "[", " ", 
    RowBox[{"pattern_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], " ",
    ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"outputCellType", "[", 
      RowBox[{"pattern", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
    "cells"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"outputCellType", "[", " ", 
   RowBox[{"_", " ", ",", " ", 
    RowBox[{"_String", "[", " ", 
     RowBox[{"indices_", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "]"}], " ", ":=", " ", 
  "Nothing"}], "\n", 
 RowBox[{
  RowBox[{"outputCellType", "[", " ", 
   RowBox[{"_", ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", 
      RowBox[{"{", "}"}]}], "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"head", "[", "indices", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"outputCellType", "[", " ", 
   RowBox[{"None", ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"head", "[", "indices", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"outputCellType", "[", " ", 
   RowBox[{"pattern_", ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"dataRules", " ", "=", " ", 
      RowBox[{
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"Thread", " ", "/@", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", " ", 
            RowBox[{
             RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", 
             "data"}], " ", "]"}], ",", " ", "pattern"}], "]"}]}], " ", "]"}],
        " ", "/.", " ", 
       RowBox[{"\"\<Automatic\>\"", "\[Rule]", "Automatic"}]}]}], "\n", "}"}],
     ",", "\n", "\t", 
    RowBox[{
     RowBox[{"head", "[", "indices", "]"}], " ", "\[Rule]", " ", 
     "dataRules"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3370]:=",ExpressionUUID->"3e3005a5-6c98-4e26-bd10-dad515d4dea7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["private functions for creating Mechanisms", "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],

Cell[CellGroupData[{

Cell["replaceRules[]", "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "appliedRules__"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules_", ",", " ", "appliedRules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules", ",", " ", "appliedRules", ",", " ", "1"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"rules", " ", ":", " ", 
      RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
     "1"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"flippedRules", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Rule", " ", "@@@", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Replace", "[", " ", 
          RowBox[{
           RowBox[{"flippedRules", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "appliedRules", 
           ",", " ", 
           RowBox[{"{", "1", "}"}]}], " ", "]"}], ",", " ", 
         RowBox[{"flippedRules", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"replaceRules", "[", " ", 
   RowBox[{
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
    "2"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"flippedRules", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"Rule", " ", "@@@", " ", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flippedRules", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"Replace", "[", " ", 
         RowBox[{
          RowBox[{"flippedRules", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "appliedRules", ",",
           " ", 
          RowBox[{"{", "1", "}"}]}], " ", "]"}]}], " ", "}"}], " ", "]"}]}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3375]:=",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeOverlappingCoordinates[]", "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"removeOverlappingCoordinates", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{
      "coordinateList_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
       "labels_"}], "]"}], ",", " ", 
     RowBox[{"None", "|", "0"}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{"head", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "coordinateList", "]"}], ",", "\n", "\t\t",
      "mr", ",", "\n", "\t\t", 
     RowBox[{"deleteDuplicateCells", " ", "@", " ", "cells"}], ",", "\n", 
     "\t\t", "labels"}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"removeOverlappingCoordinates", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", 
     RowBox[{
     "coordinateList_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
      "labels_"}], "]"}], ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"N", "[", "#", "]"}], "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ">", "0"}]}], " ", "&"}], ")"}]}], 
     " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "12"}], ")"}]}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"numberedVertices", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Range", " ", "@", " ", 
           RowBox[{"Length", " ", "@", " ", "coordinateList"}]}], ",", " ", 
          "coordinateList"}], " ", "}"}], "]"}]}], ",", "\n", "\t", 
      "gatheredVertices", ",", "rules"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"gatheredVertices", "=", 
      RowBox[{"GatherBy", "[", "\n", "\t\t", 
       RowBox[{"numberedVertices", ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "they", " ", "are", " ", "the", " ", "same", " ", "if", " ", "they", 
          " ", "are", " ", "the", " ", "same", " ", "within", " ", "the", " ",
           "specified", " ", 
          RowBox[{"precision", "."}]}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"Rationalize", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "precision"}], 
          "]"}], "&"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
     RowBox[{"rules", "=", 
      RowBox[{"Dispatch", " ", "@", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"(*", 
         RowBox[{
         "two", " ", "levels", " ", "to", " ", "thread", " ", "through"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"Thread", " ", "/@", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"gatheredVertices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "gatheredVertices", "]"}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", "]"}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"head", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"ToPackedArray", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "gatheredVertices"}], "]"}], ",", "\n", "\t\t", "mr", ",", "\n", 
       "\t\t", 
       RowBox[{"deleteDuplicateCells", " ", "@", " ", 
        RowBox[{"replaceCellIndices", "[", 
         RowBox[{"cells", ",", "rules"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"replaceRules", "[", " ", 
        RowBox[{"labels", ",", " ", "rules", ",", " ", "2"}], " ", "]"}]}], 
      "\n", "\t", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3379]:=",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDegenerateCellsFromMechanism[]", "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
   RowBox[{"head_", "[", 
    RowBox[{
    "coordinates_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
     "labels_"}], "]"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"head", "[", " ", 
   RowBox[{"coordinates", ",", " ", "mr", ",", " ", 
    RowBox[{"deleteDegenerateCells", "[", "cells", "]"}], ",", " ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Reverse", "[", "labels", "]"}], "]"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[3381]:=",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],

Cell[CellGroupData[{

Cell["missingVertices[]", "Subsection",ExpressionUUID->"f40fca3b-5ac3-45df-9833-1ec262db5844"],

Cell[BoxData[
 RowBox[{
  RowBox[{"missingVertices", "[", " ", 
   RowBox[{"numberOfVertices_", " ", ",", " ", "cells_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"FreeJoints", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"cells", ",", " ", "_FreeJoint"}], " ", "]"}]}], "\n", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", " ", "FreeJoints", " ", "]"}], " ", "\[Equal]", 
       " ", "0"}], ",", " ", "\n", "\t\t", 
      RowBox[{"Range", "[", "numberOfVertices", "]"}], ",", "\n", "\t\t", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", "numberOfVertices", "]"}], ",", " ", 
        RowBox[{"cells", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}], "\n", "\t", 
     "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3382]:=",ExpressionUUID->"89ea601f-aa9b-4950-84c3-22eafdcf6db0"]
}, Closed]],

Cell[CellGroupData[{

Cell["addMeshRegion[], createMeshRegion[]", "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"choose", " ", "your", " ", "own", " ", "dimension"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", 
       RowBox[{
        RowBox[{"coordinates_", "?", "MatrixQ"}], " ", ",", " ", "_", " ", 
        ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
        "labels_"}], " ", "]"}], ",", " ", "Automatic", ",", " ", 
      "options_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], " ",
        "}"}], ",", "\n", "\t", 
      RowBox[{"head", "[", "\n", "\t\t", 
       RowBox[{"coordinates", " ", ",", " ", "\n", "\t\t", 
        RowBox[{"createMeshRegion", "[", " ", 
         RowBox[{"head", ",", " ", 
          RowBox[{"PadRight", "[", " ", 
           RowBox[{"coordinates", ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
              "dim"}], "}"}]}], " ", "]"}], ",", " ", "cells", " ", ",", " ", 
          "options"}], "]"}], ",", " ", "\n", "\t\t", "cells", ",", "\n", 
        "\t\t", "labels"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", 
       RowBox[{
        RowBox[{"coordinates_", "?", "MatrixQ"}], " ", ",", " ", "_", " ", 
        ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
        "labels_"}], " ", "]"}], ",", " ", "dimSpec_", ",", " ", "options_"}],
      " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"head", "[", "\n", "\t\t", 
     RowBox[{"coordinates", " ", ",", "\n", "\t\t", 
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"head", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], ",", " ", 
            "dimSpec"}], "}"}]}], " ", "]"}], ",", " ", "cells", " ", ",", 
        " ", "options"}], "]"}], ",", " ", "\n", "\t\t", "cells", ",", " ", 
      "\n", "\t\t", "labels"}], "\n", "\t", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"chooseDimension", "[", " ", "coordinates_", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", ".", " ", 
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}]}], " ", "<", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], ",", " ", "2", ",", " ", "3"}], " ",
       "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", " ", 
       RowBox[{"coordinates", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "\[Equal]", " ", 
      "3"}]}]}], "\n", 
   RowBox[{
    RowBox[{"chooseDimension", "[", " ", "coordinates_", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"Length", "[", " ", 
     RowBox[{"coordinates", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3383]:=",ExpressionUUID->"2fd91df5-6766-4d60-a3c7-53d9a52d7b96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"createMeshRegion", "[", " ", 
   RowBox[{"head_", ",", " ", 
    RowBox[{"coordinates_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
    
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
    "options_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", " ", 
     RowBox[{"displayCells", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"toDisplayCells", "[", 
         RowBox[{"head", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
       "cells"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"MeshRegion", "[", " ", 
     RowBox[{"coordinates", " ", ",", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"displayCells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", "\n", 
      "\t\t", 
      RowBox[{"Flatten", " ", "@", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"MeshCellLabel", " ", "\[Rule]", "  ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"displayCells", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "4"}], "]"}], "]"}], " ", ",", " ", "1"}], 
            " ", "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"MeshCellStyle", " ", "\[Rule]", "  ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"displayCells", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", ",", " ", "1"}], 
            " ", "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"MeshCellShapeFunction", " ", "\[Rule]", "  ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"displayCells", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", ",", " ", "1"}], 
            " ", "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"Method", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CoplanarityTolerance", "->", "100"}], ",", " ", 
             RowBox[{"DeleteDuplicateCoordinates", "->", "False"}]}], "}"}]}],
           ",", "\n", "\t\t", "options"}], "\n", "\t\t", "}"}], "]"}]}]}], 
     "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"createMeshRegion", "[", " ", 
   RowBox[{"head_", ",", " ", "coordinates_", " ", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
    "options_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[3387]:=",ExpressionUUID->"3ccd1308-4b25-462c-bf14-ca7dea82c5fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Spring", "|", "TorsionalFold"}], ",", " ", 
    "_"}], " ", "]"}], " ", ":=", " ", "Line"}], "\n", 
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", " ", "|", " ", "PinnedJoint"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", "Point"}], "\n", 
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", "Polygon"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellMeshPrimitive", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", "None"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", 
   RowBox[{"mechType_", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], ":=", 
  "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"dataLocations", " ", "=", " ", 
       RowBox[{"PositionIndex", "[", 
        RowBox[{"dataForm", "[", "head", "]"}], "]"}]}], " ", ",", " ", "\n", 
      
      RowBox[{"primitive", " ", "=", " ", 
       RowBox[{"cellMeshPrimitive", "[", " ", 
        RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}], ",", " ", 
      "primitives"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"primitive", " ", "=!=", " ", "None"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"primitives", " ", "=", " ", 
        RowBox[{"primitive", " ", "/@", " ", "indices"}]}], ";", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{"primitives", ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellStyle", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Style\>\"", "]"}]}], " ", "]"}],
          ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellShapeFunction", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Shape\>\"", "]"}]}], " ", "]"}],
          ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellLabel", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Label\>\"", "]"}]}], " ", 
          "]"}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t\t", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "}"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3389]:=",ExpressionUUID->"64b7b531-8b24-4dab-9ace-34e5f065c8da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "TorsionalFold"}], ",", " ", "_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"CapForm", "[", "\"\<Round\>\"", "]"}], ",", "Black"}], 
   "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"Spring", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", " ", "|", " ", "PinnedJoint"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"Face", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"GrayLevel", "[", "0.85", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"ElasticTriangle", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"{", 
     RowBox[{"0.85", ",", "0.85", ",", "0.95"}], "}"}], "]"}], "}"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"defaultMeshStyle", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"toMeshCellStyle", "[", " ", 
   RowBox[{
   "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", " ",
     ",", " ", 
    RowBox[{"{", "index_", "}"}]}], "]"}], ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"styles", " ", "=", " ", 
       RowBox[{"data", "[", 
        RowBox[{"[", " ", "index", " ", "]"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"defaultStyle", " ", "=", " ", 
       RowBox[{"defaultMeshStyle", "[", " ", 
        RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}]}], "\n", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "\[Rule]", " ", 
          RowBox[{"Directive", "@@", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"{", 
             RowBox[{"defaultStyle", " ", ",", " ", "#2"}], "}"}], " ", 
            "]"}]}]}], "&"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{"prims", ",", " ", "styles"}], "}"}]}], " ", "]"}], " ", ",",
       " ", 
      RowBox[{"_", " ", "\[Rule]", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "0"}], "&"}], 
         ")"}]}]}]}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3394]:=",ExpressionUUID->"c2262ab8-69cd-440e-b350-a060080f50e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toMeshCellLabel", "[", " ", 
   RowBox[{
   "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", ",",
     " ", 
    RowBox[{"{", "index_", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"labels", " ", "=", " ", 
      RowBox[{"data", "[", 
       RowBox[{"[", " ", "index", " ", "]"}], "]"}]}], "\n", "}"}], ",", "\n",
     "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"Thread", "[", 
       RowBox[{"prims", " ", "\[Rule]", " ", "labels"}], "]"}], " ", ",", " ", 
      RowBox[{"_", " ", "\[Rule]", " ", "None"}]}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[3401]:=",ExpressionUUID->"2e1f31ff-6557-4fb9-aaa5-ab2f5e0c76c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultMeshShapeFunction", "[", " ", 
   RowBox[{"Spring", " ", ",", " ", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Mechanisms`graphics`SpringShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshShapeFunction", "[", " ", 
   RowBox[{"PinnedJoint", " ", ",", " ", "Linkage"}], "]"}], " ", ":=", " ", 
  RowBox[{"Mechanisms`graphics`PinnedJointShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultMeshShapeFunction", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", 
   "\"\<Automatic\>\""}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toMeshCellShapeFunction", "[", " ", 
    RowBox[{
    "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", 
     ",", " ", 
     RowBox[{"{", "index_", "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"labels", " ", "=", " ", 
       RowBox[{
        RowBox[{"Normal", "[", 
         RowBox[{"data", "[", 
          RowBox[{"[", " ", "index", " ", "]"}], "]"}], "]"}], " ", "/.", " ", 
        RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", 
         RowBox[{"defaultMeshShapeFunction", "[", " ", 
          RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"cleanupShapeFunction", " ", "/@", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"prims", " ", "\[Rule]", " ", "labels"}], "]"}], " ", ",", 
        " ", 
        RowBox[{"_", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{"cell_", " ", "\[Rule]", " ", "None"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"cell", " ", "\[Rule]", " ", "None"}]}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{
    RowBox[{"rule", " ", ":", " ", "_"}], " ", "\[Rule]", " ", "_Function"}], 
   " ", "]"}], " ", ":=", " ", "rule"}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{"cell_", " ", "\[Rule]", " ", "shape_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"cell", " ", "\[Rule]", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"shape", "[", 
      RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], "&"}], ")"}]}]}]}], "Code",\

 CellLabel->
  "In[3402]:=",ExpressionUUID->"380d18c6-2716-430c-9643-2330072de554"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["functions to define and extract information from Mechanisms", "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],

Cell[CellGroupData[{

Cell["error messages", "Subsection",ExpressionUUID->"f146e525-42d8-479e-959e-c8fb6ca1c4a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "meshfail"}], "=", 
   "\"\<`1` has non-numeric coordinates.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[3409]:=",ExpressionUUID->"73ad2a29-7f03-4219-8663-461f9518a7f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["Linkage[]", "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Linkage", "[", " ", 
      RowBox[{
       RowBox[{"coordinates_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
       "mr_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
       "labelPattern"}], " ", "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", ",", " ", 
    RowBox[{"createMeshRegion", "[", " ", 
     RowBox[{
     "Linkage", ",", " ", "coordinates", ",", " ", "cells", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Linkage", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labelPattern"}], " ", "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
    "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", " ", ",", " ", 
     RowBox[{"\"\<Nondisplayable Linkage\>\"", "[", " ", 
      RowBox[{"\"\<Number Vertices = \>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"Length", "[", "coordinates", "]"}], "]"}]}], " ", "]"}]}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Linkage", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "In[3410]:=",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "Linkage", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Linkage", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
        "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}]}], " ", 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"meshOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", " ", 
         RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"deleteDegenerateCellsFromMechanism", " ", "@", " ", 
        RowBox[{"removeOverlappingCoordinates", "[", " ", 
         RowBox[{"f", ",", " ", 
          RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t", 
       "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{"coordinateSpec_", ",", " ", "cellSpec_", " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"meshOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
        "\n", 
        RowBox[{"intermediateParsing", " ", "=", " ", 
         RowBox[{"parseCells", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"coordinateSpec", ",", " ", 
             RowBox[{"{", "}"}], ",", " ", 
             RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
           RowBox[{"{", "cellSpec", "}"}]}], " ", "]"}]}], ",", "\n", 
        "numberOfCoordinates", ",", " ", "coordinates", ",", " ", "cells", 
        ",", " ", "labels"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"numberOfCoordinates", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"intermediateParsing", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coordinates", ",", " ", "cells", ",", " ", "labels"}], 
         "}"}], " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{"intermediateParsing", ",", " ", 
          RowBox[{"FreeJoint", " ", "/@", " ", 
           RowBox[{"missingVertices", "[", 
            RowBox[{"numberOfCoordinates", ",", " ", 
             RowBox[{"intermediateParsing", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], " ", "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
          RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"Linkage", "[", " ", 
             RowBox[{"coordinates", ",", " ", 
              RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], 
             " ", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
           "\t\t\t", "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
         "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"LinkagePrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", " ", "OverlapPrecision", " ", "]"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "precision"}], " ", "=", " ", 
   "\"\<Precision `1` must be a non-negative number or None.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", 
   RowBox[{"None", "|", "0"}], " ", "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", 
   RowBox[{"prec_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", "prec_", " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"Mechanism", "::", "precision"}], ",", " ", "prec"}], "]"}], 
    ";", " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[3413]:=",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], " ", ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", 
   " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<type\>\"", ",", "\n", "\t", "\"\<positions\>\"", ",", " ", "\n", 
     "\t", "\"\<mesh\>\"", ",", " ", "\n", "\t", "\"\<cells\>\"", ",", " ", 
     "\n", "\t", "\"\<labels\>\"", ",", "\n", "\t", "\"\<labeledVertices\>\"",
      ",", " ", "\n", "\t", "\"\<EmbeddingDimension\>\"", ",", " ", "\n", 
     "\t", "\"\<DisplayDimension\>\"", ",", "\n", "\t", 
     "\"\<VertexNumber\>\"", ",", "\n", "\t", "\"\<edges\>\"", ",", "\n", 
     "\t", "\"\<faces\>\""}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<type\>\"", "]"}], " ", ":=", " ", "Linkage"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<positions\>\"", "]"}], " ", ":=", " ", "coordinates"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<cells\>\"", "]"}], " ", ":=", 
  " ", "cells"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<labels\>\"", "]"}], " ", ":=", " ", "labels"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"can", " ", "we", " ", "get", " ", "a", " ", 
    RowBox[{"mesh", "?"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<mesh\>\"", "]"}], " ", ":=", " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<mesh\>\"", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"mesh", "=", 
       RowBox[{"createMeshRegion", "[", " ", 
        RowBox[{
        "Linkage", ",", " ", "coordinates", ",", " ", "cells", ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MeshRegionQ", "[", "mesh", "]"}], ",", "mesh", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Mechanism", "::", "meshfail"}], ",", "Linkage"}], "]"}], 
        ";", " ", "$Failed"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<labeledVertices\>\"", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", " ", ",", " ", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}], ",", " ", 
     RowBox[{"Reverse", "/@", "labels"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<EmbeddingDimension\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"Length", "[", 
   RowBox[{"coordinates", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", 
    RowBox[{"coordinates", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<VertexNumber\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", " ", 
     RowBox[{
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"Linkage", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
            RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], 
           "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}], " ", ",", "1"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"cells", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"Dimensions", "[", "#", "]"}], "]"}], "\[Equal]", 
            "2"}]}], " ", "&"}]}], " ", "]"}], ",", "1"}], "]"}], ",", " ", 
     "Sort"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",",
       " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<edges\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"ToPackedArray", " ", "@", " ", 
    RowBox[{
     RowBox[{"MeshCells", "[", 
      RowBox[{"m", ",", "1"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", " ", 
     RowBox[{
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{
       "Linkage", ",", " ", "coordinates", ",", " ", "cells", " ", ",", 
        RowBox[{"{", "}"}]}], "]"}], " ", ",", "2"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", " ", 
         RowBox[{"cells", ",", " ", 
          RowBox[{"_Face", "|", "_ElasticFace"}]}], " ", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", " ",
      "Sort"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",", 
     " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", 
     RowBox[{"m", ",", "2"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3420]:=",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami[]", "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Origami", "[", " ", 
      RowBox[{
       RowBox[{"coordinates_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
       "mr_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
       "labelPattern"}], " ", "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", ",", " ", 
    RowBox[{"createMeshRegion", "[", " ", 
     RowBox[{"Origami", ",", " ", 
      RowBox[{"PadRight", "[", " ", 
       RowBox[{"coordinates", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
          RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], 
         "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labelPattern"}], " ", "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
    "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", " ", ",", " ", 
     RowBox[{"\"\<Nondisplayable Origami\>\"", "[", " ", 
      RowBox[{"\"\<Number of vertices = \>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"Length", "[", "coordinates", "]"}], "]"}]}], " ", "]"}]}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Origami", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "In[3438]:=",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "Origami", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "\n", "This"}], " ", "is", " ", "a", " ", "kludge", " ", 
    "to", " ", 
    RowBox[{"fix", " ", "?", "Origami"}], " ", "which", " ", "returns", " ", 
    "an", " ", "error", " ", "from", " ", "PadRight", " ", "otherwise", " ", 
    "for", " ", "reasons", " ", "that", " ", "are", " ", "not", " ", 
    "entirely", " ", 
    RowBox[{"clear", "."}]}], "\n", "***)"}]}], "\n", 
 RowBox[{
  RowBox[{"mypad", "[", " ", 
   RowBox[{"c_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n1_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", "n2_"}], "}"}]}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"c", ",", " ", 
    RowBox[{"{", 
     RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mypad", "[", " ", 
    RowBox[{"c_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", "c"}], "\n", 
  RowBox[{"(*", "*****)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
        "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}]}], " ", 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"meshOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", " ", 
         RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"deleteDegenerateCellsFromMechanism", " ", "@", " ", 
        RowBox[{"removeOverlappingCoordinates", "[", " ", 
         RowBox[{"f", ",", " ", 
          RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t", 
       "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"coordinateSpec_", ",", " ", "cellSpec_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"meshOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
       "\n", 
       RowBox[{"intermediateParsing", " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"coordinateSpec", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
          RowBox[{"{", "cellSpec", "}"}]}], " ", "]"}]}], ",", "\n", 
       "numberOfCoordinates", ",", " ", "coordinates", ",", " ", "cells", ",",
        " ", "labels"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"numberOfCoordinates", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"intermediateParsing", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coordinates", ",", " ", "cells", ",", " ", "labels"}], "}"}],
        " ", "=", " ", 
       RowBox[{"parseCells", "[", " ", 
        RowBox[{"intermediateParsing", ",", " ", 
         RowBox[{"FreeJoint", " ", "/@", " ", 
          RowBox[{"missingVertices", "[", 
           RowBox[{"numberOfCoordinates", ",", " ", 
            RowBox[{"intermediateParsing", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], " ", "]"}]}], ";", 
      "\n", "\n", "\t", 
      RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
         RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"Origami", "[", " ", 
            RowBox[{
             RowBox[{"mypad", "[", " ", 
              RowBox[{"coordinates", " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
                 "3"}], "}"}]}], " ", "]"}], ",", " ", 
             RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ",
             "]"}], ",", "\n", "\t\t\t\t", 
           RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
          "\t\t\t", "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{"LinkagePrecisionQ", "[", " ", 
    RowBox[{"OptionValue", "[", " ", "OverlapPrecision", " ", "]"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3441]:=",ExpressionUUID->"1c3e576c-c667-475f-89cb-197999bffac7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", 
   " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<type\>\"", ",", "\n", "\t", "\"\<positions\>\"", ",", " ", "\n", 
     "\t", "\"\<mesh\>\"", ",", " ", "\n", "\t", "\"\<components\>\"", ",", 
     " ", "\n", "\t", "\"\<labels\>\"", ",", " ", "\"\<labeledVertices\>\"", 
     ",", "\n", "\t", "\"\<EmbeddingDimension\>\"", ",", " ", "\n", "\t", 
     "\"\<DisplayDimension\>\"", ",", "\n", "\t", "\"\<VertexNumber\>\"", ",",
      "\n", "\t", "\"\<edges\>\"", ",", "\n", "\t", "\"\<faces\>\""}], "\n", 
    "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<type\>\"", "]"}], " ", ":=", " ", "Origami"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<positions\>\"", "]"}], " ", ":=", " ", "coordinates"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<mesh\>\"", "]"}], " ", ":=", " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<mesh\>\"", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mesh", "=", 
       RowBox[{"createMeshRegion", "[", " ", 
        RowBox[{"Origami", ",", " ", 
         RowBox[{"PadRight", "[", " ", 
          RowBox[{"coordinates", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
             RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}],
             "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MeshRegionQ", "[", "mesh", "]"}], ",", "mesh", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Mechanism", "::", "meshfail"}], ",", "Origami"}], "]"}], 
        ";", " ", "$Failed"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<cells\>\"", "]"}], " ", ":=", 
   " ", "cells"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<labels\>\"", "]"}], " ", ":=", " ", "labels"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<labeledVertices\>\"", "]"}], " ", ":=", "  ", 
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", " ", ",", " ", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}], ",", " ", 
     RowBox[{"Reverse", "/@", "labels"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<EmbeddingDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", 
    RowBox[{"coordinates", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", " ", 
     RowBox[{"MeshCoordinates", "[", " ", 
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"Origami", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
            RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], 
           "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}], " ", "]"}], " ", "]"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<VertexNumber\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", " ", 
     RowBox[{
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"Origami", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
            RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], 
           "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}], " ", ",", "1"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"cells", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"Dimensions", "[", "#", "]"}], "]"}], "\[Equal]", 
            "2"}]}], " ", "&"}]}], " ", "]"}], ",", "1"}], "]"}], ",", " ", 
     "Sort"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",",
       " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<edges\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"ToPackedArray", " ", "@", " ", 
    RowBox[{
     RowBox[{"MeshCells", "[", 
      RowBox[{"m", ",", "1"}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", " ", 
     RowBox[{
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"Origami", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
            RowBox[{"chooseDimension", "[", " ", "coordinates", " ", "]"}]}], 
           "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}], " ", ",", "2"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", " ", 
         RowBox[{"cells", ",", " ", 
          RowBox[{"_Face", "|", "_ElasticFace"}]}], " ", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", " ",
      "Sort"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",", 
     " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", 
     RowBox[{"m", ",", "2"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3446]:=",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCellList[]", "Subsection",ExpressionUUID->"dea4a3c2-e7ee-4f47-bf96-66929b110d6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dataSpecPattern", " ", "=", " ", 
    RowBox[{
     RowBox[{"Blank", "[", "]"}], "|", 
     RowBox[{"Alternatives", "[", "__String", "]"}], "|", "_String"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellList", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"outputCells", "[", " ", 
    RowBox[{"_", " ", ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellList", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"indexSpec_", " ", ":", " ", "_"}], " ", ",", " ", 
     RowBox[{"dataSpec", " ", ":", " ", "_Rule", " ", ":", " ", "None"}], ",",
      " ", 
     RowBox[{"outputSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", 
   " ", "\n", "\t", 
   RowBox[{"outputCells", "[", "  ", 
    RowBox[{"outputSpec", " ", ",", " ", 
     RowBox[{
      RowBox[{"filterByData", "[", 
       RowBox[{"m", " ", ",", " ", "dataSpec"}], " ", "]"}], " ", "@", " ", 
      RowBox[{
       RowBox[{"filterByCells", "[", " ", 
        RowBox[{"m", ",", " ", "indexSpec"}], "]"}], " ", "@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"filterByCells", "[", " ", 
    RowBox[{"m_", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"head_", " ", ",", " ", "indices_List"}], "}"}]}], "]"}], "[", 
   "cells_", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"takeCells", "[", " ", 
      RowBox[{
       RowBox[{"identifyCellFromList", "[", " ", 
        RowBox[{"head", ",", " ", "indices", ",", " ", "#"}], " ", "]"}], ",",
        " ", "#"}], " ", "]"}], " ", "&"}], " ", "/@", " ", "cells"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"filterByCells", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"patt", " ", ":", " ", 
       RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}], "[", "cells_", 
    "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", "patt", "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"takeCells", "[", " ", 
         RowBox[{
          RowBox[{"casesCellType", "[", " ", 
           RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], 
         " ", "]"}], " ", "&"}], " ", "/@", " ", "cells"}], "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"filterByData", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "None"}], " ", "]"}], "[", "cells_", "]"}], 
  " ", ":=", " ", "cells"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"filterByData", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"dataSpec_", " ", "\[Rule]", " ", "f_Function"}]}], " ", "]"}], 
   "[", "cells_", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"takeCells", "[", " ", 
      RowBox[{
       RowBox[{"selectCellFromDataType", "[", " ", 
        RowBox[{
         RowBox[{"dataSpec", " ", "\[Rule]", " ", "f"}], ",", " ", "#"}], " ",
         "]"}], ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", "cells"}],
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"filterByData", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"dataSpec_", " ", "\[Rule]", " ", "patt_"}]}], " ", "]"}], "[", 
   " ", "cells_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"takeCells", "[", " ", 
      RowBox[{
       RowBox[{"casesCellFromDataType", "[", " ", 
        RowBox[{
         RowBox[{"dataSpec", " ", "\[Rule]", " ", "patt"}], " ", ",", " ", 
         "#"}], " ", "]"}], ",", " ", "#"}], " ", "]"}], " ", "&"}], " ", "/@",
     " ", "cells"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3464]:=",ExpressionUUID->"4095e79d-34ef-435b-84d6-5f5641f09777"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismPositions[] ", "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPositions", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"m", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"a", " ", "quiet", " ", "version"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPositions", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"coords_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "m", "]"}], "[", 
     RowBox[{"coords", ",", 
      RowBox[{"m", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{"m", "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", 
      RowBox[{"m", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "coords", "]"}], "==", 
     RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "actually", " ", "rework", " ", "the", " ", "way", " ", "it", " ", 
    "looks"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPositions", "[", " ", 
    RowBox[{"Rule", "[", " ", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
      RowBox[{"coords_", "?", "MatrixQ"}]}], " ", "]"}], " ", "]"}], "  ", ":=",
    "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", "=", 
        RowBox[{
         RowBox[{"Head", "[", "m", "]"}], "[", 
         RowBox[{"coords", ",", " ", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "}"}], ",", "\n", 
      "\t\t", 
      RowBox[{
       RowBox[{"Head", "[", "m", "]"}], "[", 
       RowBox[{"coords", ",", 
        RowBox[{"tmp", "[", "\"\<mesh\>\"", "]"}], ",", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "\n", "\t", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"Length", "[", " ", "coords", " ", "]"}], " ", "==", " ", 
     RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPositions", "::", "coords"}], " ", "=", " ", 
   "\"\<Coordinates should have the same number of vertices as the mechanism.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismPositions", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "_"}], " ", 
    "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", " ", 
    RowBox[{"MechanismPositions", "::", "coords"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismPositions", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", " ", 
    RowBox[{"MechanismPositions", "::", "coords"}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "In[3472]:=",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEdges[], MechanismFaces[], MechanismVertices[]", "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismEdges", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaces", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismVertices", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Range", "[", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdges", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", "_Integer"}], "}"}], "..."}], "}"}]}]}], 
    " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"indexedEdges", "=", 
        RowBox[{"PositionIndex", "[", 
         RowBox[{"Sort", "/@", 
          RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], "]"}]}], ",", " ", 
       RowBox[{"sortedEdges", " ", "=", " ", 
        RowBox[{"Sort", "/@", "edgeList"}]}]}], "}"}], ",", " ", "\n", "\t", 
     RowBox[{"ToPackedArray", " ", "@", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"indexedEdges", " ", "/@", " ", "sortedEdges"}], "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaces", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"faceList", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "..."}], "}"}]}]}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"indexedFaces", " ", "=", " ", 
       RowBox[{"PositionIndex", "[", 
        RowBox[{"Sort", "/@", 
         RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"sortedFaces", " ", "=", " ", 
       RowBox[{"Sort", " ", "/@", " ", "faceList"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"ToPackedArray", " ", "@", " ", 
     RowBox[{"Flatten", "[", " ", 
      RowBox[{
       RowBox[{"indexedFaces", " ", "/@", " ", "sortedFaces"}], " ", ",", " ",
        "1"}], " ", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3478]:=",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCells[]", "Subsection",ExpressionUUID->"f3b80113-3224-49a9-9e96-60dda4fcc677"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismCells", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Sort", "[", 
   RowBox[{"Head", " ", "/@", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    RowBox[{"s", " ", ":", " ", "_String"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"FirstCase", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"s", "[", "__", "]"}]}], " ", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     RowBox[{"s", " ", ":", " ", 
      RowBox[{"Alternatives", "[", " ", "__String", " ", "]"}]}]}], " ", 
    "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Cases", "[", " ", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
      RowBox[{"s", "[", "__", "]"}]}], " ", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    RowBox[{"s", " ", ":", " ", "celltypePattern"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"FirstCase", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"s", "[", "__", "]"}]}], " ", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    RowBox[{"s", " ", ":", " ", 
     RowBox[{"celltypePattern", ".."}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "#", "]"}], "[", 
     RowBox[{"#", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"Cases", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Alternatives", "@@", 
        RowBox[{"{", "s", "}"}]}], ")"}], "[", "__", "]"}]}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3483]:=",ExpressionUUID->"751f4008-59c9-41c2-a965-1bb8d19b428e"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
MechanismEdgeQ[],MechanismFaceQ[],ValidMechanismEdgeQ[],ValidMechanismFaceQ[]\
\
\>", "Subsection",ExpressionUUID->"929a533b-38ca-4691-bbf0-10109000ed9f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismEdgeQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "edgelist_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"edgelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
      RowBox[{"ContainsAll", "[", " ", 
       RowBox[{
        RowBox[{"Sort", "/@", 
         RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], ",", 
        RowBox[{"Sort", "/@", "edgelist"}]}], "]"}]}], "}"}], ",", "TrueQ"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaceQ", "[", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     "facelist_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"AllTrue", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ListQ", "[", "facelist", "]"}], ",", 
       RowBox[{"ContainsAll", "[", " ", 
        RowBox[{
         RowBox[{"Sort", "/@", 
          RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], ",", 
         RowBox[{"Sort", "/@", "facelist"}]}], " ", "]"}]}], "}"}], ",", 
     "TrueQ"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismEdgeQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "edgelist_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"edgelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
      RowBox[{
       RowBox[{"Min", "[", "edgelist", "]"}], ">", "0"}], ",", 
      RowBox[{
       RowBox[{"Max", "[", "edgelist", "]"}], "\[LessEqual]", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", 
    "TrueQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismEdgeQ", "[", 
    RowBox[{
     RowBox[{"pos_", "?", "MatrixQ"}], " ", ",", " ", "edgelist_"}], " ", 
    "]"}], " ", ":=", " ", 
   RowBox[{"AllTrue", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"edgelist", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
       RowBox[{
        RowBox[{"Min", "[", "edgelist", "]"}], ">", "0"}], ",", 
       RowBox[{
        RowBox[{"Max", "[", "edgelist", "]"}], "\[LessEqual]", 
        RowBox[{"Length", "[", "pos", "]"}]}]}], "}"}], ",", "TrueQ"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismFaceQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "facelist_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"ListQ", "[", "facelist", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Min", "[", "facelist", "]"}], ">", "0"}], ",", 
      RowBox[{
       RowBox[{"Max", "[", "facelist", "]"}], "\[LessEqual]", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", 
    "TrueQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismFaceQ", "[", 
   RowBox[{
    RowBox[{"pos_", "?", "MatrixQ"}], " ", ",", " ", "facelist_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ListQ", "[", "facelist", "]"}], ",", 
      RowBox[{
       RowBox[{"Min", "[", "facelist", "]"}], ">", "0"}], ",", 
      RowBox[{
       RowBox[{"Max", "[", "facelist", "]"}], "\[LessEqual]", 
       RowBox[{"Length", "[", "pos", "]"}]}]}], "}"}], ",", "TrueQ"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3488]:=",ExpressionUUID->"e7d99d5c-47c2-4c13-bb77-affd8f0fda8f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["functions to manipulate mechanisms", "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],

Cell[CellGroupData[{

Cell["LabelCells[]", "Subsection",ExpressionUUID->"412267ca-b4cd-4402-8196-31c933c269a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LabelCells", "[", " ", 
    RowBox[{
     RowBox[{"s", " ", ":", " ", "_String"}], " ", ",", " ", "indexList_"}], 
    " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"Head", "[", "m", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"m", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
    RowBox[{"joinCells", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"packCells", "[", " ", 
        RowBox[{"{", 
         RowBox[{"s", "[", 
          RowBox[{"indexList", ",", " ", 
           RowBox[{"{", "}"}]}], " ", "]"}], "}"}], " ", "]"}], ",", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], " ", "}"}], " ", "]"}], ",", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"LabelCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"s", " ", ":", " ", "_String"}], " ", ",", " ", "indexList_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"LabelCells", "[", 
    RowBox[{"s", ",", "indexList"}], "]"}], "[", "m", "]"}]}]}], "Code",
 CellLabel->
  "In[3494]:=",ExpressionUUID->"065b9a63-e5d1-40c0-a6bb-fb3c2b40fe15"]
}, Closed]],

Cell[CellGroupData[{

Cell["JoinMechanism[]", "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "JoinMechanism", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "12"}], ")"}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JoinMechanism", "[", " ", 
    RowBox[{
     RowBox[{"meshes", " ", ":", " ", 
      RowBox[{
       RowBox[{"__", "?", "MechanismQ"}], "|", 
       RowBox[{"{", 
        RowBox[{"__", "?", "MechanismQ"}], "}"}]}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", " ", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "meshes", "}"}], "]"}]}], ",", " ", 
       RowBox[{"meshOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}]}], " ", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"num", " ", "=", " ", 
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "+", "1"}], "&"}], " ", "/@", " ", 
                 RowBox[{"Accumulate", "[", " ", 
                  RowBox[{"Length", " ", "/@", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}]}],
                " ", "}"}], ",", " ", "1"}], " ", "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
        RowBox[{"addMeshRegion", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t\t", 
           RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"m", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "\n", 
              "\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}],
                ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"{", "}"}], ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"joinCells", "[", " ", 
                RowBox[{"Flatten", " ", "@", " ", 
                 RowBox[{"MapThread", "[", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"replaceCellIndices", "[", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{
                    "n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}]}], "]"}],
                     "&"}], ",", " ", 
                   RowBox[{"{", " ", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], "]"}]}], " ", "]"}], ",", "\n", 
               "\t\t\t\t\t\t", 
               RowBox[{"Flatten", " ", "@", " ", 
                RowBox[{"MapThread", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"replaceRules", "[", " ", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{"n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}], 
                    ",", " ", "2"}], " ", "]"}], "&"}], ",", " ", 
                  RowBox[{"{", " ", 
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "4"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], " ", "]"}]}]}], "\n", "\t\t\t\t\t",
               "]"}], ",", "\n", "\t\t\t\t\t", 
             RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
            "\t\t\t\t", "]"}], "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          "Automatic", ",", "\n", "\t\t\t", "meshOptions"}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"LinkagePrecisionQ", "[", " ", 
        RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}], " ", "]"}], 
       " ", "&&", " ", 
       RowBox[{"sameHeadsQ", "[", " ", "m", " ", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "comb"}], " ", "=", " ", 
   "\"\<Cannot combine Mechanisms of different types.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sameHeadsQ", "[", " ", "expr_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"SameQ", "[", " ", 
     RowBox[{"Head", " ", "/@", " ", "expr"}], " ", "]"}], ",", " ", "True", 
    ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"Mechanism", "::", "comb"}], "]"}], ";", " ", "False"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3496]:=",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],

Cell[CellGroupData[{

Cell["SelectCells[], DeleteCells[]", "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SelectCells", "[", " ", "patt_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", " ", "patt", " ", "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"casesCellType", "[", " ", 
             RowBox[{"pattern", ",", " ", "#"}], "]"}], ",", " ", "#"}], " ", 
           "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SelectCells", "[", " ", 
     RowBox[{"head_", " ", ",", " ", "cellList_List"}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"{", "}"}], ",", "\n", "\t\t", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"takeCells", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{"head", ",", " ", "cellList", ",", " ", "#"}], "]"}], ",", 
          " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"SelectCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"SelectCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SelectCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "head_", ",", 
    " ", "cellList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"SelectCells", "[", 
      RowBox[{"head", ",", " ", "cellList"}], "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3500]:=",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCells", "[", " ", "pattList_List", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Fold", "[", 
    RowBox[{"DeleteCells", ",", " ", "m", " ", ",", " ", "pattList"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCells", "[", " ", 
     RowBox[{"patt", " ", ":", " ", 
      RowBox[{"Except", "[", " ", "_List", " ", "]"}]}], "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", " ", "patt", " ", "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"removeCells", "[", " ", 
           RowBox[{
            RowBox[{"casesCellType", "[", " ", 
             RowBox[{"pattern", ",", " ", "#"}], "]"}], ",", " ", "#"}], " ", 
           "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCells", "[", " ", 
     RowBox[{"head_", " ", ",", " ", "cellList_List"}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"{", "}"}], ",", "\n", "\t\t", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"removeCells", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{"head", ",", " ", "cellList", ",", " ", "#"}], "]"}], ",", 
          " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DeleteCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"DeleteCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "head_", ",", 
    " ", "cellList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteCells", "[", 
      RowBox[{"head", ",", " ", "cellList"}], "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3504]:=",ExpressionUUID->"5198b681-d64a-4e20-97b8-8e031eacc149"]
}, Closed]],

Cell[CellGroupData[{

Cell["AddCells[]", "Subsection",ExpressionUUID->"ba379b12-e39c-49a0-ba40-463bc3626108"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "AddCells", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "Linkage", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddCells", "[", " ", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"parsed", " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], " ", ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "cells", "}"}], "]"}]}], "]"}]}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
       RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "m", "]"}], "[", 
          RowBox[{
           RowBox[{"parsed", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{"parsed", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"parsed", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
         RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", "\t", 
        "]"}], " ", "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"LinkagePrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}], " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"AddCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "cells_", ",",
     " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"AddCells", "[", " ", 
      RowBox[{"cells", ",", " ", "opt"}], " ", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", ",", " ", 
    RowBox[{"FilterRules", "[", " ", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", " ", 
      RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3509]:=",ExpressionUUID->"a23612de-3cf0-403e-b850-8a9c7144e63f"]
}, Closed]],

Cell[CellGroupData[{

Cell["DeleteVertices[]", "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeleteVertices", "[", " ", 
    RowBox[{"vertices_", "?", "VectorQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"pattern", " ", "=", " ", 
      RowBox[{"Alternatives", " ", "@@", " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"___", ",", "#", ",", "___"}], "}"}], "|", "#"}], "&"}], 
         " ", "/@", " ", "vertices"}], " ", ")"}]}]}], " ", "}"}], ",", "\n", 
    
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"remainingCells", " ", "=", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"removeCells", "[", " ", 
            RowBox[{
             RowBox[{"casesCellType", "[", " ", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "[", "pattern", "]"}], 
                "}"}], " ", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], " ",
             "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], " ", "}"}], ",", 
      "\n", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"remainingVertices", " ", "=", " ", 
          RowBox[{"Complement", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"m", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
            RowBox[{"vertices", " ", "/.", " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "]"}]}], " ", "}"}], 
        ",", "\n", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"remappingRules", " ", "=", " ", 
            RowBox[{"Thread", "[", " ", 
             RowBox[{"remainingVertices", " ", "\[Rule]", " ", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "remainingVertices", "]"}], "]"}]}], 
             "]"}]}], " ", "}"}], ",", "\n", "\t", 
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", " ", "remainingVertices"}], "]"}], "]"}], ",",
             "\n", "\t\t", 
            RowBox[{"{", "}"}], ",", "\n", "\t\t", 
            RowBox[{"replaceCellIndices", "[", " ", 
             RowBox[{"remainingCells", ",", " ", "remappingRules"}], " ", 
             "]"}], ",", "\n", "\t\t", 
            RowBox[{"replaceRules", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", " ", "remappingRules", 
              ",", " ", "2"}], " ", "]"}]}], "\n", "\t", "]"}]}], "\n", 
         "]"}]}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[3512]:=",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "vertices_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteVertices", "[", "vertices", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[3513]:=",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],

Cell[CellGroupData[{

Cell["ChangeCellData[]", "Subsection",ExpressionUUID->"901ddd13-737f-4e91-b19e-1ed99e5bece8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"patt_", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "m"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"patt_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"dataRule", " ", ":", " ", "_Rule"}], "}"}]}], " ", "]"}], "[", 
   " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"patt", ",", " ", "dataRule"}], " ", "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"patt_", " ", ",", " ", 
      RowBox[{"dataRules", " ", ":", " ", 
       RowBox[{"{", "__Rule", "}"}]}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"patt", ",", " ", 
      RowBox[{"Rest", "[", "dataRules", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ChangeCellData", "[", 
      RowBox[{"patt", ",", " ", 
       RowBox[{"First", "[", "dataRules", "]"}]}], " ", "]"}], "[", "m", 
     "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"patt_", " ", ",", " ", 
      RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_"}]}], " ", "]"}], "[", 
    " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", "patt", "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"ChangeCellDataType", "[", " ", 
          RowBox[{
           RowBox[{"casesCellType", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], " ", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec"}], "}"}], 
           " ", ",", " ", 
           RowBox[{"{", "data", "}"}], ",", " ", "#"}], " ", "]"}], " ", 
         "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], " ", ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"headSpec_Symbol", " ", ",", " ", "cellList_List", ",", " ", 
      RowBox[{"Rule", "[", " ", 
       RowBox[{"dataSpec_", " ", ",", " ", 
        RowBox[{"data", " ", ":", " ", 
         RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}]}], " ", "]"}], 
    "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"headSpec", ",", " ", "cellList", ",", " ", 
      RowBox[{"dataSpec", " ", "\[Rule]", " ", 
       RowBox[{"ConstantArray", "[", " ", 
        RowBox[{"data", ",", " ", 
         RowBox[{"Length", "[", "cellList", "]"}]}], " ", "]"}]}]}], "]"}], 
    "[", "m", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{
      RowBox[{"headSpec", " ", ":", " ", 
       RowBox[{
       "RigidBar", "|", "Spring", "|", "AngleJoint", "|", "TorsionalFold"}]}],
       " ", ",", " ", 
      RowBox[{"cellList_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_List"}]}], " ", "]"}], 
    "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ChangeCellDataType", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{"headSpec", " ", ",", " ", "cellList", ",", " ", "#"}], 
           "]"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec"}], "}"}], 
          ",", " ", "data", " ", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ",
        "/@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{"m", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "data", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "cellList", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{
      RowBox[{"headSpec", " ", ":", " ", "Face"}], " ", ",", " ", 
      "cellList_List", " ", ",", " ", 
      RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_List"}]}], " ", "]"}], 
    "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ChangeCellDataType", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{"headSpec", " ", ",", " ", "cellList", ",", " ", "#"}], 
           "]"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec"}], "}"}], 
          ",", " ", "data", " ", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ",
        "/@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{"m", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "data", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "cellList", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{
      RowBox[{"headSpec", " ", ":", " ", 
       RowBox[{"AnyJoint", "|", "FreeJoint", "|", "PinnedJoint"}]}], " ", ",",
       " ", 
      RowBox[{"cellList_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_List"}]}], " ", "]"}], 
    "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ChangeCellDataType", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{"headSpec", " ", ",", " ", "cellList", ",", " ", "#"}], 
           "]"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec"}], "}"}], 
          ",", " ", "data", " ", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ",
        "/@", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{"m", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "data", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "cellList", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"headSpec_Symbol", ",", " ", "cellList_List", ",", " ", 
     RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_List"}]}], " ", "]"}], 
   "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"(", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"ChangeCellData", "::", "head"}], ",", " ", "headSpec"}], 
      "]"}], ";", " ", "m"}], " ", ")"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "data", "]"}], "\[Equal]", 
    RowBox[{"Length", "[", "cellList", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{
     RowBox[{"AnyJoint", "|", "FreeJoint", "|", "PinnedJoint"}], ",", " ", 
     RowBox[{"cellList_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"VectorQ", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", " ", 
     "_"}], "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", " ", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"ChangeCellData", "::", "FreeJoint"}], ",", " ", "FreeJoint"}], 
     "]"}], ";", " ", "m"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"Face", ",", " ", "_", ",", " ", "_"}], " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"ChangeCellData", "::", "cell"}], ",", " ", "Face"}], "]"}], 
    ";", " ", "m"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{
     RowBox[{"cellSpec", ":", " ", 
      RowBox[{
      "RigidBar", "|", "Spring", "|", "AngleJoint", "|", "TorsionalFold"}]}], 
     ",", " ", 
     RowBox[{"cellList_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"MatrixQ", "[", "#", "]"}], "]"}], "&"}], ")"}]}], ",", " ", 
     "_"}], "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", " ", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"ChangeCellData", "::", "cell"}], ",", " ", "cellSpec"}], "]"}],
     ";", " ", "m"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"headSpec_Symbol", " ", ",", " ", "cellList_List", ",", " ", 
      RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_List"}]}], " ", "]"}], 
    "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"ChangeCellData", "::", "data"}], "]"}], ";", " ", "m"}], " ", 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "data"}], " ", "=", " ", 
   "\"\<Data list must be the same length as the number of cells.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "FreeJoint"}], "=", " ", 
   "\"\<Cells of type `1` are specified as a single list.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "cell"}], " ", "=", " ", 
   "\"\<Cells of type `1` are specified as a list of lists.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "head"}], "=", " ", 
   "\"\<Bad cell type, `1`.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3514]:=",ExpressionUUID->"70f625df-561a-4796-a043-b09f24c338ff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ChangeCellData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_", ",", 
    " ", 
    RowBox[{"ruleList", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", 
      RowBox[{"patt", ",", "ruleList"}], "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ChangeCellData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "headSpec_", 
    ",", " ", "cellList_", ",", " ", 
    RowBox[{"dataSpec_", " ", "\[Rule]", " ", "data_"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", 
      RowBox[{"headSpec", ",", " ", "cellList", ",", " ", 
       RowBox[{"dataSpec", " ", "\[Rule]", " ", "data"}]}], "]"}], "[", "m", 
     "]"}], ",", " ", "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3531]:=",ExpressionUUID->"125d59ca-1967-4382-af1c-7ee3973c19c1"]
}, Closed]],

Cell[CellGroupData[{

Cell["PlaceVertices[], DisplaceVertices[]", "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaceVertices", "[", " ", 
     RowBox[{"moveSpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"vertexMoves", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "moveSpec", "}"}], "]"}]}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"newVertexPositions", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"vertexMoves", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", ",", " ", 
         RowBox[{"vertexMoves", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "[", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
   "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", " ", 
    RowBox[{"vertices", ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "vertices", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaceVertices", "[", " ", 
     RowBox[{"vertices_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
    "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertices", "]"}], " ", "\[NotEqual]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"PlaceVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", "vertices", "]"}], "]"}], " ", 
        "\[NotEqual]", " ", 
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}], "]"}]}], ",", 
       " ", 
       RowBox[{"Message", "[", " ", 
        RowBox[{"PlaceVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], ";",
      "\n", "\t", "m"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices is incorrect.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Some vertices are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaceVertices", "::", "pos"}], " ", "=", " ", 
    "\"\<All positions are not of the same dimension as coordinates.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{"coordinates", ",", " ", 
     RowBox[{"Thread", "[", " ", 
      RowBox[{"vertices", " ", "\[Rule]", " ", "pos"}], " ", "]"}]}], " ", 
    "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Last", "@", 
     RowBox[{"Dimensions", "[", "coordinates", "]"}]}], " ", "\[Equal]", " ", 
    
    RowBox[{"Last", "@", 
     RowBox[{"Dimensions", "[", "pos", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"PlaceVertices", "::", "vert"}], "]"}], ";", " ", 
    "coordinates"}], " ", ")"}]}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", " ", ",", " ", "_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"PlaceVertices", "::", "pos"}], "]"}], ";", " ", "coordinates"}],
    " ", ")"}]}]}], "Code",
 CellLabel->
  "In[3533]:=",ExpressionUUID->"3b0edd43-f179-414d-aa01-523bd36dc076"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplaceVertices", "[", " ", 
     RowBox[{"moveSpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"vertexMoves", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "moveSpec", "}"}], "]"}]}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"moveVertexPositions", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"vertexMoves", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", 
         RowBox[{"vertexMoves", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "[", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
   "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "+", " ", 
      "vertices"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "vertices", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplaceVertices", "[", " ", 
     RowBox[{"vertices_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
    "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertices", "]"}], " ", "\[NotEqual]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"DisplaceVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", "vertices", "]"}], "]"}], " ", 
        "\[NotEqual]", " ", 
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}], "]"}]}], ",", 
       " ", 
       RowBox[{"Message", "[", " ", 
        RowBox[{"DisplaceVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], 
     ";", "\n", "\t", "m"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices is incorrect.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Some vertices are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplaceVertices", "::", "pos"}], " ", "=", " ", 
    "\"\<All positions are not of the same dimension as coordinates.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", " ", 
      RowBox[{
       RowBox[{"VectorQ", "[", " ", 
        RowBox[{"#", ",", " ", "IntegerQ"}], " ", "]"}], " ", "&"}], " ", 
      ")"}]}], " ", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", " ", 
      RowBox[{
       RowBox[{"MatrixQ", "[", " ", 
        RowBox[{"#", ",", " ", "NumericQ"}], " ", "]"}], " ", "&"}], " ", 
      ")"}]}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{"coordinates", ",", " ", 
     RowBox[{"Thread", "[", " ", 
      RowBox[{"vertices", " ", "\[Rule]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", "vertices", "]"}], "]"}], " ", "+", " ", "pos"}], 
        ")"}]}], " ", "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Last", "[", 
     RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}], " ", "\[Equal]", 
    " ", 
    RowBox[{"Last", "[", 
     RowBox[{"Dimensions", "[", "pos", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "vertices_", ",", " ", "pos_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"VectorQ", "[", 
        RowBox[{"vertices", ",", " ", "IntegerQ"}], " ", "]"}], "]"}], ",", 
      " ", 
      RowBox[{"Message", "[", " ", 
       RowBox[{"DisplaceVertices", "::", "vert"}], " ", "]"}]}], " ", "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "[", " ", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"pos", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"Last", "[", 
          RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}], " ", 
         "\[Equal]", " ", 
         RowBox[{"Last", "[", 
          RowBox[{"Dimensions", "[", "pos", "]"}], "]"}]}]}], " ", "]"}], ",",
       " ", 
      RowBox[{"Message", "[", " ", 
       RowBox[{"DisplaceVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], 
    ";", "\n", "\t", "coordinates"}], "\n", ")"}]}]}], "Code",
 CellLabel->
  "In[3542]:=",ExpressionUUID->"dc6fae3e-0250-465d-b252-f2807af8cf17"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaceVertices", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "moveSpec_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaceVertices", "[", "moveSpec", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplaceVertices", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "moveSpec_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"DisplaceVertices", "[", "moveSpec", "]"}], "[", "m", "]"}], ",",
     " ", "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3550]:=",ExpressionUUID->"e71eaeac-52c8-47a5-808b-97451c4d3a99"]
}, Closed]],

Cell[CellGroupData[{

Cell["Map[]", "Subsection",ExpressionUUID->"3ab5e732-329f-4489-88fd-99e349e91f19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Linkage", " ", "/:", " ", 
   RowBox[{"Map", "[", " ", 
    RowBox[{"f_", ",", " ", 
     RowBox[{"m", " ", ":", " ", 
      RowBox[{"Linkage", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", "  ", 
        "labels_"}], " ", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{"f", " ", "/@", " ", "coordinates"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Linkage", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", 
        RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"mapTestCoordinatesQ", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", "coordinates"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Origami", " ", "/:", " ", 
   RowBox[{"Map", "[", " ", 
    RowBox[{"f_", ",", " ", 
     RowBox[{"m", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labels_"}], " ", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{"f", " ", "/@", " ", "coordinates"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Origami", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", 
        RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"mapTestCoordinatesQ", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", "coordinates"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "match"}], " ", "=", 
   "\"\<New coordinates are not numeric and of the same dimension as old \
coordinates.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"mapTestCoordinatesQ", "[", " ", 
   RowBox[{"new_", ",", " ", "old_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"new", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "new", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Dimensions", "[", "old", "]"}]}]}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"Mechanism", "::", "match"}], "]"}], ";", " ", "False"}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "In[3552]:=",ExpressionUUID->"716f9373-6de2-4d61-b7b3-deac55ae485c"]
}, Closed]],

Cell[CellGroupData[{

Cell["MapCells[]", "Subsection",ExpressionUUID->"cb7c2df9-dda8-4d22-bcab-38d90211eab7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MapCells", "[", " ", "f_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", "_"}], "]"}]}], ",", "\n", 
      "\t", "newCells"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newCells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], " ", ",", " ", 
        RowBox[{"f", " ", "/@", " ", "cells"}]}], " ", "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"newCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"{", "}"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MapCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "f_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MapCells", "[", "f", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3556]:=",ExpressionUUID->"09b6a594-cbdf-4cab-a245-d13a757d3bde"]
}, Closed]],

Cell[CellGroupData[{

Cell["TesselateMechanism[]", "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "TesselateMechanism", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"OverlapPrecision", "\[Rule]", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "6"}], ")"}]}]}], "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[3558]:=",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "counter"}], "=", 
   "\"\<Number of cells must be positive integers corresponding to the number \
of basis elements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "dim"}], "=", 
   "\"\<Basis must be `1` dimensional to match Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "num"}], "=", 
   "\"\<Basis must be numerical with vectors of the same dimension.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TesselateMechanism", "::", "basis"}], "=", 
    "\"\<Basis must be a list of `1` numerical vectors.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tesselationBasisQ", "[", " ", 
    RowBox[{"m_", ",", " ", "d_", ",", " ", "basis_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"MatrixQ", "[", 
       RowBox[{"basis", ",", "NumericQ"}], "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"TesselateMechanism", "::", "num"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Length", "[", "basis", "]"}], " ", "\[NotEqual]", " ", "d"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"TesselateMechanism", "::", "basis"}], ",", " ", "d"}], " ", 
       "]"}], ";", " ", "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"Dimensions", "[", "basis", "]"}], "]"}], " ", "\[NotEqual]", 
      " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"TesselateMechanism", "::", "dim"}], ",", " ", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], " ", "]"}], 
      ";", " ", "False"}], ",", "\n", "\t", "True", ",", " ", "True"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", 
   RowBox[{"n1__Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", "__", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"TesselateMechanism", "::", "counter"}], "]"}], ";", " ", 
    "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[3559]:=",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"translateLabels", "[", " ", 
   RowBox[{"n_", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"translateLabels", "[", 
    RowBox[{"n_", ",", " ", 
     RowBox[{"ruleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Rule", "[", " ", 
         RowBox[{"_", ",", " ", "_"}], " ", "]"}], ".."}], "}"}]}]}], " ", 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"labels", ",", " ", "indices"}], "}"}], " ", ",", "  ", "\n", 
     "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"labels", ",", " ", "indices"}], "}"}], " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "ruleList"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"Rule", " ", "@@@", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Through", "[", " ", 
           RowBox[{"labels", "[", "n", "]"}], " ", "]"}], " ", ",", " ", 
          "indices"}], " ", "}"}], " ", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"translateCoordinates", "[", " ", 
   RowBox[{"positions_", ",", " ", "translationVector_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"positions", " ", "+", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"translationVector", ",", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3566]:=",ExpressionUUID->"721a18ca-3636-47ac-8ec2-4481f8e47919"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"n1", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Range", "[", "n1", "]"}]}], ",", " ", "\n", "\t", 
       "newCoordinates", ",", " ", "translatedMechanisms"}], "\n", "}"}], ",",
      "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"basis", " ", "#"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
        "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", " ", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], " ", "]"}], 
          "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "1", ",", " ", 
      RowBox[{"{", "basis", "}"}]}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "1"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3569]:=",ExpressionUUID->"52292cab-859e-4526-ad11-c2375d158cee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"n1_", ",", " ", "n2_"}], "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
       ",", "\n", "\t", "newCoordinates", ",", " ", "translatedMechanisms"}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"#", " ", ".", " ", "basis"}]}], " ", "]"}], "&"}], " ", "/@",
         " ", "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "]"}], "&"}], 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "2", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3570]:=",ExpressionUUID->"d24fd5c7-bb15-4547-9025-38b6386831cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"n1_", ",", " ", "n2_", ",", " ", "n3_"}], "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2", ",", "#3"}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}]}], "]"}], ",", "2"}],
          "]"}]}], ",", "\n", "\t", "newCoordinates", ",", " ", 
       "translatedMechanisms"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"#", " ", ".", " ", "basis"}]}], " ", "]"}], "&"}], " ", "/@",
         " ", "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "]"}], "&"}], 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "3", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2", ",", "n3"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3571]:=",ExpressionUUID->"2cf05f30-ea55-4528-b268-4f693ccc6344"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReplaceAll[]", "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceElement", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", "mechanismPattern"}], ",", " ", "rule_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Head", "[", "f", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ReplaceAll", "[", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "rule"}], "]"}], " ", ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
     RowBox[{"replaceCellData", "[", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", " ", "rule"}], " ", "]"}], ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "rule_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"replaceElement", "[", " ", 
   RowBox[{"f", ",", " ", "rule"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "rule_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"replaceElement", "[", 
   RowBox[{"o", ",", " ", "rule"}], "]"}]}]}], "Code",
 CellLabel->
  "In[3572]:=",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Closed]],

Cell[CellGroupData[{

Cell["Precision[], Rationalize[], N[]", "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Precision", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"f", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Precision", "[", " ", "o_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"o", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3575]:=",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"Rationalize", "[", " ", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"Rationalize", "[", " ", 
       RowBox[{
        RowBox[{"o", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3577]:=",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"N", "[", " ", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"N", "[", " ", 
       RowBox[{
        RowBox[{"o", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3579]:=",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["More sophisticated manipulations", "Section",ExpressionUUID->"8a6930c3-0554-4d2c-8310-f85820c57ead"],

Cell[CellGroupData[{

Cell["SubdivideCells[]", "Subsection",ExpressionUUID->"807f5525-dcf2-4be3-a3d6-f662db4b35c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SubdivideCells", "[", " ", 
     RowBox[{
      RowBox[{"indices_", "?", "VectorQ"}], " ", ",", " ", 
      RowBox[{"label_", " ", ":", " ", 
       RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tmp", " ", "=", " ", 
       RowBox[{
        RowBox[{"SubdivideCells", "[", " ", 
         RowBox[{
          RowBox[{"{", "indices", "}"}], ",", "label"}], "]"}], "[", "m", 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "tmp", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"tmp", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"tmp", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"tmp", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
       RowBox[{"replaceRules", "[", " ", 
        RowBox[{
         RowBox[{"tmp", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"label", "[", "indices", "]"}], " ", "\[Rule]", " ", 
           "label"}], "}"}]}], "]"}]}], " ", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SubdivideCells", "[", " ", 
     RowBox[{
      RowBox[{"indices", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"_", ",", "__"}], "}"}], "..."}], "}"}]}], " ", ",", " ", 
      RowBox[{"label_", " ", ":", " ", 
       RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"MechanismCellList", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"{", 
          RowBox[{"_", " ", ",", " ", "indices"}], "}"}], " ", ",", " ", 
         "_"}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"AddCells", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"SubdivideCellsInternal", "[", " ", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#", " ", ",", " ", 
           "label"}], "]"}], " ", "&"}], " ", "/@", " ", "cells"}], " ", 
       "]"}], " ", "@", " ", 
      RowBox[{
       RowBox[{"DeleteCells", "[", " ", 
        RowBox[{"deletedCells", "[", 
         RowBox[{"cells", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], " ", "]"}], " ", 
       "@", " ", "m"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"deletedCells", "[", " ", "cells_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{"patternTheCells", " ", "/@", " ", "cells"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"patternTheCells", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", "__"}], "}"}], ".."}], "}"}]}], " ", "]"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"head", " ", "/@", " ", "indices"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"patternTheCells", "[", " ", 
    RowBox[{"fine", " ", ":", " ", 
     RowBox[{"_", "[", " ", 
      RowBox[{"{", 
       RowBox[{"_", ",", "__"}], "}"}], " ", "]"}]}], " ", "]"}], " ", ":=", 
   " ", "fine"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SubdivideCells", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "indices_", 
     ",", " ", 
     RowBox[{"label_", " ", ":", " ", 
      RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"addMeshRegion", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"SubdivideCells", "[", 
       RowBox[{"indices", ",", " ", "label"}], "]"}], "[", "m", "]"}], ",", 
     " ", "Automatic", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SubdivideCellsInternal", "[", " ", 
    RowBox[{"coordinates_", " ", ",", " ", 
     RowBox[{"Rule", "[", " ", 
      RowBox[{
       RowBox[{"head_", "[", 
        RowBox[{"indices", " ", ":", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_", ",", "_"}], "}"}], "..."}], "}"}]}], " ", "]"}], ",",
        " ", "data_"}], " ", "]"}], " ", ",", " ", "label_"}], "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"newVertices", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "indices", "]"}], ">", "1"}], ",", 
          RowBox[{"label", "/@", "indices"}], ",", 
          RowBox[{"{", "label", "}"}]}], "]"}]}], ",", " ", 
       RowBox[{"newVertexCoordinates", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Mean", "[", 
           RowBox[{"coordinates", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
         "indices"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FreeJoint", "[", " ", 
           RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], " ", "]"}], "&"}], " ", 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{"newVertices", ",", " ", "newVertexCoordinates"}], "}"}]}], 
        " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{"new", " ", "edges"}], "*)"}], "\n", "\t\t", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"head", "[", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "#2"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"#2", ",", " ", 
                RowBox[{"#1", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}], ",", " ", 
            "#3"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", " ", 
          RowBox[{"indices", ",", " ", "newVertices", ",", " ", "data"}], " ",
           "}"}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"SubdivideCellsInternal", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"Rule", "[", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", 
       RowBox[{"indices", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"_", ",", "_", ",", "__"}], "}"}], "..."}], "}"}]}], " ", 
       "]"}], ",", " ", "data_"}], " ", "]"}], " ", ",", " ", "label_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"newVertices", " ", "=", " ", 
       RowBox[{"label", "/@", "indices"}]}], ",", " ", 
      RowBox[{"newVertexCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Mean", "[", " ", 
          RowBox[{"coordinates", "[", 
           RowBox[{"[", "#", "]"}], "]"}], " ", "]"}], "&"}], "/@", 
        "indices"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeJoint", "[", " ", 
          RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], " ", "]"}], "&"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"newVertices", ",", " ", "newVertexCoordinates"}], "}"}]}], 
       " ", "]"}], ",", "\n", "\t\t", 
      RowBox[{"(*", 
       RowBox[{"new", " ", "Faces"}], "*)"}], "\n", "\t\t", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"head", "[", " ", 
          RowBox[{
           RowBox[{"splitFace", "[", " ", 
            RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], " ", ",", " ", "#3"}],
           "]"}], "&"}], "  ", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
         "indices", " ", ",", " ", "newVertices", " ", ",", " ", "data"}], 
         " ", "}"}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"splitFace", "[", " ", 
   RowBox[{"indices_", " ", ",", " ", "newVertex_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newVertex", ",", " ", 
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", "&"}], " ", "/@", 
   " ", 
   RowBox[{"Partition", "[", " ", 
    RowBox[{"indices", " ", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3581]:=",ExpressionUUID->"ce76c6e6-607c-4339-bc44-5002db5363e0"]
}, Closed]],

Cell[CellGroupData[{

Cell["DivideFaces[]", "Subsection",ExpressionUUID->"1c9d14aa-e4fa-43c7-a463-0fb0f975c854"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{"edge", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", "_"}], "}"}]}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{"{", "edge", "}"}], " ", "]"}], "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{"edgeList_", "?", "MatrixQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", "Face"}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"FacelessM", " ", "=", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", "_Face", "]"}], " ", "@", " ", "m"}]}], 
      ",", "\n", "\t", "newCells"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newCells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"Fold", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"cutFace", "[", "#2", "]"}], " ", "/@", " ", "#1"}], 
            ")"}], " ", "&"}], ",", " ", "cells", ",", " ", 
          RowBox[{"edgeList", " ", "/.", " ", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "]"}]}], " ", "]"}]}], 
     ";", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"newCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"{", "}"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"addMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"DivideFaces", "[", "edgeList", "]"}], "[", "m", "]"}], ",", 
     " ", "Automatic", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", 
    RowBox[{"{", 
     RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], "[", 
   RowBox[{"Face", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a___", ",", "v1_", ",", "b__", ",", "v2_", ",", "c___"}], 
      "}"}], ",", " ", "prop_"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "b", ",", "v2"}], "}"}], ",", "prop"}], "]"}], ",", 
    
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v2", ",", "c", ",", "a", ",", "v1"}], "}"}], ",", "prop"}], 
     "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", 
    RowBox[{"{", 
     RowBox[{"v2_", ",", "v1_"}], "}"}], "]"}], "[", 
   RowBox[{"Face", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a___", ",", "v1_", ",", "b__", ",", "v2_", ",", "c___"}], 
      "}"}], ",", " ", "prop_"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "b", ",", "v2"}], "}"}], ",", "prop"}], "]"}], ",", 
    
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v2", ",", "c", ",", "a", ",", "v1"}], "}"}], ",", "prop"}], 
     "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", "_", " ", "]"}], "[", "f_", "]"}], " ", ":=", 
  " ", "f"}]}], "Code",
 CellLabel->
  "In[3590]:=",ExpressionUUID->"88781786-7762-436e-88e7-32ea57b8a248"]
}, Closed]],

Cell[CellGroupData[{

Cell["TriangulateFaces[]", "Subsection",ExpressionUUID->"d8651388-086c-4e91-8a1b-4321d177cd65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TriangulateFaces", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", "Face"}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"newm", " ", "=", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", "_Face", " ", "]"}], " ", "@", " ", 
        "m"}]}], ",", "\n", "\t", 
      RowBox[{"coordinates", " ", "=", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", "\n", "\t", "newcells"}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newcells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"newm", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"newm", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"newm", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"decomposeFace", "[", " ", 
           RowBox[{"coordinates", ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@",
          " ", "cells"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", 
        RowBox[{
         RowBox[{"newcells", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"newcells", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
         RowBox[{"newcells", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", " ", "Automatic", ",",
        " ", 
       RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3596]:=",ExpressionUUID->"c265f046-0659-4ba0-a446-8dd92026215b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"decomposeFace", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], ",", " ", "prop_"}], 
     "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Face", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", "prop"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"decomposeFace", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"Face", "[", " ", 
     RowBox[{"i_", " ", ",", " ", "prop_"}], "]"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"diag", " ", "=", " ", 
      RowBox[{"findShortestDiagonal", "[", " ", 
       RowBox[{"coordinates", ",", " ", "i"}], " ", "]"}]}], "}"}], ",", "\n",
     "\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TorsionalFold", "[", "diag", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"decomposeFace", "[", " ", 
         RowBox[{"coordinates", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ", 
       "/@", " ", 
       RowBox[{
        RowBox[{"cutFace", "[", "diag", "]"}], "[", 
        RowBox[{"Face", "[", 
         RowBox[{"i", ",", " ", "prop"}], "]"}], "]"}]}]}], "}"}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"decomposeFace", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "other_"}], " ", "]"}], " ", ":=", " ", 
   "other"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"findShortestDiagonal", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"diagonals", " ", "=", " ", 
      RowBox[{"polygonDiagonals", "[", " ", "vertices", " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"MinimalBy", "[", " ", 
      RowBox[{
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{"diagonals", " ", ",", " ", 
          RowBox[{"Mechanisms`geometry`DisplacementLength", "[", " ", 
           RowBox[{"coordinates", ",", " ", "diagonals"}], " ", "]"}]}], " ", 
         "}"}], " ", "]"}], " ", ",", " ", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"Last", "[", "#", "]"}], "]"}], "&"}]}], " ", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"polygonDiagonals", "[", " ", "vertices_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"guesses", " ", "=", " ", 
       RowBox[{"Tuples", "[", " ", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", "2"}], 
        " ", "]"}]}], ",", " ", 
      RowBox[{"l", " ", "=", " ", 
       RowBox[{"Length", "[", "vertices", "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", " ", 
     RowBox[{
      RowBox[{"Map", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"vertices", "[", 
          RowBox[{"[", "#", "]"}], "]"}], "&"}], ",", " ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{"guesses", ",", " ", 
          RowBox[{
           RowBox[{"Between", "[", " ", 
            RowBox[{
             RowBox[{"Abs", "[", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "  ", 
             RowBox[{"{", 
              RowBox[{"2", ",", " ", 
               RowBox[{
                RowBox[{"Length", "[", "vertices", "]"}], "-", "2"}]}], 
              "}"}]}], " ", "]"}], " ", "&"}]}], " ", "]"}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], " ", "]"}], ",", " ", "Sort"}], "]"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3597]:=",ExpressionUUID->"b0c5ca40-ee5c-4e8e-a2be-e6c19ab5e11f"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[3602]:=",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms`geometry: extracting mechanism geometry", "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[3604]:=",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],

Cell[CellGroupData[{

Cell["code snippet to check for C compiler", "Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
    RowBox[{
    "A", " ", "snippet", " ", "of", " ", "code", " ", "to", " ", "test", " ", 
     "or", " ", "a", " ", "working", " ", "C", " ", "compiler"}], ",", " ", 
    RowBox[{
     RowBox[{"modified", " ", "from", "\n", "\t", 
      RowBox[{"https", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
         "questions"}], "/", "39837"}], "/", "check"}], "-", "whether", "-", 
      "a", "-", "working", "-", "ccompiler", "-", "is", "-", 
      "installed"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Quiet", "[", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", "0", ",", " ", 
             RowBox[{"CompilationTarget", " ", "->", " ", "\"\<C\>\""}]}], 
            "]"}], "[", "]"}], " ", "==", " ", "0"}], "]"}], ",", " ", 
        "False"}], "]"}], "]"}], ",", "\n", "  ", 
     RowBox[{"$MechanismCompilationTarget", " ", "=", " ", "\"\<C\>\""}], ",",
      "\n", "  ", 
     RowBox[{"$MechanismCompilationTarget", " ", "=", " ", "\"\<MVM\>\""}]}], 
    "\n", "]"}], ";"}]}]], "Code",
 CellLabel->
  "In[3605]:=",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"$MechanismCompilationTarget", "::", "usage"}], " ", "=", " ", 
   "\"\<Returns \\\"C\\\" if a C compiler was detected.\>\""}], ";"}]], "Code",\

 CellLabel->
  "In[3606]:=",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Infinitesimal", "::", "usage"}], "=", 
   "\"\<Infinitesimal[ name, order ] represents an Infinitesimal of name and \
at a particular order.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[3607]:=",ExpressionUUID->"dbb93444-1867-4df8-88d7-4358e4ecd562"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementRules", "::", "usage"}], " ", "=", " ", 
    "\"\<DisplacementRules[displacements] returns a list of rules to assign \
vertex displacements to their values.\nDisplacementRules[ {positions1, ...} ] \
returns a list of rules for each set of positions. The mechanism positions \
must be compatible.\nDisplacementRules[ periodic data ] returns displacement \
rules from a periodic mechanism data structure.\nDisplacementRules[ periodic \
data, {k1, ...} ] returns displacement rules from a periodic mechanism with a \
different set of reciprocal wave vectors {k1, ...}.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PositionRules", "::", "usage"}], " ", "=", " ", 
    "\"\<PositionRules[ m ] returns rules setting the positions of mechanism \
m.\nPositionRules[ positions ] returns a list of rules assigning vertex \
positions to their values.\nPositionRules[ {positions1, ...} ] returns a list \
of rules for each set of positions. The mechanism positions must be \
compatible.\nPositionRules[ periodic data ] returns position rules from a \
periodic mechanism data structure.\nPositionRules[ periodic data, lattice \
vectors ] returns position rules from a periodic mechanism with a different \
set of lattice vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PositionConstraints", "::", "usage"}], "=", 
    "\"\<PositionConstraints[ periodic data, lattice vectors ] returns a set \
of constraints associated with periodic data provided given lattice \
vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrthogonalizeDisplacements", "::", "usage"}], "=", "\n", 
    "\"\<OrthogonalizeDisplacements[ {displacement1, ...}, (tolerance) ] \
returns an orthogonalized set of vertex displacements using optional \
tolerance.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomDisplacements", "::", "usage"}], "=", 
    "\"\<RandomDisplacements[ m, (n) ] returns n random displacements of a \
Mechanism m.\nRandomDisplacements[ positions, (n) ] returns n random \
displacements starting from positions.\nn defaults to 1 if it is \
omitted.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomPositions", "::", "usage"}], "=", 
    "\"\<RandomPositions[ m, (n) ] returns n positions that have been \
randomly displaced.\nRandomPositions[ positions, n ] returns n random \
displacements starting from positions.\nn defaults to 1 if it is omitted.\n\n\
(see also: RandomDisplacements[])\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<VertexCoordinatesQ[ m, pos ] returns True if pos are valid \
coordinates for Mechanism m.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexCoordinateListQ", "::", "usage"}], "=", " ", 
   "\"\<VertexCoordinateListQ[ m, pos ] returns True if pos are a list of \
valid positions for Mechanism m.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NumericCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<NumericCoordinatesQ[ m, pos ] returns True if pos are valid numerical \
coordinates for Mechanism m.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NumericMachinePrecisionCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<NumericMachinePrecisionCoordinatesQ[ m, pos ] returns True if pos are \
valid numerical, machine precision coordinates for Mechanism m.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3608]:=",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "::", "usage"}], " ", "=", " ", 
   "\"\<MechanismConnectivity[ m, s1 -> s2 ] returns a list of type s2 for \
each s1. Use MechanismConnectivity[\\\"Methods\\\"] to possible values for s1 \
or s2.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismOrientedQ", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismOrientedQ[ m ] returns True if all Faces in a Mechanism are \
oriented with their neighbors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryVertices", "::", "usage"}], "=", 
   "\"\<BoundaryVertices[ Mechanism ] returns a list of oriented boundary \
vertices { component 1, ...} where each boundary component is a list of \
vertex indices. A boundary is defined as the boundary of a set of 2D Faces.\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryEdges", "::", "usage"}], "=", 
   "\"\<BoundaryEdges[ Mechanism ] returns a list of oriented boundary edges \
{{v11, v12},{v21,v22},...}. A boundary is defined as the boundary of a set of \
2D Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryFaces", "::", "usage"}], "=", 
   "\"\<BoundaryFaces[ Mechanism ] returns a list of oriented boundary \
components {Face 1, Face 2, ...}, ...}. A boundary is defined as the boundary \
of a set of 2D Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InteriorVertices", "::", "usage"}], "=", 
   "\"\<InteriorVertices[ Mechanism ] returns a list of interior \
vertices.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InteriorEdges", "::", "usage"}], "=", 
    "\"\<InteriorEdges[ Mechanism ] returns a list of interior edges.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", "::", "usage"}], "=", "\n", 
    "\"\<MechanismDisplayDimension[ m ] returns the display dimension of a \
Mechanism m.\nMechanismDisplayDimension[ d ][ m ], \
MechanismDisplayDimension[m -> d] changes the display dimension of a \
Mechanism m to d.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "::", "usage"}], "=", "\n", 
    "\"\<MechanismEmbeddingDimension[ m ] returns the embedding dimension of \
a Mechanism m.\nMechanismEmbeddingDimension[ d ][ m ], \
MechanismEmbeddingDimension[m -> d] changes the embedding dimension of a \
Mechanism m to d.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDeleteDanglingVertices", "::", "usage"}], "=", 
    "\"\<MechanismDeleteDanglingVertices[\!\(\*StyleBox[\\\"m\\\",FontSlant->\
\\\"Italic\\\"]\)\!\(\*StyleBox[\\\",\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*\
StyleBox[\\\"type\\\",FontSlant->\\\"Italic\\\"]\)] deletes all vertices of \
\!\(\*StyleBox[\\\"m\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)not adjacent to a cell of a specific type, \
either \\\"Faces\\\" or \\\"edges\\\".\nIf omitted, the argument \
\!\(\*StyleBox[\\\"type\\\",FontSlant->\\\"Italic\\\"]\) defaults to \
\\\"Faces\\\" for Origami or \\\"edges\\\" for Linkages. See: \
DeleteVertices[]\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToFOLD", "::", "usage"}], "=", 
   "\"\<SaveToFOLD[\!\(\*StyleBox[\\\"Mechanism\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"filename\\\",FontSlant->\\\"Italic\\\"]\)] saves a \
FOLD file from a Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LoadFromFOLD", "::", "usage"}], "=", "\n", 
   "\"\<LoadFromFOLD[\!\(\*StyleBox[\\\"filename\\\",FontSlant->\\\"Italic\\\"\
]\)] loads a Mechanism from a FOLD. Use option \\\"Face\\\" to choose how to \
treat a polygon.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3618]:=",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentification", "::", "usage"}], "=", "\n", 
    "\"\<PeriodicIdentification[m, {f1 -> func1,..} ] applies transformation \
functions func1, func2, ... and creates a list of vertices identified via \
those transformations.\nPeriodicIdentification[m, {z1,z2,...}, {vector1, \
vector2, ...}] identifies vertices under translation vectors {vector1, \
vector2,...} and returns rules identifying VertexDisplacement objects up to \
corresponding factors of {z1, z2,...}.\nPeriodicIdentification[m, {vector1, \
vector2, ...}] identifies vertices under translation vectors {vector1, \
vector2,...} and returns rules identifying VertexDisplacement objects.\>\""}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "::", "usage"}], "=", 
   "\"\<PeriodicIdentificationData is a structure for periodic \
Mechanisms.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationDataQ", "::", "usage"}], "=", 
    "\"\<PeriodicIdentificationDataQ[ pi ] returns True if pi is a \
PeriodicIdentificationData structure.\nPeriodicIdentificationDataQ[ m, pi ] \
returns True if pi is a PeriodicIdentificationData structure that can \
correspond to Mechanism m.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismUnitCell", "::", "usage"}], "=", "\n", 
    "\"\<MechanismUnitCell[m, {vector1, vector2, ...}] reduces a Mechanism to \
the smallest unit cell that can be tesselated periodically according to the \
basis of vectors provided.\nIt relies on PeriodicIdentification[] but \
unfortunately renumbers vertices.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelPeriodicVertices", "::", "usage"}], "=", 
   "\"\<LabelPeriodicVertices[ m, periodic data, (style) ] labels a Mechanism \
consistent with its periodic data using a text style.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "In[3630]:=",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementVector", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementVector[ positions, edge ] returns the vector pointing \
along an oriented edge.\nDisplacementVector[ positions, { edge 1, edge 2, \
...} ] returns list of displacement vectors.\nEdges can be specified as \
Line[{v1,v2}] or {v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLength", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementLength[ positions, edge 1 ] returns the length of an \
edge.\nDisplacementLength[ positions, { edge 1, edge 2, ...} ] returns \
lengths of a list of edges.\nEdges can be specified as Line[{v1,v2}] or \
{v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLengthSquared", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementLengthSquared[ positions, edge 1 ] returns the squared \
length of an edge.\nDisplacementLengthSquared[ positions, { edge 1, edge 2, \
...} ] returns squared lengths of a list of edges.\nEdges can be specified as \
Line[{v1,v2}] or {v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vectorAngle", "::", "usage"}], "=", "\n", 
    "\"\<vectorAngle[ positions, {vertex 1, vertex 2, vertex 3}] returns the \
angle at vertex 2 spanned by the other two points.\nvectorAngle[ positions, { \
triple 1, triple 2, ...} ] returns the vertex angles anong a list of vertex \
triples.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TurningAngle", "::", "usage"}], "=", "\n", 
    "\"\<TurningAngle[ positions, {vertex 1, vertex 2, vertex 3}] returns the \
turning angle at vertex 2 spanned by the other two points.\nTurningAngle[ \
positions, { triple 1, triple 2, ...} ] returns the turning angles anong a \
list of vertex triples.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NormalVector", "::", "usage"}], "=", "\n", 
    "\"\<NormalVector[ positions, {vertex 1, vertex 2, vertex 3} ] returns \
the vector normal to the plane spanned by the three points.\nNormalVector[ \
positions, { triple 1, triple 2, ...} ] returns vectors normal to the plane \
spanned by the list of triples.\nNormalVector[ positions, polygon ] returns \
the vector normal to a polygon.\nNormalVector[ positions, {polygon 1, polygon \
2, ...} ] returns the vectors normal to a list of polygons.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceArea", "::", "usage"}], "=", "\n", 
    "\"\<FaceArea[ positions, {vertex 1, vertex 2, vertex 3} ] returns the \
area of the Face spanned by the three points.\nFaceArea[ positions, { triple \
1, triple 2, ...} ] returns the area of the Face spanned by the list of \
triples.\nFaceArea[ positions, polygon ] returns area of a polygon.\n\
FaceArea[ positions, {polygon 1, polygon 2, ...} ] returns the areas of a \
list of polygons.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaneAngle", "::", "usage"}], "=", "\n", 
    "\"\<PlaneAngle[positions, {v1, v2, v3}] returns the oriented angle at \
vertex v2 spanned by the other two vertices.\nPlaneAngle[positions, {triple \
1, triple 2, ...}] returns the oriented angles at for each triple of \
verticles.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "::", "usage"}], "=", "\n", 
    "\"\<TorsionalFoldAngle[ Mechanism, positions, edge ] returns the \
TorsionalFold angle along an edge.\nTorsionalFoldAngle[ Mechanism, \
positions,{edge 1, edge 2,...} ] returns the TorsionalFold angle of a list of \
edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DiscreteGaussianCurvature", "::", "usage"}], "=", "\n", 
    "\"\<DiscreteGaussianCurvature[ Mechanism, positions,vertex ] returns the \
discrete Gaussian curvature of vertex.\nDiscreteGaussianCurvature[ Mechanism, \
positions,{vertex 1, vertex 2, ...} ] returns the discrete Gaussian curvature \
of a list of vertices.\nDiscreteGaussianCurvature[ Mechanism, metric,{vertex \
1, vertex 2, ...} uses a metric to explicitly compute the Gaussian curvature \
at each vertex.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AlignMechanism", "::", "usage"}], "=", 
    "\"\<AlignMechanism[ m1Spec, m2Spec ] returns a list of positions that \
best align the second Mechanism to the first.\nm1Spec and m2Spec can be \
either be a Mechanism, a list of positions, { Mechanism, vertices }, or \
{positions, vertices}.\nIf vertices are included, only the specified vertices \
will be used to determine the transformation.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CongruentMechanismQ", "::", "usage"}], "=", 
   "\"\<CongruentMechanismQ[ tol_ ][ m1Spec, m2Spec ] returns True if the \
first and second mechsnisms are congruent up to a given tolerance.\nm1Spec \
and m2Spec can be either be a Mechanism, a list of positions, { Mechanism, \
vertices }, or {positions, vertices}.\nIf vertices are included, only the \
specified vertices will be used to determine the transformation.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3635]:=",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[3647]:=",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"],

Cell[CellGroupData[{

Cell["reportError[], checkForError[]", "Subsubsection",ExpressionUUID->"ed34d4f5-8774-4cc3-bed1-932ddba5c4e5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"reportError", "[", " ", 
    RowBox[{"msgHead_", ",", " ", "msgName_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"ToExpression", "[", 
    RowBox[{
    "\"\<Message[\>\"", "<>", "msgHead", "<>", "\"\<::\>\"", "<>", "msgName", 
     "<>", "\"\<]\>\""}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"reportError", "[", " ", 
   RowBox[{"msgHead_", ",", " ", "msgName_", ",", " ", "arguments__"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"args", " ", "=", " ", 
      RowBox[{"StringJoin", "@@", 
       RowBox[{"(", 
        RowBox[{"ToString", "/@", 
         RowBox[{"{", "arguments", "}"}]}], ")"}]}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"ToExpression", "[", 
     RowBox[{
     "\"\<Message[\>\"", "<>", "msgHead", "<>", "\"\<::\>\"", "<>", "msgName",
       "<>", "\"\<,\>\"", "<>", "args", "<>", "\"\<]\>\""}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3649]:=",ExpressionUUID->"2f231e99-d644-4c44-a094-43842e8b7f0d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"checkForError", "[", " ", 
   RowBox[{"test_", " ", ",", " ", "name_String", ",", " ", "error__"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"TrueQ", "[", "test", "]"}], " ", ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"reportError", "[", 
      RowBox[{"name", ",", " ", 
       RowBox[{"Evaluate", "[", "error", "]"}]}], " ", "]"}], ";", " ", 
     "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"checkForError", ",", " ", "HoldRest"}], " ", "]"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3651]:=",ExpressionUUID->"401605a1-d130-461c-8461-7baf9010c1df"]
}, Closed]],

Cell[CellGroupData[{

Cell["listParameters[],expandExpression[]", "Subsubsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listParameters", "[", "expr_", "]"}], ":=", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Extract", "[", 
       RowBox[{"expr", ",", "#"}], "]"}], "&"}], ")"}], "/@", 
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"List", "@@", "expr"}], ",", 
      RowBox[{"Infinitesimal", "[", 
       RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[3653]:=",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"This", " ", "basically", " ", "does", " ", "what", " ", 
    RowBox[{"Series", "[", "]"}], " ", "does", " ", "in", " ", "a", " ", 
    "somewhat", " ", "dumber", " ", 
    RowBox[{"way", ".", "\n", "\t", "It"}], " ", 
    RowBox[{"won", "'"}], "t", " ", "handle", " ", "limits", " ", "as", " ", 
    "nicely", " ", "as", " ", 
    RowBox[{"Series", "[", "]"}], " ", "but", " ", "it", " ", "typically", 
    " ", "presents", " ", "results", " ", "that", " ", "look", "\n", "\t", 
    "more", " ", "useful", " ", "for", " ", "analytic", " ", 
    RowBox[{"expressions", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", ",", "param_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "tmp"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"tmp", "@@", "param"}], ")"}], "^", "i"}], " ", 
            RowBox[{
             RowBox[{"D", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"{", 
                RowBox[{"param", ",", "i"}], "}"}]}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{"i", "!"}], ")"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"param", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "/.", 
         RowBox[{"param", "->", "0"}]}], "]"}], "/.", 
       RowBox[{"tmp", "->", "Infinitesimal"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", "?", "NumericQ"}], "]"}], ":=", "expr"}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", "expr_", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"params", "=", 
        RowBox[{"listParameters", "[", "expr", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"Fold", "[", 
       RowBox[{"expandExpression", ",", "expr", ",", 
        RowBox[{"Reverse", "@", "params"}]}], "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3654]:=",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseDisplacementRules[]", "Subsubsection",ExpressionUUID->"c0ea7bca-8a00-4f7c-b8e4-4b08c4e1cc6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementParsingRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{
         RowBox[{"x", " ", ":", " ", 
          RowBox[{"{", "__VertexDisplacement", "}"}]}], " ", ",", " ", 
         RowBox[{"y", " ", ":", " ", 
          RowBox[{"Except", "[", "_List", "]"}]}]}], "]"}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Rule", "[", 
         RowBox[{
          RowBox[{"x", " ", ":", " ", 
           RowBox[{"{", "__VertexDisplacement", "}"}]}], " ", ",", " ", 
          "y_List"}], "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Length", "[", "x", "]"}], "==", 
         RowBox[{"Length", "[", "y", "]"}]}]}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Rule", "[", " ", 
         RowBox[{
          RowBox[{"x_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatrixQ", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", 
                 "VertexDisplacement"}], "&"}]}], "]"}], "&"}], ")"}]}], ",", 
          " ", "y_List"}], " ", "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Length", "[", "x", "]"}], "==", 
         RowBox[{"Length", "[", "y", "]"}]}]}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Rule", "[", " ", 
        RowBox[{
         RowBox[{"x_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"MatrixQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], "===", 
                "VertexDisplacement"}], "&"}]}], "]"}], "&"}], ")"}]}], ",", 
         " ", 
         RowBox[{"y", " ", ":", " ", 
          RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}], " ", ":>", 
       " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"pi_PeriodicIdentificationData", " ", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"pi", "[", "\"\<DisplacementRules\>\"", "]"}], " ", "/.", 
         " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], "->", "1"}], "]"}]}], 
        ")"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseDisplacementRules", "[", " ", 
   RowBox[{"x_", " ", ",", " ", "err_"}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"processedRules", "=", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{
         RowBox[{"{", "x", "}"}], " ", "//.", " ", 
         "displacementParsingRules"}], " ", "]"}]}], ",", " ", "badQ"}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"badQ", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{"processedRules", ",", " ", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", 
          RowBox[{"_Integer", ",", "_String"}], "]"}], " ", "->", " ", 
         RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "badQ", "]"}], " ", ">", " ", "0"}], ",", " ", 
       "\n", "\t\t", 
       RowBox[{
        RowBox[{"Evaluate", "[", "err", "]"}], ";", " ", 
        RowBox[{"{", "}"}]}], " ", ",", " ", "\n", "\t\t", "processedRules"}],
       "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"parseDisplacementRules", ",", "HoldRest"}], "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[3657]:=",ExpressionUUID->"064a5971-9036-4497-b86b-36c54839b48c"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["topology", "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],

Cell[CellGroupData[{

Cell["MechanismConnectivity[]", "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],

Cell[CellGroupData[{

Cell["orderPairs[]", "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],

Cell["\<\
orderPairs[{{n1, n2}, {n3, n4}, ...}]
 When provided a list of pairs, {1, b}, sort them in order such that {{1, 2}, \
{2, 3}, {3, 4}, ...}
 
 orderPairs[list 1, list 2] orders pairs in which elements of each list are \
paired with
 the corresponding element.\
\>", "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orderPairs", "[", 
    RowBox[{"pairList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"Graph", "[", 
      RowBox[{"UndirectedEdge", "@@@", "pairList"}], "]"}], "]"}], "/;", " ", 
    
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pairList", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], "==", "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"pairList_", ",", "correspondingList_"}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{"association", "=", 
       RowBox[{"Dispatch", "@", 
        RowBox[{"Thread", "[", 
         RowBox[{"pairList", "->", "correspondingList"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"orderPairs", "[", "pairList", "]"}], "/.", "association"}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "pairList", "]"}], "==", 
    RowBox[{"Length", "[", "correspondingList", "]"}]}]}]}]}], "Code",
 CellLabel->
  "In[3660]:=",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "does", " ", "a", " ", "topological", " ", "sort", " ", "on", 
    " ", "a", " ", "graph"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"g_", "?", "AcyclicGraphQ"}], "]"}], ":=", 
    RowBox[{"Partition", "[", 
     RowBox[{
      RowBox[{"TopologicalSort", "[", 
       RowBox[{"DirectedEdge", "@@@", 
        RowBox[{"EdgeList", "[", "g", "]"}]}], "]"}], ",", "2", ",", "1"}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", "g_Graph", "]"}], ":=", 
    RowBox[{"List", "@@@", 
     RowBox[{"(", 
      RowBox[{"First", "@", 
       RowBox[{"FindCycle", "[", 
        RowBox[{"g", ",", "Infinity", ",", "1"}], "]"}]}], 
      ")"}]}]}]}]}]], "Code",
 CellLabel->
  "In[3663]:=",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],

Cell[CellGroupData[{

Cell["rotateTo[]", "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{"s_List", ",", "v_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"FirstPosition", "[", 
       RowBox[{"s", ",", "v"}], "]"}]}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MissingQ", "[", "pos", "]"}], ",", "s", ",", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"s", ",", 
        RowBox[{
         RowBox[{"pos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "]"}]}], "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{
    RowBox[{"h_", "[", "s_List", "]"}], ",", "v_"}], "]"}], ":=", 
  RowBox[{"h", "[", 
   RowBox[{"rotateTo", "[", 
    RowBox[{"s", ",", "v"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[3665]:=",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Closed]],

Cell[CellGroupData[{

Cell["orderFaces[]", "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"orderFaces", "[", 
   RowBox[{"FaceList_", ",", "v_Integer"}], "]"}], ":=", 
  RowBox[{"orderPairs", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"Last", "[", "#", "]"}]}], "}"}], "&"}], "/@", "FaceList"}], 
    ",", "FaceList"}], "]"}]}]], "Code",
 CellLabel->
  "In[3667]:=",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConnectivity[]", "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", "\"\<Methods\>\"", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\""}], "}"}],
      "->", 
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\"", ",", 
       "\"\<ordered faces\>\"", ",", "\"\<ordered edges\>\""}], "}"}]}], 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[3668]:=",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}]}], "Code",
 CellLabel->
  "In[3669]:=",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{"rotateThroughFaces", "[", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{"(*", "unpacks", "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"(*", "unpacks", "*)"}], "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", " ", 
              RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "]"}], " ", 
             "]"}], "}"}], "]"}], ",", " ", 
          RowBox[{"(*", 
           RowBox[{
           "make", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
            "in", " ", "order", " ", "of", " ", "the", " ", "form", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "1", "}"}], ",", 
              RowBox[{"{", "2", "}"}], ",", "..."}], "}"}]}], "*)"}], "\n", 
          "\t\t\t", "Faces"}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
        "First"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"rotateThroughFaces", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateThroughFaces", "[", "Faces_", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"NestList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"RotateLeft", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "Faces", ",", 
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"Dimensions", "[", "Faces", "]"}], "]"}], "-", "1"}]}], "]"}],
     ",", "1"}], "]"}]}]}], "Code",
 CellLabel->
  "In[3671]:=",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cells", "=", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"MechanismConnectivity", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}],
         " ", "]"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"Join", "[", 
           RowBox[{"cells", ",", 
            RowBox[{"{", 
             RowBox[{"cells", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", "1"}], "]"}], ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3674]:=",ExpressionUUID->"d4b93424-3000-4189-9724-831b1489b36f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "unpacks", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConnectivity", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ", 
     "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"edges", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}], ",", " ", 
        RowBox[{"Faces", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"GatherBy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"edges", ",", 
             RowBox[{"rotateCells", "[", "Faces", "]"}]}], "}"}], ",", "1"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], "&"}]}], "]"}], 
       "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "rotateCells", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{"\"\<Flatten\>\"", "->", "True"}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"rotateCells", "[", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sortedCells", "=", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"NestList", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"RotateLeft", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", 
             ",", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
           "&"}], "/@", "sortedCells"}], ",", "2"}], "]"}]}], "\n", "]"}], 
     " ", "/;", " ", 
     RowBox[{"OptionValue", "[", "\"\<Flatten\>\"", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"rotateCells", "[", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sortedCells", "=", 
        RowBox[{"GatherBy", "[", 
         RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"First", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", ",", 
           
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
         "&"}], "/@", "sortedCells"}], "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3675]:=",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], " ",
    "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edges", " ", "=", " ", 
      RowBox[{"MechanismConnectivity", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
       " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"edges", ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"edges", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], "}"}], ",", "1"}], "]"}], 
        ",", "First"}], "]"}], ",", "First"}], "]"}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "In[3679]:=",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}],
    " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"test1", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], ",", 
      "\n", 
      RowBox[{"edges", "=", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"ToPackedArray", "@", 
     RowBox[{"MapThread", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"{", 
               RowBox[{"__", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"test1", "[", 
              RowBox[{"[", 
               RowBox[{"edges", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"edges", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", "#2", ",", "__"}], "}"}]}], "]"}], "&"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"test1", "[", 
              RowBox[{"[", 
               RowBox[{"edges", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"edges", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "\n", 
        "\t\t", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3680]:=",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{"Unpacks", " ", 
    RowBox[{"lists", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{
     "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}], 
    "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"unorderedFace", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"MapThread", "[", 
      RowBox[{"orderFaces", ",", 
       RowBox[{"{", 
        RowBox[{"unorderedFace", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "unorderedFace", "]"}], "]"}]}], "}"}]}], 
      "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "In[3681]:=",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{
    "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered edges\>\""}]}], 
   "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", 
    RowBox[{"m", ",", 
     RowBox[{"\"\<vertices\>\"", "->", "\"\<ordered faces\>\""}]}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", 
     RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]], "Code",
 CellLabel->
  "In[3682]:=",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "::", "badcombo"}], "=", 
   "\"\<Methods are not recognized in this combination.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"Rule", "[", 
     RowBox[{"_", ",", "_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismConnectivity", "::", "badcombo"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3683]:=",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["BoundaryVertices[], BoundaryEdges[], BoundaryFaces[]", "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryEdges", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"FacePairs", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"edges", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}],
         "]"}]}], ",", "\n", "\t", "boundary"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"boundary", "=", 
      RowBox[{"Pick", "[", " ", 
       RowBox[{"edges", ",", " ", 
        RowBox[{"Length", " ", "/@", " ", "FacePairs"}], ",", " ", "1"}], " ",
        "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "boundary", "]"}], "==", "0"}], ",", "\n", 
       "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"List", "@@", "#"}], "&"}], ",", 
         RowBox[{"FindCycle", "[", 
          RowBox[{
           RowBox[{"Graph", "[", "boundary", "]"}], ",", "Infinity", ",", 
           "All"}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[3685]:=",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryVertices", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"First", "@@", "#"}], "&"}], " ", ",", " ", 
    RowBox[{"BoundaryEdges", "[", "m", "]"}], " ", ",", " ", 
    RowBox[{"{", "2", "}"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[3686]:=",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryFaces", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"boundary", " ", "=", " ", 
         RowBox[{"BoundaryVertices", "[", "m", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"Faces", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{"Table", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{"Faces", ",", " ", 
          RowBox[{
           RowBox[{"ContainsAny", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], " ",
          "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "boundary", "]"}]}], "}"}]}], "\n", "\t\t", 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3687]:=",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],

Cell[CellGroupData[{

Cell["InteriorEdges[], InteriorVertices[]", "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InteriorEdges", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"Pick", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"MechanismConnectivity", "[", " ", 
     RowBox[{"mr", ",", " ", 
      RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
     "]"}], ",", "\n", "\t\t", 
    RowBox[{"Length", " ", "/@", " ", 
     RowBox[{"MechanismConnectivity", "[", 
      RowBox[{"mr", ",", " ", 
       RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
      "]"}]}], ",", "\n", "\t\t", "2"}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "In[3688]:=",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InteriorVertices", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Complement", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"InteriorEdges", "[", "mr", "]"}], "]"}], " ", "]"}], ",", "\n",
     "\t", 
    RowBox[{"Flatten", " ", "@", " ", 
     RowBox[{"BoundaryVertices", "[", "mr", "]"}]}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "In[3689]:=",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismOrientedQ[]", "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismOrientedQ", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"AllTrue", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"MechanismConnectivity", "[", 
       RowBox[{"mr", ",", 
        RowBox[{"\"\<edges\>\"", "->", "\"\<faces\>\""}]}], "]"}], " ", ",", 
      " ", 
      RowBox[{"{", "_", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
    "facePairOrientedQ"}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismOrientedQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "In[3690]:=",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"{", 
    RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"v1_", ",", "v2_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3692]:=",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEmbeddingDimension[], MechanismDisplayDimension[]", \
"Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismEmbeddingDimension", "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], ":=", " ", 
  RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "[", " ", 
     RowBox[{"d", " ", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"oldPositions", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"1", " ", "\[Rule]", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"oldPositions", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "oldPositions", "]"}], ",", "d"}], "}"}]}],
          " ", "]"}]}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEmbeddingDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "[", " ", "d_", " ", "]"}], "[", 
    " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"MechanismEmbeddingDimension", "::", "dim"}], ",", " ", "d"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEmbeddingDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], "]"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismEmbeddingDimension", "[", "d", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3694]:=",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", "\"\<DisplayDimension\>\"", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", " ", "[", " ", 
     RowBox[{"d", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Mechanisms`Private`addMeshRegion", "[", 
        RowBox[{"m", ",", "d", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"MechanismQ", "[", "res", "]"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", "[", " ", "d_", " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"MechanismDisplayDimension", "::", "dim"}], ",", " ", "d"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismDisplayDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], " ", "]"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "[", "d", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3699]:=",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismDeleteDanglingVertices[]", "Subsection",ExpressionUUID->"2b820542-dab3-4d0b-9a97-bb3be4d7c4e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismDeleteDanglingVertices", "[", "m_Origami", "]"}], " ", ":=",
   " ", 
  RowBox[{"MechanismDeleteDanglingVertices", "[", 
   RowBox[{"m", ",", "\"\<faces\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismDeleteDanglingVertices", "[", "m_Linkage", "]"}], " ", ":=",
   " ", 
  RowBox[{"MechanismDeleteDanglingVertices", "[", 
   RowBox[{"m", ",", "\"\<edges\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDeleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"type", ":", " ", 
      RowBox[{"\"\<faces\>\"", "|", "\"\<edges\>\""}]}]}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"MechanismDeleteDanglingVertices", "[", 
    RowBox[{"m", ",", "type"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDeleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "\"\<faces\>\""}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"vertexSelector", "=", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}], ",", " ", 
          RowBox[{"Length", " ", "/@", " ", 
           RowBox[{"MechanismConnectivity", "[", 
            RowBox[{"m", ",", 
             RowBox[{"\"\<vertices\>\"", "\[Rule]", "\"\<faces\>\""}]}], 
            "]"}]}]}], "}"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteVertices", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"vertexSelector", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "<", "1"}], "&"}]}], "]"}], "[", 
        
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDeleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", "\"\<edges\>\""}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"vertexSelector", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"MechanismConnectivity", "[", 
           RowBox[{"m", ",", 
            RowBox[{"\"\<vertices\>\"", "\[Rule]", "\"\<edges\>\""}]}], "]"}],
           "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteVertices", "[", 
      RowBox[{"m", ",", "vertexSelector"}], "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDeleteDanglingVertices", "[", "type_", "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"MechanismDeleteDanglingVertices", "[", 
    RowBox[{"m", ",", " ", "type"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDeleteDanglingVertices", "::", "typ"}], "=", 
   "\"\<Second argument should be either \\\"Faces\\\" or \\\"edges\\\" to \
whether dangling vertices are indicated by a lack of Faces or lack of \
edges.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismDeleteDanglingVertices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", "_String"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismDeleteDanglingVertices", "::", "typ"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3704]:=",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
RegionDimension[], RegionEmbeddingDimension[], MeshCellCount[]\
\>", "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionEmbeddingDimension", "[", "o_Linkage", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"MechanismEmbeddingDimension", "[", "o", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionEmbeddingDimension", "[", "o_Origami", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"MechanismEmbeddingDimension", "[", "o", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionDimension", "[", "o_Linkage", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDimension", "[", " ", 
   RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionDimension", "[", "o_Origami", "]"}], " ", "^:=", " ", 
   RowBox[{"RegionDimension", "[", " ", 
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{"o_Linkage", ",", " ", "d___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "d"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "d___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "d"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3712]:=",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["vertex positions and displacements", "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],

Cell[CellGroupData[{

Cell["\<\
VertexCoordinatesQ[], NumericCoordinatesQ[], \
NumericMachinePrecisionCoordinatesQ[], VertexCoordinateListQ[]\
\>", "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VertexCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "}"}],
     ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3718]:=",ExpressionUUID->"363014a0-649a-4fa7-9e0b-27134679686f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VertexCoordinateListQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ArrayQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"ArrayDepth", "[", "coord", "]"}], "==", "3"}], " ", ",", " ", 
      
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "\[Equal]", "2"}], 
       " ", "||", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "\[Equal]", 
        "3"}]}]}], "}"}], ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexCoordinateListQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ArrayQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"ArrayDepth", "[", "coord", "]"}], "==", "3"}], " ", ",", " ", 
      
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3720]:=",ExpressionUUID->"972a811f-3d92-4ab4-91eb-dbcdea577d56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NumericCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", " ", "NumericQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "}"}],
     ",", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NumericCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", "NumericQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3722]:=",ExpressionUUID->"1bd477fd-b514-4438-88a5-1f619ede0e10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "NumericMachinePrecisionCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", " ", "MachineRealQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "}"}],
     ",", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NumericMachinePrecisionCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", "MachineRealQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[3724]:=",ExpressionUUID->"48138634-e03b-42d4-9ae9-f9f5ceaaf2e6"]
}, Closed]],

Cell[CellGroupData[{

Cell["OrthogonalizeDisplacements[]", "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", " ", 
   RowBox[{
    RowBox[{"displacements_", "?", "VertexCoordinateListQ"}], ",", " ", 
    RowBox[{"tol", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "8"}], ")"}]}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{
        RowBox[{"Dimensions", "[", "displacements", "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", " ", 
      RowBox[{"tolsq", " ", "=", " ", 
       RowBox[{"tol", "^", "2"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"Select", "[", " ", 
      RowBox[{
       RowBox[{"Orthogonalize", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", " ", "/@", " ", "displacements"}], ",", " ", 
         RowBox[{"Tolerance", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], ",",
        " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", ".", " ", "#"}], " ", ">", " ", "tolsq"}], " ", 
        "&"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3726]:=",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OrthogonalizeDisplacements", "::", "notdispl"}], "=", 
   "\"\<Not a list of valid vertex displacements of the same \
dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrthogonalizeDisplacements", "::", "tol"}], "=", 
    "\"\<Tolerance must be numeric.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "___"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"OrthogonalizeDisplacements", "::", "notdispl"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"OrthogonalizeDisplacements", "::", "tol"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3727]:=",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],

Cell[CellGroupData[{

Cell["VertexPosition[], VertexDisplacement[]", "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$coordinateSymbols", "[", "3", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$coordinateSymbols", "[", "2", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"All", "[", " ", "d_Integer", " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", "m_Integer"}], "]"}], " ", ":=", " ", 
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n", ",", " ", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"Range", "[", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"VertexPosition", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"All", "[", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexPosition", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"n", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"VertexPosition", "[", " ", 
    RowBox[{"n", ",", " ", 
     RowBox[{"All", "[", " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"All", "[", "d_Integer", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", "m_Integer"}], "]"}], ":=", 
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n", ",", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", 
   RowBox[{"Range", "[", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{
      RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], ":=", 
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"m", ",", 
    RowBox[{"All", "[", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"VertexDisplacement", "[", " ", 
   RowBox[{"n", ",", " ", 
    RowBox[{"All", "[", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "In[3731]:=",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "VertexPosition", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"p", "[", "\"\<VertexPosition\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
  "VertexDisplacement", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"p", "[", "\"\<VertexDisplacement\>\"", "]"}]}]}], "Code",
 CellLabel->
  "In[3747]:=",ExpressionUUID->"90948bbb-01c4-4119-a2a2-6a57e3256c77"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementRules[], PositionRules[], PositionConstraints[]", \
"Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "PositionRules", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"p", "[", "\"\<PositionRules\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"latticeVectors_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"\"\<LatticeVectors\>\"", "->", "latticeVectors"}], "]"}], "[", 
     "\"\<PositionRules\>\"", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "latticeVectors", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "::", "lat"}], "=", 
   "\"\<Lattice vectors should have dimensions `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{
    "p_PeriodicIdentificationData", " ", ",", " ", "latticeVectors_"}], " ", 
    "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"PositionRules", "::", "lat"}], ",", 
      RowBox[{"Dimensions", "[", 
       RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"arbitraryPositions", " ", "=", " ", 
      RowBox[{"Array", "[", " ", 
       RowBox[{"VertexPosition", ",", " ", 
        RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{"Rule", ",", " ", 
       RowBox[{"{", 
        RowBox[{"arbitraryPositions", ",", " ", "positions"}], "}"}], ",", 
       " ", "2"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{"VertexPosition", ",", " ", 
         RowBox[{
          RowBox[{"Dimensions", "[", "positions", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], " ", "]"}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "/@", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"Rule", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"arbitraryPositions", ",", " ", 
            RowBox[{"Length", "[", "positions", "]"}]}], " ", "]"}], ",", " ",
           "positions"}], " ", "}"}], " ", ",", " ", "3"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", "pos_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"PositionRules", "::", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "::", "pos"}], " ", "=", " ", 
   "\"\<Argument should either be a mechanism, vertex positions {pt1, \
pt2,...}, or a list of vertex positions { {pt1, ...}, ...} .\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3749]:=",ExpressionUUID->"fc8e80b7-f492-45a8-ad2d-80d222d7c4ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PositionConstraints", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"latticeVectors_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"\"\<LatticeVectors\>\"", "->", "latticeVectors"}], "]"}], "[", 
     "\"\<Constraints\>\"", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "latticeVectors", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionConstraints", "::", "lat"}], "=", 
   "\"\<Lattice vectors should have dimensions `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"PositionConstraints", "[", " ", 
   RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", "latticeVectors_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"PositionConstraints", "::", "lat"}], ",", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3758]:=",ExpressionUUID->"166d33b4-951a-4278-9c5e-954e8a50f80a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "DisplacementRules", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"p", "[", "\"\<DisplacementRules\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"wavevectors_", "?", "VectorQ"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"p", "[", "\"\<DisplacementRules\>\"", "]"}], " ", "/.", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"p", "[", "\"\<labels\>\"", "]"}], "->", "wavevectors"}], 
       "]"}]}], ")"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "wavevectors", "]"}], "==", 
     RowBox[{"Length", "[", 
      RowBox[{"p", "[", "\"\<labels\>\"", "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "::", "wavevectors"}], "=", 
   "\"\<You need `1` wave vectors to be provided\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"p_PeriodicIdentification", ",", " ", "_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"DisplacementRules", "::", "wavevector"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], "]"}]}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementRules", "[", " ", 
   RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"arbitraryPositions", " ", "=", " ", 
      RowBox[{"Array", "[", " ", 
       RowBox[{"VertexDisplacement", ",", " ", 
        RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{"Rule", ",", " ", 
       RowBox[{"{", 
        RowBox[{"arbitraryPositions", ",", " ", "positions"}], "}"}], ",", 
       " ", "2"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"positions_", "?", "VertexCoordinateListQ"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{"VertexDisplacement", ",", " ", 
         RowBox[{
          RowBox[{"Dimensions", "[", "positions", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], " ", "]"}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "/@", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"Rule", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"arbitraryPositions", ",", " ", 
            RowBox[{"Length", "[", "positions", "]"}]}], " ", "]"}], ",", " ",
           "positions"}], " ", "}"}], " ", ",", " ", "3"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementRules", "[", " ", "pos_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"DisplacementRules", "::", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "::", "pos"}], " ", "=", " ", 
   "\"\<Argument should either be vertex positions {pt1, pt2,...}, or a list \
of vertex positions { {pt1, ...}, ...} .\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3761]:=",ExpressionUUID->"21b3ac33-1f56-4c92-a764-e44557b03761"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomDisplacements[], RandomPositions[]", "Subsection",ExpressionUUID->"562e24b5-698b-4ad4-9b73-950bc1b6db48"],

Cell[CellGroupData[{

Cell["shared functions", "Subsubsection",ExpressionUUID->"210b555e-5c19-4358-9e47-26ced9aa372d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacementsInternal", "[", " ", 
    RowBox[{
    "positions_", ",", " ", "distribution_", ",", " ", "precision_", ",", " ", 
     RowBox[{"{", "}"}], ",", " ", "numDisplacements_"}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "numberOfVertices", ",", " ", "dim", ",", " ", "randomNumbers"}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=", 
       " ", 
       RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
      RowBox[{"Check", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"RandomVariate", "[", " ", 
         RowBox[{"distribution", ",", " ", 
          RowBox[{"{", 
           RowBox[{
           "numDisplacements", ",", " ", "numberOfVertices", ",", "dim"}], 
           "}"}], ",", " ", 
          RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", "precision"}]}], 
         " ", "]"}], ",", "\n", "\n", "\t\t", "$Failed"}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacementsInternal", "[", " ", 
   RowBox[{
   "positions_", ",", " ", "distribution_", ",", " ", "precision_", ",", " ", 
    "rules_", ",", " ", "numDisplacements_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
     "numberOfVertices", ",", " ", "dim", ",", " ", "displacements", ",", " ",
       "arbitraryDisplacements"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=", 
      " ", 
      RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
     RowBox[{"displacements", " ", "=", " ", 
      RowBox[{
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"VertexDisplacement", "[", 
           RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"numberOfVertices", ",", "dim"}], "}"}]}], "]"}], " ", "//.",
        " ", "rules"}]}], ";", "\n", "\t", 
     RowBox[{"arbitraryDisplacements", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", "displacements", "]"}], ",", " ", 
        "_VertexDisplacement"}], "]"}]}], ";", "\n", "\t", "\n", "\t", 
     RowBox[{"Check", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"displacements", " ", "/.", " ", 
            RowBox[{"Dispatch", "@", 
             RowBox[{"Thread", "[", 
              RowBox[{"arbitraryDisplacements", "->", 
               RowBox[{"RandomVariate", "[", "\n", "\t\t\t", 
                RowBox[{"distribution", ",", "\n", "\t\t\t", 
                 RowBox[{"Length", "[", "arbitraryDisplacements", "]"}], ",", 
                 "\n", "\t\t\t", 
                 RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "\n",
                 "\t\t", "]"}]}], "]"}]}]}], " ", "&"}], ")"}], ",", " ", 
         "numDisplacements"}], " ", "]"}], ",", "\n", "\n", "\t\t", 
       "$Failed"}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3769]:=",ExpressionUUID->"bc376d4f-976a-4a91-8624-a168657242d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RandomDisplacements", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<distribution\>\"", "->", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"WorkingPrecision", "->", "MachinePrecision"}], ",", "\n", "\t", 
      RowBox[{"\"\<rules\>\"", "\[Rule]", 
       RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RandomPositions", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<distribution\>\"", "->", 
      RowBox[{"NormalDistribution", "[", 
       RowBox[{"0", ",", 
        RowBox[{"1", "/", "10"}]}], "]"}]}], ",", "\n", "\t", 
     RowBox[{"WorkingPrecision", "->", "MachinePrecision"}], ",", "\n", "\t", 
     
     RowBox[{"\"\<rules\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}]}], "Code",
 CellLabel->
  "In[3771]:=",ExpressionUUID->"ac8c466b-bdd6-43d4-b153-f11dd020cbac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"processRules", "[", " ", 
   RowBox[{"_", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"processRules", "[", " ", 
   RowBox[{"RandomDisplacements", ",", " ", "r_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"parseDisplacementRules", "[", 
   RowBox[{"r", ",", 
    RowBox[{"Message", "[", 
     RowBox[{"RandomDisplacements", "::", "rules"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"processRules", "[", " ", 
    RowBox[{"RandomPositions", ",", " ", "r_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"parseDisplacementRules", "[", 
    RowBox[{"r", ",", 
     RowBox[{"Message", "[", 
      RowBox[{"RandomPositions", "::", "rules"}], "]"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"precisionQ", "[", " ", 
   RowBox[{"_", ",", " ", 
    RowBox[{"p_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
        RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}]}], " ", "]"}], " ", ":=", 
  " ", "p"}], "\n", 
 RowBox[{
  RowBox[{"precisionQ", "[", " ", 
   RowBox[{"RandomDisplacements", ",", " ", "p_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"RandomDisplacements", "::", "precision"}], ",", " ", "p"}], 
     "]"}], ";", " ", "$Failed"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"precisionQ", "[", " ", 
    RowBox[{"RandomPositions", ",", " ", "p_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomPositions", "::", "precision"}], ",", " ", "p"}], "]"}],
      ";", " ", "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"processNumber", "[", " ", 
   RowBox[{"_", ",", " ", 
    RowBox[{"n_Integer", "?", "Positive"}]}], " ", "]"}], " ", ":=", " ", 
  "n"}], "\n", 
 RowBox[{
  RowBox[{"processNumber", "[", " ", 
   RowBox[{"RandomDisplacements", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"RandomDisplacements", "::", "num"}], "]"}], ";", " ", 
    "$Failed"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"processNumber", "[", " ", 
    RowBox[{"RandomPositions", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"RandomPositions", "::", "num"}], "]"}], ";", " ", "$Failed"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "rules"}], "=", 
   "\"\<List of rules must be of the form {VertexDisplacements[_,_]->_, ..}\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "precision"}], "=", 
   "\"\<Working precision should be a real, positive number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "num"}], "=", 
   "\"\<Number of displacements must be a positive integer.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomDisplacements", "::", "pos"}], "=", 
    "\"\<First argument should be positions or a mechanism.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "rules"}], "=", 
   "\"\<List of rules must be of the form {VertexDisplacements[_,_]->_, ..}\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "precision"}], "=", 
   "\"\<Working precision should be a real, positive number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "num"}], "=", 
   "\"\<Number of displacements must be a positive integer.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "pos"}], "=", 
   "\"\<First argument should be positions or a mechanism.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3773]:=",ExpressionUUID->"7ef42bab-eea8-41af-a2b3-82d26556d5de"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomDisplacements[]", "Subsubsection",ExpressionUUID->"04e4ccfe-f5d0-4c69-876b-7beec801cf2e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"RandomDisplacements", "[", 
        RowBox[{"m", ",", "1", ",", " ", "opt"}], "]"}]}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "RandomDisplacements"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"num", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"precision", " ", "=", " ", 
        RowBox[{"precisionQ", "[", " ", 
         RowBox[{"RandomDisplacements", ",", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"processRules", "[", " ", 
         RowBox[{"RandomDisplacements", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"distribution", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"processNumber", "[", 
         RowBox[{"RandomDisplacements", ",", " ", "num"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"randomDisplacementsInternal", "[", " ", 
           RowBox[{
            RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
            "distribution", ",", " ", "precision", ",", " ", "rules", ",", 
            " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "[", " ", 
    RowBox[{
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"num", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"precision", " ", "=", " ", 
        RowBox[{"precisionQ", "[", " ", 
         RowBox[{"RandomDisplacements", ",", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"processRules", "[", " ", 
         RowBox[{"RandomDisplacements", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"distribution", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"processNumber", "[", 
         RowBox[{"RandomDisplacements", ",", " ", "num"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"randomDisplacementsInternal", "[", " ", 
           RowBox[{
           "pos", ",", " ", "distribution", ",", " ", "precision", ",", " ", 
            "rules", ",", " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", 
        "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"RandomDisplacements", "[", " ", 
   RowBox[{"a_", ",", " ", "___"}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"RandomDisplacements", "::", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3790]:=",ExpressionUUID->"e5952930-964e-4841-997f-31b4bd81a8b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomPositions[]", "Subsubsection",ExpressionUUID->"82434295-c65e-4c3d-9009-b10aad58af20"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "[", " ", 
    RowBox[{"m_", " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"RandomPositions", "[", 
        RowBox[{"m", ",", "1", ",", "opt"}], "]"}]}], "}"}], ",", " ", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "RandomPositions"}]}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"num", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"precision", " ", "=", " ", 
        RowBox[{"precisionQ", "[", " ", 
         RowBox[{"RandomPositions", ",", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"processRules", "[", " ", 
         RowBox[{"RandomPositions", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"distribution", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"processNumber", "[", 
         RowBox[{"RandomPositions", ",", " ", "num"}], "]"}]}]}], "\n", "}"}],
      ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"randomDisplacementsInternal", "[", " ", 
           RowBox[{
            RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
            "distribution", ",", " ", "precision", ",", " ", "rules", ",", 
            " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "number"}], 
            "]"}], "+", "res"}], ")"}], " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "[", " ", 
    RowBox[{
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"num", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"precision", " ", "=", " ", 
        RowBox[{"precisionQ", "[", 
         RowBox[{"RandomPositions", ",", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"processRules", "[", 
         RowBox[{"RandomPositions", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"distribution", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"processNumber", "[", 
         RowBox[{"RandomPositions", ",", " ", "num"}], "]"}]}]}], "\n", "}"}],
      ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"randomDisplacementsInternal", "[", " ", 
           RowBox[{
           "pos", ",", " ", "distribution", ",", " ", "precision", ",", " ", 
            "rules", ",", " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"pos", ",", "number"}], "]"}], "+", "res"}], ")"}], " ", "/;",
          " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"RandomPositions", "[", " ", 
   RowBox[{"a_", ",", " ", "___"}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"RandomPositions", "::", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3794]:=",ExpressionUUID->"109f3985-f817-4e88-8b45-46122daba2a6"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentificationData[]", "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"dim_", ",", " ", "f_", ",", " ", "maps_", ",", "vertices_"}], 
    "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"{", 
   RowBox[{
   "\"\<Identification\>\"", ",", "\"\<UniqueVertices\>\"", ",", 
    "\"\<LatticeVectors\>\"", ",", "\"\<PeriodicMaps\>\"", ",", 
    "\"\<labels\>\"", ",", "\n", "\"\<EmbeddingDimension\>\"", ",", 
    "\"\<Constraints\>\"", ",", "\"\<VertexPosition\>\"", ",", 
    "\"\<PositionRules\>\"", ",", "\"\<VertexDisplacements\>\"", ",", 
    "\"\<DisplacementRules\>\""}], "}"}]}]], "Code",
 CellLabel->
  "In[3798]:=",ExpressionUUID->"df7f77be-d71a-46ab-b616-6e17020c9b7a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"identification", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", " ", "f_", ",", " ", "maps_", ",", "vertices_"}], 
     "]"}], "[", "\"\<Identification\>\"", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "\n", "\t\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"rules", " ", "=", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"f", " ", "\[Rule]", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"Identity", ",", 
             RowBox[{"Length", "[", "f", "]"}]}], "]"}]}], "]"}]}], " ", 
        "}"}], ",", "\n", "\t\t\t", 
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "vertices", "]"}], "]"}], " ", "\[Rule]", 
           " ", 
           RowBox[{"(", 
            RowBox[{"vertices", " ", "/.", " ", "rules"}], ")"}]}], "]"}], 
         ",", " ", 
         RowBox[{"n_", " ", "\[Rule]", " ", "n_"}]}], " ", "]"}]}], "\n", 
      "\t\t", "]"}]}], "\n", "\t", "]"}]}]}]], "Code",
 CellLabel->
  "In[3799]:=",ExpressionUUID->"dafcaf9d-3f50-4a2e-88c2-614692918714"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"UniqueVertices", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", " ", "f_", ",", " ", "maps_", ",", "vertices_"}], 
     "]"}], "[", "\"\<UniqueVertices\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Cases", "[", 
    RowBox[{"vertices", ",", " ", "_Integer"}], "]"}]}]}]], "Code",
 CellLabel->
  "In[3800]:=",ExpressionUUID->"abe71d3b-5e73-4cb1-9fde-e11a331960f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"LatticeVectors", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], 
     "[", "\"\<LatticeVectors\>\"", "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"zeros", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "dim"}], "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "zeros", "]"}], "&"}], "/@", "maps"}]}], "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
     RowBox[{"\"\<LatticeVectors\>\"", "->", 
      RowBox[{"basis_", "?", "MatrixQ"}]}], "]"}], " ", ":=", " ", "\n", "\t", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "x", "}"}], ",", 
       RowBox[{"With", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"newMaps", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{
               RowBox[{"{", "x", "}"}], ",", 
               RowBox[{"x", "+", "#"}]}], "]"}], "&"}], "/@", "basis"}]}], 
          "}"}], ",", " ", 
         RowBox[{"PeriodicIdentificationData", "[", 
          RowBox[{"dim", ",", "f", ",", "newMaps", ",", "vertices"}], "]"}]}],
         "]"}]}], "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", "basis", "]"}], "==", "dim"}]}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
     RowBox[{"\"\<LatticeVectors\>\"", "->", "basis_"}], "]"}], " ", ":=", 
    "\n", "\t", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PeriodicIdentification", "::", "basis"}], ",", "dim"}], 
       "]"}], ";", "\n", "\t", 
      RowBox[{"PeriodicIdentificationData", "[", 
       RowBox[{"dim", ",", "f", ",", "maps", ",", "vertices"}], "]"}]}], "\n",
      "\t", ")"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentification", "::", "basis"}], "=", 
     "\"\<Lattice vectors must be provided as `1` vectors in dimension `1`.\>\
\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3801]:=",ExpressionUUID->"b0fdff5d-244d-4338-ab10-cb8aed660122"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"PeriodicMaps", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], 
     "[", "\"\<PeriodicMaps\>\"", "]"}], ":=", "maps"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"PeriodicIdentificationData", "[", 
       RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], 
      "[", 
      RowBox[{"\"\<PeriodicMaps\>\"", " ", "\[Rule]", " ", "m_"}], "]"}], " ",
      "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", "m", "]"}], "\[Equal]", 
      RowBox[{"Length", "[", "maps", "]"}]}]}], " ", ":=", " ", 
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim", ",", "f", ",", "m", ",", "vertices"}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
     RowBox[{"\"\<PeriodicMaps\>\"", " ", "\[Rule]", " ", "m_"}], "]"}], " ", 
    ":=", " ", "\n", "\t", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PeriodicIdentification", "::", "maps"}], ",", 
        RowBox[{"Length", "[", "maps", "]"}]}], "]"}], ";", "\n", "\t", 
      RowBox[{"PeriodicIdentificationData", "[", 
       RowBox[{"dim", ",", "f", ",", "maps", ",", "vertices"}], "]"}]}], "\n",
      "\t", ")"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentification", "::", "maps"}], "=", 
     "\"\<There must be `1` maps.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3805]:=",ExpressionUUID->"e278c625-12c6-40c6-b352-5e956822f428"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"EmbeddingDimension", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], 
     "[", "\"\<EmbeddingDimension\>\"", "]"}], ":=", "dim"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
     RowBox[{"\"\<EmbeddingDimension\>\"", " ", "\[Rule]", " ", 
      RowBox[{"d", " ", ":", " ", 
       RowBox[{"2", "|", "3"}]}]}], "]"}], ":=", 
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"d", ",", "f", ",", "maps", ",", "vertices"}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
     RowBox[{"\"\<EmbeddingDimension\>\"", " ", "\[Rule]", " ", "d_"}], "]"}],
     ":=", "\n", "\t", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PeriodicIdentification", "::", "dim"}], ",", "d"}], "]"}], 
      ";", "\n", "\t", 
      RowBox[{"PeriodicIdentificationData", "[", 
       RowBox[{"dim", ",", "f", ",", "maps", ",", "vertices"}], "]"}]}], "\n",
      "\t", ")"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeriodicIdentification", "::", "dim"}], "=", 
     "\"\<Dimension `1` must be either 2 or 3.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3809]:=",ExpressionUUID->"00a4171d-66c9-4a8e-a0c6-6ada4dd4a4fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "dim_", ",", " ", "f_", ",", " ", "maps_", ",", " ", "vertices_"}], 
     "]"}], "[", "\"\<labels\>\"", "]"}], " ", ":=", " ", "f"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
    
    RowBox[{"\"\<labels\>\"", " ", "\[Rule]", " ", "l_List"}], "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", "l", "]"}], "\[Equal]", 
    RowBox[{"Length", "[", "maps", "]"}]}]}], " ", ":=", " ", 
  RowBox[{"PeriodicIdentificationData", "[", 
   RowBox[{"dim", ",", "l", ",", "maps", ",", "vertices"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
   RowBox[{"\"\<labels\>\"", " ", "\[Rule]", " ", "l_"}], "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"PeriodicIdentification", "::", "label"}], ",", 
      RowBox[{"Length", "[", "f", "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim", ",", "f", ",", "maps", ",", "vertices"}], "]"}]}], "\n", 
   "\t", ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "label"}], "=", 
   "\"\<There must be `1` labels.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3813]:=",ExpressionUUID->"33307e51-3808-4b9a-9307-c503ffb0347c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
    "\"\<VertexPosition\>\"", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"cleanupRules", " ", "=", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"f", " ", "\[Rule]", " ", "maps"}], "]"}]}], " ", "}"}], 
       ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"vertices", " ", "/.", " ", 
         RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
          RowBox[{"VertexPosition", "[", 
           RowBox[{"x", ",", 
            RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", " ", 
        "cleanupRules"}]}], "\n", "\t", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
    "\"\<PositionRules\>\"", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{"With", "[", " ", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"cleanupRules", " ", "=", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{"f", " ", "\[Rule]", " ", "maps"}], "]"}]}], " ", "}"}], 
         ",", "\n", "\t\t", 
         RowBox[{"Thread", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexPosition", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", 
              RowBox[{"All", "[", "dim", "]"}]}], " ", "]"}], "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"vertices", " ", "/.", " ", 
              RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
               RowBox[{"VertexPosition", "[", 
                RowBox[{"x", ",", 
                 RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", 
             " ", "cleanupRules"}], " ", "]"}]}], "\n", "\t\t", "]"}]}], 
        "]"}], " ", ",", " ", 
       RowBox[{"x_", " ", "\[Rule]", " ", "x_"}]}], " ", "]"}]}], "\n", "\t", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
    "\"\<Constraints\>\"", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{"With", "[", " ", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"cleanupRules", " ", "=", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{"f", " ", "\[Rule]", " ", "maps"}], "]"}]}], " ", "}"}], 
         ",", "\n", "\t\t", 
         RowBox[{"Thread", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexPosition", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", 
              RowBox[{"All", "[", "dim", "]"}]}], " ", "]"}], "]"}], " ", 
           "\[Equal]", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"vertices", " ", "/.", " ", 
              RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
               RowBox[{"VertexPosition", "[", 
                RowBox[{"x", ",", 
                 RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", 
             " ", "cleanupRules"}], " ", "]"}]}], "\n", "\t\t", "]"}]}], 
        "]"}], " ", ",", " ", "True"}], " ", "]"}]}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
    "\"\<VertexDisplacements\>\"", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"cleanupRules", " ", "=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", "x_", "]"}], " ", "\[RuleDelayed]", " ", 
             RowBox[{"#", " ", "x"}]}], " ", "&"}], " ", "/@", " ", "f"}], 
          ")"}]}], " ", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"vertices", " ", "/.", " ", 
         RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
          RowBox[{"VertexDisplacement", "[", 
           RowBox[{"x", ",", 
            RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", " ", 
        "cleanupRules"}]}], "\n", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "[", 
   "\"\<DisplacementRules\>\"", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"cleanupRules", " ", "=", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "x_", "]"}], " ", "\[RuleDelayed]", " ", 
              RowBox[{"#", " ", "x"}]}], " ", "&"}], " ", "/@", " ", "f"}], 
           ")"}]}], " ", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Thread", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"VertexDisplacement", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", 
             RowBox[{"All", "[", "dim", "]"}]}], " ", "]"}], "]"}], " ", 
          "\[Rule]", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"vertices", " ", "/.", " ", 
             RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
              RowBox[{"VertexDisplacement", "[", 
               RowBox[{"x", ",", 
                RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", " ",
             "cleanupRules"}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
       "]"}], ",", " ", 
      RowBox[{"x_", " ", "\[Rule]", " ", "x_"}]}], " ", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3817]:=",ExpressionUUID->"c31057a9-e7ec-4599-a3a8-91e81672b45a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"dim_", ",", "f_", ",", "maps_", ",", "vertices_"}], "]"}], "]"}],
   " ", ":=", "\n", "\t", 
  RowBox[{"\"\<PeriodicIdentificationData\>\"", "[", 
   RowBox[{"Style", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"PeriodicIdentificationData", "[", 
       RowBox[{"dim", ",", "f", ",", "maps", ",", "vertices"}], "]"}], "[", 
      "\"\<LatticeVectors\>\"", "]"}], ",", " ", "Italic"}], " ", "]"}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[3822]:=",ExpressionUUID->"47555025-a91c-47a2-a30c-77ab1984f094"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentificationDataQ[]", "Subsection",ExpressionUUID->"9cfdc11c-7ae4-4bc5-9b1d-79dc2c28c20a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"_Integer", ",", "_", ",", "_", ",", "_"}], "]"}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"d_Integer", ",", "_", ",", "_", ",", "vertices_"}], "]"}]}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "\[Equal]",
        " ", "d"}], " ", ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "vertices", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], " ", "}"}], ",", 
    " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "_"}], " ", "]"}], " ", ":=",
   " ", "False"}]}], "Code",
 CellLabel->
  "In[3823]:=",ExpressionUUID->"ca2e65ed-8d19-4650-9d7a-afae1df6efcc"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentification[]", "Subsection",ExpressionUUID->"c9ba93b2-3e90-4f1f-8738-1c1dd5419c56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mapQ", "[", 
   RowBox[{"f_", " ", "\[Rule]", "  ", "_Function"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mapQ", "[", "_", "]"}], ":=", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
   " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "x", "}"}], ",", " ", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"f", " ", "=", " ", 
         RowBox[{"ToString", "/@", 
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{"Unique", "[", "]"}], ",", 
            RowBox[{"Length", "[", "basis", "]"}]}], "]"}]}]}], "}"}], ",", 
       "\n", "\t", 
       RowBox[{"periodicIdentificationInternal", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{"f", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "x", "}"}], ",", 
                RowBox[{"x", " ", "+", " ", "#"}]}], "]"}], "&"}], "/@", 
             "basis"}], ")"}]}], " ", "]"}]}], " ", "]"}]}], "\n", "]"}]}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "f_", ",", " ", 
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "f", "]"}], " ", "==", " ", 
    RowBox[{"Length", "[", "basis", "]"}]}]}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", "\n", "\t", 
    RowBox[{"periodicIdentificationInternal", "[", " ", 
     RowBox[{"m", ",", " ", 
      RowBox[{"Thread", "[", " ", 
       RowBox[{"f", " ", "\[Rule]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{
             RowBox[{"{", "x", "}"}], ",", 
             RowBox[{"x", " ", "+", " ", "#"}]}], "]"}], "&"}], "/@", 
          "basis"}], ")"}]}], " ", "]"}]}], " ", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", "mapQ"}], "}"}]}]}], "]"}], ":=", " ", 
   RowBox[{"periodicIdentificationInternal", "[", 
    RowBox[{"m", ",", "f"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"periodicIdentificationInternal", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "mapQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"labels", " ", "=", " ", 
         RowBox[{"f", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"maps", " ", "=", " ", 
         RowBox[{"f", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"pos", " ", "=", " ", 
         RowBox[{"MechanismPositions", "[", "m", "]"}]}], ",", " ", 
        RowBox[{"dim", " ", "=", " ", 
         RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"ruleFunction", "=", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
             RowBox[{"x", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}]}], " ", "]"}]}],
         ",", "\n", "\t", 
        RowBox[{"vertices", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{"PeriodicIdentificationData", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], ",", "\n", 
        "\t\t", "labels", ",", "\n", "\t\t", "maps", ",", "\n", "\t\t", 
        RowBox[{"vertices", " ", "//.", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"MapThread", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ruleFunction", "[", "#1", "]"}], " ", "/@", " ", 
              RowBox[{"overlappingVertices", "[", 
               RowBox[{"pos", ",", " ", 
                RowBox[{"#2", " ", "/@", " ", "pos"}]}], "]"}]}], "&"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"labels", ",", "maps"}], "}"}]}], "\n", "\t\t", "]"}], 
          "]"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[3826]:=",ExpressionUUID->"894f0b58-5723-4d0e-809d-4ee4d9dc3d49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "overlappingVertices", " ", "returns", " ", "a", " ", "list", " ", "of", 
    " ", "which", " ", "vertices", " ", "in", " ", "the", " ", "first", " ", 
    "set", " ", "of", " ", "positions", " ", "can", " ", "be", "\n", "\t", 
    "identified", " ", "in", " ", "the", " ", "second", " ", 
    RowBox[{"set", ".", "\n", "\t", "\n", "\t", 
     RowBox[{"overlappingVertices", "[", 
      RowBox[{
       RowBox[{"positions", " ", "1"}], ",", " ", 
       RowBox[{"positions", " ", "2"}]}], "]"}]}], " ", "returns", " ", "a", 
    " ", "list", " ", "of", " ", "which", " ", "vertices", " ", "listed", " ",
     "in", " ", "1", " ", "can", " ", "be", " ", "found", " ", "in", " ", 
    "2."}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"overlappingVertices", "[", 
    RowBox[{
     RowBox[{"positions1_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"positions2_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "5"}], ")"}]}]}]}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"nearestList", ",", " ", "selectorList"}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"(*", "\n", "\t", 
       RowBox[{
       "get", " ", "the", " ", "points", " ", "in", " ", "list", " ", "1", 
        " ", "that", " ", "are", " ", "closest", " ", "to", " ", "each", " ", 
        "of", " ", "the", " ", "points", " ", "in", " ", "list", " ", "2"}], 
       "\n", "\t", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"nearestList", " ", "=", " ", 
        RowBox[{
         RowBox[{"Nearest", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"positions1", " ", "\[Rule]", " ", 
             RowBox[{"Range", "[", " ", 
              RowBox[{"Length", "[", "positions1", "]"}], " ", "]"}]}], "]"}],
            ",", " ", "positions2"}], " ", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", ";", "\n", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "the", " ", "actual", " ", "overlapping", " ", "points", 
         " ", "according", " ", "to", " ", "the", " ", "provided", " ", 
         "tolerance"}], "*)"}], "\n", "\t", 
       RowBox[{"selectorList", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", "#"}], "<", 
            RowBox[{"tol", "^", "2"}]}], "&"}], ")"}], " ", "/@", " ", 
         RowBox[{"(", " ", 
          RowBox[{"positions2", "-", 
           RowBox[{"positions1", "[", 
            RowBox[{"[", " ", "nearestList", " ", "]"}], "]"}]}], " ", 
          ")"}]}]}], " ", ";", "\n", "\n", "\t", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"nearestList", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", " ", 
            RowBox[{"Length", " ", "@", " ", "positions1"}], "]"}]}], " ", 
          "]"}], ",", " ", "selectorList"}], " ", "]"}]}]}], "\n", "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "positions1", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", "positions2", "]"}]}]}]}]}]], "Code",
 CellLabel->
  "In[3832]:=",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismUnitCell[]", "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
       ")"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"pi", " ", "=", " ", 
         RowBox[{"PeriodicIdentification", "[", 
          RowBox[{"m", ",", "basis"}], "]"}]}], ",", "badVertices"}], " ", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"badVertices", "=", 
        RowBox[{
         RowBox[{"pi", "[", "\"\<Identification\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"badEdges", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MechanismConnectivity", "[", 
               RowBox[{"m", ",", 
                RowBox[{"\"\<edges\>\"", "\[Rule]", "\"\<vertices\>\""}]}], 
               "]"}], ",", 
              RowBox[{
               RowBox[{"ContainsAll", "[", 
                RowBox[{"badVertices", ",", "#"}], "]"}], "&"}]}], "]"}]}], 
           ",", "\n", "\t\t", 
           RowBox[{"badFaces", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"MechanismConnectivity", "[", 
               RowBox[{"m", ",", 
                RowBox[{"\"\<faces\>\"", "\[Rule]", "\"\<vertices\>\""}]}], 
               "]"}], ",", 
              RowBox[{
               RowBox[{"ContainsAll", "[", 
                RowBox[{"badVertices", ",", "#"}], "]"}], "&"}]}], "]"}]}]}], 
          "\n", "\t", "}"}], ",", "\n", "\t\t", 
         RowBox[{"MechanismDeleteDanglingVertices", "[", "\n", "\t\t\t", 
          RowBox[{"DeleteCells", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Alternatives", " ", "@@", " ", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"_", "/@", "badEdges"}], ",", 
               RowBox[{"_", "/@", "badFaces"}]}], "]"}]}]}], " ", "]"}], "\n",
           "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"basis", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", " ", 
      "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismUnitCell", "::", "dim"}], "]"}], ";", " ", 
       "False"}]}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismUnitCell", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"basis_", "?", "MatrixQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismUnitCell", "::", "num"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismUnitCell", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"basis", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_", "?", "MatrixQ"}], "]"}]}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismUnitCell", "::", "num"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismUnitCell", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismUnitCell", "::", "num"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[3833]:=",ExpressionUUID->"ffd7ea39-a364-44f4-94e2-69aab71ecae0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "dim"}], "=", 
   "\"\<Dimension of basis must match embedding dimension of \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "num"}], "=", 
   "\"\<Second argument should be a numeric basis.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[3837]:=",ExpressionUUID->"f855b1b9-6eff-4966-88ee-3d609bef8039"]
}, Closed]],

Cell[CellGroupData[{

Cell["LabelPeriodicVertices[]", "Subsection",ExpressionUUID->"a2de7482-cba2-4331-aa97-96a42e271549"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LabelPeriodicVertices", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pi_", ",", " ", 
    RowBox[{"inputStyle_", " ", ":", " ", "None"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"map", " ", "=", " ", 
        RowBox[{"pi", "[", "\"\<Identification\>\"", "]"}]}], ",", " ", 
       RowBox[{"style", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"inputStyle", " ", "===", " ", "None"}], ",", " ", 
          RowBox[{"#", "&"}], ",", " ", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"#", ",", "inputStyle"}], "]"}], "&"}]}], " ", "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"ChangeCellData", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ChangeCellData", "[", 
         RowBox[{"FreeJoint", ",", " ", 
          RowBox[{"map", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
          RowBox[{"\"\<Label\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{"style", "/@", " ", 
             RowBox[{"map", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ")"}]}]}], " ", 
         "]"}], " ", "@", " ", "m"}], ",", "\n", "\t\t", "FreeJoint", ",", 
       " ", 
       RowBox[{"map", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", " ", 
       RowBox[{"\"\<Label\>\"", " ", "\[Rule]", " ", 
        RowBox[{"map", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{"PeriodicIdentificationDataQ", "[", 
    RowBox[{"m", ",", "pi"}], "]"}]}]}]], "Code",
 CellLabel->
  "In[3839]:=",ExpressionUUID->"4f17c454-da11-4447-8d57-5317848adaf8"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["geometry", "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],

Cell[CellGroupData[{

Cell["\<\
private functions to check arguments \
vertexArgumentsQ[],torsionalFoldArgumentsQ[],edgeArgumentsQ[],faceArgumentsQ[]\
,tripleArgumentsQ[]\
\>", "Subsection",ExpressionUUID->"6c532f1a-6b68-4aeb-bf90-019593cda361"],

Cell[CellGroupData[{

Cell["vertexArgumentsQ[]", "Subsubsection",ExpressionUUID->"7d0695ab-1f95-4456-bdd4-8561d1a4a5d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vertexArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", "vertices_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"vertices", ",", " ", "IntegerQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "vertices", "]"}], ">", "0"}]}], ",", " ", "name", 
    ",", " ", "\"\<vertices\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexArgumentsQ", "[", " ", 
    RowBox[{"name_", ",", " ", 
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", "vertices_"}], 
    " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"vertices", ",", " ", "IntegerQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "vertices", "]"}], ">", "0"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Max", "[", "vertices", "]"}], " ", "\[LessEqual]", " ", 
       RowBox[{"Length", "[", "pos", "]"}]}]}], ",", " ", "name", ",", " ", 
     "\"\<vertices\>\""}], "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "only", " ", "checks", " ", "for", " ", "interior", " ", "vertices"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "vertices_"}], " ", "]"}], 
  " ", ":=", "\n", "\t", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", "vertices", "]"}], " ", "&&", " ", 
     RowBox[{"ContainsAll", "[", " ", 
      RowBox[{
       RowBox[{"InteriorVertices", "[", "m", "]"}], ",", " ", "vertices"}], 
      " ", "]"}]}], " ", ",", " ", "name", ",", " ", "\"\<vertices\>\""}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", ",", " ", 
    "vertices_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"vertices", ",", " ", "IntegerQ"}], "]"}], " ", "&&", " ", 
       RowBox[{"ContainsAll", "[", " ", 
        RowBox[{
         RowBox[{"InteriorVertices", "[", "m", "]"}], ",", " ", "vertices"}], 
        " ", "]"}]}], ",", " ", "name", ",", " ", "\"\<vertices\>\""}], "]"}],
     ",", "\n", "\t", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "pos", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], ",", " ", "name",
       ",", " ", "\"\<pos\>\""}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3840]:=",ExpressionUUID->"ed59bca9-5f7a-4563-afbb-03d341794d53"]
}, Closed]],

Cell[CellGroupData[{

Cell["torsionalFoldArgumentsQ[]", "Subsubsection",ExpressionUUID->"c7e5235f-14a6-4abe-b812-30b297accf20"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"torsionalFoldArgumentsQ", "[", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", "edgelist_"}], "]"}], ":=", 
  RowBox[{"checkForError", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"edgelist", ",", "IntegerQ"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"edgelist", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
        RowBox[{"Quiet", " ", "@", " ", 
         RowBox[{"ContainsAll", "[", " ", 
          RowBox[{
           RowBox[{"Sort", "/@", 
            RowBox[{"InteriorEdges", "[", "m", "]"}]}], ",", 
           RowBox[{"Sort", "/@", "edgelist"}]}], "]"}]}]}], "}"}], ",", 
      "TrueQ"}], "]"}], ",", "\n", "\t", "name", ",", "\n", "\t", 
    "\"\<TorsionalFolds\>\""}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"torsionalFoldArgumentsQ", "[", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", "pos_", ",", "edgelist_"}], "]"}],
   ":=", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"checkForError", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"AllTrue", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"edgelist", ",", "IntegerQ"}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"edgelist", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
          RowBox[{"Quiet", " ", "@", " ", 
           RowBox[{"ContainsAll", "[", " ", 
            RowBox[{
             RowBox[{"Sort", "/@", 
              RowBox[{"InteriorEdges", "[", "m", "]"}]}], ",", 
             RowBox[{"Sort", "/@", "edgelist"}]}], "]"}]}]}], "}"}], ",", 
        "TrueQ"}], "]"}], ",", "\n", "\t\t", "name", ",", "\n", "\t\t", 
      "\"\<TorsionalFolds\>\""}], "\n", "\t", "]"}], ",", "\n", "\t", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "pos", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], ",", " ", "name",
       ",", " ", "\"\<pos\>\""}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3844]:=",ExpressionUUID->"f046e6c6-b4ba-4075-9f4b-08d736a5ace0"]
}, Closed]],

Cell[CellGroupData[{

Cell["edgeArgumentsQ[]", "Subsubsection",ExpressionUUID->"b00a89e2-31a5-4fdf-a915-adf6c32c6321"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"edgeArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", "edgelist_"}], " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MatrixQ", "[", 
      RowBox[{"edgelist", ",", "IntegerQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgelist", "]"}], ">", "0"}]}], " ", ",", " ", 
    "name", ",", " ", "\"\<edgeform\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"edgeArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "edgelist_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{"MechanismEdgeQ", "[", 
     RowBox[{"m", ",", "edgelist"}], "]"}], ",", " ", "name", ",", " ", 
    "\"\<edge\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"edgeArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", 
    RowBox[{"pos_", "?", "VertexCoordinatesQ"}], " ", ",", " ", "edgelist_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{"ValidMechanismEdgeQ", "[", 
     RowBox[{"pos", ",", "edgelist"}], "]"}], ",", " ", "name", ",", " ", 
    "\"\<edge\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"edgeArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", ",", " ", 
    "edgelist_"}], "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{"MechanismEdgeQ", "[", 
       RowBox[{"m", ",", "edgelist"}], "]"}], ",", " ", "name", ",", " ", 
      "\"\<edge\>\""}], " ", "]"}], ",", "\n", "\t", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "pos", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], ",", " ", "name",
       ",", " ", "\"\<pos\>\""}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3846]:=",ExpressionUUID->"74157408-0c66-4842-b8b7-e411e07d55a7"]
}, Closed]],

Cell[CellGroupData[{

Cell["faceArgumentsQ[]", "Subsubsection",ExpressionUUID->"f98efa5b-3c69-4077-8d5a-b51de41d58c8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"faceArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", "Facelist_"}], " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ArrayDepth", "[", "Facelist", "]"}], "\[Equal]", "2"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Min", "[", "Facelist", "]"}], ">", "0"}]}], " ", ",", " ", 
    "name", ",", " ", "\"\<Faceform\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"faceArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "facelist_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{"MechanismFaceQ", "[", 
     RowBox[{"m", ",", "facelist"}], "]"}], ",", " ", "name", ",", " ", 
    "\"\<Face\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"faceArgumentsQ", "[", " ", 
   RowBox[{"name_", " ", ",", " ", 
    RowBox[{"pos_", "?", "VertexCoordinatesQ"}], " ", ",", " ", "Facelist_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"checkForError", "[", " ", 
   RowBox[{
    RowBox[{"ValidMechanismFaceQ", "[", 
     RowBox[{"pos", ",", "Facelist"}], "]"}], ",", " ", "name", ",", " ", 
    "\"\<Face\>\""}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"faceArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", ",", " ", 
    "Facelist_"}], "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{"MechanismFaceQ", "[", 
       RowBox[{"m", ",", "Facelist"}], "]"}], ",", " ", "name", ",", " ", 
      "\"\<Face\>\""}], " ", "]"}], ",", "\n", "\t", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "pos", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], ",", " ", "name",
       ",", " ", "\"\<pos\>\""}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3850]:=",ExpressionUUID->"4b209ac4-fa60-42af-ba35-3792b420927e"]
}, Closed]],

Cell[CellGroupData[{

Cell["tripleArgumentsQ[]", "Subsubsection",ExpressionUUID->"6bd1325f-52af-4db8-98a7-f6e93bc91db9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tripleArgumentsQ", "[", " ", 
    RowBox[{"name_", " ", ",", " ", "triplelist_"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"triplelist", ",", "IntegerQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"triplelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], " ", "&&", 
      " ", 
      RowBox[{
       RowBox[{"Min", "[", "triplelist", "]"}], ">", "0"}]}], " ", ",", " ", 
     "name", ",", " ", "\"\<tripleform\>\""}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tripleArgumentsQ", "[", " ", 
    RowBox[{"name_", " ", ",", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "triplelist_"}], " ", 
    "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"triplelist", ",", "IntegerQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"triplelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], " ", "&&", 
      " ", 
      RowBox[{
       RowBox[{"Min", "[", "triplelist", "]"}], ">", "0"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Max", "[", "triplelist", "]"}], "\[LessEqual]", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], " ", ",", " ", 
     "name", ",", " ", "\"\<triples\>\""}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tripleArgumentsQ", "[", " ", 
    RowBox[{"name_", " ", ",", " ", 
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
     "triplelist_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"triplelist", ",", "IntegerQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"triplelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], " ", "&&", 
      " ", 
      RowBox[{
       RowBox[{"Min", "[", "triplelist", "]"}], ">", "0"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Max", "[", "triplelist", "]"}], "\[LessEqual]", 
       RowBox[{"Length", "[", "pos", "]"}]}]}], " ", ",", " ", "name", ",", 
     " ", "\"\<triples\>\""}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tripleArgumentsQ", "[", " ", 
   RowBox[{"name_", ",", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", ",", " ", 
    "triplelist_"}], "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"triplelist", ",", "IntegerQ"}], "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"triplelist", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}], " ", "&&",
        " ", 
       RowBox[{
        RowBox[{"Min", "[", "triplelist", "]"}], ">", "0"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Max", "[", "triplelist", "]"}], "\[LessEqual]", 
        RowBox[{"Length", "[", "pos", "]"}]}]}], " ", ",", " ", "name", ",", 
      " ", "\"\<triples\>\""}], " ", "]"}], ",", "\n", "\t", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "pos", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], ",", " ", "name",
       ",", " ", "\"\<pos\>\""}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3854]:=",ExpressionUUID->"0362da2d-fd61-40ec-b51e-c69ed928b0d7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["common errors messages", "Subsection",ExpressionUUID->"0fef66b1-5c36-4263-bc92-9241a15dc681"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
   "$positionError", "=", 
    "\"\<Vertex positions do not correspond to Mechanism.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
  "$edgeError", "=", "\"\<One or more provided edges are not valid.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
   "$edgeformError", "=", 
    "\"\<Edges are not of the form {{v1,v2},...}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
  "$tripleError", "=", 
   "\"\<One or more provided triples involve vertices that are out of bounds.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
   "$tripleformError", "=", 
    "\"\<Triples are not of the form {{v1,v2,v3},...}.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
  "$FaceformError", "=", 
   "\"\<Faces are not of the form {{v1,...},...}.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
   "$FaceError", "=", "\"\<One or more provided Faces are not valid.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
   "$TorsionalFoldError", "=", 
    "\"\<One or more provided edges are not valid TorsionalFolds.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
  "$vertexError", "=", 
   "\"\<One or more vertices are not valid interior vertices.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3858]:=",ExpressionUUID->"33cc50ea-c5a6-457f-8f47-13118b690292"]
}, Closed]],

Cell[CellGroupData[{

Cell["Measuring cell functions", "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],

Cell[CellGroupData[{

Cell["DisplacementVector[]", "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "::", "edgeform"}], " ", "=", " ", 
   "$edgeformError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "::", "edge"}], "=", "$edgeError"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3867]:=",ExpressionUUID->"36f88f0a-d9f2-47b0-a1b3-bed489a613e0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     "edgeList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"edgeArgumentsQ", "[", 
    RowBox[{"\"\<DisplacementVector\>\"", ",", "positions", ",", "edgeList"}],
     "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"DisplacementVectorInternal", "[", 
   RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementVector", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "VertexCoordinateListQ"}], ",", " ", 
      "edgeList_"}], " ", "]"}], " ", "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{"\"\<DisplacementVector\>\"", ",", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "edgeList"}], "]"}]}], " ", ":=", 
   "\n", "\t", 
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{"positions", ",", " ", "edgeList"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", "edgeList_"}], 
    "]"}], " ", "/;", " ", 
   RowBox[{"edgeArgumentsQ", "[", 
    RowBox[{
    "\"\<DisplacementVector\>\"", ",", "m", ",", "pos", ",", "edgeList"}], 
    "]"}]}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"DisplacementVectorInternal", "[", " ", 
   RowBox[{"pos", " ", ",", " ", "edgeList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementVector", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
      RowBox[{"positions_", "?", "VertexCoordinateListQ"}], ",", " ", 
      "edgeList_"}], " ", "]"}], " ", "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{"\"\<DisplacementVector\>\"", ",", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "edgeList"}], "]"}]}], " ", ":=", 
   "\n", "\t", 
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{"positions", ",", " ", "edgeList"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"edgeArgumentsQ", "[", 
    RowBox[{"\"\<DisplacementVector\>\"", ",", "m", ",", "edgeList"}], 
    "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"DisplacementVectorInternal", "[", " ", 
   RowBox[{
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", "edgeList"}],
    "]"}]}]}], "Code",
 CellLabel->
  "In[3870]:=",ExpressionUUID->"17b69bef-e499-4349-baa1-daabc117b244"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{
     RowBox[{"positions_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
     "edgeList_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"DisplacementVectorCompiled", "[", "]"}], "[", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
     RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "MatrixQ"}], ",", "edgeList_"}], "]"}], ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flippedEdgeList", "=", 
       RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementVectorCompiled", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"DisplacementVectorCompiled", "[", "]"}], "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"positions", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edgeList", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"flippedEdgeList", "=", 
         RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"flippedEdgeList", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"flippedEdgeList", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "\t", 
      "]"}]}], "\[IndentingNewLine]", "]"}]}]}]}], "Code",
 CellLabel->
  "In[3876]:=",ExpressionUUID->"b3dd01b3-e2b3-4f86-9379-bb750cf02b0f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{
     RowBox[{"positions_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", 
         RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
     "edgeList_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"DisplacementVectorCompiledMultiple", "[", "]"}], "[", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
     RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVectorInternal", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "ArrayQ"}], ",", "edgeList_"}], "]"}], ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flippedEdgeList", "=", 
       RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "&"}], ",", " ", 
       "positions"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementVectorCompiledMultiple", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"DisplacementVectorCompiledMultiple", "[", "]"}], "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"positions", ",", "_Real", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edgeList", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"flippedEdgeList", "=", 
         RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", 
       "\t\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"flippedEdgeList", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"flippedEdgeList", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "&"}], ",", " ",
          "positions"}], "]"}]}], "\n", "\t", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[3879]:=",ExpressionUUID->"18c2bce9-35f1-479d-aa0a-08040ce0fa9a"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementLength[]", "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "::", "edgeform"}], " ", "=", " ", 
   "$edgeformError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "::", "edge"}], "=", "$edgeError"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3882]:=",ExpressionUUID->"949d5667-3ae5-4dec-b4c8-b878d6e06539"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementLength", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLength", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
      "edgeList_"}], "]"}], " ", "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{
     "\"\<DisplacementLength\>\"", ",", "positions", ",", "edgeList"}], 
     "]"}]}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"DisplacementLengthInternal", "[", 
    RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLength", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", "edgeList_"}], "]"}], 
    " ", "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{
     "\"\<DisplacementLength\>\"", ",", "m", ",", "positions", ",", 
      "edgeList"}], "]"}]}], ":=", " ", "\n", "\t", 
   RowBox[{"DisplacementLengthInternal", "[", 
    RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLength", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], "]"}], " ", 
    "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{"\"\<DisplacementLength\>\"", ",", "m", ",", "edgeList"}], 
     "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"DisplacementLengthInternal", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
     "edgeList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "edgelist_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"DisplacementLengthCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthInternal", "[", 
   RowBox[{"positions_", ",", "edgelist_"}], "]"}], ":=", 
  RowBox[{"DisplacementLengthAnalytic", "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[3885]:=",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthCompiled", "[", "d_Integer", "]"}], ":=", 
   RowBox[{
    RowBox[{"DisplacementLengthCompiled", "[", "d", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"index1", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
              "\t\t\t", 
              RowBox[{"index2", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
             "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
                "^", "2"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], 
           "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Sqrt", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], " ", "/@", " ", 
     RowBox[{"DisplacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3891]:=",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementLengthSquared[]", "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "::", "pos"}], "=", 
   "$positionError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "::", "edgeform"}], " ", "=", " ", 
   "$edgeformError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "::", "edge"}], "=", "$edgeError"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3893]:=",ExpressionUUID->"8d3c9eb9-8577-40c3-b2a9-67a6dbfb2bd7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementLengthSquared", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     "edgeList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"edgeArgumentsQ", "[", 
    RowBox[{
    "\"\<DisplacementLengthSquared\>\"", ",", "positions", ",", "edgeList"}], 
    "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"DisplacementLengthSquaredInternal", "[", 
   RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     "edgeList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"edgeArgumentsQ", "[", 
    RowBox[{
    "\"\<DisplacementLengthSquared\>\"", ",", "m", ",", " ", "positions", ",",
      "edgeList"}], "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"DisplacementLengthSquaredInternal", "[", 
   RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLengthSquared", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], "]"}], " ", 
    "/;", " ", 
    RowBox[{"edgeArgumentsQ", "[", 
     RowBox[{"\"\<DisplacementLengthSquared\>\"", ",", "m", ",", "edgeList"}],
      "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"DisplacementLengthSquaredInternal", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
     "edgeList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthSquaredInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "edgelist_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"DisplacementLengthSquaredCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthSquaredInternal", "[", 
   RowBox[{"positions_", ",", "edgelist_"}], "]"}], ":=", 
  RowBox[{"DisplacementLengthSquaredAnalytic", "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[3896]:=",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementLengthSquaredCompiled", "[", "d_Integer", "]"}], ":=", 
  
  RowBox[{
   RowBox[{"DisplacementLengthSquaredCompiled", "[", "d", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"index1", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"index2", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
            "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
              "^", "2"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], "\n", 
          "\t\t\t", "]"}], ",", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthSquaredAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ",", 
     RowBox[{"DisplacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3902]:=",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],

Cell[CellGroupData[{

Cell["TurningAngle[]", "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "::", "tripleform"}], "=", "$tripleformError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "::", "triples"}], "=", "$tripleError"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3904]:=",ExpressionUUID->"a0547189-6c97-4c22-9294-333665d1f20e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TurningAngle", "[", 
   RowBox[{"p__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     "tripleList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"tripleArgumentsQ", "[", 
    RowBox[{
    "\"\<TurningAngle\>\"", ",", " ", "positions", ",", " ", "tripleList"}], 
    " ", "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"TurningAngleInternal", "[", 
   RowBox[{"positions", ",", " ", "tripleList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     "tripleList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"tripleArgumentsQ", "[", 
    RowBox[{
    "\"\<TurningAngle\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
     "tripleList"}], " ", "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"TurningAngleInternal", "[", 
   RowBox[{"positions", ",", " ", "tripleList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TurningAngle", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "tripleList_"}], "]"}], 
    " ", "/;", " ", 
    RowBox[{"tripleArgumentsQ", "[", 
     RowBox[{"\"\<TurningAngle\>\"", ",", " ", "m", ",", " ", "tripleList"}], 
     " ", "]"}]}], "  ", ":=", "\n", "\t", 
   RowBox[{"TurningAngleInternal", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
     "tripleList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TurningAngleInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "tripleList_"}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"TurningAngleCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
    RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"TurningAngleInternal", "[", 
   RowBox[{"positions_", ",", "tripleList_"}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"TurningAngleAnalytic", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "positions", ",", 
    RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[3907]:=",ExpressionUUID->"fe12d61c-c2b8-41f3-93cc-6879d3615206"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngleCompiled", "[", "3", "]"}], ":=", 
   RowBox[{
    RowBox[{"TurningAngleCompiled", "[", "3", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",",
       "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"p1x", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p1y", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p1z", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2x", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2y", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2z", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
          RowBox[{"ArcCos", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p1x", " ", "p2x"}], "+", 
              RowBox[{"p1y", " ", "p2y"}], "+", 
              RowBox[{"p1z", " ", "p2z"}]}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"p1x", "^", "2"}], "+", 
                RowBox[{"p1y", "^", "2"}], "+", 
                RowBox[{"p1z", "^", "2"}]}], "]"}], " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"p2x", "^", "2"}], "+", 
                RowBox[{"p2y", "^", "2"}], "+", 
                RowBox[{"p2z", "^", "2"}]}], "]"}]}], ")"}]}], "]"}]}], "\n", 
         "\t\t", "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TurningAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"TurningAngleCompiled", "[", "2", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"p1x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p1y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"p1x", " ", "p2x"}], " ", "+", " ", 
              RowBox[{"p1y", " ", "p2y"}]}], ",", 
             RowBox[{
              RowBox[{"p1x", " ", "p2y"}], " ", "-", " ", 
              RowBox[{"p2x", " ", "p1y"}]}]}], "]"}]}], "\n", "\t\t", "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], "\n",
       "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[3913]:=",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "this", " ", "funny", " ", "construction", " ", "here", " ", "works", " ",
      "better", " ", "during", " ", "expansions", " ", "because", " ", "of", 
     " ", "the", " ", "branch", " ", "cuts", " ", "of", " ", 
     RowBox[{"ArcCos", "[", "]"}], "\n", "\n", "The", " ", "problem", " ", 
     "arises", " ", "in", " ", 
     RowBox[{"Series", "[", 
      RowBox[{
       RowBox[{"ArcCos", "[", 
        RowBox[{"1", "-", 
         RowBox[{"xx", "^", "2"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"xx", ",", "0", ",", "2"}], "}"}]}], "]"}], " ", "which", " ",
      "requires", " ", "the", " ", "choice", " ", "of", " ", "a", " ", 
     RowBox[{"branch", ".", " ", "This"}], " ", "last", " ", "part", "\n", 
     RowBox[{"hasn", "'"}], "t", " ", "been", " ", "solved", " ", "but", " ", 
     "at", " ", "least", " ", "the", " ", "answer", " ", "comes", " ", "out", 
     " ", 
     RowBox[{"faster", ".", " ", "The"}], " ", "rest", " ", "of", " ", "the", 
     " ", "branch", " ", "cut", " ", "issues", "\n", "are", " ", "handled", 
     " ", "automatically", " ", "in", " ", 
     RowBox[{"expandExpression", "[", "]"}]}], ",", " ", 
    RowBox[{
    "which", " ", "does", " ", "what", " ", "it", " ", "can", " ", "to", " ", 
     "make", " ", "imaginary", " ", "components", " ", 
     RowBox[{"zero", ".", "\n", "\n", "There"}], " ", "should", " ", "be", 
     " ", "a", " ", "better", " ", "way", " ", "to", " ", "handle", " ", 
     "this", " ", "but", " ", "this", " ", "seems", " ", "to", " ", "work", 
     " ", "in", " ", "most", " ", 
     RowBox[{"cases", "."}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"TurningAngleAnalytic", "[", 
     RowBox[{"3", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"cosvectorAngle3D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", " ", "xx"}], "+", 
               RowBox[{"y", " ", "yy"}], "+", 
               RowBox[{"z", " ", "zz"}]}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"x", "^", "2"}], "+", 
                 RowBox[{"y", "^", "2"}], "+", 
                 RowBox[{"z", "^", "2"}]}], "]"}], " ", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"xx", "^", "2"}], "+", 
                 RowBox[{"yy", "^", "2"}], "+", 
                 RowBox[{"zz", "^", "2"}]}], "]"}]}], ")"}]}]}], "\n", "\t\t",
            "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"expandExpression", "@", 
              RowBox[{"cosvectorAngle3D", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], 
           "]"}]}], ")"}], "&"}], "/@", "tripleList"}]}], "\n", "]"}]}], "\n",
    "\n", 
   RowBox[{
    RowBox[{"TurningAngleAnalytic", "[", 
     RowBox[{"2", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"vectorAngle2D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"x", " ", "xx"}], " ", "+", " ", 
               RowBox[{"y", " ", "yy"}]}], ",", 
              RowBox[{
               RowBox[{"x", " ", "yy"}], " ", "-", " ", 
               RowBox[{"xx", " ", "y"}]}]}], "]"}]}], "\t", "\n", "\t\t", 
           "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"vectorAngle2D", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], ")"}], 
        "&"}], "/@", "tripleList"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[3915]:=",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],

Cell[CellGroupData[{

Cell["NormalVector[]", "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "Faceform"}], "=", "$FaceformError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "Face"}], "=", "$FaceError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "norm"}], "=", 
   "\"\<Option \\\"normalize\\\" must be either True or False.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3917]:=",ExpressionUUID->"1258f73c-5d73-4fd1-89c9-b8572c60a5f2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "NormalVector", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<Normalize\>\"", "\[Rule]", "True"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "Faces_", 
     ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{"faceArgumentsQ", "[", 
    RowBox[{"\"\<NormalVector\>\"", ",", "positions", ",", "Faces"}], "]"}]}],
   " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"NormalVectorInternal", "[", 
    RowBox[{"positions", ",", " ", "Faces", ",", " ", 
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}]}], "]"}], " ", "/;",
    " ", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{"BooleanQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], "]"}], " ", ",",
      " ", "\"\<TurningAngle\>\"", ",", " ", "\"\<norm\>\""}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "Faces_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{"faceArgumentsQ", "[", 
    RowBox[{"\"\<NormalVector\>\"", ",", "m", ",", "Faces"}], "]"}]}], " ", ":=",
   "\n", "\t", 
  RowBox[{
   RowBox[{"NormalVectorInternal", "[", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "Faces", ",", 
     " ", 
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}]}], "]"}], " ", "/;",
    " ", 
   RowBox[{"checkForError", "[", " ", 
    RowBox[{
     RowBox[{"BooleanQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], "]"}], " ", ",",
      " ", "\"\<TurningAngle\>\"", ",", " ", "\"\<norm\>\""}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NormalVector", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "Faces_", 
      ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{"faceArgumentsQ", "[", 
     RowBox[{
     "\"\<NormalVector\>\"", ",", "m", ",", "positions", ",", "Faces"}], 
     "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"NormalVectorInternal", "[", 
     RowBox[{"positions", ",", " ", "Faces", ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{"checkForError", "[", " ", 
     RowBox[{
      RowBox[{"BooleanQ", "[", 
       RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], "]"}], " ", 
      ",", " ", "\"\<TurningAngle\>\"", ",", " ", "\"\<norm\>\""}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"NormalVectorInternal", "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "Faces_", ",", 
    RowBox[{"normalize_", " ", ":", " ", "True"}]}], "]"}], ":=", "\n", "\t", 
  
  RowBox[{
   RowBox[{"NormalVectorCompiled", "[", 
    RowBox[{"normalize", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"pos", ",", 
    RowBox[{"ToPackedArray", "[", 
     RowBox[{"PadRight", "[", 
      RowBox[{"Faces", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "Faces", "]"}], ",", "3"}], "}"}]}], "]"}], 
     "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NormalVectorInternal", "[", 
   RowBox[{"pos_", ",", "Faces_", ",", 
    RowBox[{"normalize_", " ", ":", " ", "True"}]}], "]"}], ":=", "\n", "\t", 
  
  RowBox[{
   RowBox[{"NormalVectorAnalytic", "[", 
    RowBox[{"normalize", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"pos", ",", " ", 
    RowBox[{"ToPackedArray", "[", 
     RowBox[{"PadRight", "[", 
      RowBox[{"Faces", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "Faces", "]"}], ",", "3"}], "}"}]}], "]"}], 
     "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[3921]:=",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NormalVectorCompiled", "[", 
   RowBox[{"True", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"NormalVectorCompiled", "[", 
    RowBox[{"True", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "yy"}], " ", "z"}], "+", 
                RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "z"}], "-", 
                RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "xx"}], " ", "y"}], "+", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}]}],
             "\n", "\t\t\t", "}"}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"NormalVectorCompiled", "[", 
   RowBox[{"False", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"NormalVectorCompiled", "[", 
    RowBox[{"False", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "yy"}], " ", "z"}], "+", 
               RowBox[{"y", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"xx", " ", "z"}], "-", 
               RowBox[{"x", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "xx"}], " ", "y"}], "+", 
               RowBox[{"x", " ", "yy"}]}], ")"}]}], "\n", "\t\t\t", "}"}]}], 
          "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVectorCompiled", "[", 
    RowBox[{"True", ",", "2"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"NormalVectorCompiled", "[", 
     RowBox[{"True", ",", "2"}], "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Sign", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}], "]"}]}], "\n", "\t\t\t", "]"}], ",",
           "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVectorCompiled", "[", 
    RowBox[{"False", ",", "2"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"NormalVectorCompiled", "[", 
     RowBox[{"False", ",", "2"}], "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "xx"}], " ", "y"}], "+", 
             RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVectorAnalytic", "[", 
    RowBox[{"True", " ", 
     RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
     "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
       RowBox[{"NormalVector3D", "=", 
        RowBox[{"Function", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], 
                "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}], 
         "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "=", 
           RowBox[{"data", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"NormalVector3D", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
       "triples"}]}], "\n", "]"}]}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"NormalVectorAnalytic", "[", 
   RowBox[{"False", " ", 
    RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
    "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"unNormalVector3D", "=", 
       RowBox[{"Function", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], ",",
            "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"-", "yy"}], " ", "z"}], "+", 
              RowBox[{"y", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"xx", " ", "z"}], "-", 
              RowBox[{"x", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"unNormalVector3D", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "triples"}]}], "\n", "]"}], " "}]}], "Code",
 CellLabel->
  "In[3928]:=",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],

Cell[CellGroupData[{

Cell["FaceArea[]", "Subsubsection",ExpressionUUID->"d3174cc3-0acb-46eb-8dda-1333a3ceb442"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "::", "pos"}], "=", "$positionError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "::", "Faceform"}], "=", "$FaceformError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "::", "Face"}], "=", "$FaceError"}], ";"}]}], "Code",
 CellLabel->
  "In[3934]:=",ExpressionUUID->"f802bda3-d5f3-4d3e-b81c-3e76a69ab79b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tc", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"Face", ",", "_Integer", ",", "1"}], "}"}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"v1", "=", 
          RowBox[{"First", "[", "Face", "]"}]}], ",", 
         RowBox[{"rest", "=", 
          RowBox[{"Rest", "[", "Face", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "v1", "}"}], ",", "#"}], "]"}], "&"}], ",", 
         RowBox[{"Partition", "[", 
          RowBox[{"rest", ",", "2", ",", "1"}], "]"}]}], " ", "]"}]}], 
      "\[IndentingNewLine]", "\t", "]"}], ",", "\[IndentingNewLine]", "\t", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[3937]:=",ExpressionUUID->"47774888-3edf-4b60-83d4-34a5e6235fb7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FaceArea", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "Faces_"}], 
    "]"}], " ", "/;", " ", 
   RowBox[{"faceArgumentsQ", "[", 
    RowBox[{"\"\<FaceArea\>\"", ",", "positions", ",", "Faces"}], "]"}]}], 
  " ", ":=", "\n", "\t", 
  RowBox[{"FaceAreaInternal", "[", 
   RowBox[{"positions", ",", " ", "Faces"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "Faces_"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"faceArgumentsQ", "[", 
    RowBox[{"\"\<FaceArea\>\"", ",", "m", ",", "Faces"}], "]"}]}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"FaceAreaInternal", "[", 
   RowBox[{
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "Faces"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceArea", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "Faces_"}],
      "]"}], " ", "/;", " ", 
    RowBox[{"faceArgumentsQ", "[", 
     RowBox[{"\"\<FaceArea\>\"", ",", "m", ",", "positions", ",", "Faces"}], 
     "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"FaceAreaInternal", "[", 
    RowBox[{"positions", ",", " ", "Faces"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"FaceAreaInternal", "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "Faces_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"Total", "@", 
     RowBox[{
      RowBox[{"FaceAreaCompiled", "[", 
       RowBox[{"Length", "[", 
        RowBox[{"pos", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
      RowBox[{"pos", ",", " ", "#"}], "]"}]}], "&"}], " ", "/@", " ", 
   RowBox[{"tc", "[", "Faces", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"FaceAreaInternal", "[", 
   RowBox[{"pos_", ",", "Faces_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Total", "@", 
       RowBox[{"FaceAreaAnalytic", "[", 
        RowBox[{"d", ",", "pos", ",", " ", "#"}], "]"}]}], "&"}], " ", "/@", 
     " ", 
     RowBox[{"tc", "[", "Faces", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3938]:=",ExpressionUUID->"2a0a3d4f-9fca-4409-ad68-00efd98262eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FaceAreaCompiled", "[", "3", "]"}], ":=", 
   RowBox[{
    RowBox[{"FaceAreaCompiled", "[", "3", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"z", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"zz", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
           "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceAreaCompiled", "[", "2", "]"}], ":=", 
   RowBox[{
    RowBox[{"FaceAreaCompiled", "[", "2", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Abs", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}], "]"}]}], "\n", "\t\t\t", "]"}], ",",
           "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceAreaAnalytic", "[", 
    RowBox[{"3", ",", " ", "positions_", ",", " ", "triples_"}], "]"}], ":=", 
   "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
       RowBox[{"unNormalVector3D", "=", 
        RowBox[{"Function", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
           "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "=", 
           RowBox[{"data", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"unNormalVector3D", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
       "triples"}]}], "\n", "]"}]}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"FaceAreaAnalytic", "[", 
   RowBox[{"2", ",", " ", "positions_", ",", " ", "triples_"}], "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"unNormalVector3D", "=", 
       RowBox[{"Function", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], ",",
            "\n", "\t\t\t", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "xx"}], " ", "y"}], "+", 
               RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "]"}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"unNormalVector3D", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "triples"}]}], "\n", "]"}], " "}]}], "Code",
 CellLabel->
  "In[3944]:=",ExpressionUUID->"b05096c8-cccb-4a62-8f5e-3eadb3574667"]
}, Closed]],

Cell[CellGroupData[{

Cell["PlaneAngle[]", "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "::", "tripleform"}], "=", "$tripleformError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "::", "triples"}], "=", "$tripleError"}], 
  ";"}]}], "Code",
 CellLabel->
  "In[3948]:=",ExpressionUUID->"85e56c67-2bab-445d-9c45-3aa8de10dd5c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaneAngle", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     "tripleList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"tripleArgumentsQ", "[", 
    RowBox[{
    "\"\<PlaneAngle\>\"", ",", " ", "positions", ",", " ", "tripleList"}], 
    "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"PlaneAngleInternal", "[", 
   RowBox[{"positions", ",", " ", "tripleList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     "tripleList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"tripleArgumentsQ", "[", 
    RowBox[{
    "\"\<PlaneAngle\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
     "tripleList"}], "]"}]}], ":=", "\n", "\t", 
  RowBox[{"PlaneAngleInternal", "[", 
   RowBox[{"positions", ",", " ", "tripleList"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "tripleList_"}], " ", "]"}],
    " ", "/;", " ", 
   RowBox[{"tripleArgumentsQ", "[", 
    RowBox[{"\"\<PlaneAngle\>\"", ",", " ", "m", ",", " ", "tripleList"}], 
    "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"PlaneAngleInternal", "[", 
   RowBox[{
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "tripleList"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3951]:=",ExpressionUUID->"39e4fbce-94cb-4ec1-909a-9be6211b734a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaneAngleInternal", "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "triples_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"PlaneAngleCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"pos", ",", "triples"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngleInternal", "[", 
   RowBox[{"pos_", ",", "triples_"}], "]"}], " ", ":=", " ", 
  RowBox[{"PlaneAngleAnalytic", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "pos", ",", "triples"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3955]:=",ExpressionUUID->"c161f406-b316-4337-bc62-09fbc7236f0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaneAngleCompiled", "[", "3", "]"}], ":=", 
  RowBox[{
   RowBox[{"PlaneAngleCompiled", "[", "3", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"PlaneAngleCompiled", "[", "2", "]"}], "=", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "\n", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[3957]:=",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlaneAngleAnalytic", "[", 
   RowBox[{"3", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3959]:=",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlaneAngleAnalytic", "[", 
   RowBox[{"2", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[3960]:=",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],

Cell[CellGroupData[{

Cell["TorsionalFoldAngle[]", "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "pos"}], "=", "$positionError"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "TorsionalFolds"}], "=", 
   "$TorsionalFoldError"}], ";"}]}], "Code",
 CellLabel->
  "In[3961]:=",ExpressionUUID->"b80bf0d1-baf4-427d-be8d-d95034e606a0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TorsionalFoldAngle", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"_", "?", "VertexCoordinatesQ"}], ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], " ", "]"}], 
    " ", "/;", " ", 
    RowBox[{"torsionalFoldArgumentsQ", "[", 
     RowBox[{"\"\<TorsionalFoldAngle\>\"", ",", "m", ",", "edgeList"}], 
     "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
      "2"}], ",", "\n", "\t\t", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Length", "[", "edgeList", "]"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"TorsionalFoldAngleInternal", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
       RowBox[{"listQuadruples", "[", 
        RowBox[{"m", ",", "edgeList"}], "]"}]}], " ", "]"}]}], "\n", "\t", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"pos_", "?", "MatrixQ"}], ",", " ", "edgeList_"}], " ", "]"}], 
    " ", "/;", " ", 
    RowBox[{"torsionalFoldArgumentsQ", "[", 
     RowBox[{
     "\"\<TorsionalFoldAngle\>\"", ",", "m", ",", " ", "pos", ",", " ", 
      "edgeList"}], "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", "\n", 
     "\t\t", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Length", "[", "edgeList", "]"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"TorsionalFoldAngleInternal", "[", 
      RowBox[{"m", ",", " ", "pos", ",", " ", 
       RowBox[{"listQuadruples", "[", 
        RowBox[{"m", ",", "edgeList"}], "]"}]}], " ", "]"}]}], "\n", "\t", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"__", "?", "VertexCoordinatesQ"}], "}"}]}], ",", " ", 
      "edgeList_"}], " ", "]"}], " ", "/;", " ", 
    RowBox[{"torsionalFoldArgumentsQ", "[", 
     RowBox[{"\"\<TorsionalFoldAngle\>\"", ",", "m", ",", "edgeList"}], 
     "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"quadruples", " ", "=", " ", 
       RowBox[{"listQuadruples", "[", 
        RowBox[{"m", ",", "edgeList"}], "]"}]}], "}"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", 
          RowBox[{"m", ",", "#"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"Length", "[", "edgeList", "]"}]}], "]"}], ",", " ", 
           RowBox[{"TorsionalFoldAngleInternal", "[", 
            RowBox[{"m", ",", "#", ",", "quadruples"}], "]"}]}], "]"}], ",", 
         "\n", "\t\t\t", "$Failed"}], "\n", "\t\t", "]"}], "&"}], " ", "/@", 
      " ", "positions"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"listQuadruples", "[", 
   RowBox[{"m_", ",", "edgelist_"}], "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"Faces", "=", 
      RowBox[{
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<edges\>\"", "\[Rule]", "\"\<ordered faces\>\""}]}], 
        "]"}], "[", 
       RowBox[{"[", " ", 
        RowBox[{"MechanismEdges", "[", 
         RowBox[{"m", ",", " ", "edgelist"}], "]"}], " ", "]"}], "]"}]}], 
     "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"ToPackedArray", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "==", "2"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"Last", "@", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", "0", ",", "0"}], 
          "}"}]}], "\n", "\t\t", "]"}], "&"}], "/@", "Faces"}], "\n", "\t", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[3963]:=",ExpressionUUID->"105425f9-6faa-403b-bf41-cd3b92587bc2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TorsionalFoldAngleInternal", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "quadruples_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"TorsionalFoldAngleCompiled", "[", "]"}], "[", 
   RowBox[{"positions", ",", "quadruples"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngleInternal", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     "quadruples_"}], "]"}], ":=", 
   RowBox[{"TorsionalFoldAngleAnalytic", "[", 
    RowBox[{"positions", ",", "quadruples"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngleCompiled", "[", "]"}], ":=", 
   RowBox[{
    RowBox[{"TorsionalFoldAngleCompiled", "[", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", 
      RowBox[{"Table", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], "==", "0"}], ",", 
          "\n", "\t", "0", ",", "\n", "\t", 
          RowBox[{"With", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t", 
             RowBox[{
              RowBox[{"p1x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "3"}], 
                "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3y"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3z"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3y"}], "-", 
                  RowBox[{"p2y", " ", "p3z"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], 
               " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
                 RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
                 RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
                 RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
                 RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
                 RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
                 RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p1z", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2x", " ", "p3y"}], "-", 
                    RowBox[{"p3y", " ", "p4x"}], "+", 
                    RowBox[{"p2y", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
                    RowBox[{"p2x", " ", "p4y"}], "+", 
                    RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
                    RowBox[{"p2y", " ", "p3x"}], "+", 
                    RowBox[{"p1x", " ", "p3y"}], "-", 
                    RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
                 RowBox[{"p1y", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2z", " ", "p3x"}], "-", 
                    RowBox[{"p2x", " ", "p3z"}], "-", 
                    RowBox[{"p2z", " ", "p4x"}], "+", 
                    RowBox[{"p3z", " ", "p4x"}], "+", 
                    RowBox[{"p2x", " ", "p4z"}], "-", 
                    RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], 
             "]"}]}], "\n", "\t", "]"}]}], "]"}], ",", "\n", "\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "]"}], ",", 
      "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldAngleAnalytic", "[", 
   RowBox[{"positions_", ",", "quadrupleList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"With", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"p1x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p2x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p3x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p4x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}]}], 
       "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"expandExpression", "@", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3y"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3z"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3y"}], "-", 
             RowBox[{"p2y", " ", "p3z"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
            RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
            RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
            RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
            RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
            RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
            RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p1z", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2x", " ", "p3y"}], "-", 
               RowBox[{"p3y", " ", "p4x"}], "+", 
               RowBox[{"p2y", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
               RowBox[{"p2x", " ", "p4y"}], "+", 
               RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
               RowBox[{"p2y", " ", "p3x"}], "+", 
               RowBox[{"p1x", " ", "p3y"}], "-", 
               RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
            RowBox[{"p1y", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2z", " ", "p3x"}], "-", 
               RowBox[{"p2x", " ", "p3z"}], "-", 
               RowBox[{"p2z", " ", "p4x"}], "+", 
               RowBox[{"p3z", " ", "p4x"}], "+", 
               RowBox[{"p2x", " ", "p4z"}], "-", 
               RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], "]"}]}]}],
      "\n", "\t", "]"}], "&"}], "/@", "quadrupleList"}]}]}], "Code",
 CellLabel->
  "In[3969]:=",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Closed]],

Cell[CellGroupData[{

Cell["DiscreteGaussianCurvature[]", "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "::", "pos"}], "=", 
   "$positionError"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "::", "vertices"}], "=", 
   "$vertexError"}], ";"}]}], "Code",
 CellLabel->
  "In[3973]:=",ExpressionUUID->"e3cc1134-2603-4b48-a8e9-658a0ea43da5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DiscreteGaussianCurvature", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"_", "?", "VertexCoordinatesQ"}], ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "vertexList_"}], "]"}], " ",
    "/;", " ", 
   RowBox[{"vertexArgumentsQ", "[", 
    RowBox[{
    "\"\<DiscreteGaussianCurvature\>\"", ",", "m", ",", "vertexList"}], 
    "]"}]}], " ", ":=", "\n", "\t", 
  RowBox[{"DiscreteGaussianCurvatureInternal", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "vertexList"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     "vertexList_"}], "]"}], " ", "/;", " ", 
   RowBox[{"vertexArgumentsQ", "[", 
    RowBox[{
    "\"\<DiscreteGaussianCurvature\>\"", ",", "m", ",", "positions", ",", 
     "vertexList"}], "]"}]}], ":=", "\n", "\t", 
  RowBox[{"DiscreteGaussianCurvatureInternal", "[", 
   RowBox[{"m", ",", " ", "positions", ",", " ", "vertexList"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3975]:=",ExpressionUUID->"c2dc76eb-f1f2-4627-94b2-322d01f7c229"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvatureInternal", "[", 
    RowBox[{"m_", ",", " ", "pos_", ",", "vertexlist_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", 
      RowBox[{"Length", "[", "vertexlist", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
     "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DiscreteGaussianCurvatureInternal", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "vertexlist_"}], "]"}], ":=", "\n", "\t\t", 
  RowBox[{
   RowBox[{"DiscreteGaussianCurvatureCompiled", "[", "]"}], "[", 
   RowBox[{"pos", ",", "\n", "\t\t\t", 
    RowBox[{"ToPackedArray", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"PadRight", "[", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", 
          RowBox[{"\"\<vertices\>\"", "->", "\"\<ordered faces\>\""}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", "vertexlist", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", 
        RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], "]"}]}], "\n", "\t", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"DiscreteGaussianCurvatureInternal", "[", 
   RowBox[{"m_", ",", " ", "pos_", ",", "vertexlist_"}], "]"}], ":=", "\n", 
  "\t", 
  RowBox[{"DiscreteGaussianCurvatureAnalytic", "[", "\n", "\t\t", 
   RowBox[{"pos", ",", "\n", "\t\t", 
    RowBox[{"ToPackedArray", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{"RotateRight", ",", " ", 
        RowBox[{
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<vertices\>\"", " ", "\[Rule]", " ", 
            "\"\<ordered faces\>\""}]}], "]"}], "[", 
         RowBox[{"[", "vertexlist", "]"}], "]"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", 
        RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], "\n", "\t\t", "]"}]}], "\n",
    "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[3979]:=",ExpressionUUID->"983639bb-e7ad-4ed8-a16b-1a1e153cc30e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiscreteGaussianCurvatureCompiled", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"DiscreteGaussianCurvatureCompiled", "[", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "3"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", " ", "Pi"}], "-", 
          RowBox[{"Sum", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}], "==",
                "0"}], ",", "\n", "\t\t\t", "0", ",", "\n", "\t\t\t", 
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"x", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"y", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"z", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"xx", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"yy", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"zz", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", 
                "\n", "\t\t\t", 
                RowBox[{"ArcTan", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"x", " ", "xx"}], "+", 
                   RowBox[{"y", " ", "yy"}], "+", 
                   RowBox[{"z", " ", "zz"}]}], ",", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
                 "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "]"}], ",", 
            "\n", "\t\t", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j"}], "]"}], "]"}]}], "}"}]}], 
           RowBox[{"(*", " ", "Sum", " ", "*)"}], "\n", "\t", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], " ", 
      
      RowBox[{"(*", " ", "Table", " ", "*)"}], "\n", "\t", "]"}], ",", "\n", 
     "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]], "Code",
 CellLabel->
  "In[3982]:=",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiscreteGaussianCurvatureAnalytic", "[", 
   RowBox[{"pos_", ",", 
    RowBox[{"{", 
     RowBox[{"triples__", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], "}"}]}], 
   "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"expandExpression", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", "Pi"}], "-", 
        RowBox[{"Total", "[", 
         RowBox[{"PlaneAngle", "[", 
          RowBox[{"pos", ",", "#"}], "]"}], "]"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{"{", "triples", "}"}]}]}]], "Code",
 CellLabel->
  "In[3983]:=",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global geometry functions", "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],

Cell[CellGroupData[{

Cell["FindGeometricTransform[], AlignMechanism[]", "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_Origami", ",", " ", "r___"}], " ", "]"}], " ",
   "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FindGeometricTransform", "[", 
    RowBox[{"m1_Origami", ",", " ", "m2_Origami", ",", " ", "r___"}], "]"}], 
   " ", "^:=", " ", 
   RowBox[{"FindGeometricTransform", "[", " ", 
    RowBox[{
     RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", 
     RowBox[{"m2", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_Linkage", ",", " ", "r___"}], " ", "]"}], " ",
   "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"m1_Linkage", ",", " ", "m2_Linkage", ",", " ", "r___"}], "]"}], 
  " ", "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{
    RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", 
    RowBox[{"m2", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3984]:=",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "AlignMechanism", "]"}], "=", 
    RowBox[{"Options", "[", "FindGeometricTransform", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"AlignMechanism", "[", " ", 
   RowBox[{"from_", ",", " ", "to_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"fromPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "from", " ", "]"}]}], ",", " ", 
      RowBox[{"toPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "to", " ", "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"transform", " ", "=", " ", 
         RowBox[{"alignTransform", "[", " ", 
          RowBox[{"fromPos", ",", " ", "toPos", ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"transform", "[", " ", 
         RowBox[{"toPos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "/;", " ", 
        RowBox[{"transform", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
      RowBox[{"toPos", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[3988]:=",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"convert", " ", "the", " ", "arguments", " ", "appropriately"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"m1_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", "All"}], 
     "}"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"m1_", "?", "MechanismQ"}], " ", ",", " ", 
       RowBox[{"v", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", "v"}], "}"}], 
     " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Max", "[", "v", "]"}], " ", "\[LessEqual]", " ", 
       RowBox[{"m1", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "v", "]"}], ">", "0"}]}]}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m1_", "?", "MechanismQ"}], ",", " ", "v_"}], " ", "}"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"AlignMechanism", "::", "oob"}], ",", " ", "v"}], "]"}], ";", 
      " ", "$Failed"}], " ", ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"pos_", "?", "NumericCoordinatesQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"pos", ",", "All"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pos_", "?", "NumericCoordinatesQ"}], ",", " ", 
       RowBox[{"v", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pos", ",", "v"}], "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Max", "[", "v", "]"}], " ", "\[LessEqual]", " ", 
       RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "v", "]"}], " ", ">", " ", "0"}]}]}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pos_", "?", "NumericCoordinatesQ"}], ",", " ", "v_"}], " ", 
      "}"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"AlignMechanism", "::", "oob"}], ",", "v"}], "]"}], ";", " ", 
      "$Failed"}], " ", ")"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{"pos_", ",", " ", "v_"}], "}"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"AlignMechanism", "::", "num"}], "]"}], ";", " ", "$Failed"}], 
     ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "oob"}], " ", "=", " ", 
     "\"\<Specified vertices `1` are out of bounds of Mechanism.\>\""}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "num"}], " ", "=", " ", 
     "\"\<Vertex positions must be numerical.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[3990]:=",ExpressionUUID->"fc7c8ee8-7208-4bfb-b0d2-9a8e8f5faa83"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "find", " ", "the", " ", "geometric", " ", "transform", " ", "we", " ", 
    "need"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"alignTransform", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positionsFrom_", ",", "vFrom_"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"positionsTo_", ",", "vTo_"}], "}"}], ",", " ", "options_"}], 
     " ", "]"}], " ", ":=", " ", "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{"transformation", " ", "=", " ", 
         RowBox[{"FindGeometricTransform", "[", 
          RowBox[{
           RowBox[{"positionsFrom", "[", 
            RowBox[{"[", "vFrom", "]"}], "]"}], ",", " ", 
           RowBox[{"positionsTo", "[", 
            RowBox[{"[", "vTo", "]"}], "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"options", ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}],
                 ",", " ", 
                RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], 
               " ", "}"}]}], "}"}], "]"}]}], " ", "]"}]}], "\n", "}"}], ",", 
       "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "transformation", "]"}], " ", "===", " ", 
          "FindGeometricTransform"}], ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"AlignMechanism", "::", "gt"}], "]"}], ";", " ", 
          "$Failed"}], ",", " ", 
         RowBox[{"transformation", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}]}], "\n", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "positionsFrom", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Dimensions", "[", "positionsTo", "]"}]}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"alignTransform", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positionsFrom_", ",", "vFrom_"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"positionsTo_", ",", "vTo_"}], "}"}], ",", " ", "options_"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"AlignMechanism", "::", "match"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "gt"}], " ", "=", " ", 
     "\"\<Failed to find geometric transform.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "match"}], " ", "=", " ", 
     "\"\<Vertices are not of the same dimension and number.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[3999]:=",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"]
}, Closed]],

Cell[CellGroupData[{

Cell["CongruentMechanismQ[]", "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CongruentMechanismQ", "[", 
    RowBox[{"tolerance_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
        RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], "]"}], "[", " ", 
   RowBox[{"from_", ",", " ", "to_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", "from", " ", "]"}]}], ",", " ", 
      RowBox[{"toPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "to", " ", "]"}]}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"transform", " ", "=", " ", 
         RowBox[{"alignTransform", "[", " ", 
          RowBox[{"fromPos", ",", " ", "toPos", ",", " ", 
           RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
       
       RowBox[{
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"difference", " ", "=", " ", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"transform", "[", " ", 
               RowBox[{"toPos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "-", " ", 
              RowBox[{"fromPos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], " ", "}"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"difference", " ", ".", " ", "difference"}], " ", "<", " ",
            "tolerance"}]}], "\n", "\t\t", "]"}], " ", "/;", " ", 
        RowBox[{"transform", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
      RowBox[{"toPos", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4003]:=",ExpressionUUID->"a8f653e6-0073-4e26-88b3-b7e9ea5fa4e3"]
}, Closed]],

Cell[CellGroupData[{

Cell["BoundingRegion[]", "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_Linkage", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4004]:=",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionNearest[]", "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionNearest", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"RegionNearest", "[", " ", 
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4006]:=",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionMember[]", "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionMember", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", " ", 
   RowBox[{"RegionMember", "[", " ", 
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", " ", 
  
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4010]:=",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionBounds[]", "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4014]:=",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomPoint[]", "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4016]:=",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionCentroid[]", "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4018]:=",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionDistance[], SignedRegionDistance[]", "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4020]:=",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4022]:=",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]],

Cell[CellGroupData[{

Cell["tierEdges[] - experimental", "Subsubsection",ExpressionUUID->"629e0869-a792-448b-b759-8452461b16c9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"tierEdges", "::", "usage"}], "=", 
    "\"\<tierEdges[m] partitions the edges of a 2D Mechanism into tiers so \
that no two edges sharing a vertex are on the same tier.\>\""}], ";"}], 
  "*)"}]], "Code",
 CellLabel->
  "In[4024]:=",ExpressionUUID->"77d06f1b-f7ab-4500-a658-4079097e7227"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"selectEdgeTiers", "[", " ", 
    RowBox[{"{", 
     RowBox[{"edgeList_", ",", " ", "other_"}], "}"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"pass", " ", "=", 
       RowBox[{"Sort", "/@", 
        RowBox[{"(", 
         RowBox[{"List", "@@@", 
          RowBox[{"FindIndependentEdgeSet", "[", 
           RowBox[{"UndirectedEdge", "@@@", "edgeList"}], "]"}]}], ")"}]}]}], 
      "\n", "}"}], ",", "\[IndentingNewLine]", "\t", 
     RowBox[{"{", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{"Sort", " ", "/@", " ", "edgeList"}], ",", " ", 
         RowBox[{"Alternatives", "@@", "pass"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "pass", "}"}], ",", "other"}], "]"}]}], 
      "\[IndentingNewLine]", "\t", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"MechanismEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Reverse", "[", 
       RowBox[{
        RowBox[{"NestWhile", "[", 
         RowBox[{"selectEdgeTiers", ",", 
          RowBox[{"{", 
           RowBox[{"edges", ",", 
            RowBox[{"{", "}"}]}], "}"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"First", "[", "#", "]"}], "]"}], ">", "0"}], "&"}]}], 
         "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    
    RowBox[{
     RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
     "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"tierEdges", "::", "embdim"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "::", "embdim"}], "=", 
   "\"\<Mechanism embedding dimension must be 2.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4025]:=",ExpressionUUID->"63542191-1f62-4e2b-9a55-5238b3bb62ea"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["input/output", "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],

Cell[CellGroupData[{

Cell["SaveToFOLD[], LoadFromFOLD[]", "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],

Cell["\<\
Save the Mechanism using the FOLD specification \
(https://github.com/edemaine/TorsionalFold/blob/master/doc/spec.md)\
\>", "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"incrementVertices", "[", "d_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "+", "1"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"decrementVertices", "[", "d_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "-", "1"}], "&"}], "/@", "d"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"SaveToFOLD", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "filename_String"}], 
   " ", "]"}], ":=", "\n", 
  RowBox[{"Export", "[", 
   RowBox[{"filename", ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
      "\"\<file_spec\>\"", " ", "\[Rule]", " ", "$MechanismsVersion"}], ",", 
      "\n", "\t", 
      RowBox[{
      "\"\<file_creator\>\"", " ", "\[Rule]", " ", "\"\<Mechanisms\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<file_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<singleModel\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<creasePattern\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_attributes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Switch", "[", " ", 
          RowBox[{
           RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], ",", " ", 
           "2", ",", " ", "\"\<2D\>\"", ",", " ", "3", ",", " ", "\"\<3D\>\"",
            ",", "_", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "m", "]"}], "===", 
            RowBox[{"Origami", " ", ">", " ", "0"}]}], ",", " ", 
           "\"\<manifold\>\"", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"MechanismOrientedQ", "[", " ", "m", " ", "]"}], ",", " ", 
           "\"\<orientable\>\"", ",", " ", "\"\<nonOrientable\>\""}], " ", 
          "]"}]}], "\n", "\t", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_unit\>\"", " ", "\[Rule]", " ", "\"\<unit\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<vertices_coords\>\"", " ", "\[Rule]", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<edges_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"\"\<Faces_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"MechanismFaces", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\"\<JSON\>\""}], "]"}]}]}], "Code",
 CellLabel->
  "In[4029]:=",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "LoadFromFOLD", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"\"\<Face\>\"", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Face", "[", "#", "]"}], "&"}], ")"}]}], "}"}], ",", " ", 
      RowBox[{"Options", "[", "Origami", "]"}]}], " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"LoadFromFOLD", "[", 
   RowBox[{"filename_String", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"inputData", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", "\"\<JSON\>\""}], "]"}]}], ",", "\n", "\t", 
      "coords", ",", "edges", ",", "Faces"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"inputData", " ", "===", " ", "$Failed"}], ",", "\n", "\t\t", 
      "$Failed", ",", "\n", "\n", "\t\t", 
      RowBox[{
       RowBox[{"coords", "=", 
        RowBox[{"\"\<vertices_coords\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"edges", "=", 
        RowBox[{"\"\<edges_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"Faces", "=", 
        RowBox[{"\"\<Faces_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\n", "\t\t", 
       RowBox[{"Origami", "[", " ", 
        RowBox[{"coords", ",", " ", 
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\"\<Face\>\"", "]"}], " ", "/@", " ", 
           
           RowBox[{"incrementVertices", " ", "/@", " ", "Faces"}]}], "]"}], 
         ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "Origami", "]"}]}], "]"}]}], " ", 
        "]"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4032]:=",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[4034]:=",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms`rigidity: rigidity and Linkage functions", "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[4036]:=",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToLinkage", "::", "usage"}], "=", "\n", 
    "\"\<ToLinkage[ obj ] attempts to create a Linkage from some other object \
(e.g. Graph[], MeshRegion[], etc.). It takes the same options as Linkage[].\>\
\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomCellNetwork", "::", "usage"}], "=", 
   "\"\<RandomCellNetwork[n] returns a random network of cells that can be \
tesselated in 2D.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "::", "usage"}], "=", 
    "\"\<RandomTriangulatedNetwork[n] returns a random triangulated network \
that can be tesselated in 2D.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Henneberg", "::", "usage"}], "=", 
   "\"\<Henneberg[1][vertices, label -> pos] is an Henneberg operation of \
type 1 that creates a new vertex at a position and attaches it to vertices.\n\
Henneberg[2][ {v1,v2,v3},label -> pos] is a Henneberg operation of type 2 \
that subdivides an edge {v1,v2} and places the new vertex and connects it to \
vertex v3.\nHenneberg[t][pos] is a random Henneberg operation of type t, \
placing the new vertex at position pos.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4037]:=",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellData", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCellData[ m, cellPattern ] returns the equilibrium data \
cells matching a pattern.\nMechanismCellData[ m, positions, cellPattern ] \
uses provided vertex positions to compute equilibrium data where not \
specified explicitly.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstrainedCells", "::", "usage"}], "=", 
   "\"\<MechanismConstrainedCells[m] returns a list of cells with infinite \
stiffness.\nMechanismConstrainedCells[m , {head, indices}] returns a list of \
cells matching the specification with infinite stiffness.\n\
MechanismConstrainedCells[m, patt] returns a list of cells matching a pattern \
with infinite stiffness.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4041]:=",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Constraints", "::", "usage"}], "=", 
   "\"\<Constraints is an option in the Mechanisms package to specify \
additional mechanism constraints.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CellPattern", "::", "usage"}], "=", 
   "\"\<CellPattern is an option in the Mechanisms package to specify \
patterns for cells.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EliminationRules", "::", "usage"}], "=", 
   "\"\<EliminationRules is an option in the Mechanisms package to specify a \
set of replacement rules for vertex displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AddedEnergy", "::", "usage"}], "=", 
   "\"\<AddedEnergy is an option in the Mechanisms package for additional \
terms added to an energy.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstraintOutput", "::", "usage"}], "=", 
   "\"\<ConstraintOutput is an option for MechanismConstraintEquations and \
related functions to determine that can take the value VertexPosition or \
VertexDisplacement.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"StepSize", "::", "usage"}], "=", 
   "\"\<StepSize is an option for MechanismIsometricTrajectory[] to set the \
step size used to traverse the configuration space.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OutputVariables", "::", "usage"}], "=", 
   "\"\<OutputVariables is an option for MechanismInfinitesimalMotions to \
specify names for the output variables.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InitialPositions", "::", "usage"}], "=", 
   "\"\<InitialPositions is an option in the mechanisms package to specify \
initial positions.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexMass", "::", "usage"}], "=", 
   "\"\<VertexMass is an option in the Mechanisms package to add mass to the \
vertices of a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexDrag", "::", "usage"}], "=", 
   "\"\<VertexDrag is an option in the mechanisms package to add drag to the \
vertices of a mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4043]:=",ExpressionUUID->"6df18a0e-6370-480c-a4c0-79be3746c9f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstraintEquations", "::", "usage"}], "=", "\n", 
    "\"\<MechanismConstraintEquations[\!\(\*StyleBox[\(m\*StyleBox[\"echanism\
\",FontSlant->\"Italic\"]\)]\)(, \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)), \
\!\(\*StyleBox[\"order\",FontSlant->\"Italic\"]\)] returns constraint \
equations valid to some order in the displacements.\n\
\!\(\*StyleBox[\"order\",FontSlant->\"Italic\"]\) should be 1, 2 or Infinity.\
\n\nOption ConstraintOutput should be set to either VertexPosition or \
VertexDisplacement to determine the form of the output.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<MechanismEnergy[ m\!\(\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\
\) ] returns an energy expression for a Mechanism.\nMechanismEnergy[ \
m\!\(\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\) ] returns an energy \
expression for vertices at arbitrary positions but using the provided \
positions to determine equilibrium parameters where necessary.\n\nSee \
$DefaultMechanismStiffnesses to determine how MechanismEnergy[] sets the \
default stiffnesses when the stiffness is Infinity.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<CompiledMechanismEnergy[ \
m\!\(\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\) ] compiles an energy \
and gradient for a Mechanism.\nCompiledMechanismEnergy[ \
m\!\(\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\) ] compiles an energy and gradient for a Mechanism starting from a set of \
positions.\n\nUndefined symbols in the energy must be set using ReplaceAll[], \
/.\nOptions:\n  \\\"AddToEnergy\\\" -> energy allows additional terms, \
written as a function of VertexPosition[], to be added to the energy and \
compiled.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergyQ", "::", "usage"}], "=", "\n", 
    "\"\<CompiledMechanismEnergyQ[ energy ] returns True if and only if \
energy is a CompiledMechanismEnergy[] object.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "::", "usage"}], "=", 
   "\"\<$DefaultMechanismStiffnesses[\!\(\*StyleBox[\"component\",FontSlant->\
\"Italic\"]\)] returns the default stiffness in case the constraint is rigid.\
\nUse $DefaultMechanismStiffnesses[\\\"Constraints\\\"] to find the stiffness \
of added constraints.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4053]:=",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstraintMatrix", "::", "usage"}], "=", 
    "\"\<MechanismConstraintMatrix[ m ] returns a constraint matrix for the \
first-order constraints.\nMechanismConstraintMatrix[ m, positions ] returns a \
constraint matrix using positions to determine matrix element.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismAugmentedConstraintMatrix", "::", "usage"}], "=", 
    "\"\<Experimental!\nMechanismAugmentedConstraintMatrix[m , pi] returns an \
augmented constraint matrix for mechanism m with periodic data pi.\nThe \
augmented constraint matrix has 3 additional degrees of freedoms in 2D and 6 \
additional degrees of freedom in 3D corresponding to deformations of the \
lattice vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismZeroModes", "::", "usage"}], "=", 
    "\"\<MechanismZeroModes[m] returns a list of numerical zero modes (linear \
isometries) associated with the constraints of Mechanism m.\n\nIt takes the \
options of MechanismConstraintMatrix[] and Eigensystem. Option Tolerance can \
be used to set a numerical value to correspond to 0.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismSelfStresses", "::", "usage"}], "=", 
    "\"\<MechanismSelfStresses[m] returns a list of numerical self-stresses \
() modes associated with the constraints of Mechanism m.\n\nIt takes the \
options of MechanismConstraintMatrix[] and Eigensystem. Option Tolerance can \
be used to set a numerical value to correspond to 0.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismInfinitesimalMotions", "::", "usage"}], "=", "\n", 
    "\"\<MechanismInfinitesimalMotions[\!\(\*StyleBox[\\\"Mechanism\\\",\
FontSlant->\\\"Italic\\\"]\)(, \!\(\*StyleBox[\\\"positions\\\",FontSlant->\\\
\"Italic\\\"]\))] returns a list of two elements: an Infinitesimal linear \
motion and, if necessary, a list of quadratic constraints they must satisfy.\n\
\nUse option OutputVariables to control the form of the output.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismStressMatrix", "::", "usage"}], "=", "\n", 
   "\"\<MechanismStressMatrix[ m, vec ] returns a stress matrix associated \
with the stress vector vec. The (i,j) component of the stress matrix is the \
negative of the corresponding stress vector component (and zero otherwise) \
and diagonal components are chosen so that rows and columns sum to zero.\n\n\
(see Connelly on generic global rigidity)\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4058]:=",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<MinimizeMechanismEnergy[\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)], MinimizeMechanismEnergy[ \!\
\(\*StyleBox[\(m\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\)]\), \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\) ] minimizes the energy of \
a Mechanism, returning {\!\(\*StyleBox[\"minimum\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"mininal\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\n\nThe optional argument \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)can be either an expression or a compiled \
Mechanism energy.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDynamicalSystem", "::", "usage"}], "=", "\n", 
    "\"\<MechanismDynamicalSystem[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant-\
>\"Italic\"]\)\!\(\*StyleBox[\"initial\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"initial\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"velocities\",FontSlant->\"Italic\"\
]\)\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"variable\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\)] returns a list of functions \
specifying how vertices will move as a function of \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\).\n\nUse options VertexMass \
and VertexDrag to set the mass and drag coefficient for the particles.\>\""}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDynamicalSystemEquations", "::", "usage"}], "=", "\n", 
    "\"\<MechanismDynamicalSystemEquations[\!\(\*StyleBox[\"mech\",FontSlant->\
\"Italic\"]\), {\!\(\*StyleBox[\"variable\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)}] returns dynamical \
equations for vertex positions, using \!\(\*StyleBox[\"variable\",FontSlant->\
\"Italic\"]\) as vertex names, and \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\) as the symbol for time.\n\n\
Use options VertexMass and VertexDrag to set the mass and drag coefficient \
for the particles.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "usage"}], "=", 
   "\"\<MechanismMonteCarloRun[ m, \[Beta], n, distribution ] attempts n \
Monte Carlo steps at inverse temperature \[Beta] using a probability \
distribution.\nThe results are output as {list of energies, list of \
positions}.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4064]:=",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismIsometricTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<MechanismIsometricTrajectory[\!\(\*StyleBox[\"Mechanism\",FontSlant->\
\"Italic\"]\), \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] creates a trajectory using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) steps through the configuration \
space of a Mechanism starting in the\ndisplacement direction \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<MechanismFindMinimalTrajectory[\!\(\*StyleBox[\"Mechanism\",\
FontSlant->\"Italic\"]\), \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] attempts to find a valid \
trajectory from \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\) to \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\) configurations using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) intermediate steps.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenericGloballyRigidQ", "::", "usage"}], "=", "\n", 
   "\"\<GenericGloballyRigidQ[m] returns True if it can be determined that \
the system is generically globally rigid according to Connelly's criteria \
based on the stress matrix.\nIf it returns True, the specific Mechanism may \
still be non-rigid.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4068]:=",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data", "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[4071]:=",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"]
}, Open  ]],

Cell[CellGroupData[{

Cell["private rigidity functions", "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],

Cell[CellGroupData[{

Cell["linearMotions[]", "Subsection",ExpressionUUID->"99d232f2-b91d-458c-a3db-d922760b95e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "linearMotions", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "NullSpace", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"linearMotions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "rigidityMatrix_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", " ", 
      RowBox[{"lin", " ", "=", " ", 
       RowBox[{"NullSpace", "[", 
        RowBox[{"rigidityMatrix", ",", "opt"}], "]"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "lin", "]"}], ">", "0"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Partition", "[", " ", 
        RowBox[{
         RowBox[{"Orthogonalize", "[", "lin", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", "dim"}], "}"}]}], " ", "]"}], "[", 
       RowBox[{"[", " ", 
        RowBox[{"All", ",", " ", "All", ",", " ", "1"}], " ", "]"}], "]"}], 
      ",", "\n", "\t\t", 
      RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4074]:=",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],

Cell[CellGroupData[{

Cell["numericExpressionQ[]", "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "does", " ", "an", " ", "expression", " ", "evaluate", " ", "to", " ", "a",
     " ", "number", " ", "if", " ", "the", " ", "vertex", " ", "positions", 
    " ", "or", " ", "displacements", " ", "are", " ", 
    RowBox[{"set", "?"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"numericExpressionQ", "[", 
    RowBox[{"positions_", ",", " ", "expression_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reducedExpression", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], "[", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"expression", " ", "/.", " ", 
            RowBox[{"Dispatch", "@", 
             RowBox[{"PositionRules", "[", " ", 
              RowBox[{"N", "[", "positions", "]"}], " ", "]"}]}]}], " ", "/.",
            " ", 
           RowBox[{
            RowBox[{"VertexDisplacement", "[", 
             RowBox[{"_", ",", "_"}], "]"}], "\[Rule]", "0.001"}]}], "}"}], 
         " ", "]"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"NumericQ", "[", "reducedExpression", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{"Im", "[", "reducedExpression", "]"}], "]"}], "\[Equal]", 
       "0"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "In[4076]:=",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseExpression[]", "Subsection",ExpressionUUID->"8488fe5a-cff7-4dfa-ac4b-5654c56b2c7f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"TorsionalFoldAngle", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"DisplacementLength", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"DisplacementLengthSquared", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseValidTokenQ", "[", "_", "]"}], ":=", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseExtractTokens", "[", "expr_", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rawTokens", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Variables", "[", "expr", "]"}], ",", "parseValidTokenQ"}], 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], "/@", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"rawTokens", ",", "Head"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"TorsionalFoldAngle", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"TorsionalFoldAngle", "/@", "data"}], ")"}], " ", "\[Rule]", " ", 
    RowBox[{"TorsionalFoldAngle", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"DisplacementLength", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"DisplacementLength", "/@", "data"}], ")"}], " ", "\[Rule]", " ", 
    RowBox[{"DisplacementLength", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"DisplacementLengthSquared", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"DisplacementLengthSquared", "/@", "data"}], ")"}], " ", 
    "\[Rule]", " ", 
    RowBox[{"DisplacementLengthSquared", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}]}], "Code",\

 CellLabel->
  "In[4077]:=",ExpressionUUID->"379532fc-ab3b-4100-8b5e-6183b7f55947"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"parseComponentData", "[", 
    RowBox[{"m_", ",", "positions_", ",", 
     RowBox[{"RigidBar", "[", 
      RowBox[{"indices_", ",", "data_"}], "]"}]}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"lengths", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Automatic"}], ",", "#1", ",", "#2"}], 
            "]"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DisplacementLength", "[", 
             RowBox[{"positions", ",", "indices"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"stiffnesses", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"length", "/@", "indices"}], ")"}], "\[Rule]", "lengths"}], 
        "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"length", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "lengths"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lengthSquared", "/@", "indices"}], ")"}], "\[Rule]", 
         RowBox[{"lengths", "^", "2"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lengthSquared", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         RowBox[{"lengths", "^", "2"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"stiffness", "/@", "indices"}], ")"}], "\[Rule]", 
         "stiffnesses"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"stiffness", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "stiffnesses"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseComponentData", "[", 
    RowBox[{"m_", ",", "positions_", ",", 
     RowBox[{"TorsionalFoldAngle", "[", 
      RowBox[{"indices_", ",", "data_"}], "]"}]}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Automatic"}], ",", "#1", ",", "#2"}], 
            "]"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"DisplacementLength", "[", 
             RowBox[{"positions", ",", "indices"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"torsionalStiffnesses", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angle", "/@", "indices"}], ")"}], "\[Rule]", "angles"}], 
        "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angle", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "angles"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"torsionalStiffness", "/@", "indices"}], ")"}], "\[Rule]", 
         "torsionalStiffnesses"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"torsionalStiffness", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "torsionalStiffnesses"}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseComponentData", "[", 
   RowBox[{"m_", ",", "positions_", ",", "_"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[4085]:=",ExpressionUUID->"2e6066e1-9346-4cd8-aed9-3d85923df3d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"parseExpression", "[", 
   RowBox[{"m_", ",", "positions_", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"parsingRules", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"parseComponentData", "[", 
            RowBox[{"m", ",", "positions", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"m", "[", "\"\<cells\>\"", "]"}]}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"parseEvaluateTokens", "[", 
            RowBox[{"m", ",", 
             RowBox[{"VertexPosition", "[", "m", "]"}], ",", "#"}], "]"}], 
           "&"}], "/@", 
          RowBox[{"parseExtractTokens", "[", "expr", "]"}]}]}], "\n", "\t", 
        "}"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"expr", "//.", 
     RowBox[{"Dispatch", "[", "parsingRules", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4088]:=",ExpressionUUID->"1215db5f-4226-4914-976f-95e9ec2bdd56"]
}, Closed]],

Cell[CellGroupData[{

Cell["constraintVector[], reduceConstraintToOrder[]", "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"equationToExpressionParser", "=", 
    RowBox[{"{", "\[IndentingNewLine]", "\t", 
     RowBox[{
      RowBox[{"a_And", ":>", 
       RowBox[{"List", "@@", "a"}]}], ",", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Equal", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
       RowBox[{"a", "-", "b"}]}], ",", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Equal", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"a", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "-", 
        RowBox[{"{", "b", "}"}]}]}]}], "\[IndentingNewLine]", "}"}]}], ";"}], 
  "\n", "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"constraintVector", "[", " ", 
      RowBox[{"positions", ",", " ", "constraints"}], " ", "]"}], " ", 
     "takes", " ", "arbitrary", " ", "constraints"}], ",", " ", 
    RowBox[{
    "written", " ", "as", " ", "equations", " ", "or", " ", "in", " ", "some",
      " ", "other", " ", "form"}], ",", "\n", 
    RowBox[{"parses", " ", "them"}], ",", " ", 
    RowBox[{
    "and", " ", "returns", " ", "a", " ", "standard", " ", "vector", " ", 
     "map", " ", "from", " ", "positions", " ", "to", " ", "a", " ", 
     RowBox[{"\"\<constraint space\>\"", "."}]}]}], "\n", "*)"}], "\n", "\n", 
  
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"get", " ", "a", " ", "set", " ", "of", " ", "user"}], "-", 
    RowBox[{
    "specified", " ", "constraints", " ", "into", " ", "the", " ", "form", 
     " ", "of", " ", "a", " ", "vector", " ", "equal", " ", "to", " ", "zero",
      " ", "when", " ", "constraints", " ", "are", " ", "satisfied"}]}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"constraintVector", "[", 
   RowBox[{"positions_", ",", "None"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"constraintVector", "[", 
   RowBox[{"positions_", ",", "constraints_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"equations", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"{", "constraints", "}"}], " ", "//.", " ", 
         "equationToExpressionParser"}], "]"}]}], ",", "\n", 
      RowBox[{"dimensions", "=", 
       RowBox[{"Dimensions", "[", "positions", "]"}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"equations", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"DisplacementRules", "[", " ", 
       RowBox[{
        RowBox[{"VertexPosition", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"dimensions", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
          RowBox[{"All", "[", 
           RowBox[{"dimensions", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], " ", "]"}], " ", "-", 
        " ", "positions"}], "]"}], "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"equationToExpression", "[", 
      RowBox[{"Equal", "[", 
       RowBox[{"a_", ",", "b_"}], "]"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"a", "-", 
       RowBox[{"b", "\n", 
        RowBox[{"equationToExpression", "[", 
         RowBox[{"Equal", "[", 
          RowBox[{"a_", ",", "b__"}], "]"}], "]"}]}]}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"a", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "-", 
        RowBox[{
         RowBox[{"{", "b", "}"}], "\n", 
         RowBox[{"equationToExpression", "[", "a_And", "]"}]}]}], ":=", 
       RowBox[{
        RowBox[{
         RowBox[{"equationToExpression", "[", 
          RowBox[{"List", "@@", "a"}], "]"}], "\n", 
         RowBox[{"equationToExpression", "[", 
          RowBox[{"a", ":", 
           RowBox[{"Except", "[", 
            RowBox[{"_Equal", "|", "_And"}], "]"}]}], "]"}]}], ":=", 
        RowBox[{"a", "\n", 
         RowBox[{"SetAttributes", "[", 
          RowBox[{"equationToExpression", ",", "Listable"}], "]"}]}]}]}]}]}], 
    ";"}], "\n", "*)"}]}]}], "Code",
 CellLabel->
  "In[4089]:=",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", " ", 
     RowBox[{"positions", ",", " ", "constraintMap", ",", " ", "order"}], " ",
      "]"}], " ", "changes", " ", "the", " ", "order", " ", "of", " ", "the", 
    " ", "constraint", " ", 
    RowBox[{"map", "."}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "express", " ", "the", " ", "constraints", " ", "to", " ", "be", " ", 
    "valid", " ", "at", " ", "a", " ", "certain", " ", "order"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"positions_", ",", "constraintVector_", ",", 
      RowBox[{"order_Integer", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">=", "0"}], "&"}], ")"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"dimensions", "=", 
         RowBox[{"Dimensions", "[", "positions", "]"}]}], ",", "\n", 
        "expandedExpression", ",", "x"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"expandedExpression", " ", "=", " ", 
        RowBox[{"constraintVector", " ", "/.", " ", 
         RowBox[{"Dispatch", "[", " ", 
          RowBox[{"PositionRules", "[", " ", 
           RowBox[{"positions", " ", "+", " ", 
            RowBox[{"x", " ", 
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
               RowBox[{"All", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}]}], "]"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Total", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"expandedExpression", ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "#"}], "}"}]}], "]"}], "/", 
            RowBox[{"Factorial", "[", "#", "]"}]}], "&"}], " ", "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "order"}], "]"}]}], " ", "/.", " ", 
         RowBox[{"x", "\[Rule]", "0"}]}], "]"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"positions_", ",", "constraintVector_", ",", "_"}], "]"}], ":=", 
    "constraintVector"}]}]}]], "Code",
 CellLabel->
  "In[4092]:=",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
solveLinearConstraints[], dynamicVariables[], processConstraintEquations[], \
nonlinearConstraintVector[]\
\>", "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Fastest", " ", "way", " ", "to", " ", "pull", " ", "out", " ", 
    "equations", " ", "that", " ", "are", " ", "definitely", " ", "linear", 
    " ", "and", " ", "can", " ", "be", " ", "solved", " ", "explicitly"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"linearEquationQ", "[", 
     RowBox[{"eq_", ",", "var_"}], "]"}], ":=", 
    RowBox[{"VectorQ", "[", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"eq", ",", 
        RowBox[{"{", "var", "}"}]}], "]"}], ",", "NumericQ"}], "]"}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"given", " ", "a", " ", "set", " ", "constraints"}], ",", " ", 
     RowBox[{
     "select", " ", "out", " ", "the", " ", "linear", " ", "ones", " ", "and",
       " ", "solve", " ", 
      RowBox[{"them", "."}]}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"solveLinearEquations", "[", 
     RowBox[{"constraintVec_", ",", " ", "var_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "soln", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Quiet", "[", " ", 
        RowBox[{"soln", " ", "=", " ", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", " ", 
             RowBox[{"constraintVec", ",", " ", 
              RowBox[{
               RowBox[{"linearEquationQ", "[", 
                RowBox[{"#", ",", " ", "var"}], "]"}], "&"}]}], " ", "]"}], 
            " ", "\[Equal]", " ", "0"}], ",", " ", "var"}], " ", "]"}]}], " ",
         "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "soln", "]"}], " ", "=!=", " ", "Solve"}], ",",
          " ", 
         RowBox[{"soln", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4094]:=",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"processConstraintEquations", "[", " ", 
    RowBox[{
     RowBox[{"initial", " ", "positions"}], ",", " ", 
     RowBox[{"constraint", " ", "equations"}]}], " ", "]"}], "\n", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"processConstraintEquations", "[", 
     RowBox[{"positions_", ",", " ", "constraintEq_"}], "]"}], " ", ":=", " ",
     "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"constraints", " ", "=", " ", 
         RowBox[{"constraintVector", "[", " ", 
          RowBox[{"positions", ",", " ", "constraintEq"}], " ", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"Array", "[", " ", 
           RowBox[{"VertexPosition", ",", " ", 
            RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}]}], 
        ",", "\n", "\t", "linearEquationSelector", ",", "\n", "\t", 
        "solvedLinearConstraints", ",", "\n", "\t", "constrainedPositions"}], 
       "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"linearEquationSelector", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"linearEquationQ", "[", 
           RowBox[{"#", ",", " ", "vars"}], "]"}], "&"}], " ", "/@", " ", 
         "constraints"}]}], ";", "\n", "\t", 
       RowBox[{"solvedLinearConstraints", " ", "=", " ", 
        RowBox[{"Quiet", "[", " ", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Pick", "[", " ", 
             RowBox[{"constraints", ",", " ", "linearEquationSelector"}], " ",
              "]"}], " ", "\[Equal]", " ", "0"}], ",", " ", "vars"}], " ", 
          "]"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "solvedLinearConstraints", "]"}], " ", "===", 
          " ", "Solve"}], ",", "\n", "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"\"\<linear solutions\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", " ", "\n", "\t\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Array", "[", 
             RowBox[{"VertexPosition", ",", " ", 
              RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], 
           ",", "\n", "\t\t\t", 
           RowBox[{
           "\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            "constraints"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t", "\n", 
         "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{
           "rules", " ", "that", " ", "solve", " ", "the", " ", "linear", " ",
             "constraints"}], "*)"}], "\n", "\t\t", 
          RowBox[{
           RowBox[{"\"\<linear solutions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"First", "[", "solvedLinearConstraints", "]"}]}], ",", 
           "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "positions", " ", "with", " ", "linear", " ", "solutions", " ", 
             "applied"}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"(", " ", 
             RowBox[{"constrainedPositions", " ", "=", " ", 
              RowBox[{
               RowBox[{"Array", "[", 
                RowBox[{"VertexPosition", ",", " ", 
                 RowBox[{"Dimensions", "[", "positions", "]"}]}], "]"}], " ", 
               "/.", " ", 
               RowBox[{"Dispatch", "[", 
                RowBox[{"First", "[", "solvedLinearConstraints", "]"}], 
                "]"}]}]}], " ", ")"}]}], ",", "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{"remaining", " ", "nonlinear", " ", "constraints"}], 
            "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Pick", "[", " ", 
             RowBox[{
             "constraints", ",", " ", "linearEquationSelector", ",", " ", 
              "False"}], " ", "]"}]}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"nonlinearConstraintVector", "[", 
     RowBox[{"positions_", ",", " ", "constraintEq_"}], "]"}], " ", ":=", " ",
     "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"constraints", " ", "=", " ", 
         RowBox[{"constraintVector", "[", " ", 
          RowBox[{"positions", ",", " ", "constraintEq"}], " ", "]"}]}], ",", 
        " ", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"Array", "[", 
           RowBox[{"VertexPosition", ",", " ", 
            RowBox[{"Dimensions", "[", "positions", "]"}]}], "]"}], " ", 
          "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"Select", "[", " ", 
       RowBox[{"constraints", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"linearEquationQ", "[", 
           RowBox[{"#", ",", "vars"}], "]"}], "&"}], " ", "/@", " ", 
         "constraintEq"}]}], "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4096]:=",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "is", " ", "an", " ", "old", " ", "version", " ", "of", " ", 
    "the", " ", "function", " ", "that", " ", "will", " ", "be", " ", 
    "removed", " ", "eventually"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"dynamicVariables", "[", 
     RowBox[{"m_", ",", " ", "pinnedVertices_", ",", "initialPositions_"}], 
     "]"}], ":=", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", 
     RowBox[{
      RowBox[{"Cases", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", 
            RowBox[{"Flatten", " ", "@", " ", "initialPositions"}]}], "}"}], 
          "]"}], " ", "/.", " ", "pinnedVertices"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"_VertexPosition", ",", "_"}], "}"}]}], "\n", "\t", "]"}], 
      ",", " ", "First"}], " ", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions_", ",", " ", "processedConstraints_Association"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions", ",", " ", 
      RowBox[{
      "processedConstraints", "[", "\"\<constrained positions\>\"", "]"}]}], 
     " ", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions_", ",", " ", "constrainedPositions_"}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", " ", 
     RowBox[{
      RowBox[{"Cases", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Flatten", " ", "@", " ", "constrainedPositions"}], ",", 
           " ", 
           RowBox[{"Flatten", " ", "@", " ", "positions"}]}], " ", "}"}], " ",
          "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"_VertexPosition", ",", " ", "_"}], "}"}]}], "\n", "\t", 
       "]"}], ",", " ", "First"}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4098]:=",ExpressionUUID->"d950c243-7cbd-4fa7-9959-4787123d60ec"]
}, Closed]],

Cell[CellGroupData[{

Cell["evaluateEnergy[]", "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
       "positions"}], "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"energy", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "positions", "]"}], ",", 
     RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
     RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"energy", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "[", 
    RowBox[{"positions", ",", 
     RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n", 
  "\t"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
       "positions"}], "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"energy", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "positions", "]"}], ",", 
     RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"evaluateEnergy", "[", 
   RowBox[{
    RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
    RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", "\n",
   "\t", 
  RowBox[{
   RowBox[{"energy", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[4101]:=",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],

Cell[CellGroupData[{

Cell["analyticEnergyQ[]", "Subsection",ExpressionUUID->"8bb00a64-b11b-49dc-8019-90801a7f898c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"analyticEnergyQ", "[", 
    RowBox[{"Automatic", " ", ",", " ", "positions_"}], "]"}], ":=", "True"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"analyticEnergyQ", "[", 
   RowBox[{"energyExpression_", " ", ",", " ", "positions_"}], "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"number", " ", "=", " ", 
      RowBox[{"N", "[", " ", 
       RowBox[{"energyExpression", " ", "/.", " ", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}], " ", 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Im", "[", 
       RowBox[{"Chop", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
      "0"}], " ", "&&", " ", 
     RowBox[{"NumericQ", "[", "number", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Chop", "[", 
       RowBox[{"Im", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
      "0"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4109]:=",ExpressionUUID->"d5b77de4-6377-4475-99bc-9c004e543f84"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["modifying and creating linkages", "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],

Cell[CellGroupData[{

Cell["ToLinkage[]", "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshCells", "[", " ", "mr_MeshRegion", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
     RowBox[{"Table", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"MeshCells", "[", " ", 
            RowBox[{"mr", ",", " ", 
             RowBox[{"{", 
              RowBox[{"i", ",", " ", "#"}], "}"}]}], " ", "]"}], ",", " ", 
           RowBox[{"getProperties", "[", " ", 
            RowBox[{"mr", ",", " ", "i", ",", " ", "#"}], " ", "]"}]}], " ", 
          "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"Range", "[", " ", 
         RowBox[{"MeshCellCount", "[", " ", 
          RowBox[{"mr", ",", " ", "i"}], " ", "]"}], " ", "]"}]}], ",", "\n", 
       "\t\t", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "2"}], "}"}]}], "\n", "\t", "]"}]}], "\n",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"getProperties", "[", " ", 
   RowBox[{"mr_MeshRegion", ",", " ", "d_", ",", " ", "cell_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"#", " ", "\[Rule]", " ", 
     RowBox[{"PropertyValue", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mr", ",", " ", 
         RowBox[{"{", 
          RowBox[{"d", ",", " ", "cell"}], "}"}]}], "}"}], ",", " ", "#"}], 
      " ", "]"}]}], " ", "&"}], " ", "/@", " ", 
   "$meshRegionProperties"}]}]}], "Code",
 CellLabel->
  "In[4111]:=",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ToLinkage", "]"}], "=", 
    RowBox[{"Options", "[", "Linkage", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{"mr_MeshRegion", " ", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"meshCells", "[", "mr", "]"}], " ", "/.", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Line", " ", "->", " ", "RigidBar"}], ",", " ", 
        RowBox[{"Polygon", " ", "->", " ", "Face"}]}], "}"}]}], ",", "\n", 
     "\t", "opt"}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g_Graph", ",", "data___"}], "}"}], ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", 
      RowBox[{"g", ",", "data"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"RigidBar", "[", 
        RowBox[{"List", "@@", "#"}], "]"}], "&"}], " ", "/@", " ", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ",", "\n", "\t", "opt"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{"g_Graph", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", "g", "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"RigidBar", "[", 
        RowBox[{"List", "@@", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ",", "\n", "\t", "opt"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "::", "bad"}], "=", 
   "\"\<Unable to turn `1` into a Linkage.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ToLinkage", "[", " ", 
   RowBox[{"obj_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"ToLinkage", "::", "bad"}], ",", " ", 
     RowBox[{"Head", "[", "obj", "]"}]}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "In[4113]:=",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomCellNetwork[]", "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "RandomCellNetwork", "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\"\<Faces\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<Map\>\"", "\[Rule]", "Identity"}]}], " ", "}"}], ",", 
       " ", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], ";"}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"#", ">", "0"}], " ", "&"}], " ", ")"}]}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", "j", ",", "selectedPrimitives", ",", " ", "positions", ",", 
        " ", "mappedPositions"}], "}"}], ",", "\n", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"randomPoints", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "1"}], "/", "2"}], ",", 
              RowBox[{"1", "/", "2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], "}"}], ",", 
        "\n", "\n", "\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"expandedMesh", "=", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{
              RowBox[{"VoronoiMesh", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"randomPoints", "+", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}], ",", "numPoints"}], 
                    "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"j", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
                 "2"}], "]"}], "]"}], ",", "2"}], "]"}]}], "}"}], ",", "\n", 
          "\n", "\t\t", 
          RowBox[{
           RowBox[{"selectedPrimitives", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{"expandedMesh", ",", 
              RowBox[{
               RowBox[{"Or", " ", "@@", " ", 
                RowBox[{"RegionMember", "[", 
                 RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"positions", " ", "=", " ", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"selectedPrimitives", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"mappedPositions", " ", "=", " ", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<Map\>\"", "]"}], " ", "/@", " ",
              "positions"}]}], ";", "\n", "\n", "\t\t", 
           RowBox[{
            RowBox[{"With", "[", "\n", "\t\t", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mesh", " ", "=", " ", 
                RowBox[{"MeshRegion", "[", 
                 RowBox[{"positions", ",", " ", 
                  RowBox[{"Polygon", " ", "/@", " ", 
                   RowBox[{"Flatten", " ", "/@", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"selectedPrimitives", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
                    RowBox[{"PositionIndex", "[", "positions", "]"}]}], " ", 
                    ")"}]}]}]}], "]"}]}], "}"}], ",", "\t", "\n", "\n", 
              "\t\t\t", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"BooleanQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<Faces\>\"", "]"}], "]"}], 
                 " ", "&&", " ", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Faces\>\"", "]"}], " ", 
                  "\[Equal]", " ", "True"}]}], ",", "\n", "\t\t\t\t", 
                RowBox[{"Linkage", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "2"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Polygon", "\[Rule]", "Face"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], 
                 " ", "]"}], ",", "\n", "\t\t\t\t", 
                RowBox[{"Linkage", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Line", "\[Rule]", "Spring"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], 
                 " ", "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\n", "\t\t", 
             "]"}], " ", "/;", " ", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"MatrixQ", "[", 
                RowBox[{"mappedPositions", ",", "NumericQ"}], "]"}], " ", "&&",
                " ", 
               RowBox[{
                RowBox[{"Last", "[", 
                 RowBox[{"Dimensions", "[", "mappedPositions", "]"}], "]"}], 
                "\[Equal]", "2"}]}], ",", "\n", "\t\t\t", "True", ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"RandomCellNetwork", "::", "map"}], "]"}], ";", " ", 
               "False"}]}], "\n", "\t\t", "]"}]}]}]}], "\n", "\t", "]"}]}], 
       "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"RandomCellNetwork", "::", "num"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomCellNetwork", "::", "map"}], "=", 
     "\"\<Option \\\"Map\\\" is not a function taking a point in 2D to a \
point in 2D.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomCellNetwork", "::", "num"}], "=", 
     "\"\<Number of points should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[4119]:=",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomTriangulatedNetwork[]", "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "RandomTriangulatedNetwork", "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\"\<Faces\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<Map\>\"", "\[Rule]", "Identity"}]}], " ", "}"}], ",", 
       " ", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], ";"}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"#", ">", "0"}], " ", "&"}], " ", ")"}]}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", "j", ",", "selectedPrimitives", ",", " ", "positions", ",", 
        " ", "mappedPositions"}], "}"}], ",", "\n", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"randomPoints", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "1"}], "/", "2"}], ",", 
              RowBox[{"1", "/", "2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], "}"}], ",", 
        "\n", "\n", "\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"expandedMesh", "=", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{
              RowBox[{"DelaunayMesh", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"randomPoints", "+", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}], ",", "numPoints"}], 
                    "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"j", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
                 "2"}], "]"}], "]"}], ",", "2"}], "]"}]}], "}"}], ",", "\n", 
          "\n", "\t\t", 
          RowBox[{
           RowBox[{"selectedPrimitives", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{"expandedMesh", ",", 
              RowBox[{
               RowBox[{"Or", " ", "@@", " ", 
                RowBox[{"RegionMember", "[", 
                 RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"positions", " ", "=", " ", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"selectedPrimitives", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"mappedPositions", " ", "=", " ", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<Map\>\"", "]"}], " ", "/@", " ",
              "positions"}]}], ";", "\n", "\n", "\t\t", 
           RowBox[{
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mesh", " ", "=", " ", 
                RowBox[{"MeshRegion", "[", 
                 RowBox[{"positions", ",", " ", 
                  RowBox[{"Polygon", " ", "/@", " ", 
                   RowBox[{"Flatten", " ", "/@", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"selectedPrimitives", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
                    RowBox[{"PositionIndex", "[", "positions", "]"}]}], " ", 
                    ")"}]}]}]}], "]"}]}], "}"}], ",", "\t", "\n", "\n", 
              "\t\t\t", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"BooleanQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<Faces\>\"", "]"}], "]"}], 
                 " ", "&&", " ", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<Faces\>\"", "]"}], " ", 
                  "\[Equal]", " ", "True"}]}], ",", "\n", "\t\t\t\t", 
                RowBox[{"Linkage", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "2"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Polygon", "\[Rule]", "Face"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], 
                 " ", "]"}], ",", "\n", "\t\t\t\t", 
                RowBox[{"Linkage", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Line", "\[Rule]", "Spring"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "Linkage", "]"}]}], " ", "]"}]}], 
                 " ", "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\n", "\t\t", 
             "]"}], " ", "/;", " ", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"MatrixQ", "[", 
                RowBox[{"mappedPositions", ",", "NumericQ"}], "]"}], " ", "&&",
                " ", 
               RowBox[{
                RowBox[{"Last", "[", 
                 RowBox[{"Dimensions", "[", "mappedPositions", "]"}], "]"}], 
                "\[Equal]", "2"}]}], ",", "\n", "\t\t\t", "True", ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"RandomCellNetwork", "::", "map"}], "]"}], ";", " ", 
               "False"}]}], "\n", "\t\t", "]"}]}]}]}], "\n", "\t", "]"}]}], 
       "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"RandomTriangulatedNetwork", "::", "num"}], "]"}]}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomTriangulatedNetwork", "::", "map"}], "=", 
     "\"\<Option \\\"Map\\\" is not a function taking a point in 2D to a \
point in 2D.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomTriangulatedNetwork", "::", "num"}], "=", 
     "\"\<Number of points should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[4124]:=",ExpressionUUID->"c1058285-daa4-49c3-b6e6-cf523195583e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Henneberg", "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "1", "]"}], "[", 
     RowBox[{
      RowBox[{"n_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"label_", " ", "\[Rule]", " ", 
       RowBox[{"pos_", "?", "VectorQ"}]}]}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"AddCells", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"FreeJoint", "[", 
        RowBox[{"label", " ", "\[Rule]", " ", 
         RowBox[{"PadRight", "[", 
          RowBox[{"pos", ",", " ", 
           RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], "]"}]}], 
        " ", "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"RigidBar", "[", 
          RowBox[{"{", 
           RowBox[{"#", ",", "label"}], "}"}], "]"}], "&"}], " ", "/@", " ", 
        "n"}]}], " ", "}"}], " ", "]"}], "[", "m", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Henneberg", "[", "1", "]"}], "[", 
    RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"vertices", " ", "=", " ", 
      RowBox[{"RandomSample", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", " ", 
         RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}], ",", 
        " ", "2"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "1", "]"}], "[", 
      RowBox[{"vertices", ",", " ", 
       RowBox[{
        RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
      "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[4129]:=",ExpressionUUID->"91d3ea7e-b367-4d8f-a2e1-b86f413fad70"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "2", "]"}], "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n1_", ",", " ", "n2_", ",", "n3_"}], "}"}], ",", " ", 
      RowBox[{"label_", " ", "\[Rule]", " ", "pos_"}]}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"PlaceVertices", "[", 
     RowBox[{"label", " ", "\[Rule]", " ", "pos"}], "]"}], " ", "@", " ", 
    RowBox[{
     RowBox[{"AddCells", "[", 
      RowBox[{"{", 
       RowBox[{"RigidBar", "[", 
        RowBox[{"{", 
         RowBox[{"label", ",", " ", "n3"}], "}"}], "]"}], "}"}], "]"}], " ", 
     "@", " ", 
     RowBox[{
      RowBox[{"SubdivideCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"n1", ",", "n2"}], "}"}], ",", " ", "label"}], " ", "]"}], 
      "[", " ", "m", " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "2", "]"}], "[", 
     RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"edge", " ", "=", " ", 
       RowBox[{"RandomChoice", "[", " ", 
        RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Henneberg", "[", "2", "]"}], "[", 
       RowBox[{
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"{", " ", 
          RowBox[{"edge", ",", " ", 
           RowBox[{"RandomChoice", "[", " ", 
            RowBox[{"Complement", "[", " ", 
             RowBox[{
              RowBox[{"Range", "[", " ", 
               RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}], 
              ",", " ", "edge"}], "]"}], " ", "]"}]}], " ", "}"}], " ", "]"}],
         ",", " ", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
       "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Henneberg", "[", 
    RowBox[{"d", ":", 
     RowBox[{"1", "|", "2"}]}], "]"}], "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "x__"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Henneberg", "[", "d", "]"}], "[", "x", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4131]:=",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]],

Cell[CellGroupData[{

Cell["blockFaces[] - not done", "Subsection",ExpressionUUID->"4ad8f35c-0c6e-432e-92bd-045a2058c437"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FaceToBlock", "[", " ", 
    RowBox[{
    "thickness_", ",", " ", "label_", ",", " ", "centroid_", " ", ",", " ", 
     "normal_", " ", ",", " ", "indices_"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"FreeJoint", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"label", "[", "1", "]"}], " ", "\[Rule]", " ", 
        RowBox[{"(", 
         RowBox[{"centroid", " ", "+", " ", 
          RowBox[{"thickness", " ", "normal"}]}], ")"}]}], " ", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Shape\>\"", "\[Rule]", "None"}], ",", 
         "\"\<blockJoint\>\""}], "}"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"FreeJoint", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"label", "[", "2", "]"}], " ", "\[Rule]", " ", 
        RowBox[{"(", 
         RowBox[{"centroid", " ", "-", " ", 
          RowBox[{"thickness", " ", "normal"}]}], ")"}]}], " ", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Shape\>\"", "\[Rule]", "None"}], ",", 
         "\"\<blockJoint\>\""}], "}"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"RigidBar", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", " ", 
           RowBox[{"label", "[", "1", "]"}]}], "}"}], " ", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<Shape\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
           "\"\<blockEdge\>\""}], "}"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
      "indices"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"RigidBar", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"#", ",", " ", 
           RowBox[{"label", "[", "2", "]"}]}], "}"}], " ", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<Shape\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
           "\"\<blockEdge\>\""}], "}"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
      "indices"}]}], "\n", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blockFaces", "[", " ", "Faces_", " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"normals", " ", "=", " ", 
        RowBox[{"NormalVector", "[", " ", 
         RowBox[{"m", " ", ",", " ", "Faces", " ", ",", " ", 
          RowBox[{"\"\<Normalize\>\"", " ", "\[Rule]", " ", "False"}]}], 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"centroids", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Mean", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "#"}], "]"}], "]"}], "]"}], "&"}], " ", "/@", 
         " ", "Faces"}]}], ",", "\n", "\t", 
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "Faces", "]"}], "]"}]}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"AddCells", "[", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"FaceToBlock", "[", " ", 
           RowBox[{
           "0.1", ",", " ", "#1", ",", " ", "#2", ",", " ", "#3", ",", " ", 
            "#4"}], " ", "]"}], "&"}], ",", " ", 
         RowBox[{"{", " ", 
          RowBox[{
          "labels", ",", " ", "centroids", ",", " ", "normals", ",", " ", 
           "Faces"}], " ", "}"}]}], " ", "]"}], " ", "]"}], "[", "m", "]"}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"blockFaces", "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"Faces", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"MechanismFaces", "[", "m", "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], ">", "3"}], "&"}]}], "]"}]}], 
     " ", "}"}], ",", " ", 
    RowBox[{
     RowBox[{"blockFaces", "[", " ", "Faces", " ", "]"}], "[", "m", "]"}]}], 
   " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4134]:=",ExpressionUUID->"aac3bd51-98d4-4ee4-9066-cb36ede9eb5c"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["extracting rigidity data", "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],

Cell[CellGroupData[{

Cell["MechanismCellData[]", "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismCellData", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"mechanismCellDataInternal", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "cellSpec"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellData", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
      RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "pos"}], " ", "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"mechanismCellDataInternal", "[", 
    RowBox[{"m", " ", ",", " ", "pos", " ", ",", " ", "cellSpec"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellData", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions cannot be those of provided mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellData", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", " ", ",", " ", 
    "___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismCellData", "::", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4137]:=",ExpressionUUID->"adb8d8ad-2a69-432e-9101-5ef289672aa6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataInternal", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
     RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", "\n", 
      RowBox[{
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"MechanismCellList", "[", 
         RowBox[{"m", ",", " ", "cellSpec"}], "]"}]}], ",", "\n", 
       "activeCells", ",", " ", "inactiveCells"}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"activeCells", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{"cells", ",", "_Rule"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"inactiveCells", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"cells", ",", "_Rule"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "\[Rule]", " ", 
            RowBox[{"mechanismCellDataComponents", "[", " ", 
             RowBox[{"m", ",", " ", "positions", ",", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "\[Rule]", " ", 
               RowBox[{"Merge", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", "Join"}], "]"}]}]}], 
             " ", "]"}]}], " ", ")"}], " ", "&"}], " ", "/@", " ", 
         "activeCells"}], ",", "\n", "\t\t", "inactiveCells"}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataComponents", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
     RowBox[{"Rule", "[", " ", 
      RowBox[{
       RowBox[{"RigidBar", "[", "indices_", "]"}], ",", " ", 
       "data_Association"}], "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"automaticCells", " ", ",", " ", "newlengths"}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"automaticCells", " ", "=", " ", 
       RowBox[{"Position", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], ",", " ", 
         "Automatic"}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"newlengths", " ", "=", " ", 
       RowBox[{"DisplacementLength", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", 
         RowBox[{"Extract", "[", 
          RowBox[{"indices", ",", "automaticCells"}], "]"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"ReplacePart", "[", " ", 
       RowBox[{"data", ",", " ", 
        RowBox[{"\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", 
         RowBox[{"ReplacePart", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], ",", " ", 
           
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "automaticCells", "]"}], " ", "\[Rule]", 
             " ", "newlengths"}], "]"}]}], " ", "]"}]}]}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataComponents", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
     RowBox[{"Rule", "[", " ", 
      RowBox[{
       RowBox[{"Spring", "[", "indices_", "]"}], ",", " ", 
       "data_Association"}], "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "automaticCells", " ", ",", " ", "newlengths", " ", ",", " ", 
       "newstrains"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"automaticCells", " ", "=", " ", 
       RowBox[{"Position", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], ",", " ", 
         "Automatic"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"newlengths", " ", "=", " ", 
       RowBox[{"ReplacePart", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], ",", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", "automaticCells", " ", "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"DisplacementLength", "[", 
            RowBox[{"m", ",", " ", "positions", ",", " ", 
             RowBox[{"Extract", "[", 
              RowBox[{"indices", ",", "automaticCells"}], "]"}]}], " ", 
            "]"}]}], " ", "]"}]}], " ", "]"}]}], ";", "\t", "\n", "\t", 
      RowBox[{"newstrains", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<Strain\>\"", "]"}], " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{"\"\<LinearStrain\>\"", " ", "\[Rule]", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#1", "-", "#2"}], ")"}], "/", "#2"}], " ", "&"}], 
           ")"}]}], " ", "}"}]}]}], ";", "\n", "\n", "\t", 
      RowBox[{"ReplacePart", "[", " ", 
       RowBox[{"data", ",", " ", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{
          "\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", "newlengths"}], 
          ",", "\n", "\t\t", 
          RowBox[{"\"\<Strain\>\"", " ", "\[Rule]", " ", "newstrains"}]}], 
         "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataComponents", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", 
       "data_Association"}], " ", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"automaticCells", ",", " ", "newangles"}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"automaticCells", " ", "=", " ", 
       RowBox[{"Position", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<Angle\>\"", "]"}], ",", " ", "Automatic"}],
         " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"newangles", " ", "=", " ", 
       RowBox[{"TorsionalFoldAngle", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", 
         RowBox[{"Extract", "[", 
          RowBox[{"indices", ",", "automaticCells"}], "]"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"ReplacePart", "[", " ", 
       RowBox[{"data", ",", " ", 
        RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", 
         RowBox[{"ReplacePart", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", "\"\<Angle\>\"", "]"}], ",", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "automaticCells", "]"}], " ", "\[Rule]", 
             " ", "newangles"}], "]"}]}], " ", "]"}]}]}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataComponents", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"AngleJoint", "[", "indices_", "]"}], ",", " ", 
       "data_Association"}], " ", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"automaticCells", ",", " ", "newangles"}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"automaticCells", " ", "=", " ", 
       RowBox[{"Position", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<Angle\>\"", "]"}], ",", " ", "Automatic"}],
         " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"newangles", " ", "=", " ", 
       RowBox[{"TurningAngle", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", 
         RowBox[{"Extract", "[", 
          RowBox[{"indices", ",", "automaticCells"}], "]"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"ReplacePart", "[", " ", 
       RowBox[{"data", ",", " ", 
        RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", 
         RowBox[{"ReplacePart", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", "\"\<Angle\>\"", "]"}], ",", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "automaticCells", "]"}], " ", "\[Rule]", 
             " ", "newangles"}], "]"}]}], " ", "]"}]}]}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismCellDataComponents", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"Rule", "[", " ", 
      RowBox[{
       RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", 
       "data_Association"}], " ", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"automaticCells", ",", " ", "pos", ",", " ", "newconstraints"}],
       "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"automaticCells", " ", "=", " ", 
       RowBox[{"Position", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
         "Automatic"}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"pos", " ", "=", " ", 
       RowBox[{"positions", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Flatten", "[", " ", "automaticCells", " ", "]"}], " ", 
         "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"newconstraints", " ", "=", " ", 
       RowBox[{"ReplacePart", "[", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", "automaticCells", "]"}], " ", "\[Rule]", 
           " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#1", "-", "#2"}], " ", "&"}], ")"}]}], " ", "]"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"ReplacePart", "[", " ", 
       RowBox[{"data", ",", " ", 
        RowBox[{
        "\"\<ConstraintFunction\>\"", " ", "\[Rule]", " ", 
         "newconstraints"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mechanismCellDataComponents", "[", " ", 
   RowBox[{"m_", ",", " ", "positions_", ",", " ", 
    RowBox[{"Rule", "[", " ", 
     RowBox[{"cell_", ",", " ", "data_"}], " ", "]"}]}], "]"}], " ", ":=", 
  " ", "data"}]}], "Code",
 CellLabel->
  "In[4141]:=",ExpressionUUID->"b8878c3c-97d6-4b85-9234-4ded19c9f3fd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConstrainedCells[]", "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismConstrainedCells", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{"mechanismConstrainedCellsInternal", "[", 
   RowBox[{"m", " ", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "cellSpec"}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstrainedCells", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
      RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "pos"}], "]"}]}], " ", ":=", "\n", "\t", 
   RowBox[{"mechanismConstrainedCellsInternal", "[", 
    RowBox[{"m", " ", ",", " ", "pos", ",", " ", "cellSpec"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstrainedCells", "::", "pos"}], "=", 
   "\"\<Positions `1` cannot correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstrainedCells", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
    "___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConstrainedCells", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4148]:=",ExpressionUUID->"216009e6-27cf-4f6b-9566-2fc20f53096e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismConstrainedCellsInternal", "[", " ", 
   RowBox[{"m_", ",", " ", "pos_", ",", " ", "cellSpec_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"dataToCheck", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
       "\"\<Stiffness\>\"", ",", " ", "\"\<TorsionalStiffness\>\"", ",", " ", 
        "\"\<PinningStiffness\>\"", ",", " ", "\"\<FaceStiffness\>\"", ",", 
        "\"\<YoungsModulus\>\""}], "}"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "\[Rule]", " ", 
            RowBox[{"mechanismCellDataComponents", "[", 
             RowBox[{"m", ",", " ", "pos", ",", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "\[Rule]", " ", 
               RowBox[{"Merge", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", "Join"}], "]"}]}]}], 
             "]"}]}], " ", "&"}], ")"}], " ", "/@", " ", 
         RowBox[{"MechanismCellList", "[", " ", 
          RowBox[{"m", ",", " ", "cellSpec", " ", ",", " ", 
           RowBox[{"#1", " ", "\[Rule]", " ", "Infinity"}]}], " ", "]"}]}], 
        ")"}], " ", "&"}], " ", "/@", " ", "dataToCheck"}], "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4152]:=",ExpressionUUID->"4385e954-e342-443c-8abf-76c8d77153d4"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConstraintEquations[]", "Subsection",ExpressionUUID->"b7156b33-cb6c-4b74-aacf-f98656168e47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "MechanismConstraintEquations", " ", "]"}], 
    " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", "\n", "\t", 
      RowBox[{"ConstraintOutput", " ", "\[Rule]", " ", "VertexDisplacement"}],
       ",", "\n", "\t", 
      RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}]}], "\n", "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstraintEquations", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "order_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", "=", 
      RowBox[{"mechanismConstraintEquationsInternal", "[", " ", 
       RowBox[{"m", " ", ",", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", "order", 
        " ", ",", " ", 
        RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", 
        RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "ConstraintOutput", "]"}]}], " ", "]"}]}],
      "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "mechanismConstraintEquationsInternal"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstraintEquations", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
    "order_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"mechanismConstraintEquationsInternal", "[", " ", 
        RowBox[{
        "m", " ", ",", " ", "pos", " ", ",", " ", "order", " ", ",", " ", 
         RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", 
         RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "ConstraintOutput", "]"}]}], " ", 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "mechanismConstraintEquationsInternal"}]}]}], "\n", "]"}], " ", "/;", 
   " ", 
   RowBox[{"constraintEqposQ", "[", " ", 
    RowBox[{"m", " ", ",", " ", "pos"}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "In[4153]:=",ExpressionUUID->"3a934fb1-218e-48da-8317-5d5bb9db883c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintEquations", "::", "pos"}], "=", 
   "\"\<Positions `1` cannot correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"constraintEqposQ", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"True", " ", "/;", " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", " ", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEqposQ", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "x_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConstraintEquations", "::", "pos"}], ",", " ", "x"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintEquations", "::", "order"}], "=", 
   "\"\<Order of expansion, `1`,  must be a positive integer or \
Infinity.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"constraintEqOrderQ", "[", " ", 
   RowBox[{"_Integer", "?", "Positive"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"constraintEqOrderQ", "[", " ", "Infinity", " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEqOrderQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConstraintEquations", "::", "order"}], ",", " ", "x"}],
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintEquations", "::", "output"}], "=", 
   "\"\<Option ConstraintOutput must be either VertexDisplacement or \
VertexPosition.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"outputTypeQ", "[", " ", 
   RowBox[{"VertexDisplacement", "|", "VertexPosition"}], " ", "]"}], " ", ":=",
   " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"outputTypeQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Message", "[", 
   RowBox[{"MechanismConstraintEquations", "::", "output"}], "]"}]}]}], "Code",\

 CellLabel->
  "In[4156]:=",ExpressionUUID->"6e993a3f-65cf-4f0e-8d03-1432e921ee46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismConstraintEquationsInternal", "[", " ", 
   RowBox[{"m_", ",", " ", "positions_", ",", " ", 
    RowBox[{"order_", "?", "constraintEqOrderQ"}], ",", " ", "pattern_", ",", 
    " ", "constraints_", ",", " ", 
    RowBox[{"output_", "?", "outputTypeQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tmp", ",", " ", "tmpPositions"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"tmpPositions", " ", "=", " ", 
      RowBox[{"positions", " ", "/.", " ", 
       RowBox[{"VertexPosition", " ", "\[Rule]", " ", "tmp"}]}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"ReplaceAll", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"reduceConstraintToOrder", "[", "\n", "\t\t\t", 
         RowBox[{"positions", ",", "\n", "\t\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"componentToConstraints", "[", 
                RowBox[{"m", " ", ",", " ", "tmpPositions", ",", " ", 
                 RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", "#"}], 
                " ", "]"}], "&"}], " ", "/@", " ", 
              RowBox[{"mechanismConstrainedCellsInternal", "[", 
               RowBox[{
               "m", " ", ",", " ", "tmpPositions", ",", " ", "pattern"}], " ",
                "]"}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"constraintVector", "[", " ", 
              RowBox[{"tmpPositions", ",", " ", "constraints"}], " ", "]"}]}],
             "\n", "\t\t\t", "}"}], "]"}], ",", "\n", "\t\t\t", "order"}], 
         "\n", "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{"Which", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"order", " ", "===", " ", "Infinity"}], " ", "&&", " ", 
           RowBox[{"output", " ", "===", " ", "VertexDisplacement"}]}], ",", 
          " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"PositionRules", "[", " ", 
            RowBox[{"positions", " ", "+", " ", 
             RowBox[{"VertexDisplacement", "[", "m", "]"}]}], " ", "]"}], 
           "]"}], ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "order", "]"}], " ", "&&", " ", 
           RowBox[{"output", " ", "===", " ", "VertexPosition"}]}], ",", " ", 
          
          RowBox[{"Dispatch", "[", 
           RowBox[{"DisplacementRules", "[", " ", 
            RowBox[{
             RowBox[{"VertexPosition", "[", "m", "]"}], " ", "-", " ", 
             "positions"}], " ", "]"}], "]"}], ",", "\n", "\t\t\t", "True", 
          ",", " ", 
          RowBox[{"{", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}], " ",
       "/.", " ", 
      RowBox[{"tmp", " ", "\[Rule]", " ", "VertexPosition"}]}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4166]:=",ExpressionUUID->"1541376a-e966-4f59-8e04-b3265424a372"],

Cell[CellGroupData[{

Cell["componentToConstraints[]", "Subsubsection",ExpressionUUID->"8eb12589-13d0-4db1-8d82-5a7f3627cf24"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"componentToConstraints", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"RigidBar", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"DisplacementLengthSquared", "[", " ", 
     RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], " ", 
    "-", " ", 
    RowBox[{
     RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", "2"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentToConstraints", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"ElasticTriangle", "[", "indices_", "]"}], ",", " ", "data_"}],
       "]"}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"DeleteDuplicatesBy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{"indices", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], ",", "1", ",", "1"}], "]"}], 
           ",", "2"}], "]"}], ",", "Sort"}], " ", "]"}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"DisplacementLengthSquared", "[", " ", 
       RowBox[{"arbitraryPositions", ",", " ", "edges"}], " ", "]"}], " ", 
      "-", " ", 
      RowBox[{"DisplacementLengthSquared", "[", " ", 
       RowBox[{"positions", ",", " ", "edges"}], " ", "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentToConstraints", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"Spring", "[", "indices_", "]"}], ",", " ", "data_"}], "]"}]}],
     " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"MapThread", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"#1", "[", 
       RowBox[{"#2", ",", "#3"}], "]"}], "&"}], ",", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"data", "[", "\"\<Strain\>\"", "]"}], ",", " ", 
       RowBox[{"DisplacementLength", "[", " ", 
        RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], ",", 
       " ", 
       RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}], " ", 
      "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentToConstraints", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", "data_"}], 
      " ", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "[", " ", 
     RowBox[{"m", ",", " ", "arbitraryPositions", ",", " ", "indices"}], " ", 
     "]"}], " ", "-", " ", 
    RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    RowBox[{"Rule", "[", 
     RowBox[{
      RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", "data_"}], " ",
      "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"MapThread", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"#1", "[", 
      RowBox[{"#2", ",", "#3"}], "]"}], "&"}], ",", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
      RowBox[{"VertexPosition", "[", " ", 
       RowBox[{"indices", ",", " ", 
        RowBox[{"All", "[", " ", 
         RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], 
       " ", "]"}], ",", " ", 
      RowBox[{"positions", "[", 
       RowBox[{"[", " ", "indices", " ", "]"}], "]"}]}], " ", "}"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4167]:=",ExpressionUUID->"d23ba088-27d1-4486-af97-c5061397f6ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", "___", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"{", "}"}]}]], "Code",
 CellLabel->
  "In[4172]:=",ExpressionUUID->"49ff6c33-b326-4e81-9f7f-58b38ecac55a"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEnergy[]", "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "\"\<Methods\>\"", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "RigidBar", ",", " ", "Spring", ",", " ", "TorsionalFold", ",", " ", 
     "FreeJoint", ",", " ", "AngleJoint", ",", " ", "Constraints"}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "RigidBar", "]"}], "=", "1"}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "Spring", "]"}], "=", "1"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "ElasticTriangle", "]"}], " ",
    "=", " ", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "PinnedJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "AngleJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
   "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", "]"}], "=", 
   
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "6"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$DefaultMechanismStiffnesses", "[", "Constraints", "]"}], "=", 
    RowBox[{"10", "^", 
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "::", "err"}], "=", 
   "\"\<`1` does not have a default stiffness.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$DefaultMechanismStiffnesses", "[", "s_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"$DefaultMechanismStiffnesses", "::", "err"}], ",", "s"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4173]:=",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismEnergy", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}]}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEnergy", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"mechanismEnergyInternal", "[", " ", 
   RowBox[{"m", " ", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
    RowBox[{"OptionValue", "[", "Constraints", "]"}], " ", ",", " ", 
    RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
     
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"mechanismEnergyInternal", "[", " ", 
     RowBox[{"m", " ", ",", " ", "pos", " ", ",", " ", 
      RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
      RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], " ", "]"}], " ", "/;",
     " ", 
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "pos"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "::", "pos"}], "=", 
   "\"\<Positions `1` cannot correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEnergy", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismEnergy", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4184]:=",ExpressionUUID->"680aac2e-d58b-40c8-b7d4-ea52edea8b7d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismEnergyInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "constraints_", ",", " ", 
    "pattern_"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"components", " ", "=", " ", 
       RowBox[{"mechanismCellDataInternal", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", "pattern"}], "]"}]}], 
      ",", "\n", 
      RowBox[{"(*", "\t", 
       RowBox[{
        RowBox[{"nonlinearConstraints", " ", "=", " ", 
         RowBox[{"nonlinearConstraintVector", "[", 
          RowBox[{"positions", ",", " ", "constraints"}], "]"}]}], ","}], 
       "*)"}], "\n", "\t", 
      RowBox[{"constraintData", " ", "=", " ", 
       RowBox[{"processConstraintEquations", "[", 
        RowBox[{"positions", " ", ",", " ", "constraints"}], "]"}]}], " ", 
      ",", "\n", "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"VertexPosition", "[", "m", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"Total", " ", "@", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"componentEnergy", "[", 
            RowBox[{
            "m", ",", " ", "positions", ",", " ", "arbitraryPositions", ",", 
             " ", "#"}], "]"}], "&"}], " ", "/@", " ", "components"}], ",", 
         "\n", "\t\t", 
         RowBox[{
          RowBox[{"$DefaultMechanismStiffnesses", "[", "Constraints", "]"}], 
          " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
             "constraintData", "[", "\"\<nonlinear constraints\>\"", "]"}], 
             " ", ".", " ", 
             RowBox[{
             "constraintData", "[", "\"\<nonlinear constraints\>\"", "]"}]}], 
            ")"}], "/", "2"}]}]}], "\n", "\t", "}"}], "]"}]}], " ", "/.", " ", 
     RowBox[{"constraintData", "[", "\"\<linear solutions\>\"", "]"}]}]}], 
   "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4189]:=",ExpressionUUID->"64b80402-9692-43c6-ade1-c477b2b2a0a8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEnergy", "::", "EdgeLength"}], "=", 
    "\"\<Warning: Edges `1` with length smaller than `2` have had their \
strains clipped.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"RigidBar", "[", "indices_", "]"}], ",", "data_"}], "]"}]}], 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "this", " ", "puts", " ", "a", " ", "lower", " ", "bound", " ", "on", 
        " ", "the", " ", "smallest", " ", "length", " ", "we", " ", "use", 
        " ", "to", " ", "divide", " ", "the", " ", "strain", " ", "by"}], 
       "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"smallestLengths", " ", "=", " ", 
        RowBox[{"Clip", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", 
           "2"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
             "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", 
              "]"}], "^", "2"}], ",", " ", "Infinity"}], "}"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "this", " ", "is", " ", "to", " ", "put", " ", "out", " ", "a", " ", 
         "warning", " ", "in", " ", "case", " ", "some", " ", "are", " ", 
         RowBox[{"short", "."}]}], "*)"}], "\n", "\t", 
       RowBox[{"shortEdges", "=", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{"indices", " ", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", " ", "<", " ", 
              RowBox[{
              "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", 
               "]"}]}], ")"}], "&"}], " ", "/@", " ", 
           RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}]}], 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "shortEdges", "]"}], ">", "0"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"MechanismEnergy", "::", "EdgeLength"}], ",", " ", 
          "shortEdges", ",", " ", 
          RowBox[{
          "$DefaultMechanismStiffnesses", "[", "\"\<SmallestStiffness\>\"", 
           "]"}]}], " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<Stiffness\>\"", "]"}], " ", "/.", " ", 
         RowBox[{"Infinity", " ", "\[Rule]", " ", 
          RowBox[{"$DefaultMechanismStiffnesses", "[", "RigidBar", "]"}]}]}], 
        " ", ")"}], " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", " ", "\n", "\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"DisplacementLengthSquared", "[", 
              RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}],
              " ", "-", " ", 
             RowBox[{
              RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", 
              "2"}]}], ")"}], "/", "smallestLengths"}], "\n", "\t", ")"}], 
         "^", "2"}], "/", "8"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"Spring", "[", "indices_", "]"}], ",", "data_"}], "]"}]}], 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<Stiffness\>\"", "]"}], " ", "/.", " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$DefaultMechanismStiffnesses", "[", "Spring", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"#2", ",", "#3"}], "]"}], "^", "2"}], "&"}], ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<Strain\>\"", "]"}], ",", " ", 
          RowBox[{"DisplacementLength", "[", 
           RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], 
          ",", " ", 
          RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}], " ", 
         "}"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<TorsionalStiffness\>\"", "]"}], " ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", "indices"}], " ",
            "]"}], " ", "-", " ", 
          RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"ElasticTriangle", "[", "indices_", "]"}], ",", " ", "data_"}],
       "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<YoungsModulus\>\"", "]"}], " ", "/.", " ", 
         
         RowBox[{"Infinity", " ", "\[Rule]", " ", 
          RowBox[{
          "$DefaultMechanismStiffnesses", "[", "ElasticTriangle", "]"}]}]}]}],
        ",", "\n", "\t", 
       RowBox[{"poissonratio", " ", "=", " ", 
        RowBox[{"data", "[", "\"\<PoissonRatio\>\"", "]"}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"MapThread", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"elasticFaceEnergy", "[", " ", 
         RowBox[{"#1", ",", " ", "#2", ",", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", " ", "#3", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", "#3", " ", "]"}], "]"}]}], " ", "]"}], "&"}], 
       ",", "\n", "\t\t", 
       RowBox[{"{", 
        RowBox[{"stiffness", ",", " ", "poissonratio", ",", " ", "indices"}], 
        "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"AngleJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<AngleStiffness\>\"", "]"}], " ", "/.", " ", 
        
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"TurningAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", "indices"}], " ",
            "]"}], " ", "-", " ", 
          RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<PinningStiffness\>\"", "]"}], " ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"#2", ",", "#3"}], "]"}], "^", "2"}], "/", "2"}], "&"}], 
        " ", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
          
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", "indices", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", " ", "indices", " ", "]"}], "]"}]}], " ", "}"}]}], 
       " ", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"componentEnergy", "[", 
   RowBox[{"m_", ",", "_", ",", "_", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "0", "}"}]}]}], "Code",
 CellLabel->
  "In[4190]:=",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"elasticFaceEnergy", "[", 
   RowBox[{"Y_", ",", "\[Nu]_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1_", ",", "y1_", ",", "z1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x2_", ",", "y2_", ",", "z2_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x3_", ",", "y3_", ",", "z3_"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X1_", ",", "Y1_", ",", "Z1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"X2_", ",", "Y2_", ",", "Z2_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"X3_", ",", "Y3_", ",", "Z3_"}], "}"}]}], "}"}]}], "]"}], " ", 
  ":=", " ", "\n", 
  RowBox[{
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{"1", "+", "\[Nu]"}], ")"}]}]], "Y", " ", 
    RowBox[{"(", 
     RowBox[{
      FractionBox[
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "-", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]]}], ")"}], 
        "2"], 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "+", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 RowBox[{"x2", " ", "x3"}], "-", 
                 RowBox[{"x1", " ", 
                  RowBox[{"(", 
                   RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], "-", 
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["X1", "2"], "+", 
                 RowBox[{"X2", " ", "X3"}], "-", 
                 RowBox[{"X1", " ", 
                  RowBox[{"(", 
                   RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}]}], ")"}], 
        "2"], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}], ")"}], 
         " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}], ")"}]}], 
        ")"}]}], "+", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], " ", 
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], ")"}], 
           "/", 
           RowBox[{"(", 
            SqrtBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]], ")"}]}],
           "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["X1", "2"], "+", 
               RowBox[{"X2", " ", "X3"}], "-", 
               RowBox[{"X1", " ", 
                RowBox[{"(", 
                 RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], " ", 
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}], ")"}], 
           "/", 
           RowBox[{"(", 
            SqrtBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]], 
            ")"}]}]}], ")"}], "2"], "/", 
       RowBox[{"(", 
        RowBox[{"4", " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}], ")"}], 
         " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}], ")"}]}], 
        ")"}]}]}], ")"}]}], "+", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"2", " ", "\[Nu]"}]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{"1", "+", "\[Nu]"}], ")"}]}]], "Y", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "-", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]]}], 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]]]}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 RowBox[{"x2", " ", "x3"}], "-", 
                 RowBox[{"x1", " ", 
                  RowBox[{"(", 
                   RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], "-", 
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["X1", "2"], "+", 
                 RowBox[{"X2", " ", "X3"}], "-", 
                 RowBox[{"X1", " ", 
                  RowBox[{"(", 
                   RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}]}], ")"}], 
        "/", 
        RowBox[{"(", 
         RowBox[{
          SqrtBox[
           RowBox[{"1", "-", 
            FractionBox[
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox["x1", "2"], "+", 
                RowBox[{"x2", " ", "x3"}], "-", 
                RowBox[{"x1", " ", 
                 RowBox[{"(", 
                  RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
          
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], ")"}]}]}], 
      ")"}], "2"], " ", "\[Nu]"}]}]}]], "Code",
 CellLabel->
  "In[4198]:=",ExpressionUUID->"2df2e8ac-6715-419b-b5cd-63a7ffa6face"]
}, Open  ]],

Cell[CellGroupData[{

Cell["CompiledMechanismEnergy[]", "Subsection",ExpressionUUID->"fdb08a27-d392-4708-8d7c-e22a50d18359"],

Cell[CellGroupData[{

Cell["CompiledMechanismEnergy[] data structure", "Subsubsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<variables\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", "\n", 
  RowBox[{"StringJoin", "[", "\n", "\t", 
   RowBox[{"\"\<CompiledMechanismEnergy[\>\"", ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "variables", "]"}], "<", "10"}], ",", "\n", 
      "\t\t", 
      RowBox[{"ToString", "[", "variables", "]"}], ",", "\n", "\t\t", 
      RowBox[{"\"\<{\>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"First", "[", "variables", "]"}], "<>", "\"\<...\>\"", "<>", 
         
         RowBox[{"Last", "[", "variables", "]"}], "<>", "\"\<}\>\""}], 
        "]"}]}]}], "\n", "\t", "]"}], ",", "\n", "\t", "\"\<]\>\""}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4199]:=",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
      RowBox[{"variables_", "?", "VectorQ"}], ",", "energy_CompiledFunction", 
      ",", "gradient_CompiledFunction"}], "]"}], "[", "\"\<data\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<energy\>\"", "]"}], "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", "data_"}],
    "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"energy", "[", 
   RowBox[{"pos", ",", "data"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CompiledMechanismEnergy", "[", 
      RowBox[{
      "variables_List", ",", "energy_CompiledFunction", ",", 
       "gradient_CompiledFunction"}], "]"}], "[", "\"\<gradient\>\"", "]"}], 
    "[", 
    RowBox[{
     RowBox[{"pos_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
     "data_"}], "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"gradient", "[", 
    RowBox[{"pos", ",", "data"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "[", 
   RowBox[{"v_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{"CompiledMechanismEnergy", "[", 
   RowBox[{"v", ",", "energy", ",", "gradient"}], "]"}]}]}], "Code",
 CellLabel->
  "In[4201]:=",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
CompiledMechanismEnergyQ[], compiledNumericalMechanismEnergyQ[]\
\>", "Subsubsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CompiledMechanismEnergyQ", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", "variables", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergyQ", "[", "_", "]"}], ":=", "False"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", 
   RowBox[{"variables", ",", "NumericQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", "_", "]"}], ":=", 
  "False"}]}], "Code",
 CellLabel->
  "In[4205]:=",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],

Cell[CellGroupData[{

Cell["CompiledMechanismEnergy[]", "Subsubsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "CompiledMechanismEnergy", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
     RowBox[{"AddedEnergy", "\[Rule]", "0"}], ",", " ", 
     RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}]}], "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4209]:=",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"compiledmechanismEnergyInternal", "[", 
        RowBox[{"m", ",", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
         RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", 
         RowBox[{"OptionValue", "[", "AddedEnergy", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], " ", "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"res", "/;", 
      RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", "=", 
        RowBox[{"compiledmechanismEnergyInternal", "[", 
         RowBox[{"m", ",", "pos", ",", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", 
          RowBox[{"OptionValue", "[", "AddedEnergy", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], " ", "]"}]}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{"res", "/;", 
       RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "::", "pos"}], "=", 
   "\"\<Provided positions `1` do not correspond to Mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"CompiledMechanismEnergy", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", " ", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"CompiledMechanismEnergy", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4210]:=",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compiledmechanismEnergyInternal", "[", 
   RowBox[{
   "m_", ",", "positions_", ",", "constraints_", ",", "additional_", ",", " ",
     "pattern_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"symbols", ",", 
      RowBox[{"energy", "=", 
       RowBox[{
        RowBox[{"MechanismEnergy", "[", 
         RowBox[{"m", ",", "positions", ",", 
          RowBox[{"Constraints", "\[Rule]", "constraints"}], ",", " ", 
          RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}]}], "]"}], "+", 
        "additional"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"symbols", "=", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"energy", ",", "_Symbol", ",", "Infinity"}], "]"}], ",", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"NumericQ", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}]}], 
     ";", "\n", "\n", "\t", 
     RowBox[{"Check", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"CompiledMechanismEnergy", "[", "\n", "\t\t\t", 
        RowBox[{"symbols", ",", "\n", "\t\t\t", 
         RowBox[{"compileEnergy", "[", 
          RowBox[{
          "m", ",", "energy", ",", "symbols", ",", 
           "$MechanismCompilationTarget"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"compileGradient", "[", 
          RowBox[{
          "m", ",", "energy", ",", "symbols", ",", 
           "$MechanismCompilationTarget"}], "]"}]}], "\n", "\t\t", "]"}], ",",
        "\n", "\t\t", "$Failed"}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4214]:=",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compileEnergy", "[", 
   RowBox[{"m_", ",", "energy_", ",", "symbols_", ",", "compiler_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"body", ",", "\n", 
      RowBox[{"variables", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", 
      "injector", ",", "c", ",", "\n", "dataInjector", ",", "data"}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"injector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"variables", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "variables"}], "]"}]}], ")"}]}], "]"}]}]}],
      ";", "\n", "\t", 
     RowBox[{"dataInjector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"symbols", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "symbols"}], "]"}]}], ")"}]}], "]"}]}]}], 
     ";", "\n", "\t", 
     RowBox[{"body", "=", 
      RowBox[{
       RowBox[{"energy", "/.", "injector"}], "/.", "dataInjector"}]}], ";", 
     "\n", "\t", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{
       RowBox[{"Hold", "[", "Compile", "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c", ",", "_Real", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"data", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        "\n", "\t\t", "body", ",", "\n", "\t\t", 
        RowBox[{"RuntimeOptions", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<Speed\>\"", ",", 
           RowBox[{"\"\<EvaluateSymbolically\>\"", "->", "False"}]}], "}"}]}],
         ",", "\n", "\t\t", 
        RowBox[{"CompilationTarget", "->", "compiler"}], ",", "\n", "\t\t", 
        RowBox[{"Parallelization", "\[Rule]", "True"}]}], "\n", "\t", "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4215]:=",ExpressionUUID->"92ffeed0-c3d9-4161-bdf3-36b3e40fc494"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compileGradient", "[", 
   RowBox[{"m_", ",", "energy_", ",", "symbols_", ",", "compiler_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"body", ",", "\n", 
      RowBox[{"variables", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", 
      "injector", ",", "c", ",", "\n", "dataInjector", ",", "data"}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"injector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"variables", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "variables"}], "]"}]}], ")"}]}], "]"}]}]}],
      ";", "\n", "\t", 
     RowBox[{"dataInjector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"symbols", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "symbols"}], "]"}]}], ")"}]}], "]"}]}]}], 
     ";", "\n", "\t", 
     RowBox[{"body", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"energy", ",", 
          RowBox[{"{", "variables", "}"}]}], "]"}], "/.", "injector"}], "/.", 
       "dataInjector"}]}], ";", "\n", "\t", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{
       RowBox[{"Hold", "[", "Compile", "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c", ",", "_Real", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"data", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        "\n", "\t\t", "body", ",", "\n", "\t\t", 
        RowBox[{"RuntimeOptions", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<Speed\>\"", ",", 
           RowBox[{"\"\<EvaluateSymbolically\>\"", "->", "False"}]}], "}"}]}],
         ",", "\n", "\t\t", 
        RowBox[{"CompilationTarget", "->", "compiler"}], ",", "\n", "\t\t", 
        RowBox[{"Parallelization", "\[Rule]", "True"}]}], "\n", "\t", "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4216]:=",ExpressionUUID->"fc66d059-3816-4b04-a69b-80ebdc0fcb74"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["local rigidity", "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],

Cell[CellGroupData[{

Cell["MechanismConstraintMatrix[]", "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}], ",", " ", 
      RowBox[{"EliminationRules", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{"mechanismConstraintMatrixInternal", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", "\n", "\t\t", 
    RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", "\n", "\t\t", 
    
    RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", "\n", "\t\t", 
    
    RowBox[{"Mechanisms`geometry`Private`parseDisplacementRules", "[", " ", 
     RowBox[{
      RowBox[{"OptionValue", "[", "EliminationRules", "]"}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"MechanismConstraintMatrix", "::", "rules"}], "]"}]}], "]"}]}],
    "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", " ", ",",
      " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"mechanismConstraintMatrixInternal", "[", " ", 
     RowBox[{"m", ",", " ", "positions", " ", ",", " ", "\n", "\t\t", 
      RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", "\n", 
      "\t\t", 
      RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", "\n", 
      "\t\t", 
      RowBox[{
      "Mechanisms`geometry`Private`parseDisplacementRules", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "EliminationRules", "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"MechanismConstraintMatrix", "::", "rules"}], "]"}]}], 
       "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "rules"}], "=", 
   "\"\<Rules are not all of the form VertexDisplacement[v,c]->x.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "pos"}], "=", 
   "\"\<Vertex positions `1` do not match Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", " ", ",", 
    " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", "  ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConstraintMatrix", "::", "pos"}], ",", " ", 
     "positions"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4217]:=",ExpressionUUID->"f5d34dd7-f02b-4a87-8ec4-af2aadddd1bb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismConstraintMatrixInternal", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "pattern_", " ", ",", " ", 
     "constraints_", " ", ",", " ", "rules_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"constraintMatrices", ",", " ", "vars"}], " ", "}"}], ",", "\n",
      "\n", "\t", 
     RowBox[{
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{"Check", "[", " ", 
        RowBox[{
         RowBox[{"reduceVariables", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], " ", ",", 
           " ", "rules"}], " ", "]"}], ",", " ", "$Failed"}], " ", "]"}]}], 
      ";", "\n", "\n", "\t", 
      RowBox[{"constraintMatrices", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vars", " ", "===", " ", "$Failed"}], ",", "\n", "\n", 
         "\t\t", 
         RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"mechanismConstraintEquationsInternal", "[", 
            RowBox[{
            "m", ",", " ", "positions", ",", " ", "1", ",", " ", "pattern", 
             ",", " ", "constraints", ",", " ", "VertexDisplacement"}], "]"}],
            ",", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}]}], "\n", 
          "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"mechanismConstraintEquationsInternal", "[", 
             RowBox[{
             "m", ",", " ", "positions", ",", " ", "1", ",", " ", "pattern", 
              ",", " ", "constraints", ",", " ", "VertexDisplacement"}], 
             "]"}], " ", "//.", " ", "rules"}], ",", "\n", "\t\t\t", "vars"}],
           "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", "\n", 
      "\t", 
      RowBox[{"Which", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"constraintMatrices", "\[Equal]", 
         RowBox[{"{", 
          RowBox[{"{", "}"}], "}"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
            RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "]"}], "}"}],
         ",", "\n", "\t\t", "\n", "\t\t", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"positions", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
         
         RowBox[{
          RowBox[{"Chop", "[", " ", 
           RowBox[{
            RowBox[{"N", "[", 
             RowBox[{"constraintMatrices", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ".", " ", 
            RowBox[{"N", "[", 
             RowBox[{"constraintMatrices", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}], " ", 
          "\[NotEqual]", " ", "0"}]}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"outputStressError", "[", " ", 
          RowBox[{"N", "[", 
           RowBox[{"constraintMatrices", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "]"}], ";", "\n", 
         "\t\t\t", 
         RowBox[{"constraintMatrices", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", "\n", "\t\t", "\n", "\t\t", 
        "True", ",", "\n", "\t\t\t", 
        RowBox[{"constraintMatrices", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "stressed"}], "=", 
   "\"\<Warning: Mechanism is stressed (residual is `1`) at constraints `2`. \
Constraint matrix may not be useful.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"outputStressError", "[", " ", "vec_", " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"stresses", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "vec", "]"}], "]"}], ",", " ", "vec"}], 
            "}"}], " ", "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Chop", "[", 
             RowBox[{"Abs", "[", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "]"}], "]"}], " ", ">", 
            " ", "0"}], " ", "&"}]}], " ", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"Message", "[", " ", 
      RowBox[{
       RowBox[{"MechanismConstraintMatrix", "::", "stressed"}], ",", " ", 
       RowBox[{
        RowBox[{"N", "[", "vec", "]"}], " ", ".", " ", 
        RowBox[{"N", "[", "vec", "]"}]}], ",", " ", "stresses"}], " ", 
      "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "rules"}], "=", 
   "\"\<Replacement rules are not of the form { VertexDisplacement[v1, c1] -> \
.., .. }.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"{", "}"}]}], "]"}], ":=", "vars"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Rule", "[", " ", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", 
          RowBox[{"_", ",", "_"}], "]"}], ",", " ", "_"}], " ", "]"}], ".."}],
       "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"Variables", "[", 
     RowBox[{"vars", " ", "//.", " ", "rules"}], "]"}], ",", 
    "_VertexDisplacement"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", " ", "notRules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", " ", 
     RowBox[{"MechanismConstraintMatrix", "::", "rules"}], "]"}], ";", " ", 
    "vars"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4223]:=",ExpressionUUID->"d218d248-ce20-48a5-af65-68e0c4272cc5"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismAugmentedConstraintMatrix[]", "Subsection",ExpressionUUID->"ad21117c-44e4-446d-8ebc-675dcaedf199"],

Cell["\<\
Bugs: specified constraints must be in the form of an equation (apparently).\
\>", "Text",ExpressionUUID->"9e39eab6-78a5-47c9-8d4a-3e1e48178ab7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismAugmentedConstraintMatrix", "]"}], " ", 
    "=", " ", 
    RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismAugmentedConstraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"pi_", "?", "PeriodicIdentificationDataQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"augmentedConstraintMatrixInternal", "[", " ", 
       RowBox[{"m", " ", ",", " ", "pi", ",", " ", 
        RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"MatrixQ", "[", " ", "res", " ", "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4230]:=",ExpressionUUID->"6dac9b4f-30a2-4a84-a0c4-510db4fe60c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"augmentedConstraintMatrixInternal", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "pi_", " ", ",", " ", "options_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"constraints", " ", "=", " ", 
       RowBox[{
        RowBox[{"pi", "[", 
         RowBox[{"\"\<LatticeVectors\>\"", " ", "->", " ", 
          RowBox[{"designArbitraryBasis", "[", 
           RowBox[{"pi", ",", "\"\<a\>\""}], "]"}]}], "]"}], "[", 
        "Constraints", "]"}]}], ",", "\n", "\t", "constraintEq", ",", " ", 
      "variables"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"constraintEq", " ", "=", " ", 
      RowBox[{"MechanismConstraintEquations", "[", 
       RowBox[{"m", ",", " ", "1", ",", " ", 
        RowBox[{"Normal", "@", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Constraints", " ", "->", " ", "constraints"}], "}"}], 
             ",", "options"}], "}"}], ",", "Flatten"}], "]"}]}]}], " ", 
       "]"}]}], ";", "\n", "\t", 
     RowBox[{"variables", " ", "=", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", "m", "]"}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\"\<a\>\"", ",", " ", 
           RowBox[{"numberOfLatticeElements", "[", " ", 
            RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
            "]"}]}], " ", "]"}]}], " ", "}"}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"CoefficientArrays", "[", " ", 
       RowBox[{"constraintEq", " ", ",", " ", "variables"}], " ", "]"}], "[", 
      
      RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4232]:=",ExpressionUUID->"48032c11-b473-4e3c-8376-40462be1cec4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"numberOfLatticeElements", "[", "2", "]"}], " ", "=", " ", "3"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"numberOfLatticeElements", "[", "3", "]"}], " ", "=", " ", "6"}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"designArbitraryBasis", "[", " ", 
   RowBox[{"pi_", " ", ",", " ", "name_"}], " ", "]"}], " ", ":=", " ", "\n", 
  
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"pi", "[", " ", "\"\<EmbeddingDimension\>\"", " ", "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"basis", " ", "=", " ", 
       RowBox[{"pi", "[", " ", "\"\<LatticeVectors\>\"", " ", "]"}]}]}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{"Switch", "[", 
     RowBox[{"d", ",", "\n", "\t\t", "2", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "1", "]"}], ",", " ", "0"}], "}"}]}], " ", 
        ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "2", "]"}], ",", " ", 
           RowBox[{"name", "[", "3", "]"}]}], "}"}]}]}], " ", "}"}], ",", 
      "\n", "\t\t", "3", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "1", "]"}], ",", " ", "0", ",", " ", "0"}], 
          "}"}]}], " ", ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "2", "]"}], ",", " ", 
           RowBox[{"name", "[", "3", "]"}], ",", " ", "0"}], "}"}]}], " ", 
        ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "4", "]"}], ",", " ", 
           RowBox[{"name", "[", "5", "]"}], ",", " ", 
           RowBox[{"name", "[", "6", "]"}]}], " ", "}"}]}]}], "}"}], ",", 
      "\n", "\t\t", "_", " ", ",", " ", "$Failed"}], "\n", "\t", "]"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4233]:=",ExpressionUUID->"76236e65-adae-458b-9b18-cad6148ca08d"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismZeroModes[], MechanismSelfStresses[]", "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismZeroModes", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], ",", " ", 
      RowBox[{"Options", "[", "Eigensystem", "]"}], " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"Tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "10"}], ")"}]}]}], "}"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismZeroModes", "::", "num"}], "=", 
    "\"\<The constraint matrix is not numerical.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismZeroModes", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"MechanismZeroModes", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"mat", "=", 
         RowBox[{"MechanismConstraintMatrix", "[", 
          RowBox[{"m", ",", " ", "positions", ",", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}]}], 
            " ", "]"}]}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"dim", "=", 
         RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", "\n", 
        "\t", "evalues"}], "\n", "}"}], ",", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"evalues", " ", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Transpose", "[", "mat", "]"}], " ", ".", " ", "mat"}],
               ",", " ", 
              RowBox[{"FilterRules", "[", " ", 
               RowBox[{
                RowBox[{"{", "opt", "}"}], ",", " ", 
                RowBox[{"Options", "[", "Eigenvalues", "]"}]}], " ", "]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"evalues", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
            RowBox[{"-", 
             RowBox[{"Count", "[", 
              RowBox[{
               RowBox[{"evalues", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "]"}]}]}], 
           "]"}]}]}], "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", " ", "@", " ", 
          RowBox[{"MatrixQ", "[", 
           RowBox[{"mat", ",", " ", "NumericQ"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismZeroModes", "::", "num"}], "]"}], ";", " ", 
          "False"}], ",", " ", "True"}], "]"}]}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "::", "vcoord"}], "=", 
   "\"\<Vertex positions do not match Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismZeroModes", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"Except", "[", " ", "__Rule", " ", "]"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismZeroModes", "::", "vcoord"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4236]:=",ExpressionUUID->"ae1e713b-def1-4284-a80c-7c15c0aec447"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismSelfStresses", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], ",", " ", 
      RowBox[{"Options", "[", "Eigensystem", "]"}], " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"Tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "10"}], ")"}]}]}], "}"}]}], " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismSelfStresses", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"MechanismSelfStresses", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"mat", "=", 
         RowBox[{"MechanismConstraintMatrix", "[", 
          RowBox[{"m", ",", " ", "positions", ",", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}]}], 
            " ", "]"}]}], "]"}]}], ",", "\n", "\t", "evalues"}], "\n", "}"}], 
      ",", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"evalues", " ", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{
              RowBox[{"mat", " ", ".", " ", 
               RowBox[{"Transpose", "[", "mat", "]"}]}], " ", ",", " ", 
              RowBox[{"FilterRules", "[", " ", 
               RowBox[{
                RowBox[{"{", "opt", "}"}], ",", " ", 
                RowBox[{"Options", "[", "Eigenvalues", "]"}]}], " ", "]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"evalues", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"-", 
            RowBox[{"Count", "[", 
             RowBox[{
              RowBox[{"evalues", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "]"}]}]}], "]"}]}],
         "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", " ", "@", " ", 
          RowBox[{"MatrixQ", "[", 
           RowBox[{"mat", ",", " ", "NumericQ"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismSelfStresses", "::", "num"}], "]"}], ";", " ", 
          "False"}], ",", " ", "True"}], "]"}]}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "vcoord"}], "=", 
   "\"\<Vertex positions do not match Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismSelfStresses", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"Except", "[", " ", "__Rule", " ", "]"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismSelfStresses", "::", "vcoord"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4242]:=",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismStressMatrix[]", "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"MechanismStressMatrix", "[", " ", 
     RowBox[{"m", ",", " ", "vec"}], " ", "]"}], " ", "returns", " ", "a", 
    " ", "stress", " ", "matrix", " ", "associated", " ", "with", " ", "the", 
    " ", "stress", " ", "vector", " ", 
    RowBox[{"vec", ".", " ", "The"}], " ", 
    RowBox[{"(", 
     RowBox[{"i", ",", "j"}], ")"}], " ", "component", " ", "of", " ", "the", 
    " ", "stress", " ", "matrix", " ", "is", " ", "the", " ", "negative", " ",
     "of", " ", "the", " ", "corresponding", "\n", "stress", " ", "vector", 
    " ", "component", " ", 
    RowBox[{"(", 
     RowBox[{"and", " ", "zero", " ", "otherwise"}], ")"}], " ", "and", " ", 
    "diagonal", " ", "components", " ", "are", " ", "chosen", " ", "so", " ", 
    "that", " ", "rows", " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", "Columns"}], " ", "should", " ", "also", 
    " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", 
     RowBox[{"(", 
      RowBox[{
      "see", " ", "Connelly", " ", "on", " ", "generic", " ", "global", " ", 
       "rigidity"}], ")"}]}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MechanismStressMatrix", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "stressVector_"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
        "offDiagonalComponents", ",", " ", "diagonalComponents", ",", " ", 
         RowBox[{"edges", " ", "=", " ", 
          RowBox[{"MechanismConnectivity", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{
            "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
           "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"offDiagonalComponents", " ", "=", " ", "\n", "\t", 
         RowBox[{
          RowBox[{"(", "\n", "\t\t", 
           RowBox[{"(*", "symmetrize", "*)"}], "\n", "\t\t", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", " ", "+", " ", 
              RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], " ", ")"}], 
           "\n", "\t", ")"}], " ", "@", " ", 
          RowBox[{"SparseArray", "[", " ", "\n", "\t\t", 
           RowBox[{
            RowBox[{"Thread", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "\[Rule]", " ", 
              RowBox[{"-", "stressVector"}]}], " ", "]"}], ",", "\n", "\t\t", 
            
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "}"}]}],
            "\n", "\t", "]"}]}]}], ";", "\n", "\t", 
        RowBox[{"diagonalComponents", " ", "=", " ", 
         RowBox[{"SparseArray", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", "#"}], "}"}], "&"}], " ", "/@", " ", 
               RowBox[{"Range", "[", " ", 
                RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}]}],
               ")"}], " ", "\[Rule]", " ", 
             RowBox[{"(", 
              RowBox[{"-", " ", 
               RowBox[{"Total", " ", "/@", " ", 
                RowBox[{"Map", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"offDiagonalComponents", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "]"}], 
                   "&"}], ",", " ", 
                  RowBox[{"MechanismConnectivity", "[", 
                   RowBox[{"m", ",", " ", 
                    RowBox[{
                    "\"\<vertices\>\"", " ", "\[Rule]", " ", 
                    "\"\<edges\>\""}]}], "]"}], " ", ",", " ", 
                  RowBox[{"{", "2", "}"}]}], " ", "]"}]}]}], ")"}]}], " ", 
            "]"}], ",", "\n", "\t\t", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
             RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "}"}]}], 
          "\n", "\t", "]"}]}], ";", "\n", "\t", "\n", "\t", 
        RowBox[{
        "offDiagonalComponents", " ", "+", " ", "diagonalComponents"}]}]}], 
      "\n", "]"}], " ", "/;", " ", 
     RowBox[{"MechanismStressMatrixArgumentsQ", "[", " ", 
      RowBox[{"m", ",", " ", "stressVector"}], " ", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismStressMatrix", "::", "svec"}], "=", 
     "\"\<Stress vector is not a vector.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismStressMatrix", "::", "len"}], "=", 
     "\"\<Stress vector length is not the same as the number of edges.\>\""}],
     ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismStressMatrixArgumentsQ", "[", " ", 
     RowBox[{"m_", ",", " ", "stressVector_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"Which", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Not", " ", "@", " ", 
       RowBox[{"VectorQ", "[", " ", "stressVector", " ", "]"}]}], " ", ",", 
      "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismStressMatrix", "::", "svec"}], "]"}], ";", " ", 
       "False"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"m", "[", "\"\<edges\>\"", "]"}], "]"}], " ", "\[NotEqual]", 
       " ", 
       RowBox[{"Length", "[", "stressVector", "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismStressMatrix", "::", "len"}], "]"}], ";", " ", 
       "False"}], ",", "\n", "\t", "True", ",", " ", "True"}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4247]:=",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismInfinitesimalMotions[]", "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismInfinitesimalMotions", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
       RowBox[{"OutputVariables", "\[Rule]", "Automatic"}]}], "}"}], ",", " ", 
     RowBox[{"Options", "[", "NullSpace", "]"}]}], " ", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4251]:=",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"actualPositions", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"positions", "===", "Automatic"}], ",", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "positions"}], 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"MechanismInfinitesimalMotionsInternal", "[", 
           RowBox[{"m", ",", "actualPositions", ",", 
            RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", 
            RowBox[{"OptionValue", "[", "OutputVariables", "]"}], ",", " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", 
              RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], "]"}]}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "\t ", "]"}], " ", "/;",
       " ", 
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "actualPositions"}], "]"}]}]}], "\n", "]"}]}], "\n", 
  "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "failed"}], "=", 
   "\"\<Failed to find an appropriate solution. Check the constraints.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "pos"}], "=", 
   "\"\<Positions do not match those of Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismInfinitesimalMotions", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"Automatic", "|", "_Rule"}], "]"}]}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", "\n", "\t", 
   RowBox[{"Which", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MechanismInfinitesimalMotions", "::", "pos"}], "]"}], ";", 
      " ", "False"}], ",", "\n", "\t\t", "True", ",", " ", "False"}], "\n", 
    "\t", "]"}]}]}]}], "Code",
 CellLabel->
  "In[4252]:=",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "var"}], "=", 
   "\"\<Variables listed are not of the form VertexDisplacement[n,c].\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "sing"}], "=", 
   "\"\<Jacobian matrix is singular. Recovering using generic \
variables.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "jac"}], "=", 
   "\"\<Jacobian matrix may not be invertible. Choosing different \
displacements may give better results.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "lin"}], "=", 
   "\"\<Found `1` linear motions so `1` displacements are needed.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4256]:=",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismInfinitesimalMotionsInternal", "[", 
   RowBox[{
   "m_", ",", "positions_", ",", "inputConstraints_", ",", "v_", ",", 
    "nullspaceOptions_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"matrix", ",", "dependencies", ",", "solution"}], "}"}], ",", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"variables", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}]}], ",", "\n", 
        "\n", 
        RowBox[{"(*", 
         RowBox[{
         "collect", " ", "all", " ", "the", " ", "constraints", " ", "valid", 
          " ", "to", " ", "2", "nd", " ", "order", " ", "in", " ", "the", " ",
           "displacements"}], " ", "*)"}], "\n", 
        RowBox[{"equations", "=", 
         RowBox[{"mechanismConstraintEquationsInternal", "[", 
          RowBox[{
          "m", ",", " ", "positions", ",", " ", "2", ",", " ", "_", ",", " ", 
           "inputConstraints", ",", " ", "VertexDisplacement"}], "]"}]}]}], 
       "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"linearize", " ", "the", " ", "equations"}], "*)"}], "\n", 
      "\t", 
      RowBox[{
       RowBox[{"matrix", "=", 
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{"equations", ",", "variables", ",", " ", 
          RowBox[{"\"\<Symmetric\>\"", "\[Rule]", "True"}]}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"(*", "\n", "\t", 
        RowBox[{
         RowBox[{
         "Find", " ", "dependencies", " ", "among", " ", "the", " ", "linear",
           " ", 
          RowBox[{"equations", ".", "\n", "\n", "\t", "When"}], " ", "the", 
          " ", "constraints", " ", "arise", " ", "only", " ", "from", " ", 
          "edge", " ", "stretching"}], ",", " ", 
         RowBox[{
          RowBox[{
          "these", " ", "dependences", " ", "are", " ", "the", " ", "self"}], 
          "-", 
          RowBox[{"stresses", "."}]}]}], "\n", "\t", "*)"}], "\n", "\t", 
       RowBox[{"dependencies", "=", 
        RowBox[{"Orthogonalize", "[", 
         RowBox[{"NullSpace", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"matrix", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "nullspaceOptions"}],
           "]"}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "linear", " ", "displacements", " ", "that", " ", "are", 
         " ", "allowed"}], "*)"}], "\n", "\t", 
       RowBox[{"solution", "=", 
        RowBox[{"linearMotionsToDisplacementRules", "[", 
         RowBox[{"m", ",", 
          RowBox[{"linearMotions", "[", 
           RowBox[{"m", ",", 
            RowBox[{"matrix", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "nullspaceOptions"}], "]"}],
           ",", "v"}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Which", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"solution", "===", "$Failed"}], ",", " ", "$Failed", ",", 
         "\n", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Length", "[", "solution", "]"}], ">", "0"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"Expand", "[", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "analytical", " ", "processing", " ", "that", " ", "I", " ", 
             "prefer"}], ",", " ", 
            RowBox[{
            "but", " ", "should", " ", "not", " ", "take", " ", "a", " ", 
             "long", " ", "time", " ", "to", " ", "perform"}]}], "*)"}], "\n",
           "\t\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"VertexDisplacement", "[", "m", "]"}], ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "dependencies", "]"}], ">", "0"}], ",", 
               RowBox[{"dependencies", " ", ".", " ", "equations"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], " ", "/.",
            " ", 
           RowBox[{"Dispatch", "[", "solution", "]"}]}], "\n", "\t\t\t", 
          "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "no", " ", "solution", " ", "but", " ", "no", " ", "errors", " ", 
           "either"}], "*)"}], "\n", "\t\t", "True", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismInfinitesimalMotions", "::", "failed"}], "]"}], 
          ";", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "}"}]}], "}"}]}]}], "\n", "\t", "]"}]}]}], "\n", 
     "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[4260]:=",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_"}], "]"}], 
   ":=", 
   RowBox[{
    RowBox[{"{", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_List"}], 
    "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{"(*", 
     RowBox[{"preprocess", " ", "arguments"}], "*)"}], "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"displacements", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "inputDisplacements", "}"}], "]"}]}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"Module", "[", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "x", ",", "y", ",", "c", ",", "rules", ",", "jacobianMatrix", ",", 
          "inverseJacobian", ",", "displacementIndices"}], "}"}], ",", "\n", 
        "\t", 
        RowBox[{
         RowBox[{"displacementIndices", "=", 
          RowBox[{
           RowBox[{"displacements", "/.", 
            RowBox[{
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{"x_", ",", "y_"}], "]"}], "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<x\>\"", "\[Rule]", "1"}], ",", 
             RowBox[{"\"\<y\>\"", "\[Rule]", "2"}], ",", 
             RowBox[{"\"\<z\>\"", "\[Rule]", "3"}]}], "}"}]}]}], ";", "\n", 
         "\t", 
         RowBox[{"jacobianMatrix", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"linearMotions", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"Sequence", "@@", "#"}]}], "]"}], "]"}], "&"}], "/@", 
           "displacementIndices"}]}], ";", "\n", "\t", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "if", " ", "inverting", " ", "the", " ", "jacobian", " ", "fails", 
            " ", "entirely"}], ",", " ", 
           RowBox[{
            RowBox[{"we", "'"}], "ll", " ", "need", " ", "to", " ", "deal", 
            " ", "with", " ", 
            RowBox[{"that", "."}]}]}], "*)"}], "\n", "\t", 
         RowBox[{"inverseJacobian", "=", 
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"Inverse", "[", "jacobianMatrix", "]"}], ",", "\n", 
            "\t\t", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"MechanismInfinitesimalMotions", "::", "sing"}], "]"}], 
             ";", "\n", "\t\t", 
             RowBox[{"Return", "[", 
              RowBox[{"linearMotionsToDisplacementRules", "[", 
               RowBox[{"m", ",", "linearMotions", ",", "Automatic"}], "]"}], 
              "]"}]}], ",", "\n", "\t\t", 
            RowBox[{"Inverse", "::", "sing"}]}], "\n", "\t", "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
          "warn", " ", "that", " ", "the", " ", "jacobian", " ", "matrix", 
           " ", "is", " ", "almost", " ", "singular"}], "*)"}], "\n", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Det", "[", "jacobianMatrix", "]"}], "]"}], "<", 
            RowBox[{"10", "^", 
             RowBox[{"(", 
              RowBox[{"-", "16"}], ")"}]}]}], ",", 
           RowBox[{"Message", "[", 
            RowBox[{"MechanismInfinitesimalMotions", "::", "jac"}], "]"}]}], 
          "]"}], ";", "\n", "\n", "\t", 
         RowBox[{"rules", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Array", "[", 
             RowBox[{"c", ",", 
              RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], "->", 
            RowBox[{"inverseJacobian", " ", ".", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "displacements", "}"}], "]"}]}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Array", "[", 
               RowBox[{"c", ",", 
                RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], " ", 
              ".", " ", "linearMotions"}], "/.", "rules"}], "]"}]}], 
          "]"}]}]}], "\n", "\n", "]"}], "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "&&", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"displacements", ",", 
         RowBox[{"{", "__VertexDisplacement", "}"}]}], "]"}]}]}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "Automatic"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", "=", 
        RowBox[{"Unique", "[", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{"v", ",", 
            RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
          " ", "linearMotions"}], "]"}]}], "]"}]}], "\n", "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"linearMotionsToDisplacementRules", "[", 
   RowBox[{"m_", ",", "linearMotions_", ",", "c_Symbol"}], "]"}], ":=", "\n", 
  "\t", 
  RowBox[{
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Array", "[", 
        RowBox[{"c", ",", 
         RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
       " ", "linearMotions"}], "]"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}]}], "Code",
 CellLabel->
  "In[4261]:=",ExpressionUUID->"acf53775-617a-4c64-abce-1ca8d0a00a98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"linearMotionsToDisplacementRules", "[", 
   RowBox[{"m_", ",", "linearMotions_", ",", "displacements_"}], "]"}], ":=", 
  
  RowBox[{"Which", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Not", "[", 
     RowBox[{"MatchQ", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "displacements", "}"}], "]"}], ",", 
       RowBox[{"{", "__VertexDisplacement", "}"}]}], "]"}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismInfinitesimalMotions", "::", "var"}], "]"}], ";", 
     "\n", "\t\t", "$Failed"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[NotEqual]", 
     RowBox[{"Length", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "displacements", "}"}], "]"}], "]"}]}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismInfinitesimalMotions", "::", "lin"}], ",", 
       RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], ";", "\n", 
     "\t\t", "$Failed"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
    "$Failed"}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4265]:=",ExpressionUUID->"cc158a20-c3f3-4d03-9644-fc087c2118ee"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["some functions to do faster computations", "Section",ExpressionUUID->"d6a44126-9792-4309-a17f-48bcc9564428"],

Cell[CellGroupData[{

Cell["MechanismConstraintMatrixFunction[]", "Subsection",ExpressionUUID->"5e57b61a-d219-4934-a890-cd59956902d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismConstraintMatrixFunction", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}], ",", " ", 
      RowBox[{"EliminationRules", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], " ", ",", "  ", 
      RowBox[{"\"\<options\>\"", " ", "->", " ", 
       RowBox[{"{", "}"}]}]}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrixFunction", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"constraintMatrices", ",", " ", "vars", " ", ",", " ", 
       RowBox[{"symb", " ", "=", " ", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "\"\<x\>\"", "]"}], "&"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "]"}]}], 
         "]"}]}], ",", " ", "map", ",", " ", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", " ", "f", ",", " ", 
       
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"Unique", "[", "]"}]}]}], " ", "}"}], ",", "\n", "\n", "\t", 
     RowBox[{
      RowBox[{"vars", " ", "=", " ", 
       RowBox[{"Check", "[", " ", 
        RowBox[{
         RowBox[{"reduceVariables", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], " ", ",", 
           " ", 
           RowBox[{"OptionValue", "[", "EliminationRules", "]"}]}], " ", 
          "]"}], ",", " ", "$Failed"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"constraintMatrices", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"vars", " ", "===", " ", "$Failed"}], ",", "\n", "\n", 
         "\t\t", 
         RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"mechanismConstraintEquationsInternal", "[", 
            RowBox[{"m", ",", " ", "positions", ",", " ", "1", ",", " ", 
             RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
             RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
             "VertexDisplacement"}], "]"}], ",", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}]}], "\n", 
          "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"mechanismConstraintEquationsInternal", "[", 
             RowBox[{"m", ",", " ", "positions", ",", " ", "1", ",", " ", 
              RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
              "VertexDisplacement"}], "]"}], " ", "//.", " ", 
            RowBox[{"OptionValue", "[", "EliminationRules", "]"}]}], ",", 
           "\n", "\t\t\t", "vars"}], "\n", "\t\t", "]"}]}], "\n", "\t", 
        "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"Which", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"constraintMatrices", "\[Equal]", 
         RowBox[{"{", 
          RowBox[{"{", "}"}], "}"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
            RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "]"}], "}"}],
         ",", "\n", "\t\t", "\n", "\t\t", "True", ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"map", "=", 
          RowBox[{"Dispatch", "@", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
             "symb"}], "]"}]}]}], ";", "\n", "\t\t\t", 
         RowBox[{"Compile", " ", "@@", " ", 
          RowBox[{"{", " ", 
           RowBox[{"symb", ",", " ", 
            RowBox[{
             RowBox[{"Normal", "@", 
              RowBox[{"constraintMatrices", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], " ", "/.", " ", "map"}], ",",
             " ", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"OptionValue", "[", "\"\<options\>\"", "]"}], "]"}], 
               " ", "==", " ", "0"}], " ", ",", " ", "Nothing", " ", ",", " ", 
              RowBox[{"OptionValue", "[", "\"\<options\>\"", "]"}]}], " ", 
             "]"}]}], " ", "}"}]}]}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"{", "}"}]}], "]"}], ":=", "vars"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Rule", "[", " ", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", 
          RowBox[{"_", ",", "_"}], "]"}], ",", " ", "_"}], " ", "]"}], ".."}],
       "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"Variables", "[", 
     RowBox[{"vars", " ", "//.", " ", "rules"}], "]"}], ",", 
    "_VertexDisplacement"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"reduceVariables", "[", 
    RowBox[{"vars_", ",", " ", "notRules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"MechanismConstraintMatrixFunction", "::", "rules"}], "]"}], 
     ";", " ", "vars"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrixFunction", "::", "rules"}], "=", 
   "\"\<Replacement rules are not of the form { VertexDisplacement[v1, c1] -> \
.., .. }.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4266]:=",ExpressionUUID->"b8f6c0e1-9575-4565-94e8-3146faa40eae"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEnergyFunction[]", "Subsection",ExpressionUUID->"bc938ce6-3992-448f-acc2-17a2ed40c182"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismEnergyFunction", "]"}], " ", ":=", " ", 
    
    RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEnergyFunction", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{"MechanismEnergy", "[", 
        RowBox[{"m", ",", " ", "opt"}], " ", "]"}]}], ",", " ", "\n", 
      RowBox[{"symb", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Unique", "[", "\"\<x\>\"", "]"}], "&"}], ",", 
         RowBox[{"Length", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "]"}]}], "]"}]}],
       ",", " ", "\n", "map"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"map", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
         "symb"}], "]"}]}]}], ";", "\n", "\t", 
     RowBox[{"Function", " ", "@@", " ", 
      RowBox[{"{", " ", 
       RowBox[{"symb", ",", " ", 
        RowBox[{"energy", " ", "/.", " ", "map"}]}], "}"}]}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4272]:=",ExpressionUUID->"dad8f07f-6e82-4d90-82ad-f6ac6a36ef22"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["energy minimization", "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],

Cell[CellGroupData[{

Cell["MinimizeMechanismEnergy[]", "Subsection",ExpressionUUID->"73422a9f-f78f-40d0-b5cf-0b9ca1818700"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MinimizeMechanismEnergy", "]"}], "=", 
   RowBox[{"Join", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"InitialPositions", "->", "Automatic"}], "}"}], ",", " ", 
     RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
     RowBox[{"Options", "[", "FindMinimum", "]"}]}], " ", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"MinimizeMechanismEnergy", ",", "HoldRest"}], "]"}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "badinitial"}], "=", 
   "\"\<Initial conditions are not well-formed numeric positions matching the \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "data"}], "=", 
   "\"\<Data for compiled function not a vector of numerical values.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], "=", 
   "\"\<Energy is not numerical at initial condition.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "In[4274]:=",ExpressionUUID->"3e97a0de-a970-4d5c-ab00-d0691ecf3e87"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"energy", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"MinimizemechanismEnergyInternal", "[", " ", 
        RowBox[{"m", ",", " ", "energy", ",", " ", 
         RowBox[{"OptionValue", "[", "InitialPositions", "]"}], ",", " ", 
         RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MinimizemechanismEnergyInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "energyExpression_", ",", " ", "initial_", ",", " ", 
    "opt_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", 
        RowBox[{"m", ",", " ", "energyExpression", ",", " ", "opt"}], " ", 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"MinimizeMechanismEnergyInitialPositions", "[", 
        RowBox[{"m", ",", " ", "initial"}], " ", "]"}]}], ",", "\n", "\t", 
      "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"energy", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"initialPositions", " ", "=!=", " ", "$Failed"}]}], ",", "\n", 
      "\t\t", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"MinimizeMechanismEnergyMinimize", "[", " ", 
         RowBox[{
         "m", ",", " ", "energy", ",", " ", "initialPositions", ",", " ", 
          "opt"}], " ", "]"}]}], ";", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", " ", 
           RowBox[{"Dimensions", "[", "initial", "]"}], " ", "]"}], " ", 
          "\[Equal]", " ", "3"}], ",", " ", "res", ",", " ", 
         RowBox[{"First", "[", "res", "]"}]}], " ", "]"}]}], ",", "\n", 
      "\t\t", "$Failed"}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4279]:=",ExpressionUUID->"cad7656e-ac79-4b74-bd8a-9e72c0644b19"],

Cell[CellGroupData[{

Cell["\<\
MinimizeMechanismEnergyInitialPositions[], \
MinimizeMechanismEnergyComputeEnergy[]\
\>", "Subsubsection",ExpressionUUID->"ce099429-1333-43b9-b495-fa2b90f21605"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"parse", " ", "the", " ", "arguments"}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"{", "initialPositions", "}"}], " ", "/;", " ", 
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "initialPositions"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayQ", "[", 
          RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"initialPositions", " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "initialPositions", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], " ", "\[Equal]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}]}]}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MinimizeMechanismEnergy", "::", "badinitial"}], "]"}], ";", 
      " ", "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{"(*", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic", ",", " ", "options_"}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"MechanismEnergy", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"{", "options", "}"}], ",", " ", 
        RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}]}], " ", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "compiledNumericalMechanismEnergyQ"}], ",", " ",
       "options_"}], " ", "]"}], " ", ":=", " ", "energy"}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "analyticEnergy_", ",", " ", "options_"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"analyticEnergy", " ", "/;", " ", 
     RowBox[{"analyticEnergyQ", "[", 
      RowBox[{"analyticEnergy", ",", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "]"}]}]}], "\n", "\n", 
   
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}], ",", " ", 
      "options_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MinimizeMechanismEnergy", "::", "data"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "badEnergy_", ",", " ", "options_"}], " ", "]"}],
     " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}]}]}]], "Code",
 CellLabel->
  "In[4281]:=",ExpressionUUID->"9357dc4e-c4b9-4298-9e85-37d87e5d3ebc"]
}, Closed]],

Cell[CellGroupData[{

Cell["MinimizeMechanismEnergyMinimize[]", "Subsubsection",ExpressionUUID->"603d4498-8b6c-4503-933d-b4a9c97b5661"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"energy", " ", "is", " ", "a", " ", "compiled", " ", "function"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyMinimize", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "compiledNumericalMechanismEnergyQ"}], ",", " ",
       "initialPositions_", ",", " ", "options_"}], " ", "]"}], " ", ":=", 
    "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"constraintData", " ", "=", " ", 
         RowBox[{"processConstraintEquations", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t\t", 
           RowBox[{"MechanismConstraintEquations", "[", " ", 
            RowBox[{"m", ",", " ", 
             RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
             "Infinity", ",", " ", 
             RowBox[{"Flatten", " ", "@", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "ConstraintOutput", " ", "\[Rule]", " ", "VertexPosition"}], 
                ",", " ", 
                RowBox[{"FilterRules", "[", 
                 RowBox[{"options", ",", " ", 
                  RowBox[{
                  "Options", "[", "MechanismConstraintEquations", "]"}]}], 
                 " ", "]"}]}], " ", "}"}]}]}], " ", "]"}]}], "\n", "\t", 
          "]"}]}], ",", "\n", "\t", 
        RowBox[{"data", " ", "=", " ", 
         RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], ",", " ", 
        RowBox[{"allVariables", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", "\t",
         "variables", ",", " ", "variableSpecifications", ",", " ", 
        "linearConstraints", ",", "\n", "\t", "\n", "\t", 
        RowBox[{"minimizationOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", "\n",
         "\t", "minimizationResults"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
         "constraintData", "[", " ", "\"\<constrained positions\>\"", " ", 
          "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variableSpecifications", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{"allVariables", ",", " ", 
             RowBox[{"Flatten", " ", "@", " ", "#"}]}], "}"}], " ", "]"}], 
          "&"}], " ", "/@", " ", "initialPositions"}]}], ";", "\n", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "turn", " ", "the", " ", "solved", " ", "linear", " ", "constraints", 
         " ", "into", " ", "simple", " ", "linear", " ", "constraints"}], 
        "*)"}], "\n", "\t", 
       RowBox[{"linearConstraints", " ", "=", " ", 
        RowBox[{"Equal", " ", "@@@", " ", 
         RowBox[{
         "constraintData", "[", " ", "\"\<linear solutions\>\"", " ", 
          "]"}]}]}], ";", "\n", "\n", "\t", 
       RowBox[{"minimizationResults", " ", "=", " ", 
        RowBox[{"Cases", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Map", "[", " ", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"executeMinimizationCompiled", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{
                RowBox[{"energy", "[", "\"\<energy\>\"", "]"}], "[", 
                RowBox[{"variables", ",", " ", "data"}], "]"}], ",", " ", 
               "\n", "\t\t\t\t", "linearConstraints", ",", " ", "\n", 
               "\t\t\t\t", "#", ",", " ", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{"energy", "[", "\"\<gradient\>\"", "]"}], "[", 
                RowBox[{"variables", ",", "data"}], "]"}], ",", " ", "\n", 
               "\t\t\t\t", "minimizationOptions"}], " ", "\n", "\t\t\t", 
              "]"}], "&"}], ",", "\n", "\t\t\t", "variableSpecifications"}], 
           "\n", "\t\t", "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
          RowBox[{"{", " ", 
           RowBox[{"_", " ", ",", " ", 
            RowBox[{"{", "__Rule", "}"}]}], " ", "}"}]}], "\n", "\t", "]"}]}],
        ";", "\n", "\t", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "minimizationResults", "]"}], ">", "0"}], 
         ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
             RowBox[{
              RowBox[{
              "constraintData", "[", "\"\<constrained positions\>\"", "]"}], 
              " ", "/.", " ", 
              RowBox[{"Dispatch", "[", " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], " ", "]"}]}]}], " ", "}"}], 
           "&"}], " ", "/@", " ", "minimizationResults"}], ",", "\n", "\t\t", 
         
         RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"executeMinimizationCompiled", "[", " ", 
     RowBox[{"energy_", ",", " ", 
      RowBox[{"{", "}"}], ",", " ", "initial_", ",", " ", "gradient_", ",", 
      " ", "options_"}], " ", "]"}], ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "tmp", "}"}], ",", "\n", "\t", 
      RowBox[{"Check", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"tmp", " ", "=", " ", 
         RowBox[{"FindMinimum", " ", "@@", " ", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{"energy", ",", " ", 
            RowBox[{"Sequence", " ", "@@", " ", "initial"}], ",", " ", 
            RowBox[{"Gradient", " ", "\[RuleDelayed]", " ", "gradient"}], ",",
             " ", "options"}], " ", "\n", "\t\t", "}"}]}]}], ",", "\n", 
        "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "tmp", "]"}], "\[Equal]", "2"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<error\>\"", "@", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
            RowBox[{"tmp", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], ",", " ", 
          "$Failed"}], " ", "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"executeMinimizationCompiled", "[", " ", 
     RowBox[{
     "energy_", ",", " ", "constraints_", ",", " ", "initial_", ",", " ", 
      "gradient_", ",", " ", "options_"}], " ", "]"}], ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "tmp", "}"}], ",", "\n", "\t", 
      RowBox[{"tmp", " ", "=", " ", 
       RowBox[{"Check", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"FindMinimum", " ", "@@", " ", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"Flatten", "[", " ", 
             RowBox[{"{", 
              RowBox[{"energy", ",", " ", "constraints"}], "}"}], " ", "]"}], 
            ",", " ", 
            RowBox[{"Sequence", " ", "@@", " ", "initial"}], ",", " ", 
            RowBox[{"Gradient", " ", "\[RuleDelayed]", " ", "gradient"}], ",",
             " ", "options"}], " ", "\n", "\t\t", "}"}]}], ",", "\n", "\t\t", 
         
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "tmp", "]"}], "\[Equal]", "2"}], ",", " ", 
           
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<error\>\"", " ", "@", " ", 
              RowBox[{"tmp", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], ",", " ", 
           "$Failed"}], " ", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], 
   "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "energy", " ", "is", " ", "an", " ", "analytic", " ", "expression"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"MinimizeMechanismEnergyMinimize", "[", " ", 
     RowBox[{
     "m_", ",", " ", "energy_", ",", " ", "initialPositions_", ",", " ", 
      "options_"}], " ", "]"}], " ", ":=", " ", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"constraintData", " ", "=", " ", 
         RowBox[{"processConstraintEquations", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t\t", 
           RowBox[{"MechanismConstraintEquations", "[", " ", 
            RowBox[{"m", ",", " ", 
             RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
             "Infinity", ",", " ", 
             RowBox[{"Flatten", " ", "@", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "ConstraintOutput", " ", "\[Rule]", " ", "VertexPosition"}], 
                ",", " ", 
                RowBox[{"FilterRules", "[", 
                 RowBox[{"options", ",", " ", 
                  RowBox[{
                  "Options", "[", "MechanismConstraintEquations", "]"}]}], 
                 " ", "]"}]}], " ", "}"}]}]}], " ", "]"}]}], "\n", "\t", 
          "]"}]}], ",", "\n", "\t", "constrainedEnergy", ",", " ", 
        "variableSpecifications", ",", "\n", "\t", 
        RowBox[{"minimizationOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"options", ",", 
           RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", "\n",
         "\t", "minimizationResults"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"variableSpecifications", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"dynamicVariables", "[", " ", 
           RowBox[{"#", ",", " ", "constraintData"}], " ", "]"}], "&"}], " ", 
         "/@", " ", "initialPositions"}]}], ";", "\n", "\t", 
       RowBox[{"constrainedEnergy", " ", "=", " ", 
        RowBox[{"energy", " ", "/.", " ", 
         RowBox[{"constraintData", "[", "\"\<linear solutions\>\"", "]"}]}]}],
        ";", "\n", "\n", "\t", 
       RowBox[{"minimizationResults", " ", "=", " ", 
        RowBox[{"Cases", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Map", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"executeMinimizationAnalytic", "[", " ", 
              RowBox[{
              "constrainedEnergy", ",", " ", "#", ",", " ", 
               "minimizationOptions"}], " ", "]"}], " ", "&"}], " ", ",", " ",
             "variableSpecifications"}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{"{", " ", 
           RowBox[{"_", ",", " ", 
            RowBox[{"{", "__Rule", "}"}]}], "}"}]}], "\n", "\t", "]"}]}], ";",
        "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "minimizationResults", "]"}], ">", "0"}], 
         ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
             RowBox[{
              RowBox[{
              "constraintData", "[", "\"\<constrained positions\>\"", "]"}], 
              " ", "/.", " ", 
              RowBox[{"Dispatch", "[", " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], " ", "]"}]}]}], " ", "}"}], 
           "&"}], " ", "/@", " ", "minimizationResults"}], ",", "\n", "\t\t", 
         
         RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"executeMinimizationAnalytic", "[", " ", 
     RowBox[{"energy_", ",", " ", "data_", ",", " ", "options_"}], " ", "]"}],
     " ", ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "tmp", "}"}], ",", " ", "\n", "\t", 
      RowBox[{"Check", "[", " ", 
       RowBox[{
        RowBox[{"tmp", " ", "=", " ", 
         RowBox[{"FindMinimum", " ", "@@", " ", 
          RowBox[{"{", 
           RowBox[{"energy", ",", " ", "data", ",", " ", 
            RowBox[{"Sequence", " ", "@@", " ", "options"}]}], " ", "}"}]}]}],
         ",", "\n", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "tmp", "]"}], "\[Equal]", "2"}], ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"\"\<error\>\"", " ", "@", " ", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
            RowBox[{"tmp", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", ",", " ", 
          "$Failed"}], " ", "]"}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4290]:=",ExpressionUUID->"9c6a83e3-770d-4c96-b30e-1d9e09063824"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
MechanismDynamicalSystem[], MechanismDynamicalSystemEquations[]\
\>", "Subsection",ExpressionUUID->"f771deb2-a4a2-400f-b0c2-7680cc5b00ac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismDynamicalSystemEquations", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"a", " ", "list", " ", "of", " ", "constraints"}], "*)"}], 
      "\n", "\t", 
      RowBox[{"VertexMass", "\[Rule]", "1"}], ",", "\n", "\t", 
      RowBox[{"VertexDrag", "\[Rule]", "0"}], ",", "\n", "\t", 
      RowBox[{"AddedEnergy", "\[Rule]", "0"}]}], " ", 
     RowBox[{"(*", 
      RowBox[{
      "additional", " ", "terms", " ", "to", " ", "add", " ", "to", " ", 
       "the", " ", "energy"}], "*)"}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismDynamicalSystem", "]"}], "=", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "MechanismDynamicalSystemEquations", "]"}], ",", 
     "\n", "\t", 
     RowBox[{"Options", "[", "NDSolve", "]"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4295]:=",ExpressionUUID->"4315eb56-9425-419f-b071-2e2f797f402d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystemEquations", "::", "drag"}], "=", 
   "\"\<Option VertexDrag cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystemEquations", "::", "mass"}], "=", 
   "\"\<Option VertexMass cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystemEquations", "::", "pos"}], "=", 
   "\"\<Not a valid set of positions.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystemEquations", "::", "var"}], "=", 
   "\"\<Variables should be of the form {variable, time}.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4297]:=",ExpressionUUID->"f36975ed-8d9f-4ec4-babc-cce78e40b1a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"validEquationsParamQ", "[", 
   RowBox[{"value_", "?", "NumericQ"}], "]"}], ":=", 
  RowBox[{"value", " ", "\[GreaterEqual]", " ", "0"}]}], "\n", 
 RowBox[{
  RowBox[{"validEquationsParamQ", "[", 
   RowBox[{"value", " ", ":", " ", 
    RowBox[{"Except", "[", "_List", "]"}]}], "]"}], ":=", 
  RowBox[{"Not", "[", 
   RowBox[{"NumericQ", "[", "value", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"validEquationsParamQ", "[", "_", "]"}], ":=", "False"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags_", "?", "validEquationsParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"drags", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validEquationsParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"drags", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "drags", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandEquationDrags", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismDynamicalSystemEquations", "::", "drag"}], "]"}], ";",
      " ", "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses_", "?", "validEquationsParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"masses", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validEquationsParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"masses", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "masses", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"None", " ", "|", " ", "0"}]}], "]"}], ":=", "None"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandEquationMasses", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismDynamicalSystemEquations", "::", "mass"}], "]"}], ";",
      " ", "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], ":=", 
  RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "positions_"}], "]"}], ":=", 
  RowBox[{"positions", " ", "/;", " ", 
   RowBox[{"VertexPositionsQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"MechanismDynamicalSystemEquations", "::", "pos"}], "]"}], ";", 
    " ", "$Failed"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4301]:=",ExpressionUUID->"bd2ebe0c-ce7f-45f7-bfc1-49aa1aec9a95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystemEquations", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"variableName_Symbol", ",", " ", "timeVariable_Symbol"}], "}"}],
      ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"MechanismEnergy", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Constraints", " ", "\[Rule]", " ", 
            RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], "]"}], " ", 
         "+", " ", 
         RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}]}], ",", "\n", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"evaluateEquationPositions", "[", 
         RowBox[{"m", ",", "initialPositions"}], "]"}]}], ",", "\n", 
       RowBox[{"drags", " ", "=", " ", 
        RowBox[{"expandEquationDrags", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "VertexDrag", "]"}]}], "]"}]}], ",", 
       "\n", 
       RowBox[{"masses", " ", "=", " ", 
        RowBox[{"expandEquationMasses", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "VertexMass", "]"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"MechanismDynamicalSystemEquationsInternal", "[", 
           RowBox[{
           "m", ",", " ", "positions", ",", " ", "variableName", ",", " ", 
            "timeVariable", ",", " ", "masses", ",", " ", "drags", ",", " ", 
            "energy"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"drags", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"masses", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"positions", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"variableName", " ", "=!=", " ", "timeVariable"}]}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismDynamicalSystemEquations", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismDynamicalSystemEquations", "::", "vars"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismDynamicalSystemEquations", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"Except", "[", "_List", "]"}], " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismDynamicalSystemEquations", "::", "vars"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4315]:=",ExpressionUUID->"1b30499b-3dd1-4129-8c80-b3664c73ca01"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystem", "::", "drag"}], "=", 
   "\"\<Option VertexDrag cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystem", "::", "mass"}], "=", 
   "\"\<Option VertexMass cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystem", "::", "timespec"}], "=", 
   "\"\<The last argument should be of the form {time variable, start time, \
end time} with start and end times being numerical and the time variable \
being a Symbol.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4318]:=",ExpressionUUID->"e01b2e15-065d-44be-a333-3bb058054274"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"validDynamicalParamQ", "[", "value_", "]"}], ":=", 
   RowBox[{
    RowBox[{"NumericQ", "[", "value", "]"}], " ", "&&", " ", 
    RowBox[{"value", " ", "\[GreaterEqual]", " ", "0"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags_", "?", "validDynamicalParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"drags", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validDynamicalParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"drags", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "drags", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandDynamicalDrags", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismDynamicalSystem", "::", "drag"}], "]"}], ";", " ", 
     "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "expandDynamicalMasses", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"None", " ", "|", " ", "0"}]}], "]"}], ":=", " ", 
  "None"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses_", "?", "validDynamicalParamQ"}]}], "]"}], ":=", " ", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"masses", ",", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validDynamicalParamQ"}], "}"}]}]}], "]"}], ":=", 
  " ", 
  RowBox[{"masses", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "masses", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"MechanismDynamicalSystem", "::", "mass"}], "]"}], ";", " ", 
    "$Failed"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4321]:=",ExpressionUUID->"a850dc3b-621f-4bd6-aaee-873395b1bb45"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parseInitialConditions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "Automatic"}]}]}], "]"}], 
  ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"parsePositions", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], ",", " ", 
    RowBox[{"parseVelocities", "[", 
     RowBox[{"m", ",", " ", "None"}], "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"parseInitialConditions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"positions", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "Automatic"}]}], ",", 
      " ", 
      RowBox[{"velocities_", "?", "MatrixQ"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"parsePositions", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], ",", " ", 
    RowBox[{"parseVelocities", "[", 
     RowBox[{"m", ",", " ", "velocities"}], "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseInitialConditions", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", "$Failed"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parsePositions", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], ":=", 
  RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parsePositions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions_", "?", "MatrixQ"}]}], "]"}], ":=", 
  RowBox[{"positions", " ", "/;", " ", 
   RowBox[{"NumericCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parsePositions", "[", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}]}], "]"}], ":=", "$Failed"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseVelocities", "[", 
   RowBox[{"m_", ",", " ", "velocities_"}], "]"}], ":=", " ", 
  RowBox[{"velocities", " ", "/;", " ", 
   RowBox[{"NumericCoordinatesQ", "[", 
    RowBox[{"m", ",", " ", "velocities"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"parseVelocities", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", " ", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4331]:=",ExpressionUUID->"d0b96612-939a-4fb2-8f6e-a03a87c8f541"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDynamicalSystem", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"initialConditions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"time_Symbol", ",", " ", 
       RowBox[{"start_", "?", "NumericQ"}], ",", " ", 
       RowBox[{"end_", "?", "NumericQ"}]}], "}"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"MechanismEnergy", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Constraints", " ", "\[Rule]", " ", 
            RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], "]"}], " ", 
         "+", " ", 
         RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}]}], ",", "\n", 
       RowBox[{"parsedInitialConditions", " ", "=", " ", 
        RowBox[{"parseInitialConditions", "[", 
         RowBox[{"m", ",", " ", "initialConditions"}], "]"}]}], ",", "\n", 
       RowBox[{"drags", " ", "=", " ", 
        RowBox[{"expandDynamicalDrags", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "VertexDrag", "]"}]}], "]"}]}], ",", 
       "\n", 
       RowBox[{"masses", " ", "=", " ", 
        RowBox[{"expandDynamicalMasses", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "VertexMass", "]"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"MechanismDynamicalSystemInternal", "[", 
           RowBox[{
           "m", ",", " ", "masses", ",", " ", "drags", ",", " ", 
            "parsedInitialConditions", ",", " ", "energy", ",", " ", 
            RowBox[{"{", 
             RowBox[{"time", ",", " ", "start", ",", " ", "end"}], "}"}], ",",
             " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", " ", 
              RowBox[{"Options", "[", "NDSolve", "]"}]}], "]"}]}], " ", 
           "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"drags", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"masses", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"parsedInitialConditions", " ", "=!=", " ", "$Failed"}]}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismDynamicalSystem", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_", ",", "_"}], "}"}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismDynamicalSystem", "::", "timespec"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismDynamicalSystem", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismDynamicalSystem", "::", "timespec"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4339]:=",ExpressionUUID->"d9dde884-5ff3-466a-b915-739df74cc11a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismDynamicalSystemEquationsInternal", "[", 
   RowBox[{
   "m_", ",", " ", "initialPositions_", ",", " ", "v_", ",", " ", 
    "timeVariable_", ",", " ", "masses_", ",", " ", "drags_", ",", " ", 
    "energy_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pinnedVertices", " ", "=", " ", 
       RowBox[{"Dispatch", "[", " ", 
        RowBox[{"solveLinearEquations", "[", 
         RowBox[{
          RowBox[{"MechanismConstraintEquations", "[", 
           RowBox[{"m", ",", "initialPositions", ",", "Infinity", ",", 
            RowBox[{"ConstraintOutput", "\[Rule]", "VertexPosition"}]}], 
           "]"}], ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}], 
        " ", "]"}]}], ",", " ", "\n", "variables", ",", " ", "gradient", ",", 
      " ", "equationSystem", ",", " ", "i", ",", " ", "j", ",", " ", "t"}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"variables", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
        "pinnedVertices"}], " ", "/.", " ", 
       RowBox[{
        RowBox[{"VertexPosition", "[", 
         RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"i", ",", " ", "j"}], "]"}], "[", "t", "]"}]}]}]}], ";", 
     "\n", "\t", 
     RowBox[{"gradient", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", " ", 
         RowBox[{
          RowBox[{"D", "[", " ", 
           RowBox[{"energy", ",", " ", 
            RowBox[{"{", " ", 
             RowBox[{"Flatten", "[", " ", 
              RowBox[{"VertexPosition", "[", "m", "]"}], " ", "]"}], " ", 
             "}"}]}], "]"}], ",", " ", 
          RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], " ", 
         "]"}], " ", "/.", " ", "pinnedVertices"}], " ", "/.", " ", 
       RowBox[{
        RowBox[{"VertexPosition", "[", 
         RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"i", ",", " ", "j"}], "]"}], "[", "t", "]"}]}]}]}], ";", 
     "\n", "\t", "\n", "\t", 
     RowBox[{"equationSystem", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"masses", " ", "===", " ", "None"}], ",", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", " ", 
             RowBox[{"Dimensions", "[", "initialPositions", "]"}]}], " ", 
            "]"}], ",", " ", 
           RowBox[{
            RowBox[{"DiagonalMatrix", "[", " ", "masses", " ", "]"}], " ", 
            ".", " ", 
            RowBox[{"D", "[", " ", 
             RowBox[{"variables", ",", " ", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", "2"}], "}"}]}], " ", "]"}]}]}], " ", 
          "]"}], " ", "\n", "\t\t\t", "+", " ", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", " ", "drags", " ", "]"}], " ", ".", 
          " ", 
          RowBox[{"D", "[", " ", 
           RowBox[{"variables", ",", " ", 
            RowBox[{"{", 
             RowBox[{"t", ",", " ", "1"}], "}"}]}], " ", "]"}]}], " ", "+", 
         " ", "gradient"}], "\n", "\t", "]"}], " ", "/.", " ", 
       RowBox[{"t", "\[Rule]", "timeVariable"}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "we", " ", "need", " ", "to", " ", "explicitly", " ", "eliminate", " ", 
       "the", " ", "equations", " ", "that", " ", "are", " ", "predetermined",
        " ", "by", " ", "the", " ", "pinned", " ", "vertices", " ", "or", " ",
        "there", " ", "will", " ", "be", " ", "too", " ", "many", " ", 
       "equations"}], "*)"}], "\n", "\t", 
     RowBox[{"Pick", "[", " ", 
      RowBox[{"equationSystem", ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{"NumericQ", "[", "#", "]"}], " ", "]"}], "&"}], " ", "/@", 
        " ", 
        RowBox[{"Flatten", "[", "variables", "]"}]}]}], " ", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4342]:=",ExpressionUUID->"78b2f67f-dc48-44fe-9713-fc2cd8b3ffff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismDynamicalSystemInternal", "[", 
   RowBox[{"m_", ",", " ", "masses_", ",", " ", "drags_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"initialPositions_", ",", " ", "initialVelocities_"}], "}"}], 
    ",", " ", "energy_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"timeVariable_", ",", " ", "start_", ",", " ", "end_"}], "}"}], 
    ",", " ", "opt_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "equations", ",", " ", "v", ",", " ", "variables", ",", " ", 
      "processedVariables", ",", " ", "solution", ",", " ", "i", ",", " ", 
      "j", ",", " ", "\n", 
      RowBox[{"pinnedVertices", " ", "=", " ", 
       RowBox[{"Dispatch", "[", " ", 
        RowBox[{"solveLinearEquations", "[", 
         RowBox[{
          RowBox[{"MechanismConstraintEquations", "[", 
           RowBox[{"m", ",", "initialPositions", ",", "Infinity", ",", 
            RowBox[{"ConstraintOutput", "\[Rule]", "VertexPosition"}]}], 
           "]"}], ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}], 
        " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"list", " ", "only", " ", "the", " ", "non"}], "-", 
      RowBox[{"pinned", " ", "variables"}]}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"variables", " ", "=", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
         "pinnedVertices"}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"VertexPosition", "[", 
          RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"i", ",", " ", "j"}], "]"}], "[", "timeVariable", 
          "]"}]}]}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"equations", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{"the", " ", "dynamical", " ", "system", " ", "equations"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"MechanismDynamicalSystemEquationsInternal", "[", 
          RowBox[{
          "m", ",", " ", "initialPositions", ",", " ", "v", ",", " ", 
           "timeVariable", ",", " ", "masses", ",", " ", "drags", ",", " ", 
           "energy"}], "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"initial", " ", "positions"}], "*)"}], "\n", "\t\t", 
         RowBox[{"Select", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"variables", " ", "/.", " ", 
               RowBox[{"timeVariable", "\[Rule]", "0"}]}], ")"}], " ", "-", 
             " ", 
             RowBox[{"Flatten", "[", "initialPositions", "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{
            RowBox[{"Not", "[", " ", 
             RowBox[{"NumericQ", "[", " ", "#", " ", "]"}], " ", "]"}], 
            "&"}]}], " ", "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"initial", " ", "velocities", " ", "if", " ", "needed"}], 
          "*)"}], "\n", "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"masses", " ", "===", " ", "None"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"Select", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", " ", 
                RowBox[{
                 RowBox[{"D", "[", " ", 
                  RowBox[{"variables", ",", " ", "timeVariable"}], " ", "]"}],
                  " ", "/.", " ", 
                 RowBox[{"timeVariable", "\[Rule]", "0"}]}], " ", ")"}], " ", 
               "-", " ", 
               RowBox[{"Flatten", "[", "initialVelocities", "]"}]}], ")"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"Not", "[", " ", 
               RowBox[{"NumericQ", "[", " ", "#", " ", "]"}], " ", "]"}], 
              "&"}]}], " ", "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "}"}],
        "]"}]}], ";", "\n", "\t", "\n", "\t", 
     RowBox[{"solution", " ", "=", " ", 
      RowBox[{"NDSolve", "[", " ", 
       RowBox[{
        RowBox[{"Thread", "[", " ", 
         RowBox[{"equations", " ", "\[Equal]", " ", "0"}], " ", "]"}], ",", 
        "  ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{"variables", ",", " ", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"NumericQ", "[", "#", "]"}], " ", "]"}], " ", "&"}]}], 
         " ", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"timeVariable", ",", " ", "start", ",", " ", "end"}], " ", 
         "}"}], ",", " ", "opt"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "did", " ", "NDSolve", " ", "return", " ", "a", " ", "list", " ", "of", 
       " ", 
       RowBox[{"rules", "?"}]}], "*)"}], "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MatchQ", "[", 
        RowBox[{"solution", ",", 
         RowBox[{"{", 
          RowBox[{"{", "__Rule", "}"}], "}"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
          "pinnedVertices"}], " ", "/.", " ", 
         RowBox[{
          RowBox[{"VertexPosition", "[", 
           RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
          
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"i", ",", " ", "j"}], "]"}], "[", "timeVariable", 
           "]"}]}]}], " ", "/.", " ", 
        RowBox[{"solution", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", "\n", "\t\t", "$Failed"}], 
      "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4343]:=",ExpressionUUID->"e09521af-e51f-454e-acee-9ae42f06aee1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismMonteCarloRun[]", "Subsection",ExpressionUUID->"70fa9bc8-0774-4c9e-b67f-9bd9be81f808"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismMonteCarloRun", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismConstraintEquations", "]"}], ",", 
      "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"\"\<energy\>\"", "\[Rule]", "Automatic"}], ",", " ", 
        RowBox[{"InitialPositions", "\[Rule]", "Automatic"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"beta_", "?", "temperatureQ"}], ",", " ", 
     RowBox[{"steps_", "?", "stepsQ"}], " ", ",", " ", 
     RowBox[{"distribution_", "?", "distributionQ"}], ",", " ", 
     RowBox[{"options", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"constraintData", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "\[Rule]", " ", "0"}], 
             ")"}], "&"}], " ", "/@", " ", 
           RowBox[{
            RowBox[{"processConstraintEquations", "[", "\n", "\t\t", 
             RowBox[{
              RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t\t", 
              RowBox[{"MechanismConstraintEquations", "[", " ", 
               RowBox[{"m", ",", " ", 
                RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
                "Infinity", ",", " ", 
                RowBox[{"Flatten", " ", "@", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                   "ConstraintOutput", " ", "\[Rule]", " ", 
                    "VertexPosition"}], ",", " ", 
                   RowBox[{"FilterRules", "[", 
                    RowBox[{
                    RowBox[{"{", "options", "}"}], ",", " ", 
                    RowBox[{
                    "Options", "[", "MechanismConstraintEquations", "]"}]}], 
                    " ", "]"}]}], " ", "}"}]}]}], " ", "]"}]}], "\n", "\t", 
             "]"}], "[", "\"\<linear solutions\>\"", "]"}]}], ")"}], " ", "/.",
          " ", 
         RowBox[{"PositionRules", "[", " ", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "+", " ", 
           RowBox[{"VertexDisplacement", "[", "m", "]"}]}], "]"}]}]}], ",", 
       "\n", "\t", 
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{"getEnergy", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "\"\<energy\>\"", "]"}]}], "]"}]}], ",",
        "\n", "\t", "firstEnergy", ",", "\n", "\t", 
       RowBox[{"firstPositions", " ", "=", " ", 
        RowBox[{"processInitialPositions", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "InitialPositions", "]"}]}], "]"}]}], 
       ",", "\n", "\t", "results"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"firstEnergy", " ", "=", " ", 
       RowBox[{"evaluateEnergy", "[", " ", 
        RowBox[{"firstPositions", ",", " ", "energy"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"results", " ", "=", " ", 
       RowBox[{"Transpose", " ", "@", " ", 
        RowBox[{"NestList", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"monteCarloStep", "[", " ", 
            RowBox[{
            "energy", ",", " ", "#", ",", " ", "beta", ",", " ", 
             "distribution", ",", " ", "constraintData"}], " ", "]"}], "&"}], 
          ",", " ", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"1", ",", " ", "firstEnergy", ",", " ", "firstPositions"}],
            "}"}], ",", " ", "\n", "\t\t", "steps"}], "\n", "\t", "]"}]}]}], 
      ";", "\n", "\t", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"N", "@", 
          RowBox[{"Total", "[", 
           RowBox[{"results", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "/", 
         RowBox[{"Length", "[", 
          RowBox[{"results", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"results", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"results", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], " ", "}"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"getEnergy", "[", " ", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], " ", ":=", " ", 
  RowBox[{"MechanismEnergy", "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"getEnergy", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], " ", ":=", 
  " ", "energy"}], "\n", 
 RowBox[{
  RowBox[{"getEnergy", "[", " ", 
   RowBox[{"m_", ",", " ", "expression_"}], "]"}], ":=", " ", 
  RowBox[{"expression", " ", "/;", " ", 
   RowBox[{"analyticEnergyQ", "[", 
    RowBox[{"expression", ",", " ", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getEnergy", "[", " ", 
    RowBox[{"m_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismMonteCarloRun", "::", "energy"}], "]"}], ";", "\n", 
     "\t", 
     RowBox[{"MechanismEnergy", "[", "m", "]"}]}], "\n", ")"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"processInitialPositions", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], ":=", 
  RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"processInitialPositions", "[", 
   RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"pos", " ", "/;", " ", 
   RowBox[{"NumericCoordinatesQ", "[", 
    RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"processInitialPositions", "[", 
    RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismMonteCarloRun", "::", "pos"}], "]"}], ";", "  ", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"temperatureQ", "[", " ", 
   RowBox[{"beta_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"temperatureQ", "[", " ", 
   RowBox[{"beta_", "?", "NumericQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"MechanismMonteCarloRun", "::", "neg"}], "]"}], ";", " ", 
    "False"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"temperatureQ", "[", " ", "beta_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismMonteCarloRun", "::", "num"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"stepsQ", "[", " ", 
   RowBox[{"steps_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", " ", ">", " ", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepsQ", "[", " ", "steps_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismMonteCarloRun", "::", "steps"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"distributionQ", "[", " ", 
   RowBox[{"distribution_", "?", "DistributionParameterQ"}], " ", "]"}], " ", 
  ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"distributionQ", "[", " ", "distribution_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismMonteCarloRun", "::", "distr"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "energy"}], "=", 
   "\"\<Option \\\"energy\\\" should be an analytical energy, a compiled \
energy, or Automatic.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "neg"}], "=", 
   "\"\<Inverse temperature should be positive.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "pos"}], "=", 
   "\"\<Initial positions are not compatible with Mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "num"}], "=", 
   "\"\<Inverse temperature should be numerical and positive.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "steps"}], "=", 
   "\"\<Third argument should be a positive integer indicated the number of \
steps to take.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMonteCarloRun", "::", "distr"}], "=", 
   "\"\<Fourth argument should be a valid probability distribution.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4344]:=",ExpressionUUID->"0b3e82e1-9782-44ba-a8ab-6a1e680d3561"],

Cell[BoxData[
 RowBox[{
  RowBox[{"monteCarloStep", "[", " ", 
   RowBox[{"energy_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", " ", "oldEnergy_", ",", " ", "oldPositions_"}], "}"}], 
    " ", ",", " ", "beta_", ",", " ", "distribution_", ",", " ", "rules_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"newPositions", " ", "=", " ", 
       RowBox[{"RandomPositions", "[", " ", 
        RowBox[{"oldPositions", ",", " ", 
         RowBox[{
         "\"\<distribution\>\"", " ", "\[Rule]", " ", "distribution"}], ",", 
         " ", 
         RowBox[{"\"\<rules\>\"", " ", "\[Rule]", " ", "rules"}]}], " ", 
        "]"}]}], ",", "\n", "\t", "newEnergy"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newEnergy", " ", "=", " ", 
      RowBox[{"evaluateEnergy", "[", 
       RowBox[{"newPositions", ",", " ", "energy"}], "]"}]}], ";", "\n", "\t",
      "\n", "\t", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{"newEnergy", " ", "\[LessEqual]", " ", "oldEnergy"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "newEnergy", ",", " ", "newPositions"}], "}"}],
        ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{
        RowBox[{"RandomReal", "[", "]"}], "<", 
        RowBox[{"Exp", "[", 
         RowBox[{"beta", " ", 
          RowBox[{"(", 
           RowBox[{"oldEnergy", "-", "newEnergy"}], ")"}]}], " ", "]"}]}], 
       ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", " ", "newEnergy", ",", " ", "newPositions"}], "}"}],
        ",", "\[IndentingNewLine]", "\t\t", "True", ",", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", " ", "oldEnergy", ",", "oldPositions"}], "}"}]}], 
      "\[IndentingNewLine]", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4366]:=",ExpressionUUID->"908b3a1d-a33f-4549-ac93-a0bb0355f103"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global rigidity", "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],

Cell[CellGroupData[{

Cell["MechanismIsometricTrajectory[]", "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],

Cell[TextData[{
 StyleBox["To do",
  FontSlant->"Italic"],
 ": a way to decide if we should terminate a run, fix \
\[OpenCurlyDoubleQuote]RandomWalk\[CloseCurlyDoubleQuote] to take proper \
options"
}], "Text",ExpressionUUID->"4a653e1c-eeb8-4064-b854-41501624a19e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", " ", "MechanismIsometricTrajectory", " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"InitialPositions", " ", "\[Rule]", " ", "Automatic"}], ",", 
     "\n", "\t", 
     RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", " ", 
     RowBox[{"EliminationRules", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", "\n", "\t", 
     RowBox[{"Method", " ", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{"\"\<Minimization\>\"", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "4"}]}]}], "}"}]}], ",", "\n", "\t", 
     RowBox[{"Tolerance", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "8"}], ")"}]}]}], ",", "\n", "\t", 
     RowBox[{"StepSize", " ", "\[Rule]", " ", "0.1"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4367]:=",ExpressionUUID->"0667504c-8c02-4916-b24b-3bb7bdc2cf26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "direction_", ",", " ", 
     RowBox[{"steps_", "?", "stepsQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "InitialPositions", "]"}], "===", 
          "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "InitialPositions", "]"}]}], "]"}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"MechanismIsometricTrajectoryInternal", "[", 
           RowBox[{
           "m", ",", " ", "initialPositions", ",", " ", "direction", ",", " ",
             "\n", "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"steps", ",", " ", 
              RowBox[{"OptionValue", "[", "StepSize", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "}"}], ",", 
            " ", "\n", "\t\t\t", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"{", "opt", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{
          RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
          "MechanismIsometricTrajectoryInternal"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{"And", "[", " ", 
       RowBox[{
        RowBox[{"positionsQ", "[", 
         RowBox[{"m", ",", " ", "initialPositions"}], "]"}], " ", ",", " ", 
        RowBox[{"displacementsQ", "[", 
         RowBox[{"m", ",", " ", "direction"}], "]"}], " ", ",", " ", 
        RowBox[{"toleranceQ", "[", " ", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}]}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"stepsQ", "[", " ", 
   RowBox[{"steps_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepsQ", "[", " ", "steps_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismIsometricTrajectory", "::", "steps"}], "]"}], ";", 
     " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"toleranceQ", "[", " ", 
   RowBox[{"tol_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", "\[GreaterEqual]", "0"}]}], "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toleranceQ", "[", " ", "tol_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismIsometricTrajectory", "::", "tol"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"positionsQ", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismIsometricTrajectory", "::", "pos"}], ",", 
       "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementsQ", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismIsometricTrajectory", "::", "disp"}], ",", 
        "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "steps"}], "=", 
   "\"\<Number of steps is not a positive integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance should be a positive real number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "stepsize"}], " ", "=", " ", 
   "\"\<Stepsize should be a function of positions or a positive real number.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "pos"}], " ", "=", " ", 
   "\"\<Initial positions `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "disp"}], " ", "=", " ", 
   "\"\<Initial displacements `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4368]:=",ExpressionUUID->"c18d8317-ae43-4b7f-9da1-c3475f665d7f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismIsometricTrajectoryInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "initialPositions_", ",", " ", "direction_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"steps_", ",", " ", "stepsize_", ",", " ", "tolerance_"}], "}"}],
     ",", " ", 
    RowBox[{"{", 
     RowBox[{"method_", " ", ",", " ", "methodSpec___"}], "}"}], " ", ",", 
    " ", "options_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"minimizationOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", " ", 
        RowBox[{
         RowBox[{"{", "methodSpec", "}"}], ",", " ", 
         RowBox[{"Options", "[", "FindMinimum", "]"}]}], " ", "]"}]}], ",", 
      "\n", "\t", 
      RowBox[{"nullspaceOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", " ", 
        RowBox[{
         RowBox[{"{", "methodSpec", "}"}], ",", " ", 
         RowBox[{"Options", "[", "NullSpace", "]"}]}], " ", "]"}]}], ",", 
      "\n", "\n", "\t", 
      RowBox[{"normalizedDirection", " ", "=", " ", 
       RowBox[{"direction", "/", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "direction", "]"}], " ", ".", " ", 
          RowBox[{"Flatten", "[", "direction", "]"}]}], " ", "]"}]}]}], ",", 
      "\n", "\t", "\n", "\t", 
      RowBox[{"MechanismConstraintMatrixFunc", " ", "=", " ", 
       RowBox[{"MechanismConstraintMatrixFunction", "[", " ", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"options", ",", " ", 
           RowBox[{
           "Options", "[", "MechanismConstraintMatrixFunction", "]"}]}], " ", 
          "]"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"energyFunc", " ", "=", " ", 
       RowBox[{"MechanismEnergy", "[", 
        RowBox[{"m", " ", ",", " ", "initialPositions", " ", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], " ", "]"}]}], 
        " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteCases", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"FoldList", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"method", ",", " ", "stepsize", ",", " ", "tolerance"}], 
             "}"}], ",", " ", "m", ",", " ", "#1", ",", " ", "#2", ",", " ", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"Quiet", "[", 
               RowBox[{"MechanismConstraintMatrixFunc", " ", "@@", " ", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"#1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], " ", ",", 
              " ", "nullspaceOptions"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"energyFunc", " ", ",", " ", "minimizationOptions"}], 
             "}"}]}], " ", "]"}], " ", "&"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"initialPositions", ",", "normalizedDirection"}], "}"}], 
         ",", "\n", "\t\t\t", 
         RowBox[{"Range", "[", "steps", "]"}]}], "\n", "\t\t", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t", 
      "$Failed"}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4380]:=",ExpressionUUID->"f0a82410-c535-47a8-948b-b21f94c95228"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
   RowBox[{"_", ",", "_", ",", 
    RowBox[{"{", 
     RowBox[{"$Failed", ",", " ", "_"}], "}"}], ",", "_", ",", "_"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"$Failed", ",", " ", "$Failed"}], "}"}]}]], "Code",
 CellLabel->
  "In[4381]:=",ExpressionUUID->"431662f0-2ecf-4999-bdfc-bca5f77db73b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<Euler\>\"", ",", " ", "stepsize_", ",", "tolerance_"}], 
      "}"}], ",", "m_", ",", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", " ", "n_", 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"constraintEnergy_", ",", " ", "minimizationOptions_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"newDirection", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", 
        RowBox[{
        "positions", ",", " ", "lastDirection", ",", " ", "constraintMat", 
         ",", " ", "nullspaceOptions"}], " ", "]"}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"computeTrialPosition", "[", " ", 
        RowBox[{
        "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", " ",
          "n"}], " ", "]"}], ",", "\n", "\t\t", "newDirection"}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<RungaKutta\>\"", ",", " ", "stepsize_", ",", "tolerance_"}], "}"}],
      ",", "m_", ",", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", " ", "n_", 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"constraintEnergy_", ",", " ", "minimizationOptions_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "k1", ",", " ", "k2", ",", " ", "k3", ",", " ", "k4", ",", " ", "k5", 
       ",", " ", "trialPosition"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"k1", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", " ", 
        RowBox[{
        "positions", " ", ",", " ", "lastDirection", ",", " ", 
         "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"k2", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", " ", 
        RowBox[{
         RowBox[{"positions", " ", "+", " ", 
          RowBox[{"stepsize", " ", 
           RowBox[{"k1", "/", "2"}]}]}], ",", " ", "lastDirection", ",", " ", 
         "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"k3", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", " ", 
        RowBox[{
         RowBox[{"positions", " ", "+", " ", 
          RowBox[{"stepsize", " ", 
           RowBox[{"k2", "/", "2"}]}]}], ",", " ", "lastDirection", ",", " ", 
         "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"k4", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", " ", 
        RowBox[{
         RowBox[{"positions", " ", "+", " ", 
          RowBox[{"stepsize", " ", "k3"}]}], ",", " ", "lastDirection", ",", 
         " ", "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"k5", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k1", "+", 
          RowBox[{"2", " ", "k2"}], " ", "+", " ", 
          RowBox[{"2", " ", "k3"}], "+", "k4"}], ")"}], "/", "6"}]}], ";", 
      "\n", "\t", 
      RowBox[{"trialPosition", " ", "=", " ", 
       RowBox[{"positions", " ", "+", " ", 
        RowBox[{"stepsize", " ", "k5"}]}]}], ";", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"evaluateEnergy", "[", 
            RowBox[{
            "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy"}], 
            "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
          RowBox[{"correctTrialPosition", "[", 
           RowBox[{
           "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",", 
            " ", "minimizationOptions"}], "]"}], ",", "\n", "\t\t\t", 
          "trialPosition"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"k5", "/", 
         RowBox[{"Norm", "[", 
          RowBox[{"Flatten", "[", "k5", "]"}], "]"}]}]}], "\n", "\t", 
       "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<Minimization\>\"", ",", " ", "stepsize_", ",", " ", "tolerance_"}],
       "}"}], " ", ",", " ", "m_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", " ", "lastDirection_"}], "}"}], ",", " ", 
     "n_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"constraintEnergy_", ",", " ", "minimizationOptions_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"newDirection", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", " ", 
         RowBox[{
         "positions", ",", " ", "lastDirection", ",", " ", "constraintMat", 
          ",", " ", "nullspaceOptions"}], " ", "]"}]}], ",", "\n", "\t", 
       "trialPosition"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"trialPosition", " ", "=", " ", 
       RowBox[{"computeTrialPosition", "[", " ", 
        RowBox[{
        "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", " ",
          "n"}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"evaluateEnergy", "[", 
            RowBox[{
            "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy"}], 
            "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
          RowBox[{"correctTrialPosition", "[", 
           RowBox[{
           "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",", 
            " ", "minimizationOptions"}], "]"}], ",", "\n", "\t\t\t", 
          "trialPosition"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        "newDirection"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismIsometricTrajectoryStep", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "\"\<RandomWalk\>\"", ",", " ", "stepsize_", ",", " ", "tolerance_"}], 
     "}"}], " ", ",", " ", "m_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"positions_", ",", " ", "lastDirection_"}], "}"}], ",", " ", 
    "n_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
    " ", 
    RowBox[{"{", 
     RowBox[{"constraintEnergy_", ",", " ", "minimizationOptions_"}], "}"}]}],
    " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"newDirection", " ", "=", " ", 
       RowBox[{"projectTrialDirection", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"RandomPositions", "[", 
          RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "constraintMat", 
         ",", " ", "nullspaceOptions"}], " ", "]"}]}], ",", "\n", "\t", 
      "trialPosition"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"trialPosition", " ", "=", " ", 
      RowBox[{"computeTrialPosition", "[", " ", 
       RowBox[{
       "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", " ", 
        "n"}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"evaluateEnergy", "[", 
           RowBox[{
           "m", ",", " ", "newDirection", ",", " ", "constraintEnergy"}], 
           "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
         RowBox[{"correctTrialPosition", "[", 
          RowBox[{
          "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",", 
           " ", "minimizationOptions"}], "]"}], ",", "\n", "\t\t\t", 
         "trialPosition"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
       "newDirection"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4382]:=",ExpressionUUID->"d4e68e5a-9602-4a4a-b440-17bbf19734d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "returns", " ", "a", " ", "normalized", " ", "displacement", " ", 
    "tangent", " ", "to", " ", "the", " ", "configuration", " ", "space", " ",
     "and", " ", "as", " ", "close", " ", "to", " ", "trialDirection", " ", 
    "as", " ", "possible"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"projectTrialDirection", "[", " ", 
     RowBox[{
     "positions_", " ", ",", " ", "trialDirection_", ",", " ", 
      "constraintMat_", " ", ",", " ", "nullspaceOptions_"}], " ", "]"}], " ",
     ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"nullspaceBasis", " ", "=", " ", 
        RowBox[{"Orthogonalize", "[", " ", 
         RowBox[{"NullSpace", "[", 
          RowBox[{"constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}],
          " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "nullspaceBasis", "]"}], " ", ">", " ", "0"}],
         ",", "\n", "\t\t", 
        RowBox[{"ArrayReshape", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", "nullspaceBasis", "]"}], " ", ".", " ", 
            "nullspaceBasis", " ", ".", " ", 
            RowBox[{"Flatten", "[", "trialDirection", "]"}]}], "]"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{"Dimensions", "[", "positions", "]"}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MechanismIsometricTrajectory", "::", "dirns"}], " ", ",", 
           " ", "positions"}], "]"}], ";", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}]}], 
       "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismIsometricTrajectory", "::", "dirns"}], "=", 
     "\"\<Cannot identify tangent space at `1`.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "In[4386]:=",ExpressionUUID->"d0c74681-d7be-4943-bdb3-e78c2132a41c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "find", " ", "a", " ", "new", " ", "set", " ", "of", " ", "positions", " ",
     "from", " ", "a", " ", "trial", " ", "step"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"computeTrialPosition", "[", " ", 
     RowBox[{"positions_", " ", ",", " ", "trialStep_", " ", ",", " ", 
      RowBox[{"stepsize_", "?", "NumericQ"}], ",", " ", "n_"}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"stepsize", " ", "\[GreaterEqual]", " ", "0"}], ",", "\n", 
      "\t\t\t", 
      RowBox[{"positions", " ", "+", " ", 
       RowBox[{"stepsize", " ", "trialStep"}]}], ",", "\n", "\n", "\t\t\t", 
      RowBox[{
       RowBox[{"Message", "[", " ", 
        RowBox[{"MechanismIsometricTrajectory", "::", "stepsize"}], " ", 
        "]"}], ";", "\n", "\t\t\t", "$Failed"}]}], "\n", "\t\t", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"computeTrialPosition", "[", " ", 
     RowBox[{
     "positions_", " ", ",", " ", "trialStep_", " ", ",", " ", "stepsize_", 
      ",", " ", "n_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"actualSize", " ", "=", " ", 
        RowBox[{"stepsize", "[", 
         RowBox[{"positions", ",", "n"}], "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", " ", "actualSize", " ", "]"}], " ", "&&", 
         " ", 
         RowBox[{"actualSize", " ", "\[GreaterEqual]", " ", "0"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"positions", " ", "+", " ", 
         RowBox[{"actualSize", " ", "trialStep"}]}], ",", "\n", "\n", "\t\t", 
        
        RowBox[{
         RowBox[{"Message", "[", " ", 
          RowBox[{"MechanismIsometricTrajectory", "::", "stepsize"}], " ", 
          "]"}], ";", "\n", "\t\t", "$Failed"}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4388]:=",ExpressionUUID->"486130dd-c91f-4635-9d83-1f3bd0aa6d73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"correctTrialPosition", "[", " ", 
   RowBox[{
   "m_", ",", " ", "trialPosition_", " ", ",", " ", "constraintEnergy_", ",", 
    " ", "minimizationOptions_"}], " ", "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"MinimizemechanismEnergyInternal", "[", 
    RowBox[{
    "m", ",", " ", "constraintEnergy", ",", " ", "trialPosition", ",", " ", 
     "minimizationOptions"}], "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]], "Code",
 CellLabel->
  "In[4390]:=",ExpressionUUID->"2ef881ff-eeb2-4d0c-9acd-87ee573cc4ed"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismFindMinimalTrajectory[]", "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismFindMinimalTrajectory", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"AddedEnergy", "->", "0"}], ",", "\n", "\t", 
     RowBox[{"Constraints", "\[Rule]", "None"}], ",", "\n", "\t", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
        RowBox[{"MaxIterations", "\[Rule]", 
         RowBox[{"10", "^", "5"}]}], ",", " ", 
        RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}]}], "}"}]}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4391]:=",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "[", "\"\<Methods\>\"", "]"}], 
    "=", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<Stiffness\>\"", "\[Rule]", 
           RowBox[{"10", "^", 
            RowBox[{"(", 
             RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
         "\"\<Options[FindMinimum]\>\""}], "]"}]}], "}"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "start_", ",", " ", "end_", 
     ",", " ", "steps_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"method", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}]}], ",", 
       " ", "res"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"First", "[", "method", "]"}], ",", "\n", "\t\t", 
         "\"\<ElasticBand\>\"", ",", "\n", "\t\t\t", 
         RowBox[{"MechanismFindMinimalTrajectoryElasticBand", "[", 
          RowBox[{
          "m", ",", " ", "start", ",", " ", "end", ",", " ", "steps", ",", 
           " ", 
           RowBox[{
            RowBox[{"MechanismEnergy", "[", 
             RowBox[{"m", ",", " ", 
              RowBox[{"Constraints", "->", 
               RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], "]"}], 
            "+", 
            RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], ",", " ", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"Rest", "[", "method", "]"}]}]}], " ", "]"}], ",", "\n", 
         "\t\t", "_", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismFindMinimalTrajectory", "::", "meth"}], "]"}], 
          ";", "\n", "\t\t\t", "$Failed"}]}], "\n", "\t", "]"}]}], ";", "\n", 
      "\t", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "method"}], "=", 
   "\"\<`1` is not a recognized method. Only \\\"ElasticBand\\\" is currently \
recognized.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4392]:=",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstiff"}], "=", 
   "\"\<Stiffness in \\\"ElasticBand\\\" method must be a positive numerical \
value.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstart"}], "=", 
   "\"\<Start positions are not numeric coordinates corresponding to \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebend"}], "=", 
   "\"\<End positions are not numeric coordinates corresponding to Mechanism.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "::", "steps"}], "=", 
    "\"\<Number of steps should be a positive integer.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "MechanismFindMinimalTrajectoryElasticBand", "]"}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
    "Options", "[", "MechanismFindMinimalTrajectoryElasticBand", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Stiffness\>\"", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
      RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFindMinimalTrajectoryElasticBand", "[", 
   RowBox[{
   "m_", ",", " ", "startPositions_", ",", "endPositions_", ",", " ", 
    "steps_", ",", " ", "energy_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Stiffness\>\"", "]"}]}], ",", "\n", 
      RowBox[{"fixedVertices", " ", "=", " ", 
       RowBox[{"solveLinearEquations", "[", 
        RowBox[{
         RowBox[{"MechanismConstraintEquations", "[", 
          RowBox[{"m", ",", "startPositions", ",", "Infinity", ",", 
           RowBox[{"\"\<output\>\"", "\[Rule]", "VertexPosition"}]}], "]"}], 
         ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}]}], 
      ",", " ", "\n", "variable", ",", " ", "internalVariables", ",", " ", 
      "partialEnergy", ",", " ", "newVariables", ",", " ", "potentialEnergy", 
      ",", " ", "initialConditions", ",", "\n", 
      RowBox[{"minimizationOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", 
         RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", " ", 
      "solution"}], "\n", "}"}], ",", "\n", "\n", "\t", 
    RowBox[{
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"NumericQ", "[", "stiffness", "]"}], " ", "&&", " ", 
         RowBox[{"stiffness", " ", ">", " ", "0"}]}], " ", "]"}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstiff"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"NumericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "startPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstart"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"NumericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "endPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebend"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "steps", "]"}], " ", "&&", " ", 
         RowBox[{"steps", ">", "0"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "steps"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\n", "\t", "]"}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"internalVariables", "=", " ", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PositionRules", "[", "startPositions", "]"}], "}"}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], "&"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", "#"}], 
               "}"}], ",", " ", "2"}], "]"}], ",", "2"}], "]"}], "&"}], " ", "/@",
          " ", 
         RowBox[{"Array", "[", 
          RowBox[{"variable", ",", " ", 
           RowBox[{"{", 
            RowBox[{"steps", ",", " ", 
             RowBox[{"MeshCellCount", "[", 
              RowBox[{"m", ",", "0"}], "]"}], ",", 
             RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
            "}"}]}], "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"PositionRules", "[", "endPositions", "]"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"newVariables", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
         "fixedVertices"}], "]"}], " ", "/.", " ", "internalVariables"}]}], 
     ";", "\n", "\n", "\t", 
     RowBox[{"partialEnergy", " ", "=", " ", 
      RowBox[{"energy", " ", "/.", " ", "fixedVertices"}]}], ";", "\n", "\n", 
     "\t", 
     RowBox[{"potentialEnergy", " ", "=", " ", 
      RowBox[{"Total", " ", "@", " ", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"{", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{"local", " ", "equations"}], "*)"}], "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"partialEnergy", " ", "/.", " ", "#"}], " ", "&"}], 
            ")"}], " ", "/@", " ", "internalVariables"}], ",", "\n", "\n", 
          "\t", 
          RowBox[{"(*", 
           RowBox[{"elastic", " ", "band", " ", "equations"}], "*)"}], "\n", 
          "\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"stiffness", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], " ", ".", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "&"}], ")"}], 
           " ", "/@", " ", 
           RowBox[{"Partition", "[", 
            RowBox[{"newVariables", ",", " ", "2", ",", " ", "1"}], "]"}]}]}],
          "\n", "\t", "}"}]}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"initialConditions", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Transpose", " ", "@", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"Drop", "[", " ", 
             RowBox[{
              RowBox[{"Rest", " ", "@", " ", "newVariables"}], ",", " ", 
              RowBox[{"-", "1"}]}], "]"}], " ", "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"startPositions", " ", "+", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"endPositions", " ", "-", " ", "startPositions"}], 
                  ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"steps", "+", "1"}], ")"}]}], " ", "#"}]}], "&"}], 
             " ", "/@", " ", 
             RowBox[{"Range", "[", "steps", "]"}]}], " ", "]"}]}], "}"}]}], 
        ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ",", " ", "_"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"solution", " ", "=", " ", 
      RowBox[{"FindMinimum", " ", "@@", " ", 
       RowBox[{"{", 
        RowBox[{
        "potentialEnergy", ",", " ", "initialConditions", ",", " ", 
         "minimizationOptions"}], " ", "}"}]}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "solution", "]"}], " ", "=!=", " ", 
        "FindMinimum"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", ",", 
           RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], "]"}], 
         "&"}], " ", "/@", " ", 
        RowBox[{"(", 
         RowBox[{"newVariables", " ", "/.", " ", 
          RowBox[{"solution", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], ",", " ", "$Failed"}], 
      "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4395]:=",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Closed]],

Cell[CellGroupData[{

Cell["GenericGloballyRigidQ[]", "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "GenericGloballyRigidQ", "]"}], "=", 
    RowBox[{"Options", "[", "MechanismSelfStresses", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"GenericGloballyRigidQ", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
      RowBox[{"num", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"Or", " ", "@@", " ", 
     RowBox[{"(", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixRank", "[", 
           RowBox[{
            RowBox[{"MechanismStressMatrix", "[", 
             RowBox[{"m", ",", " ", "#"}], "]"}], ",", " ", 
            RowBox[{"Tolerance", " ", "\[Rule]", " ", 
             RowBox[{"OptionValue", "[", "Tolerance", "]"}]}]}], " ", "]"}], 
          " ", "\[Equal]", " ", 
          RowBox[{"num", " ", "-", " ", "dim", " ", "-", " ", "1"}]}], ")"}], 
        "&"}], " ", "/@", " ", 
       RowBox[{"MechanismSelfStresses", "[", 
        RowBox[{"m", ",", " ", "opt"}], "]"}]}], "\n", "\t", ")"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4402]:=",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[4404]:=",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms`origami: functions for Origami", "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`Origami`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[4406]:=",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiQ", "::", "usage"}], "=", 
   "\"\<OrigamiQ[ obj ] returns True if obj can be turned into \
Origami.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4407]:=",ExpressionUUID->"1b53aab2-8ab9-4869-815e-f8ca47d5626d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"KawasakiQ", "::", "usage"}], "=", "\n", 
   "\"\<KawasakiQ[\!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\)] \
returns True if it can be determined that the Origami satisfies Kawasaki's \
theorem at each vertex.\nUse option ZeroTest to modify how the function tests \
for zero. Use option WorkingPrecision to set a number of digits for the test.\
\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4408]:=",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "::", "usage"}], "=", 
   "\"\<TargetFoldAngles[m,(positions), (data)] returns an association \
containing a list of TorsionalFolds, their corresponding target angles, and \
their actual angles.\nOptional argument data is a string that is either \
\\\"TorsionalFolds\\\", \\\"angles\\\", \\\"target\\\".\>\""}], ";"}]], "Code",\

 CellLabel->
  "In[4409]:=",ExpressionUUID->"01f2dfa2-986a-4b95-b411-c600af854f43"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldMatrix", "::", "usage"}], "=", "\n", 
    "\"\<TorsionalFoldMatrix[\!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\
\)] returns the TorsionalFold matrix mapping linear vertex displacements to \
linear TorsionalFold angle changes.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AngularFoldMatrix", "::", "usage"}], "=", "\n", 
   "\"\<AngularFoldMatrix[\!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\),\
 (\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), ) \
\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\)] returns the angular \
TorsionalFold matrix of a vertex mapping the angular displacements of the \
TorsionalFolds from the xy plane to the TorsionalFold angle changes.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4410]:=",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToOrigami", "::", "usage"}], "=", "\n", 
    "\"\<ToOrigami[ \!\(\*StyleBox[\"object\",FontSlant->\"Italic\"]\) ] \
converts an object to an Origami Mechanism. Effectively, this only works for \
some MeshRegion[] or Linkage[] objects.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "::", "usage"}], "=", 
   "\"\<ElasticizeOrigami[ o ] attempts to create an elastic model of an \
Origami structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4412]:=",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SingleVertex", "::", "usage"}], "=", "\n", 
    "\"\<SingleVertex[ {\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 1, \
\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 2, ...} ] returns a single \
vertex Origami with angles as sector angles.\nSingleVertex[ \
{\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 1, \
\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 2, ...}, \
{\!\(\*StyleBox[\"length\",FontSlant->\"Italic\"]\) 1, ...} ] returns a \
single vertex Origami with angles as sector angles and TorsionalFold lengths \
given by the list of lengths.\nSingleVertex[ { pt1, pt2, ... } ] returns a \
single vertex Origami with vertex at origin and boundary at specified points \
in 2D or 3D.\n\nSee options \\\"angles\\\" and \\\"torsional stiffnesses\\\" \
to set the equilibrium angles and torsional stiffnesses.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomOrigami", "::", "usage"}], "=", "\n", 
    "\"\<RandomOrigami[ \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) ] \
returns random Origami with n internal vertices.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOri", "::", "usage"}], "=", "\n", 
   "\"\<MiuraOri[ {length1, length2}, \
\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) ] returns a Miura ori unit \
cell at a particular angle and Face lengths.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4414]:=",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "usage"}], "=", "\n", 
   "\"\<FlatOrigamiQ[ \!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\) ] \
returns True if the Origami Mechanism is flat.\nUse option ZeroTest to \
specify how to test for zero. Use option WorkingPrecision to choose the \
precision.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4417]:=",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"KreslingOrigami", "::", "usage"}], "=", "\n", 
   "\"\<KreslingOrigami[{\!\(\*StyleBox[\"#\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"azimuthal\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"cells\",FontSlant->\"Italic\"]\), \
#\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"of\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"rings\",FontSlant->\
\"Italic\"]\)(, \
\!\(\*StyleBox[\"twist\",FontSlant->\"Italic\"]\))},\!\(\*StyleBox[\"overall\"\
,FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"scale\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"height\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"ratio\",FontSlant->\"Italic\"]\)] \
creates a Kresling TorsionalFold pattern of a particular radius, height, and \
integer twist if specified.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4418]:=",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MVAssignment", "::", "usage"}], " ", "=", " ", 
    "\"\<MVAssignment[ o (, positions), tolerance_ (, assignmentFunction)] \
returns a list of rules assigning a value to mountain or valley \
TorsionalFolds up to the value of tolerance.\nThe function assignmentFunction \
should take one of the values {-1,0,1} for valley, flat, or mountain \
TorsionalFolds respectively.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "usage"}], " ", "=", " ", 
   "\"\<FlattenOrigami[m, tolerance] attempts to flatten an Origami \
structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4419]:=",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "::", "usage"}], "=", 
   "\"\<SameFoldAnglesQ[ Origami, (TorsionalFolds,) (precision) ] is a \
function that compares the positions of two Origami structures and returns \
True if they have the same TorsionalFold angles.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "::", "usage"}], "=", 
   "\"\<SameMVAnglesQ[ Origami, (TorsionalFolds,) (precision) ] is a function \
that compares the positions of two Origami structures and returns True if \
they have the same mountain-valley assignments.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4421]:=",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionQ", "::", "usage"}], " ", "=", " ", 
   "\"\<ButterflyDecompositionQ[ Origami ] returns True if Origami can be \
decomposed into pairs of \\\"butterfly\\\" Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecomposition", "::", "usage"}], " ", "=", " ", 
   "\"\<ButterflyDecomposition[ Origami ] returns a list of \\\"butterfly\\\" \
Face pairs and a non-butterfly-decomposible kernel after removing butterfly \
Faces. You can apply MechanismDeleteDanglingVertices[] to extract the \
underlying Origami structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4423]:=",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeconstructedOrigami", "::", "usage"}], "=", 
    "\"\<DeconstructedOrigami[ Origami ] returns a list of vertices for \
polygons corresponding to the individual Faces.\nOption \\\"edgeWeights\\\" \
allows the assignment of positive weights that allow some edges to have \
widths.\nOption \\\"defaultWeight\\\" is the default weight on all \
edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtrudedPolygon", "::", "usage"}], "=", 
   "\"\<ExtrudedPolygon[coords, extrusion vector, (translation vector)] takes \
a Polygon and creates a 3D version.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4425]:=",ExpressionUUID->"83f8a726-efe7-4110-956b-bca1ea384930"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiData", "::", "usage"}], "=", 
   "\"\<OrigamiData[ Origami ] returns an Assocation of data for various \
Origami structures. Use OrigamiData[] to see what is available.\>\""}], 
  ";"}]], "Code",
 CellLabel->
  "In[4427]:=",ExpressionUUID->"b00e700d-c96f-4280-83fe-545c8730966e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "::", "usage"}], "=", 
   "\"\<MVColor[ Origami, data, styleFunction] attempts to color data \
according to styles specified by styleFunction.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4428]:=",ExpressionUUID->"b96f0aa2-0ec5-4585-8f0e-6182e0b65a44"]
}, Closed]],

Cell[CellGroupData[{

Cell["global", "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[4429]:=",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Closed]],

Cell[CellGroupData[{

Cell["new Origami structures", "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],

Cell[CellGroupData[{

Cell["OrigamiQ[]", "Subsection",ExpressionUUID->"8042e1d7-58bf-4a7b-a670-9ef09527dcb3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"OrigamiQ", "[", " ", "mr_MeshRegion", " ", "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{"(*", 
    RowBox[{
    "there", " ", "should", " ", "be", " ", "at", " ", "least", " ", "one", 
     " ", "Face"}], "*)"}], "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"RegionDimension", "[", "mr", "]"}], " ", "\[Equal]", " ", "2"}],
     ",", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{"embedding", " ", "dimension"}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "\[Equal]", "2"}], "||", 
        RowBox[{"#", "\[Equal]", "3"}]}], "&"}], ")"}], " ", "@", " ", 
     RowBox[{"RegionEmbeddingDimension", "[", "mr", "]"}]}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"OrigamiQ", "[", " ", "f_Linkage", " ", "]"}], " ", ":=", " ", "\n",
   "\t", 
  RowBox[{"And", "[", "\n", "\t\t", 
   RowBox[{"(*", 
    RowBox[{
    "there", " ", "should", " ", "be", " ", "at", " ", "least", " ", "one", 
     " ", "Face"}], "*)"}], "\n", "\t\t", 
   RowBox[{
    RowBox[{
     RowBox[{"RegionDimension", "[", " ", 
      RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}], " ", "\[Equal]", 
     " ", "2"}], ",", "\n", "\t\t", 
    RowBox[{"(*", 
     RowBox[{"embedding", " ", "dimension"}], "*)"}], "\n", "\t\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "\[Equal]", "2"}], "||", 
        RowBox[{"#", "\[Equal]", "3"}]}], "&"}], ")"}], " ", "@", " ", 
     RowBox[{"f", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}], "\n", "\t", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"OrigamiQ", "[", " ", "o_Origami", " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
  "False"}]}], "Code",
 CellLabel->
  "In[4433]:=",ExpressionUUID->"5cbe27db-29f9-4589-9b2f-70c34eebdd51"]
}, Closed]],

Cell[CellGroupData[{

Cell["ToOrigami[]", "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "::", "notsurFace"}], "=", 
   "\"\<Input does not seem to be Origami compatible because it is not a \
valid surFace.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "::", "prec"}], "=", 
   "\"\<Precision must be valid number of digits.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4437]:=",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "ToOrigami", " ", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"Precision", " ", "\[Rule]", " ", "Automatic"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "[", 
    RowBox[{
     RowBox[{"mr_MeshRegion", "?", "OrigamiQ"}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"Origami", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "===", " ", 
         "Automatic"}], ",", "\n", "\t\t\t", 
        RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"N", "[", " ", 
         RowBox[{
          RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Precision", "]"}]}], " ", "]"}]}], 
       "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"MeshCells", "[", 
          RowBox[{"mr", ",", "2"}], "]"}], " ", "/.", " ", 
         RowBox[{"Polygon", "->", "Face"}]}], " ", "}"}], "]"}]}], "\n", "\t",
      "]"}], " ", "/;", " ", 
    RowBox[{"precisionQ", "[", 
     RowBox[{"OptionValue", "[", "Precision", "]"}], "]"}]}]}], "\n"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "[", 
    RowBox[{
     RowBox[{"f_Linkage", "?", "OrigamiQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"f", "[", "\"\<positions\>\"", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "===", " ", 
         "Automatic"}], ",", " ", 
        RowBox[{"Origami", "@@", "f"}], ",", " ", 
        RowBox[{"N", "[", " ", 
         RowBox[{
          RowBox[{"Origami", "@@", "f"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Precision", "]"}]}], " ", "]"}]}], " ",
        "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"precisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"precisionQ", "[", " ", "prec_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Which", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"prec", " ", "===", " ", "Automatic"}], ",", " ", "True", ",", 
    "\n", "\t", 
    RowBox[{"prec", " ", "===", " ", "MachinePrecision"}], ",", " ", "True", 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"NumericQ", "[", " ", "prec", " ", "]"}], " ", "&&", " ", 
     RowBox[{"prec", " ", ">", " ", "0"}]}], ",", " ", "True", ",", "\n", 
    "\t", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"ToOrigami", "::", "prec"}], " ", "]"}], ";", " ", "False"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4439]:=",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToOrigami", "[", "_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"ToOrigami", "::", "notsurFace"}], "]"}]}]}]], "Code",
 CellLabel->
  "In[4443]:=",ExpressionUUID->"e14ea647-8b7f-4eae-a125-7e43a795f52c"]
}, Closed]],

Cell[CellGroupData[{

Cell["SingleVertex[]", "Subsection",ExpressionUUID->"f78cb6e6-e17d-4401-b894-51df89a02adc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SingleVertex", "]"}], "=", 
   RowBox[{"Options", "[", "Origami", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[4444]:=",ExpressionUUID->"baf9e747-4ee8-4def-a102-84008b907460"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SingleVertexQ", "[", " ", 
   RowBox[{"angles_", ",", " ", "lengths_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"deficitAngle", " ", "=", " ", 
      RowBox[{
       RowBox[{"2", " ", "Pi"}], " ", "-", " ", 
       RowBox[{"Total", "[", "angles", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"And", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VectorQ", "[", " ", 
          RowBox[{"angles", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&", 
         " ", 
         RowBox[{"AllTrue", "[", " ", 
          RowBox[{"angles", ",", " ", 
           RowBox[{
            RowBox[{"#", ">", "0"}], " ", "&"}]}], " ", "]"}]}], ",", " ", 
        "True", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"SingleVertex", "::", "sa"}], "]"}], ";", " ", "False"}]}], 
       " ", "]"}], ",", "\n", "\t\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Chop", "[", "deficitAngle", "]"}], " ", "\[Equal]", " ", 
         "0"}], ",", " ", "True", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"SingleVertex", "::", "da"}], "]"}], ";", " ", "False"}]}], 
       " ", "]"}], ",", "\n", "\t\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VectorQ", "[", " ", 
          RowBox[{"lengths", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&", 
         " ", 
         RowBox[{"AllTrue", "[", " ", 
          RowBox[{"lengths", ",", " ", 
           RowBox[{
            RowBox[{"#", ">", "0"}], " ", "&"}]}], " ", "]"}]}], ",", " ", 
        "True", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"SingleVertex", "::", "sl"}], "]"}], ";", " ", "False"}]}], 
       "]"}], ",", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "angles", "]"}], " ", "\[Equal]", " ", 
         RowBox[{"Length", "[", "lengths", "]"}]}], " ", ",", " ", "True", 
        " ", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"SingleVertex", "::", "sl"}], "]"}], ";", " ", "False"}]}], 
       " ", "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertexQ", "[", " ", "angles_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"deficitAngle", " ", "=", " ", 
       RowBox[{
        RowBox[{"2", " ", "Pi"}], " ", "-", " ", 
        RowBox[{"Total", "[", "angles", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"And", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"VectorQ", "[", " ", 
           RowBox[{"angles", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&", 
          " ", 
          RowBox[{"AllTrue", "[", " ", 
           RowBox[{"angles", ",", " ", 
            RowBox[{
             RowBox[{"#", ">", "0"}], " ", "&"}]}], " ", "]"}]}], ",", " ", 
         "True", ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"SingleVertex", "::", "sa"}], "]"}], ";", " ", "False"}]}],
         " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Chop", "[", "deficitAngle", "]"}], " ", "\[Equal]", " ", 
          "0"}], ",", " ", "True", ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"SingleVertex", "::", "da"}], "]"}], ";", " ", "False"}]}],
         " ", "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "::", "sa"}], "=", 
   "\"\<Sector angles must be positive real numbers.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "::", "da"}], "=", 
   "\"\<Sum of sector angles must be 2 Pi.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "::", "sl"}], "=", 
   "\"\<Lengths must be positive real numbers.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "::", "n"}], "=", 
   "\"\<You must have the same number of sector angles and lengths.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4445]:=",ExpressionUUID->"3ada8627-442a-43cd-ad7d-0325bd932b0d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "[", " ", 
    RowBox[{
     RowBox[{"pts_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"num", " ", "=", " ", 
        RowBox[{"Length", "[", "pts", "]"}]}], ",", "\n", "\t", 
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"pts", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"Origami", "[", "\n", "\t\t", 
      RowBox[{"pts", ",", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"FreeJoint", "[", 
          RowBox[{"0", " ", "\[Rule]", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", " ", "dim"}], "]"}]}], "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"Face", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"num", "+", "1"}]}], "}"}], "&"}], " ", "/@", " ", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Range", "[", "num", "]"}], ",", "2", ",", "1", ",", 
             "1"}], "]"}]}], " ", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", 
       "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SingleVertex", "[", " ", 
    RowBox[{"sectorAngles_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"angles", " ", "=", " ", 
         RowBox[{
          RowBox[{"Accumulate", "[", "sectorAngles", "]"}], " ", "-", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"sectorAngles", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"Length", "[", "sectorAngles", "]"}]}], "]"}]}]}], ",", 
        "\n", "\t", 
        RowBox[{"num", " ", "=", " ", 
         RowBox[{"Length", "[", "sectorAngles", "]"}]}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Origami", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "#", "]"}], ",", 
             RowBox[{"Sin", "[", "#", "]"}]}], "}"}], "&"}], " ", ",", " ", 
          "angles"}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"FreeJoint", "[", 
           RowBox[{"0", "\[Rule]", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"Face", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", 
               RowBox[{"num", "+", "1"}]}], "}"}], "&"}], " ", "/@", " ", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Range", "[", "num", "]"}], ",", "2", ",", "1", ",", 
              "1"}], "]"}]}], " ", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", 
        "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"SingleVertexQ", "[", "sectorAngles", " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"SingleVertex", "[", " ", 
   RowBox[{"sectorAngles_", ",", " ", "lengths_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles", " ", "=", " ", 
        RowBox[{
         RowBox[{"Accumulate", "[", "sectorAngles", "]"}], " ", "-", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"sectorAngles", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"Length", "[", "sectorAngles", "]"}]}], "]"}]}]}], ",", 
       "\n", "\t", 
       RowBox[{"num", " ", "=", " ", 
        RowBox[{"Length", "[", "sectorAngles", "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Origami", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "#2", "]"}], ",", 
             RowBox[{"Sin", "[", "#2", "]"}]}], "}"}]}], "&"}], " ", ",", " ", 
         RowBox[{"{", 
          RowBox[{"lengths", ",", " ", "angles"}], "}"}]}], " ", "]"}], " ", 
       ",", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"FreeJoint", "[", 
          RowBox[{"0", " ", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"Face", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"num", "+", "1"}]}], "}"}], "&"}], " ", "/@", " ", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Range", "[", "num", "]"}], ",", "2", ",", "1", ",", 
             "1"}], "]"}]}], " ", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", 
       "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{"SingleVertexQ", "[", 
    RowBox[{"sectorAngles", " ", ",", " ", "lengths"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4451]:=",ExpressionUUID->"086f898d-2364-4076-b6fb-a0b39bc483dd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MiuraOri[]", "Subsection",ExpressionUUID->"b01f488c-40c8-4d7f-bcc9-c39f7a7d7b49"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MiuraOri", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{"\"\<triangulate\>\"", "\[Rule]", "False"}], " ", "}"}]}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOri", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"l1_", "?", "miuraLengthQ"}], ",", " ", 
       RowBox[{"l2_", "?", "miuraLengthQ"}]}], " ", "}"}], " ", ",", " ", 
     RowBox[{"an_", "?", "miuraAngleQ"}], " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", " ", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", "m", " ", "}"}], ",", 
      RowBox[{"With", "[", "\n", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"Faces", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "5", ",", "6", ",", "2"}], "}"}]}], "}"}]}], 
          ",", "\n", "\t", 
          RowBox[{"TorsionalFolds", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "3"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "6"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "7"}], "}"}]}], "}"}]}], ",", "\n", "\t", 
          RowBox[{"coordinates", " ", "=", " ", 
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", "\n", "\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"l1", "/", "2"}], ",", "0"}], "}"}], ",", "\n", "\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"l1", "/", "2"}], " ", "-", " ", 
                RowBox[{"l2", " ", 
                 RowBox[{
                  RowBox[{"Cot", "[", "an", "]"}], "/", "2"}]}]}], ",", 
               RowBox[{"l2", "/", "2"}]}], "}"}], ",", "\n", "\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "l2"}], " ", 
                RowBox[{
                 RowBox[{"Cot", "[", "an", "]"}], "/", "2"}]}], ",", " ", 
               RowBox[{"l2", "/", "2"}]}], "}"}], ",", "\n", "\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "l2"}], " ", 
                RowBox[{
                 RowBox[{"Cot", "[", "an", "]"}], "/", "2"}]}], ",", " ", 
               RowBox[{
                RowBox[{"-", "l2"}], "/", "2"}]}], " ", "}"}], ",", "\n", 
             "\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"l1", "/", "2"}], "-", 
                RowBox[{"l2", " ", 
                 RowBox[{
                  RowBox[{"Cot", "[", "an", "]"}], "/", "2"}]}]}], ",", " ", 
               RowBox[{
                RowBox[{"-", "l2"}], "/", "2"}]}], " ", "}"}]}], "\n", "\t", 
            "}"}]}]}], "\n", "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{"m", " ", "=", " ", 
          RowBox[{"Origami", "[", 
           RowBox[{"coordinates", ",", 
            RowBox[{"Face", "/@", "Faces"}]}], "]"}]}], ";", "\n", "\t", 
         RowBox[{"TesselateMechanism", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<triangulate\>\"", "]"}], ",", 
             " ", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"AddCells", "[", 
               RowBox[{"{", 
                RowBox[{"TorsionalFold", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "3"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "6"}], "}"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"\"\<passive\>\"", ",", 
                    RowBox[{"\"\<Shape\>\"", "\[Rule]", "None"}]}], "}"}]}], 
                 "]"}], "}"}], "]"}], " ", "@", " ", 
              RowBox[{
               RowBox[{"DivideFaces", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", ",", "3"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "6"}], "}"}]}], "}"}], "]"}], " ", "@", 
               " ", "m"}]}], ",", " ", "\n", "\t\t\t", "m"}], "\n", "\t\t", 
            "]"}], ",", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"1", "/", "2"}], ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ",", "\n", 
           "\t\t", 
           RowBox[{"{", 
            RowBox[{"2", ",", "1"}], "}"}]}], "\n", "\t", "]"}]}]}], "\n", 
       "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{"miuraOptionsQ", "[", " ", 
     RowBox[{"OptionValue", "[", "\"\<triangulate\>\"", "]"}], " ", "]"}]}]}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"miuraLengthQ", "[", " ", "l_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"NumericQ", "[", "l", "]"}], " ", "&&", " ", 
     RowBox[{"l", " ", ">", " ", "0"}]}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MiuraOri", "::", "length"}], "]"}], ";", " ", "False"}]}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{"miuraAngleQ", "[", " ", "a_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"NumericQ", "[", "a", "]"}], " ", "&&", " ", 
     RowBox[{"0", " ", "<", " ", 
      RowBox[{"N", "[", "a", "]"}], " ", "<", " ", "Pi"}]}], ",", " ", "True",
     ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MiuraOri", "::", "angle"}], "]"}], ";", " ", "False"}]}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"miuraOptionsQ", "[", " ", "b_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"BooleanQ", "[", "b", "]"}], ",", " ", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MiuraOri", "::", "t"}], "]"}], ";", " ", "False"}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOri", "::", "length"}], " ", "=", " ", 
   "\"\<Length must be a positive numeric value.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOri", "::", "angle"}], " ", "=", " ", 
   "\"\<Angle must be a numeric value between 0 and \[Pi].\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOri", "::", "t"}], " ", "=", " ", 
   "\"\<Option \\\"triangulate\\\" should be a boolean variable.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4454]:=",ExpressionUUID->"df661cfd-ae0b-44c1-87df-b4da3007a4a3"]
}, Closed]],

Cell[CellGroupData[{

Cell["KreslingOrigami[]", "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "KreslingOrigami", "]"}], "=", 
   RowBox[{"Options", "[", "Origami", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[4462]:=",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles", ",", "numHeight", ",", "twist"}], "}"}], ",", 
    "1", ",", "1", ",", "opt"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"radius_", "?", "NumericQ"}], ",", 
    RowBox[{"heightScale_", "?", "NumericQ"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{"height", "=", 
         RowBox[{"heightScale", " ", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Cos", "[", 
               RowBox[{"Pi", "/", "numTriangles"}], "]"}], "-", 
              RowBox[{"Cos", "[", 
               RowBox[{"2", " ", 
                RowBox[{"Pi", "/", "numTriangles"}]}], "]"}]}], ")"}]}], 
           "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{"Origami", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"radius", " ", 
          RowBox[{"Join", "@@", 
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], " ", "height"}]}], "\n", 
                "\t\t\t", "}"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"numHeight", "+", "1"}]}], "}"}]}], "]"}]}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}], ",", 
                    "numTriangles", ",", 
                    RowBox[{
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}]}], "]"}], 
                  ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", 
                "\t\t\t", "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}], ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "-", "1", "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", "\t\t\t",
                 "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}]}], "\n", "\t\t", 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"numHeight", "-", "1"}]}], "}"}]}], "]"}], ",", "\n", 
         "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"numTriangles", ">=", "2"}], "&&", 
    RowBox[{"numHeight", ">=", "1"}]}]}]}]}], "Code",
 CellLabel->
  "In[4463]:=",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomOrigami[]", "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RandomOrigami", "]"}], "=", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "Origami", "]"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"Precision", "\[Rule]", "Automatic"}], ",", "\n", "\t", 
       RowBox[{"MaxIterations", "->", "20"}], ",", "\n", "\t", 
       RowBox[{"\"\<MinimumFolds\>\"", "->", "4"}], ",", "\n", "\t", 
       RowBox[{"\"\<BoundaryPoints\>\"", "->", 
        RowBox[{"CirclePoints", "[", "4", "]"}]}]}], "\n", "\t", "}"}]}], 
    "\n", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[4465]:=",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"ctr", " ", "=", " ", "1"}], ",", "\n", 
        RowBox[{"firstMesh", " ", "=", " ", 
         RowBox[{"randomMesh", "[", " ", 
          RowBox[{"numberOfVertices", ",", " ", 
           RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}]}], " ",
           "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"meshTry", " ", "=", " ", 
          RowBox[{"ToOrigami", "[", " ", 
           RowBox[{"firstMesh", " ", ",", " ", 
            RowBox[{"Precision", " ", "\[Rule]", " ", 
             RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", "]"}]}],
          ";", "\n", "\n", "\t", 
         RowBox[{"While", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", " ", "@", " ", 
             RowBox[{"validRandomOrigamiQ", "[", " ", 
              RowBox[{"numberOfVertices", ",", " ", "meshTry", ",", " ", 
               RowBox[{"OptionValue", "[", "\"\<MinimumFolds\>\"", "]"}], ",",
                " ", 
               RowBox[{"Length", "[", 
                RowBox[{"OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}], 
                "]"}]}], " ", "]"}]}], " ", "&&", " ", 
            RowBox[{"ctr", " ", "\[LessEqual]", " ", 
             RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}]}], ",", 
           "\n", "\t\t", 
           RowBox[{
            RowBox[{"meshTry", " ", "=", " ", 
             RowBox[{"ToOrigami", "[", " ", 
              RowBox[{
               RowBox[{"randomMesh", "[", " ", 
                RowBox[{"numberOfVertices", ",", " ", 
                 RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
                 RowBox[{
                 "OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}]}], " ", 
                "]"}], ",", " ", 
               RowBox[{"Precision", " ", "\[Rule]", " ", 
                RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", 
              "]"}]}], ";", " ", 
            RowBox[{"ctr", "++"}]}]}], "\n", "\t", "]"}], ";", "\n", "\n", 
         "\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"ctr", " ", ">", " ", 
            RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}], ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RandomOrigami", "::", "max"}], ",", " ", 
             RowBox[{"ctr", " ", "-", " ", "1"}]}], "]"}]}], " ", "]"}], ";", 
         "\n", "\n", "\t", 
         RowBox[{"Origami", "[", " ", 
          RowBox[{"meshTry", ",", " ", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "Origami", "]"}]}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"MeshRegionQ", "[", "firstMesh", "]"}]}]}], "\n", "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "\"\<MinimumFolds\>\"", " ", "]"}], 
      " ", "]"}], " ", "&&", " ", 
     RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "MaxIterations", " ", "]"}], " ", 
      "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomOrigami", "::", "max"}], "=", 
    "\"\<Maximum number of iterations reached at `1` without finding a \
suitable random Origami.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"validRandomOrigamiQ", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "minimumFolds_", ",", " ", 
     "boundarySize_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"AllTrue", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"Drop", "[", " ", 
        RowBox[{
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
          "]"}], ",", " ", "boundarySize"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"#", " ", "\[GreaterEqual]", " ", "minimumFolds"}], " ", 
       "&"}]}], "\n", "\t", "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "-", "boundarySize"}], 
     " ", "\[Equal]", " ", "numberOfVertices"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "::", "mTorsionalFold"}], "=", 
   "\"\<Minimum number of TorsionalFolds, `1`,  must be a position integer.\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", "f_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomOrigami", "::", "mTorsionalFold"}], ",", " ", "f"}], 
      "]"}], ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "::", "miter"}], "=", 
   "\"\<Maximum number of iterations, `1`, must be a position integer.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", "f_", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"RandomOrigami", "::", "miter"}], ",", " ", "f"}], "]"}], ";", 
    " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4466]:=",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "get", " ", "a", " ", "Delaunay", " ", "triangulation", " ", "from", " ", 
    "a", " ", "set", " ", "of", " ", "random", " ", "points"}], " ", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"randomMesh", "[", 
     RowBox[{
      RowBox[{"numberOfVertices_Integer", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
            RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], "|", "Automatic", "|", 
        "MachinePrecision"}]}], ",", " ", 
      RowBox[{"boundary_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=",
     "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "points", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"points", "=", 
         RowBox[{"Join", "[", "\n", "\t\t", 
          RowBox[{"boundary", ",", "\n", "\t\t", 
           RowBox[{"Select", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"RandomVariate", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"UniformDistribution", "[", 
                RowBox[{"RegionBounds", "[", 
                 RowBox[{"Polygon", "[", "boundary", "]"}], "]"}], "]"}], ",",
                "\n", "\t\t\t\t", "numberOfVertices", ",", "\n", "\t\t\t\t", 
               RowBox[{"WorkingPrecision", "->", "precision"}]}], "\n", 
              "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
             RowBox[{"RegionMember", "[", 
              RowBox[{"Polygon", "[", "boundary", "]"}], "]"}]}], "\n", 
            "\t\t", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
        RowBox[{"DelaunayMesh", "[", "points", "]"}]}]}], "\n", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"Last", "[", " ", 
       RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], " ", "]"}], 
      " ", "\[Equal]", " ", "2"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "vnum"}], "=", 
     "\"\<Number of vertices `1` should be a positive integer.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "prec"}], "=", 
     "\"\<Option Precision must be a positive number.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "bound"}], "=", 
     "\"\<Boundary points should be a list of vertices in 2D.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{"randomMesh", "[", " ", 
     RowBox[{
     "numberOfVertices_", ",", " ", "precision_", ",", " ", "boundary_"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "numberOfVertices", "]"}], " ", "&&", " ", 
           RowBox[{"numberOfVertices", " ", "\[GreaterEqual]", " ", "1"}]}], 
          " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"RandomOrigami", "::", "vnum"}], ",", " ", 
           "numberOfVertices"}], " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Not", "[", " ", 
           RowBox[{
            RowBox[{"NumericQ", "[", " ", "precision", " ", "]"}], " ", "&&", 
            " ", 
            RowBox[{"precision", " ", ">", " ", "0"}]}], " ", "]"}], " ", "&&",
           " ", 
          RowBox[{"Not", "[", " ", 
           RowBox[{"precision", " ", "===", " ", "Automatic"}], " ", "]"}]}], 
         ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"RandomOrigami", "::", "prec"}], ",", " ", "precision"}], 
          " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"MatrixQ", "[", " ", 
            RowBox[{"boundary", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], "]"}], 
            " ", "\[Equal]", " ", "2"}]}], " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{"RandomOrigami", "::", "bound"}], " ", "]"}]}], " ", "]"}], 
       ";", "\n", "\t", "False"}], "\n", ")"}]}]}]}]}]], "Code",
 CellLabel->
  "In[4475]:=",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami[], OrigamiData[]", "Subsection",ExpressionUUID->"cb5c27e0-90ba-44a2-b621-549bf08cb232"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Origami", "[", " ", "\"\<RandlettBird\>\"", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Origami", "[", " ", 
   RowBox[{"{", "\"\<RandlettBird\>\"", "}"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<RandlettBird\>\"", ",", " ", 
     RowBox[{"s_String", " ", ":", " ", "\"\<unfolded coordinates\>\""}]}], 
    "}"}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"data", " ", "=", " ", 
      RowBox[{"OrigamiData", "[", " ", "\"\<RandlettBird\>\"", " ", "]"}]}], 
     " ", "}"}], ",", "\n", "\t", 
    RowBox[{"Origami", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"data", "[", "s", "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"RigidBar", "[", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<face folds\>\"", "]"}], " ", ",", " ", 
          RowBox[{"\"\<Shape\>\"", " ", "\[Rule]", " ", "None"}]}], "]"}], 
        ",", "\n", "\t\t", 
        RowBox[{"Face", "[", " ", 
         RowBox[{"data", "[", "\"\<faces\>\"", "]"}], " ", "]"}], ",", "\n", 
        "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"TorsionalFold", "[", 
            RowBox[{"#1", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\"\<Angle\>\"", "\[Rule]", "#2"}], ",", 
               "\"\<active\>\""}], "}"}]}], "]"}], "&"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"data", "[", "\"\<TorsionalFolds\>\"", "]"}], ",", " ", 
            RowBox[{"data", "[", "\"\<jihwan\>\"", "]"}]}], "}"}]}], "]"}], 
        ",", "\n", "\t\t", 
        RowBox[{"TorsionalFold", "[", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<face folds\>\"", "]"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{"\"\<passive\>\"", ",", " ", 
            RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}]}], "}"}]}], 
         "]"}]}], "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4480]:=",ExpressionUUID->"57ab66e2-d535-4e5f-873b-1254aa74d5b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrigamiData", "[", "]"}], " ", ":=", " ", 
    RowBox[{"{", "\"\<RandlettBird\>\"", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiData", "[", " ", "\"\<RandlettBird\>\"", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"Association", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"\"\<TorsionalFolds\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"16", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "15"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"15", ",", "16"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"20", ",", "15"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"12", ",", "13"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "7"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"7", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "7"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"5", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"11", ",", "21"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "10"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"10", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"10", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"15", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17", ",", "16"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"9", ",", "18"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"16", ",", "9"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"14", ",", "10"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"19", ",", "14"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"9", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "7"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"9", ",", "8"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"14", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "14"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "17"}], "}"}]}], "}"}]}], ",", "\n", "\t", 
    RowBox[{"\"\<BoundaryPoints\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "20"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"20", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "18"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"18", ",", "5"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"5", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "13"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"13", ",", "19"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"19", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "21"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"21", ",", "1"}], "}"}]}], "}"}]}], ",", "\n", "\t", 
    RowBox[{"\"\<Face TorsionalFolds\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "15"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "8"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "18"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"9", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"10", ",", "19"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"12", ",", "19"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"14", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"16", ",", "18"}], "}"}]}], "}"}]}], ",", "\n", "\t", 
    RowBox[{"\"\<faces\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"15", ",", "20", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "17", ",", "15"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"11", ",", "17", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "21", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"18", ",", "2", ",", "16"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"16", ",", "9", ",", "18"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"16", ",", "2", ",", "15"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"15", ",", "2", ",", "20"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"13", ",", "3", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"12", ",", "3", ",", "7"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"7", ",", "3", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "3", ",", "5"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"21", ",", "4", ",", "11"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"11", ",", "4", ",", "10"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"10", ",", "4", ",", "19"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"19", ",", "14", ",", "10"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "5", ",", "18"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"18", ",", "9", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "7", ",", "6"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"6", ",", "9", ",", "8"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"12", ",", "7", ",", "8"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"8", ",", "14", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"14", ",", "8", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17", ",", "10", ",", "14"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"17", ",", "8", ",", "9"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"9", ",", "16", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"11", ",", "10", ",", "17"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"19", ",", "13", ",", "12"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"12", ",", "14", ",", "19"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"16", ",", "15", ",", "17"}], "}"}]}], "}"}]}], ",", "\n", 
    "\t", 
    RowBox[{"\"\<face fold lengths\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "0.7913396176795269`", ",", "0.7908518374761098`", ",", 
       "0.4256202239155842`", ",", "0.41820627040046277`", ",", 
       "0.4256214113580315`", ",", "0.3661853242047003`", ",", 
       "0.5778591613439372`", ",", "0.4182055804484132`", ",", 
       "0.36642731880122054`", ",", "0.5778622627981455`"}], "}"}]}], ",", 
    "\n", "\t", 
    RowBox[{"\"\<fold lengths\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "0.6668302449309317`", ",", "0.7905987902232614`", ",", 
       "0.2635292648903121`", ",", "0.5900528686107307`", ",", 
       "0.2260243957445146`", ",", "0.10234385548891164`", ",", 
       "0.19243997335732346`", ",", "0.07476947912792758`", ",", 
       "0.2260251237847865`", ",", "0.07476836902333805`", ",", 
       "0.10234618221503516`", ",", "0.7899358777822478`", ",", 
       "0.5900530310922064`", ",", "0.6668278565928233`", ",", 
       "0.26292795741175695`", ",", "0.33331002589557746`", ",", 
       "0.35349728907839567`", ",", "0.3531715279617028`", ",", 
       "0.33294017146420657`", ",", "1.0001365746515256`", ",", 
       "0.3495350708976718`", ",", "0.2902649617356811`", ",", 
       "0.2902613044683481`", ",", "0.3495354877728568`", ",", 
       "0.5373516043568678`", ",", "0.44156905689970305`", ",", 
       "0.25766229600206336`", ",", "0.5373541657262233`", ",", 
       "0.25766207233991933`", ",", "0.3657613109073552`"}], "}"}]}], ",", 
    "\n", "\t", 
    RowBox[{"\"\<boundary lengths\>\"", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "0.2350773277983888`", ",", "1.1792012718458462`", ",", 
       "0.8061889965405188`", ",", "0.42175777675288983`", ",", 
       "0.18620179179423596`", ",", "0.18620363078624286`", ",", 
       "0.4217559689391429`", ",", "0.8061889535079899`", ",", 
       "1.178492447495307`", ",", "0.2355242761556322`"}], "}"}]}], ",", "\n",
     "\t", 
    RowBox[{"\"\<unfolded coordinates\>\"", " ", "\[Rule]", " ", 
     RowBox[{"N", "@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.414278593427568`", ",", 
          RowBox[{"-", "0.00012107343015166361`"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.4142678318232762`", ",", "1.4140274916158289`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.00011927863201000033`", ",", "1.414016642177331`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.4142692917736754`", ",", "1.227825699827347`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.3131744350755659`", ",", "1.211870419723824`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.2781932400501788`", ",", "1.2779508631318839`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.9659583817161155`", ",", "0.9657127724823382`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "1.0728360008415996`", ",", "0.7312622802432727`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.47189742974276605`", ",", "0.9427579377876374`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.353962452288944`", ",", "0.7077633593785156`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.2121120814828474`", ",", "1.312933079920714`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.2280642010424148`", ",", "1.4140260798657769`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"0.731505784488571`", ",", "1.0725852346780647`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.7073110670506855`", ",", "0.3537763181270138`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.9430090748133337`", ",", "0.47164965094818173`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.7074588006059522`", ",", "0.7069478151898358`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "1.4142724979918373`", ",", "0.8060679230868013`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.8063082321157269`", ",", "1.4140228586178498`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.23507732779834628`", ",", "1.1102230246251565`*^-16", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.0001931022705954355`", ",", "0.2355241969949885`", ",", "0"}], 
         "}"}]}], "}"}]}]}], ",", "\n", "\t", 
    RowBox[{"\"\<folded coordinates\>\"", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.5216212272644043`", ",", "0.0041301921010017395`", ",", 
         RowBox[{"-", "0.5215774178504944`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.6376347541809082`"}], ",", "0.4420289695262909`", 
         ",", 
         RowBox[{"-", "0.16293174028396606`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.435793399810791`"}], ",", 
         RowBox[{"-", "0.10257021337747574`"}], ",", "0.4356272220611572`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.16264325380325317`", ",", "0.442157119512558`", ",", 
         "0.6371942758560181`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.4927003085613251`"}], ",", "0.07479492574930191`", 
         ",", "0.4173307418823242`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.4104839861392975`"}], ",", "0.11236074566841125`", 
         ",", "0.36908411979675293`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.4352164566516876`"}], ",", "0.0874059870839119`", 
         ",", "0.43510642647743225`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.22010493278503418`"}], ",", 
         RowBox[{"-", "0.2338118851184845`"}], ",", "0.22003494203090668`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.13188940286636353`"}], ",", 
         RowBox[{"-", "0.15577159821987152`"}], ",", 
         RowBox[{"-", "0.008406173437833786`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "0.11944180727005005`", ",", "0.1096508726477623`", ",", 
         "0.06939235329627991`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.047771066427230835`", ",", 
         RowBox[{"-", "0.13527639210224152`"}], ",", "0.09195645153522491`"}],
         "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.3691454231739044`"}], ",", "0.11233522742986679`", 
         ",", "0.410442054271698`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.4174804091453552`"}], ",", "0.07477816939353943`", 
         ",", "0.49260756373405457`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.00845295935869217`", ",", 
         RowBox[{"-", "0.15610502660274506`"}], ",", "0.13212451338768005`"}],
         "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.09123314917087555`"}], ",", 
         RowBox[{"-", "0.13514138758182526`"}], ",", 
         RowBox[{"-", "0.04728326201438904`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.06939570605754852`"}], ",", "0.11028251051902771`", 
         ",", 
         RowBox[{"-", "0.11917997896671295`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.18727263808250427`"}], ",", "0.1310577541589737`", 
         ",", "0.1871875524520874`"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.41846323013305664`"}], ",", 
         RowBox[{"-", "0.254423052072525`"}], ",", "0.16566649079322815`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.1659073531627655`"}], ",", 
         RowBox[{"-", "0.25454390048980713`"}], ",", "0.4185855984687805`"}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.3550601601600647`", ",", 
         RowBox[{"-", "0.1361958533525467`"}], ",", 
         RowBox[{"-", "0.4324187636375427`"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.43267032504081726`", ",", 
         RowBox[{"-", "0.13634231686592102`"}], ",", 
         RowBox[{"-", "0.35442548990249634`"}]}], "}"}]}], "}"}]}], ",", "\n",
     "\t", 
    RowBox[{"\"\<jihwan\>\"", " ", "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{"13", " ", "\[Pi]"}], "15"]}], ",", 
       FractionBox[
        RowBox[{"143", " ", "\[Pi]"}], "180"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"17", " ", "\[Pi]"}], "30"]}], ",", 
       FractionBox[
        RowBox[{"41", " ", "\[Pi]"}], "60"], ",", 
       FractionBox[
        RowBox[{"139", " ", "\[Pi]"}], "180"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"149", " ", "\[Pi]"}], "180"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"107", " ", "\[Pi]"}], "180"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"149", " ", "\[Pi]"}], "180"]}], ",", 
       FractionBox[
        RowBox[{"139", " ", "\[Pi]"}], "180"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"149", " ", "\[Pi]"}], "180"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"149", " ", "\[Pi]"}], "180"]}], ",", 
       FractionBox[
        RowBox[{"143", " ", "\[Pi]"}], "180"], ",", 
       FractionBox[
        RowBox[{"41", " ", "\[Pi]"}], "60"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"13", " ", "\[Pi]"}], "15"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"17", " ", "\[Pi]"}], "30"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"13", " ", "\[Pi]"}], "15"]}], ",", 
       FractionBox[
        RowBox[{"43", " ", "\[Pi]"}], "60"], ",", 
       FractionBox[
        RowBox[{"43", " ", "\[Pi]"}], "60"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"13", " ", "\[Pi]"}], "15"]}], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"79", " ", "\[Pi]"}], "180"]}], ",", "\[Pi]", ",", 
       FractionBox[
        RowBox[{"157", " ", "\[Pi]"}], "180"], ",", 
       FractionBox[
        RowBox[{"157", " ", "\[Pi]"}], "180"], ",", "\[Pi]", ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"23", " ", "\[Pi]"}], "30"]}], ",", 
       FractionBox[
        RowBox[{"107", " ", "\[Pi]"}], "180"], ",", 
       FractionBox[
        RowBox[{"34", " ", "\[Pi]"}], "45"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"23", " ", "\[Pi]"}], "30"]}], ",", 
       FractionBox[
        RowBox[{"34", " ", "\[Pi]"}], "45"], ",", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"91", " ", "\[Pi]"}], "180"]}]}], "}"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4482]:=",ExpressionUUID->"cd236665-00fe-4e3a-9fdf-305558993417"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Origami", "[", "\"\<WaterBombBase\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"SingleVertex", "[", " ", 
   RowBox[{
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"2", " ", 
       RowBox[{"Pi", "/", "8"}]}], ",", "8"}], "]"}], " ", ",", 
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"Sqrt", "[", "2", "]"}]}], "}"}], " ", "&"}], " ", "/@", " ", 
      RowBox[{"Range", "[", "4", "]"}]}], "]"}]}], "  ", "]"}]}]], "Code",
 CellLabel->
  "In[4484]:=",ExpressionUUID->"95b63ef6-b4a3-43c9-b577-8fb55e64adf9"]
}, Closed]],

Cell[CellGroupData[{

Cell["ElasticizeOrigami[]", "Subsection",ExpressionUUID->"998277f7-e77f-481f-8d03-2b6fa89387fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"bars", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", " ", "_RigidBar"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"Faces", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_Face"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"TorsionalFolds", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"possibleFolds", " ", "=", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}], ",", "\n", "\t", 
       "skippedFolds"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"AddCells", "[", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteCells", "[", " ", "\n", "\t\t\t", 
          RowBox[{"Join", "[", " ", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "bars", "]"}], ">", "0"}], ",", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"bars", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", ",", " ", 
              
              RowBox[{"{", "}"}]}], "]"}], " ", ",", " ", "\n", "\t\t\t\t", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "Faces", "]"}], ">", "0"}], ",", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"Faces", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", " ", 
              
              RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "\t\t\t", "]"}], " ", 
          "\n", "\t\t", "]"}], " ", "@", " ", "m"}], ",", "\n", "\n", "\t\t", 
        
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "Faces", "]"}], ">", "0"}], ",", " ", 
            RowBox[{"ElasticTriangle", " ", "/@", " ", 
             RowBox[{"Faces", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], " ", ",", 
            " ", 
            RowBox[{"{", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "TorsionalFolds", "]"}], ">", "0"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"skippedFolds", " ", "=", " ", 
              RowBox[{"Complement", "[", " ", 
               RowBox[{
                RowBox[{"Sort", "/@", "possibleFolds"}], ",", " ", 
                RowBox[{"Sort", "/@", 
                 RowBox[{"TorsionalFolds", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}]}], 
               "]"}]}], ";", "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "skippedFolds", "]"}], ">", "0"}], ",",
                " ", 
               RowBox[{"TorsionalFold", "[", " ", 
                RowBox[{"skippedFolds", " ", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "0"}], 
                  "}"}]}], "]"}], ",", " ", 
               RowBox[{"{", "}"}]}], " ", "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"TorsionalFold", "[", 
             RowBox[{"possibleFolds", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "0"}], 
               "}"}]}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t\t", "}"}]}],
        "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{"FacesWorkQ", "[", " ", "Faces", " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"FacesWorkQ", "[", " ", 
   RowBox[{"{", "}"}], " ", "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"FacesWorkQ", "[", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Face", "[", " ", "indices_", " ", "]"}], " ", "\[Rule]", " ", 
     "data_"}], " ", "}"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "indices", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"Dimensions", "[", "indices", "]"}], "]"}], " ", "\[Equal]", 
       " ", "3"}]}], "}"}], ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FacesWorkQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", "False"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"ElasticizeOrigami", "::", "Faces"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "::", "Faces"}], "=", 
   "\"\<Faces must be triangles to elasticize this Origami.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4485]:=",ExpressionUUID->"6d9f25cf-a57b-4e21-b29e-24805f43aeb2"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Origami queries", "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],

Cell[CellGroupData[{

Cell["TargetFoldAngles[]", "Subsection",ExpressionUUID->"6f76eeb7-891c-4cae-a5ac-4d64373ec68b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TargetFoldAngles", "[", " ", "m_Origami", " ", "]"}], ":=", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", "=", 
      RowBox[{"TargetFoldAngles", "[", 
       RowBox[{"m", ",", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "]"}]}], "}"}], ",", 
    " ", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "TargetFoldAngles"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "[", " ", 
    RowBox[{"m_Origami", " ", ",", " ", "s_String"}], "]"}], ":=", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"TargetFoldAngles", "[", 
        RowBox[{"m", ",", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "s"}], "]"}]}], 
      "}"}], ",", " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "TargetFoldAngles"}]}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "[", " ", 
    RowBox[{"m_Origami", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", "=", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "data", "]"}], ">", "0"}], ",", "\n", "\t\t", 
        
        RowBox[{"Association", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"\"\<TorsionalFolds\>\"", " ", "\[Rule]", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", "\n", 
          "\t\t\t", 
          RowBox[{"\"\<target\>\"", " ", "\[Rule]", " ", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}], "[", "\"\<Angle\>\"", 
            "]"}]}], ",", "\n", "\t\t\t", 
          RowBox[{"\"\<actual\>\"", " ", "\[Rule]", " ", 
           RowBox[{"TorsionalFoldAngle", "[", 
            RowBox[{"m", ",", " ", "pos", ",", " ", 
             RowBox[{"data", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], 
         "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<TorsionalFolds\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"\"\<target\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"\"\<actual\>\"", "\[Rule]", 
           RowBox[{"{", "}"}]}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "[", " ", 
    RowBox[{
    "m_Origami", ",", " ", "pos_", " ", ",", "\"\<TorsionalFolds\>\""}], 
    "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", "=", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "data", "]"}], ">", "0"}], ",", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "[", " ", 
    RowBox[{"m_Origami", ",", " ", "pos_", " ", ",", " ", "\"\<target\>\""}], 
    "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", "=", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "data", "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "[", "\"\<Angle\>\"", "]"}],
         ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "[", " ", 
    RowBox[{"m_Origami", ",", " ", "pos_", " ", ",", " ", "\"\<actual\>\""}], 
    "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", "=", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "data", "]"}], ">", "0"}], ",", 
        RowBox[{"TorsionalFoldAngle", "[", 
         RowBox[{"m", ",", " ", "pos", ",", " ", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetFoldAngles", "::", "data"}], " ", "=", " ", 
   "\"\<Data is not one of \\\"TorsionalFolds\\\", \\\"actual\\\", \\\"target\
\\\"\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TargetFoldAngles", "::", "pos"}], " ", "=", " ", 
    "\"\<Positions are not numeric or do not correspond to Mechanism.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TargetFoldAngles", "[", 
   RowBox[{"m_Origami", ",", " ", "pos_", ",", " ", "s_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"TargetFoldAngles", "::", "data"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TargetFoldAngles", "[", 
   RowBox[{"m_Origami", ",", " ", "pos_", ",", " ", 
    RowBox[{
    "\"\<TorsionalFolds\>\"", "|", "\"\<target\>\"", "|", 
     "\"\<actual\>\""}]}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"TargetFoldAngles", "::", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4491]:=",ExpressionUUID->"8b6d2599-7eb7-438a-b947-9bbf95f936df"]
}, Closed]],

Cell[CellGroupData[{

Cell["FlatOrigamiQ[]", "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FlatOrigamiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "Automatic"}], ",", "\n", "\t", 
     RowBox[{"Precision", "->", "Infinity"}]}], "\n", "}"}]}], ";"}]], "Code",\

 CellLabel->
  "In[4501]:=",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "precision"}], "=", 
   "\"\<Precision is not a positive real number or Infinity.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "zerotest"}], "=", 
   "\"\<ZeroTest function must return True or False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4502]:=",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  RowBox[{"Precision", "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"precision_", "?", "NumericQ"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{"Precision", "[", "m", "]"}], ",", "precision"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"precision", ">", "0"}]}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "_"}], "]"}], " ", ":=", " ", "$Failed"}]}], "Code",
 CellLabel->
  "In[4504]:=",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  "PossibleZeroQ"}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", "#", "]"}], "<=", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "precision"}], "+", "1"}], ")"}]}]}], "&"}], 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"f_", ",", "_"}], "]"}], " ", ":=", " ", "f"}]}], "Code",
 CellLabel->
  "In[4507]:=",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FlatOrigamiQ", "[", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"actualPrecision", " ", "=", " ", 
       RowBox[{"computePrecision", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "Precision", "]"}]}], "]"}]}], ",", " ", 
      "zerotestFunction", ",", " ", "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"zerotestFunction", "=", 
      RowBox[{"computeZeroTestFunction", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], ",", " ", 
        "actualPrecision"}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "=", 
      RowBox[{"flatOrigamiInternalQ", "[", 
       RowBox[{"m", ",", "actualPrecision", ",", "zerotestFunction"}], 
       "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "/;", 
      RowBox[{"Which", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], "=!=", "flatOrigamiInternalQ"}], 
        ",", "\n", "\t\t\t", "True", ",", "\n", "\t\t", 
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", 
          RowBox[{"zerotestFunction", "[", "0", "]"}], "]"}], "]"}], ",", 
        "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"FlatOrigamiQ", "::", "zerotest"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", 
        RowBox[{"actualPrecision", "===", "$Failed"}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"FlatOrigamiQ", "::", "precision"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", "True", ",", "False"}], "\n", "\t", 
       "]"}]}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4510]:=",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flatOrigamiInternalQ", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "NumericQ"}], " ", "|", " ", "Infinity"}]}], ",", " ", 
    RowBox[{"zerotestFunction_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"BooleanQ", "[", 
        RowBox[{"#", "[", "0", "]"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  "\n", "\t", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"DiscreteGaussianCurvature", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "precision"}],
        "]"}], " ", ",", " ", 
      RowBox[{"InteriorVertices", "[", "m", "]"}]}], " ", "]"}], ",", " ", 
    "zerotestFunction"}], "]"}]}]], "Code",
 CellLabel->
  "In[4511]:=",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],

Cell[CellGroupData[{

Cell["KawasakiQ[]", "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "KawasakiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "PossibleZeroQ"}], ",", "\n", "\t", 
     RowBox[{"WorkingPrecision", "->", "Infinity"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4512]:=",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KawasakiQ", "[", 
   RowBox[{"m_Origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"v", "=", 
        RowBox[{"InteriorVertices", "[", "m", "]"}]}], ",", "\n", "\t", 
       RowBox[{"mNum", "=", 
        RowBox[{"N", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FlatOrigamiQ", "[", 
        RowBox[{"m", ",", "opt"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"And", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", 
            RowBox[{"kawasakiAlternatingSum", "[", 
             RowBox[{"mNum", ",", "#"}], "]"}], "]"}], "&"}], "/@", "v"}], 
         ")"}]}], ",", "\n", "\t\t", "False"}], "\n", "\t", "]"}]}], "\n", 
    "]"}], "/;", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", "\n", "\t", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], ")"}], "&&", "\n", "\t", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], 
      "]"}]}], "\n", ")"}]}]}]], "Code",
 CellLabel->
  "In[4513]:=",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],

Cell[BoxData[
 RowBox[{
  RowBox[{"kawasakiAlternatingSum", "[", 
   RowBox[{"m_", ",", "v_Integer"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"Faces", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
       RowBox[{"MechanismFaces", "[", 
        RowBox[{"m", ",", "v"}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"OddQ", "[", 
       RowBox[{"Length", "[", "Faces", "]"}], "]"}], ",", "\n", "\t\t", "1", 
      ",", "\n", "\t\t", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "1"}], ")"}], "^", "#"}], " ", "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "Faces", "]"}], "]"}]}], "]"}], " ", ".", 
        " ", 
        RowBox[{"PlaneAngle", "[", 
         RowBox[{"m", ",", "Faces"}], "]"}]}], "]"}]}], "\n", "\t", "]"}]}], 
   "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4514]:=",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KawasakiQ", "::", "workingprecision"}], "=", 
   "\"\<Working precesion must be a real value larger than 0.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"KawasakiQ", "::", "zerotest"}], "=", 
    "\"\<Zero test does not return True or False.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"KawasakiQ", "[", 
   RowBox[{"m_Origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"KawasakiQ", "::", "workingprecision"}], "]"}], ";", "\n", 
      "\t\t", "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"BooleanQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], "]"}],
       "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"KawasakiQ", "::", "zerotest"}], "]"}], ";", "\n", "\t\t", 
      "False"}], ",", "\n", "\t", "True", ",", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4515]:=",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],

Cell[CellGroupData[{

Cell["SameFoldAnglesQ[]", "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"TorsionalFolds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"TorsionalFoldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"TorsionalFoldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", " ", 
      RowBox[{"precision", "^", "2"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SameFoldAnglesQ", "[", 
     RowBox[{"m_Origami", ",", " ", 
      RowBox[{"TorsionalFolds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"TorsionalFolds", " ", "=", " ", 
       RowBox[{"InteriorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"angles1", " ", "=", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}], ",", "\n", "\t", 
         RowBox[{"angles2", " ", "=", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", " ", 
         RowBox[{"(", 
          RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", 
        " ", 
        RowBox[{"precision", "^", "2"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}],
    " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "In[4518]:=",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],

Cell[CellGroupData[{

Cell["SameMVAnglesQ[]", "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"TorsionalFolds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
      "0.1"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"And", " ", "@@", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", "]"}],
    " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SameMVAnglesQ", "[", 
     RowBox[{"m_Origami", ",", " ", 
      RowBox[{"TorsionalFolds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "Integer"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"TorsionalFolds", " ", "=", " ", 
       RowBox[{"InteriorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"angles1", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"TorsionalFoldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ",
              "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
         RowBox[{"angles2", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"TorsionalFoldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ",
              "]"}]}], " ", "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{"And", " ", "@@", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", 
      "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "In[4522]:=",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Origami data", "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],

Cell[CellGroupData[{

Cell["TorsionalFoldMatrix[]", "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", "m_Origami", "]"}], ":=", 
  RowBox[{"TorsionalFoldMatrixInternal", "[", 
   RowBox[{"m", ",", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
    RowBox[{"InteriorEdges", "[", "m", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", 
   RowBox[{"m_Origami", ",", "positions_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"TorsionalFoldMatrixInternal", "[", 
    RowBox[{"m", ",", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
     RowBox[{"InteriorEdges", "[", "m", "]"}]}], "]"}], "/;", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", 
   RowBox[{"m_Origami", ",", "positions_", ",", 
    RowBox[{"indices_", "?", "edgeListQ"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"TorsionalFoldMatrixInternal", "[", 
    RowBox[{"m", ",", "positions", ",", "indices"}], "]"}], "/;", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4526]:=",ExpressionUUID->"5a272a8d-b37b-477f-a024-ee728ce8ca49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TorsionalFoldMatrixInternal", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"indices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"displacements", "=", 
      RowBox[{"VertexDisplacement", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"TorsionalFoldAngle", "[", 
        RowBox[{"m", ",", 
         RowBox[{"positions", "+", "displacements"}], ",", "indices"}], "]"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"Flatten", "[", "displacements", "]"}], "}"}]}], "]"}], "/.", 
     
     RowBox[{"Dispatch", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "displacements", "]"}], "->", "0"}], "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4529]:=",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "=", 
   "\"\<Mechanism is not Origami.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "::", "pos"}], "=", 
   "\"\<Positions do not correspond to the Mechanism provided.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldMatrix", "::", "indices"}], "=", 
    "\"\<Indices provided do not correspond to a list of edges.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", "m_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", 
   RowBox[{"m_", ",", "positions_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "Origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "]"}], ",", "\n", 
     "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"TorsionalFoldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
     "True", ",", "False"}], "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", 
   RowBox[{"m_", ",", "positions_", ",", "indices_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "Origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "]"}], ",", "\n", 
     "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"TorsionalFoldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"Dimensions", "[", "indices", "]"}], "]"}], "!=", "2"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"TorsionalFoldMatrix", "::", "indices"}], "]"}], ",", "\n", 
     "\t", "True", ",", "False"}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[4530]:=",ExpressionUUID->"0f22cd14-f2c6-414f-9ee6-3d896ed5cfcc"]
}, Closed]],

Cell[CellGroupData[{

Cell["AngularFoldMatrix[]", "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AngularFoldMatrix", "[", 
   RowBox[{"m_Origami", ",", "vertex_Integer"}], "]"}], ":=", 
  RowBox[{"AngularFoldMatrix", "[", 
   RowBox[{"m", ",", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "vertex"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"AngularFoldMatrix", "[", 
   RowBox[{"m_Origami", ",", 
    RowBox[{"positions_", "?", "MatrixQ"}], ",", "vertex_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vertices", "=", 
        RowBox[{"MechanismVertices", "[", 
         RowBox[{"m", ",", "vertex"}], "]"}]}], ",", "TorsionalFoldLengths", 
       ",", "angles", ",", "heights"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"TorsionalFoldLengths", "=", 
       RowBox[{"DisplacementLength", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", "vertices"}]}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"heights", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", 
          RowBox[{"vertices", ",", "\"\<z\>\""}], "]"}], "->", 
         RowBox[{"TorsionalFoldLengths", " ", 
          RowBox[{"Array", "[", 
           RowBox[{"angles", ",", 
            RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}]}], "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"Last", "@", 
       RowBox[{"CoefficientArrays", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{
             RowBox[{"TorsionalFoldMatrixInternal", "[", 
              RowBox[{"m", ",", "positions", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", 
                "vertices"}]}], "]"}], " ", ".", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"VertexDisplacement", "[", 
               RowBox[{"m", ",", 
                RowBox[{"All", "[", "3", "]"}]}], "]"}], "]"}]}]}], "/.", 
           "heights"}], "/.", 
          RowBox[{
           RowBox[{"VertexDisplacement", "[", 
            RowBox[{"_", ",", "_"}], "]"}], "->", "0"}]}], ",", "\n", "\t\t", 
         
         RowBox[{"Array", "[", 
          RowBox[{"angles", ",", 
           RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}], "\n", "\t", 
        "]"}]}]}]}], "\n", "]"}], "/;", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"InteriorVertices", "[", "m", "]"}], ",", "vertex"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4536]:=",ExpressionUUID->"9464b0a7-e384-4ae5-9af9-43a3e239bf92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AngularFoldMatrix", "::", "notintv"}], "=", 
   "\"\<Vertex should be an interior vertex.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AngularFoldMatrix", "::", "orig"}], "=", 
   "\"\<Mechanism is not Origami.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AngularFoldMatrix", "::", "pos"}], "=", 
    "\"\<Positions do not correspond to the Mechanism provided.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"AngularFoldMatrix", "[", 
   RowBox[{"m_Origami", ",", "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngularFoldMatrix", "::", "notintv"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"AngularFoldMatrix", "[", 
   RowBox[{"m_", ",", "positions_", ",", "v_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "Origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"AngularFoldMatrix", "::", "orig"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"AngularFoldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"IntegerQ", "[", "v", "]"}], "]"}], "||", 
      RowBox[{"Not", "[", 
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"InteriorVertices", "[", "m", "]"}], ",", "v"}], "]"}], 
       "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"AngularFoldMatrix", "::", "notintv"}], "]"}], ",", "\n", "\t", 
     "True", ",", "False"}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[4538]:=",ExpressionUUID->"abf836c2-0f64-4bef-a1a6-0c0029eb66ae"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics and geometry", "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],

Cell[CellGroupData[{

Cell["ButterflyDecomposition[], ButterflyDecomposableQ[]", "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecomposition", "[", " ", "o_Origami", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"results", " ", "=", " ", 
        RowBox[{"FixedPointList", "[", " ", 
         RowBox[{"ButterflyDecompositionStep", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", "o"}], "}"}]}], " ", "]"}]}], ",", " ", 
       "remainingOrigami"}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"remainingOrigami", " ", "=", " ", 
       RowBox[{
        RowBox[{"Last", "[", "results", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"Drop", "[", " ", 
         RowBox[{
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"results", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], ",", " ", 
        "remainingOrigami"}], " ", "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStep", "[", " ", 
   RowBox[{"{", 
    RowBox[{"Facepair_", ",", " ", "o_Origami"}], "}"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"BoundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "Faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismConnectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "Faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"butterfly", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"DeleteCells", "[", 
            RowBox[{"o", ",", " ", 
             RowBox[{"Alternatives", "@@", 
              RowBox[{"(", " ", 
               RowBox[{"Face", " ", "/@", " ", 
                RowBox[{"butterfly", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", ")"}]}]}], " ", 
            "]"}]}], "  ", "}"}]}], ",", "\n", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"Facepair", ",", " ", "o"}], "}"}]}], "\n", "\t", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionStep", "[", " ", 
    RowBox[{"{", 
     RowBox[{"Facepair_", ",", "o_Origami"}], "}"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", 
    RowBox[{"Facepair", ",", "o"}], "}"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "version", " ", "shows", " ", "little", " ", "speed", " ", 
    "improvements", " ", "over", " ", "solving", " ", "everything", " ", 
    "explicitly"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionQ", "[", " ", "o_Origami", " ", "]"}], " ", 
   ":=", " ", 
   RowBox[{"FixedPoint", "[", " ", 
    RowBox[{"ButterflyDecompositionStepQ", ",", " ", "o"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", 
   RowBox[{"f_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", "f"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", "o_Origami", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"BoundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "Faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismConnectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "Faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         " ", "\n", "\t\t", 
         RowBox[{"DeleteVertices", "[", 
          RowBox[{"o", ",", " ", 
           RowBox[{"{", 
            RowBox[{"butterfly", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}]}], ",", "\n", 
        "\n", "\t\t", "False"}], "\n", "\t", "]"}]}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", "o_Origami", " ", "]"}], 
  " ", ":=", " ", "True"}]}], "Code",
 CellLabel->
  "In[4543]:=",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],

Cell[CellGroupData[{

Cell["FlattenOrigami[]", "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unTorsionalFoldOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=",
   " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"TorsionalFolds", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"TorsionalFold", "[", "#", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], "}"}]}], " ",
           "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}]}], ",", "\n", "\t", 
      "selfflatteningOrigami", ",", " ", "res"}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"selfflatteningOrigami", " ", "=", " ", 
      RowBox[{
       RowBox[{"AddCells", "[", " ", "TorsionalFolds", " ", "]"}], " ", "@", 
       " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", "_PinnedJoint", " ", "]"}], " ", "@",
         " ", 
        RowBox[{
         RowBox[{"DeleteCells", "[", " ", "_TorsionalFold", " ", "]"}], " ", 
         "@", " ", "m"}]}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"MinimizeMechanismEnergy", "[", " ", 
       RowBox[{"selfflatteningOrigami", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "6"}]}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], "===", "List"}], ",", " ", "res", 
       ",", " ", 
       RowBox[{"{", 
        RowBox[{"Infinity", ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "}"}]}], " ", 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4550]:=",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chooseBoundaryFace", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"First", " ", "@", " ", 
   RowBox[{"SelectFirst", "[", " ", 
    RowBox[{
     RowBox[{"MechanismConnectivity", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ",
       "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], " ", "&"}]}], 
    " ", "]"}]}]}]], "Code",
 CellLabel->
  "In[4551]:=",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rotateFaceToXYPlane", "[", " ", 
    RowBox[{"positions_", ",", " ", 
     RowBox[{"Face", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"initialPoints", " ", "=", " ", 
        RowBox[{"positions", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Face", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "3"}], "]"}], "]"}], " ", "]"}], "]"}]}], ",", 
       " ", "lengths", ",", " ", "angle", ",", " ", "newPointLocations", ",", 
       " ", "residual", ",", " ", "transform"}], " ", "}"}], ",", " ", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"lengths", " ", "=", " ", 
       RowBox[{"DisplacementLength", "[", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", 
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "}"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"angle", " ", "=", " ", 
       RowBox[{"First", " ", "@", " ", 
        RowBox[{"PlaneAngle", "[", " ", 
         RowBox[{"positions", ",", " ", 
          RowBox[{"{", 
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "3"}], "]"}], "]"}], "}"}]}], " ", "]"}]}]}], 
      ";", "\t", "\n", "\t", 
      RowBox[{"newPointLocations", " ", "=", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"lengths", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
         "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"lengths", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cos", "[", " ", "angle", " ", "]"}], ",", " ", 
            RowBox[{"Sin", "[", " ", "angle", " ", "]"}], ",", " ", "0"}], 
           " ", "}"}]}]}], "\n", "\t", "}"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"residual", ",", " ", "transform"}], " ", "}"}], " ", "=", 
       " ", 
       RowBox[{"FindGeometricTransform", "[", " ", 
        RowBox[{"newPointLocations", ",", "initialPoints", ",", " ", 
         RowBox[{
         "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], ",", 
         " ", 
         RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ", 
        "]"}]}], ";", "\n", "\n", "\t", "transform"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "Face"}], "=", 
   "\"\<Unable to identify Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rotateFaceToXYPlane", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"FlattenOrigami", "::", "Face"}], "]"}], ";", " ", "Identity"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "In[4552]:=",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "FlattenOrigami", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "[", " ", 
    RowBox[{"m_Origami", " ", ",", " ", 
     RowBox[{"tol_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
         RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "unTorsionalFoldedEnergy", ",", " ", "unTorsionalFoldedPositions", ",", 
       " ", "transform", ",", " ", "xyPositions", ",", " ", "newOrigami"}], 
      " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"FlatOrigamiQ", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Precision", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"FlattenOrigami", "::", "flat"}], "]"}]}], " ", "]"}], ";", 
      "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
        "unTorsionalFoldedEnergy", ",", " ", "unTorsionalFoldedPositions"}], 
        " ", "}"}], " ", "=", " ", 
       RowBox[{"unTorsionalFoldOrigami", "[", "m", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ")"}], " ", "@", 
          " ", 
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", " ", "unTorsionalFoldedPositions", ",", " ", 
            RowBox[{"InteriorEdges", "[", "m", "]"}]}], "]"}]}], " ", ">", 
         " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}], ",", " ", 
        RowBox[{"Message", "[", " ", 
         RowBox[{"FlattenOrigami", "::", "notflt"}], " ", "]"}]}], " ", "]"}],
       ";", "\n", "\n", "\t", 
      RowBox[{"transform", " ", "=", " ", 
       RowBox[{"rotateFaceToXYPlane", "[", " ", 
        RowBox[{"unTorsionalFoldedPositions", ",", " ", 
         RowBox[{"chooseBoundaryFace", "[", "m", "]"}]}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"xyPositions", " ", "=", " ", 
       RowBox[{"PadRight", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "transform", "[", " ", "unTorsionalFoldedPositions", " ", "]"}], 
          "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "unTorsionalFoldedPositions", "]"}], ",", 
           " ", "3"}], " ", "}"}]}], " ", "]"}]}], ";", "\n", "\t\t\t", "\n", 
      "\t", 
      RowBox[{"Mechanisms`Private`addMeshRegion", "[", " ", 
       RowBox[{
        RowBox[{"Origami", "[", " ", 
         RowBox[{"xyPositions", ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], ",", " ", 
        "Automatic", ",", " ", "opt"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "notflt"}], "=", 
   "\"\<Origami flat energy may be too large to get good results.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "flat"}], "=", 
   "\"\<Gaussian curvature of vertices is not flat to desired tolerance \
`1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance `1` should be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FlattenOrigami", "::", "tol2"}], " ", "=", " ", 
    "\"\<Second argument should be a tolerance.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"FlattenOrigami", "[", " ", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"FlattenOrigami", "::", "tol2"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"FlattenOrigami", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "tol_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"FlattenOrigami", "::", "tol"}], ",", " ", "tol"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4555]:=",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],

Cell[CellGroupData[{

Cell["MVAssignment[]", "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MVAssignment", "[", " ", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"positions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}]}], ",", " ", 
     RowBox[{"color_", " ", ":", " ", "Automatic"}]}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"pos", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"positions", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          "positions"}], "]"}]}], ",", " ", "\n", "\t", 
       RowBox[{"colorFunction", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"color", " ", "===", " ", "Automatic"}], ",", " ", 
          "MVdefaultColor", ",", " ", "color"}], " ", "]"}]}], ",", " ", "\n",
        "\t", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"angles", " ", "=", " ", 
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", " ", "pos", ",", " ", "edges"}], "]"}]}], " ", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#1", " ", "\[Rule]", " ", 
             RowBox[{"colorFunction", "[", " ", 
              RowBox[{"assignMVForFold", "[", " ", 
               RowBox[{"#2", ",", " ", "tol"}], " ", "]"}], " ", "]"}]}], " ",
             ")"}], " ", "&"}], " ", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"edges", ",", " ", "angles"}], " ", "}"}]}], " ", "]"}]}], 
       "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{"NumericCoordinatesQ", "[", 
       RowBox[{"m", ",", " ", "pos"}], "]"}]}]}], "\n", "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{"1", " ", "/;", " ", 
   RowBox[{"angle", " ", ">", " ", 
    RowBox[{"Abs", "[", "tol", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"-", "1"}], " ", "/;", " ", 
   RowBox[{"angle", " ", "<", " ", 
    RowBox[{"-", 
     RowBox[{"Abs", "[", "tol", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"assignMVForFold", "[", 
    RowBox[{"_", ",", "_"}], "]"}], ":=", "0"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "1", "]"}], " ", ":=", " ", "Red"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", 
   RowBox[{"-", "1"}], "]"}], " ", ":=", " ", "Blue"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "0", "]"}], " ", ":=", " ", 
  "Black"}]}], "Code",
 CellLabel->
  "In[4563]:=",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["MVColor[]", "Subsection",ExpressionUUID->"db3d8342-8d8e-4752-845f-f3b764a796fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "[", 
    RowBox[{
    "m_Origami", ",", " ", "s_String", ",", " ", "colorFunction_Function"}], 
    " ", "]"}], ":=", " ", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"TargetFoldAngles", "[", "m", "]"}]}], ",", "styles"}], "}"}],
      ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", "\n", "\t", 
       RowBox[{
        RowBox[{"styles", "=", 
         RowBox[{"colorFunction", "/@", 
          RowBox[{"data", "[", "s", "]"}]}]}], ";", "\n", "\t", 
        RowBox[{"ChangeCellData", "[", 
         RowBox[{"m", ",", " ", "RigidBar", ",", 
          RowBox[{"data", "[", "\"\<TorsionalFolds\>\"", "]"}], ",", 
          RowBox[{"\"\<Style\>\"", " ", "\[Rule]", " ", "styles"}]}], "]"}]}],
        "\n", "\t", ")"}], " ", "/;", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"MemberQ", "[", " ", 
         RowBox[{
          RowBox[{"Keys", "[", "data", "]"}], ",", " ", "s"}], "]"}], ",", 
        " ", "True", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MVColor", "::", "s"}], ",", "s", ",", 
           RowBox[{"Keys", "[", "data", "]"}]}], "]"}], ";", " ", "False"}]}],
        "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "::", "s"}], "=", 
   "\"\<`1` is not a valid string of type `2`.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4570]:=",ExpressionUUID->"63f61e01-74fc-40c9-934b-7d2c34da1f73"]
}, Closed]],

Cell[CellGroupData[{

Cell["SurfaceArea[], RegionMeasure[], RegionMoment[]", "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SurfaceArea", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"SurfaceArea", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMeasure", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMeasure", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMoment", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMoment", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4572]:=",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],

Cell[CellGroupData[{

Cell["DeconstructedOrigami[]", "Subsection",ExpressionUUID->"e536bc67-8dac-439c-9b64-663526d4bf1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "DeconstructedOrigami", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<edgeWeights\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<defaultWeight\>\"", " ", "\[Rule]", " ", "0"}]}], "\n", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "[", " ", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", "\t", 
   
   RowBox[{"DeconstructedOrigami", "[", 
    RowBox[{"m", ",", " ", 
     RowBox[{"MechanismPositions", "[", "m", "]"}], ",", " ", "opt"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "[", " ", 
    RowBox[{"m_Origami", ",", " ", "coords_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"Faces", " ", "=", " ", 
         RowBox[{"MechanismFaces", "[", "m", "]"}]}], ",", " ", "\n", "\t", 
        RowBox[{"widths", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MechanismConnectivity", "[", 
            RowBox[{"m", ",", 
             RowBox[{
             "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], "]"}],
            " ", "/.", " ", 
           RowBox[{"OptionValue", "[", "\"\<edgeWeights\>\"", "]"}]}], " ", "/.",
           " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_Integer", ",", "_Integer"}], "}"}], " ", "\[Rule]", " ", 
           RowBox[{"OptionValue", "[", "\"\<defaultWeight\>\"", "]"}]}]}]}]}],
        "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"shrinkPolygon", " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"coords", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}], " ", "/@", " ", "Faces"}],
           ",", "widths"}], "}"}]}], " ", "]"}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"DeconstructedOrigamiQ", "[", 
     RowBox[{"m", " ", ",", " ", "coords", ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<edgeWeights\>\"", "]"}], ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<defaultWeight\>\"", "]"}]}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigamiQ", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "rules_", ",", " ", "default_"}], 
    " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "pos"}], "]"}], ";", " ", 
       "False"}]}], "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "default", "]"}], "&&", 
       RowBox[{"default", " ", "\[GreaterEqual]", " ", "0"}]}], ",", " ", 
      "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "defaultweight"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", " ", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MatchQ", "[", " ", 
       RowBox[{"rules", ",", " ", 
        RowBox[{"{", "___Rule", "}"}]}], " ", "]"}], ",", " ", "True", ",", 
      " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weightRules"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", " ", 
       RowBox[{
        RowBox[{"rules", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", "\[GreaterEqual]", "0"}]}], "&"}]}], " ", "]"}], ",", 
      " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weightrules"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MatchQ", "[", " ", 
       RowBox[{
        RowBox[{"rules", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"_Integer", ",", "_Integer"}], "}"}], "..."}], "}"}]}], 
       " ", "]"}], ",", " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weights"}], "]"}], ";", " ", 
       "False"}]}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "pos"}], "=", 
   "\"\<The positions do not correspond to the Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "weights"}], "=", 
   "\"\<The weights must be positive numbers.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "defaultweight"}], "=", 
   "\"\<The default weight must be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "edges"}], "=", 
   "\"\<The left hand side of the rules must be well-formed edges.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "weightrules"}], "=", 
   "\"\<Option \\\"edgeWeights\\\" must be a list of rules of the form edge \
-> positive weight.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4575]:=",ExpressionUUID->"a2cd35af-dbac-415c-ae7f-35b450b3699e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shrinkPolygon", "[", " ", 
    RowBox[{"pts_", ",", " ", "widths_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"pts", " ", "+", " ", 
    RowBox[{"Total", " ", "@", " ", 
     RowBox[{"MapIndexed", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"shrinkPolygonSide", "[", " ", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#1"}], " ", "]"}], 
        "&"}], ",", " ", "widths"}], " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"shrinkPolygonSide", "[", " ", 
   RowBox[{"pts_", ",", " ", "v1_", ",", " ", "width_"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "pts", "]"}]}], ",", " ", "v2", ",", " ", 
      "future", ",", " ", "past", ",", " ", "futureEdge", ",", " ", "edge", 
      ",", " ", "pastEdge"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"v2", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"future", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v2", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"past", " ", "=", " ", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "-", "1"}], ",", "n", ",", "1"}], "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{"edge", "=", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"futureEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "future", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"pastEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "past", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{"RotateRight", "[", 
      RowBox[{
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"width", "*", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"pastEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"pastEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"futureEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"futureEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"n", "-", "2"}]}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
       RowBox[{"v1", "-", "1"}]}], "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4584]:=",ExpressionUUID->"26dfeae0-7a2f-41aa-bacf-11526f181415"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[4586]:=",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mechanisms`graphics", "Chapter",ExpressionUUID->"4e117d75-efd0-4fbb-9ab5-54303adb6974"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`graphics`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[4588]:=",ExpressionUUID->"e14f7419-89e3-4783-9198-ab1d0a95c1b9"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"6034899b-68aa-4037-b918-fc414503a490"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AngleMarker", "::", "usage"}], "=", 
   "\"\<AngleMarker[m, {v1,v2,v3}, (radius) ] creates an arc around an angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AngleText", "::", "usage"}], "=", 
    "\"\<angleTest[m, {v1,v2,v3}, (distance) ] adds a text label to the angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "usage"}], " ", "=", " ", 
   "\"\<MechanismPrimitives[ m, (positions) ] returns a list of Mechanism \
primitives.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToGraphicsComplex", "::", "usage"}], " ", "=", " ", 
   "\"\<ToGraphicsComplex[ m, (positions) ] returns a GraphicsComplex object \
identical to MechanismPrimitives[].\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4589]:=",ExpressionUUID->"2cf6321a-3523-4f5a-99bf-84c1ba3196fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "usage"}], "=", 
   "\"\<PinnedJointShape[] is a triangular pinned joint in 2D.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "::", "usage"}], "=", 
   "\"\<SpringShape[] represents a Spring shape function with a particular \
thickness and number of jags.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "usage"}], "=", 
   "\"\<FreeJointShape[] represents a joint shape distinguishing pinned \
joints from free joints.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RigidBarShape", "::", "usage"}], "=", 
   "\"\<RigidBarShape[] represents the shape of a RigidBar\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "::", "usage"}], "=", 
   "\"\<FreeJointShape[] represents the shape of a free joint.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceShape", "::", "usage"}], "=", "\"\<FaceShape[]\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4593]:=",ExpressionUUID->"3cf79f62-832f-451c-8e21-d75c262e0170"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "usage"}], "=", "\n", 
   "\"\<PlotMechanism[ Mechanism, positions ] plots a Mechanism using \
positions.\nPlotMechanism[Mechanism, {positions 1, positions 2,...}] creates \
a list of plotted Mechanisms with uniform size.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[4599]:=",ExpressionUUID->"fec2b29f-ac6a-4f61-b198-9ada7c9935e9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"StressStyle", "::", "usage"}], "=", 
   "\"\<StressStyle is an option for PlotMechanism to provide a style for \
plotting stresses.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementStyle", "::", "usage"}], "=", 
   "\"\<DisplacementStyle is an option for PlotMechanism to provide a style \
for plotting displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementScale", "::", "usage"}], "=", 
   "\"\<DisplacementScale is an option for PlotMechanism to provide an \
overall scale for displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplayDimension", "::", "usage"}], "=", 
   "\"\<DisplayDimension is an option for PlotMechanism to choose the \
dimension in which a mechanism should be displayed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Displacements", "::", "usage"}], "=", 
   "\"\<Displacements is an option for PlotMechanism to display a vertex \
displacement overlaid with a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Stresses", "::", "usage"}], "=", 
   "\"\<Stresses is an option for PlotMechanism to display stresses overlaid \
with a mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4600]:=",ExpressionUUID->"000feeec-bb30-48a8-8e9a-889f6914e183"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "::", "usage"}], "=", 
   "\"\<OrigamiTexture[ s ] returns a texture having the name s. Use \
$OrigamiTextures to see possible textures.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$OrigamiTextures", "::", "usage"}], "=", 
   "\"\<$OrigamiTextures returns a list of textures you can use in \
OrigamiTexture[] to texture the faces of origami.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4606]:=",ExpressionUUID->"e7452ff7-4a1b-486f-843f-361c8ea558a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "$themes", " ", "=", " ", "\"\<List of recognized graphics themes.\>\""}], 
  ";"}]], "Code",
 CellLabel->
  "In[4608]:=",ExpressionUUID->"cf1d931e-3134-4092-81f5-c5441756f7b2"]
}, Closed]],

Cell[CellGroupData[{

Cell["global", "Section",ExpressionUUID->"0f8e42dc-5f2f-405a-b230-3b1f2fd2dc43"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`Origami`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[4609]:=",ExpressionUUID->"3298ad3f-9fe1-4719-b9e0-a54361a0a019"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
some functions for extracting graphics information from Mechanisms\
\>", "Section",ExpressionUUID->"264055aa-257e-4658-8e88-c7a82054dd0f"],

Cell[CellGroupData[{

Cell["defaultGraphicsPrimitive[], defaultGraphicsStyle[]", "Subsection",ExpressionUUID->"7e843407-88e6-42e6-a7fb-0d90b64f932d"],

Cell["\<\
Format for adding or modifying default primitives:

defaultGraphicsPrimitive[ primitive, Mechanism head, theme ]
defaultGraphicsStyle[ primitive, Mechanism head, theme ]\
\>", "Text",ExpressionUUID->"3c8f0d77-a834-4ff0-a98b-0ccc57bb7626"],

Cell[CellGroupData[{

Cell["Linkage default graphics", "Subsubsection",ExpressionUUID->"8f2974af-9693-44a6-a41d-17072b63e33a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Line"}], " ", ",", " ", "Linkage", " ", ",", 
    " ", "Automatic"}], "]"}], " ", ":=", " ", 
  RowBox[{"RigidBarShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "FreeJoint", " ", ",", " ", "Linkage", " ", ",", " ", "Automatic"}], "]"}],
   " ", ":=", " ", 
  RowBox[{"freeJointShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "PinnedJoint", " ", ",", " ", "Linkage", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"PinnedJointShape", "[", "]"}]}]}], "Code",
 CellLabel->
  "In[4614]:=",ExpressionUUID->"6387c029-df63-4edd-b7e3-3056df6c830d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami default graphics", "Subsubsection",ExpressionUUID->"47b141fa-f895-4edc-9dc0-60d87ba3481f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Line"}], " ", ",", " ", "Origami", " ", ",", 
    " ", "Automatic"}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "FreeJoint", " ", ",", " ", "Origami", " ", ",", " ", "Automatic"}], "]"}],
   " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "PinnedJoint", " ", ",", " ", "Origami", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", 
    RowBox[{"TorsionalFold", ",", " ", "Origami", ",", " ", "Automatic"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"TorsionalFold", ",", " ", "Origami", ",", " ", "Automatic"}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}]}], "Code",
 CellLabel->
  "In[4617]:=",ExpressionUUID->"55d9b51b-8c8e-45e9-80b1-d9728ad7b809"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], ",", " ", "Origami", 
    ",", " ", "\"\<thick\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<thickness\>\"", "\[Rule]", "0.01"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], ",", " ", "Origami", 
    ",", " ", 
    RowBox[{"\"\<thick\>\"", "[", "thickness_", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<thickness\>\"", " ", "\[Rule]", " ", "thickness"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4622]:=",ExpressionUUID->"bedb12a1-7d57-4b9c-bb71-022f3622a323"]
}, Closed]],

Cell[CellGroupData[{

Cell["shared graphics defaults", "Subsubsection",ExpressionUUID->"471a8712-097f-4fd1-9518-c829ff43a184"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"Face", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}], " ", ":=",
   " ", 
  RowBox[{"FaceShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"ElasticTriangle", ",", " ", "_", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<thickness\>\"", "\[Rule]", "0.01"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"Polygon", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}],
   " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Polygon", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"Spring", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"SpringShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"_", " ", ",", " ", "_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=",
   " ", "None"}]}], "Code",
 CellLabel->
  "In[4624]:=",ExpressionUUID->"7bef82e9-a442-4fc9-9df7-6bb3f6419724"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Spring", "|", "Line"}], ",", " ", "_", ",", 
    " ", "\"\<minimal\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", "|", "PinnedJoint", "|", "Point"}], ",", " ", "_", 
    ",", " ", "\"\<minimal\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"Face", "|", "ElasticTriangle", "|", "Polygon"}], ",", " ", "_", 
    ",", " ", "\"\<minimal\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Polygon", "[", "#", "]"}], "&"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4629]:=",ExpressionUUID->"9f080a33-4031-4746-8c35-5a48091cda2e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"RigidBar", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"FreeJoint", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"PinnedJoint", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"Face", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"GrayLevel", "[", "0.85", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "ElasticTriangle", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}],
   " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"{", 
     RowBox[{"0.85", ",", "0.85", ",", "0.95"}], "}"}], "]"}], 
   "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"Spring", " ", ",", " ", "_", " ", ",", " ", "Automatic"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_", " ", ",", " ", "_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[4632]:=",ExpressionUUID->"b683f485-8aa7-4d61-89c2-98979f63c150"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["positionDimension[]", "Subsection",ExpressionUUID->"7263b898-abdd-4b74-bf48-8401d5363cb9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dimension", "[", " ", 
   RowBox[{"position_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Length", "[", 
   RowBox[{"position", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dimension", "[", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Max", "[", 
    RowBox[{"Length", " ", "/@", " ", 
     RowBox[{"positions", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"sameVertexNumberQ", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"position_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "\[Equal]", " ", 
   RowBox[{"Length", "[", "position", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"sameVertexNumberQ", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], "}"}], ",", " ", 
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"Length", " ", "/@", " ", "positions"}], " ", ",", " ", 
      RowBox[{
       RowBox[{"#", "\[Equal]", "n"}], "&"}]}], " ", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameVertexNumberQ", "[", " ", 
    RowBox[{"m_", ",", " ", "Automatic"}], " ", "]"}], " ", ":=", " ", 
   "True"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"flatEnoughQ", "[", " ", 
   RowBox[{"position_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Chop", "[", " ", 
    RowBox[{"Max", "[", " ", 
     RowBox[{"Abs", "[", " ", 
      RowBox[{"position", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", "]"}], " ", "]"}], " ", 
    "]"}], " ", "\[Equal]", " ", "0"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flatEnoughQ", "[", " ", 
    RowBox[{"positions", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Chop", "[", " ", 
     RowBox[{"Max", "[", " ", 
      RowBox[{"Abs", "[", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "All", ",", "3"}], "]"}], "]"}], "]"}], " ", 
       "]"}], " ", "]"}], " ", "]"}], " ", "\[Equal]", " ", "0"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"recastDimension", "[", " ", 
   RowBox[{
    RowBox[{"position_", "?", "MatrixQ"}], " ", ",", " ", "dim_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"position", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Length", "[", "position", "]"}], ",", "dim"}], "}"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"recastDimension", "[", " ", 
   RowBox[{
    RowBox[{"position", ":", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", ",", " ", "dim_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"position", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Length", "[", "position", "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{"position", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "dim"}], "}"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4639]:=",ExpressionUUID->"987031ba-a53c-4f11-a7e4-bcab36c04d09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"positionDimension", "[", " ", 
    RowBox[{"m_", ",", " ", "Automatic", ",", " ", "dim_"}], " ", "]"}], ":=",
    "\n", "\t", 
   RowBox[{"Switch", "[", " ", 
    RowBox[{"dim", ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
         "3"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", 
         "2"}]}], ",", "\n", "\t\t\t\t", 
       RowBox[{"recastDimension", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "2"}], "]"}], ",",
        "\n", "\t\t\t\t", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", "\t\t\t", "]"}], 
     ",", "\n", "\t\t", "2", ",", " ", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
         "3"}], " ", "&&", " ", 
        RowBox[{"Not", "@", 
         RowBox[{"flatEnoughQ", "[", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"Mechanism", "::", "notflat"}], "]"}], ";", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t\t\t", 
       RowBox[{"recastDimension", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "2"}], "]"}]}], 
      "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", "3", ",", " ", 
     RowBox[{"recastDimension", "[", 
      RowBox[{
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "3"}], "]"}], ",", 
     "\n", "\t\t", "_", ",", " ", "$Failed"}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"positionDimension", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "VertexCoordinatesQ"}], "|", 
      RowBox[{"{", 
       RowBox[{"__", "?", "VertexCoordinatesQ"}], "}"}]}]}], ",", " ", 
    "dim_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"Switch", "[", " ", 
    RowBox[{"dim", ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t\t", 
     RowBox[{"recastDimension", "[", " ", 
      RowBox[{"positions", ",", " ", 
       RowBox[{"dimension", "[", "positions", "]"}]}], " ", "]"}], ",", "\n", 
     "\t\t", "2", ",", "\n", "\t\t\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"dimension", "[", "positions", "]"}], " ", "\[Equal]", " ", 
         "3"}], " ", "&&", " ", 
        RowBox[{"Not", "@", 
         RowBox[{"flatEnoughQ", "[", "positions", "]"}]}]}], ",", "\n", 
       "\t\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"Mechanism", "::", "notflat"}], "]"}], ";", "\n", "\t\t\t\t", 
        RowBox[{"recastDimension", "[", " ", 
         RowBox[{"positions", ",", " ", "3"}], "]"}]}], ",", "\n", "\t\t\t\t", 
       RowBox[{"recastDimension", "[", " ", 
        RowBox[{"positions", ",", " ", "2"}], "]"}]}], "\n", "\t\t\t", "]"}], 
     ",", "\n", "\t\t", "3", ",", " ", 
     RowBox[{"recastDimension", "[", " ", 
      RowBox[{"positions", ",", " ", "3"}], "]"}], ",", "\n", "\t\t", "_", 
     ",", " ", "$Failed"}], "\n", "\t", "]"}], " ", "/;", " ", 
   RowBox[{"sameVertexNumberQ", "[", " ", 
    RowBox[{"m", ",", " ", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"positionDimension", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "VertexCoordinatesQ"}], "|", 
      RowBox[{"{", 
       RowBox[{"__", "?", "VertexCoordinatesQ"}], "}"}]}]}], ",", " ", 
    "dim_"}], " ", "]"}], ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"Mechanism", "::", "vn"}], ",", " ", 
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "]"}], ";", " ",
     "$Failed"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4648]:=",ExpressionUUID->"4df19566-3b22-4178-9883-43f4afe6f65f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "notflat"}], " ", "=", " ", 
   "\"\<Cannot project a fully 3D Mechanism into 2D.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "vn"}], " ", "=", " ", 
   "\"\<Number of vertices `1` does not agree with number of vertex \
positions.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4651]:=",ExpressionUUID->"de3fa5c5-4fe7-44c1-9fce-7504364314cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismPrimitives[]", "Subsection",ExpressionUUID->"180e9407-b203-4d4a-b001-0e9302edeaaf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$themes", "=", 
    RowBox[{"{", 
     RowBox[{
     "Automatic", " ", ",", " ", "\"\<minimal\>\"", ",", " ", 
      "\"\<thick\>\""}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"themesQ", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], " ", ":=", " ", 
  "Automatic"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"themesQ", "[", 
    RowBox[{"m_", ",", "theme_"}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "theme", "]"}], "\[Equal]", "0"}]}], " ", ":=", 
  " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"MemberQ", "[", " ", 
      RowBox[{"$themes", ",", " ", "theme"}], " ", "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismPrimitives", "::", "theme"}], ",", " ", "theme"}], 
      "]"}], ";", " ", "Automatic"}], " ", ",", " ", "theme"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"themesQ", "[", 
    RowBox[{"m_", ",", " ", "theme_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"MemberQ", "[", " ", 
       RowBox[{"$themes", ",", " ", 
        RowBox[{"Head", "[", "theme", "]"}]}], " ", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismPrimitives", "::", "theme"}], ",", " ", "theme"}], 
       "]"}], ";", " ", "Automatic"}], " ", ",", " ", "theme"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "theme"}], "=", 
   "\"\<`1` is not a valid theme.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4653]:=",ExpressionUUID->"585395bf-edd0-4922-be90-cf3dd9378903"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismPrimitives", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<theme\>\"", "\[Rule]", "Automatic"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"positionDimension", "[", 
       RowBox[{"m", ",", " ", "Automatic", ",", " ", "dimension"}], "]"}]}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"mechanismPrimitivesInternal", "[", " ", 
      RowBox[{"m", ",", " ", "pos", ",", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
       RowBox[{"themesQ", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "\"\<theme\>\"", "]"}]}], "]"}]}], " ", 
      "]"}], " ", "/;", " ", 
     RowBox[{"pos", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "NumericCoordinatesQ"}], ",", " ", 
     RowBox[{"dimension", " ", ":", " ", 
      RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}],
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pos", "=", 
       RowBox[{"positionDimension", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", "dimension"}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"mechanismPrimitivesInternal", "[", " ", 
       RowBox[{"m", ",", " ", "pos", ",", " ", "positions", ",", " ", 
        RowBox[{"themesQ", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "\"\<theme\>\"", "]"}]}], "]"}]}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"pos", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "NumericCoordinatesQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismPrimitives", "::", "coord"}], ",", " ", 
     RowBox[{"Length", "[", "positions", "]"}], ",", " ", 
     RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "NumericCoordinatesQ"}], ",", " ", 
    "dimension_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismPrimitives", "::", "dim"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"dimension", " ", ":", " ", 
      RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}],
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"MechanismPrimitives", "::", "num"}], "]"}]}]}], "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "coord"}], " ", "=", " ", 
   "\"\<Number of vertices in second argument, `1`, does not match number of \
vertices in Mechanism, `2`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "dim"}], " ", "=", " ", 
   "\"\<Number of dimensions requested is not 2, 3, or Automatic.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "num"}], " ", "=", " ", 
   "\"\<Vertices should be numeric.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[4658]:=",ExpressionUUID->"475af5c7-e1c8-4503-81f4-44acaf834316"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"timingEcho", "[", " ", "c_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"AbsoluteTiming", "[", "c", "]"}]}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{"Echo", "[", 
      RowBox[{
       RowBox[{"result", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"Head", "[", "c", "]"}]}], "]"}], ";", " ", 
     RowBox[{"result", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"timingEcho", "[", " ", 
   RowBox[{"s_String", ",", " ", "c_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"result", " ", "=", " ", 
      RowBox[{"AbsoluteTiming", "[", "c", "]"}]}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{"Echo", "[", 
      RowBox[{
       RowBox[{"result", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", "s"}], "]"}], ";", " ", 
     RowBox[{"result", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"timingEcho", ",", "HoldAll"}], "]"}], ";"}]}], "Code",
 CellLabel->
  "In[4667]:=",ExpressionUUID->"b4cd628e-fce5-4143-87ec-c45d2ae6654a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPrimitivesInternal", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", " ", ",", " ", "actualPositions_", ",", " ",
      "theme_"}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Transpose", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"mechanismPrimitivesFromComponent", "[", " ", 
       RowBox[{
       "m", ",", " ", "positions", ",", " ", "#", " ", ",", " ", "theme"}], 
       "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"sortComponentsForGraphics", "[", " ", 
      RowBox[{"MechanismCellData", "[", " ", 
       RowBox[{"m", ",", " ", "actualPositions", ",", " ", "_"}], " ", "]"}], 
      " ", "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPrimitivesFromComponent", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"head_", "[", " ", "indices_", " ", "]"}], ",", " ", 
       "display_"}], " ", "]"}], " ", ",", " ", "theme_"}], "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"coordinates", " ", "=", " ", 
        RowBox[{"ToPackedArray", "[", 
         RowBox[{"N", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"positions", "[", 
             RowBox[{"[", " ", "#", " ", "]"}], "]"}], " ", "&"}], " ", "/@", 
           " ", "indices"}], "]"}], "]"}]}], ",", " ", "\n", "\t", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"ConstantArray", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", ",",
               " ", 
              RowBox[{"Length", "[", "indices", "]"}]}], "]"}], "}"}], ",", 
           " ", 
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Values", "[", " ", "display", " ", "]"}], ",", 
             RowBox[{"-", "3"}]}], "]"}]}], "]"}], " ", "]"}]}], ",", "\n", 
       "\t", 
       RowBox[{"style", " ", "=", " ", 
        RowBox[{"Mechanisms`Private`combineDataList", "[", " ", 
         RowBox[{
          RowBox[{"defaultGraphicsStyle", "[", 
           RowBox[{"head", ",", " ", 
            RowBox[{"Head", "[", "m", "]"}], ",", " ", "theme"}], "]"}], " ", 
          ",", 
          RowBox[{"display", "[", "\"\<Style\>\"", "]"}]}], "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{"display", "[", "\"\<Label\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"shapes", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"display", "[", "\"\<Shape\>\"", "]"}], " ", "/.", " ", 
          RowBox[{"{", 
           RowBox[{"Automatic", " ", "\[Rule]", " ", 
            RowBox[{"defaultGraphicsPrimitive", "[", 
             RowBox[{"head", ",", " ", 
              RowBox[{"Head", "[", "m", "]"}], ",", " ", "theme"}], "]"}]}], 
           "}"}]}], " ", "/.", " ", 
         RowBox[{"{", " ", 
          RowBox[{"None", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], " ", "}"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{"applyFunction", " ", ",", "\n", "\t\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{
          "shapes", ",", " ", "\n", "\t\t\t", "coordinates", ",", " ", "\n", 
           "\t\t\t", "data", ",", "\n", "\t\t\t", 
           RowBox[{"head", " ", "/@", " ", "indices"}], ",", "\n", "\t\t\t", 
           "style"}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}], ",", "\n",
        "\n", "\t\t", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{"applyLabel", ",", "\n", "\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{"MatrixQ", "[", "coordinates", "]"}], ",", " ", 
              "coordinates", ",", " ", 
              RowBox[{"Mean", " ", "/@", " ", "coordinates"}]}], " ", "]"}], 
            ",", "\n", "\t\t\t", "indices", ",", "\n", "\t\t\t", "labels"}], 
           "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}]}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"$textOffset", " ", "=", " ", "0.05"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", "None"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "label_", ",", " ", "\"\<Index\>\""}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"Text", "[", 
   RowBox[{"label", ",", " ", 
    RowBox[{"coordinates", " ", "+", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"$textOffset", ",", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", "lab_"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{"Text", "[", " ", 
    RowBox[{"lab", ",", " ", 
     RowBox[{"coordinates", " ", "+", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"$textOffset", ",", 
        RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}]}], " ", "]"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Head", "[", "lab", "]"}], " ", "=!=", " ", "Text"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"applyLabel", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
     RowBox[{"Text", "[", 
      RowBox[{"lab_", ",", " ", "coord_", ",", " ", "other___"}], "]"}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"Text", "[", " ", 
    RowBox[{"lab", ",", " ", 
     RowBox[{"coord", " ", "+", " ", "coordinates"}], ",", " ", "other"}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"applyFunction", "[", " ", 
   RowBox[{
   "None", ",", " ", "coordinates_", ",", " ", "primitive_", ",", " ", 
    "data_", ",", " ", "style_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"applyFunction", "[", " ", 
   RowBox[{
   "shapeFunction_", ",", " ", "coordinates_", ",", " ", "primitive_", ",", 
    " ", "data_", ",", " ", "style_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", " ", 
   RowBox[{"{", 
    RowBox[{"style", ",", " ", 
     RowBox[{"shapeFunction", "[", 
      RowBox[{"coordinates", ",", "primitive", ",", "data"}], "]"}]}], "}"}], 
   " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4670]:=",ExpressionUUID->"36d192d4-81bd-4706-ab71-98a7e1bbfd1e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sortComponentsForGraphics", "[", " ", "components_", " ", "]"}], ":=",
    "\n", "\t", 
   RowBox[{
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"DeleteCases", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"graphicsOrder", "[", 
             RowBox[{"Head", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], " ", ",", " ", 
            "#"}], " ", "}"}], "&"}], " ", "/@", " ", "components"}], ",", 
        "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"3", ",", "_"}], "}"}]}], "\n", "\t", "]"}], ",", "First"}], 
     "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"PinnedJoint", "|", "FreeJoint", "|", "Point"}], " ", "]"}], ":=", 
  "2"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"RigidBar", "|", "Spring", "|", "Line", "|", "TorsionalFold"}], 
   " ", "]"}], ":=", "1"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"Face", "|", "ElasticTriangle", "|", "Polygon"}], " ", "]"}], ":=",
   "0"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", "_", " ", "]"}], ":=", "3"}]}], "Code",
 CellLabel->
  "In[4679]:=",ExpressionUUID->"511a5fd5-e74f-4419-bf75-8c444440d319"]
}, Closed]],

Cell[CellGroupData[{

Cell["ToGraphicsComplex[]", "Subsection",ExpressionUUID->"999e6f09-3bf2-414c-b3fc-0ebce2164f6e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ToGraphicsComplex", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Options", "[", "GraphicsComplex", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"\"\<theme\>\"", "\[Rule]", "Automatic"}], "}"}]}], "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ToGraphicsComplex", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"res", "=", 
      RowBox[{"ToGraphicsComplexInternal", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"positionDimension", "[", 
         RowBox[{"m", ",", " ", "Automatic", ",", " ", "dimension"}], "]"}], 
        ",", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t", 
        "dimension", ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<theme\>\"", "]"}], ",", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", 
          RowBox[{"Options", "[", "GraphicsComplex", "]"}]}], "]"}]}], " ", 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ToGraphicsComplex", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"ToGraphicsComplexInternal", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"positionDimension", "[", 
          RowBox[{"m", ",", " ", "positions", ",", " ", "dimension"}], "]"}], 
         ",", " ", "positions", ",", " ", "\n", "\t", "dimension", ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<theme\>\"", "]"}], ",", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "GraphicsComplex", "]"}]}], "]"}]}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", " ", "]"}], " ", 
   "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "positions", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}]}]}], "Code",
 CellLabel->
  "In[4684]:=",ExpressionUUID->"4527b9b8-c59b-40fe-ac46-8b880e1d29af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"canonicalizePrimitiveRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"p", " ", ":", " ", 
        RowBox[{"_Polyhedron", "|", "_Parallelepiped", "|", "_Cuboid"}]}], 
       " ", "\[RuleDelayed]", " ", 
       RowBox[{"CanonicalizePolyhedron", "[", "p", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"p", " ", ":", " ", "_Polygon"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"CanonicalizePolygon", "[", "p", "]"}]}]}], "\n", "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"extractVertexCoordinates", "[", "primitives_", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"DeleteDuplicates", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{"Cases", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", "primitives", "]"}], " ", ",", 
        RowBox[{
         RowBox[{"_", "?", "RegionQ"}], "|", "_Text"}]}], "]"}], " ", "/.", 
      " ", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"p_Polygon", " ", "\[RuleDelayed]", " ", 
         RowBox[{"(", 
          RowBox[{"Point", " ", "/@", " ", 
           RowBox[{"PolygonCoordinates", "[", "p", "]"}]}], ")"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"p_Polyhedron", " ", "\[RuleDelayed]", " ", 
         RowBox[{"(", 
          RowBox[{"Point", " ", "/@", " ", 
           RowBox[{"PolyhedronCoordinates", "[", "p", "]"}]}], ")"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"p_", " ", "/;", " ", 
           RowBox[{"RegionQ", "[", "p", "]"}]}], ")"}], " ", "\[RuleDelayed]",
          " ", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"Dimensions", "[", " ", 
              RowBox[{"p", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}], " ", 
            "\[Equal]", " ", "1"}], ",", " ", 
           RowBox[{"Point", "[", 
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
           RowBox[{"Point", "/@", 
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}], ",", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"_", ",", "p_", ",", "___"}], "]"}], " ", "\[RuleDelayed]", 
         " ", 
         RowBox[{"Point", "[", "p", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"_", ",", "x_", ",", "y_", ",", "___"}], "]"}], " ", 
         "\[RuleDelayed]", " ", 
         RowBox[{"Point", "[", 
          RowBox[{"x", "+", "y"}], "]"}]}]}], "\n", "\t", "}"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4687]:=",ExpressionUUID->"f4924735-3c86-45f4-9002-8e27c84aebac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToGraphicsComplexInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "actualPositions_", ",", " ", 
    "dimension_", ",", " ", "theme_", ",", " ", "options_"}], " ", "]"}], " ",
   ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "prims", ",", " ", "modifiedPrimitives", ",", " ", "coordinates", ",", 
      " ", "coordinateRules", ",", " ", "x"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"prims", " ", "=", " ", 
      RowBox[{
       RowBox[{"MechanismPrimitivesInternal", "[", 
        RowBox[{
        "m", " ", ",", " ", "positions", ",", " ", "actualPositions", " ", 
         ",", " ", 
         RowBox[{"themesQ", "[", 
          RowBox[{"m", ",", "theme"}], "]"}]}], " ", "]"}], " ", "/.", " ", 
       "canonicalizePrimitiveRules"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "prims", "]"}], " ", "===", " ", 
        "MechanismPrimitives"}], ",", "\n", "\t\t", "$Failed", ",", "\n", 
       "\n", "\t\t", 
       RowBox[{
        RowBox[{"coordinates", "=", 
         RowBox[{"extractVertexCoordinates", "[", "prims", "]"}]}], ";", "\n",
         "\t\t", 
        RowBox[{"coordinateRules", " ", "=", " ", 
         RowBox[{"Dispatch", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{"coordinates", " ", "\[Rule]", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "coordinates", "]"}], "]"}]}], "]"}], 
          "]"}]}], ";", "\n", "\n", "\t\t", 
        RowBox[{"modifiedPrimitives", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"prims", " ", "/.", " ", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Polygon", "[", 
                RowBox[{"x_", ",", "y_"}], "]"}], " ", "\[RuleDelayed]", " ", 
               
               RowBox[{"Polygon", "[", " ", 
                RowBox[{"x", "[", 
                 RowBox[{"[", "y", "]"}], "]"}], "  ", "]"}]}], ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Polyhedron", "[", 
                RowBox[{"x_", ",", "y_"}], "]"}], " ", "\[RuleDelayed]", " ", 
               
               RowBox[{"Polyhedron", "[", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"x", "[", 
                   RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "y"}], " ", 
                "]"}]}]}], "\n", "\t\t", "}"}]}], " ", "/.", " ", 
           "coordinateRules"}], " ", "/.", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"CanonicalizePolyhedron", "[", 
              RowBox[{"Polyhedron", "[", "x_", "]"}], "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Polyhedron", "[", "x", "]"}]}], ",", 
            RowBox[{
             RowBox[{"CanonicalizePolygon", "[", 
              RowBox[{"Polygon", "[", "x_", "]"}], "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Polygon", "[", "x", "]"}]}]}], "}"}]}]}], ";", "\n", 
        "\n", "\t\t", 
        RowBox[{"GraphicsComplex", "[", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{
         "coordinates", ",", "\n", "\t\t\t", "modifiedPrimitives", ",", "\n", 
          "\t\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", " ", 
            RowBox[{"options", ",", 
             RowBox[{
             "VertexTextureCoordinates", " ", "\[Rule]", " ", 
              "coordinates"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", 
         "\t\t", "]"}]}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[4689]:=",ExpressionUUID->"e79c1415-df48-46af-8022-f0d3c2db1b85"]
}, Closed]],

Cell[CellGroupData[{

Cell["OrigamiTexture[], $OrigamiTextures", "Subsection",ExpressionUUID->"9b4913e6-0b4a-4a08-b7bd-200f6bcf7b03"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$OrigamiTextures", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
     "\"\<WhitePaper\>\"", ",", " ", "\"\<GrayPaper\>\"", ",", " ", 
      "\"\<WrinkledPaper\>\""}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$dataDirectory", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{"PacletFind", "[", "\"\<Mechanisms\>\"", "]"}]}], ")"}], 
        "[", "\"\<Location\>\"", "]"}], ",", "\"\<Resources\>\"", ",", 
       "\"\<Textures\>\""}], "}"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", "=", 
   " ", 
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<crinkled-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "\"\<WhitePaper\>\"", "]"}], " ", ":=", " ", 
  
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<WhitePaper\>\"", "]"}], " ", "=", " ", 
   
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<white-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<GrayPaper\>\"", "]"}], " ", ":=", " ", 
   
   RowBox[{
    RowBox[{"OrigamiTexture", "[", "\"\<GrayPaper\>\"", "]"}], " ", "=", " ", 
    
    RowBox[{"Texture", " ", "@", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"Import", "[", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"$dataDirectory", ",", "\"\<blue-paper.jpeg\>\""}], "}"}], 
        "]"}], "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "::", "bad"}], "=", 
   "\"\<Unrecognized texture `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "s_", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"OrigamiTexture", "::", "bad"}], ",", " ", "s"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[4690]:=",ExpressionUUID->"d1ae3a0e-0030-4f1a-8eb0-962b8b6b9f9a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics elements", "Section",ExpressionUUID->"efa38391-2c04-4250-a9ce-7f700dc2e797"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"coordinate2D", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "?", "NumericQ"}], ",", " ", 
     RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinate3D", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "?", "NumericQ"}], ",", 
     RowBox[{"_", "?", "NumericQ"}], ",", 
     RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"meshAccessQ", "=", 
   RowBox[{"_Integer", "|", 
    RowBox[{"{", "__Integer", "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"plotAccessQ", "=", 
   RowBox[{"_Line", "|", "_Point", "|", "_Polygon"}]}], ";"}]}], "Code",
 CellLabel->
  "In[4697]:=",ExpressionUUID->"c7b53360-ca73-4d43-a302-859f8055c0aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"coordinate2DQ", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "#", "]"}], "==", "2"}]}], "&"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinate3DQ", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "#", "]"}], "==", "3"}]}], "&"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4701]:=",ExpressionUUID->"5f25bd59-6819-41cd-a8e4-4edaba4dea77"],

Cell[CellGroupData[{

Cell["RigidBarShape[]", "Subsection",ExpressionUUID->"30beb824-411a-4da9-84d9-c2ad57b065a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RigidBarShape", "]"}], " ", "=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Width\>\"", " ", "\[Rule]", " ", "0.03"}], ",", "\n", "\t", 
     
     RowBox[{"\"\<AspectRatio\>\"", " ", "\[Rule]", " ", "0.5"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.025"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<StartOffset\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<EndOffset\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<HeightOffset\>\"", " ", "\[Rule]", " ", "0"}]}], "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[4703]:=",ExpressionUUID->"00471e94-dc32-4777-a8a8-0f8d241e12c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"embedded", " ", "in", " ", "2", "D"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"RigidBarShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x_", "?", "coordinate2DQ"}], ",", " ", 
       RowBox[{"y_", "?", "coordinate2DQ"}]}], "}"}], ",", " ", "_", " ", ",",
      " ", 
     RowBox[{"_RigidBar", "|", "_Line"}]}], " ", "]"}], " ", ":=", " ", "\n", 
   
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"length", " ", "=", " ", 
        RowBox[{"Norm", "[", 
         RowBox[{"y", "-", "x"}], "]"}]}], ",", " ", 
       RowBox[{"dir", " ", "=", " ", 
        RowBox[{"Normalize", "[", 
         RowBox[{"y", "-", "x"}], "]"}]}], " ", ",", " ", 
       RowBox[{"width", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}]}], "}"}], ",", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"normal", " ", "=", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], " ", ".", " ", 
          "dir"}]}], " ", "}"}], ",", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"length", ">", "0"}], ",", "\n", "\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Polygon", "[", " ", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"x", " ", "-", " ", 
               RowBox[{"width", "*", 
                RowBox[{"normal", "/", "2"}]}]}], ",", " ", 
              RowBox[{"x", "+", 
               RowBox[{"width", "*", 
                RowBox[{"normal", "/", "2"}]}]}], ",", " ", 
              RowBox[{"y", "+", 
               RowBox[{"width", "*", 
                RowBox[{"normal", "/", "2"}]}]}], ",", " ", 
              RowBox[{"y", "-", 
               RowBox[{"width", "*", 
                RowBox[{"normal", "/", "2"}]}]}]}], " ", "}"}], " ", "]"}], 
           ",", "\n", "\t\t\t", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "If", " ", "we", " ", "wanted", " ", "hemidisks", " ", 
              "instead"}], ",", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"we", " ", "would", " ", "do", " ", "this"}], "..."}], 
              "\n", "\t\t\t\t\t", 
              RowBox[{"Disk", "[", " ", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}], " ", ",", " ", 
                RowBox[{"width", "/", "2"}], ",", " ", 
                RowBox[{"{", " ", 
                 RowBox[{
                  RowBox[{"Pi", "/", "2"}], ",", " ", 
                  RowBox[{"3", " ", 
                   RowBox[{"Pi", "/", "2"}]}]}], " ", "}"}]}], "  ", "]"}]}], 
             ",", "\n", "\t\t\t\t\t", 
             RowBox[{"Disk", "[", " ", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"length", ",", "0"}], "}"}], " ", ",", " ", 
               RowBox[{"width", "/", "2"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "Pi"}], "/", "2"}], ",", " ", 
                 RowBox[{"Pi", "/", "2"}]}], "}"}]}], " ", "]"}]}], "\n", 
            "\t\t\t", "*)"}], "\n", "\t\t\t", 
           RowBox[{"Disk", "[", 
            RowBox[{"x", ",", " ", 
             RowBox[{"width", "/", "2"}]}], "]"}], ",", "\n", "\t\t\t", 
           RowBox[{"Disk", "[", 
            RowBox[{"y", ",", 
             RowBox[{"width", "/", "2"}]}], "]"}]}], "\n", "\t\t", "}"}], ",",
          "\n", "\t\t", 
         RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
    "]"}]}]}]], "Code",
 CellLabel->
  "In[4704]:=",ExpressionUUID->"cbd3095b-7fe0-47d2-a263-99ca355abc1e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"startsWith3Q", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "==", "3"}], "&"}], ")"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"startsWith2Q", "=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "==", "2"}], "&"}], ")"}]}], ";"}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"embedded", " ", "in", " ", "3", "D"}], ",", " ", 
    RowBox[{"plotted", " ", "in", " ", "3", "D"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RigidBarShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"x_", "?", "coordinate3DQ"}], ",", " ", 
      RowBox[{"y_", "?", "coordinate3DQ"}]}], "}"}], ",", " ", 
    RowBox[{"_", "?", "startsWith3Q"}], ",", " ", "_RigidBar"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"Tube", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}], ",", " ", 
    RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], " ", "]"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RigidBarShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x_", "?", "coordinate3DQ"}], ",", " ", 
       RowBox[{"y_", "?", "coordinate3DQ"}]}], "}"}], " ", ",", " ", "_", ",",
      " ", "_Line"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Tube", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}], ",", " ", 
     RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], " ", "]"}]}], "\n",
   "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"embedded", " ", "in", " ", "2", "D"}], ",", " ", 
    RowBox[{"plotted", " ", "in", " ", "3", "D"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RigidBarShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"x_", "?", "coordinate3DQ"}], ",", " ", 
      RowBox[{"y_", "?", "coordinate3DQ"}]}], "}"}], ",", " ", 
    RowBox[{"_", "?", "startsWith2Q"}], ",", " ", "_RigidBar"}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"length", " ", "=", " ", 
       RowBox[{"Norm", "[", " ", 
        RowBox[{"y", "-", "x"}], " ", "]"}]}], ",", " ", 
      RowBox[{"dir", " ", "=", " ", 
       RowBox[{"Normalize", "[", 
        RowBox[{"y", "-", "x"}], "]"}]}], ",", 
      RowBox[{"width", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], ",", " ", 
      RowBox[{"shift1", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<StartOffset\>\"", "]"}]}], ",", " ", 
      RowBox[{"shift2", "=", 
       RowBox[{"OptionValue", "[", "\"\<EndOffset\>\"", "]"}]}], ",", " ", 
      RowBox[{"thickness", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], ",", " ", 
      RowBox[{"off", "=", 
       RowBox[{"OptionValue", "[", "\"\<HeightOffset\>\"", "]"}]}]}], " ", 
     "}"}], ",", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"x1", "=", 
         RowBox[{"x", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"y1", "=", 
         RowBox[{"x", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", 
        RowBox[{"x2", "=", 
         RowBox[{"y", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"y2", "=", 
         RowBox[{"y", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"EdgeForm", "[", "None", "]"}], ",", "\n", "\t", 
        RowBox[{"Parallelepiped", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x1", "+", " ", 
             RowBox[{"shift1", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "x1"}], "+", "x2"}], ")"}]}], "+", 
             FractionBox[
              RowBox[{"width", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "y1"}], "+", "y2"}], ")"}]}], 
              RowBox[{"2", " ", "length"}]]}], ",", 
            RowBox[{"y1", "+", 
             FractionBox[
              RowBox[{"width", " ", 
               RowBox[{"(", 
                RowBox[{"x1", "-", "x2"}], ")"}]}], 
              RowBox[{"2", " ", "length"}]], "-", " ", 
             RowBox[{"shift1", " ", 
              RowBox[{"(", 
               RowBox[{"y1", "-", "y2"}], ")"}]}]}], ",", 
            RowBox[{"off", "-", 
             FractionBox["thickness", "2"]}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "1"}], "+", "shift1", "+", "shift2"}], ")"}], 
               " ", 
               RowBox[{"(", 
                RowBox[{"x1", "-", "x2"}], ")"}]}], ",", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "1"}], "+", "shift1", "+", "shift2"}], ")"}], 
               " ", 
               RowBox[{"(", 
                RowBox[{"y1", "-", "y2"}], ")"}]}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              FractionBox[
               RowBox[{"width", " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}]}], "length"], ",", 
              FractionBox[
               RowBox[{"width", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "x1"}], "+", "x2"}], ")"}]}], "length"], ",", 
              "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "thickness"}], "}"}]}], "}"}]}], 
         "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[4705]:=",ExpressionUUID->"29f39365-7b52-4650-bc5f-963e58ea8fee"]
}, Closed]],

Cell[CellGroupData[{

Cell["freeJointShape[]", "Subsection",ExpressionUUID->"df9a98e6-583c-4e1c-9c5e-9329e90e0833"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "freeJointShape", "]"}], " ", "=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.025"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.026"}]}], "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[4710]:=",ExpressionUUID->"3198f40c-a3af-4947-b0c8-cbc49f1ca5e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", "_", ",", " ", 
    "_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"circleRadius", " ", "=", " ", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
     "}"}], ",", " ", 
    RowBox[{"Disk", "[", 
     RowBox[{"x", ",", " ", "circleRadius"}], "]"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[4711]:=",ExpressionUUID->"d5b36931-6876-4fc2-b980-03428a6a3ff4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"2", ",", "___"}], "}"}], ",", " ", "_FreeJoint"}], "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"circleRadius", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
      " ", ",", " ", 
      RowBox[{"thickness", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}]}], "}"}], ",",
     "\n", "\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
      RowBox[{"Cylinder", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", " ", "-", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"thickness", "/", "2"}]}], "}"}]}], ",", 
          RowBox[{"x", "+", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", 
             RowBox[{"thickness", "/", "2"}]}], "}"}]}]}], "}"}], ",", " ", 
        "circleRadius"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"freeJointShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"3", ",", "___"}], "}"}], " ", ",", " ", "_"}], " ", "]"}], " ",
    ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"sphereRadius", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
      "}"}], ",", " ", 
     RowBox[{"Sphere", "[", " ", 
      RowBox[{"x", ",", " ", "sphereRadius"}], "]"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"0", ",", "_"}], "}"}], " ", ",", " ", "_Point"}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sphereRadius", " ", "=", " ", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
     "}"}], ",", " ", 
    RowBox[{"Sphere", "[", " ", 
     RowBox[{"x", ",", " ", "sphereRadius"}], "]"}]}], " ", "]"}]}]}], "Code",\

 CellLabel->
  "In[4712]:=",ExpressionUUID->"cdcda5f5-532c-463b-899d-7293e5112f81"]
}, Closed]],

Cell[CellGroupData[{

Cell["PinnedJointShape[]", "Subsection",ExpressionUUID->"530308ab-a7d1-4a5c-86d3-f3a59af21d94"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PinnedJointShape", "]"}], " ", "=", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.05"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.027"}]}], "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[4715]:=",ExpressionUUID->"3a0274b7-99dd-44b8-a623-57f7847ae21b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pt", " ", ":", " ", "coordinate2D"}], ",", " ", "_", ",", "_"}], 
   "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"circleRadius", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "5"}]}], 
      ",", " ", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"pt", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
      RowBox[{"y", " ", "=", " ", 
       RowBox[{"pt", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
      RowBox[{"angle", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Angle\>\"", "]"}]}], ",", " ", 
      RowBox[{"size", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"mat", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Cos", "[", "angle", "]"}], ",", 
             RowBox[{"-", 
              RowBox[{"Sin", "[", "angle", "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Sin", "[", "angle", "]"}], ",", 
             RowBox[{"Cos", "[", "angle", "]"}]}], "}"}]}], "}"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"translation1", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], ",", "4"}], "]"}]}], ",", " ", 
        RowBox[{"translation2", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], ",", "2"}], "]"}]}]}], "\n", "\t",
        "}"}], ",", "\[IndentingNewLine]", "\t\t", 
      RowBox[{"{", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Circle", "[", " ", 
         RowBox[{"pt", " ", ",", " ", "circleRadius"}], "]"}], ",", "\n", 
        "\t\t\t", 
        RowBox[{"Line", "[", 
         RowBox[{"translation1", " ", "+", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"0", "-", "circleRadius"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "-", "size"}], ",", 
               RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
             
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "+", "size"}], ",", 
               RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
             
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"0", "-", "circleRadius"}]}], "}"}]}], "}"}], " ", ".",
            " ", "mat"}]}], "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"Line", "[", 
         RowBox[{"translation2", " ", "+", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "-", 
                RowBox[{"2", " ", "size"}]}], ",", 
               RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
             
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "+", 
                RowBox[{"2", " ", "size"}]}], ",", " ", 
               RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}]}], 
            "}"}], " ", ".", " ", "mat"}]}], "]"}]}], "\n", "\t\t", "}"}]}], 
     "\n", "\t", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellLabel->
  "In[4716]:=",ExpressionUUID->"a0387762-529b-4db0-94ff-175060d25b6c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PinnedJointShape", "[", 
     RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"2", ",", "___"}], "}"}], ",", " ", 
     RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"circleRadius", " ", "=", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], " ", "+", " ",
          "0.02"}]}], " ", ",", " ", 
       RowBox[{"thickness", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"EdgeForm", "[", "None", "]"}], ",", "\n", "\t", 
       RowBox[{"Cylinder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", " ", "-", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"thickness", "/", "2"}]}], "}"}]}], ",", 
           RowBox[{"x", "+", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"thickness", "/", "2"}]}], "}"}]}]}], "}"}], ",", " ", 
         RowBox[{"circleRadius", "/", "2"}]}], "]"}], ",", "\n", "\t", 
       RowBox[{"Cylinder", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", " ", "-", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"2", " ", "thickness"}]}], "}"}]}], ",", 
           RowBox[{"x", " ", "-", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"thickness", "/", "2"}]}], "}"}]}]}], " ", "}"}], ",", 
         " ", 
         RowBox[{"circleRadius", "/", "4"}]}], "]"}]}], "\n", "\t", "}"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
   RowBox[{
    RowBox[{"pt", " ", ":", " ", "coordinate3D"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"3", ",", "___"}], "}"}], ",", "  ", 
    RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], " ", "]"}], ":=", " ", 
  RowBox[{"Sphere", "[", 
   RowBox[{"pt", ",", 
    RowBox[{
     RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
   RowBox[{
    RowBox[{"pt", " ", ":", " ", "coordinate3D"}], ",", " ", "_", " ", ",", 
    " ", "_Point"}], " ", "]"}], ":=", " ", 
  RowBox[{"Sphere", "[", 
   RowBox[{"pt", ",", 
    RowBox[{
     RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[4717]:=",ExpressionUUID->"7d80a007-6464-43b3-9ff2-00f8fc73da18"]
}, Closed]],

Cell[CellGroupData[{

Cell["FreeJointShape[]", "Subsection",ExpressionUUID->"616abae0-499a-42ac-9be1-54c477240393"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "FreeJointShape", "]"}], " ", "=", "\n", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.01"}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", "\t", 
      RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.026"}]}], "\n", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", 
    RowBox[{"a", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "Infinity", ",", " ", "___"}], " ", "}"}]}], " ",
     ",", " ", 
    RowBox[{"b", " ", ":", " ", 
     RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"PinnedJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "PinnedJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "a", ",", "b"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FreeJointShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"a", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"_", ",", " ", "Infinity", ",", " ", "___"}], " ", "}"}]}], 
     " ", ",", " ", 
     RowBox[{"b", " ", ":", " ", 
      RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}]}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"PinnedJointShape", "[", " ", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "PinnedJointShape", "]"}]}], "]"}], " ", "]"}],
     "[", 
    RowBox[{"x", ",", "a", ",", "b"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", 
    RowBox[{"a", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "___"}], " ", "}"}]}], " ", ",", " ", 
    RowBox[{"b", " ", ":", " ", 
     RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "freeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "a", ",", "b"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FreeJointShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"a", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"_", ",", " ", "___"}], " ", "}"}]}], " ", ",", " ", 
     RowBox[{"b", " ", ":", " ", 
      RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}]}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"freeJointShape", "[", " ", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "freeJointShape", "]"}]}], "]"}], " ", "]"}], 
    "[", 
    RowBox[{"x", ",", "a", ",", "b"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", "a_", ",", " ", 
    "b_Point"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "freeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "a", ",", "b"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", "a_", ",", " ", 
    "b_Point"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"freeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "freeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "a", ",", "b"}], "]"}]}]}], "Code",
 CellLabel->
  "In[4720]:=",ExpressionUUID->"f42eb97c-a4fa-4783-8190-ace6cf11e7a8"]
}, Closed]],

Cell[CellGroupData[{

Cell["SpringShape[]", "Subsection",ExpressionUUID->"21ae16eb-fe33-4b07-a637-3a56dfc61929"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "SpringShape", "]"}], " ", "=", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Width\>\"", " ", "\[Rule]", " ", "0.005"}], ",", "\n", "\t", 
     RowBox[{"\"\<number\>\"", " ", "\[Rule]", " ", "10"}], ",", "\n", "\t", 
     RowBox[{"\"\<resolution\>\"", " ", "\[Rule]", " ", "26"}]}], "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[4727]:=",ExpressionUUID->"0523084d-4d4b-4a9e-8f47-5ce789825232"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"x_", "?", "coordinate2DQ"}], ",", " ", 
      RowBox[{"y_", "?", "coordinate2DQ"}]}], " ", "}"}], ",", " ", "_", ",", 
    " ", "_"}], " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", "\n", 
     RowBox[{
      RowBox[{"length", " ", "=", " ", 
       RowBox[{"Norm", "[", 
        RowBox[{"y", "-", "x"}], "]"}]}], ",", " ", "\n", 
      RowBox[{"width", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], ",", " ", "\n", 
      RowBox[{"period", " ", "=", " ", 
       RowBox[{"2", " ", 
        RowBox[{"OptionValue", "[", "\"\<number\>\"", "]"}]}]}], ",", " ", 
      "\n", 
      RowBox[{"nPoints", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<resolution\>\"", "]"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<number\>\"", "]"}]}], "]"}]}], ",", 
      "\n", 
      RowBox[{"rotMat", " ", "=", " ", 
       RowBox[{"RotationMatrix", "[", " ", 
        RowBox[{"N", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"y", "-", "x"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}], " ", "]"}]}]}], 
     "\n", "}"}], ",", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"delta", " ", "=", " ", 
        RowBox[{"N", "[", 
         RowBox[{"length", "/", "nPoints"}], "]"}]}], "}"}], ",", "\n", "\t", 
      
      RowBox[{"BezierCurve", "[", "\n", "\t\t", 
       RowBox[{"N", "@", 
        RowBox[{"Join", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"{", "x", "}"}], ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"x", ",", 
             RowBox[{"nPoints", "-", "3"}]}], "]"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "\n", "\t\t\t\t", 
                RowBox[{
                 RowBox[{"#", " ", "+", " ", 
                  RowBox[{"width", " ", 
                   RowBox[{"Cos", "[", " ", 
                    RowBox[{"period", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], " ", "]"}]}]}], ",", "\n",
                  "\t\t\t\t", 
                 RowBox[{"width", " ", 
                  RowBox[{"Sin", "[", " ", 
                   RowBox[{"period", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], " ", "]"}]}]}], "\n", 
                "\t\t\t\t", "}"}], "&"}], " ", "/@", " ", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"2", " ", "delta"}], ",", " ", 
                RowBox[{"length", " ", "-", " ", 
                 RowBox[{"2", " ", "delta"}]}], ",", " ", "delta"}], "]"}]}], 
             ")"}], " ", ".", " ", "rotMat"}]}], ",", "\n", "\t\t\t", 
          RowBox[{"{", "y", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
       "]"}]}], "\n", "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[4728]:=",ExpressionUUID->"deeff8cc-8a0f-4967-8ab0-c5317f85b6a6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
      RowBox[{"y", " ", ":", " ", "coordinate3D"}]}], "}"}], ",", " ", "_", 
    ",", " ", "_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"rotMat", " ", "=", " ", 
       RowBox[{"RotationMatrix", "[", 
        RowBox[{"N", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"x", "-", "y"}]}], "}"}], "]"}], "]"}]}], ",", "\n", 
      RowBox[{"length", "=", 
       RowBox[{"Norm", "[", " ", 
        RowBox[{"y", "-", "x"}], " ", "]"}]}], ",", " ", "\n", 
      RowBox[{"numPoints", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<resolution\>\"", "]"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<number\>\"", "]"}]}], "]"}]}], ",", 
      " ", "\n", 
      RowBox[{"number", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<number\>\"", "]"}]}], ",", "\n", 
      RowBox[{"thickness", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}], "/", "2"}]}]}], 
     "\n", "}"}], ",", " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"delta", " ", "=", " ", 
        RowBox[{"N", "[", 
         RowBox[{"length", "/", "numPoints"}], "]"}]}], " ", "}"}], ",", "\n",
       "\t", 
      RowBox[{"BezierCurve", "[", "\n", "\t\t", 
       RowBox[{"N", "@", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", "x", "}"}], ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{"ConstantArray", "[", 
            RowBox[{"x", ",", 
             RowBox[{"numPoints", "-", "3"}]}], "]"}], " ", "+", " ", 
           RowBox[{
            RowBox[{"(", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"{", " ", 
                RowBox[{
                 RowBox[{"thickness", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"number", " ", "2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], "]"}]}], ",", 
                 RowBox[{"thickness", " ", 
                  RowBox[{"Sin", "[", 
                   RowBox[{"number", " ", "2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], "]"}]}], ",", " ", "#"}], 
                " ", "}"}], "&"}], " ", "/@", " ", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"2", " ", "delta"}], ",", 
                RowBox[{"length", "-", 
                 RowBox[{"2", " ", "delta"}]}], ",", "delta"}], "]"}]}], "\n",
              "\t\t", ")"}], " ", ".", " ", "rotMat"}]}], ",", "\n", "\t\t", 
          RowBox[{"{", "y", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
       "]"}]}], "\n", "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[4729]:=",ExpressionUUID->"b0a2f514-7a30-4fc7-9f56-23c511b2ec1b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FaceShape[]", "Subsection",ExpressionUUID->"a7a35632-47d0-4342-be07-daf07f198317"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FaceShape", "]"}], " ", "=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0"}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4730]:=",ExpressionUUID->"e55e08fa-9d58-42bc-abfc-669219f4ba55"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"coordinate2D", ".."}], "}"}]}], ",", " ", "_", ",", " ", 
     "_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Polygon", "[", " ", "x", " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"coordinate3D", ".."}], "}"}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"2", "|", "3"}], ",", " ", "___"}], " ", "}"}], " ", ",", " ", 
     
     RowBox[{"_Face", "|", "_ElasticTriangle"}]}], " ", "]"}], " ", ":=", " ",
    "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], " ", "\[Equal]",
       " ", "0"}], ",", "\n", "\t\t", 
     RowBox[{"Polygon", "[", " ", "x", " ", "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"ExtrudedPolygon", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], ",", " ", 
         
         RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], "}"}], 
       "]"}], "[", "x", "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"coordinate3D", ".."}], "}"}]}], ",", " ", "_", ",", " ", 
    "_Polygon"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Polygon", "[", " ", "x", " ", "]"}]}]}], "Code",
 CellLabel->
  "In[4731]:=",ExpressionUUID->"7befbc49-c359-459d-b8be-4c03a3cd4cbc"]
}, Closed]],

Cell[CellGroupData[{

Cell["AngleMarker[], AngleText[]", "Subsection",ExpressionUUID->"a4787621-3d48-4ae3-bf4b-6c35d714056b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleText", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"label_", " ", ":", " ", "\"\<\>\""}], ",", 
    RowBox[{"distance", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", "0"}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"angleLocation", "=", 
       RowBox[{
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"v2", ",", 
          RowBox[{"1", ";;", 
           RowBox[{"MechanismDisplayDimension", "[", "m", "]"}]}]}], "]"}], 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"vectors", "=", 
       RowBox[{"-", 
        RowBox[{
         RowBox[{"DisplacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v3", ",", "v2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v1", ",", "v2"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", 
            RowBox[{"MechanismDisplayDimension", "[", "m", "]"}]}]}], "]"}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Text", "[", 
     RowBox[{"label", ",", 
      RowBox[{"angleLocation", " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"distance", "+", "0.12"}], ")"}], " ", 
        RowBox[{"Mean", "[", "vectors", "]"}]}]}]}], "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4734]:=",ExpressionUUID->"321114ce-c1c2-4259-8f91-54d2a33d7886"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
         " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
       "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"v2", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{
         RowBox[{"DisplacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v2", ",", "v1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Circle", "[", 
      RowBox[{"angleLocation", ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Abs", "[", "radius", "]"}], " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "<", 
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"2", "Pi"}]}], "}"}], "+", "#"}], ",", "#"}], "]"}], 
          "&"}], ")"}], "[", 
        RowBox[{"ArcTan", "@@@", "vectors"}], "]"}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", "2"}], 
    " ", "&&", " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "In[4735]:=",ExpressionUUID->"521bc9c5-de42-41dd-9770-013f3407e73d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Code", " ", "borrowed", " ", "from", " ", 
     RowBox[{"https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "10957"}], "/", "an"}], "-", "efficient", "-", 
     "circular", "-", "arc", "-", "primitive", "-", "for", "-", 
     "graphics3d"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "splineCircle2", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"splineCircle", "[", 
     RowBox[{"m_List", ",", " ", "r_", ",", " ", 
      RowBox[{"angles_List", ":", " ", 
       RowBox[{"{", 
        RowBox[{"0.", ",", " ", 
         RowBox[{"2.", " ", "\[Pi]"}]}], "}"}]}]}], "]"}], " ", ":=", " ", 
    "\n", " ", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "seg", ",", " ", "\[Phi]", ",", " ", "start", ",", " ", "end", ",", 
         " ", "pts", ",", " ", "w", ",", " ", "k", ",", " ", "pihalf"}], 
        "}"}], ",", "\n", "   ", 
       RowBox[{
        RowBox[{"pihalf", " ", "=", " ", 
         RowBox[{"0.5", " ", "\[Pi]"}]}], ";", "\n", "   ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"start", ",", " ", "end"}], "}"}], " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", "angles", "]"}], ",", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"end", " ", "<=", " ", "start"}], ",", " ", 
          RowBox[{"end", " ", "+=", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}]}], "]"}], ";", "\n", "   ", 
        RowBox[{"seg", " ", "=", " ", 
         RowBox[{"Quotient", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"\[Phi]", " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"seg", " ", "==", " ", "4"}], ",", " ", 
          RowBox[{
           RowBox[{"seg", " ", "=", " ", "3"}], ";", " ", 
           RowBox[{"\[Phi]", " ", "=", " ", "pihalf"}]}]}], "]"}], ";", "\n", 
        "   ", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "     ", 
           RowBox[{
            RowBox[{"cseg", " ", "=", " ", 
             RowBox[{"Cos", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", " ", 
            RowBox[{"sseg", " ", "=", " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"c\[Phi]", " ", "=", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ",", " ", 
            RowBox[{"s\[Phi]", " ", "=", " ", 
             RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", " ", "\n", "     ", 
            RowBox[{"t\[Phi]", " ", "=", " ", 
             RowBox[{"Tan", "[", 
              RowBox[{"0.5", " ", "\[Phi]"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"rcs", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Cos", "[", "start", "]"}]}]}], ",", " ", 
            RowBox[{"rss", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Sin", "[", "start", "]"}]}]}]}], "\n", "     ", "}"}], 
          ",", "\n", "    ", 
          RowBox[{"pts", " ", "=", " ", 
           RowBox[{
            RowBox[{"Join", "[", "\n", "       ", 
             RowBox[{
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}]}], "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], 
              ",", "\n", "       ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"cseg", " ", "-", " ", 
                   RowBox[{"sseg", " ", "t\[Phi]"}]}], ",", " ", 
                  RowBox[{"sseg", " ", "+", " ", 
                   RowBox[{"cseg", " ", "t\[Phi]"}]}]}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cseg", " ", "c\[Phi]"}], " ", "-", " ", 
                   RowBox[{"sseg", " ", "s\[Phi]"}]}], ",", " ", 
                  RowBox[{
                   RowBox[{"c\[Phi]", " ", "sseg"}], " ", "+", " ", 
                   RowBox[{"cseg", " ", "s\[Phi]"}]}]}], "}"}]}], "}"}]}], 
             "\n", "       ", "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"rcs", ",", " ", "rss"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "rss"}], ",", " ", "rcs"}], "}"}]}], "}"}]}]}]}],
          "\n", "    ", "]"}], ";", "\n", "   ", 
        RowBox[{"pts", " ", "=", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Length", "[", "pts", "]"}]}], "]"}], " ", "+", " ", "\n",
           "     ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], ",", 
            " ", "\n", "      ", "pts", ",", " ", "\n", "      ", 
            RowBox[{"Join", "[", 
             RowBox[{"pts", ",", " ", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{
                RowBox[{"{", "0.", "}"}], ",", " ", 
                RowBox[{"Length", "[", "pts", "]"}]}], "]"}], ",", " ", "2"}],
              "]"}]}], "\n", "     ", "]"}]}]}], ";", "\n", "   ", 
        RowBox[{"w", " ", "=", " ", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c", " ", "=", " ", 
             RowBox[{"1.", "/", 
              RowBox[{"Sqrt", "[", "2.", "]"}]}]}], "}"}], ",", " ", "\n", 
           "     ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "1.", ",", " ", "c", ",", " ", "1.", ",", " ", "c", ",", " ", 
                 "1.", ",", " ", "c", ",", " ", "1."}], "}"}], ",", " ", 
               RowBox[{
                RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], ",",
              " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"0.5", " ", "\[Phi]"}], "]"}], ",", " ", "1."}], 
              "}"}]}], "]"}]}], "\n", "     ", "]"}]}], ";", "\n", "   ", 
        RowBox[{"k", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Riffle", "[", 
              RowBox[{"#", ",", " ", "#"}], "]"}], " ", "&"}], "@", 
            RowBox[{"Range", "[", 
             RowBox[{"seg", " ", "+", " ", "1"}], "]"}]}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"seg", " ", "+", " ", "1"}], "}"}]}], "]"}]}], ";", "\n", 
        "   ", 
        RowBox[{"BSplineCurve", "[", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"SplineDegree", " ", "->", " ", "2"}], ",", " ", 
          RowBox[{"SplineKnots", " ", "->", " ", "k"}], ",", " ", 
          RowBox[{"SplineWeights", " ", "->", " ", "w"}]}], "]"}]}]}], "\n", 
      "   ", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], " ", "||", 
      " ", 
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "3"}]}]}]}], "\n", 
   " ", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "circleFromPoints", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"arc", " ", "->", " ", "False"}], "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"circleFromPoints", "[", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"q1_", ",", " ", "q2_", ",", " ", "q3_"}], "}"}]}], ",", " ", 
      
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "c", ",", " ", "r", ",", " ", "\[Phi]1", ",", " ", "\[Phi]2", ",", 
         " ", "p1", ",", " ", "p2", ",", " ", "p3", ",", " ", "h", ",", " ", 
         "\n", "        ", 
         RowBox[{"rot", " ", "=", " ", 
          RowBox[{
           RowBox[{"Quiet", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}], ",", " ", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"#1", " ", "-", " ", "#2"}], ",", " ", 
                  RowBox[{"#3", " ", "-", " ", "#2"}]}], "]"}]}], "}"}], 
              "]"}], ",", 
             RowBox[{"RotationMatrix", "::", "spln"}]}], "]"}], " ", 
           "&"}]}]}], "}"}], ",", "\n", "  ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "}"}], ".", 
          RowBox[{"rot", "[", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}]}]}], ";", 
        "\n", "  ", 
        RowBox[{"h", " ", "=", " ", 
         RowBox[{"p1", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", 
            RowBox[{";;", " ", "2"}]}], "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"c", ",", " ", "r"}], "}"}], " ", "=", " ", 
         RowBox[{"List", " ", "@@", " ", 
          RowBox[{"Circumsphere", "[", 
           RowBox[{"{", 
            RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "]"}]}]}], 
        ";", "\n", "  ", 
        RowBox[{"\[Phi]1", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p3", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"\[Phi]2", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p1", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", " ", "h"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"OptionValue", "[", "arc", "]"}], " ", "//", " ", 
           "TrueQ"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r", ",", " ", 
              RowBox[{"{", 
               RowBox[{"\[Phi]1", ",", " ", "\[Phi]2"}], "}"}]}], "]"}], ",", 
            " ", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r"}], "]"}], ",", " ", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "\n", "  ", "]"}]}]}], "\n", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"m", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Dimensions", "[", "m", "]"}], " ", "==", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", " ", "3"}], "}"}]}]}]}]}]}]}]], "Code",
 CellLabel->
  "In[4736]:=",ExpressionUUID->"8a094d13-8b63-400b-b159-c54a5fd2ee60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
          " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
        "*)"}], "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{"DisplacementVector", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"v2", ",", "v1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"circleFromPoints", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"vectors", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"vectors", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/", 
            RowBox[{"Sqrt", "[", "2", "]"}]}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], ",", 
       RowBox[{"arc", " ", "\[Rule]", "True"}]}], "]"}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", "3"}], 
    " ", "&&", " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "In[4740]:=",ExpressionUUID->"bd7f0e33-5f80-428a-989f-41e32909c8eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AngleMarker", "::", "bounds"}], "=", 
   "\"\<Vertices are out of bounds.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}]}], 
   "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_", ",", 
    RowBox[{"_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[4741]:=",ExpressionUUID->"6430d36e-973c-44ca-a619-b4932b524083"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PlotMechanism[]", "Section",ExpressionUUID->"39bcb497-250e-4ccc-b5cc-cc185dc1e82d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotMechanism", "]"}], " ", "=", " ", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "Graphics3D", "]"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"PlotTheme", " ", "\[Rule]", " ", "Automatic"}], ",", "\n", 
       "\t\t", 
       RowBox[{"Displacements", " ", "\[Rule]", " ", "None"}], ",", "\n", 
       "\t\t", 
       RowBox[{"Stresses", " ", "\[Rule]", " ", "None"}], ",", "\n", "\n", 
       "\t\t", 
       RowBox[{"StressStyle", " ", "\[Rule]", " ", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RGBColor", "[", 
              RowBox[{"{", 
               RowBox[{"#2", ",", "0", ",", "0"}], "}"}], "]"}], " ", ",", 
             " ", 
             RowBox[{"AbsoluteThickness", "[", 
              RowBox[{"1", "+", 
               RowBox[{"3", "*", "#2"}]}], "]"}], " ", ",", " ", 
             RowBox[{"Line", "[", "#", "]"}]}], "}"}], "&"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RGBColor", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"-", "#2"}]}], "}"}], "]"}], " ", ",", " ", 
             RowBox[{"AbsoluteThickness", "[", 
              RowBox[{"1", "+", 
               RowBox[{"3", "*", 
                RowBox[{"(", 
                 RowBox[{"-", "#2"}], ")"}]}]}], "]"}], " ", ",", 
             RowBox[{"Line", "[", "#", "]"}]}], "}"}], "&"}]}], "\n", "\t\t", 
         "}"}]}], ",", "\n", "\n", "\t\t", 
       RowBox[{"DisplacementStyle", " ", "\[Rule]", " ", 
        RowBox[{"{", "Black", "}"}]}], ",", "\n", "\t\t", 
       RowBox[{"DisplacementScale", " ", "\[Rule]", " ", "0.25"}], ",", "\n", 
       "\n", "\t\t", 
       RowBox[{"DisplayDimension", " ", "\[Rule]", " ", "Automatic"}], ",", 
       "\n", "\t\t", 
       RowBox[{"Prolog", "\[Rule]", 
        RowBox[{"{", "}"}]}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[4745]:=",ExpressionUUID->"47c05290-a89e-4761-b409-233504c8abb9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{"PlotMechanism", "[", " ", 
    RowBox[{"m", ",", "\n", "\t\t", 
     RowBox[{"positionDimension", "[", " ", 
      RowBox[{"m", " ", ",", " ", "Automatic", " ", ",", " ", 
       RowBox[{"OptionValue", "[", "DisplayDimension", "]"}]}], " ", "]"}], 
     ",", " ", "\n", "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlotMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "NumericCoordinatesQ"}], "|", 
      RowBox[{"{", 
       RowBox[{"__", "?", "NumericCoordinatesQ"}], "}"}]}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", "\n", 
     RowBox[{"(*", 
      RowBox[{
      "organize", " ", "all", " ", "the", " ", "coordinates", " ", "into", 
       " ", "proper", " ", "form"}], "*)"}], "\n", 
     RowBox[{
      RowBox[{"coordinates", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ArrayDepth", "[", "positions", "]"}], " ", "\[Equal]", " ",
           "2"}], ",", "\n", "\t", 
         RowBox[{"positionDimension", "[", " ", 
          RowBox[{"m", " ", ",", " ", 
           RowBox[{"{", "positions", "}"}], " ", ",", " ", 
           RowBox[{"OptionValue", "[", "DisplayDimension", "]"}]}], " ", 
          "]"}], ",", "\n", "\t", 
         RowBox[{"positionDimension", "[", " ", 
          RowBox[{"m", " ", ",", " ", "positions", " ", ",", " ", 
           RowBox[{"OptionValue", "[", "DisplayDimension", "]"}]}], " ", 
          "]"}]}], "\n", "]"}]}], " ", ",", " ", "\n", "graphics", ",", " ", 
      "dimension", ",", " ", "directive", ",", " ", "options", ",", " ", 
      "stresses", ",", " ", "displacements"}], "\n", "}"}], ",", " ", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"graphics", " ", "=", " ", 
      RowBox[{"createMechanismGraphics", "[", 
       RowBox[{"m", ",", " ", "coordinates", ",", " ", 
        RowBox[{"Length", "[", " ", 
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", " ", 
        RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"directive", " ", "=", " ", 
      RowBox[{"graphicsDirective", "[", " ", 
       RowBox[{"m", ",", " ", "graphics", ",", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], " ", "]"}]}], ";", 
     "\n", "\t", 
     RowBox[{"options", " ", "=", " ", 
      RowBox[{"graphicsOptions", "[", " ", 
       RowBox[{
        RowBox[{"{", "opt", "}"}], ",", " ", "directive", ",", " ", 
        RowBox[{"boundingRegions", "[", 
         RowBox[{"m", ",", " ", "coordinates"}], "]"}]}], " ", "]"}]}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"stresses", " ", "=", " ", 
      RowBox[{"createStressGraphics", "[", " ", 
       RowBox[{
        RowBox[{"MechanismEdges", "[", "m", "]"}], ",", " ", "coordinates", 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{"OptionValue", "[", "Stresses", "]"}], "}"}], ",", " ", 
        RowBox[{"OptionValue", "[", "StressStyle", "]"}]}], " ", "]"}]}], ";",
      "\n", "\t", 
     RowBox[{"displacements", " ", "=", " ", 
      RowBox[{"createDisplacementGraphics", "[", " ", 
       RowBox[{"coordinates", ",", " ", 
        RowBox[{"{", 
         RowBox[{"OptionValue", "[", "Displacements", "]"}], "}"}], ",", " ", 
        
        RowBox[{"OptionValue", "[", "DisplacementScale", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "DisplacementStyle", "]"}]}], " ", 
       "]"}]}], ";", "\n", "\t", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"ArrayDepth", "[", "positions", "]"}], "\[Equal]", "2"}], 
        ",", " ", "First", ",", " ", "Identity"}], "]"}], " ", "@", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"directive", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"OptionValue", "[", "Prolog", "]"}], ",", "#1", ",", " ",
              "#2", ",", " ", "#3"}], "}"}], ",", " ", "options"}], " ", 
          "]"}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
         "graphics", ",", " ", "stresses", ",", " ", "displacements"}], 
         "}"}]}], " ", "]"}]}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4746]:=",ExpressionUUID->"d0c0ab08-9f98-424a-87df-306817a5ca19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"createMechanismGraphics", "[", " ", 
   RowBox[{
   "m_", ",", " ", "$Failed", ",", " ", "dimension_", ",", " ", 
    "inputOptions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", " ", 
     RowBox[{"PlotMechanism", "::", "pos"}], " ", "]"}], ";", " ", 
    RowBox[{"{", "}"}]}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"createMechanismGraphics", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "dimension_", ",", " ", 
    "inputOptions_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"MechanismPrimitives", "[", " ", 
     RowBox[{"m", ",", " ", "#", ",", " ", "dimension", ",", " ", 
      RowBox[{"FilterRules", "[", 
       RowBox[{"inputOptions", ",", " ", 
        RowBox[{"Options", "[", "MechanismPrimitives", "]"}]}], "]"}]}], " ", 
     "]"}], " ", "&"}], " ", "/@", " ", "positions"}]}]}], "Code",
 CellLabel->
  "In[4748]:=",ExpressionUUID->"e7b9a2a5-9af3-4abb-88e6-2d4aac3f3e98"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numstress"}], "=", 
   "\"\<Stress should be a numeric list of stresses.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "stressmatch"}], "=", 
   "\"\<Stresses should agree with the number of edges.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "stressstyle"}], " ", "=", " ", 
   "\"\<Stress style should be of the form { positive stress style, negative \
stress style }.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlotMechanism", "::", "numinst"}], " ", "=", " ", 
    "\"\<There must be as many stresses as positions provided.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numdisp"}], "=", 
   "\"\<Displacements must be a vector of numerical displacements.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numdispl"}], "=", 
   "\"\<Each vertex needs corresponding displacement in the correct \
dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "displscale"}], "=", 
   "\"\<The displacement scale must be a positive real number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numinstdisp"}], " ", "=", " ", 
   "\"\<There must be as many displacements as positions provided.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[4750]:=",ExpressionUUID->"c147ed39-8949-4292-be7f-d71a91d02de6"],

Cell[CellGroupData[{

Cell["plotSizes[]", "Subsubsection",ExpressionUUID->"41036322-b489-45d6-a4a8-c4b2fc22031e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "clip", " ", "the", " ", "bounding", " ", "box", " ", "to", " ", "a", " ", 
    "minimum", " ", "size"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$minsize", "=", "0.25"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"minSize", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x", "-", "$minsize"}], ",", " ", 
       RowBox[{"x", "+", "$minsize"}]}], " ", "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"y", "-", "x"}], "]"}], " ", "<", " ", "$minsize"}]}]}], "\n", 
   
   RowBox[{
    RowBox[{"minSize", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "-", "$minsize"}], ",", " ", 
      RowBox[{"y", "+", "$minsize"}]}], "}"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "figure", " ", "out", " ", "plot", " ", "range", " ", "and", " ", 
     "ratios"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"plotSizes", "[", "positions_", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "\n", "}"}],
       ",", "\n", "\t", 
      RowBox[{
       RowBox[{"boundingRegion", " ", "=", " ", "\n", "\t\t", 
        RowBox[{"minSize", " ", "/@", " ", 
         RowBox[{"(", 
          RowBox[{"Transpose", " ", "@", "  ", 
           RowBox[{"CoordinateBoundingBox", "[", "positions", "]"}]}], 
          ")"}]}]}], ";", "\n", "\t", 
       RowBox[{"boundingBoxRatios", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], ")"}], " ", "/@", 
         " ", "boundingRegion"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "}"}]}]}], 
     "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[4758]:=",ExpressionUUID->"1e65c65e-c390-4436-963f-5839fb0f2d6f"]
}, Closed]],

Cell[CellGroupData[{

Cell["boundingRegions[], graphicsDirective[], graphicsOptions[]", \
"Subsubsection",ExpressionUUID->"3158cbe2-8da5-435f-9855-4818c97962d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"boundingRegions", "[", " ", 
   RowBox[{"m_", ",", " ", "$Failed"}], "]"}], " ", ":=", " ", 
  "$Failed"}], "\n", 
 RowBox[{
  RowBox[{"boundingRegions", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"graphics", " ", ":", " ", 
     RowBox[{"{", "__GraphicsComplex", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"plotSizes", "[", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{
     RowBox[{"graphics", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", "1"}], " ", "]"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"boundingRegions", "[", " ", 
    RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"plotSizes", "[", "pos", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"graphicsDirective", "[", " ", 
   RowBox[{"m_", ",", " ", "$Failed", ",", " ", "dim_"}], " ", "]"}], " ", ":=",
   " ", "Identity"}], "\n", 
 RowBox[{
  RowBox[{"graphicsDirective", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"graphics", " ", ":", " ", 
     RowBox[{"{", "__GraphicsComplex", "}"}]}], ",", " ", "expectedDim_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dims", " ", "=", " ", 
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"graphics", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"Which", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Not", "[", " ", 
       RowBox[{"Equal", " ", "@@", " ", "dims"}], " ", "]"}], ",", " ", 
      "Identity", ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "2"}], ",", " ", 
      "Graphics", ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "3"}], ",", " ", 
      "Graphics3D", ",", "\n", "\t\t", "True", ",", " ", "Identity"}], "\n", 
     "\t", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"graphicsDirective", "[", 
    RowBox[{"m_", ",", " ", "graphics_", ",", " ", "expectedDim_"}], " ", 
    "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"Switch", "[", " ", 
    RowBox[{
    "expectedDim", ",", "\n", "\t\t", "2", ",", " ", "Graphics", ",", " ", 
     "\n", "\t\t", "3", ",", " ", "Graphics3D", ",", "\n", "\t\t", "_", ",", 
     " ", "Identity"}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOptions", "[", " ", 
   RowBox[{"options_", ",", " ", "directive_", ",", " ", "$Failed"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"graphicsOptions", "[", " ", 
   RowBox[{"options_", ",", " ", "directive_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"boundingRegion_", ",", " ", "boundingRatios_"}], "}"}]}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"Join", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "options", "}"}], ",", 
      RowBox[{"Options", "[", "Graphics3D", "]"}]}], "]"}], ",", " ", "\n", 
    "\t\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Boxed", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}], ",", 
      RowBox[{"PlotRange", " ", "\[Rule]", " ", "boundingRegion"}], ",", " ", 
      
      RowBox[{"BoxRatios", " ", "\[Rule]", " ", "boundingRatios"}]}], "}"}]}],
    "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[4762]:=",ExpressionUUID->"274ece50-9947-4d40-9f3e-6f0f5cb59add"]
}, Closed]],

Cell[CellGroupData[{

Cell["createStressGraphics[]", "Subsubsection",ExpressionUUID->"6db47837-09f4-490d-be89-995898f5d632"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createStressGraphics", "[", " ", 
   RowBox[{"edges_", ",", " ", "coordinates_", ",", " ", 
    RowBox[{"None", "|", 
     RowBox[{"{", "None", "}"}]}], ",", " ", "_"}], " ", "]"}], ":=", 
  RowBox[{"ConstantArray", "[", " ", 
   RowBox[{
    RowBox[{"{", "}"}], ",", " ", 
    RowBox[{"Length", "[", "coordinates", "]"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[4770]:=",ExpressionUUID->"d0e19af4-16c0-4707-b689-be8f8be442e5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"createStressGraphics", "[", " ", 
    RowBox[{"edges_", " ", ",", " ", "coordinates_", " ", ",", " ", 
     RowBox[{"stress", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], ",", " ", 
     RowBox[{"style", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"_", ",", "_"}], "}"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"stressScale", " ", "=", " ", 
        RowBox[{"Max", "[", " ", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"stress", ",", "0"}], "]"}], ",", " ", 
          RowBox[{"Abs", " ", "@", " ", 
           RowBox[{"Min", "[", 
            RowBox[{"stress", ",", "0"}], "]"}]}]}], " ", "]"}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"plotStresses", "[", " ", 
          RowBox[{
          "stressScale", ",", " ", "edges", ",", " ", "#1", ",", " ", "#2", 
           ",", " ", "style"}], " ", "]"}], "&"}], ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{"coordinates", ",", " ", "stress"}], " ", "}"}]}], " ", 
       "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "stress", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Length", "[", " ", "coordinates", " ", "]"}], ",", " ", 
       RowBox[{"Length", "[", "edges", "]"}]}], " ", "}"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"createStressGraphics", "[", " ", 
   RowBox[{
   "edges_", ",", " ", "coordinates_", ",", " ", "stress_", ",", " ", 
    "style_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", " ", "@", " ", 
       RowBox[{"MatrixQ", "[", " ", 
        RowBox[{"stress", ",", " ", "NumericQ"}], " ", "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numstress"}], "]"}]}], "]"}], ";", 
    "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "stress", "]"}], " ", "\[NotEqual]", " ", 
       RowBox[{"Length", "[", " ", "coordinates", " ", "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numinst"}], "]"}]}], "]"}], ";", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"stress", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "\[NotEqual]", " ", 
       RowBox[{"Length", "[", "edges", "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "stressmatch"}], "]"}]}], " ", "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "style", "]"}], " ", "\[NotEqual]", " ", "2"}], 
      ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "stressstyle"}], "]"}]}], " ", "]"}], 
    ";", "\n", "\n", "\t", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}], "\n", 
   ")"}]}]}], "Code",
 CellLabel->
  "In[4771]:=",ExpressionUUID->"6e3dd12b-7fe5-467b-932c-23f1811752d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotStresses", "[", " ", 
    RowBox[{
    "stressScale_", ",", " ", "edges_", ",", " ", "coordinates_", ",", " ", 
     "stress_", ",", " ", "stressFunc_Function"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{"plotStresses", "[", " ", 
    RowBox[{
    "stressScale", ",", " ", "edges", ",", " ", "coordinates", ",", " ", 
     "stress", ",", " ", 
     RowBox[{"{", 
      RowBox[{"stressFunc", ",", " ", "stressFunc"}], "}"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"plotStresses", "[", " ", 
   RowBox[{
   "stressScale_", ",", " ", "edges_", ",", " ", "coordinates_", ",", " ", 
    "stress_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"posStress_Function", ",", " ", "negStress_Function"}], "}"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"coordinatePairs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", " ", "#", " ", "]"}], "]"}], "&"}], " ", "/@", " ", 
        "edges"}]}], ",", "\n", "\t", 
      RowBox[{"normalizedStresses", " ", "=", " ", 
       RowBox[{"stress", "/", "stressScale"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"MapThread", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"#2", "<", "0"}], ",", " ", 
         RowBox[{"negStress", "[", " ", 
          RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], ",", " ", 
         RowBox[{"#2", ">", "0"}], ",", " ", 
         RowBox[{"posStress", "[", " ", 
          RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], ",", " ", "True", ",", 
         " ", 
         RowBox[{"{", "}"}]}], " ", "]"}], "&"}], ",", "\n", "\t\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"coordinatePairs", ",", "\n", "\t\t", "normalizedStresses"}], 
       "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4773]:=",ExpressionUUID->"911928c9-1776-49d7-bdc1-00a706563c2f"]
}, Closed]],

Cell[CellGroupData[{

Cell["createDisplacementGraphics[]", "Subsubsection",ExpressionUUID->"b5eb9bb4-86b7-4453-beb7-26e0f999bb46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"createDisplacementGraphics", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"None", "|", 
     RowBox[{"{", "None", "}"}]}], ",", " ", "_", " ", ",", " ", "_"}], "]"}],
   ":=", " ", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[4775]:=",ExpressionUUID->"fe4484fa-0682-4b65-83b1-f4a7594958f2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"createDisplacementGraphics", "[", " ", 
    RowBox[{"coordinates_", ",", " ", 
     RowBox[{"displacements", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "}"}]}], 
     ",", " ", 
     RowBox[{"displacementScale_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
         RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], ",", " ", "style_"}], " ",
     "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"maxDisplacement", " ", "=", " ", 
        RowBox[{"Max", "[", " ", 
         RowBox[{"Map", "[", 
          RowBox[{"Norm", " ", ",", " ", "displacements", ",", " ", 
           RowBox[{"{", "2", "}"}]}], " ", "]"}], " ", "]"}]}], " ", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"plotDisplacements", "[", " ", 
          RowBox[{
          "maxDisplacement", ",", " ", "#1", ",", " ", "#2", ",", " ", 
           "displacementScale", ",", " ", "style"}], " ", "]"}], "&"}], ",", 
        " ", 
        RowBox[{"{", " ", 
         RowBox[{"coordinates", ",", " ", "displacements"}], " ", "}"}]}], 
       " ", "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", " ", "coordinates", " ", "]"}], " ", 
     "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", " ", "displacements", " ", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"createDisplacementGraphics", "[", " ", 
   RowBox[{
   "coordinates_", ",", " ", "displacements_", ",", " ", "displacementScale_",
     ",", " ", "style_"}], " ", "]"}], " ", ":=", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", " ", "@", " ", 
       RowBox[{"(", 
        RowBox[{"And", "@@", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"MatrixQ", "[", 
             RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], " ", "/@", " ", 
           "displacements"}], ")"}]}], " ", ")"}]}], " ", ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numdisp"}], "]"}]}], " ", "]"}], ";", 
    "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Not", " ", "@", " ", 
         RowBox[{"NumericQ", "[", "displacementScale", "]"}]}], " ", "||", 
        " ", 
        RowBox[{"#", " ", "\[LessEqual]", " ", "0"}]}], "&"}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "displscale"}], "]"}]}], " ", "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", " ", "coordinates", " ", "]"}], " ", 
       "\[NotEqual]", " ", 
       RowBox[{"Dimensions", "[", " ", "displacements", " ", "]"}]}], ",", 
      " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numinstdisp"}], "]"}]}], " ", "]"}], 
    ";", "\n", "\n", "\t", 
    RowBox[{"ConstantArray", "[", " ", 
     RowBox[{
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"Length", "[", "coordinates", "]"}]}], " ", "]"}]}], "\n", 
   ")"}]}]}], "Code",
 CellLabel->
  "In[4776]:=",ExpressionUUID->"2cc02ac0-f0e0-44be-9b08-7afececde616"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacements", "[", " ", 
    RowBox[{
    "maxDisplacement_", ",", " ", "coordinates_", ",", " ", "displacement_", 
     ",", " ", "displacementScale_", ",", " ", "style_"}], "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"padding", " ", "=", " ", "0.9"}], "}"}], ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "@", " ", 
      RowBox[{"MapThread", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"displacementGraphic", "[", " ", "style", " ", "]"}], ",", 
        "\n", "\t\t", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{"coordinates", ",", "\n", "\t\t\t", 
          RowBox[{"displacementScale", " ", "*", " ", 
           RowBox[{"displacement", "/", "maxDisplacement"}]}]}], "\n", "\t\t",
          "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementGraphic", "[", " ", "style_", " ", "]"}], "[", " ", 
   RowBox[{"vertexLocation_", ",", " ", "displacement_"}], " ", "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{"{", "\n", "\t", 
   RowBox[{"style", ",", "\n", "\t", 
    RowBox[{"Arrow", "[", " ", 
     RowBox[{"{", 
      RowBox[{"vertexLocation", ",", " ", 
       RowBox[{"vertexLocation", " ", "+", " ", "displacement"}]}], "}"}], 
     " ", "]"}]}], "\n", "\t", "}"}]}]}], "Code",
 CellLabel->
  "In[4778]:=",ExpressionUUID->"55774fc6-ee2b-44c0-b416-d3132ebf9238"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["plotOrigami[]-delete", "Section",ExpressionUUID->"22a76298-877b-4f82-9647-137ccd36f0ff"],

Cell[CellGroupData[{

Cell["plotOrigami[]", "Subsection",ExpressionUUID->"1fce4c2a-3ad9-4a55-ae6b-d262e817dc47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "plotOrigami", " ", "]"}], " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<TorsionalFolds\>\"", " ", "\[Rule]", " ", "None"}], ",", 
      "  ", 
      RowBox[{"\"\<Face\>\"", " ", "\[Rule]", " ", "\"\<WrinkledPaper\>\""}], 
      ",", " ", 
      RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.003"}]}], " ", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"plotOrigami", "[", " ", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"plotOrigami", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "[", " ", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"pos_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"Faces", ",", " ", "positions", " ", ",", "\n", "\t", 
        RowBox[{"TorsionalFolds", " ", "=", " ", 
         RowBox[{"InteriorEdges", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"boundary", " ", "=", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{
           RowBox[{"BoundaryEdges", "[", "m", "]"}], " ", ",", " ", "1"}], 
          " ", "]"}]}], ",", "\n", "\t", 
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"MechanismDisplayDimension", "[", "m", "]"}]}], ",", "\n", 
        "\t", "positionMap"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"pos", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "pos", "]"}], ",", " ", "d"}], "}"}]}], 
         " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"positionMap", " ", "=", " ", 
        RowBox[{"Dispatch", "[", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", " ", 
            RowBox[{"Length", "[", "pos", "]"}], " ", "]"}], " ", "\[Rule]", 
           " ", "positions"}], " ", "]"}], " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"Faces", " ", "=", " ", 
        RowBox[{"ToGraphicsComplex", "[", " ", 
         RowBox[{
          RowBox[{"MechanismEmbeddingDimension", "[", 
           RowBox[{"m", "\[Rule]", "2"}], "]"}], ",", " ", "positions"}], " ",
          "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Show", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"d", "\[Equal]", "2"}], ",", " ", "Graphics", ",", " ", 
            "Graphics3D"}], " ", "]"}], " ", "/@", "\n", "\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"Check", "[", " ", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"StringQ", "[", " ", 
                   RowBox[{"OptionValue", "[", "\"\<Face\>\"", "]"}], " ", 
                   "]"}], ",", " ", 
                  RowBox[{"texture", "[", 
                   RowBox[{"OptionValue", "[", "\"\<Face\>\"", "]"}], "]"}], 
                  " ", ",", " ", 
                  RowBox[{"OptionValue", "[", "\"\<Face\>\"", "]"}]}], " ", 
                 "]"}], " ", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", 
              "\t\t\t", "Faces"}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t", 
            "\n", "\t\t\t", 
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"{", " ", 
              RowBox[{
               RowBox[{"Thickness", "[", " ", 
                RowBox[{"2", " ", 
                 RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], 
                " ", "]"}], ",", " ", "Black", ",", " ", 
               RowBox[{"Line", " ", "/@", " ", 
                RowBox[{"(", 
                 RowBox[{"boundary", " ", "/.", " ", "positionMap"}], 
                 ")"}]}]}], " ", "}"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"Check", "[", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"MapThread", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", " ", 
                   RowBox[{"#1", ",", " ", 
                    RowBox[{"Thickness", "[", " ", 
                    RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], 
                    " ", "]"}], ",", "  ", 
                    RowBox[{"Line", "[", "#2", "]"}]}], " ", "}"}], "]"}], 
                 " ", "&"}], " ", ",", " ", 
                RowBox[{"{", " ", 
                 RowBox[{
                  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
                   RowBox[{"TorsionalFolds", ",", " ", 
                    RowBox[{
                    "OptionValue", "[", "\"\<TorsionalFolds\>\"", "]"}]}], 
                   " ", "]"}], ",", "  ", 
                  RowBox[{"(", 
                   RowBox[{"TorsionalFolds", " ", "/.", " ", "positionMap"}], 
                   ")"}]}], "}"}]}], " ", "]"}], ",", "\n", "\t\t\t\t", 
              "Nothing"}], "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "}"}]}], 
         ",", "\n", "\t\t", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"BoxRatios", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ",", " ", 
         RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}]}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"lineThicknessQ", "[", " ", 
      RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], " ", "]"}], " ",
      "&&", " ", 
     RowBox[{"checkVertexNumberQ", "[", " ", 
      RowBox[{
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "\[Equal]", " ", 
       
       RowBox[{"Length", "[", "pos", "]"}]}], " ", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "vert"}], " ", "=", " ", 
   "\"\<Number of vertices does not match number of vertex positions \
provided.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"checkVertexNumberQ", "[", " ", 
    RowBox[{"b_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", "[", "b", "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"plotOrigami", "::", "vert"}], "]"}]}], " ", "]"}], ";", " ", 
     "b"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "thick"}], " ", "=", " ", 
   "\"\<Line thickness, `1`, should be a positive real number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"lineThicknessQ", "[", " ", 
   RowBox[{"t_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lineThicknessQ", "[", " ", "t_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"plotOrigami", "::", "thick"}], ",", " ", "t"}], "]"}], ";", 
     " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "TorsionalFolds"}], " ", "=", " ", 
   "\"\<Folds should be of the form {{v1,v2}, ... } -> { style1, ... \
}.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", "None"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ConstantArray", "[", " ", 
   RowBox[{"Black", ",", " ", 
    RowBox[{"Length", "[", "allFolds", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TorsionalFolds_", "?", "MatrixQ"}], " ", "\[Rule]", " ", 
      "style_List"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
   RowBox[{"allFolds", ",", " ", 
    RowBox[{"TorsionalFolds", " ", "\[Rule]", " ", "style"}]}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", 
    RowBox[{
     RowBox[{"TorsionalFolds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], " ", 
     "\[Rule]", " ", "style_List"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"rules", " ", "=", " ", 
       RowBox[{"Dispatch", " ", "@", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Sort", " ", "/@", " ", "TorsionalFolds"}], ")"}], " ", 
          "\[Rule]", " ", "style"}], " ", "]"}]}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Sort", "/@", "allFolds"}], ")"}], " ", "/.", " ", "rules"}], 
      " ", "/.", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], " ", "\[Rule]", 
       " ", "Black"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"Dimensions", "[", " ", "TorsionalFolds", " ", "]"}], "]"}], 
     " ", "\[Equal]", " ", "2"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", "TorsionalFolds", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "style", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldStyleGraphics", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"plotOrigami", "::", "TorsionalFolds"}], "]"}], ";", " ", 
    "$Failed"}], ")"}]}]}], "Code",
 CellLabel->
  "In[4780]:=",ExpressionUUID->"d9f2b206-4c71-4b1c-8742-4ad30c3dcdbb"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Experimental code", "Section",ExpressionUUID->"3efe547a-f1ac-4ffb-8444-d2b58598608b"],

Cell[CellGroupData[{

Cell["scalePolygon[]", "Subsection",ExpressionUUID->"030fa22e-305a-45e4-b6b6-74f92db2e39b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"scalePolygon", "[", 
   RowBox[{"coords_", " ", ",", " ", "shrinkBy_"}], " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", "\t", 
     RowBox[{"center", " ", "=", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{
        RowBox[{"Mean", "[", "coords", "]"}], ",", 
        RowBox[{"Length", "[", "coords", "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", "\t", 
    RowBox[{"center", " ", "+", " ", 
     RowBox[{
      RowBox[{"Clip", "[", 
       RowBox[{
        RowBox[{"1", "-", "shrinkBy"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"coords", "-", "center"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellLabel->
  "In[4793]:=",ExpressionUUID->"580bd134-fe46-489b-be75-aa685f0fcd22"]
}, Closed]],

Cell[CellGroupData[{

Cell["ExtrudedPolygon[]", "Subsection",ExpressionUUID->"50641957-a476-4037-b81c-36b8b7785b1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExtrudedPolygon", "[", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
       RowBox[{"thickness2_", "?", "NumericQ"}]}], " ", "}"}], " ", "]"}], 
    "[", "coords_", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"extrusionVector", " ", "=", " ", 
        RowBox[{"First", " ", "@", " ", 
         RowBox[{"NormalVector", "[", 
          RowBox[{"coords", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"1", ",", "2", ",", "3"}], "}"}], "}"}]}], "]"}]}]}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Face1", " ", "=", " ", 
           RowBox[{"coords", " ", "+", " ", 
            RowBox[{"thickness1", " ", 
             RowBox[{"ConstantArray", "[", " ", 
              RowBox[{"extrusionVector", ",", " ", 
               RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], 
          ",", "\n", "\t\t", 
          RowBox[{"Face2", " ", "=", " ", 
           RowBox[{"coords", " ", "+", " ", 
            RowBox[{"thickness2", " ", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"extrusionVector", " ", ",", " ", 
               RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
         "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Polyhedron", " ", "@", " ", 
         RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{
           RowBox[{
           "{", "\[IndentingNewLine]", "\t\t\t", "Face1", 
            "\[IndentingNewLine]", "\t\t\t", "}"}], ",", 
           "\[IndentingNewLine]", "\t\t\t", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",",
              " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
               RowBox[{"Partition", "[", 
                RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
              "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
            "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
       "\[IndentingNewLine]", "\t", "]"}]}], " ", "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", "3"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExtrudedPolygon", "[", " ", 
     RowBox[{
      RowBox[{"extrusionVector", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"_", "?", "NumericQ"}], ",", " ", 
         RowBox[{"_", "?", "NumericQ"}], ",", " ", 
         RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], " ", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
        RowBox[{"thickness2_", "?", "NumericQ"}]}], " ", "}"}]}], " ", "]"}], 
    "[", "coords_", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Face1", " ", "=", " ", 
         RowBox[{"coords", " ", "+", " ", 
          RowBox[{"thickness1", " ", 
           RowBox[{"ConstantArray", "[", " ", 
            RowBox[{"extrusionVector", ",", " ", 
             RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"Face2", " ", "=", " ", 
         RowBox[{"coords", " ", "+", " ", 
          RowBox[{"thickness2", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"extrusionVector", " ", ",", " ", 
             RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
       "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
      RowBox[{"Polyhedron", " ", "@", " ", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{
         RowBox[{
         "{", "\[IndentingNewLine]", "\t\t\t", "Face1", "\[IndentingNewLine]",
           "\t\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{"MapThread", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
             RowBox[{"Partition", "[", 
              RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
            "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
          "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
     "\[IndentingNewLine]", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", "3"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtrudedPolygon", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
      RowBox[{"thickness2_", "?", "NumericQ"}]}], "}"}], "]"}], "[", 
   "coords_", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"coords2", " ", "=", " ", 
       RowBox[{"PadRight", "[", " ", 
        RowBox[{"coords", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "coords", "]"}], ",", "3"}], "}"}]}], " ", 
        "]"}]}], " ", "}"}], ",", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Face1", " ", "=", " ", 
          RowBox[{"coords2", " ", "+", " ", 
           RowBox[{"thickness1", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], " ", ",", " ", 
              RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], ",",
          "\n", "\t\t", 
         RowBox[{"Face2", " ", "=", " ", 
          RowBox[{"coords2", " ", "+", " ", 
           RowBox[{"thickness2", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], " ", ",", " ", 
              RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
        "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Polyhedron", " ", "@", " ", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{
          RowBox[{
          "{", "\[IndentingNewLine]", "\t\t\t", "Face1", 
           "\[IndentingNewLine]", "\t\t\t", "}"}], ",", "\[IndentingNewLine]",
           "\t\t\t", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
              RowBox[{"Partition", "[", 
               RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
             "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
           "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", 
     "2"}]}]}]}]}], "Code",
 CellLabel->
  "In[4794]:=",ExpressionUUID->"da7e70de-e1ad-47c1-a2cd-4e867b497a28"]
}, Closed]],

Cell[CellGroupData[{

Cell["shrinkPolygon[]", "Subsection",ExpressionUUID->"5b510d4d-6e9e-491c-94a7-2f5adbe7cbe3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shrinkPolygon", "[", " ", 
    RowBox[{"pts_", ",", " ", "widths_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"pts", " ", "+", " ", 
    RowBox[{"Total", " ", "@", " ", 
     RowBox[{"MapIndexed", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"shrinkPolygonSide", "[", " ", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#1"}], " ", "]"}], 
        "&"}], ",", " ", "widths"}], " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"shrinkPolygonSide", "[", " ", 
   RowBox[{"pts_", ",", " ", "v1_", ",", " ", "width_"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "pts", "]"}]}], ",", " ", "v2", ",", " ", 
      "future", ",", " ", "past", ",", " ", "futureEdge", ",", " ", "edge", 
      ",", " ", "pastEdge"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"v2", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"future", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v2", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"past", " ", "=", " ", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "-", "1"}], ",", "n", ",", "1"}], "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{"edge", "=", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"futureEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "future", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"pastEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "past", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{"RotateRight", "[", 
      RowBox[{
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"width", "*", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"pastEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"pastEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"futureEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"futureEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"n", "-", "2"}]}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
       RowBox[{"v1", "-", "1"}]}], "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[4797]:=",ExpressionUUID->"ae3899bf-8cac-4133-92d1-6bd45cffea08"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a1375d4f-d82f-42cf-9eb3-c76f31ebb81e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[4799]:=",ExpressionUUID->"0f6f47a1-2047-4f40-a070-b68748d33cb4"]
}, Closed]]
}, Closed]]
}, Open  ]]
},
WindowSize->{1268, 791},
WindowMargins->{{Automatic, 36}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (May 11, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"d3d5b704-240b-45dc-9724-92278d2cb5eb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 90, 0, 98, "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],
Cell[673, 24, 167, 4, 81, "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],
Cell[CellGroupData[{
Cell[865, 32, 100, 0, 45, "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],
Cell[968, 34, 222, 5, 35, "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],
Cell[1193, 41, 164, 4, 35, "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],
Cell[1360, 47, 234, 5, 35, "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],
Cell[1597, 54, 202, 4, 35, "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],
Cell[1802, 60, 192, 4, 35, "Text",ExpressionUUID->"85ea895a-171e-480f-b701-c119aed055d6"],
Cell[1997, 66, 315, 5, 58, "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2349, 76, 109, 0, 45, "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],
Cell[2461, 78, 387, 7, 58, "Text",ExpressionUUID->"01e0f39a-cdd3-4398-9885-4e9122d860da"],
Cell[2851, 87, 235, 3, 35, "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"],
Cell[3089, 92, 254, 4, 35, "Text",ExpressionUUID->"3c29e79e-c97c-45d3-a1ea-174eedb8cf96"],
Cell[3346, 98, 218, 3, 35, "Text",ExpressionUUID->"33457689-1538-46a7-a7b4-32e05e4d1dbb"],
Cell[3567, 103, 165, 3, 35, "Text",ExpressionUUID->"50f80464-0989-4dbe-adb2-45b20020c8a6"],
Cell[3735, 108, 117, 0, 35, "Text",ExpressionUUID->"de519dea-c6ba-4b6e-b9b8-68b8224f3d40"],
Cell[CellGroupData[{
Cell[3877, 112, 449, 11, 52, "Input",ExpressionUUID->"bdc64312-753d-4eb5-8a7c-c436ed551c43"],
Cell[4329, 125, 22443, 397, 63, "Output",ExpressionUUID->"9fea80e9-1356-43be-ba3e-b39fa3d6a1d9"]
}, Open  ]],
Cell[26787, 525, 104, 0, 35, "Text",ExpressionUUID->"8c0f275a-0a6f-49f8-8b27-df573f355ff7"],
Cell[26894, 527, 168, 3, 30, "Input",ExpressionUUID->"bae0a72b-16f7-4640-9196-dd8e0df27892"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27099, 535, 123, 0, 69, "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],
Cell[27225, 537, 250, 6, 52, "Code",ExpressionUUID->"19f747a5-46c1-4c74-9468-5aa2b9f8da15"],
Cell[CellGroupData[{
Cell[27500, 547, 93, 0, 67, "Section",ExpressionUUID->"e8755456-61af-4d01-a4b3-3c63afdd42db"],
Cell[27596, 549, 1567, 42, 281, "Code",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"]
}, Closed]],
Cell[CellGroupData[{
Cell[29200, 596, 79, 0, 53, "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],
Cell[29282, 598, 2057, 52, 224, "Code",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],
Cell[31342, 652, 1234, 27, 243, "Code",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],
Cell[32579, 681, 288, 7, 52, "Code",ExpressionUUID->"4350ea39-be9f-4263-bb1e-6f86b8d011ef"],
Cell[32870, 690, 2755, 66, 452, "Code",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"],
Cell[35628, 758, 1052, 20, 205, "Code",ExpressionUUID->"9273de87-effd-4686-9b2e-608fcb430619"],
Cell[36683, 780, 2103, 37, 452, "Code",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],
Cell[38789, 819, 307, 7, 52, "Code",ExpressionUUID->"22907678-8e63-445b-bf88-1cf1b4802c34"],
Cell[39099, 828, 3586, 82, 623, "Code",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],
Cell[42688, 912, 508, 10, 72, "Code",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"]
}, Closed]],
Cell[CellGroupData[{
Cell[43233, 927, 98, 0, 53, "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],
Cell[43334, 929, 175, 4, 52, "Code",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],
Cell[43512, 935, 1340, 41, 186, "Code",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"],
Cell[CellGroupData[{
Cell[44877, 980, 89, 0, 54, "Subsection",ExpressionUUID->"eff07146-d872-4431-837d-c7f0a6ec7629"],
Cell[44969, 982, 601, 16, 111, "Code",ExpressionUUID->"a5aa8b49-bcf0-48ef-881c-d1ffc63e1b4c"]
}, Closed]],
Cell[CellGroupData[{
Cell[45607, 1003, 125, 0, 38, "Subsection",ExpressionUUID->"d1bfb2ec-05b0-4a63-91f8-fcaf3033211d"],
Cell[45735, 1005, 2994, 80, 383, "Code",ExpressionUUID->"b000fe75-98e0-4db2-803d-1d40f1814007"]
}, Closed]],
Cell[CellGroupData[{
Cell[48766, 1090, 94, 0, 38, "Subsection",ExpressionUUID->"5cf74a85-b4c1-4085-b474-db69e3569d24"],
Cell[48863, 1092, 3221, 91, 243, "Code",ExpressionUUID->"f5ce23c9-dd88-49e3-8ce9-d15ea2f4a0f2"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[52133, 1189, 111, 0, 53, "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],
Cell[CellGroupData[{
Cell[52269, 1193, 87, 0, 54, "Subsection",ExpressionUUID->"af8d39d2-e6d6-4050-8965-bc05f40569d0"],
Cell[52359, 1195, 2765, 74, 224, "Code",ExpressionUUID->"e1c8906d-3061-4fe8-9994-991ef705e42c"]
}, Closed]],
Cell[CellGroupData[{
Cell[55161, 1274, 88, 0, 38, "Subsection",ExpressionUUID->"3140d306-2fe3-4d80-8519-e5c1a3a2179c"],
Cell[55252, 1276, 1934, 53, 243, "Code",ExpressionUUID->"d441c2cb-db4c-4b3c-be58-c401dbbf458e"],
Cell[57189, 1331, 1731, 46, 262, "Code",ExpressionUUID->"c533ba08-40c1-4f85-a5d9-ebd3d51e166d"],
Cell[58923, 1379, 1646, 44, 224, "Code",ExpressionUUID->"a16e7b04-ada9-4bb9-a6c0-e1b705fe5e06"],
Cell[60572, 1425, 15916, 389, 2276, "Code",ExpressionUUID->"86e4ac4f-371a-4d0e-8ec5-01840aa47eca"]
}, Open  ]],
Cell[CellGroupData[{
Cell[76525, 1819, 90, 0, 54, "Subsection",ExpressionUUID->"ee5265f2-5b85-4a46-a28b-a243bc9ff076"],
Cell[76618, 1821, 2045, 55, 357, "Code",ExpressionUUID->"4875f961-32d2-4913-98ea-6cdd16c6277c"]
}, Closed]],
Cell[CellGroupData[{
Cell[78700, 1881, 154, 2, 38, "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],
Cell[78857, 1885, 682, 20, 52, "Code",ExpressionUUID->"f1139107-b69c-4fd4-8921-cbf950ea380f"],
Cell[79542, 1907, 695, 20, 52, "Code",ExpressionUUID->"aedb8fbc-7b63-4e91-8f14-89eba922e5be"],
Cell[80240, 1929, 2775, 74, 414, "Code",ExpressionUUID->"b5a4e93b-03e7-40af-85c4-fe8ffd3be9b9"]
}, Closed]],
Cell[CellGroupData[{
Cell[83052, 2008, 108, 0, 38, "Subsection",ExpressionUUID->"530c0200-8cec-4ba0-ac9d-8bb8ee2048af"],
Cell[83163, 2010, 110, 0, 35, "Text",ExpressionUUID->"30722304-63f8-45bb-856c-187e452eb61d"],
Cell[83276, 2012, 922, 24, 110, "Code",ExpressionUUID->"3dcbb299-d60d-4ccd-b0a6-8765b702245a"],
Cell[84201, 2038, 763, 22, 91, "Code",ExpressionUUID->"102c4a3c-1dcf-48e5-af1a-6ac1cb37098a"]
}, Closed]],
Cell[CellGroupData[{
Cell[85001, 2065, 99, 0, 38, "Subsection",ExpressionUUID->"66a4fa93-b1cb-408a-b53d-07229a966a10"],
Cell[85103, 2067, 1914, 49, 243, "Code",ExpressionUUID->"64d17235-533b-4916-b535-0ebabd865c68"]
}, Closed]],
Cell[CellGroupData[{
Cell[87054, 2121, 100, 0, 38, "Subsection",ExpressionUUID->"31a2a4ca-20a8-4cbc-b01c-74d8e07dc5cb"],
Cell[87157, 2123, 1287, 35, 129, "Code",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],
Cell[CellGroupData[{
Cell[88481, 2163, 88, 0, 38, "Subsection",ExpressionUUID->"9b7efb19-fa3f-458c-b10d-055c4761c19a"],
Cell[88572, 2165, 1528, 40, 148, "Code",ExpressionUUID->"b44baf22-b49e-49eb-8d47-48ae6f6bc8b6"]
}, Closed]],
Cell[CellGroupData[{
Cell[90137, 2210, 105, 0, 38, "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],
Cell[90245, 2212, 7240, 190, 532, "Code",ExpressionUUID->"eb718079-61c4-4ca0-995a-7b96ba132a18"],
Cell[97488, 2404, 6747, 171, 663, "Code",ExpressionUUID->"3e48711c-51f0-4af3-a14f-17eb5878f2bb"],
Cell[104238, 2577, 260, 7, 52, "Code",ExpressionUUID->"18f7d81c-3e4a-4d14-8b8f-8a0d0cf9a5fd"],
Cell[104501, 2586, 1689, 45, 205, "Code",ExpressionUUID->"e760c130-8b29-4ddc-8403-453272bb4643"]
}, Open  ]],
Cell[CellGroupData[{
Cell[106227, 2636, 90, 0, 54, "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],
Cell[106320, 2638, 4536, 124, 357, "Code",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],
Cell[CellGroupData[{
Cell[110893, 2767, 195, 3, 38, "Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],
Cell[111091, 2772, 6407, 164, 566, "Code",ExpressionUUID->"58cae39b-f26e-4c92-93be-35567681d0c7"]
}, Closed]],
Cell[CellGroupData[{
Cell[117535, 2941, 103, 0, 38, "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],
Cell[117641, 2943, 1310, 33, 281, "Code",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],
Cell[118954, 2978, 914, 24, 186, "Code",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],
Cell[CellGroupData[{
Cell[119905, 3007, 101, 0, 38, "Subsection",ExpressionUUID->"27f84a4e-e698-437b-94f5-cbe3588f169d"],
Cell[120009, 3009, 7585, 172, 737, "Code",ExpressionUUID->"31a72297-71f7-4b0b-a689-6535b1e08576"],
Cell[127597, 3183, 5222, 133, 528, "Code",ExpressionUUID->"3302b513-e9fe-45e5-b7f9-d675ecefb2c6"],
Cell[132822, 3318, 476, 12, 52, "Code",ExpressionUUID->"2b8c3df9-7cd3-41f4-b20d-28cb2d4c46bc"]
}, Closed]],
Cell[CellGroupData[{
Cell[133335, 3335, 95, 0, 38, "Subsection",ExpressionUUID->"5a94c171-934c-4d12-ad62-4dfa84b8a359"],
Cell[133433, 3337, 825, 23, 72, "Code",ExpressionUUID->"0e91cd52-98a9-4991-bd33-c8a77649afb7"]
}, Closed]],
Cell[CellGroupData[{
Cell[134295, 3365, 90, 0, 38, "Subsection",ExpressionUUID->"b05847f7-0cfe-43d6-88c4-014ef3ddb0dd"],
Cell[134388, 3367, 2129, 59, 262, "Code",ExpressionUUID->"3e3005a5-6c98-4e26-bd10-dad515d4dea7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[136566, 3432, 115, 0, 67, "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],
Cell[CellGroupData[{
Cell[136706, 3436, 91, 0, 54, "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],
Cell[136800, 3438, 2552, 69, 281, "Code",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]],
Cell[CellGroupData[{
Cell[139389, 3512, 107, 0, 38, "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],
Cell[139499, 3514, 3946, 99, 605, "Code",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],
Cell[CellGroupData[{
Cell[143482, 3618, 113, 0, 38, "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],
Cell[143598, 3620, 601, 13, 72, "Code",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],
Cell[CellGroupData[{
Cell[144236, 3638, 94, 0, 38, "Subsection",ExpressionUUID->"f40fca3b-5ac3-45df-9833-1ec262db5844"],
Cell[144333, 3640, 1041, 26, 202, "Code",ExpressionUUID->"89ea601f-aa9b-4950-84c3-22eafdcf6db0"]
}, Closed]],
Cell[CellGroupData[{
Cell[145411, 3671, 112, 0, 38, "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],
Cell[145526, 3673, 3498, 86, 433, "Code",ExpressionUUID->"2fd91df5-6766-4d60-a3c7-53d9a52d7b96"],
Cell[149027, 3761, 2755, 67, 300, "Code",ExpressionUUID->"3ccd1308-4b25-462c-bf14-ca7dea82c5fe"],
Cell[151785, 3830, 2957, 73, 455, "Code",ExpressionUUID->"64b7b531-8b24-4dab-9ace-34e5f065c8da"],
Cell[154745, 3905, 2744, 77, 302, "Code",ExpressionUUID->"c2262ab8-69cd-440e-b350-a060080f50e2"],
Cell[157492, 3984, 800, 21, 148, "Code",ExpressionUUID->"2e1f31ff-6557-4fb9-aaa5-ab2f5e0c76c3"],
Cell[158295, 4007, 2464, 61, 300, "Code",ExpressionUUID->"380d18c6-2716-430c-9643-2330072de554"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[160808, 4074, 133, 0, 53, "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],
Cell[CellGroupData[{
Cell[160966, 4078, 91, 0, 54, "Subsection",ExpressionUUID->"f146e525-42d8-479e-959e-c8fb6ca1c4a2"],
Cell[161060, 4080, 233, 6, 52, "Code",ExpressionUUID->"73ad2a29-7f03-4219-8663-461f9518a7f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[161330, 4091, 86, 0, 38, "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],
Cell[161419, 4093, 1802, 45, 148, "Code",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"],
Cell[163224, 4140, 5266, 130, 738, "Code",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"],
Cell[168493, 4272, 10589, 273, 853, "Code",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"]
}, Closed]],
Cell[CellGroupData[{
Cell[179119, 4550, 86, 0, 38, "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],
Cell[179208, 4552, 2081, 51, 148, "Code",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"],
Cell[181292, 4605, 5590, 137, 775, "Code",ExpressionUUID->"1c3e576c-c667-475f-89cb-197999bffac7"],
Cell[186885, 4744, 11623, 296, 853, "Code",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"]
}, Closed]],
Cell[CellGroupData[{
Cell[198545, 5045, 96, 0, 38, "Subsection",ExpressionUUID->"dea4a3c2-e7ee-4f47-bf96-66929b110d6a"],
Cell[198644, 5047, 4132, 114, 339, "Code",ExpressionUUID->"4095e79d-34ef-435b-84d6-5f5641f09777"]
}, Closed]],
Cell[CellGroupData[{
Cell[202813, 5166, 98, 0, 38, "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],
Cell[202914, 5168, 3309, 90, 262, "Code",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"]
}, Closed]],
Cell[CellGroupData[{
Cell[206260, 5263, 132, 0, 38, "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],
Cell[206395, 5265, 2569, 70, 281, "Code",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]],
Cell[CellGroupData[{
Cell[209001, 5340, 93, 0, 38, "Subsection",ExpressionUUID->"f3b80113-3224-49a9-9e96-60dda4fcc677"],
Cell[209097, 5342, 2503, 72, 148, "Code",ExpressionUUID->"751f4008-59c9-41c2-a965-1bb8d19b428e"]
}, Closed]],
Cell[CellGroupData[{
Cell[211637, 5419, 164, 3, 38, "Subsection",ExpressionUUID->"929a533b-38ca-4691-bbf0-10109000ed9f"],
Cell[211804, 5424, 3949, 112, 186, "Code",ExpressionUUID->"e7d99d5c-47c2-4c13-bb77-affd8f0fda8f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[215802, 5542, 108, 0, 67, "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],
Cell[CellGroupData[{
Cell[215935, 5546, 89, 0, 54, "Subsection",ExpressionUUID->"412267ca-b4cd-4402-8196-31c933c269a3"],
Cell[216027, 5548, 1378, 38, 72, "Code",ExpressionUUID->"065b9a63-e5d1-40c0-a6bb-fb3c2b40fe15"]
}, Closed]],
Cell[CellGroupData[{
Cell[217442, 5591, 92, 0, 38, "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],
Cell[217537, 5593, 5595, 134, 510, "Code",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],
Cell[CellGroupData[{
Cell[223169, 5732, 105, 0, 38, "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],
Cell[223277, 5734, 3022, 82, 414, "Code",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],
Cell[226302, 5818, 3434, 93, 452, "Code",ExpressionUUID->"5198b681-d64a-4e20-97b8-8e031eacc149"]
}, Closed]],
Cell[CellGroupData[{
Cell[229773, 5916, 87, 0, 38, "Subsection",ExpressionUUID->"ba379b12-e39c-49a0-ba40-463bc3626108"],
Cell[229863, 5918, 2699, 70, 243, "Code",ExpressionUUID->"a23612de-3cf0-403e-b850-8a9c7144e63f"]
}, Closed]],
Cell[CellGroupData[{
Cell[232599, 5993, 93, 0, 38, "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],
Cell[232695, 5995, 3163, 79, 263, "Code",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],
Cell[235861, 6076, 493, 13, 52, "Code",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],
Cell[CellGroupData[{
Cell[236391, 6094, 93, 0, 38, "Subsection",ExpressionUUID->"901ddd13-737f-4e91-b19e-1ed99e5bece8"],
Cell[236487, 6096, 11634, 317, 1007, "Code",ExpressionUUID->"70f625df-561a-4796-a043-b09f24c338ff"],
Cell[248124, 6415, 1243, 33, 73, "Code",ExpressionUUID->"125d59ca-1967-4382-af1c-7ee3973c19c1"]
}, Closed]],
Cell[CellGroupData[{
Cell[249404, 6453, 112, 0, 38, "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],
Cell[249519, 6455, 5746, 163, 510, "Code",ExpressionUUID->"3b0edd43-f179-414d-aa01-523bd36dc076"],
Cell[255268, 6620, 6499, 179, 586, "Code",ExpressionUUID->"dc6fae3e-0250-465d-b252-f2807af8cf17"],
Cell[261770, 6801, 881, 24, 72, "Code",ExpressionUUID->"e71eaeac-52c8-47a5-808b-97451c4d3a99"]
}, Closed]],
Cell[CellGroupData[{
Cell[262688, 6830, 82, 0, 38, "Subsection",ExpressionUUID->"3ab5e732-329f-4489-88fd-99e349e91f19"],
Cell[262773, 6832, 2728, 66, 224, "Code",ExpressionUUID->"716f9373-6de2-4d61-b7b3-deac55ae485c"]
}, Closed]],
Cell[CellGroupData[{
Cell[265538, 6903, 87, 0, 38, "Subsection",ExpressionUUID->"cb7c2df9-dda8-4d22-bcab-38d90211eab7"],
Cell[265628, 6905, 1845, 51, 224, "Code",ExpressionUUID->"09b6a594-cbdf-4cab-a245-d13a757d3bde"]
}, Closed]],
Cell[CellGroupData[{
Cell[267510, 6961, 97, 0, 38, "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],
Cell[267610, 6963, 349, 10, 52, "Code",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],
Cell[267962, 6975, 2583, 71, 300, "Code",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],
Cell[270548, 7048, 1625, 45, 167, "Code",ExpressionUUID->"721a18ca-3636-47ac-8ec2-4481f8e47919"],
Cell[272176, 7095, 2348, 57, 281, "Code",ExpressionUUID->"52292cab-859e-4526-ad11-c2375d158cee"],
Cell[274527, 7154, 2576, 64, 262, "Code",ExpressionUUID->"d24fd5c7-bb15-4547-9025-38b6386831cb"],
Cell[277106, 7220, 2629, 64, 262, "Code",ExpressionUUID->"2cf05f30-ea55-4528-b268-4f693ccc6344"]
}, Closed]],
Cell[CellGroupData[{
Cell[279772, 7289, 89, 0, 38, "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],
Cell[279864, 7291, 1245, 33, 110, "Code",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Closed]],
Cell[CellGroupData[{
Cell[281146, 7329, 108, 0, 38, "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],
Cell[281257, 7331, 481, 10, 72, "Code",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],
Cell[281741, 7343, 1005, 26, 72, "Code",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],
Cell[282749, 7371, 965, 26, 72, "Code",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[283763, 7403, 106, 0, 53, "Section",ExpressionUUID->"8a6930c3-0554-4d2c-8310-f85820c57ead"],
Cell[CellGroupData[{
Cell[283894, 7407, 93, 0, 54, "Subsection",ExpressionUUID->"807f5525-dcf2-4be3-a3d6-f662db4b35c9"],
Cell[283990, 7409, 8976, 248, 775, "Code",ExpressionUUID->"ce76c6e6-607c-4339-bc44-5002db5363e0"]
}, Closed]],
Cell[CellGroupData[{
Cell[293003, 7662, 90, 0, 38, "Subsection",ExpressionUUID->"1c9d14aa-e4fa-43c7-a463-0fb0f975c854"],
Cell[293096, 7664, 4335, 126, 338, "Code",ExpressionUUID->"88781786-7762-436e-88e7-32ea57b8a248"]
}, Closed]],
Cell[CellGroupData[{
Cell[297468, 7795, 95, 0, 38, "Subsection",ExpressionUUID->"d8651388-086c-4e91-8a1b-4321d177cd65"],
Cell[297566, 7797, 2074, 55, 243, "Code",ExpressionUUID->"c265f046-0659-4ba0-a446-8dd92026215b"],
Cell[299643, 7854, 4044, 111, 281, "Code",ExpressionUUID->"b0c5ca40-ee5c-4e8e-a2be-e6c19ab5e11f"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[303736, 7971, 78, 0, 53, "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],
Cell[303817, 7973, 234, 7, 91, "Code",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[304100, 7986, 124, 0, 69, "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],
Cell[304227, 7988, 196, 5, 52, "Code",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],
Cell[CellGroupData[{
Cell[304448, 7997, 116, 0, 45, "Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],
Cell[304567, 7999, 1462, 38, 186, "Code",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[306066, 8042, 79, 0, 53, "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],
Cell[306148, 8044, 275, 7, 52, "Code",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],
Cell[306426, 8053, 295, 7, 52, "Code",ExpressionUUID->"dbb93444-1867-4df8-88d7-4358e4ecd562"],
Cell[306724, 8062, 3644, 77, 604, "Code",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],
Cell[310371, 8141, 3844, 85, 471, "Code",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],
Cell[314218, 8228, 2024, 42, 300, "Code",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],
Cell[316245, 8272, 5256, 107, 1079, "Code",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"]
}, Closed]],
Cell[CellGroupData[{
Cell[321538, 8384, 98, 0, 53, "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],
Cell[321639, 8386, 275, 7, 91, "Code",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"],
Cell[CellGroupData[{
Cell[321939, 8397, 110, 0, 45, "Subsubsection",ExpressionUUID->"ed34d4f5-8774-4cc3-bed1-932ddba5c4e5"],
Cell[322052, 8399, 1068, 28, 148, "Code",ExpressionUUID->"2f231e99-d644-4c44-a094-43842e8b7f0d"],
Cell[323123, 8429, 680, 18, 72, "Code",ExpressionUUID->"401605a1-d130-461c-8461-7baf9010c1df"]
}, Closed]],
Cell[CellGroupData[{
Cell[323840, 8452, 115, 0, 37, "Subsubsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],
Cell[323958, 8454, 530, 15, 52, "Code",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],
Cell[324491, 8471, 2346, 59, 281, "Code",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]],
Cell[CellGroupData[{
Cell[326874, 8535, 104, 0, 37, "Subsubsection",ExpressionUUID->"c0ea7bca-8a00-4f7c-b8e4-4b08c4e1cc6a"],
Cell[326981, 8537, 4064, 109, 395, "Code",ExpressionUUID->"064a5971-9036-4497-b86b-36c54839b48c"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[331094, 8652, 82, 0, 67, "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],
Cell[CellGroupData[{
Cell[331201, 8656, 100, 0, 54, "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],
Cell[CellGroupData[{
Cell[331326, 8660, 92, 0, 45, "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],
Cell[331421, 8662, 337, 8, 127, "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],
Cell[331761, 8672, 1431, 42, 243, "Code",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],
Cell[333195, 8716, 901, 25, 91, "Code",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],
Cell[CellGroupData[{
Cell[334133, 8746, 90, 0, 37, "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],
Cell[334226, 8748, 877, 27, 72, "Code",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Closed]],
Cell[CellGroupData[{
Cell[335140, 8780, 92, 0, 37, "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],
Cell[335235, 8782, 493, 15, 52, "Code",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],
Cell[CellGroupData[{
Cell[335765, 8802, 103, 0, 37, "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],
Cell[335871, 8804, 561, 16, 52, "Code",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],
Cell[336435, 8822, 657, 16, 72, "Code",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],
Cell[337095, 8840, 2416, 64, 262, "Code",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],
Cell[339514, 8906, 1210, 32, 110, "Code",ExpressionUUID->"d4b93424-3000-4189-9724-831b1489b36f"],
Cell[340727, 8940, 3787, 106, 338, "Code",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],
Cell[344517, 9048, 1057, 29, 110, "Code",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],
Cell[345577, 9079, 2413, 65, 300, "Code",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],
Cell[347993, 9146, 987, 28, 167, "Code",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],
Cell[348983, 9176, 593, 17, 52, "Code",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],
Cell[349579, 9195, 608, 15, 72, "Code",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[350236, 9216, 129, 0, 38, "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],
Cell[350368, 9218, 1574, 41, 281, "Code",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],
Cell[351945, 9261, 432, 11, 52, "Code",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],
Cell[352380, 9274, 1348, 34, 262, "Code",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],
Cell[CellGroupData[{
Cell[353765, 9313, 112, 0, 38, "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],
Cell[353880, 9315, 702, 16, 148, "Code",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],
Cell[354585, 9333, 540, 14, 129, "Code",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],
Cell[CellGroupData[{
Cell[355162, 9352, 97, 0, 38, "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],
Cell[355262, 9354, 684, 17, 148, "Code",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],
Cell[355949, 9373, 2156, 63, 300, "Code",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],
Cell[CellGroupData[{
Cell[358142, 9441, 137, 1, 38, "Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],
Cell[358282, 9444, 1962, 51, 225, "Code",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],
Cell[360247, 9497, 1767, 46, 206, "Code",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],
Cell[CellGroupData[{
Cell[362051, 9548, 110, 0, 38, "Subsection",ExpressionUUID->"2b820542-dab3-4d0b-9a97-bb3be4d7c4e1"],
Cell[362164, 9550, 3768, 99, 377, "Code",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"]
}, Closed]],
Cell[CellGroupData[{
Cell[365969, 9654, 147, 2, 38, "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],
Cell[366119, 9658, 1359, 34, 186, "Code",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[367527, 9698, 108, 0, 67, "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],
Cell[CellGroupData[{
Cell[367660, 9702, 194, 3, 54, "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],
Cell[367857, 9707, 1211, 35, 72, "Code",ExpressionUUID->"363014a0-649a-4fa7-9e0b-27134679686f"],
Cell[369071, 9744, 1539, 45, 72, "Code",ExpressionUUID->"972a811f-3d92-4ab4-91eb-dbcdea577d56"],
Cell[370613, 9791, 1283, 37, 72, "Code",ExpressionUUID->"1bd477fd-b514-4438-88a5-1f619ede0e10"],
Cell[371899, 9830, 1326, 38, 72, "Code",ExpressionUUID->"48138634-e03b-42d4-9ae9-f9f5ceaaf2e6"]
}, Closed]],
Cell[CellGroupData[{
Cell[373262, 9873, 105, 0, 38, "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],
Cell[373370, 9875, 1359, 36, 110, "Code",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],
Cell[374732, 9913, 954, 24, 129, "Code",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],
Cell[CellGroupData[{
Cell[375723, 9942, 115, 0, 38, "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],
Cell[375841, 9944, 5223, 153, 378, "Code",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"],
Cell[381067, 10099, 463, 12, 72, "Code",ExpressionUUID->"90948bbb-01c4-4119-a2a2-6a57e3256c77"]
}, Closed]],
Cell[CellGroupData[{
Cell[381567, 10116, 138, 1, 38, "Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],
Cell[381708, 10119, 3836, 100, 433, "Code",ExpressionUUID->"fc8e80b7-f492-45a8-ad2d-80d222d7c4ab"],
Cell[385547, 10221, 1289, 33, 129, "Code",ExpressionUUID->"166d33b4-951a-4278-9c5e-954e8a50f80a"],
Cell[386839, 10256, 3665, 94, 395, "Code",ExpressionUUID->"21b3ac33-1f56-4c92-a764-e44557b03761"]
}, Closed]],
Cell[CellGroupData[{
Cell[390541, 10355, 117, 0, 38, "Subsection",ExpressionUUID->"562e24b5-698b-4ad4-9b73-950bc1b6db48"],
Cell[CellGroupData[{
Cell[390683, 10359, 96, 0, 45, "Subsubsection",ExpressionUUID->"210b555e-5c19-4358-9e47-26ced9aa372d"],
Cell[390782, 10361, 3416, 82, 623, "Code",ExpressionUUID->"bc376d4f-976a-4a91-8624-a168657242d8"],
Cell[394201, 10445, 1095, 28, 243, "Code",ExpressionUUID->"ac8c466b-bdd6-43d4-b153-f11dd020cbac"],
Cell[395299, 10475, 3946, 117, 433, "Code",ExpressionUUID->"7ef42bab-eea8-41af-a2b3-82d26556d5de"]
}, Closed]],
Cell[CellGroupData[{
Cell[399282, 10597, 101, 0, 37, "Subsubsection",ExpressionUUID->"04e4ccfe-f5d0-4c69-876b-7beec801cf2e"],
Cell[399386, 10599, 4945, 123, 585, "Code",ExpressionUUID->"e5952930-964e-4841-997f-31b4bd81a8b9"]
}, Closed]],
Cell[CellGroupData[{
Cell[404368, 10727, 97, 0, 37, "Subsubsection",ExpressionUUID->"82434295-c65e-4c3d-9009-b10aad58af20"],
Cell[404468, 10729, 5238, 133, 547, "Code",ExpressionUUID->"109f3985-f817-4e88-8b45-46122daba2a6"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[409755, 10868, 105, 0, 38, "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],
Cell[409863, 10870, 722, 15, 91, "Code",ExpressionUUID->"df7f77be-d71a-46ab-b616-6e17020c9b7a"],
Cell[410588, 10887, 1365, 35, 167, "Code",ExpressionUUID->"dafcaf9d-3f50-4a2e-88c2-614692918714"],
Cell[411956, 10924, 494, 12, 72, "Code",ExpressionUUID->"abe71d3b-5e73-4cb1-9fde-e11a331960f2"],
Cell[412453, 10938, 2500, 67, 224, "Code",ExpressionUUID->"b0fdff5d-244d-4338-ab10-cb8aed660122"],
Cell[414956, 11007, 1731, 43, 205, "Code",ExpressionUUID->"e278c625-12c6-40c6-b352-5e956822f428"],
Cell[416690, 11052, 1612, 39, 206, "Code",ExpressionUUID->"00a4171d-66c9-4a8e-a0c6-6ada4dd4a4fa"],
Cell[418305, 11093, 1595, 41, 205, "Code",ExpressionUUID->"33307e51-3808-4b9a-9307-c503ffb0347c"],
Cell[419903, 11136, 6753, 168, 642, "Code",ExpressionUUID->"c31057a9-e7ec-4599-a3a8-91e81672b45a"],
Cell[426659, 11306, 620, 15, 72, "Code",ExpressionUUID->"47555025-a91c-47a2-a30c-77ab1984f094"]
}, Closed]],
Cell[CellGroupData[{
Cell[427316, 11326, 106, 0, 38, "Subsection",ExpressionUUID->"9cfdc11c-7ae4-4bc5-9b1d-79dc2c28c20a"],
Cell[427425, 11328, 1199, 30, 110, "Code",ExpressionUUID->"ca2e65ed-8d19-4650-9d7a-afae1df6efcc"]
}, Closed]],
Cell[CellGroupData[{
Cell[428661, 11363, 101, 0, 38, "Subsection",ExpressionUUID->"c9ba93b2-3e90-4f1f-8738-1c1dd5419c56"],
Cell[428765, 11365, 5436, 146, 642, "Code",ExpressionUUID->"894f0b58-5723-4d0e-809d-4ee4d9dc3d49"],
Cell[434204, 11513, 3491, 80, 414, "Code",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[437732, 11598, 96, 0, 38, "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],
Cell[437831, 11600, 3896, 101, 357, "Code",ExpressionUUID->"ffd7ea39-a364-44f4-94e2-69aab71ecae0"],
Cell[441730, 11703, 418, 11, 72, "Code",ExpressionUUID->"f855b1b9-6eff-4966-88ee-3d609bef8039"]
}, Closed]],
Cell[CellGroupData[{
Cell[442185, 11719, 100, 0, 38, "Subsection",ExpressionUUID->"a2de7482-cba2-4331-aa97-96a42e271549"],
Cell[442288, 11721, 1950, 49, 186, "Code",ExpressionUUID->"4f17c454-da11-4447-8d57-5317848adaf8"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[444287, 11776, 82, 0, 67, "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],
Cell[CellGroupData[{
Cell[444394, 11780, 223, 4, 81, "Subsection",ExpressionUUID->"6c532f1a-6b68-4aeb-bf90-019593cda361"],
Cell[CellGroupData[{
Cell[444642, 11788, 98, 0, 45, "Subsubsection",ExpressionUUID->"7d0695ab-1f95-4456-bdd4-8561d1a4a5d3"],
Cell[444743, 11790, 2912, 73, 243, "Code",ExpressionUUID->"ed59bca9-5f7a-4563-afbb-03d341794d53"]
}, Closed]],
Cell[CellGroupData[{
Cell[447692, 11868, 105, 0, 37, "Subsubsection",ExpressionUUID->"c7e5235f-14a6-4abe-b812-30b297accf20"],
Cell[447800, 11870, 2481, 61, 281, "Code",ExpressionUUID->"f046e6c6-b4ba-4075-9f4b-08d736a5ace0"]
}, Closed]],
Cell[CellGroupData[{
Cell[450318, 11936, 96, 0, 37, "Subsubsection",ExpressionUUID->"b00a89e2-31a5-4fdf-a915-adf6c32c6321"],
Cell[450417, 11938, 2166, 54, 167, "Code",ExpressionUUID->"74157408-0c66-4842-b8b7-e411e07d55a7"]
}, Closed]],
Cell[CellGroupData[{
Cell[452620, 11997, 96, 0, 37, "Subsubsection",ExpressionUUID->"f98efa5b-3c69-4077-8d5a-b51de41d58c8"],
Cell[452719, 11999, 2175, 55, 167, "Code",ExpressionUUID->"4b209ac4-fa60-42af-ba35-3792b420927e"]
}, Closed]],
Cell[CellGroupData[{
Cell[454931, 12059, 98, 0, 37, "Subsubsection",ExpressionUUID->"6bd1325f-52af-4db8-98a7-f6e93bc91db9"],
Cell[455032, 12061, 3791, 95, 262, "Code",ExpressionUUID->"0362da2d-fd61-40ec-b51e-c69ed928b0d7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[458872, 12162, 99, 0, 54, "Subsection",ExpressionUUID->"0fef66b1-5c36-4263-bc92-9241a15dc681"],
Cell[458974, 12164, 1355, 48, 300, "Code",ExpressionUUID->"33cc50ea-c5a6-457f-8f47-13118b690292"]
}, Closed]],
Cell[CellGroupData[{
Cell[460366, 12217, 101, 0, 38, "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],
Cell[CellGroupData[{
Cell[460492, 12221, 100, 0, 45, "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],
Cell[460595, 12223, 447, 14, 91, "Code",ExpressionUUID->"36f88f0a-d9f2-47b0-a1b3-bed489a613e0"],
Cell[461045, 12239, 2856, 74, 300, "Code",ExpressionUUID->"17b69bef-e499-4349-baa1-daabc117b244"],
Cell[463904, 12315, 2375, 68, 262, "Code",ExpressionUUID->"b3dd01b3-e2b3-4f86-9379-bb750cf02b0f"],
Cell[466282, 12385, 2630, 75, 262, "Code",ExpressionUUID->"18c2bce9-35f1-479d-aa0a-08040ce0fa9a"]
}, Closed]],
Cell[CellGroupData[{
Cell[468949, 12465, 100, 0, 37, "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],
Cell[469052, 12467, 447, 14, 91, "Code",ExpressionUUID->"949d5667-3ae5-4dec-b4c8-b878d6e06539"],
Cell[469502, 12483, 2595, 70, 262, "Code",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],
Cell[472100, 12555, 2729, 67, 414, "Code",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],
Cell[CellGroupData[{
Cell[474866, 12627, 107, 0, 37, "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],
Cell[474976, 12629, 469, 14, 91, "Code",ExpressionUUID->"8d3c9eb9-8577-40c3-b2a9-67a6dbfb2bd7"],
Cell[475448, 12645, 2602, 67, 224, "Code",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],
Cell[478053, 12714, 2596, 65, 395, "Code",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],
Cell[CellGroupData[{
Cell[480686, 12784, 94, 0, 37, "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],
Cell[480783, 12786, 427, 14, 91, "Code",ExpressionUUID->"a0547189-6c97-4c22-9294-333665d1f20e"],
Cell[481213, 12802, 2725, 72, 262, "Code",ExpressionUUID->"fe12d61c-c2b8-41f3-93cc-6879d3615206"],
Cell[483941, 12876, 8910, 204, 699, "Code",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],
Cell[492854, 13082, 7188, 175, 680, "Code",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],
Cell[CellGroupData[{
Cell[500079, 13262, 94, 0, 37, "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],
Cell[500176, 13264, 573, 18, 110, "Code",ExpressionUUID->"1258f73c-5d73-4fd1-89c9-b8572c60a5f2"],
Cell[500752, 13284, 4470, 125, 300, "Code",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],
Cell[505225, 13411, 28507, 680, 2599, "Code",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],
Cell[CellGroupData[{
Cell[533769, 14096, 90, 0, 37, "Subsubsection",ExpressionUUID->"d3174cc3-0acb-46eb-8dda-1333a3ceb442"],
Cell[533862, 14098, 400, 12, 91, "Code",ExpressionUUID->"f802bda3-d5f3-4d3e-b81c-3e76a69ab79b"],
Cell[534265, 14112, 1110, 31, 148, "Code",ExpressionUUID->"47774888-3edf-4b60-83d4-34a5e6235fb7"],
Cell[535378, 14145, 2753, 80, 281, "Code",ExpressionUUID->"2a0a3d4f-9fca-4409-ad68-00efd98262eb"],
Cell[538134, 14227, 14516, 351, 1497, "Code",ExpressionUUID->"b05096c8-cccb-4a62-8f5e-3eadb3574667"]
}, Closed]],
Cell[CellGroupData[{
Cell[552687, 14583, 92, 0, 37, "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],
Cell[552782, 14585, 421, 14, 91, "Code",ExpressionUUID->"85e56c67-2bab-445d-9c45-3aa8de10dd5c"],
Cell[553206, 14601, 1620, 44, 167, "Code",ExpressionUUID->"39e4fbce-94cb-4ec1-909a-9be6211b734a"],
Cell[554829, 14647, 891, 26, 72, "Code",ExpressionUUID->"c161f406-b316-4337-bc62-09fbc7236f0c"],
Cell[555723, 14675, 9274, 214, 680, "Code",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],
Cell[565000, 14891, 3158, 84, 281, "Code",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],
Cell[568161, 14977, 2387, 65, 281, "Code",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],
Cell[CellGroupData[{
Cell[570585, 15047, 100, 0, 37, "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],
Cell[570688, 15049, 340, 10, 72, "Code",ExpressionUUID->"b80bf0d1-baf4-427d-be8d-d95034e606a0"],
Cell[571031, 15061, 5743, 152, 680, "Code",ExpressionUUID->"105425f9-6faa-403b-bf41-cd3b92587bc2"],
Cell[576777, 15215, 19404, 477, 832, "Code",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Closed]],
Cell[CellGroupData[{
Cell[596218, 15697, 107, 0, 37, "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],
Cell[596328, 15699, 342, 10, 72, "Code",ExpressionUUID->"e3cc1134-2603-4b48-a8e9-658a0ea43da5"],
Cell[596673, 15711, 1602, 43, 167, "Code",ExpressionUUID->"c2dc76eb-f1f2-4627-94b2-322d01f7c229"],
Cell[598278, 15756, 2297, 60, 281, "Code",ExpressionUUID->"983639bb-e7ad-4ed8-a16b-1a1e153cc30e"],
Cell[600578, 15818, 6922, 148, 452, "Code",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],
Cell[607503, 15968, 761, 23, 72, "Code",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[608313, 15997, 102, 0, 54, "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],
Cell[CellGroupData[{
Cell[608440, 16001, 122, 0, 45, "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],
Cell[608565, 16003, 1472, 37, 129, "Code",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],
Cell[610040, 16042, 1578, 42, 186, "Code",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"],
Cell[611621, 16086, 3440, 97, 262, "Code",ExpressionUUID->"fc7c8ee8-7208-4bfb-b0d2-9a8e8f5faa83"],
Cell[615064, 16185, 2848, 75, 262, "Code",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"]
}, Closed]],
Cell[CellGroupData[{
Cell[617949, 16265, 101, 0, 37, "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],
Cell[618053, 16267, 2034, 52, 186, "Code",ExpressionUUID->"a8f653e6-0073-4e26-88b3-b7e9ea5fa4e3"]
}, Closed]],
Cell[CellGroupData[{
Cell[620124, 16324, 96, 0, 37, "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],
Cell[620223, 16326, 613, 16, 72, "Code",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],
Cell[CellGroupData[{
Cell[620873, 16347, 95, 0, 37, "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],
Cell[620971, 16349, 1031, 26, 129, "Code",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[622039, 16380, 94, 0, 37, "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],
Cell[622136, 16382, 1022, 26, 129, "Code",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],
Cell[CellGroupData[{
Cell[623195, 16413, 94, 0, 37, "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],
Cell[623292, 16415, 627, 16, 72, "Code",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],
Cell[CellGroupData[{
Cell[623956, 16436, 93, 0, 37, "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],
Cell[624052, 16438, 619, 16, 72, "Code",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],
Cell[CellGroupData[{
Cell[624708, 16459, 96, 0, 37, "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],
Cell[624807, 16461, 497, 12, 72, "Code",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],
Cell[CellGroupData[{
Cell[625341, 16478, 120, 0, 37, "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],
Cell[625464, 16480, 623, 16, 72, "Code",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],
Cell[626090, 16498, 647, 16, 72, "Code",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]],
Cell[CellGroupData[{
Cell[626774, 16519, 106, 0, 37, "Subsubsection",ExpressionUUID->"629e0869-a792-448b-b759-8452461b16c9"],
Cell[626883, 16521, 353, 9, 52, "Code",ExpressionUUID->"77d06f1b-f7ab-4500-a658-4079097e7227"],
Cell[627239, 16532, 2486, 68, 357, "Code",ExpressionUUID->"63542191-1f62-4e2b-9a55-5238b3bb62ea"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[629786, 16607, 86, 0, 67, "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],
Cell[CellGroupData[{
Cell[629897, 16611, 105, 0, 54, "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],
Cell[630005, 16613, 196, 3, 35, "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],
Cell[630204, 16618, 3057, 70, 414, "Code",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],
Cell[633264, 16690, 2101, 55, 357, "Code",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[635414, 16751, 78, 0, 67, "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],
Cell[635495, 16753, 234, 7, 91, "Code",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[635778, 16766, 125, 0, 69, "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],
Cell[635906, 16768, 196, 5, 52, "Code",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],
Cell[CellGroupData[{
Cell[636127, 16777, 79, 0, 67, "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],
Cell[636209, 16779, 1319, 29, 205, "Code",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],
Cell[637531, 16810, 903, 18, 148, "Code",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],
Cell[638437, 16830, 2187, 53, 224, "Code",ExpressionUUID->"6df18a0e-6370-480c-a4c0-79be3746c9f5"],
Cell[640627, 16885, 2865, 56, 509, "Code",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],
Cell[643495, 16943, 2710, 55, 490, "Code",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],
Cell[646208, 17000, 4138, 74, 357, "Code",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],
Cell[650349, 17076, 2907, 50, 224, "Code",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[653293, 17131, 85, 0, 53, "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],
Cell[653381, 17133, 364, 10, 110, "Code",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"]
}, Open  ]],
Cell[CellGroupData[{
Cell[653782, 17148, 100, 0, 67, "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],
Cell[CellGroupData[{
Cell[653907, 17152, 92, 0, 54, "Subsection",ExpressionUUID->"99d232f2-b91d-458c-a3db-d922760b95e4"],
Cell[654002, 17154, 1390, 36, 205, "Code",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],
Cell[CellGroupData[{
Cell[655429, 17195, 97, 0, 38, "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],
Cell[655529, 17197, 1514, 38, 129, "Code",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],
Cell[CellGroupData[{
Cell[657080, 17240, 94, 0, 38, "Subsection",ExpressionUUID->"8488fe5a-cff7-4dfa-ac4b-5654c56b2c7f"],
Cell[657177, 17242, 2800, 78, 262, "Code",ExpressionUUID->"379532fc-ab3b-4100-8b5e-6183b7f55947"],
Cell[659980, 17322, 4880, 134, 585, "Code",ExpressionUUID->"2e6066e1-9346-4cd8-aed9-3d85923df3d3"],
Cell[664863, 17458, 1094, 28, 205, "Code",ExpressionUUID->"1215db5f-4226-4914-976f-95e9ec2bdd56"]
}, Closed]],
Cell[CellGroupData[{
Cell[665994, 17491, 122, 0, 38, "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],
Cell[666119, 17493, 4282, 112, 548, "Code",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],
Cell[670404, 17607, 2566, 63, 300, "Code",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],
Cell[CellGroupData[{
Cell[673007, 17675, 190, 3, 38, "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],
Cell[673200, 17680, 2010, 53, 186, "Code",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],
Cell[675213, 17735, 5375, 122, 775, "Code",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"],
Cell[680591, 17859, 2233, 55, 281, "Code",ExpressionUUID->"d950c243-7cbd-4fa7-9959-4787123d60ec"]
}, Closed]],
Cell[CellGroupData[{
Cell[682861, 17919, 93, 0, 38, "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],
Cell[682957, 17921, 3857, 110, 471, "Code",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],
Cell[CellGroupData[{
Cell[686851, 18036, 94, 0, 38, "Subsection",ExpressionUUID->"8bb00a64-b11b-49dc-8019-90801a7f898c"],
Cell[686948, 18038, 1104, 30, 186, "Code",ExpressionUUID->"d5b77de4-6377-4475-99bc-9c004e543f84"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[688101, 18074, 105, 0, 67, "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],
Cell[CellGroupData[{
Cell[688231, 18078, 88, 0, 54, "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],
Cell[688322, 18080, 1598, 43, 186, "Code",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"],
Cell[689923, 18125, 2473, 69, 452, "Code",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],
Cell[CellGroupData[{
Cell[692433, 18199, 96, 0, 38, "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],
Cell[692532, 18201, 7714, 181, 642, "Code",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[700283, 18387, 104, 0, 38, "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],
Cell[700390, 18389, 7753, 182, 623, "Code",ExpressionUUID->"c1058285-daa4-49c3-b6e6-cf523195583e"]
}, Closed]],
Cell[CellGroupData[{
Cell[708180, 18576, 86, 0, 38, "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],
Cell[708269, 18578, 1843, 50, 167, "Code",ExpressionUUID->"91d3ea7e-b367-4d8f-a2e1-b86f413fad70"],
Cell[710115, 18630, 2509, 71, 205, "Code",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]],
Cell[CellGroupData[{
Cell[712661, 18706, 100, 0, 38, "Subsection",ExpressionUUID->"4ad8f35c-0c6e-432e-92bd-045a2058c437"],
Cell[712764, 18708, 4334, 115, 376, "Code",ExpressionUUID->"aac3bd51-98d4-4ee4-9066-cb36ede9eb5c"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[717147, 18829, 98, 0, 67, "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],
Cell[CellGroupData[{
Cell[717270, 18833, 96, 0, 54, "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],
Cell[717369, 18835, 1465, 36, 167, "Code",ExpressionUUID->"adb8d8ad-2a69-432e-9101-5ef289672aa6"],
Cell[718837, 18873, 10502, 254, 1136, "Code",ExpressionUUID->"b8878c3c-97d6-4b85-9234-4ded19c9f3fd"]
}, Closed]],
Cell[CellGroupData[{
Cell[729376, 19132, 104, 0, 38, "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],
Cell[729483, 19134, 1554, 38, 167, "Code",ExpressionUUID->"216009e6-27cf-4f6b-9566-2fc20f53096e"],
Cell[731040, 19174, 1657, 40, 148, "Code",ExpressionUUID->"4385e954-e342-443c-8abf-76c8d77153d4"]
}, Closed]],
Cell[CellGroupData[{
Cell[732734, 19219, 107, 0, 38, "Subsection",ExpressionUUID->"b7156b33-cb6c-4b74-aacf-f98656168e47"],
Cell[732844, 19221, 2632, 62, 300, "Code",ExpressionUUID->"3a934fb1-218e-48da-8317-5d5bb9db883c"],
Cell[735479, 19285, 2015, 53, 263, "Code",ExpressionUUID->"6e993a3f-65cf-4f0e-8d03-1432e921ee46"],
Cell[737497, 19340, 2960, 64, 414, "Code",ExpressionUUID->"1541376a-e966-4f59-8e04-b3265424a372"],
Cell[CellGroupData[{
Cell[740482, 19408, 104, 0, 45, "Subsubsection",ExpressionUUID->"8eb12589-13d0-4db1-8d82-5a7f3627cf24"],
Cell[740589, 19410, 4136, 108, 376, "Code",ExpressionUUID->"d23ba088-27d1-4486-af97-c5061397f6ff"],
Cell[744728, 19520, 225, 6, 52, "Code",ExpressionUUID->"49ff6c33-b326-4e81-9f7f-58b38ecac55a"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[745002, 19532, 94, 0, 38, "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],
Cell[745099, 19534, 2160, 66, 262, "Code",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],
Cell[747262, 19602, 2047, 51, 205, "Code",ExpressionUUID->"680aac2e-d58b-40c8-b7d4-ea52edea8b7d"],
Cell[749312, 19655, 2164, 54, 281, "Code",ExpressionUUID->"64b80402-9692-43c6-ade1-c477b2b2a0a8"],
Cell[751479, 19711, 10023, 261, 1079, "Code",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"],
Cell[761505, 19974, 26368, 731, 112, "Code",ExpressionUUID->"2df2e8ac-6715-419b-b5cd-63a7ffa6face"]
}, Open  ]],
Cell[CellGroupData[{
Cell[787910, 20710, 102, 0, 54, "Subsection",ExpressionUUID->"fdb08a27-d392-4708-8d7c-e22a50d18359"],
Cell[CellGroupData[{
Cell[788037, 20714, 120, 0, 45, "Subsubsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],
Cell[788160, 20716, 1249, 32, 243, "Code",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],
Cell[789412, 20750, 1978, 58, 205, "Code",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],
Cell[CellGroupData[{
Cell[791427, 20813, 151, 2, 37, "Subsubsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],
Cell[791581, 20817, 912, 24, 129, "Code",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],
Cell[CellGroupData[{
Cell[792530, 20846, 105, 0, 37, "Subsubsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],
Cell[792638, 20848, 419, 11, 52, "Code",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],
Cell[793060, 20861, 2347, 60, 262, "Code",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],
Cell[795410, 20923, 1757, 43, 338, "Code",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],
Cell[797170, 20968, 2462, 64, 376, "Code",ExpressionUUID->"92ffeed0-c3d9-4161-bdf3-36b3e40fc494"],
Cell[799635, 21034, 2569, 67, 376, "Code",ExpressionUUID->"fc66d059-3816-4b04-a69b-80ebdc0fcb74"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[802265, 21108, 88, 0, 67, "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],
Cell[CellGroupData[{
Cell[802378, 21112, 104, 0, 54, "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],
Cell[802485, 21114, 3269, 79, 395, "Code",ExpressionUUID->"f5d34dd7-f02b-4a87-8ec4-af2aadddd1bb"],
Cell[805757, 21195, 6330, 158, 775, "Code",ExpressionUUID->"d218d248-ce20-48a5-af65-68e0c4272cc5"]
}, Closed]],
Cell[CellGroupData[{
Cell[812124, 21358, 113, 0, 38, "Subsection",ExpressionUUID->"ad21117c-44e4-446d-8ebc-675dcaedf199"],
Cell[812240, 21360, 155, 2, 35, "Text",ExpressionUUID->"9e39eab6-78a5-47c9-8d4a-3e1e48178ab7"],
Cell[812398, 21364, 1039, 26, 148, "Code",ExpressionUUID->"6dac9b4f-30a2-4a84-a0c4-510db4fe60c0"],
Cell[813440, 21392, 1934, 47, 224, "Code",ExpressionUUID->"48032c11-b473-4e3c-8376-40462be1cec4"],
Cell[815377, 21441, 2578, 71, 319, "Code",ExpressionUUID->"76236e65-adae-458b-9b18-cad6148ca08d"]
}, Closed]],
Cell[CellGroupData[{
Cell[817992, 21517, 122, 0, 38, "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],
Cell[818117, 21519, 4326, 112, 376, "Code",ExpressionUUID->"ae1e713b-def1-4284-a80c-7c15c0aec447"],
Cell[822446, 21633, 3895, 99, 319, "Code",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],
Cell[CellGroupData[{
Cell[826378, 21737, 100, 0, 38, "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],
Cell[826481, 21739, 6161, 141, 737, "Code",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]],
Cell[CellGroupData[{
Cell[832679, 21885, 108, 0, 38, "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],
Cell[832790, 21887, 489, 13, 52, "Code",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],
Cell[833282, 21902, 2811, 69, 415, "Code",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],
Cell[836096, 21973, 858, 22, 110, "Code",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],
Cell[836957, 21997, 4913, 117, 756, "Code",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],
Cell[841873, 22116, 6503, 165, 623, "Code",ExpressionUUID->"acf53775-617a-4c64-abce-1ca8d0a00a98"],
Cell[848379, 22283, 1244, 31, 224, "Code",ExpressionUUID->"cc158a20-c3f3-4d03-9644-fc087c2118ee"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[849672, 22320, 114, 0, 67, "Section",ExpressionUUID->"d6a44126-9792-4309-a17f-48bcc9564428"],
Cell[CellGroupData[{
Cell[849811, 22324, 112, 0, 54, "Subsection",ExpressionUUID->"5e57b61a-d219-4934-a890-cd59956902d1"],
Cell[849926, 22326, 6294, 148, 680, "Code",ExpressionUUID->"b8f6c0e1-9575-4565-94e8-3146faa40eae"]
}, Closed]],
Cell[CellGroupData[{
Cell[856257, 22479, 102, 0, 38, "Subsection",ExpressionUUID->"bc938ce6-3992-448f-acc2-17a2ed40c182"],
Cell[856362, 22481, 1596, 43, 262, "Code",ExpressionUUID->"dad8f07f-6e82-4d90-82ad-f6ac6a36ef22"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[858007, 22530, 93, 0, 67, "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],
Cell[CellGroupData[{
Cell[858125, 22534, 102, 0, 54, "Subsection",ExpressionUUID->"73422a9f-f78f-40d0-b5cf-0b9ca1818700"],
Cell[858230, 22536, 1155, 32, 148, "Code",ExpressionUUID->"3e97a0de-a970-4d5c-ab00-d0691ecf3e87"],
Cell[859388, 22570, 2567, 61, 357, "Code",ExpressionUUID->"cad7656e-ac79-4b74-bd8a-9e72c0644b19"],
Cell[CellGroupData[{
Cell[861980, 22635, 171, 3, 45, "Subsubsection",ExpressionUUID->"ce099429-1333-43b9-b495-fa2b90f21605"],
Cell[862154, 22640, 3807, 93, 357, "Code",ExpressionUUID->"9357dc4e-c4b9-4298-9e85-37d87e5d3ebc"]
}, Closed]],
Cell[CellGroupData[{
Cell[865998, 22738, 113, 0, 37, "Subsubsection",ExpressionUUID->"603d4498-8b6c-4503-933d-b4a9c97b5661"],
Cell[866114, 22740, 12972, 300, 1725, "Code",ExpressionUUID->"9c6a83e3-770d-4c96-b30e-1d9e09063824"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[879135, 23046, 148, 2, 38, "Subsection",ExpressionUUID->"f771deb2-a4a2-400f-b0c2-7680cc5b00ac"],
Cell[879286, 23050, 1117, 28, 243, "Code",ExpressionUUID->"4315eb56-9425-419f-b071-2e2f797f402d"],
Cell[880406, 23080, 738, 19, 110, "Code",ExpressionUUID->"f36975ed-8d9f-4ec4-babc-cce78e40b1a9"],
Cell[881147, 23101, 3708, 101, 358, "Code",ExpressionUUID->"bd2ebe0c-ce7f-45f7-bfc1-49aa1aec9a95"],
Cell[884858, 23204, 3448, 80, 300, "Code",ExpressionUUID->"1b30499b-3dd1-4129-8c80-b3664c73ca01"],
Cell[888309, 23286, 674, 16, 91, "Code",ExpressionUUID->"e01b2e15-065d-44be-a333-3bb058054274"],
Cell[888986, 23304, 2791, 76, 263, "Code",ExpressionUUID->"a850dc3b-621f-4bd6-aaee-873395b1bb45"],
Cell[891780, 23382, 2453, 68, 226, "Code",ExpressionUUID->"d0b96612-939a-4fb2-8f6e-a03a87c8f541"],
Cell[894236, 23452, 3562, 84, 300, "Code",ExpressionUUID->"d9dde884-5ff3-466a-b915-739df74cc11a"],
Cell[897801, 23538, 4307, 102, 300, "Code",ExpressionUUID->"78b2f67f-dc48-44fe-9713-fc2cd8b3ffff"],
Cell[902111, 23642, 5991, 142, 566, "Code",ExpressionUUID->"e09521af-e51f-454e-acee-9ae42f06aee1"]
}, Closed]],
Cell[CellGroupData[{
Cell[908139, 23789, 101, 0, 38, "Subsection",ExpressionUUID->"70fa9bc8-0774-4c9e-b67f-9bd9be81f808"],
Cell[908243, 23791, 9380, 243, 1079, "Code",ExpressionUUID->"0b3e82e1-9782-44ba-a8ab-6a1e680d3561"],
Cell[917626, 24036, 1936, 45, 281, "Code",ExpressionUUID->"908b3a1d-a33f-4549-ac93-a0bb0355f103"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[919611, 24087, 89, 0, 67, "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],
Cell[CellGroupData[{
Cell[919725, 24091, 107, 0, 54, "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],
Cell[919835, 24093, 265, 6, 35, "Text",ExpressionUUID->"4a653e1c-eeb8-4064-b854-41501624a19e"],
Cell[920103, 24101, 1000, 24, 167, "Code",ExpressionUUID->"0667504c-8c02-4916-b24b-3bb7bdc2cf26"],
Cell[921106, 24127, 5361, 137, 604, "Code",ExpressionUUID->"c18d8317-ae43-4b7f-9da1-c3475f665d7f"],
Cell[926470, 24266, 3536, 79, 414, "Code",ExpressionUUID->"f0a82410-c535-47a8-948b-b21f94c95228"],
Cell[930009, 24347, 377, 9, 52, "Code",ExpressionUUID->"431662f0-2ecf-4999-bdfc-bca5f77db73b"],
Cell[930389, 24358, 8645, 212, 1155, "Code",ExpressionUUID->"d4e68e5a-9602-4a4a-b440-17bbf19734d3"],
Cell[939037, 24572, 2229, 52, 357, "Code",ExpressionUUID->"d0c74681-d7be-4943-bdb3-e78c2132a41c"],
Cell[941269, 24626, 2083, 51, 376, "Code",ExpressionUUID->"486130dd-c91f-4635-9d83-1f3bd0aa6d73"],
Cell[943355, 24679, 551, 13, 72, "Code",ExpressionUUID->"2ef881ff-eeb2-4d0c-9acd-87ee573cc4ed"]
}, Closed]],
Cell[CellGroupData[{
Cell[943943, 24697, 109, 0, 38, "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],
Cell[944055, 24699, 758, 19, 129, "Code",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],
Cell[944816, 24720, 2696, 69, 338, "Code",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],
Cell[947515, 24791, 9688, 240, 1041, "Code",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Closed]],
Cell[CellGroupData[{
Cell[957240, 25036, 100, 0, 38, "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],
Cell[957343, 25038, 1551, 41, 186, "Code",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[958943, 25085, 78, 0, 67, "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],
Cell[959024, 25087, 234, 7, 91, "Code",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[959307, 25100, 115, 0, 69, "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],
Cell[959425, 25102, 195, 5, 52, "Code",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],
Cell[CellGroupData[{
Cell[959645, 25111, 79, 0, 67, "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],
Cell[959727, 25113, 262, 7, 52, "Code",ExpressionUUID->"1b53aab2-8ab9-4869-815e-f8ca47d5626d"],
Cell[959992, 25122, 505, 10, 91, "Code",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],
Cell[960500, 25134, 479, 10, 72, "Code",ExpressionUUID->"01f2dfa2-986a-4b95-b411-c600af854f43"],
Cell[960982, 25146, 889, 18, 129, "Code",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],
Cell[961874, 25166, 604, 14, 110, "Code",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],
Cell[962481, 25182, 1512, 31, 262, "Code",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],
Cell[963996, 25215, 434, 9, 91, "Code",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],
Cell[964433, 25226, 1134, 21, 72, "Code",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],
Cell[965570, 25249, 734, 16, 110, "Code",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],
Cell[966307, 25267, 694, 14, 72, "Code",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],
Cell[967004, 25283, 714, 14, 72, "Code",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],
Cell[967721, 25299, 737, 16, 129, "Code",ExpressionUUID->"83f8a726-efe7-4110-956b-bca1ea384930"],
Cell[968461, 25317, 333, 8, 52, "Code",ExpressionUUID->"b00e700d-c96f-4280-83fe-545c8730966e"],
Cell[968797, 25327, 307, 7, 52, "Code",ExpressionUUID->"b96f0aa2-0ec5-4585-8f0e-6182e0b65a44"]
}, Closed]],
Cell[CellGroupData[{
Cell[969141, 25339, 80, 0, 53, "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],
Cell[969224, 25341, 451, 12, 129, "Code",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Closed]],
Cell[CellGroupData[{
Cell[969712, 25358, 96, 0, 53, "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],
Cell[CellGroupData[{
Cell[969833, 25362, 87, 0, 54, "Subsection",ExpressionUUID->"8042e1d7-58bf-4a7b-a670-9ef09527dcb3"],
Cell[969923, 25364, 1891, 52, 319, "Code",ExpressionUUID->"5cbe27db-29f9-4589-9b2f-70c34eebdd51"]
}, Closed]],
Cell[CellGroupData[{
Cell[971851, 25421, 88, 0, 38, "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],
Cell[971942, 25423, 425, 11, 72, "Code",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],
Cell[972370, 25436, 3147, 83, 452, "Code",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"],
Cell[975520, 25521, 295, 7, 52, "Code",ExpressionUUID->"e14ea647-8b7f-4eae-a125-7e43a795f52c"]
}, Closed]],
Cell[CellGroupData[{
Cell[975852, 25533, 91, 0, 38, "Subsection",ExpressionUUID->"f78cb6e6-e17d-4401-b894-51df89a02adc"],
Cell[975946, 25535, 237, 6, 52, "Code",ExpressionUUID->"baf9e747-4ee8-4def-a102-84008b907460"],
Cell[976186, 25543, 4413, 118, 471, "Code",ExpressionUUID->"3ada8627-442a-43cd-ad7d-0325bd932b0d"],
Cell[980602, 25663, 6222, 159, 870, "Code",ExpressionUUID->"086f898d-2364-4076-b6fb-a0b39bc483dd"]
}, Closed]],
Cell[CellGroupData[{
Cell[986861, 25827, 87, 0, 38, "Subsection",ExpressionUUID->"b01f488c-40c8-4d7f-bcc9-c39f7a7d7b49"],
Cell[986951, 25829, 7125, 186, 680, "Code",ExpressionUUID->"df661cfd-ae0b-44c1-87df-b4da3007a4a3"]
}, Closed]],
Cell[CellGroupData[{
Cell[994113, 26020, 94, 0, 38, "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],
Cell[994210, 26022, 240, 6, 52, "Code",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],
Cell[994453, 26030, 7778, 190, 661, "Code",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1002268, 26225, 92, 0, 38, "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],
Cell[1002363, 26227, 700, 16, 205, "Code",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],
Cell[1003066, 26245, 6288, 156, 680, "Code",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],
Cell[1009357, 26403, 4808, 121, 529, "Code",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],
Cell[CellGroupData[{
Cell[1014202, 26529, 101, 0, 38, "Subsection",ExpressionUUID->"cb5c27e0-90ba-44a2-b621-549bf08cb232"],
Cell[1014306, 26531, 2201, 54, 281, "Code",ExpressionUUID->"57ab66e2-d535-4e5f-873b-1254aa74d5b1"],
Cell[1016510, 26587, 17841, 472, 330, "Code",ExpressionUUID->"cd236665-00fe-4e3a-9fdf-305558993417"],
Cell[1034354, 27061, 636, 17, 52, "Code",ExpressionUUID->"95b63ef6-b4a3-43c9-b577-8fb55e64adf9"]
}, Closed]],
Cell[CellGroupData[{
Cell[1035027, 27083, 96, 0, 38, "Subsection",ExpressionUUID->"998277f7-e77f-481f-8d03-2b6fa89387fe"],
Cell[1035126, 27085, 5412, 133, 661, "Code",ExpressionUUID->"6d9f25cf-a57b-4e21-b29e-24805f43aeb2"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1040587, 27224, 89, 0, 67, "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],
Cell[CellGroupData[{
Cell[1040701, 27228, 95, 0, 54, "Subsection",ExpressionUUID->"6f76eeb7-891c-4cae-a5ac-4d64373ec68b"],
Cell[1040799, 27230, 6686, 181, 699, "Code",ExpressionUUID->"8b6d2599-7eb7-438a-b947-9bbf95f936df"]
}, Closed]],
Cell[CellGroupData[{
Cell[1047522, 27416, 91, 0, 38, "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],
Cell[1047616, 27418, 361, 10, 110, "Code",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],
Cell[1047980, 27430, 411, 11, 72, "Code",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],
Cell[1048394, 27443, 700, 19, 91, "Code",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],
Cell[1049097, 27464, 794, 23, 91, "Code",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],
Cell[1049894, 27489, 1902, 45, 357, "Code",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],
Cell[1051799, 27536, 894, 24, 73, "Code",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],
Cell[CellGroupData[{
Cell[1052730, 27565, 88, 0, 38, "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],
Cell[1052821, 27567, 370, 10, 110, "Code",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],
Cell[1053194, 27579, 1858, 52, 319, "Code",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],
Cell[1055055, 27633, 1217, 34, 224, "Code",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],
Cell[1056275, 27669, 1691, 47, 262, "Code",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],
Cell[CellGroupData[{
Cell[1058003, 27721, 94, 0, 38, "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],
Cell[1058100, 27723, 5278, 142, 452, "Code",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],
Cell[CellGroupData[{
Cell[1063415, 27870, 92, 0, 38, "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],
Cell[1063510, 27872, 6452, 174, 452, "Code",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1070011, 28052, 86, 0, 67, "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],
Cell[CellGroupData[{
Cell[1070122, 28056, 98, 0, 54, "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],
Cell[1070223, 28058, 1147, 27, 91, "Code",ExpressionUUID->"5a272a8d-b37b-477f-a024-ee728ce8ca49"],
Cell[1071373, 28087, 1071, 31, 110, "Code",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"],
Cell[1072447, 28120, 2387, 61, 338, "Code",ExpressionUUID->"0f22cd14-f2c6-414f-9ee6-3d896ed5cfcc"]
}, Closed]],
Cell[CellGroupData[{
Cell[1074871, 28186, 96, 0, 38, "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],
Cell[1074970, 28188, 2781, 73, 224, "Code",ExpressionUUID->"9464b0a7-e384-4ae5-9af9-43a3e239bf92"],
Cell[1077754, 28263, 1840, 48, 243, "Code",ExpressionUUID->"abf836c2-0f64-4bef-a1a6-0c0029eb66ae"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1079643, 28317, 95, 0, 67, "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],
Cell[CellGroupData[{
Cell[1079763, 28321, 127, 0, 54, "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],
Cell[1079893, 28323, 6696, 177, 718, "Code",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],
Cell[CellGroupData[{
Cell[1086626, 28505, 93, 0, 38, "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],
Cell[1086722, 28507, 1829, 46, 243, "Code",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],
Cell[1088554, 28555, 591, 16, 52, "Code",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],
Cell[1089148, 28573, 3306, 85, 357, "Code",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],
Cell[1092457, 28660, 4911, 128, 452, "Code",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],
Cell[CellGroupData[{
Cell[1097405, 28793, 91, 0, 38, "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],
Cell[1097499, 28795, 3054, 79, 414, "Code",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],
Cell[CellGroupData[{
Cell[1100590, 28879, 86, 0, 38, "Subsection",ExpressionUUID->"db3d8342-8d8e-4752-845f-f3b764a796fb"],
Cell[1100679, 28881, 1562, 42, 186, "Code",ExpressionUUID->"63f61e01-74fc-40c9-934b-7d2c34da1f73"]
}, Closed]],
Cell[CellGroupData[{
Cell[1102278, 28928, 123, 0, 38, "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],
Cell[1102404, 28930, 842, 23, 91, "Code",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],
Cell[CellGroupData[{
Cell[1103283, 28958, 99, 0, 38, "Subsection",ExpressionUUID->"e536bc67-8dac-439c-9b64-663526d4bf1d"],
Cell[1103385, 28960, 5928, 155, 566, "Code",ExpressionUUID->"a2cd35af-dbac-415c-ae7f-35b450b3699e"],
Cell[1109316, 29117, 3445, 89, 357, "Code",ExpressionUUID->"26dfeae0-7a2f-41aa-bacf-11526f181415"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1112810, 29212, 78, 0, 67, "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],
Cell[1112891, 29214, 234, 7, 91, "Code",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1113174, 29227, 93, 0, 58, "Chapter",ExpressionUUID->"4e117d75-efd0-4fbb-9ab5-54303adb6974"],
Cell[1113270, 29229, 196, 5, 52, "Code",ExpressionUUID->"e14f7419-89e3-4783-9198-ab1d0a95c1b9"],
Cell[CellGroupData[{
Cell[1113491, 29238, 79, 0, 67, "Section",ExpressionUUID->"6034899b-68aa-4037-b918-fc414503a490"],
Cell[1113573, 29240, 947, 23, 129, "Code",ExpressionUUID->"2cf6321a-3523-4f5a-99bf-84c1ba3196fa"],
Cell[1114523, 29265, 1085, 31, 148, "Code",ExpressionUUID->"3cf79f62-832f-451c-8e21-d75c262e0170"],
Cell[1115611, 29298, 398, 8, 91, "Code",ExpressionUUID->"fec2b29f-ac6a-4f61-b198-9ada7c9935e9"],
Cell[1116012, 29308, 1312, 32, 148, "Code",ExpressionUUID->"000feeec-bb30-48a8-8e9a-889f6914e183"],
Cell[1117327, 29342, 526, 12, 72, "Code",ExpressionUUID->"e7452ff7-4a1b-486f-843f-361c8ea558a0"],
Cell[1117856, 29356, 214, 6, 52, "Code",ExpressionUUID->"cf1d931e-3134-4092-81f5-c5441756f7b2"]
}, Closed]],
Cell[CellGroupData[{
Cell[1118107, 29367, 80, 0, 53, "Section",ExpressionUUID->"0f8e42dc-5f2f-405a-b230-3b1f2fd2dc43"],
Cell[1118190, 29369, 537, 14, 148, "Code",ExpressionUUID->"3298ad3f-9fe1-4719-b9e0-a54361a0a019"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1118764, 29388, 148, 2, 67, "Section",ExpressionUUID->"264055aa-257e-4658-8e88-c7a82054dd0f"],
Cell[CellGroupData[{
Cell[1118937, 29394, 127, 0, 54, "Subsection",ExpressionUUID->"7e843407-88e6-42e6-a7fb-0d90b64f932d"],
Cell[1119067, 29396, 248, 5, 104, "Text",ExpressionUUID->"3c8f0d77-a834-4ff0-a98b-0ccc57bb7626"],
Cell[CellGroupData[{
Cell[1119340, 29405, 104, 0, 45, "Subsubsection",ExpressionUUID->"8f2974af-9693-44a6-a41d-17072b63e33a"],
Cell[1119447, 29407, 772, 20, 92, "Code",ExpressionUUID->"6387c029-df63-4edd-b7e3-3056df6c830d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1120256, 29432, 104, 0, 37, "Subsubsection",ExpressionUUID->"47b141fa-f895-4edc-9dc0-60d87ba3481f"],
Cell[1120363, 29434, 1361, 39, 149, "Code",ExpressionUUID->"55d9b51b-8c8e-45e9-80b1-d9728ad7b809"],
Cell[1121727, 29475, 765, 19, 73, "Code",ExpressionUUID->"bedb12a1-7d57-4b9c-bb71-022f3622a323"]
}, Closed]],
Cell[CellGroupData[{
Cell[1122529, 29499, 104, 0, 37, "Subsubsection",ExpressionUUID->"471a8712-097f-4fd1-9518-c829ff43a184"],
Cell[1122636, 29501, 1147, 29, 129, "Code",ExpressionUUID->"7bef82e9-a442-4fc9-9df7-6bb3f6419724"],
Cell[1123786, 29532, 999, 26, 93, "Code",ExpressionUUID->"9f080a33-4031-4746-8c35-5a48091cda2e"],
Cell[1124788, 29560, 1587, 43, 167, "Code",ExpressionUUID->"b683f485-8aa7-4d61-89c2-98979f63c150"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1126424, 29609, 96, 0, 54, "Subsection",ExpressionUUID->"7263b898-abdd-4b74-bf48-8401d5363cb9"],
Cell[1126523, 29611, 3570, 101, 262, "Code",ExpressionUUID->"987031ba-a53c-4f11-a7e4-bcab36c04d09"],
Cell[1130096, 29714, 4147, 101, 586, "Code",ExpressionUUID->"4df19566-3b22-4178-9883-43f4afe6f65f"],
Cell[1134246, 29817, 434, 11, 72, "Code",ExpressionUUID->"de3fa5c5-4fe7-44c1-9fce-7504364314cd"]
}, Closed]],
Cell[CellGroupData[{
Cell[1134717, 29833, 98, 0, 38, "Subsection",ExpressionUUID->"180e9407-b203-4d4a-b001-0e9302edeaaf"],
Cell[1134818, 29835, 1717, 50, 167, "Code",ExpressionUUID->"585395bf-edd0-4922-be90-cf3dd9378903"],
Cell[1136538, 29887, 4581, 112, 456, "Code",ExpressionUUID->"475af5c7-e1c8-4503-81f4-44acaf834316"],
Cell[1141122, 30001, 1278, 35, 91, "Code",ExpressionUUID->"b4cd628e-fce5-4143-87ec-c45d2ae6654a"],
Cell[1142403, 30038, 6761, 167, 832, "Code",ExpressionUUID->"36d192d4-81bd-4706-ab71-98a7e1bbfd1e"],
Cell[1149167, 30207, 1442, 40, 227, "Code",ExpressionUUID->"511a5fd5-e74f-4419-bf75-8c444440d319"]
}, Closed]],
Cell[CellGroupData[{
Cell[1150646, 30252, 96, 0, 38, "Subsection",ExpressionUUID->"999e6f09-3bf2-414c-b3fc-0ebce2164f6e"],
Cell[1150745, 30254, 3019, 72, 321, "Code",ExpressionUUID->"4527b9b8-c59b-40fe-ac46-8b880e1d29af"],
Cell[1153767, 30328, 2925, 74, 321, "Code",ExpressionUUID->"f4924735-3c86-45f4-9002-8e27c84aebac"],
Cell[1156695, 30404, 3780, 90, 452, "Code",ExpressionUUID->"e79c1415-df48-46af-8022-f0d3c2db1b85"]
}, Closed]],
Cell[CellGroupData[{
Cell[1160512, 30499, 111, 0, 38, "Subsection",ExpressionUUID->"9b4913e6-0b4a-4a08-b7bd-200f6bcf7b03"],
Cell[1160626, 30501, 2524, 72, 224, "Code",ExpressionUUID->"d1ae3a0e-0030-4f1a-8eb0-962b8b6b9f9a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1163199, 30579, 91, 0, 67, "Section",ExpressionUUID->"efa38391-2c04-4250-a9ce-7f700dc2e797"],
Cell[1163293, 30581, 739, 22, 111, "Code",ExpressionUUID->"c7b53360-ca73-4d43-a302-859f8055c0aa"],
Cell[1164035, 30605, 633, 20, 72, "Code",ExpressionUUID->"5f25bd59-6819-41cd-a8e4-4edaba4dea77"],
Cell[CellGroupData[{
Cell[1164693, 30629, 92, 0, 54, "Subsection",ExpressionUUID->"30beb824-411a-4da9-84d9-c2ad57b065a2"],
Cell[1164788, 30631, 769, 18, 205, "Code",ExpressionUUID->"00471e94-dc32-4777-a8a8-0f8d241e12c6"],
Cell[1165560, 30651, 4063, 104, 339, "Code",ExpressionUUID->"cbd3095b-7fe0-47d2-a263-99ca355abc1e"],
Cell[1169626, 30757, 6282, 174, 394, "Code",ExpressionUUID->"29f39365-7b52-4650-bc5f-963e58ea8fee"]
}, Closed]],
Cell[CellGroupData[{
Cell[1175945, 30936, 93, 0, 38, "Subsection",ExpressionUUID->"df9a98e6-583c-4e1c-9c5e-9329e90e0833"],
Cell[1176041, 30938, 427, 11, 129, "Code",ExpressionUUID->"3198f40c-a3af-4947-b0c8-cbc49f1ca5e1"],
Cell[1176471, 30951, 661, 18, 72, "Code",ExpressionUUID->"d5b36931-6876-4fc2-b980-03428a6a3ff4"],
Cell[1177135, 30971, 2692, 78, 205, "Code",ExpressionUUID->"cdcda5f5-532c-463b-899d-7293e5112f81"]
}, Closed]],
Cell[CellGroupData[{
Cell[1179864, 31054, 95, 0, 38, "Subsection",ExpressionUUID->"530308ab-a7d1-4a5c-86d3-f3a59af21d94"],
Cell[1179962, 31056, 499, 12, 148, "Code",ExpressionUUID->"3a0274b7-99dd-44b8-a623-57f7847ae21b"],
Cell[1180464, 31070, 3833, 101, 281, "Code",ExpressionUUID->"a0387762-529b-4db0-94ff-175060d25b6c"],
Cell[1184300, 31173, 2957, 81, 245, "Code",ExpressionUUID->"7d80a007-6464-43b3-9ff2-00f8fc73da18"]
}, Closed]],
Cell[CellGroupData[{
Cell[1187294, 31259, 93, 0, 38, "Subsection",ExpressionUUID->"616abae0-499a-42ac-9be1-54c477240393"],
Cell[1187390, 31261, 4832, 133, 323, "Code",ExpressionUUID->"f42eb97c-a4fa-4783-8190-ace6cf11e7a8"]
}, Closed]],
Cell[CellGroupData[{
Cell[1192259, 31399, 90, 0, 38, "Subsection",ExpressionUUID->"21ae16eb-fe33-4b07-a637-3a56dfc61929"],
Cell[1192352, 31401, 486, 11, 148, "Code",ExpressionUUID->"0523084d-4d4b-4a9e-8f47-5ce789825232"],
Cell[1192841, 31414, 3238, 81, 414, "Code",ExpressionUUID->"deeff8cc-8a0f-4967-8ab0-c5317f85b6a6"],
Cell[1196082, 31497, 3175, 78, 376, "Code",ExpressionUUID->"b0a2f514-7a30-4fc7-9f56-23c511b2ec1b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1199294, 31580, 88, 0, 54, "Subsection",ExpressionUUID->"a7a35632-47d0-4342-be07-daf07f198317"],
Cell[1199385, 31582, 305, 8, 91, "Code",ExpressionUUID->"e55e08fa-9d58-42bc-abfc-669219f4ba55"],
Cell[1199693, 31592, 1913, 53, 206, "Code",ExpressionUUID->"7befbc49-c359-459d-b8be-4c03a3cd4cbc"]
}, Closed]],
Cell[CellGroupData[{
Cell[1201643, 31650, 103, 0, 38, "Subsection",ExpressionUUID->"a4787621-3d48-4ae3-bf4b-6c35d714056b"],
Cell[1201749, 31652, 1794, 49, 167, "Code",ExpressionUUID->"321114ce-c1c2-4259-8f91-54d2a33d7886"],
Cell[1203546, 31703, 3431, 96, 243, "Code",ExpressionUUID->"521bc9c5-de42-41dd-9770-013f3407e73d"],
Cell[1206980, 31801, 13937, 342, 984, "Code",ExpressionUUID->"8a094d13-8b63-400b-b159-c54a5fd2ee60"],
Cell[1220920, 32145, 2797, 77, 186, "Code",ExpressionUUID->"bd7f0e33-5f80-428a-989f-41e32909c8eb"],
Cell[1223720, 32224, 1320, 37, 110, "Code",ExpressionUUID->"6430d36e-973c-44ca-a619-b4932b524083"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1225089, 32267, 89, 0, 67, "Section",ExpressionUUID->"39bcb497-250e-4ccc-b5cc-cc185dc1e82d"],
Cell[1225181, 32269, 2224, 54, 395, "Code",ExpressionUUID->"47c05290-a89e-4761-b409-233504c8abb9"],
Cell[1227408, 32325, 4927, 116, 491, "Code",ExpressionUUID->"d0c0ab08-9f98-424a-87df-306817a5ca19"],
Cell[1232338, 32443, 1013, 25, 91, "Code",ExpressionUUID->"e7b9a2a5-9af3-4abb-88e6-2d4aac3f3e98"],
Cell[1233354, 32470, 1495, 41, 205, "Code",ExpressionUUID->"c147ed39-8949-4292-be7f-d71a91d02de6"],
Cell[CellGroupData[{
Cell[1234874, 32515, 91, 0, 45, "Subsubsection",ExpressionUUID->"41036322-b489-45d6-a4a8-c4b2fc22031e"],
Cell[1234968, 32517, 2245, 62, 338, "Code",ExpressionUUID->"1e65c65e-c390-4436-963f-5839fb0f2d6f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1237250, 32584, 139, 1, 37, "Subsubsection",ExpressionUUID->"3158cbe2-8da5-435f-9855-4818c97962d4"],
Cell[1237392, 32587, 3556, 92, 528, "Code",ExpressionUUID->"274ece50-9947-4d40-9f3e-6f0f5cb59add"]
}, Closed]],
Cell[CellGroupData[{
Cell[1240985, 32684, 102, 0, 37, "Subsubsection",ExpressionUUID->"6db47837-09f4-490d-be89-995898f5d632"],
Cell[1241090, 32686, 466, 11, 53, "Code",ExpressionUUID->"d0e19af4-16c0-4707-b689-be8f8be442e5"],
Cell[1241559, 32699, 3437, 91, 319, "Code",ExpressionUUID->"6e3dd12b-7fe5-467b-932c-23f1811752d3"],
Cell[1244999, 32792, 2064, 53, 338, "Code",ExpressionUUID->"911928c9-1776-49d7-bdc1-00a706563c2f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1247100, 32850, 108, 0, 37, "Subsubsection",ExpressionUUID->"b5eb9bb4-86b7-4453-beb7-26e0f999bb46"],
Cell[1247211, 32852, 460, 12, 53, "Code",ExpressionUUID->"fe4484fa-0682-4b65-83b1-f4a7594958f2"],
Cell[1247674, 32866, 3459, 94, 262, "Code",ExpressionUUID->"2cc02ac0-f0e0-44be-9b08-7afececde616"],
Cell[1251136, 32962, 1459, 35, 338, "Code",ExpressionUUID->"55774fc6-ee2b-44c0-b416-d3132ebf9238"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[1252644, 33003, 94, 0, 53, "Section",ExpressionUUID->"22a76298-877b-4f82-9647-137ccd36f0ff"],
Cell[CellGroupData[{
Cell[1252763, 33007, 90, 0, 54, "Subsection",ExpressionUUID->"1fce4c2a-3ad9-4a55-ae6b-d262e817dc47"],
Cell[1252856, 33009, 10275, 255, 946, "Code",ExpressionUUID->"d9f2b206-4c71-4b1c-8742-4ad30c3dcdbb"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1263180, 33270, 91, 0, 67, "Section",ExpressionUUID->"3efe547a-f1ac-4ffb-8444-d2b58598608b"],
Cell[CellGroupData[{
Cell[1263296, 33274, 91, 0, 54, "Subsection",ExpressionUUID->"030fa22e-305a-45e4-b6b6-74f92db2e39b"],
Cell[1263390, 33276, 936, 24, 167, "Code",ExpressionUUID->"580bd134-fe46-489b-be75-aa685f0fcd22"]
}, Closed]],
Cell[CellGroupData[{
Cell[1264363, 33305, 94, 0, 38, "Subsection",ExpressionUUID->"50641957-a476-4037-b81c-36b8b7785b1b"],
Cell[1264460, 33307, 8643, 212, 965, "Code",ExpressionUUID->"da7e70de-e1ad-47c1-a2cd-4e867b497a28"]
}, Closed]],
Cell[CellGroupData[{
Cell[1273140, 33524, 92, 0, 38, "Subsection",ExpressionUUID->"5b510d4d-6e9e-491c-94a7-2f5adbe7cbe3"],
Cell[1273235, 33526, 3445, 89, 357, "Code",ExpressionUUID->"ae3899bf-8cac-4133-92d1-6bd45cffea08"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1276729, 33621, 78, 0, 67, "Section",ExpressionUUID->"a1375d4f-d82f-42cf-9eb3-c76f31ebb81e"],
Cell[1276810, 33623, 234, 7, 91, "Code",ExpressionUUID->"0f6f47a1-2047-4f40-a070-b68748d33cb4"]
}, Closed]]
}, Closed]]
}, Open  ]]
}
]
*)


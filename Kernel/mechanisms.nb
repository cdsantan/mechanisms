(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1029657,      26521]
NotebookOptionsPosition[    971016,      25620]
NotebookOutlinePosition[    971412,      25636]
CellTagsIndexPosition[    971369,      25633]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Mechanisms package and sub-packages", "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],

Cell["\<\
version 1.73
Christian Santangelo, Physics Department, Syracuse University
Copyright 2021\
\>", "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],

Cell[CellGroupData[{

Cell["Package organization", "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],

Cell[TextData[{
 StyleBox["mechanisms: ",
  FontWeight->"Bold"],
 "The mechanisms main package contains functions for manipulating and using \
mechanisms."
}], "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],

Cell[TextData[{
 StyleBox["geometry ",
  FontWeight->"Bold"],
 ": Mechanism geometry subpackage."
}], "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],

Cell[TextData[{
 StyleBox["rigidity",
  FontWeight->"Bold"],
 ": This subpackage contains functions for basic rigidity of mechanisms and \
some functions for linkages"
}], "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],

Cell[TextData[{
 StyleBox["origami",
  FontWeight->"Bold"],
 ": this sub package contains functions for handling origami specifically."
}], "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],

Cell["\<\
These packages also use the Mathematica Developer package to take advantage \
of packed arrays when possible. A C compiler is recommended but not necessary.\
\>", "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],

Cell[CellGroupData[{

Cell["To do list and known bug list", "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],

Cell[TextData[{
 "Is there a better way to do minimization with compiled functions ",
 StyleBox["and",
  FontSlant->"Italic"],
 " specified constraints? The algorithms are slow and that means fixed joints \
are poorly handled with compiled functions. Unrestrained minimization is \
still faster with compiled functions."
}], "Text",ExpressionUUID->"01e0f39a-cdd3-4398-9885-4e9122d860da"],

Cell["\<\
The function overlappingVertices[] may sometimes fail if two vertices have \
exactly the same distance apart and those distances are within tolerance.\
\>", "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["mechanisms: internal code for handling structures", "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<mechanisms`\>\"", ",", 
    RowBox[{"{", "\"\<Developer`\>\"", "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$mechanismsVersion", "=", "1.73"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$mechanismsVersionText", "=", "\"\<mechanisms version 1.73\>\""}], 
  ";"}]}], "Code",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"],

Cell[CellGroupData[{

Cell["Usage", "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$mechanismsVersion", "::", "usage"}], " ", "=", " ", 
   "\"\<$mechanismsVersion returns the version number of the package.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$mechanismsVersionText", "::", "usage"}], " ", "=", " ", 
   "\"\<$mechanismsVersionText returns the version number of the package as a \
string.\>\""}], ";"}]}], "Code",
 CellLabel->"In[4]:=",ExpressionUUID->"83532984-f8e5-44f9-a21e-beb9bdc10ddf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rigidBar", "::", "usage"}], "=", 
   "\"\<rigidBar[ {v1, v2} ] is a rigid bar. Use defaultData[ rigidBar ] to \
see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"spring", "::", "usage"}], "=", 
   "\"\<spring[ {v1, v2} ] is a spring allowing you to set an arbitrary \
force. Use defaultData[ spring ] to see its associated data.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"face", "::", "usage"}], "=", 
   "\"\<face[ {v1,v2,...} ] is a face. Use defaultData[ face ] to see its \
associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fold", "::", "usage"}], "=", 
   "\"\<fold[ {v1,v2} ] is a fold with torsional spring controlling its \
angle. Use defaultData[ fold ] to see its associated data.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "::", "usage"}], "=", 
   "\"\<joint[v1] is a joint. Use defaultData[ joint ] to see its associated \
data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"angleJoint", "::", "usage"}], "=", 
    "\"\<angleJoint[v1] is a torsional joint. Use defaultData[ angleJoint ] \
to see its associated data.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "::", "usage"}], "=", 
   "\"\<defaultData[ component ] returns the default data associated with a \
component.\>\""}], ";"}]}], "Code",
 CellLabel->"In[6]:=",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mechanism", "::", "usage"}], " ", "=", " ", 
    "\"\<Keyword used to report some errors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "::", "usage"}], " ", "=", " ", 
    "\"\<framework[ { {x1, y1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] returns \
a linkage in 2D with vertices at {{x1, y1}, ..} and made from the specified \
cells.\nframework[ { {x1, y1, z1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] \
returns a linkage in 3D with vertices at {{x1, y1}, ..} and made from the \
specified cells.\\n\nProperties:\\n\nCell properties can be specified by \
Property[ cell1[ {i1, ...} ], {property1 -> value1, ... } ].\nProperties that \
can be specified include MeshCellStyle, MeshCellLabel, MeshCellShapeFunction. \
Options[cell] will list additional properties that can be specified.\\n\n\
Options:\\n\nframework[] takes the same options as MeshRegion[] as well as an \
option \\\"overlapPrecision\\\" which determines how close vertices need to \
be in order to be mapped onto each other.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "::", "usage"}], "=", "\n", 
    "\"\<origami[ { {x1, y1}, ...}, {cell1[ {i1, i2, ..} ], ... } ] returns \
an origami in 3D (displayed in 2D) with vertices at {{x1, y1}, ..} and made \
from the specified cells.\norigami[ { {x1, y1, z1}, ...}, {cell1[ {i1, i2, \
..} ], ... } ] returns an origami in 3D with vertices at {{x1, y1}, ..} and \
made from the specified cells.\n\nProperties:\n\nCell properties can be \
specified by Property[ cell1[ {i1, ...} ], {property1 -> value1, ... } ].\n\
Properties that can be specified include MeshCellStyle, MeshCellLabel, \
MeshCellShapeFunction. Options[cell] will list additional properties that can \
be specified.\n\nOptions:\n\norigami[] takes the same options as MeshRegion[] \
as well as an option \\\"overlapPrecision\\\" which determines how close \
vertices need to be in order to be mapped onto each other.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismQ", "::", "usage"}], "=", 
   "\"\<mechanismQ[ m ] returns True if m is a mechanism.\>\""}], 
  ";"}]}], "Code",
 CellLabel->"In[13]:=",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"vertexPosition", "::", "usage"}], "=", 
   "\"\<vertexPosition[v, c] represents the position of vertex v along a \
particular component d, which is one of \\\"x\\\", \\\"y\\\", or \\\"z\\\" or \
All[d] where d is the dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"vertexPosition", ",", 
    RowBox[{"{", 
     RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexDisplacement", "::", "usage"}], "=", 
   "\"\<vertexDisplacement[v, c] represents the displacement of vertex v \
along a particular component d, which is one of \\\"x\\\", \\\"y\\\", or \
\\\"z\\\" or All[d] where d is the dimension.\>\""}], ";"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"vertexDisplacement", ",", 
   RowBox[{"{", 
    RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}]}], "Code",
 CellLabel->"In[17]:=",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"cell", " ", "modifiers"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"selectCells", "::", "usage"}], "=", "\n", 
     "\"\<selectCells[ m, pattern ] selects a sub-mechanism with cell \
specification matching pattern.\nselectCells[m, pattern, data, f] selects a \
sub-mechanism with cells matching pattern and f evaluating True when applied \
to the data. Use dataForm[] to find data that is available for a given \
component.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"deleteCells", "::", "usage"}], "=", 
     "\"\<deleteCells[ m, pattern ] deletes a sub-mechanism with cell \
specification matching pattern.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"addCells", "::", "usage"}], "=", 
     "\"\<addCells[ m, {cell1, cell2, ... } ] adds cells to a \
mechanism.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"highlightCells", "::", "usage"}], "=", 
     "\"\<highlightCells[m, pattern, display properties] changes the display \
properties of cells that match a pattern.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"changeCellData", "::", "usage"}], "=", 
     "\"\<changeCellData[m, pattern, {data1 -> newData,...}] changes the \
specified data on any cells that match a pattern.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"splitEdge", "::", "usage"}], "=", 
     "\"\<splitEdge[ m, edge, label -> position ] adds a vertex to an edge \
and places the vertex at position with a label.\>\""}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"vertex", " ", "modifiers"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"placeVertices", "::", "usage"}], "=", 
     "\"\<placeVertices[m, {v1 -> new position 1, ...} ] moves vertices to \
new positions.\nplaceVertices[m, { pos1, pos2, ... } ] replaces all vertex \
positions by a list of new positions.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"displaceVertices", "::", "usage"}], "=", 
     "\"\<displaceVertices[m, {v1 -> displacement 1, ...} ] displaces \
vertices by a displacement.\ndisplaceVertices[m, { disp1, disp2, ... } ] \
displaces all vertices by a list of displacements.\>\""}], ";"}], "\n", "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"deleteVertices", "::", "usage"}], "=", 
     "\"\<deleteVertices[ m, {v1, ...} ] deletes a list of vertices and all \
cells associated with those vertices.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"mapCells", "::", "usage"}], "=", 
     "\"\<mapCells[m, f] applies a map f to a mechanism.\>\""}], ";"}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{"mechanism", " ", "modifiers"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"joinMechanism", "::", "usage"}], "=", 
     "\"\<joinMechanism[ m1, m2, ... ] joins a list of mechanisms of the same \
type together.\>\""}], ";"}]}]}]], "Code",
 CellLabel->"In[21]:=",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"constrainedComponents", "::", "usage"}], "=", 
    "\"\<constrainedComponents[m] returns the constrained components of a \
mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentData", "::", "usage"}], " ", "=", " ", 
   "\"\<componentData[ m, data, pattern ]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"matchFromData", "::", "usage"}], " ", "=", " ", 
   "\"\<matchFromData[ m, data -> patt ] returns all components whose data \
matches the pattern.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"selectFromData", "::", "usage"}], " ", "=", " ", 
    "\"\<selectFromData[ m, data, f ] returns all components such that f \
applied to specified data returns True.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mechanismPositions", "::", "usage"}], "=", "\n", 
    "\"\<mechanismPositions[ \
\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\) ] returns the \
coordinates of the vertices of \!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\
\"Italic\\\"]\).\nmechanismPositions[ \
\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\) -> \
\!\(\*StyleBox[\\\"positions\\\",FontSlant->\\\"Italic\\\"]\) ] returns a new \
mechanism with coordinates given by \
\!\(\*StyleBox[\\\"positions\\\",FontSlant->\\\"Italic\\\"]\).\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismComponents", "::", "usage"}], "=", 
   "\"\<mechanismComponents[ m ] lists all mechanism components in a \
mechanism m.\nmechanismComponents[ m, pattern ] lists mechanism components in \
a mechanism m that match a pattern.\nmechanismComponents[ m, pattern -> { \
dataType1 -> data1, ...} ] returns a mechanism in which components matching \
pattern have had their data replaced.\>\""}], ";"}]}], "Code",
 CellLabel->"In[32]:=",ExpressionUUID->"9273de87-effd-4686-9b2e-608fcb430619"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tesselateMechanism", "::", "usage"}], "=", "\n", 
   "\"\<tesselateMechanism[mechanism, primitive vector, n1 ], \
tesselateMechanism[mechanism, {vector 1, vector 2}, {n1, n2}],  \
tesselateMechanism[mechanism, {vector 1, vector 2, vector 3}, {n1, n2, n3}] \
tesselates a mechanism using a set of 2D or 3D primitive vectors as an n1, n1 \
x n2 or n1 x n2 x n3 celled mechanism.\>\""}], ";"}]], "Code",
 CellLabel->"In[38]:=",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotMechanism", "::", "usage"}], "=", "\n", 
    "\"\<plotMechanism[ mechanism, positions ] plots a mechanism using \
positions.\nplotMechanism[mechanism, {positions 1, positions 2,...}] creates \
a list of plotted mechanisms with uniform size.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"meshCells", "::", "usage"}], "=", 
    "\"\<meshCells[ m ] returns the mesh cells producing a particular \
mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toGraphics", "::", "usage"}], "=", 
   "\"\<toGraphics[ m ] returns graphics complex representing the mechanism.\n\
toGraphics[m, dim ] returns a graphics complex using only objects of the \
dimension dim\>\""}], ";"}]}], "Code",
 CellLabel->"In[39]:=",ExpressionUUID->"1e4167c3-01ad-404a-90d1-cf374df1ec7c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"listFaces", "::", "usage"}], "=", 
   "\"\<listFaces[ m ] returns a list of faces in the mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"listEdges", "::", "usage"}], "=", 
   "\"\<listEdges[ m ] returns a list of edges in the mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"listVertices", "::", "usage"}], "=", 
   "\"\<listVertices[ m ] returns a list of vertices in the mechanism.\>\""}],
   ";"}]}], "Code",
 CellLabel->"In[42]:=",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Code",
 CellLabel->"In[45]:=",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$meshRegionProperties", "=", 
   RowBox[{"{", 
    RowBox[{
    "MeshCellStyle", ",", "MeshCellLabel", ",", "MeshCellShapeFunction"}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$mechanismComponents", "=", 
    RowBox[{"{", 
     RowBox[{
     "rigidBar", ",", "spring", ",", "fold", ",", "face", ",", "joint"}], 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPattern", " ", "=", " ", 
    RowBox[{"_framework", "|", "_origami"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern2D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern3D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"coordinatePattern", " ", "=", " ", 
    RowBox[{"coordinatePattern2D", " ", "|", " ", "coordinatePattern3D"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mechanismQ", "[", " ", "mechanismPattern", " ", "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"mechanismQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->"In[46]:=",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"]
}, Closed]],

Cell[CellGroupData[{

Cell["functions to manipulate cells", "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],

Cell[CellGroupData[{

Cell["defaultData[], dataForm[], compressCells[]", "Subsection",ExpressionUUID->"45520b83-5856-4e70-aec9-9e641ed75ec5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "rigidBar", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<length\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
     RowBox[{"\"\<stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}]}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "spring", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<length\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
     RowBox[{"\"\<stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",", " ", 
     RowBox[{"\"\<strain\>\"", " ", "\[Rule]", " ", "\"\<linear\>\""}]}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "face", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", 
    RowBox[{"\"\<faceStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], " ", 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "fold", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"\"\<torsionalStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
     ",", " ", 
     RowBox[{"\"\<angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "joint", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"\"\<pinningStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
     ",", " ", 
     RowBox[{"\"\<constraint\>\"", " ", "\[Rule]", " ", "Automatic"}]}], " ", 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "angleJoint", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<angleStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",",
      " ", 
     RowBox[{"\"\<angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], " ", 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultData", "[", "_", "]"}], " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}]}], "Code",
 CellLabel->"In[54]:=",ExpressionUUID->"ab7cfd9a-2e32-4f78-9985-f607ab5d6072"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "data", " ", "that", " ", "will", " ", "be", " ", "stored", " ", "for", 
    " ", "each", " ", "of", " ", "these", " ", "components", " ", "and", " ", 
    "in", " ", "what", " ", "order"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"dataForm", "[", "rigidBar", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{"\"\<length\>\"", ",", "\"\<stiffness\>\""}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "spring", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
     "\"\<length\>\"", ",", "\"\<stiffness\>\"", ",", "\"\<strain\>\""}], 
     "}"}]}], "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "face", "]"}], ":=", 
    RowBox[{"{", "\"\<faceStiffness\>\"", "}"}]}], "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "fold", "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{"\"\<torsionalStiffness\>\"", ",", "\"\<angle\>\""}], "}"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "joint", "]"}], ":=", 
    RowBox[{"{", " ", 
     RowBox[{"\"\<pinningStiffness\>\"", ",", " ", "\"\<constraint\>\""}], 
     " ", "}"}]}], "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "angleJoint", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<angleStiffness\>\"", ",", " ", "\"\<angle\>\""}], " ", 
     "}"}]}], "\n", 
   RowBox[{
    RowBox[{"dataForm", "[", "_", "]"}], ":=", 
    RowBox[{"{", "}"}]}]}]}]], "Code",
 CellLabel->"In[61]:=",ExpressionUUID->"b3631e97-3f29-4a3d-9eb1-fc44906b4a23"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compressCells", "[", " ", 
    RowBox[{"h_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
     "]"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"h", "[", " ", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", " ", "indices", " ", "]"}], ",", " ", 
     RowBox[{"compressCellData", "[", " ", 
      RowBox[{"h", ",", " ", "indices", ",", " ", "data"}], " ", "]"}], ",", 
     " ", "display"}], " ", "]"}]}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "how", " ", "to", " ", "store", " ", "data", " ", "in", " ", "a", " ", 
    "mechanism", " ", "in", " ", "a", " ", "compact", " ", "way"}], " ", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"rigidBar", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"length_", ",", " ", "stiffness_"}], "}"}]}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{
       RowBox[{"length", " ", "/.", " ", 
        RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
       ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
       "\"\<Automatic\>\""}], " ", "]"}], ",", "\n", "\t\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"stiffness", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
      "]"}]}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"spring", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"length_", ",", " ", "stiffness_", ",", " ", "strain_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{
       RowBox[{"length", " ", "/.", " ", 
        RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
       ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
       "\"\<Automatic\>\""}], " ", "]"}], ",", "\n", "\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"stiffness", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
      "]"}], ",", "\n", "\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"strain", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "\"\<linear\>\""}], 
      " ", "]"}]}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"fold", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"torsionalStiffness_", ",", " ", "angle_"}], "}"}]}], " ", 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"torsionalStiffness", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
      "]"}], ",", "\n", "\t\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{
       RowBox[{"angle", " ", "/.", " ", 
        RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
       ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
       "\"\<Automatic\>\""}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"face", " ", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", "stiffness_", "}"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"SparseArray", "[", " ", 
     RowBox[{"stiffness", " ", ",", " ", 
      RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
     "]"}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"joint", " ", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"stiffness_", ",", " ", "constraint_"}], "}"}]}], " ", "]"}], 
   " ", ":=", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"stiffness", " ", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
      "]"}], ",", "\n", "\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{
       RowBox[{"constraint", " ", "/.", " ", 
        RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
       ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
       "\"\<Automatic\>\""}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"angleJoint", " ", ",", " ", "indices_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"stiffness_", ",", " ", "angle_"}], "}"}]}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{"stiffness", " ", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", "Infinity"}], " ", 
      "]"}], ",", "\n", "\t", 
     RowBox[{"SparseArray", "[", " ", 
      RowBox[{
       RowBox[{"angle", " ", "/.", " ", 
        RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
       ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
       "\"\<Automatic\>\""}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"compressCellData", "[", " ", 
   RowBox[{"_", ",", " ", "_", ",", " ", "data_"}], " ", "]"}], " ", ":=", 
  " ", "data"}]}], "Code",
 CellLabel->"In[68]:=",ExpressionUUID->"f3037e78-242f-4ef4-8cf8-1e4845b0d8f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDuplicateCells[], deleteDegenerateCells[]", "Subsection",ExpressionUUID->"e2629fb7-9d1d-43f3-bf65-3eef685b1359"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteDuplicateCells", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", "]"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"indexList", " ", "=", " ", 
      RowBox[{
       RowBox[{"DeleteDuplicatesBy", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"Range", "[", " ", 
             RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], ",", " ", 
            "indices"}], " ", "}"}], " ", "]"}], ",", " ", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"Last", "[", "#", "]"}], "}"}], "]"}], "]"}], "&"}]}], 
        " ", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", " ", "indexList", " ", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", " ", "indexList", " ", "]"}], "]"}], "&"}], " ", "/@", 
       " ", "data"}], ",", " ", 
      RowBox[{"display", "[", 
       RowBox[{"[", " ", "indexList", " ", "]"}], "]"}]}], " ", "]"}]}], "\n",
    "]"}]}]], "Code",
 CellLabel->"In[76]:=",ExpressionUUID->"234639ac-ea1e-4bb7-a2eb-b8edc3acb6eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"deleteDegenerateCells", "[", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
        "}"}], "..."}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Select", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"DeleteDuplicatesBy", "[", 
      RowBox[{"cells", ",", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"Sort", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "}"}], "]"}], "]"}]}], "}"}], 
        "&"}]}], " ", "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"DuplicateFreeQ", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "}"}], "]"}], "]"}], "&"}]}], "\n", 
    "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"deleteDegenerateCells", "[", " ", 
   RowBox[{"cells", " ", ":", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"_Symbol", "[", " ", 
       RowBox[{"_", ",", " ", "_", ",", " ", "_"}], " ", "]"}], "..."}], 
     "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"deleteDegenerateCellIndices", " ", "/@", " ", "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"deleteDegenerateCellIndices", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", "]"}],
    " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"id", " ", "=", " ", 
      RowBox[{"Pick", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"DuplicateFreeQ", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "#", "}"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "indices"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "id", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "id", "]"}], "]"}], "&"}], "/@", "data"}], ",", " ", 
      RowBox[{"display", "[", 
       RowBox[{"[", " ", "id", " ", "]"}], "]"}]}], " ", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->"In[77]:=",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],

Cell[CellGroupData[{

Cell["packComponentCells[], unpackComponentCells[]", "Subsection",ExpressionUUID->"71534006-f481-46da-b362-358b3b617b31"],

Cell[CellGroupData[{

Cell["packComponentCells[]", "Subsubsection",ExpressionUUID->"e0ceec4e-875d-447b-a6b3-9644e1be5a13"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"packComponentCells", "[", " ", 
    RowBox[{"data", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
        "}"}], "..."}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"deleteDuplicateCells", "[", 
      RowBox[{"packGroupedComponentCells", "[", "#", "]"}], "]"}], "&"}], " ",
     "/@", " ", 
    RowBox[{"GatherBy", "[", " ", 
     RowBox[{"data", ",", " ", "First"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"packGroupedComponentCells", "[", " ", 
   RowBox[{"data", " ", ":", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
       "}"}], "..."}], "}"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
     "heads", ",", " ", "indices", ",", " ", "groupedData", ",", " ", 
      "unpackedData", ",", " ", "displayData"}], " ", "}"}], ",", "\n", "\t", 
    
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "heads", ",", " ", "indices", ",", " ", "groupedData", ",", " ", 
        "displayData"}], "}"}], " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", "data", " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"heads", " ", "=", " ", 
      RowBox[{"First", "[", "heads", "]"}]}], ";", "\n", "\t", 
     RowBox[{"unpackedData", " ", "=", " ", 
      RowBox[{"ReplaceAll", "[", " ", 
       RowBox[{
        RowBox[{"ReplaceAll", "[", " ", 
         RowBox[{
          RowBox[{"dataForm", "[", "heads", "]"}], " ", ",", "  ", 
          "groupedData"}], " ", "]"}], " ", ",", " ", 
        RowBox[{"defaultData", "[", "heads", "]"}]}], " ", "]"}]}], ";", "\n",
      "\n", "\t", 
     RowBox[{"compressCells", "[", " ", 
      RowBox[{"heads", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"ToPackedArray", "[", " ", "indices", " ", "]"}], ",", "\n", 
        "\t\t", 
        RowBox[{"ToPackedArray", " ", "/@", " ", 
         RowBox[{"Transpose", "[", " ", "unpackedData", " ", "]"}]}], ",", 
        "\n", "\t\t", "displayData"}], "\n", "\t", "]"}], "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->"In[80]:=",ExpressionUUID->"0f195ae0-3152-4bb8-a197-b14572dd8cd2"]
}, Closed]],

Cell[CellGroupData[{

Cell["unpackComponentCells[]", "Subsubsection",ExpressionUUID->"ee2b47a4-44a4-4abc-a1c7-f625848196b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"unpackComponentCells", "[", " ", 
   RowBox[{"{", "}"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"unpackComponentCells", "[", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", 
        RowBox[{"_", ",", "_", ",", "_"}], "]"}], ".."}], "}"}]}], " ", "]"}],
    " ", ":=", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{
     RowBox[{"unpackComponentCells", " ", "/@", " ", "cells"}], ",", " ", 
     "1"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"unpackComponentCells", "[", " ", 
   RowBox[{"head_Symbol", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", "]"}],
    " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"Transpose", "[", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ConstantArray", "[", " ", 
      RowBox[{"head", ",", " ", 
       RowBox[{"Length", "[", "indices", "]"}]}], " ", "]"}], ",", " ", 
     "indices", " ", ",", " ", 
     RowBox[{"Thread", " ", "/@", " ", 
      RowBox[{"Thread", "[", " ", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"dataForm", "[", "head", "]"}], ",", " ", 
          RowBox[{"Length", "[", "indices", "]"}]}], " ", "]"}], " ", 
        "\[Rule]", " ", 
        RowBox[{"Transpose", "[", "data", "]"}]}], " ", "]"}]}], ",", " ", 
     "display"}], "}"}], " ", "]"}]}]}], "Code",
 CellLabel->"In[82]:=",ExpressionUUID->"f537bf47-ac17-4bbd-9e7c-f61d88a7c2e4"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["componentPattern[], cellPattern[]", "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"componentPattern", "[", "x_Blank", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x", ",", " ", "_", ",", " ", "_"}], " ", "}"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "x", "]"}], " ", "\[Equal]", " ", "0"}]}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"componentPattern", "[", "x_Blank", "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"x", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", "_", ",", "_"}], "}"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"componentPattern", "[", "r_Alternatives", "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{"componentPattern", " ", ",", "  ", "r"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"componentPattern", "[", 
   RowBox[{"h_", "[", "r_Alternatives", "]"}], "]"}], " ", ":=", " ", 
  RowBox[{"componentPattern", "[", " ", 
   RowBox[{"Map", "[", " ", 
    RowBox[{"h", " ", ",", " ", "r"}], " ", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"componentPattern", "[", 
   RowBox[{"h_", "[", "n_List", "]"}], "]"}], ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"numbers", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "n", "]"}], "]"}]}], " ", "}"}], " ", ",", " ", 
    
    RowBox[{"{", 
     RowBox[{"h", " ", ",", " ", 
      RowBox[{"Alternatives", " ", "@@", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"RotateRight", "[", 
           RowBox[{"n", ",", "#"}], "]"}], "&"}], " ", ",", " ", "numbers"}], 
        " ", "]"}]}], ",", " ", "_"}], " ", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"componentPattern", "[", 
   RowBox[{"h_", "[", 
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_Alternatives", "|", "_List"}], "]"}]}], "]"}], "]"}], " ", ":=",
   " ", 
  RowBox[{"{", 
   RowBox[{"h", ",", " ", "n", ",", " ", "_"}], "}"}]}]}], "Code",
 CellLabel->"In[85]:=",ExpressionUUID->"0bf45db9-7619-45bc-b186-38923d0a0307"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cellPattern", "[", " ", "r_Alternatives", " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"groupedByHead", " ", "=", " ", 
      RowBox[{"GatherBy", "[", " ", 
       RowBox[{
        RowBox[{"List", "@@", "r"}], ",", " ", "Head"}], " ", "]"}]}], " ", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", " ", 
       RowBox[{"indexPattern", " ", "/@", " ", 
        RowBox[{"Alternatives", " ", "@@", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], " ", "]"}], "&"}], 
     " ", "/@", " ", "groupedByHead"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"cellPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"_", "[", "_", "]"}], "}"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "x", "]"}], "\[Equal]", "0"}]}]}], "\n", 
 RowBox[{
  RowBox[{"cellPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"x", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "[", " ", "_", " ", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellPattern", "[", " ", 
    RowBox[{"head_", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"head", "[", " ", 
     RowBox[{"indexPattern", "[", "ind", "]"}], " ", "]"}], "}"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", " ", 
  "x"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "r_Alternatives", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"indexPattern", " ", "/@", " ", "r"}]}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "n_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"numbers", " ", "=", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "n", "]"}], "]"}]}], " ", "}"}], ",", " ", 
    RowBox[{"Alternatives", " ", "@@", " ", 
     RowBox[{"Map", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"n", ",", "#"}], "]"}], "&"}], ",", " ", "numbers"}], " ", 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", 
   RowBox[{"n", " ", ":", " ", 
    RowBox[{"Except", "[", 
     RowBox[{"_Alternatives", "|", "_List"}], "]"}]}], " ", "]"}], " ", ":=", 
  " ", "n"}]}], "Code",
 CellLabel->"In[91]:=",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
replaceCellIndices[], replaceRepeatedCellIndices[], replaceCellData[]\
\>", "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
         " ", "}"}], ".."}], "}"}]}], ",", " ", "rules_"}], " ", "]"}], " ", ":=",
    " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flipCells", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", "cells", " ", "]"}]}], "}"}], ",", "\n",
      "\t", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"ReplaceAll", "[", " ", 
         RowBox[{
          RowBox[{"flipCells", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], 
        ",", " ", 
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"replaceCellIndices", "[", " ", 
   RowBox[{
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", " ", 
        RowBox[{"_", ",", " ", "_", ",", " ", "_"}], " ", "]"}], ".."}], 
      "}"}]}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"replaceCellIndices", "[", 
      RowBox[{"#", ",", " ", "rules"}], "]"}], "&"}], ",", " ", "cells"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
      "]"}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"head", "[", " ", 
    RowBox[{
     RowBox[{"ReplaceAll", "[", 
      RowBox[{"indices", ",", " ", "rules"}], "]"}], ",", " ", "data", ",", 
     " ", "display"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRepeatedCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRepeatedCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
         " ", "}"}], ".."}], "}"}]}], ",", " ", "rules_"}], " ", "]"}], " ", ":=",
    " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flipCells", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", "cells", " ", "]"}]}], "}"}], ",", "\n",
      "\t", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"ReplaceRepeated", "[", " ", 
         RowBox[{
          RowBox[{"flipCells", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], 
        ",", " ", 
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"replaceRepeatedCellIndices", "[", " ", 
   RowBox[{
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", " ", 
        RowBox[{"_", ",", " ", "_", ",", " ", "_"}], " ", "]"}], ".."}], 
      "}"}]}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"replaceCellIndices", "[", 
      RowBox[{"#", ",", " ", "rules"}], "]"}], "&"}], ",", " ", "cells"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"replaceRepeatedCellIndices", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
     "]"}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"head", "[", " ", 
   RowBox[{
    RowBox[{"ReplaceRepeated", "[", 
     RowBox[{"indices", ",", " ", "rules"}], "]"}], ",", " ", "data", ",", 
    " ", "display"}], " ", "]"}]}]}], "Code",
 CellLabel->"In[99]:=",ExpressionUUID->"2553df87-0843-40e9-9b50-dcbdea5eaf4a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellData", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellData", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Symbol", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], 
         "}"}], ".."}], "}"}]}], ",", " ", "rules_"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flipCells", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", "cells", " ", "]"}]}], "}"}], ",", "\n",
      "\t", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"flipCells", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
        RowBox[{"ReplaceAll", "[", " ", 
         RowBox[{
          RowBox[{"flipCells", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], 
        ",", " ", 
        RowBox[{"flippedCells", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellData", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_Symbol", "[", 
         RowBox[{"_", ",", "_", ",", "_"}], "]"}], ".."}], "}"}]}], ",", " ", 
     "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"replaceCellData", "[", 
      RowBox[{"#", ",", "rules"}], "]"}], "&"}], " ", "/@", " ", "cells"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceCellData", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], "]"}], 
     ",", " ", "rule_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"head", "[", 
    RowBox[{"indices", ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"replaceElement", "[", 
        RowBox[{"#", " ", ",", " ", "rule"}], "]"}], "&"}], " ", "/@", " ", 
      "data"}], ",", " ", "display"}], " ", "]"}]}], "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"from", ":", " ", "https", ":"}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "13790"}], "/", "using"}], "-", "replaceall", "-",
      "on", "-", "sparsearray"}]}], "\n", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceElement", "[", 
    RowBox[{"s_SparseArray", ",", " ", "rule_"}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", "    ", 
    RowBox[{
     RowBox[{"{", "\n", "    ", 
      RowBox[{
       RowBox[{"elem", " ", "=", " ", 
        RowBox[{"ReplaceAll", "[", 
         RowBox[{
          RowBox[{"s", "[", "\"\<NonzeroValues\>\"", "]"}], ",", " ", 
          "rule"}], "]"}]}], ",", "\n", "    ", 
       RowBox[{"def", " ", "=", " ", 
        RowBox[{"ReplaceAll", "[", 
         RowBox[{
          RowBox[{"s", "[", "\"\<Background\>\"", "]"}], ",", " ", "rule"}], 
         "]"}]}]}], "\n", "    ", "}"}], ",", "\n", "\n", "    ", 
     RowBox[{"Replace", "[", "\n", "        ", 
      RowBox[{"s", ",", "\n", "        ", 
       RowBox[{
        RowBox[{
         RowBox[{"Verbatim", "[", "SparseArray", "]"}], "[", 
         RowBox[{"a__", ",", " ", "_", ",", " ", 
          RowBox[{"{", 
           RowBox[{"b__", ",", " ", "_"}], "}"}]}], "]"}], " ", ":>", " ", 
        RowBox[{"SparseArray", "[", 
         RowBox[{"a", ",", " ", "def", ",", " ", 
          RowBox[{"{", 
           RowBox[{"b", ",", " ", "elem"}], "}"}]}], "]"}]}]}], "\n", "    ", 
      "]"}]}], "\n", "]"}]}], "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{"if", " ", "the", " ", "data", " ", 
    RowBox[{"isn", "'"}], "t", " ", "a", " ", "SparseArray"}], "\n", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"replaceElement", "[", " ", 
   RowBox[{"s_", ",", " ", "rule_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"s", ",", " ", "rule"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[107]:=",ExpressionUUID->"c9202516-8006-40a6-bb3c-8907e6d4a898"]
}, Closed]],

Cell[CellGroupData[{

Cell["identifyComponents[], selectComponents[], matchComponents[]", \
"Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"identifyComponents", "[", " ", 
    RowBox[{"pattern_", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
      "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"validPatterns", " ", "=", " ", 
       RowBox[{"matchingPattern", "[", " ", 
        RowBox[{"pattern", ",", " ", "head"}], " ", "]"}]}], " ", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "validPatterns", "]"}], " ", "\[Equal]", " ", 
        "0"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
             "indices"}], "}"}], " ", "]"}], ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"_", " ", ",", " ", 
            RowBox[{"validPatterns", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], " ", "}"}]}], " ", 
         "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"matchingPattern", "[", " ", 
   RowBox[{"patternList_", ",", " ", "head_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Pick", "[", " ", 
   RowBox[{"patternList", ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"MatchQ", "[", " ", 
       RowBox[{"head", ",", " ", 
        RowBox[{"Head", "[", "#", "]"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
     "patternList"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[113]:=",ExpressionUUID->"0ff05a13-c239-4798-89ca-6d3f02a331ca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"selectComponents", "[", " ", 
    RowBox[{
    "headSpec_", ",", " ", "dataSpec_", ",", " ", "dataSelector_", ",", " ", 
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", "data_", ",", "display_"}], "]"}]}], " ", 
    "]"}], " ", ":=", "\n", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MatchQ", "[", " ", 
      RowBox[{"head", ",", " ", "headSpec"}], " ", "]"}], ",", "\n", "\t", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"dataLocation", " ", "=", " ", 
         RowBox[{"FirstPosition", "[", " ", 
          RowBox[{
           RowBox[{"dataForm", "[", "head", "]"}], ",", " ", "dataSpec"}], 
          " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"MissingQ", "[", "dataLocation", "]"}], ",", "\n", "\t\t\t", 
         
         RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
         RowBox[{"selectIndices", "[", " ", 
          RowBox[{"dataSelector", ",", " ", "indices", ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", " ", 
             RowBox[{"dataLocation", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], " ", 
          "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     
     RowBox[{"{", "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selectIndices", "[", " ", 
    RowBox[{"dataSelector_", ",", " ", "indices_", ",", " ", "data_List"}], 
    " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"Select", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Transpose", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
        RowBox[{"data", " ", "/.", " ", 
         RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}]}], 
       " ", "]"}], ",", " ", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dataSelector", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}]}], " ", "\n", "\t", 
     "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"selectIndices", "[", " ", 
   RowBox[{
   "dataSelector_", ",", " ", "indices_", ",", " ", "data_SparseArray"}], " ",
    "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"specifiedIndices", " ", "=", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"data", "[", "\"\<NonzeroPositions\>\"", "]"}], " ", "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{"specifiedIndices", ",", " ", 
             RowBox[{
              RowBox[{"data", "[", "\"\<NonzeroValues\>\"", "]"}], " ", "/.", 
              " ", 
              RowBox[{
              "\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}]}], 
            " ", "}"}], " ", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"dataSelector", "[", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "]"}], "&"}]}], " ", "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"TrueQ", "[", 
          RowBox[{"dataSelector", "[", " ", 
           RowBox[{
            RowBox[{"data", "[", "\"\<Background\>\"", "]"}], " ", "/.", " ", 
            
            RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}],
            " ", "]"}], "]"}], ",", " ", 
         RowBox[{"Complement", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
           "specifiedIndices"}], " ", "]"}], ",", " ", 
         RowBox[{"{", "}"}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}], " ",
    "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"Dimensions", "[", "data", "]"}], "]"}], "\[Equal]", 
    "1"}]}]}]}], "Code",
 CellLabel->
  "In[115]:=",ExpressionUUID->"1f00d229-04f4-4a9f-9953-92a56ddcdcb8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"matchComponents", "[", " ", 
    RowBox[{
    "headSpec_", ",", " ", "dataSpec_", ",", " ", "dataSelector_", ",", " ", 
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", "data_", ",", "display_"}], "]"}]}], " ", 
    "]"}], " ", ":=", "\n", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MatchQ", "[", " ", 
      RowBox[{"head", ",", " ", "headSpec"}], " ", "]"}], ",", "\n", "\t", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"dataLocation", " ", "=", " ", 
         RowBox[{"FirstPosition", "[", " ", 
          RowBox[{
           RowBox[{"dataForm", "[", "head", "]"}], ",", " ", "dataSpec"}], 
          " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"MissingQ", "[", "dataLocation", "]"}], ",", "\n", "\t\t\t", 
         
         RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
         RowBox[{"matchIndices", "[", " ", 
          RowBox[{"dataSelector", ",", " ", "indices", ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", " ", 
             RowBox[{"First", "[", "dataLocation", "]"}], " ", "]"}], "]"}]}],
           " ", "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}], ",", "\n", 
     "\t", 
     RowBox[{"{", "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"matchIndices", "[", " ", 
   RowBox[{"dataSelector_", ",", " ", "indices_", ",", " ", "data_List"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Cases", "[", " ", 
    RowBox[{
     RowBox[{"Transpose", "[", " ", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
       RowBox[{"data", " ", "/.", " ", 
        RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}]}], 
      " ", "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "dataSelector"}], "}"}]}], " ", "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"matchIndices", "[", " ", 
   RowBox[{
   "dataSelector_", ",", " ", "indices_", ",", " ", "data_SparseArray"}], " ",
    "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"specifiedIndices", " ", "=", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"data", "[", "\"\<NonzeroPositions\>\"", "]"}], " ", "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{"specifiedIndices", ",", " ", 
             RowBox[{
              RowBox[{"data", "[", "\"\<NonzeroValues\>\"", "]"}], " ", "/.", 
              " ", 
              RowBox[{
              "\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}]}], 
            "}"}], " ", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"_", ",", "dataSelector"}], "}"}]}], " ", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MatchQ", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"data", "[", "\"\<Background\>\"", "]"}], " ", "/.", " ", 
            
            RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", "Automatic"}]}],
            ",", " ", "dataSelector"}], " ", "]"}], ",", " ", 
         RowBox[{"Complement", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
           "specifiedIndices"}], " ", "]"}], ",", " ", 
         RowBox[{"{", "}"}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}], " ",
    "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"Dimensions", "[", "data", "]"}], "]"}], "\[Equal]", 
    "1"}]}]}]}], "Code",
 CellLabel->
  "In[118]:=",ExpressionUUID->"6db92788-a167-4c04-a0c8-42d1ff845760"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeCells[], takeCells[]", "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"removeCells", "[", " ", 
   RowBox[{
    RowBox[{"deletedCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], "]"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"remainingCells", " ", "=", " ", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", " ", 
         RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], " ", ",", " ", 
        "deletedCells"}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
       "0"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{"head", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}], ",", 
        "\n", "\t\t\t", 
        RowBox[{"display", "[", 
         RowBox[{"[", "remainingCells", "]"}], "]"}]}], "\n", "\t\t", "]"}]}],
      "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[121]:=",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"takeCells", "[", " ", 
   RowBox[{
    RowBox[{"remainingCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], "]"}]}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
     "0"}], ",", "\n", "\t\t", 
    RowBox[{"{", "}"}], ",", "\n", "\t\t", 
    RowBox[{"head", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}], ",", "\n", 
      "\t\t\t", 
      RowBox[{"display", "[", 
       RowBox[{"[", "remainingCells", "]"}], "]"}]}], "\n", "\t\t", "]"}]}], 
   "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "In[122]:=",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],

Cell[CellGroupData[{

Cell["mergeCells[]", "Subsection",ExpressionUUID->"4273560f-e54b-4adb-9bee-6b091dbf1483"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mergeCellGroup", "[", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", " ", 
        RowBox[{"_", ",", "_", ",", "_"}], "]"}], ".."}], "}"}]}], " ", "]"}],
    " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"indices", ",", " ", "data", ",", " ", "display"}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"indices", ",", " ", "data", ",", " ", "display"}], "}"}], 
       " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "cells"}], " ", "]"}]}], ";", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"cells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"indices", ",", " ", "1"}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{"Join", ",", " ", "data"}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"display", ",", " ", "1"}], " ", "]"}]}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mergeCells", "[", " ", 
   RowBox[{"cells", " ", ":", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", 
        RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}], ".."}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"combined", " ", "=", " ", 
      RowBox[{"GatherBy", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", "cells", "}"}], ",", "1"}], "]"}], ",", " ", "Head"}], 
       " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"mergeCellGroup", " ", "/@", " ", "combined"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[123]:=",ExpressionUUID->"1eb45753-deab-496b-bd81-ec8edaa850d6"]
}, Closed]],

Cell[CellGroupData[{

Cell["changeCellDisplay[], changeCellData[]", "Subsection",ExpressionUUID->"4f1a2276-83b8-453b-a0ab-cc4833ce2963"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"changeCellDisplay", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
      "]"}], ",", " ", 
     RowBox[{"ruleSpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"everythingElse", " ", "=", " ", 
        RowBox[{"Complement", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          "cells"}], " ", "]"}]}], ",", "\n", 
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "ruleSpec", "}"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"head", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Join", "[", " ", 
        RowBox[{
         RowBox[{"indices", "[", 
          RowBox[{"[", " ", "everythingElse", "]"}], "]"}], ",", " ", 
         RowBox[{"indices", "[", 
          RowBox[{"[", " ", "cells", " ", "]"}], "]"}]}], " ", "]"}], ",", 
       "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "everythingElse", "]"}], "]"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "cells", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@",
         " ", "data"}], ",", "\n", "\t\t", 
       RowBox[{"Join", "[", " ", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"display", "[", 
          RowBox[{"[", "everythingElse", "]"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"mergeDisplayRules", "[", " ", 
            RowBox[{"rules", ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", 
          " ", 
          RowBox[{"display", "[", 
           RowBox[{"[", "cells", "]"}], "]"}]}]}], "\n", "\t\t", "]"}]}], 
      "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mergeDisplayRules", "[", " ", 
   RowBox[{"newRules_", ",", " ", "oldRules_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Normal", "[", " ", 
   RowBox[{"Merge", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"newRules", ",", " ", "oldRules"}], "}"}], ",", " ", "First"}], 
    " ", "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[125]:=",ExpressionUUID->"07c56442-9200-48cd-877a-3ca14a40d794"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"changeDataInCell", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
      "]"}], ",", " ", 
     RowBox[{"ruleSpec_", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"newData", " ", "=", " ", 
        RowBox[{"Replace", "[", " ", 
         RowBox[{
          RowBox[{"Replace", "[", " ", 
           RowBox[{
            RowBox[{"dataForm", "[", "head", "]"}], ",", " ", "ruleSpec", ",",
             " ", 
            RowBox[{"{", "1", "}"}]}], " ", "]"}], ",", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", 
            "\"\<nothing\>\""}], " ", "]"}], " ", ",", " ", 
          RowBox[{"{", "1", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
       RowBox[{"everythingElse", " ", "=", " ", 
        RowBox[{"Complement", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          "cells"}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"compressCells", " ", "@", " ", 
      RowBox[{"head", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Join", "[", " ", 
         RowBox[{
          RowBox[{"indices", "[", 
           RowBox[{"[", "everythingElse", "]"}], "]"}], ",", " ", 
          RowBox[{"indices", "[", 
           RowBox[{"[", "cells", "]"}], "]"}]}], " ", "]"}], ",", "\n", 
        "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"changeData", "[", " ", 
            RowBox[{
            "everythingElse", ",", " ", "cells", ",", " ", "#1", ",", " ", 
             "#2"}], " ", "]"}], "&"}], ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"newData", ",", " ", "data"}], " ", "}"}]}], " ", "]"}], 
        ",", "\n", "\t\t", 
        RowBox[{"Join", "[", " ", 
         RowBox[{
          RowBox[{"display", "[", 
           RowBox[{"[", "everythingElse", "]"}], "]"}], ",", " ", 
          RowBox[{"display", "[", 
           RowBox[{"[", "cells", "]"}], "]"}]}], " ", "]"}]}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"changeData", "[", " ", 
   RowBox[{
   "everythingElse_", ",", " ", "cells_", ",", " ", "func_", ",", " ", 
    "data_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Join", "[", " ", 
   RowBox[{
    RowBox[{"data", "[", 
     RowBox[{"[", " ", "everythingElse", " ", "]"}], "]"}], ",", " ", 
    RowBox[{"ConstantArray", "[", " ", 
     RowBox[{"func", ",", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"data", "[", 
        RowBox[{"[", "cells", "]"}], "]"}], "]"}]}], " ", "]"}]}], "  ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"changeData", "[", " ", 
   RowBox[{
   "everythingElse_", ",", " ", "cells_", ",", " ", "\"\<nothing\>\"", " ", 
    ",", " ", "data_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Join", "[", " ", 
   RowBox[{
    RowBox[{"data", "[", 
     RowBox[{"[", " ", "everythingElse", " ", "]"}], "]"}], " ", ",", " ", 
    RowBox[{"data", "[", 
     RowBox[{"[", "cells", "]"}], "]"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[127]:=",ExpressionUUID->"8fb05295-5368-4801-8f75-90c91dd21d9d"]
}, Closed]],

Cell[CellGroupData[{

Cell["mapComponents[]", "Subsection",ExpressionUUID->"d37ea0da-1dee-450b-b972-925398878608"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mapComponents", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"head_Symbol", "[", " ", 
      RowBox[{"_", ",", " ", "_", ",", " ", "_"}], " ", "]"}]}]}], " ", "]"}],
   " ", ":=", " ", 
  RowBox[{"packComponentCells", "[", " ", 
   RowBox[{"f", " ", "/@", " ", 
    RowBox[{"unpackComponentCells", "[", " ", "cells", " ", "]"}]}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"mapComponents", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"cells", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_Symbol", "[", 
        RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}]}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"packComponentCells", "[", " ", 
   RowBox[{"f", " ", "/@", " ", 
    RowBox[{"unpackComponentCells", "[", " ", "cells", " ", "]"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[130]:=",ExpressionUUID->"b8d9c7eb-bb3b-4146-ae25-dfe39c4117d6"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["functions for creating mechanisms", "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],

Cell[CellGroupData[{

Cell["some useful patterns", "Subsection",ExpressionUUID->"88b16f67-88c4-4552-ac8f-f05e470433fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"packedCellPattern", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_Symbol", "[", " ", 
      RowBox[{"_", " ", ",", " ", "_List", ",", " ", "_List"}], " ", "]"}], 
     "..."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"labelPattern", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Rule", "[", 
      RowBox[{"_", ",", " ", "_Integer"}], "]"}], "..."}], "}"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[132]:=",ExpressionUUID->"406e5bda-df8e-4f18-b704-dc62be933d56"]
}, Closed]],

Cell[CellGroupData[{

Cell["framework[]", "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"framework", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"MatrixQ", "[", 
            RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
        "mr_", ",", " ", "packedCellPattern", ",", " ", "labelPattern"}], " ",
        "]"}]}], " ", ",", " ", "StandardForm"}], " ", "]"}], " ", ":=", " ", 
   "\n", "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", ",", " ", 
     RowBox[{"toMeshRegion", "[", 
      RowBox[{"f", ",", " ", "Automatic"}], " ", "]"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"framework", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "In[134]:=",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "framework", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<overlapPrecision\>\"", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", "VectorQ"}], "}"}]}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"Except", "[", " ", "packedCellPattern", " ", "]"}]}], " ", ",",
      " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"meshOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
        "\n", 
        RowBox[{"newCoordinates", " ", "=", " ", 
         RowBox[{"PadRight", "[", "coordinates", "]"}]}], ",", "\n", 
        "parsedCoordinates", ",", " ", "parsedCells", ",", " ", 
        "parsedLabels"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "parsedCoordinates", ",", " ", "parsedCells", ",", " ", 
          "parsedLabels"}], "}"}], " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"newCoordinates", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
          RowBox[{"{", "cells", "}"}]}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       
       RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
          RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"framework", "[", " ", 
             RowBox[{"parsedCoordinates", ",", " ", 
              RowBox[{"{", "}"}], ",", " ", "parsedCells", ",", " ", 
              "parsedLabels"}], " ", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}]}], 
           "\n", "\t\t\t", "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
         "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"frameworkPrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", " ", "\"\<overlapPrecision\>\"", " ", "]"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"framework", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
        "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}]}], " ", 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"meshOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", " ", 
         RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
        RowBox[{"removeOverlappingCoordinates", "[", " ", 
         RowBox[{"f", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}]}], 
         " ", "]"}], " ", "]"}], ",", "\n", "\t\t", "Automatic", ",", "\n", 
       "\t\t", "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanism", "::", "precision"}], " ", "=", " ", 
   "\"\<Precision `1` must be a positive, nonzero number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"frameworkPrecisionQ", "[", " ", 
   RowBox[{"prec_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"frameworkPrecisionQ", "[", " ", "prec_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"mechanism", "::", "precision"}], ",", " ", "prec"}], "]"}], 
    ";", " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[136]:=",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], " ", ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", 
   " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<type\>\"", ",", "\n", "\t", "\"\<positions\>\"", ",", " ", "\n", 
     "\t", "\"\<mesh\>\"", ",", " ", "\n", "\t", "\"\<components\>\"", ",", 
     " ", "\n", "\t", "\"\<labels\>\"", ",", " ", "\n", "\t", 
     "\"\<EmbeddingDimension\>\"", ",", " ", "\n", "\t", 
     "\"\<DisplayDimension\>\"", ",", "\n", "\t", "\"\<VertexNumber\>\"", ",",
      "\n", "\t", "\"\<edges\>\"", ",", "\n", "\t", "\"\<faces\>\""}], "\n", 
    "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<type\>\"", "]"}], " ", ":=", " ", "framework"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<positions\>\"", "]"}], " ", ":=", " ", "coordinates"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<mesh\>\"", "]"}], " ", ":=", " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<mesh\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"framework", "[", " ", 
      RowBox[{"coordinates", ",", " ", 
       RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
      "]"}], ",", " ", "Automatic"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<components\>\"", "]"}], " ", ":=",
    " ", "cells"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<labels\>\"", "]"}], " ", ":=", " ", "labels"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<EmbeddingDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"MeshCoordinates", "[", "coordinates", "]"}], "]"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<VertexNumber\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"DeleteDuplicatesBy", "[", " ", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Select", "[", " ", 
       RowBox[{
        RowBox[{"cells", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Last", "[", 
            RowBox[{"Dimensions", "[", "#", "]"}], "]"}], "\[Equal]", "2"}]}],
          " ", "&"}]}], " ", "]"}], ",", "1"}], "]"}], ",", " ", "Sort"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"framework", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",",
       " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<edges\>\"", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", 
     RowBox[{"m", ",", "1"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MeshCells", "[", " ", 
    RowBox[{
     RowBox[{"toMeshRegion", "[", " ", 
      RowBox[{
       RowBox[{"framework", "[", " ", 
        RowBox[{"coordinates", ",", " ", 
         RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
        "]"}], ",", " ", "Automatic"}], " ", "]"}], " ", ",", "2"}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"framework", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",", 
     " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MeshCells", "[", 
    RowBox[{"m", ",", "2"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[142]:=",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"]
}, Closed]],

Cell[CellGroupData[{

Cell["origami[]", "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"origami", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"MatrixQ", "[", 
            RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
        "mr_", ",", " ", "packedCellPattern", ",", " ", "labelPattern"}], " ",
        "]"}]}], " ", ",", " ", "StandardForm"}], " ", "]"}], " ", ":=", "\n",
    "\t", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"MeshRegionQ", "[", "mr", "]"}], ",", " ", "mr", ",", " ", 
     RowBox[{"toMeshRegion", "[", 
      RowBox[{"f", ",", " ", "Automatic"}], " ", "]"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"origami", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "In[157]:=",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "origami", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<overlapPrecision\>\"", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "\n", "This"}], " ", "is", " ", "a", " ", "kludge", " ", 
    "to", " ", 
    RowBox[{"fix", " ", "?", "origami"}], " ", "which", " ", "returns", " ", 
    "an", " ", "error", " ", "from", " ", "PadRight", " ", "otherwise", " ", 
    "for", " ", "reasons", " ", "that", " ", "are", " ", "not", " ", 
    "entirely", " ", 
    RowBox[{"clear", "."}]}], "\n", "***)"}]}], "\n", 
 RowBox[{
  RowBox[{"mypad", "[", " ", 
   RowBox[{"c_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n1_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", "n2_"}], "}"}]}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"c", ",", " ", 
    RowBox[{"{", 
     RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mypad", "[", " ", 
    RowBox[{"c_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", "c"}], "\n", 
  RowBox[{"(*", "*****)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", "VectorQ"}], "}"}]}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"Except", "[", " ", "packedCellPattern", " ", "]"}]}], " ", ",",
      " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"meshOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
        "\n", 
        RowBox[{"newCoordinates", " ", "=", " ", 
         RowBox[{"PadRight", "[", "coordinates", "]"}]}], ",", "\n", 
        "parsedCoordinates", ",", " ", "parsedCells", ",", " ", 
        "parsedLabels"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "parsedCoordinates", ",", " ", "parsedCells", ",", " ", 
          "parsedLabels"}], "}"}], " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"newCoordinates", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
          RowBox[{"{", "cells", "}"}]}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       
       RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
          RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"origami", "[", " ", 
             RowBox[{
              RowBox[{"mypad", "[", " ", 
               RowBox[{"parsedCoordinates", " ", ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", "parsedCoordinates", "]"}], " ", ",",
                   " ", "3"}], "}"}]}], " ", "]"}], ",", " ", 
              RowBox[{"{", "}"}], ",", " ", "parsedCells", ",", " ", 
              "parsedLabels"}], " ", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}]}], 
           "\n", "\t\t\t", "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
         "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"frameworkPrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", " ", "\"\<overlapPrecision\>\"", " ", "]"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"origami", "[", " ", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"origami", "[", 
      RowBox[{
       RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
       "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}]}], " ", 
    ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"meshOptions", " ", "=", " ", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"{", "opt", "}"}], ",", " ", 
        RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
       RowBox[{"removeOverlappingCoordinates", "[", " ", 
        RowBox[{"f", ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}]}], " ",
         "]"}], " ", "]"}], ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t",
       "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[159]:=",ExpressionUUID->"bddf89f6-b517-416e-b7e7-6e4fe168a0c1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", 
   " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<type\>\"", ",", "\n", "\t", "\"\<positions\>\"", ",", " ", "\n", 
     "\t", "\"\<mesh\>\"", ",", " ", "\n", "\t", "\"\<components\>\"", ",", 
     " ", "\n", "\t", "\"\<labels\>\"", ",", " ", "\n", "\t", 
     "\"\<EmbeddingDimension\>\"", ",", " ", "\n", "\t", 
     "\"\<DisplayDimension\>\"", ",", "\n", "\t", "\"\<VertexNumber\>\"", ",",
      "\n", "\t", "\"\<edges\>\"", ",", "\n", "\t", "\"\<faces\>\""}], "\n", 
    "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<type\>\"", "]"}], " ", ":=", " ", "origami"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<positions\>\"", "]"}], " ", ":=", " ", "coordinates"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<mesh\>\"", "]"}], " ", ":=", " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<mesh\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"origami", "[", " ", 
      RowBox[{"coordinates", ",", " ", 
       RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
      "]"}], ",", " ", "Automatic"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      "labelPattern"}], " ", "]"}], "[", "\"\<components\>\"", "]"}], " ", ":=",
    " ", "cells"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<labels\>\"", "]"}], " ", ":=", " ", "labels"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<EmbeddingDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
    "\"\<DisplayDimension\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", " ", 
     RowBox[{"MeshCoordinates", "[", " ", 
      RowBox[{"toMeshRegion", "[", " ", 
       RowBox[{
        RowBox[{"origami", "[", 
         RowBox[{"coordinates", ",", 
          RowBox[{"{", "}"}], ",", "cells", ",", "labels"}], "]"}], ",", " ", 
        "Automatic"}], " ", "]"}], " ", "]"}], " ", "]"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<VertexNumber\>\"", "]"}], " ", ":=", " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern"}], " ", "]"}], "[", "\"\<edges\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{"DeleteDuplicatesBy", "[", " ", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Select", "[", " ", 
       RowBox[{
        RowBox[{"cells", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Last", "[", 
            RowBox[{"Dimensions", "[", "#", "]"}], "]"}], "\[Equal]", "2"}]}],
          " ", "&"}]}], " ", "]"}], ",", "1"}], "]"}], ",", " ", "Sort"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",",
       " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
    "\"\<edges\>\"", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"MeshCells", "[", 
     RowBox[{"m", ",", "1"}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}]}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MeshCells", "[", " ", 
    RowBox[{
     RowBox[{"toMeshRegion", "[", " ", 
      RowBox[{
       RowBox[{"origami", "[", " ", 
        RowBox[{"coordinates", ",", " ", 
         RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
        "]"}], ",", " ", "Automatic"}], " ", "]"}], " ", ",", "2"}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "m_MeshRegion", ",", 
     " ", "packedCellPattern", ",", " ", "labelPattern"}], " ", "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MeshCells", "[", 
    RowBox[{"m", ",", "2"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[164]:=",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeOverlappingCoordinates[]", "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],

Cell[BoxData[
 RowBox[{
  RowBox[{"removeOverlappingCoordinates", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", 
     RowBox[{
     "coordinateList_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
      "labels_"}], "]"}], ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"N", "[", "#", "]"}], "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ">", "0"}]}], " ", "&"}], ")"}]}], 
     " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "12"}], ")"}]}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"numberedVertices", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Range", " ", "@", " ", 
           RowBox[{"Length", " ", "@", " ", "coordinateList"}]}], ",", " ", 
          "coordinateList"}], " ", "}"}], "]"}]}], ",", "\n", "\t", 
      "gatheredVertices", ",", "rules"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"gatheredVertices", "=", 
      RowBox[{"GatherBy", "[", "\n", "\t\t", 
       RowBox[{"numberedVertices", ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "they", " ", "are", " ", "the", " ", "same", " ", "if", " ", "they", 
          " ", "are", " ", "the", " ", "same", " ", "within", " ", "the", " ",
           "specified", " ", 
          RowBox[{"precision", "."}]}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"Rationalize", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "precision"}], 
          "]"}], "&"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
     RowBox[{"rules", "=", 
      RowBox[{"Dispatch", " ", "@", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"(*", 
         RowBox[{
         "two", " ", "levels", " ", "to", " ", "thread", " ", "through"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"Thread", " ", "/@", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"gatheredVertices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "gatheredVertices", "]"}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", "]"}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"head", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
        "gatheredVertices"}], ",", "\n", "\t\t", "mr", ",", "\n", "\t\t", 
       RowBox[{"deleteDuplicateCells", " ", "/@", " ", 
        RowBox[{"replaceCellIndices", "[", 
         RowBox[{"cells", ",", "rules"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"replaceRules", "[", " ", 
        RowBox[{"labels", ",", " ", "rules", ",", " ", "2"}], " ", "]"}]}], 
      "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[179]:=",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDegenerateCellsFromMechanism[]", "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
   RowBox[{"head_", "[", 
    RowBox[{
    "coordinates_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
     "labels_"}], "]"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"head", "[", " ", 
   RowBox[{"coordinates", ",", " ", "mr", ",", " ", 
    RowBox[{"deleteDegenerateCells", "[", "cells", "]"}], ",", " ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Reverse", "[", "labels", "]"}], "]"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[180]:=",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseCells[]", "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"distributePropertyRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{"h_List", " ", ",", " ", "properties_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Property", "[", 
           RowBox[{"#", ",", " ", "properties"}], "]"}], "&"}], " ", "/@", 
         " ", "h"}], ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"h_Symbol", "[", "i_", "]"}], ",", " ", "properties1_"}], 
          " ", "]"}], ",", " ", "properties2_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{"h", "[", "i", "]"}], ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "properties1", "}"}], ",", 
            RowBox[{"{", "properties2", "}"}]}], "}"}], "]"}]}], " ", 
        "]"}]}]}], "\n", "}"}]}], " ", ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expansionRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{"face", "[", " ", "i_", " ", "]"}], ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"face", "[", "i", "]"}], ",", " ", "properties"}], " ", 
          "]"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"Property", "[", " ", 
            RowBox[{
             RowBox[{"rigidBar", "[", "#", "]"}], ",", " ", "properties"}], 
            " ", "]"}], " ", "&"}], " ", "/@", " ", 
          RowBox[{"Partition", "[", " ", 
           RowBox[{"i", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], " ", 
           "]"}]}]}], "\n", "\t", "}"}]}], ",", "\n", "\t", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{"fold", "[", " ", "i_", " ", "]"}], ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"fold", "[", "i", "]"}], ",", " ", "properties"}], " ", 
          "]"}], ",", "\n", "\t\t", 
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"rigidBar", "[", "i", "]"}], ",", " ", "properties"}], " ",
           "]"}]}], "\n", "\t", "}"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"interpretComponentCellsRule", " ", "=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Property", "[", " ", 
       RowBox[{
        RowBox[{"Point", "[", " ", 
         RowBox[{"label_", " ", "\[Rule]", " ", "pos_"}], " ", "]"}], ",", 
        " ", "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{"Point", ",", " ", 
        RowBox[{"label", " ", "\[Rule]", " ", "pos"}], ",", " ", 
        RowBox[{"{", "}"}], ",", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "properties", "}"}], "]"}], ",", " ", 
          "$meshRegionProperties"}], "]"}]}], " ", "}"}]}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Property", "[", " ", 
       RowBox[{
        RowBox[{"h_", "[", " ", 
         RowBox[{"i", " ", ":", " ", 
          RowBox[{"Except", "[", "_Rule", "]"}]}], " ", "]"}], ",", " ", 
        "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{"h", ",", " ", "i", ",", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "properties", "}"}], "]"}], ",", " ", 
          RowBox[{"Except", "[", "$meshRegionProperties", "]"}]}], "]"}], ",",
         " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "properties", "}"}], "]"}], ",", " ", 
          "$meshRegionProperties"}], "]"}]}], "}"}]}]}], "\n", "}"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[181]:=",ExpressionUUID->"fac8421b-0907-4aa8-8985-486ee81d1798"],

Cell[BoxData[
 RowBox[{
  RowBox[{"parseCells", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "coordinates_", ",", " ", "componentCells_", ",", " ", "labels_"}], 
     "}"}], ",", " ", "cellList_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"expandedCells", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"ReplaceAll", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", " ", 
           RowBox[{"ReplaceRepeated", "[", " ", 
            RowBox[{
             RowBox[{"Property", "[", " ", 
              RowBox[{
               RowBox[{"{", "cellList", "}"}], ",", " ", 
               RowBox[{"{", "}"}]}], " ", "]"}], ",", " ", 
             "distributePropertyRules"}], "]"}], " ", "]"}], ",", " ", 
          "expansionRules"}], " ", "]"}], "]"}]}], ",", "\n", "\t", 
      "newComponentCells", ",", " ", "newDisplayCells", ",", " ", 
      "newVertices", ",", " ", "newCoordinates", ",", " ", "newLabels"}], 
     "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newComponentCells", " ", "=", " ", 
      RowBox[{"Replace", "[", " ", 
       RowBox[{
       "expandedCells", ",", " ", "interpretComponentCellsRule", ",", " ", 
        RowBox[{"{", "1", "}"}]}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"newVertices", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"newComponentCells", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{"Point", ",", " ", "_Rule", ",", " ", "_", ",", " ", "_"}], 
         " ", "}"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"newCoordinates", " ", "=", " ", 
      RowBox[{"Join", "[", " ", 
       RowBox[{"coordinates", ",", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "newVertices", "]"}], " ", ">", " ", "0"}], 
          ",", " ", 
          RowBox[{"Last", " ", "/@", " ", 
           RowBox[{
            RowBox[{"Transpose", "[", " ", "newVertices", " ", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
          RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"newLabels", " ", "=", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "newVertices", "]"}], " ", ">", " ", "0"}], 
        ",", " ", 
        RowBox[{"Rule", " ", "@@@", " ", 
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"newVertices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2", ",", "1"}], "]"}], "]"}], ",", " ", 
            RowBox[{"Range", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "coordinates", "]"}], "+", "1"}], ",", 
              " ", 
              RowBox[{
               RowBox[{"Length", "[", "coordinates", "]"}], "+", 
               RowBox[{"Length", "[", "newVertices", "]"}]}]}], " ", "]"}]}], 
           "}"}], " ", "]"}]}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"PadRight", "[", " ", "newCoordinates", " ", "]"}], ",", "\n", 
       "\t\t", 
       RowBox[{"packComponentCells", "[", " ", 
        RowBox[{"replaceCellIndices", "[", " ", 
         RowBox[{
          RowBox[{"Join", "[", " ", 
           RowBox[{"componentCells", ",", " ", 
            RowBox[{"Join", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", " ", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], "&"}], " ", "/@",
                " ", "newVertices"}], ",", " ", 
              RowBox[{"DeleteCases", "[", " ", 
               RowBox[{"newComponentCells", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"Point", ",", "_Rule", ",", "_", ",", "_"}], "}"}]}],
                " ", "]"}]}], " ", "]"}]}], " ", "]"}], ",", " ", 
          RowBox[{"Join", "[", " ", 
           RowBox[{"labels", ",", " ", "newLabels"}], " ", "]"}]}], " ", 
         "]"}], "  ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"Join", "[", 
        RowBox[{"labels", ",", " ", "newLabels"}], "]"}]}], "\n", "\t", 
      "}"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[184]:=",ExpressionUUID->"8adeae4f-37d5-4438-a96f-9fdde2cba2b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["replaceRules[]", "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "appliedRules__"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules_", ",", " ", "appliedRules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules", ",", " ", "appliedRules", ",", " ", "1"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"rules", " ", ":", " ", 
      RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
     "1"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"flippedRules", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Rule", " ", "@@@", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Replace", "[", " ", 
          RowBox[{
           RowBox[{"flippedRules", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "appliedRules", 
           ",", " ", 
           RowBox[{"{", "1", "}"}]}], " ", "]"}], ",", " ", 
         RowBox[{"flippedRules", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"replaceRules", "[", " ", 
   RowBox[{
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
    "2"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"flippedRules", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"Rule", " ", "@@@", " ", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flippedRules", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"Replace", "[", " ", 
         RowBox[{
          RowBox[{"flippedRules", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "appliedRules", ",",
           " ", 
          RowBox[{"{", "1", "}"}]}], " ", "]"}]}], " ", "}"}], " ", "]"}]}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[185]:=",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["functions to manipulate mechanisms", "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],

Cell[CellGroupData[{

Cell["selectCells[]", "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"selectCells", "[", " ", "patt_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", " ", "patt", " ", "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"identifyComponents", "[", " ", 
             RowBox[{"pattern", ",", " ", "#"}], "]"}], ",", " ", "#"}], " ", 
           "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selectCells", "[", " ", 
    RowBox[{"patt_", ",", " ", "dataSpec_", ",", " ", "f_"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"pattern", " ", "=", " ", 
      RowBox[{"cellPattern", "[", " ", "patt", " ", "]"}]}], " ", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"takeCells", "[", " ", 
            RowBox[{
             RowBox[{"identifyComponents", "[", " ", 
              RowBox[{"pattern", " ", ",", " ", "#"}], " ", "]"}], ",", " ", 
             "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], " ", "}"}], ",", 
      "\n", "\t\t", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"remainingCells", " ", "=", " ", 
          RowBox[{"Flatten", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"takeCells", "[", " ", 
              RowBox[{
               RowBox[{"selectComponents", "[", " ", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec", ",", 
                 " ", "f", ",", " ", "#"}], " ", "]"}], " ", ",", " ", "#"}], 
              " ", "]"}], "&"}], " ", "/@", " ", "cells"}], " ", "]"}]}], 
         "}"}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Head", "[", "m", "]"}], "[", " ", 
         RowBox[{
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", "remainingCells", ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "\n", "\t\t", 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[189]:=",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"selectCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"selectCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"selectCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_", ",", 
    " ", "dataSpec_", ",", " ", "f_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"selectCells", "[", 
      RowBox[{"patt", ",", " ", "dataSpec", ",", " ", "f"}], "]"}], "[", "m", 
     "]"}], ",", " ", "Automatic"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[191]:=",ExpressionUUID->"64bb5b47-556a-4e46-8b4d-f51ef1d8a346"]
}, Closed]],

Cell[CellGroupData[{

Cell["changeCellData[], highlightCells[]", "Subsection",ExpressionUUID->"901ddd13-737f-4e91-b19e-1ed99e5bece8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"changeCellData", "[", " ", 
     RowBox[{"patt_", " ", ",", " ", 
      RowBox[{"dataSpec", " ", ":", " ", 
       RowBox[{
        RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], "[", 
    " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pattern", " ", "=", " ", 
        RowBox[{"cellPattern", "[", "patt", "]"}]}], ",", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "dataSpec", "}"}], "]"}]}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"changeDataInCell", "[", " ", 
          RowBox[{
           RowBox[{"identifyComponents", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], ",", " ", "#", 
           " ", ",", " ", "data"}], "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"highlightCells", "[", " ", 
    RowBox[{"patt_", ",", " ", 
     RowBox[{"displaySpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], "[", 
   " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", "patt", "]"}]}], ",", " ", 
      RowBox[{"display", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "displaySpec", "}"}], "]"}]}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "m", "]"}], "[", " ", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"toMeshRegion", "[", 
         RowBox[{"#", ",", " ", "Automatic"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"#", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "@", " ", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"changeCellDisplay", "[", " ", 
          RowBox[{
           RowBox[{"identifyComponents", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], ",", " ", "#", 
           ",", " ", "display"}], " ", "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[193]:=",ExpressionUUID->"70f625df-561a-4796-a043-b09f24c338ff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"changeCellData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_", ",", 
    " ", "dataSpec_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"changeCellData", "[", 
    RowBox[{"patt", ",", "dataSpec"}], "]"}], "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"highlightCells", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_", ",", 
    " ", "displaySpec_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"highlightCells", "[", " ", 
      RowBox[{"patt", ",", " ", "displaySpec"}], " ", "]"}], "[", "m", "]"}], 
    ",", " ", "Automatic"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[195]:=",ExpressionUUID->"37afab49-8fac-4645-8358-cb2bfeee5c7f"]
}, Closed]],

Cell[CellGroupData[{

Cell["spitEdge[]", "Subsection",ExpressionUUID->"5fcbe626-6c14-44c5-bab9-9d2d729d4048"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"existingEdgeQ", "[", " ", 
    RowBox[{"m_", ",", " ", "edgeSpec_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"MemberQ", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<edges\>\"", "]"}], ",", " ", 
     RowBox[{"edgeSpec", "|", 
      RowBox[{"Reverse", "[", "edgeSpec", "]"}]}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"splitEdge", "[", " ", 
     RowBox[{
      RowBox[{"edgeSpec", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"_", ",", "_"}], "}"}]}], ",", " ", 
      RowBox[{"label_", " ", "\[Rule]", " ", 
       RowBox[{"pos_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"VectorQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}]}], " ", 
     "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"edge", " ", "=", " ", 
        RowBox[{"edgeSpec", " ", "/.", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"addCells", "[", " ", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Point", "[", " ", 
            RowBox[{"label", " ", "\[Rule]", " ", "pos"}], " ", "]"}], ",", 
           "\n", "\t\t\t", 
           RowBox[{"rigidBar", "[", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"edge", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", "label"}], "}"}], 
            " ", "]"}], ",", "\n", "\t\t\t", 
           RowBox[{"rigidBar", "[", " ", 
            RowBox[{"{", 
             RowBox[{"label", ",", " ", 
              RowBox[{"edge", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}], " ", "]"}]}], "\n", 
          "\t\t", "}"}], " ", "]"}], " ", "@", " ", 
        RowBox[{
         RowBox[{"deleteCells", "[", " ", 
          RowBox[{"_", "[", "edge", "]"}], " ", "]"}], " ", "@", " ", "m"}]}],
        "  ", "/;", " ", 
       RowBox[{"existingEdgeQ", "[", 
        RowBox[{"m", ",", " ", "edge"}], " ", "]"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"Length", "[", "pos", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"splitEdge", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "edgeSpec_", 
    ",", " ", 
    RowBox[{"label_", " ", "\[Rule]", " ", "pos_"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"splitEdge", "[", " ", 
      RowBox[{"edgeSpec", ",", " ", 
       RowBox[{"label", " ", "\[Rule]", " ", "pos"}]}], " ", "]"}], "[", "m", 
     "]"}], " ", ",", " ", "Automatic"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[197]:=",ExpressionUUID->"a6ffe01d-8df3-4581-a8a3-67e15d54ebde"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteCells[]", "Subsection",ExpressionUUID->"7c158d78-4fa5-4987-8d54-d4f45a2f6c7d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"deleteCells", "[", " ", "patt_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"pattern", " ", "=", " ", 
      RowBox[{"cellPattern", "[", " ", "patt", " ", "]"}]}], "}"}], ",", "\n",
     "\t", 
    RowBox[{
     RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"removeCells", "[", " ", 
          RowBox[{
           RowBox[{"identifyComponents", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], "]"}], ",", " ", "#"}], " ", 
          "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"m", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[200]:=",ExpressionUUID->"32f57e85-ddf8-44d8-919a-9bb69ab25708"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"deleteCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic"}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[201]:=",ExpressionUUID->"c0315f13-2705-44fb-a3d4-f24325b79ef7"]
}, Closed]],

Cell[CellGroupData[{

Cell["addCells[]", "Subsection",ExpressionUUID->"3aff73a6-10d2-421c-a3eb-3899330f45fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "addCells", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<overlapPrecision\>\"", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "12"}], ")"}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"addCells", "[", " ", 
    RowBox[{"cells_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newMech", " ", "=", " ", 
       RowBox[{"parseCells", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", "cells"}], " ",
         "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
     RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
      RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"newMech", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
           RowBox[{"makePositionsIntoRules", "[", " ", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], ",", "\n", 
          "\t\t\t\t", 
          RowBox[{"{", "}"}], ",", "\n", "\t\t\t\t", 
          RowBox[{"mergeCells", "[", " ", 
           RowBox[{
            RowBox[{"newMech", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}], ",", "\n", 
          "\t\t\t\t", 
          RowBox[{"newMech", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t\t\t", "]"}], ",", "\n",
         "\t\t\t", 
        RowBox[{
        "OptionValue", "[", " ", "\"\<overlapPrecision\>\"", " ", "]"}]}], 
       "\n", "\t\t", "]"}], "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   
   RowBox[{"frameworkPrecisionQ", "[", " ", 
    RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[202]:=",ExpressionUUID->"95bfe1df-9c1b-4d36-a1b9-02340e19ec89"],

Cell[BoxData[
 RowBox[{
  RowBox[{"addCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "cells_", ",",
     " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"addCells", "[", 
      RowBox[{"cells", ",", " ", "opt"}], " ", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic"}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[204]:=",ExpressionUUID->"cde68282-69ce-49d3-b164-4a4070393ff2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"makePositionsIntoRules", "[", "coordinates_", "]"}], " ", ":=", 
  " ", 
  RowBox[{"{", " ", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"vertexPosition", "[", 
      RowBox[{"n_Integer", ",", "\"\<x\>\""}], "]"}], " ", "\[RuleDelayed]", 
     " ", 
     RowBox[{"coordinates", "[", 
      RowBox[{"[", 
       RowBox[{"n", ",", "1"}], "]"}], "]"}]}], ",", " ", "\n", "\t", 
    RowBox[{
     RowBox[{"vertexPosition", "[", 
      RowBox[{"n_Integer", ",", "\"\<y\>\""}], "]"}], " ", "\[RuleDelayed]", 
     " ", 
     RowBox[{"coordinates", "[", 
      RowBox[{"[", 
       RowBox[{"n", ",", "2"}], "]"}], "]"}]}], ",", " ", "\n", "\t", 
    RowBox[{
     RowBox[{"vertexPosition", "[", 
      RowBox[{"n_Integer", ",", "\"\<z\>\""}], "]"}], " ", "\[RuleDelayed]", 
     " ", 
     RowBox[{"coordinates", "[", 
      RowBox[{"[", 
       RowBox[{"n", ",", "3"}], "]"}], "]"}]}]}], "\n", "\t", "}"}]}]], "Code",\

 CellLabel->
  "In[205]:=",ExpressionUUID->"39fbf181-116b-4086-9bf3-53d3e3e15741"]
}, Closed]],

Cell[CellGroupData[{

Cell["placeVertices[], displaceVertices[]", "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"placeVertices", "[", " ", 
     RowBox[{"moveSpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"vertexMoves", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "moveSpec", "}"}], "]"}]}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"newVertexPositions", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"vertexMoves", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", 
         RowBox[{"vertexMoves", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"placeVertices", "[", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
   "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", " ", 
    RowBox[{"vertices", ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "vertices", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"placeVertices", "[", " ", 
     RowBox[{"vertices_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
    "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertices", "]"}], " ", "\[NotEqual]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"placeVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", "vertices", "]"}], "]"}], " ", 
        "\[NotEqual]", " ", 
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}], "]"}]}], ",", 
       " ", 
       RowBox[{"Message", "[", " ", 
        RowBox[{"placeVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], ";",
      "\n", "\t", "m"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"placeVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices is incorrect.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"placeVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Some vertices are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"placeVertices", "::", "pos"}], " ", "=", " ", 
    "\"\<All positions are not of the same dimension as coordinates.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{"coordinates", ",", " ", 
     RowBox[{"Thread", "[", " ", 
      RowBox[{"vertices", " ", "\[Rule]", " ", "pos"}], " ", "]"}]}], " ", 
    "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "coordinates", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Dimensions", "[", "pos", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"placeVertices", "::", "vert"}], "]"}], ";", " ", 
    "coordinates"}], " ", ")"}]}], "\n", 
 RowBox[{
  RowBox[{"newVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", " ", ",", " ", "_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"placeVertices", "::", "pos"}], "]"}], ";", " ", "coordinates"}],
    " ", ")"}]}]}], "Code",
 CellLabel->
  "In[206]:=",ExpressionUUID->"3b0edd43-f179-414d-aa01-523bd36dc076"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displaceVertices", "[", " ", 
     RowBox[{"moveSpec", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "___Rule", "}"}], "|", "_Rule"}]}], " ", "]"}], "[", " ", 
    
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"vertexMoves", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "moveSpec", "}"}], "]"}]}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"moveVertexPositions", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"vertexMoves", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", 
         RowBox[{"vertexMoves", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displaceVertices", "[", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
   "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"Head", "[", "m", "]"}], "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "+", " ", 
      "vertices"}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "vertices", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displaceVertices", "[", " ", 
     RowBox[{"vertices_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
    "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertices", "]"}], " ", "\[NotEqual]", " ", 
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"displaceVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", "vertices", "]"}], "]"}], " ", 
        "\[NotEqual]", " ", 
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}], "]"}]}], ",", 
       " ", 
       RowBox[{"Message", "[", " ", 
        RowBox[{"displaceVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], 
     ";", "\n", "\t", "m"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displaceVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices is incorrect.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displaceVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Some vertices are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displaceVertices", "::", "pos"}], " ", "=", " ", 
    "\"\<All positions are not of the same dimension as coordinates.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices_", "?", 
     RowBox[{"(", " ", 
      RowBox[{
       RowBox[{"VectorQ", "[", " ", 
        RowBox[{"#", ",", " ", "IntegerQ"}], " ", "]"}], " ", "&"}], " ", 
      ")"}]}], " ", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", " ", 
      RowBox[{
       RowBox[{"MatrixQ", "[", " ", 
        RowBox[{"#", ",", " ", "NumericQ"}], " ", "]"}], " ", "&"}], " ", 
      ")"}]}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{"coordinates", ",", " ", 
     RowBox[{"Thread", "[", " ", 
      RowBox[{"vertices", " ", "\[Rule]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", "vertices", "]"}], "]"}], " ", "+", " ", "pos"}], 
        ")"}]}], " ", "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Last", "[", 
     RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}], " ", "\[Equal]", 
    " ", 
    RowBox[{"Last", "[", 
     RowBox[{"Dimensions", "[", "pos", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "vertices_", ",", " ", "pos_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"VectorQ", "[", 
        RowBox[{"vertices", ",", " ", "IntegerQ"}], " ", "]"}], "]"}], ",", 
      " ", 
      RowBox[{"Message", "[", " ", 
       RowBox[{"displaceVertices", "::", "vert"}], " ", "]"}]}], " ", "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "[", " ", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"pos", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"Last", "[", 
          RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}], " ", 
         "\[Equal]", " ", 
         RowBox[{"Last", "[", 
          RowBox[{"Dimensions", "[", "pos", "]"}], "]"}]}]}], " ", "]"}], ",",
       " ", 
      RowBox[{"Message", "[", " ", 
       RowBox[{"displaceVertices", "::", "pos"}], " ", "]"}]}], " ", "]"}], 
    ";", "\n", "\t", "coordinates"}], "\n", ")"}]}]}], "Code",
 CellLabel->
  "In[215]:=",ExpressionUUID->"dc6fae3e-0250-465d-b252-f2807af8cf17"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"placeVertices", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "moveSpec_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"placeVertices", "[", "moveSpec", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"displaceVertices", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "moveSpec_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"displaceVertices", "[", "moveSpec", "]"}], "[", "m", "]"}], ",",
     " ", "Automatic"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[223]:=",ExpressionUUID->"e71eaeac-52c8-47a5-808b-97451c4d3a99"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteVertices[]", "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"deleteVertices", "[", " ", 
    RowBox[{"vertices_", "?", "VectorQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"pattern", " ", "=", " ", 
      RowBox[{"Alternatives", " ", "@@", " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"___", ",", "#", ",", "___"}], "}"}], "|", "#"}], "&"}], 
         " ", "/@", " ", "vertices"}], " ", ")"}]}]}], " ", "}"}], ",", "\n", 
    
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"remainingCells", " ", "=", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"removeCells", "[", " ", 
            RowBox[{
             RowBox[{"identifyComponents", "[", " ", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "[", "pattern", "]"}], 
                "}"}], " ", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], " ",
             "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], " ", "}"}], ",", 
      "\n", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"remainingVertices", " ", "=", " ", 
          RowBox[{"Complement", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"m", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
            RowBox[{"vertices", " ", "/.", " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "]"}]}], " ", "}"}], 
        ",", "\n", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"remappingRules", " ", "=", " ", 
            RowBox[{"Thread", "[", " ", 
             RowBox[{"remainingVertices", " ", "\[Rule]", " ", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "remainingVertices", "]"}], "]"}]}], 
             "]"}]}], " ", "}"}], ",", "\n", "\t", 
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", " ", "remainingVertices"}], "]"}], "]"}], ",",
             "\n", "\t\t", 
            RowBox[{"{", "}"}], ",", "\n", "\t\t", 
            RowBox[{"replaceCellIndices", "[", " ", 
             RowBox[{"remainingCells", ",", " ", "remappingRules"}], " ", 
             "]"}], ",", "\n", "\t\t", 
            RowBox[{"replaceRules", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", " ", "remappingRules", 
              ",", " ", "2"}], " ", "]"}]}], "\n", "\t", "]"}]}], "\n", 
         "]"}]}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[225]:=",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "vertices_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"deleteVertices", "[", "vertices", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic"}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[226]:=",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],

Cell[CellGroupData[{

Cell["mapCells[]", "Subsection",ExpressionUUID->"4b83baad-cf9c-4e33-a249-8b29b2e3b88f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mapCells", "::", "err"}], "=", 
    "\"\<Mapping function did not produce a viable mechanism.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mapCells", "[", " ", "f_", " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"newComponents", " ", "=", " ", 
       RowBox[{"mapComponents", "[", " ", 
        RowBox[{"f", ",", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "newComponents", "]"}], " ", "=!=", " ", 
        "List"}], " ", ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"mapCells", "::", "err"}], "]"}], ";", " ", "m"}], ",", "\n",
        "\t\t", 
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"DeleteCases", "[", " ", 
          RowBox[{"newComponents", ",", " ", "_packComponentCells"}], " ", 
          "]"}], ",", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], "\n", "\t", "]"}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mapCells", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"mapCells", "[", "f", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[227]:=",ExpressionUUID->"fe916ab9-6145-4201-b3c5-46c8bd2c8e48"]
}, Closed]],

Cell[CellGroupData[{

Cell["joinMechanism[]", "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "joinMechanism", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<overlapPrecision\>\"", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"joinMechanism", "[", " ", 
    RowBox[{
     RowBox[{"meshes", " ", ":", " ", 
      RowBox[{
       RowBox[{"__", "?", "mechanismQ"}], "|", 
       RowBox[{"{", 
        RowBox[{"__", "?", "mechanismQ"}], "}"}]}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", " ", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "meshes", "}"}], "]"}]}], ",", " ", 
       RowBox[{"meshOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}]}], " ", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"num", " ", "=", " ", 
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "+", "1"}], "&"}], " ", "/@", " ", 
                 RowBox[{"Accumulate", "[", " ", 
                  RowBox[{"Length", " ", "/@", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}]}],
                " ", "}"}], ",", " ", "1"}], " ", "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
        RowBox[{"addMeshRegion", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t\t", 
           RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"m", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "\n", 
              "\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}],
                ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"{", "}"}], ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"mergeCells", " ", "@@", " ", 
                RowBox[{"MapThread", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"replaceCellIndices", "[", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{
                    "n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}]}], "]"}],
                    "&"}], ",", " ", 
                  RowBox[{"{", " ", 
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], "]"}]}], ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"Flatten", " ", "@", " ", 
                RowBox[{"MapThread", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"replaceRules", "[", " ", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{"n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}], 
                    ",", " ", "2"}], " ", "]"}], "&"}], ",", " ", 
                  RowBox[{"{", " ", 
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "4"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], " ", "]"}]}]}], "\n", "\t\t\t\t\t",
               "]"}], ",", "\n", "\t\t\t\t\t", 
             RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}]}], 
            "\n", "\t\t\t\t", "]"}], "\n", "\t\t\t", "]"}], ",", "\n", 
          "\t\t\t", "Automatic", ",", "\n", "\t\t\t", "meshOptions"}], "\n", 
         "\t\t", "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"frameworkPrecisionQ", "[", " ", 
        RowBox[{"OptionValue", "[", "\"\<overlapPrecision\>\"", "]"}], " ", 
        "]"}], " ", "&&", " ", 
       RowBox[{"sameHeadsQ", "[", " ", "m", " ", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanism", "::", "comb"}], " ", "=", " ", 
   "\"\<Cannot combine mechanisms of different types.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sameHeadsQ", "[", " ", "expr_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"SameQ", "[", " ", 
     RowBox[{"Head", " ", "/@", " ", "expr"}], " ", "]"}], ",", " ", "True", 
    ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"mechanism", "::", "comb"}], "]"}], ";", " ", "False"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[230]:=",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],

Cell[CellGroupData[{

Cell["Map[]", "Subsection",ExpressionUUID->"3ab5e732-329f-4489-88fd-99e349e91f19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"framework", " ", "/:", " ", 
   RowBox[{"Map", "[", " ", 
    RowBox[{"f_", ",", " ", 
     RowBox[{"m", " ", ":", " ", 
      RowBox[{"framework", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_Symbol", "[", 
            RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}], ",", 
        " ", "labels_"}], " ", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{"f", " ", "/@", " ", "coordinates"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"framework", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", 
        RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"mapTestCoordinatesQ", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", "coordinates"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"origami", " ", "/:", " ", 
   RowBox[{"Map", "[", " ", 
    RowBox[{"f_", ",", " ", 
     RowBox[{"m", " ", ":", " ", 
      RowBox[{"origami", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"_Symbol", "[", 
            RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}], ",", 
        " ", "labels_"}], " ", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{"f", " ", "/@", " ", "coordinates"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"origami", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", 
        RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"mapTestCoordinatesQ", "[", " ", 
       RowBox[{"newCoordinates", ",", " ", "coordinates"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanism", "::", "match"}], " ", "=", 
   "\"\<New coordinates are not numeric and of the same dimension as old \
coordinates.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"mapTestCoordinatesQ", "[", " ", 
   RowBox[{"new_", ",", " ", "old_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"new", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "new", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Dimensions", "[", "old", "]"}]}]}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"mechanism", "::", "match"}], "]"}], ";", " ", "False"}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "In[234]:=",ExpressionUUID->"716f9373-6de2-4d61-b7b3-deac55ae485c"]
}, Closed]],

Cell[CellGroupData[{

Cell["tesselateMechanism[]", "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "tesselateMechanism", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<overlapPrecision\>\"", "\[Rule]", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "6"}], ")"}]}]}], "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[238]:=",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tesselateMechanism", "::", "counter"}], "=", 
   "\"\<Number of cells must be positive integers corresponding to the number \
of basis elements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tesselateMechanism", "::", "dim"}], "=", 
   "\"\<Basis must be `1` dimensional to match mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tesselateMechanism", "::", "num"}], "=", 
   "\"\<Basis must be numerical with vectors of the same dimension.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tesselateMechanism", "::", "basis"}], "=", 
    "\"\<Basis must be a list of `1` numerical vectors.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tesselationBasisQ", "[", " ", 
    RowBox[{"m_", ",", " ", "d_", ",", " ", "basis_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"MatrixQ", "[", 
       RowBox[{"basis", ",", "NumericQ"}], "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"tesselateMechanism", "::", "num"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Length", "[", "basis", "]"}], " ", "\[NotEqual]", " ", "d"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"tesselateMechanism", "::", "basis"}], ",", " ", "d"}], " ", 
       "]"}], ";", " ", "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"Dimensions", "[", "basis", "]"}], "]"}], " ", "\[NotEqual]", 
      " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"tesselateMechanism", "::", "dim"}], ",", " ", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], " ", "]"}], 
      ";", " ", "False"}], ",", "\n", "\t", "True", ",", " ", "True"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", 
   RowBox[{"n1__Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", "__", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"tesselateMechanism", "::", "counter"}], "]"}], ";", " ", 
    "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[239]:=",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tesselateMechanism", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", " ",
     ",", " ", 
    RowBox[{"n1", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"tesselateMechanism", "[", " ", 
    RowBox[{"m", ",", " ", 
     RowBox[{"{", " ", 
      RowBox[{"basis", ",", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"Length", "[", "basis", "]"}]}], "]"}]}], " ", "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"n1", ",", "1"}], "}"}], ",", " ", "opt"}], "]"}], " ", "/;", 
   " ", 
   RowBox[{
    RowBox[{"tesselationCellCountsQ", "[", " ", "n1", " ", "]"}], " ", "&&", 
    " ", 
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "1", ",", " ", 
      RowBox[{"{", "basis", "}"}]}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[246]:=",ExpressionUUID->"24a3cca9-6e03-4a93-af32-ff27501bcfeb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tesselateMechanism", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"n1_", ",", "n2_"}], "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"newIndices", "=", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"Array", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"1", "+", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", 
              RowBox[{"(", 
               RowBox[{"#2", "-", "1", "+", 
                RowBox[{"n2", " ", 
                 RowBox[{"(", 
                  RowBox[{"#1", "-", "1"}], ")"}]}]}], ")"}]}]}], "&"}], ",", 
           
           RowBox[{"{", 
            RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], " ", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"newCoordinates", "=", 
        RowBox[{
         RowBox[{"Flatten", "[", " ", 
          RowBox[{
           RowBox[{"Array", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ConstantArray", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#1", " ", 
                  RowBox[{"basis", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "+", 
                 RowBox[{"#2", " ", 
                  RowBox[{"basis", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], ",", " ", 
                RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "]"}],
               "&"}], ",", 
             RowBox[{"{", 
              RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], ",", "1"}], "]"}], 
         "+", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
           RowBox[{"n1", " ", "n2"}]}], " ", "]"}]}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"joinMechanism", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", " ", 
           RowBox[{"#", ",", " ", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "]"}], " ", "&"}], ",", " ", 
         "newCoordinates"}], " ", "]"}], ",", "\n", "\t\t", "opt"}], "\t", 
      "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "2", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "In[247]:=",ExpressionUUID->"e9498b49-9495-4125-b6b0-60afecc5e553"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tesselateMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", " ", 
     RowBox[{"n1_", ",", " ", "n2_", ",", " ", "n3_"}], " ", "}"}], ",", " ", 
    
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"newIndices", " ", "=", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"Array", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"1", " ", "+", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", 
              RowBox[{"(", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#3", " ", "-", " ", "1", " ", "+", " ", 
                  RowBox[{"n2", " ", 
                   RowBox[{"(", " ", 
                    RowBox[{"#2", " ", "-", " ", "1"}], " ", ")"}]}]}], " ", 
                 ")"}], "+", " ", 
                RowBox[{"n2", " ", "n3", " ", 
                 RowBox[{"(", 
                  RowBox[{"#1", " ", "-", " ", "1"}], ")"}]}]}], " ", 
               ")"}]}]}], " ", "&"}], " ", ",", " ", 
           RowBox[{"{", 
            RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}]}], " ", "]"}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"newCoordinates", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Array", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ConstantArray", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#1", " ", 
                  RowBox[{"basis", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], " ", "+", " ", 
                 RowBox[{"#2", " ", 
                  RowBox[{"basis", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], " ", "+", " ", 
                 RowBox[{"#3", " ", 
                  RowBox[{"basis", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}]}], " ", ",", " ", 
                RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], "]"}], 
              "&"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}]}], " ", "]"}], ",", 
           " ", "2"}], " ", "]"}], " ", "+", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{
           RowBox[{"PadRight", "[", 
            RowBox[{
             RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", "\"\<positions\>\"", "]"}], ",", "3"}], 
              "}"}]}], "]"}], ",", " ", 
           RowBox[{"n1", " ", "n2", " ", "n3"}]}], "]"}]}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"joinMechanism", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", " ", 
           RowBox[{"#", ",", " ", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "]"}], " ", "&"}], ",", " ", 
         "newCoordinates"}], " ", "]"}], ",", "\n", "\t\t", "opt"}], "\t", 
      "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "3", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2", ",", "n3"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "In[248]:=",ExpressionUUID->"255e4dc9-2433-4339-8133-1c21b5d429d1"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReplaceAll[]", "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceElement", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", "mechanismPattern"}], ",", " ", "rule_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Head", "[", "f", "]"}], "[", 
    RowBox[{
     RowBox[{"f", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"replaceCellData", "[", " ", 
        RowBox[{"#", ",", " ", "rule"}], " ", "]"}], "&"}], " ", "/@", " ", 
      RowBox[{"f", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"f_framework", ",", " ", "rule_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"replaceElement", "[", " ", 
   RowBox[{"f", ",", " ", "rule"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"o_origami", ",", " ", "rule_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"replaceElement", "[", 
   RowBox[{"o", ",", " ", "rule"}], "]"}]}]}], "Code",
 CellLabel->
  "In[249]:=",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Closed]],

Cell[CellGroupData[{

Cell["Precision[], Rationalize[], N[]", "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Precision", "[", " ", "f_framework", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"f", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Precision", "[", " ", "o_origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"o", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[252]:=",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"f_framework", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"Rationalize", "[", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}]}]}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"o_origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"Rationalize", "[", " ", 
      RowBox[{
       RowBox[{"o", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}]}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "In[254]:=",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"f_framework", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"N", "[", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}]}]}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"o_origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"N", "[", " ", 
      RowBox[{
       RowBox[{"o", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}]}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "In[256]:=",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["functions to extract information from mechanisms", "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],

Cell[CellGroupData[{

Cell["matchFromData[], selectFromData[]", "Subsection",ExpressionUUID->"9ac8c75a-4c63-4e05-9934-61e116371563"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"matchFromData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"data_", " ", "\[Rule]", " ", "patt_"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Flatten", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"takeCells", "[", " ", 
      RowBox[{
       RowBox[{"matchComponents", "[", " ", 
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], ",", " ", "data", ",", " ", "patt", 
         ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], " ", "]"}], "&"}], " ",
     "/@", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"selectFromData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "data_", ",", 
    " ", "f_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"takeCells", "[", " ", 
      RowBox[{
       RowBox[{"selectComponents", "[", " ", 
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], ",", " ", "data", ",", " ", "f", 
         ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], "]"}], " ", "&"}], " ",
     "/@", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[258]:=",ExpressionUUID->"eb4d2ca6-bac8-46f2-bbd5-c654d47af440"]
}, Closed]],

Cell[CellGroupData[{

Cell["componentData[]", "Subsection",ExpressionUUID->"dea4a3c2-e7ee-4f47-bf96-66929b110d6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"\"\<length\>\"", ",", " ", 
    RowBox[{"rigidBar", "[", " ", 
     RowBox[{"_", " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"length_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"stiffness_", "?", "VectorQ"}]}], "}"}], ",", " ", "_"}], " ",
      "]"}]}], " ", "]"}], " ", ":=", " ", "length"}], "\n", 
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"\"\<stiffness\>\"", ",", " ", 
    RowBox[{"rigidBar", "[", " ", 
     RowBox[{"_", " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"length_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"stiffness_", "?", "VectorQ"}]}], "}"}], ",", " ", "_"}], " ",
      " ", "]"}]}], " ", "]"}], " ", ":=", " ", "stiffness"}]}], "Code",
 CellLabel->
  "In[260]:=",ExpressionUUID->"d8fcb9d4-f2da-407c-83ae-ce3be9bbccf0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"\"\<length\>\"", ",", " ", 
    RowBox[{"spring", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"length_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"stiffness_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"strain_", "?", "VectorQ"}]}], "}"}], ",", " ", "display_"}], 
     " ", "]"}]}], " ", "]"}], " ", ":=", " ", "length"}], "\n", 
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"\"\<stiffness\>\"", ",", " ", 
    RowBox[{"spring", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"length_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"stiffness_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"strain_", "?", "VectorQ"}]}], "}"}], ",", " ", "display_"}], 
     " ", "]"}]}], " ", "]"}], " ", ":=", " ", "stiffness"}], "\n", 
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"\"\<strain\>\"", ",", " ", 
    RowBox[{"spring", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"length_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"stiffness_", "?", "VectorQ"}], ",", " ", 
        RowBox[{"strain_", "?", "VectorQ"}]}], "}"}], ",", " ", "display_"}], 
     " ", "]"}]}], " ", "]"}], " ", ":=", " ", "strain"}]}], "Code",
 CellLabel->
  "In[262]:=",ExpressionUUID->"595f3be6-92fa-471c-b4ef-1180cdfca216"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentData", "[", 
   RowBox[{"s_", ",", " ", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Missing", "[", "s", "]"}]}]], "Code",
 CellLabel->
  "In[265]:=",ExpressionUUID->"ac5d691b-d0db-4dce-aa67-9c7c4a5c42ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentData", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "s_", ",", 
    " ", "patt_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", "patt", "]"}]}], ",", " ", "cells"}], " ", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"takeCells", "[", " ", 
          RowBox[{
           RowBox[{"identifyComponents", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], " ", ",", " ", 
           "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"data", " ", "=", " ", 
           RowBox[{"componentData", "[", " ", 
            RowBox[{"s", ",", " ", "#"}], " ", "]"}]}], "}"}], ",", "\n", 
         "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MissingQ", "[", "data", "]"}], ",", "\n", "\t\t\t", 
           "Nothing", ",", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "[", " ", 
             RowBox[{"First", "[", "#", "]"}], " ", "]"}], " ", "\[Rule]", 
            " ", "data"}]}], "\n", "\t\t", "]"}]}], "\t", "\n", "\t", "]"}], 
       "&"}], " ", "/@", " ", "cells"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[266]:=",ExpressionUUID->"f646d260-5ae8-4d55-a107-8169291bb17e"]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanismPositions[] ", "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mechanismPositions", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPositions", "[", " ", 
    RowBox[{"Rule", "[", " ", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
      RowBox[{"coords_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}],
     " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "m", "]"}], "[", 
       RowBox[{"coords", ",", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], "]"}], " ", ",", " ", 
      "Automatic"}], " ", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", " ", "coords", " ", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", " ", 
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPositions", "::", "coords"}], " ", "=", " ", 
   "\"\<Coordinates must be numerical and of the same dimension as mechanism.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"mechanismPositions", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "_"}], " ", 
    "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", " ", 
    RowBox[{"mechanismPositions", "::", "coords"}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "In[267]:=",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanismComponents[], constrainedComponents[]", "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],

Cell[BoxData[
 RowBox[{
  RowBox[{"constrainedComponents", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cellBase", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"takeCells", "[", " ", 
          RowBox[{
           RowBox[{"identifyComponents", "[", " ", 
            RowBox[{
             RowBox[{"cellPattern", "[", "patt", "]"}], ",", " ", "#"}], " ", 
            "]"}], ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"mechanismComponentsCell", " ", "/@", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"matchComponents", "[", " ", 
             RowBox[{
             "rigidBar", ",", " ", "\"\<stiffness\>\"", ",", " ", "Infinity", 
              ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], " ", "]"}], "&"}],
          " ", "/@", " ", "cellBase"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"matchComponents", "[", " ", 
             RowBox[{
             "spring", ",", " ", "\"\<stiffness\>\"", ",", " ", "Infinity", 
              ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], " ", "]"}], "&"}],
          " ", "/@", " ", "cellBase"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"matchComponents", "[", " ", 
             RowBox[{
             "joint", ",", " ", "\"\<pinningStiffness\>\"", ",", " ", 
              "Infinity", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], "]"}],
           "&"}], " ", "/@", " ", "cellBase"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"matchComponents", "[", " ", 
             RowBox[{
             "fold", ",", " ", "\"\<torsionalStiffness\>\"", ",", " ", 
              "Infinity", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], "]"}],
           "&"}], " ", "/@", " ", "cellBase"}]}], "\n", "\t", "}"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[271]:=",ExpressionUUID->"c031031c-ffd7-4d83-bcd8-d42371a77d31"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismComponents", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"mechanismComponentsCell", " ", "/@", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismComponentsCell", "[", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
     "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"head", "[", 
    RowBox[{"indices", ",", " ", 
     RowBox[{"Association", " ", "@@", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", "data"}],
        "]"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismComponents", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
    "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"cellPattern", "[", "patt", "]"}]}], "}"}], ",", "\n", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"cells", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"takeCells", "[", " ", 
             RowBox[{
              RowBox[{"identifyComponents", "[", " ", 
               RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], ",", " ", 
              "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"m", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"mechanismComponentsCell", " ", "/@", " ", "cells"}]}], "\n", 
      "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mechanismComponents", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"Rule", "[", " ", 
     RowBox[{"patt_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{"changeCells", "[", " ", 
    RowBox[{"patt", ",", " ", "data"}], " ", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[272]:=",ExpressionUUID->"41df8914-964f-4940-a28f-5ee27f20f2bd"]
}, Closed]],

Cell[CellGroupData[{

Cell["listEdges[], listFaces[], listVertices[]", "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"listEdges", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"listFaces", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"listVertices", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Range", "[", " ", 
   RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[276]:=",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["graphics", "Section",ExpressionUUID->"92311aed-1ba4-4416-8cbb-ce6d57c7314a"],

Cell[CellGroupData[{

Cell["plotMechanism[]", "Subsection",ExpressionUUID->"1cedf5c8-718e-4179-9513-b3eb43a0ece1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "clip", " ", "the", " ", "bounding", " ", "box", " ", "to", " ", "a", " ", 
    "minimum", " ", "size"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$minsize", "=", "0.1"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"minSize", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"x", ",", " ", 
       RowBox[{"x", "+", "$minsize"}]}], " ", "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"y", "-", "x"}], "]"}], " ", "<", " ", "$minsize"}]}]}], "\n", 
   
   RowBox[{
    RowBox[{"minSize", "[", "x_", "]"}], " ", ":=", " ", "x"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"reformat", " ", "bounding", " ", "box", " ", "appropriately"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"cleanBoundingBox", "[", 
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"_", "[", 
       RowBox[{"_", "?", "MatrixQ"}], "]"}]}], "]"}], " ", ":=", " ", "x"}], 
   "\n", 
   RowBox[{
    RowBox[{"cleanBoundingBox", "[", 
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"_", "[", 
       RowBox[{"__", "?", "VectorQ"}], "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"List", " ", "@@", " ", "x"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "figure", " ", "out", " ", "plot", " ", "range", " ", "and", " ", 
     "ratios"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"plotSizes", "[", "positions_", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "\n", "}"}],
       ",", "\n", "\t", 
      RowBox[{
       RowBox[{"boundingRegion", " ", "=", " ", "\n", "\t\t", 
        RowBox[{"minSize", " ", "/@", " ", 
         RowBox[{"(", 
          RowBox[{"Transpose", " ", "@", "  ", 
           RowBox[{"cleanBoundingBox", " ", "@", " ", 
            RowBox[{"Quiet", "[", " ", 
             RowBox[{
              RowBox[{"BoundingRegion", "[", 
               RowBox[{"positions", ",", " ", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Last", "[", 
                    RowBox[{"Dimensions", "[", "positions", "]"}], "]"}], " ",
                    "\[Equal]", " ", "2"}], ",", " ", "\"\<MinRectangle\>\"", 
                  ",", " ", "\"\<MinCuboid\>\""}], " ", "]"}]}], "]"}], ",", 
              " ", 
              RowBox[{"BoundingRegion", "::", "degbr"}]}], " ", "]"}]}]}], 
          ")"}]}]}], ";", "\n", "\t", 
       RowBox[{"boundingBoxRatios", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], ")"}], " ", "/@", 
         " ", "boundingRegion"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "}"}]}]}], 
     "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[279]:=",ExpressionUUID->"110ac425-d5bf-408c-93ca-c93ae47dcdc3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "plotMechanism", "]"}], "=", 
    RowBox[{"Options", "[", " ", "MeshRegion", " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"MeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", " ", "opt"}], " ", "]"}]}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"positions", " ", ":", " ", 
      RowBox[{"_", "?", "MatrixQ"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"boundingRegion", ",", " ", "boundingRatios"}], " ", "}"}], ",",
      "\n", "\t", 
     RowBox[{
      RowBox[{"(", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"boundingRegion", ",", " ", "boundingRatios"}], " ", "}"}], 
         " ", "=", " ", 
         RowBox[{"plotSizes", "[", "positions", "]"}]}], ";", "\n", "\n", 
        "\t", 
        RowBox[{"Show", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"toMeshRegion", "[", " ", 
           RowBox[{
           "m", " ", ",", " ", "positions", ",", " ", "Automatic", ",", " ", 
            "opt"}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"Join", "[", " ", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"PlotRange", " ", "\[Rule]", " ", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                RowBox[{"BoxRatios", " ", "\[Rule]", " ", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], " ", "]"}], 
            "&"}], "[", " ", 
           RowBox[{"plotSizes", "[", " ", "positions", "]"}], " ", "]"}]}], 
         "\n", "\t", "]"}]}], "\n", "\t", ")"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Dimensions", "[", "positions", "]"}], " ", "\[Equal]", " ", 
        RowBox[{"Dimensions", "[", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", 
       " ", 
       RowBox[{"MatrixQ", "[", 
        RowBox[{"positions", ",", " ", "NumericQ"}], "]"}]}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "::", "vert"}], "=", 
   "\"\<Not valid numeric vertex positions corresponding to mechanism.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"pos", " ", ":", " ", 
      RowBox[{"_", "?", "MatrixQ"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"plotMechanism", "::", "vert"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"pos", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayQ", "[", " ", 
          RowBox[{"#", ",", " ", "_", ",", " ", "NumericQ"}], " ", "]"}], 
         "&"}], ")"}]}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"boundingRegion", ",", " ", "boundingRatios"}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"boundingRegion", ",", " ", "boundingRatios"}], "}"}], " ", 
        "=", " ", 
        RowBox[{"plotSizes", "[", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"pos", ",", " ", "1"}], " ", "]"}], "]"}]}], ";", "\n", 
       "\t", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"toMeshRegion", "[", " ", 
            RowBox[{
            "m", " ", ",", " ", "#", ",", " ", "Automatic", ",", " ", "opt"}],
             " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"Join", "[", " ", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"PlotRange", " ", "\[Rule]", " ", "boundingRegion"}], 
               ",", " ", 
               RowBox[{"BoxRatios", " ", "\[Rule]", " ", "boundingRatios"}]}],
               "}"}]}], " ", "]"}]}], "\n", "\t", "]"}], " ", "&"}], " ", "/@",
         " ", "pos"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pos", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;"}], "]"}], "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"pos", " ", ":", " ", 
      RowBox[{"_", "?", "ArrayQ"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"plotMechanism", "::", "vert"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanism", "::", "verlistt"}], "=", 
   "\"\<Not valid numeric vertex positions or a list of numeric vertex \
positions corresponding to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"plotMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"plotMechanism", "::", "vertlist"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[285]:=",ExpressionUUID->"fc20e590-6bb1-44a9-beb0-edf70fd6414d"]
}, Closed]],

Cell[CellGroupData[{

Cell["meshCells[]", "Subsection",ExpressionUUID->"cdd4da67-16db-4c3e-8fda-67bcde70c743"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshCells", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mr", " ", "=", " ", 
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Property", "[", " ", 
            RowBox[{
             RowBox[{"MeshCells", "[", " ", 
              RowBox[{"mr", ",", " ", 
               RowBox[{"{", 
                RowBox[{"i", ",", " ", "#"}], "}"}]}], " ", "]"}], ",", " ", 
             RowBox[{"getProperties", "[", " ", 
              RowBox[{"mr", ",", " ", "i", ",", " ", "#"}], " ", "]"}]}], " ",
             "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"Range", "[", " ", 
           RowBox[{"MeshCellCount", "[", " ", 
            RowBox[{"mr", ",", " ", "i"}], " ", "]"}], " ", "]"}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", "2"}], "}"}]}], "\n", "\t", "]"}]}], 
      "\n", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshCells", "[", " ", "mr_MeshRegion", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
     RowBox[{"Table", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"MeshCells", "[", " ", 
            RowBox[{"mr", ",", " ", 
             RowBox[{"{", 
              RowBox[{"i", ",", " ", "#"}], "}"}]}], " ", "]"}], ",", " ", 
           RowBox[{"getProperties", "[", " ", 
            RowBox[{"mr", ",", " ", "i", ",", " ", "#"}], " ", "]"}]}], " ", 
          "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"Range", "[", " ", 
         RowBox[{"MeshCellCount", "[", " ", 
          RowBox[{"mr", ",", " ", "i"}], " ", "]"}], " ", "]"}]}], ",", "\n", 
       "\t\t", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "2"}], "}"}]}], "\n", "\t", "]"}]}], "\n",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"getProperties", "[", " ", 
   RowBox[{"mr_MeshRegion", ",", " ", "d_", ",", " ", "cell_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"#", " ", "\[Rule]", " ", 
     RowBox[{"PropertyValue", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mr", ",", " ", 
         RowBox[{"{", 
          RowBox[{"d", ",", " ", "cell"}], "}"}]}], "}"}], ",", " ", "#"}], 
      " ", "]"}]}], " ", "&"}], " ", "/@", " ", 
   "$meshRegionProperties"}]}]}], "Code",
 CellLabel->
  "In[294]:=",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"]
}, Closed]],

Cell[CellGroupData[{

Cell["toMeshRegion[], addMeshRegion[]", "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "addMeshRegion", "]"}], " ", "=", " ", 
   RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", " ", 
     RowBox[{"coordinates_", ",", " ", "oldMesh_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"_Symbol", "[", 
          RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}], ",", 
      " ", "labels_"}], " ", "]"}], ",", " ", 
    RowBox[{"dim", " ", ":", " ", 
     RowBox[{"_", "?", "dimSpecQ"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", "\t", 
  RowBox[{"head", "[", "\n", "\t\t", 
   RowBox[{"coordinates", ",", "\n", "\t\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"coordinateQ", "[", " ", "coordinates", " ", "]"}], " ", "&&", 
       " ", 
       RowBox[{"MatrixQ", "[", " ", 
        RowBox[{"coordinates", ",", " ", "NumericQ"}], " ", "]"}]}], ",", 
      "\n", "\t\t\t", 
      RowBox[{"toMeshRegion", "[", " ", 
       RowBox[{
        RowBox[{"head", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels"}], " ", 
         "]"}], " ", ",", " ", "dim", ",", " ", "opt"}], " ", "]"}], ",", 
      "\n", "\t\t\t", "oldMesh"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
    "cells", ",", "\n", "\t\t", "labels"}], "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[297]:=",ExpressionUUID->"2d410e1a-3b13-4969-8633-a57c72f640aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "toMeshRegion", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"meshRegionCells", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "cells_"}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"Join", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"toDisplayCells", " ", "/@", " ", "cells"}], "]"}], ",", " ", 
     RowBox[{"Point", " ", "/@", " ", 
      RowBox[{"Range", "[", " ", 
       RowBox[{"Length", "[", "coordinates", "]"}], " ", "]"}]}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"o", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"pos_", "?", "MatrixQ"}], ",", " ", "d__"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"ReplacePart", "[", 
      RowBox[{"o", ",", " ", 
       RowBox[{"1", "\[Rule]", "pos"}]}], "]"}], ",", " ", "d"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"framework", "[", " ", 
      RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_Symbol", "[", 
           RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}], ",", 
       " ", "labels_"}], " ", "]"}], ",", " ", 
     RowBox[{"dim", " ", ":", " ", 
      RowBox[{"_", "?", "dimSpecQ"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"dim", "===", "Automatic"}], ",", " ", 
          RowBox[{"Last", "[", 
           RowBox[{"Dimensions", "[", "coordinates", "]"}], "]"}], ",", " ", 
          "dim"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"Quiet", "[", " ", 
       RowBox[{
        RowBox[{"MeshRegion", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"PadRight", "[", " ", 
           RowBox[{"coordinates", ",", " ", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"Length", "[", "coordinates", "]"}], ",", " ", "d"}], 
             " ", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{"meshRegionCells", "[", " ", 
           RowBox[{"coordinates", ",", " ", "cells"}], " ", "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Method", "->", 
              RowBox[{"{", 
               RowBox[{"\"\<CoplanarityTolerance\>\"", "->", "100"}], "}"}]}],
              ",", " ", "opt"}], "}"}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
        
        RowBox[{"MeshRegion", "::", "dupcell"}]}], "]"}]}], "\n", "]"}], " ", 
    "/;", " ", 
    RowBox[{
     RowBox[{"coordinateQ", "[", " ", "coordinates", " ", "]"}], " ", "&&", 
     " ", 
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"coordinates", ",", " ", "NumericQ"}], " ", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{"origami", "[", " ", 
      RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_Symbol", "[", 
           RowBox[{"_", ",", "_", ",", "_"}], "]"}], "..."}], "}"}]}], ",", 
       " ", "labels_"}], " ", "]"}], ",", " ", 
     RowBox[{"dim", " ", ":", " ", 
      RowBox[{"_", "?", "dimSpecQ"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", "\n", "\t", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"Which", "[", " ", "\n", "\t\t", 
         RowBox[{
          RowBox[{"dim", " ", "===", " ", "Automatic"}], ",", "\n", "\t\t\t", 
          
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"coordinates", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", ".", " ", 
              RowBox[{"coordinates", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "3"}], "]"}], "]"}]}], " ", "<", " ", 
             RowBox[{"10", "^", 
              RowBox[{"(", 
               RowBox[{"-", "12"}], ")"}]}]}], ",", " ", "2", ",", " ", "3"}],
            " ", "]"}], ",", "\n", "\t\t", "True", ",", " ", "dim"}], "\n", 
         "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"Quiet", "[", " ", 
       RowBox[{
        RowBox[{"MeshRegion", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"PadRight", "[", " ", 
           RowBox[{"coordinates", ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "coordinates", "]"}], ",", " ", "d"}], 
             " ", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{"meshRegionCells", "[", " ", 
           RowBox[{"coordinates", ",", " ", "cells"}], " ", "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Method", "->", 
              RowBox[{"{", 
               RowBox[{"\"\<CoplanarityTolerance\>\"", "->", "100"}], "}"}]}],
              ",", " ", "opt"}], "}"}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
        
        RowBox[{"MeshRegion", "::", "dupcell"}]}], " ", "]"}]}], "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"coordinateQ", "[", " ", "coordinates", " ", "]"}], " ", "&&", 
     " ", 
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"coordinates", ",", " ", "NumericQ"}], " ", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanism", "::", "coord"}], " ", "=", " ", 
   "\"\<Coordinates are not valid 2D or 3D coordinates.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinateQ", "[", " ", 
   RowBox[{"coord", " ", ":", " ", "coordinatePattern"}], " ", "]"}], " ", ":=",
   " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"coordinateQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"mechanism", "::", "coord"}], "]"}], ";", " ", "False"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanism", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension specification `1` is not 2 or 3 or Automatic.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"dimSpecQ", "[", " ", 
   RowBox[{"2", "|", "3", "|", "Automatic"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"dimSpecQ", "[", " ", "dim_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"mechanism", "::", "dim"}], ",", " ", "dim"}], " ", "]"}], ";", 
    " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[299]:=",ExpressionUUID->"0d89744f-504c-4c93-bb5d-2c78c8866bf1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", 
   RowBox[{"rigidBar", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", "]"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"MapThread", "[", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"Line", "[", "#1", "]"}], ",", " ", 
       RowBox[{"Normal", " ", "@", " ", 
        RowBox[{"Merge", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", " ", 
            RowBox[{"#2", ",", " ", 
             RowBox[{"MeshCellStyle", " ", "\[Rule]", " ", 
              RowBox[{"{", " ", 
               RowBox[{
                RowBox[{"Thickness", "[", "0.0025", "]"}], ",", " ", 
                "Black"}], " ", "}"}]}]}], " ", "}"}], "]"}], ",", " ", 
          "mergeDisplayProperties"}], " ", "]"}]}]}], " ", "]"}], "&"}], ",", 
    "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"indices", ",", " ", "display"}], "}"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", 
   RowBox[{"spring", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", "]"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"MapThread", "[", " ", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"Line", "[", "#1", "]"}], ",", " ", 
       RowBox[{"Normal", " ", "@", " ", 
        RowBox[{"Merge", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", " ", 
            RowBox[{"#2", ",", " ", 
             RowBox[{"MeshCellStyle", " ", "\[Rule]", " ", 
              RowBox[{"{", " ", 
               RowBox[{
                RowBox[{"Thickness", "[", "0.0025", "]"}], ",", " ", 
                "Black"}], " ", "}"}]}]}], " ", "}"}], "]"}], ",", " ", 
          "mergeDisplayProperties"}], " ", "]"}]}]}], " ", "]"}], "&"}], ",", 
    " ", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toDisplayCells", "[", " ", 
    RowBox[{"face", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
     "]"}], " ", "]"}], " ", ":=", "  ", 
   RowBox[{"MapThread", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Property", "[", " ", 
       RowBox[{
        RowBox[{"Polygon", "[", "#1", "]"}], ",", " ", "#2"}], " ", "]"}], 
      "&"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toDisplayCells", "[", " ", 
    RowBox[{"joint", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_", ",", " ", "display_"}], " ", 
     "]"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"MapThread", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Property", "[", " ", 
       RowBox[{
        RowBox[{"Point", "[", "#1", "]"}], ",", " ", 
        RowBox[{"Normal", " ", "@", " ", 
         RowBox[{"Merge", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"{", 
             RowBox[{"#2", " ", ",", " ", 
              RowBox[{"MeshCellStyle", " ", "\[Rule]", " ", 
               RowBox[{"{", " ", 
                RowBox[{
                 RowBox[{"PointSize", "[", "0.02", "]"}], ",", " ", "Gray"}], 
                " ", "}"}]}]}], " ", "}"}], "]"}], ",", " ", 
           "mergeDisplayProperties"}], " ", "]"}]}]}], " ", "]"}], "&"}], ",",
      " ", 
     RowBox[{"{", 
      RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", 
   RowBox[{"Point", "[", " ", 
    RowBox[{"indices_", ",", " ", "_", ",", " ", "display_"}], " ", "]"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"MapThread", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"Point", "[", "#1", "]"}], ",", " ", "#2"}], " ", "]"}], "&"}],
     ",", " ", 
    RowBox[{"{", 
     RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", 
   RowBox[{"Line", "[", " ", 
    RowBox[{"indices_", ",", " ", "_", ",", " ", "display_"}], " ", "]"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"MapThread", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"Line", "[", "#1", "]"}], ",", " ", "#2"}], " ", "]"}], "&"}], 
    ",", " ", 
    RowBox[{"{", 
     RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", 
   RowBox[{"Polygon", "[", " ", 
    RowBox[{"indices_", ",", " ", "_", ",", " ", "display_"}], " ", "]"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"MapThread", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"Polygon", "[", "#1", "]"}], ",", " ", "#2"}], " ", "]"}], 
     "&"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"indices", ",", " ", "display"}], "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[310]:=",ExpressionUUID->"517ca84f-1b48-4167-8dd8-f29e4a199c54"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mergeDisplayProperties", "[", " ", "propSpec_", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"combinedProperties", " ", "=", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"propSpec", " ", "/.", " ", 
         RowBox[{"Directive", " ", "\[Rule]", " ", "List"}]}], " ", "]"}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteDuplicatesBy", "[", " ", 
      RowBox[{"combinedProperties", ",", " ", "idProperty"}], " ", "]"}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"idProperty", "[", " ", 
   RowBox[{"r_", "?", "ColorQ"}], " ", "]"}], " ", ":=", " ", 
  "\"\<color\>\""}], "\n", 
 RowBox[{
  RowBox[{"idProperty", "[", " ", "r_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Head", "[", "r", "]"}]}]}], "Code",
 CellLabel->
  "In[318]:=",ExpressionUUID->"d7938666-fb0c-4728-8ef9-4feffb3fbc15"]
}, Closed]],

Cell[CellGroupData[{

Cell["toGraphics[]", "Subsection",ExpressionUUID->"0ec15f42-cc8e-4e3f-b345-1da6922a1e35"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "toGraphics", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", " ", "GraphicsComplex", " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toGraphics", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"All", "|", "0", "|", "1", "|", "2"}], " ", ":", " ", "All"}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"toGraphics", "[", " ", 
    RowBox[{"m", ",", " ", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "x", ",", " ", 
     "opt"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"toGraphics", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    RowBox[{"x", " ", ":", " ", 
     RowBox[{"All", "|", "0", "|", "1", "|", "2"}], " ", ":", " ", "All"}], 
    " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mr", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<mesh\>\"", "]"}]}], "}"}], ",", "\n", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"cells", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"MeshCells", "[", 
           RowBox[{"mr", ",", " ", "x"}], " ", "]"}], "]"}]}], " ", "}"}], 
       ",", "\n", "\t", 
       RowBox[{
        RowBox[{"GraphicsComplex", "[", " ", 
         RowBox[{"positions", " ", ",", " ", "cells", " ", ",", " ", "opt"}], 
         "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Head", "[", "cells", "]"}], " ", "=!=", " ", 
         "MeshCells"}]}]}], "\n", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Length", "[", "positions", "]"}]}]}]}]}], "Code",
 CellLabel->
  "In[321]:=",ExpressionUUID->"3f31a774-d66f-4f55-aef4-e00b3f3a7fa9"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[324]:=",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanisms`geometry: extracting mechanism geometry", "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<mechanisms`geometry`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[326]:=",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],

Cell[CellGroupData[{

Cell["code snippet to check for C compiler and Mathematica version", \
"Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "We", " ", "need", " ", "MeshRegion", " ", "to", " ", "work", " ", "for", 
    " ", "this", " ", "package", " ", "to", " ", "work", " ", "so", " ", 
    "make", " ", "sure", " ", "we", " ", "are", " ", "using", " ", "at", " ", 
    "least", " ", "version", " ", "10", " ", "of", " ", "Mathematica"}], "\n",
    "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"$VersionNumber", "<", "10"}], ",", " ", 
      RowBox[{
      "Print", "[", "\"\<Mathematica version may be too low.\>\"", "]"}]}], 
     "]"}], ";"}], "\n", "\n", 
   RowBox[{"(*", " ", "\n", "\t", 
    RowBox[{
     RowBox[{
     "A", " ", "snippet", " ", "of", " ", "code", " ", "to", " ", "test", " ",
       "or", " ", "a", " ", "working", " ", "C", " ", "compiler"}], ",", " ", 
     
     RowBox[{
      RowBox[{"modified", " ", "from", "\n", "\t", 
       RowBox[{"https", ":"}]}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
          "questions"}], "/", "39837"}], "/", "check"}], "-", "whether", "-", 
       "a", "-", "working", "-", "ccompiler", "-", "is", "-", 
       "installed"}]}]}], "\n", "*)"}], "\n", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"Quiet", "[", 
       RowBox[{"Check", "[", 
        RowBox[{
         RowBox[{"TrueQ", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", "}"}], ",", " ", "0", ",", " ", 
              RowBox[{"CompilationTarget", " ", "->", " ", "\"\<C\>\""}]}], 
             "]"}], "[", "]"}], " ", "==", " ", "0"}], "]"}], ",", " ", 
         "False"}], "]"}], "]"}], ",", "\n", "  ", 
      RowBox[{"$compilationTarget", " ", "=", " ", "\"\<C\>\""}], ",", "\n", 
      "  ", 
      RowBox[{
       RowBox[{
       "Print", "[", "\"\<C compilation failed. Using MVM code instead.\>\"", 
        "]"}], ";", "\n", "  ", 
       RowBox[{"$compilationTarget", " ", "=", " ", "\"\<MVM\>\""}]}]}], "\n",
      "]"}], ";"}]}]}]], "Code",
 CellLabel->
  "In[327]:=",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"$compilationTarget", "::", "usage"}], " ", "=", " ", 
   "\"\<Returns \\\"C\\\" if a C compiler was detected.\>\""}], ";"}]], "Code",\

 CellLabel->
  "In[329]:=",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimal", "::", "usage"}], "=", 
   "\"\<infinitesimal[ name, order ] represents an infinitesimal of name and \
at a particular order.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[330]:=",ExpressionUUID->"dbb93444-1867-4df8-88d7-4358e4ecd562"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementRules", "::", "usage"}], " ", "=", " ", 
   "\"\<displacementRules[displacements] returns a list of rules to assign \
vertex displacements to their values.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"positionRules", "::", "usage"}], " ", "=", " ", 
    "\"\<positionRules[positions] returns a list of rules assigning vertex \
positions to their values.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"orthogonalizeDisplacements", "::", "usage"}], "=", "\n", 
    "\"\<orthogonalizeDisplacements[ \
{\!\(\*StyleBox[\\\"displacement\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*\
StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\",\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*\
StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"displacement\\\",\
FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"2\\\",FontSlant->\\\"\
Italic\\\"]\), ...}(, \
\!\(\*StyleBox[\\\"tolerance\\\",FontSlant->\\\"Italic\\\"]\)) ] returns an \
orthogonalized set of vertex displacements using optional tolerance.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomDisplacements", "::", "usage"}], "=", 
    "\"\<randomDisplacements[ m, n ] returns n random displacements of a \
mechanism m starting from positions.\nrandomDisplacements[ positions, n ] \
returns n random displacements starting from positions.\nn defaults to 1 if \
it is omitted.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<vertexCoordinatesQ[ m, pos ] returns True if pos are valid \
coordinates for mechanism m.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"numericCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<numericCoordinatesQ[ m, pos ] returns True if pos are valid numerical \
coordinates for mechanism m.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"numericMachinePrecisionCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<numericMachinePrecisionCoordinatesQ[ m, pos ] returns True if pos are \
valid numerical, machine precision coordinates for mechanism m.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[331]:=",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"connectivity", "::", "usage"}], " ", "=", " ", 
   "\"\<connectivity[ m, s1 -> s2 ] returns a list of type s2 for each s1. \
Use connectivity[\\\"Methods\\\"] to possible values for s1 or s2.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"orientedQ", "::", "usage"}], " ", "=", " ", 
    "\"\<orientedQ[ m ] returns True if all faces in a mechanism are oriented \
with their neighbors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"boundaryVertices", "::", "usage"}], "=", 
   "\"\<boundaryVertices[ mechanism ] returns a list of oriented boundary \
vertices { component 1, ...} where each boundary component is a list of \
vertex indices. A boundary is defined as the boundary of a set of 2D faces.\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"boundaryEdges", "::", "usage"}], "=", 
   "\"\<boundaryEdges[ mechanism ] returns a list of oriented boundary edges \
{{v11, v12},{v21,v22},...}. A boundary is defined as the boundary of a set of \
2D faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"boundaryFaces", "::", "usage"}], "=", 
   "\"\<boundaryFaces[ mechanism ] returns a list of oriented boundary \
components {face 1, face 2, ...}, ...}. A boundary is defined as the boundary \
of a set of 2D faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"interiorVertices", "::", "usage"}], "=", 
   "\"\<interiorVertices[ mechanism ] returns a list of interior \
vertices.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"interiorEdges", "::", "usage"}], "=", 
    "\"\<interiorEdges[ mechanism ] returns a list of interior edges.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displayDimension", "::", "usage"}], "=", "\n", 
    "\"\<displayDimension[ m ] returns the display dimension of a mechanism \
m.\ndisplayDimension[ d ][ m ], displayDimension[m -> d] changes the display \
dimension of a mechanism m to d.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"embeddingDimension", "::", "usage"}], "=", "\n", 
    "\"\<embeddingDimension[ m ] returns the embedding dimension of a \
mechanism m.\nembeddingDimension[ d ][ m ], embeddingDimension[m -> d] \
changes the embedding dimension of a mechanism m to d.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"deleteDanglingVertices", "::", "usage"}], "=", 
    "\"\<deleteDanglingVertices[\!\(\*StyleBox[\\\"m\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\",\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*\
StyleBox[\\\"type\\\",FontSlant->\\\"Italic\\\"]\)] deletes all vertices of \
\!\(\*StyleBox[\\\"m\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)not adjacent to a cell of a specific type, \
either \\\"faces\\\" or \\\"edges\\\".\nIf omitted, the argument \
\!\(\*StyleBox[\\\"type\\\",FontSlant->\\\"Italic\\\"]\) defaults to \
\\\"faces\\\" for origami or \\\"edges\\\" for frameworks. See: \
deleteVertices[]\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"saveToFOLD", "::", "usage"}], "=", 
   "\"\<saveToFOLD[\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\
\), \!\(\*StyleBox[\\\"filename\\\",FontSlant->\\\"Italic\\\"]\)] saves a \
FOLD file from a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"loadFromFOLD", "::", "usage"}], "=", "\n", 
   "\"\<loadFromFOLD[\!\(\*StyleBox[\\\"filename\\\",FontSlant->\\\"Italic\\\"\
]\)] loads a mechanism from a FOLD. Use option \\\"face\\\" to choose how to \
treat a polygon.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[338]:=",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"periodicIdentification", "::", "usage"}], "=", "\n", 
    "\"\<periodicIdentification[m, {f1, func1},..] applies transformation \
functions func1, func2, ... and creates a list of vertices identified via \
those transformations.\nperiodicIdentification[m, {z1,z2,...}, {vector1, \
vector2, ...}] identifies vertices under translation vectors {vector1, \
vector2,...} and returns rules identifying vertexDisplacement objects up to \
corresponding factors of {z1, z2,...}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimalMechanism", "::", "usage"}], "=", "\n", 
   "\"\<minimalMechanism[m, {vector1, vector2, ...}] reduces a mechanism to \
the smallest unit cell that can be tesselated periodically according to the \
basis of vectors provided.\nIt relies on periodicIdentification[] but \
unfortunately renumbers vertices.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[350]:=",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displacementVector", "::", "usage"}], "=", "\n", 
    "\"\<displacementVector[ positions, edge ] returns the vector pointing \
along an oriented edge.\ndisplacementVector[ positions, { edge 1, edge 2, \
...} ] returns list of displacement vectors.\nEdges can be specified as \
Line[{v1,v2}] or {v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displacementLength", "::", "usage"}], "=", "\n", 
    "\"\<displacementLength[ positions, edge 1 ] returns the length of an \
edge.\ndisplacementLength[ positions, { edge 1, edge 2, ...} ] returns \
lengths of a list of edges.\nEdges can be specified as Line[{v1,v2}] or \
{v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displacementLengthSquared", "::", "usage"}], "=", "\n", 
    "\"\<displacementLengthSquared[ positions, edge 1 ] returns the squared \
length of an edge.\ndisplacementLengthSquared[ positions, { edge 1, edge 2, \
...} ] returns squared lengths of a list of edges.\nEdges can be specified as \
Line[{v1,v2}] or {v1,v2}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vectorAngle", "::", "usage"}], "=", "\n", 
    "\"\<vectorAngle[ positions, {vertex 1, vertex 2, vertex 3}] returns the \
angle at vertex 2 spanned by the other two points.\nvectorAngle[ positions, { \
triple 1, triple 2, ...} ] returns the vertex angles anong a list of vertex \
triples.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"turningAngle", "::", "usage"}], "=", "\n", 
    "\"\<turningAngle[ positions, {vertex 1, vertex 2, vertex 3}] returns the \
turning angle at vertex 2 spanned by the other two points.\nturningAngle[ \
positions, { triple 1, triple 2, ...} ] returns the turning angles anong a \
list of vertex triples.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"normalVector", "::", "usage"}], "=", "\n", 
    "\"\<normalVector[ positions, {vertex 1, vertex 2, vertex 3} ] returns \
the vector normal to the plane spanned by the three points.\nnormalVector[ \
positions, { triple 1, triple 2, ...} ] returns vectors normal to the plane \
spanned by the list of triples.\nnormalVector[ positions, polygon ] returns \
the vector normal to a polygon.\nnormalVector[ positions, {polygon 1, polygon \
2, ...} ] returns the vectors normal to a list of polygons.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"planarAngle", "::", "usage"}], "=", "\n", 
    "\"\<planarAngle[positions, {v1, v2, v3}] returns the oriented angle at \
vertex v2 spanned by the other two vertices.\nplanarAngle[positions, {triple \
1, triple 2, ...}] returns the oriented angles at for each triple of \
verticles.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"foldAngle", "::", "usage"}], "=", "\n", 
    "\"\<foldAngle[ mesh, positions, edge ] returns the fold angle along an \
edge.\nfoldAngle[ mesh, positions,{edge 1, edge 2,...} ] returns the fold \
angle of a list of edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gaussianCurvature", "::", "usage"}], "=", "\n", 
    "\"\<gaussianCurvature[ mesh, positions,vertex ] returns the discrete \
Gaussian curvature of vertex.\ngaussianCurvature[ mesh, positions,{vertex 1, \
vertex 2, ...} ] returns the discrete Gaussian curvature of a list of \
vertices.\ngaussianCurvature[ mesh, metric,{vertex 1, vertex 2, ...} uses a \
metric to explicitly compute the Gaussian curvature at each vertex.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"alignMechanism", "::", "usage"}], "=", 
    "\"\<alignMechanism[\!\(\*StyleBox[\\\"point\\\",FontSlant->\\\"Italic\\\"\
]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\",\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*\
StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"point\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"2\\\",FontSlant->\\\"\
Italic\\\"]\)] aligns \!\(\*StyleBox[\\\"point\\\",FontSlant->\\\"Italic\\\"]\
\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"2\\\",FontSlant->\\\"\
Italic\\\"]\) with \
\!\(\*StyleBox[\\\"point\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\) using only Euclidean motions.\nalignMechanism[\!\(\*StyleBox[\\\
\"point\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\), \!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\)] \
aligns a mechanical with \!\(\*StyleBox[\\\"point\\\",FontSlant->\\\"Italic\\\
\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"list\\\",FontSlant->\\\"\
Italic\\\"]\)\!\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\) using Euclidean motions.\n\
alignMechanism[\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\)\!\
\(\*StyleBox[\\\" \
\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\), \
\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\
\" \\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"2\\\",FontSlant->\\\"\
Italic\\\"]\)] aligns \
\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\
\" \\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"2\\\",FontSlant->\\\"\
Italic\\\"]\) to \
\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\
\" \\\",FontSlant->\\\"Italic\\\"]\)\!\(\*StyleBox[\\\"1\\\",FontSlant->\\\"\
Italic\\\"]\) using Euclidean motions.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"congruentQ", "::", "usage"}], "=", 
   "\"\<congruentQ[p1,p2] tests whether the two vectorPositions are related \
by a rigid transformation.\ncongruentQ[p1,p2,tolerance] tests whether the two \
vectorPositions are related by a rigid transformation.\ncongruentQ[tolerance] \
is a function that can check the positions between two vertexPosition \
configurations.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[352]:=",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotDisplacement", "::", "usage"}], "=", "\n", 
    "\"\<plotDisplacement[ mechanism, vertex displacements ] plots mechanism \
with arrows correspond to vertex displacements overlayed.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"angleMarker", "::", "usage"}], "=", 
   "\"\<angleMarker[m, {v1,v2,v3}, (radius) ] creates an arc around an angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"angleText", "::", "usage"}], "=", 
   "\"\<angleTest[m, {v1,v2,v3}, (distance) ] adds a text label to the angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[363]:=",ExpressionUUID->"85f89386-d411-4cb2-812f-3385b9ddc119"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`\>\"", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[366]:=",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["topology", "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],

Cell[CellGroupData[{

Cell["connectivity[]", "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],

Cell[CellGroupData[{

Cell["orderPairs[]", "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],

Cell["\<\
orderPairs[{{n1, n2}, {n3, n4}, ...}]
 When provided a list of pairs, {1, b}, sort them in order such that {{1, 2}, \
{2, 3}, {3, 4}, ...}
 
 orderPairs[list 1, list 2] orders pairs in which elements of each list are \
paired with
 the corresponding element.\
\>", "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orderPairs", "[", 
    RowBox[{"pairList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"Graph", "[", 
      RowBox[{"UndirectedEdge", "@@@", "pairList"}], "]"}], "]"}], "/;", " ", 
    
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pairList", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], "==", "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"pairList_", ",", "correspondingList_"}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{"association", "=", 
       RowBox[{"Dispatch", "@", 
        RowBox[{"Thread", "[", 
         RowBox[{"pairList", "->", "correspondingList"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"orderPairs", "[", "pairList", "]"}], "/.", "association"}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "pairList", "]"}], "==", 
    RowBox[{"Length", "[", "correspondingList", "]"}]}]}]}]}], "Code",
 CellLabel->
  "In[368]:=",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "does", " ", "a", " ", "topological", " ", "sort", " ", "on", 
    " ", "a", " ", "graph"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"g_", "?", "AcyclicGraphQ"}], "]"}], ":=", 
    RowBox[{"Partition", "[", 
     RowBox[{
      RowBox[{"TopologicalSort", "[", 
       RowBox[{"DirectedEdge", "@@@", 
        RowBox[{"EdgeList", "[", "g", "]"}]}], "]"}], ",", "2", ",", "1"}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", "g_Graph", "]"}], ":=", 
    RowBox[{"List", "@@@", 
     RowBox[{"(", 
      RowBox[{"First", "@", 
       RowBox[{"FindCycle", "[", 
        RowBox[{"g", ",", "Infinity", ",", "1"}], "]"}]}], 
      ")"}]}]}]}]}]], "Code",
 CellLabel->
  "In[371]:=",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],

Cell[CellGroupData[{

Cell["rotateTo[]", "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{"s_List", ",", "v_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"FirstPosition", "[", 
       RowBox[{"s", ",", "v"}], "]"}]}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MissingQ", "[", "pos", "]"}], ",", "s", ",", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"s", ",", 
        RowBox[{
         RowBox[{"pos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "]"}]}], "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{
    RowBox[{"h_", "[", "s_List", "]"}], ",", "v_"}], "]"}], ":=", 
  RowBox[{"h", "[", 
   RowBox[{"rotateTo", "[", 
    RowBox[{"s", ",", "v"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "In[373]:=",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Closed]],

Cell[CellGroupData[{

Cell["orderFaces[]", "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"orderFaces", "[", 
   RowBox[{"faceList_", ",", "v_Integer"}], "]"}], ":=", 
  RowBox[{"orderPairs", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"Last", "[", "#", "]"}]}], "}"}], "&"}], "/@", "faceList"}], 
    ",", "faceList"}], "]"}]}]], "Code",
 CellLabel->
  "In[375]:=",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],

Cell[CellGroupData[{

Cell["connectivity[]", "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"connectivity", "[", "\"\<Methods\>\"", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\""}], "}"}],
      "->", 
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\"", ",", 
       "\"\<ordered faces\>\"", ",", "\"\<ordered edges\>\""}], "}"}]}], 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "In[376]:=",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"connectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"connectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}]}], "Code",
 CellLabel->
  "In[377]:=",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"connectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"faces", " ", "=", " ", 
       RowBox[{"rotateThroughFaces", "[", " ", 
        RowBox[{"connectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"GatherBy", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Join", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", " ", 
              RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", "]"}], " ", 
             "]"}], "}"}], "]"}], ",", " ", 
          RowBox[{"(*", 
           RowBox[{
           "make", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
            "in", " ", "order", " ", "of", " ", "the", " ", "form", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "1", "}"}], ",", 
              RowBox[{"{", "2", "}"}], ",", "..."}], "}"}]}], "*)"}], "\n", 
          "\t\t\t", "faces"}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
        "First"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"rotateThroughFaces", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateThroughFaces", "[", "faces_", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"NestList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"RotateLeft", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "faces", ",", 
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"Dimensions", "[", "faces", "]"}], "]"}], "-", "1"}]}], "]"}],
     ",", "1"}], "]"}]}]}], "Code",
 CellLabel->
  "In[379]:=",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"connectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cells", "=", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"connectivity", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}],
         " ", "]"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"Join", "[", 
           RowBox[{"cells", ",", 
            RowBox[{"{", 
             RowBox[{"cells", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", "1"}], "]"}], ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[382]:=",ExpressionUUID->"d4b93424-3000-4189-9724-831b1489b36f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"connectivity", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ", 
    "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"connectivity", "[", " ", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}]}], ",", " ", 
       RowBox[{"faces", " ", "=", " ", 
        RowBox[{"connectivity", "[", " ", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"edges", ",", 
            RowBox[{"rotateCells", "[", "faces", "]"}]}], "}"}], ",", "1"}], 
         "]"}], ",", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], "&"}]}], "]"}], 
      "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "rotateCells", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Flatten\>\"", "->", "True"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"rotateCells", "[", 
    RowBox[{"cells_", " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sortedCells", "=", 
        RowBox[{"GatherBy", "[", 
         RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"NestList", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"RotateLeft", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", ",", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
          "&"}], "/@", "sortedCells"}], ",", "2"}], "]"}]}], "\n", "]"}], " ",
     "/;", " ", 
    RowBox[{"OptionValue", "[", "\"\<Flatten\>\"", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"rotateCells", "[", 
   RowBox[{"cells_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sortedCells", "=", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"First", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"NestList", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"RotateLeft", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", ",", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], "&"}],
       "/@", "sortedCells"}], "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[383]:=",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"connectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], " ",
    "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edges", " ", "=", " ", 
      RowBox[{"connectivity", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
       " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"edges", ",", 
            RowBox[{"Reverse", "[", 
             RowBox[{"edges", ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], "}"}], ",", "1"}], "]"}], 
        ",", "First"}], "]"}], ",", "First"}], "]"}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "In[387]:=",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"connectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}],
    " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"test1", "=", 
       RowBox[{"connectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], ",", 
      "\n", 
      RowBox[{"edges", "=", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"connectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"ToPackedArray", "@", 
     RowBox[{"MapThread", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"{", 
               RowBox[{"__", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"test1", "[", 
              RowBox[{"[", 
               RowBox[{"edges", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"edges", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", "#2", ",", "__"}], "}"}]}], "]"}], "&"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"test1", "[", 
              RowBox[{"[", 
               RowBox[{"edges", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"edges", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "\n", 
        "\t\t", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[388]:=",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{"Unpacks", " ", 
    RowBox[{"lists", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"connectivity", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{
     "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}], 
    "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"unorderedFace", "=", 
       RowBox[{"connectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"MapThread", "[", 
      RowBox[{"orderFaces", ",", 
       RowBox[{"{", 
        RowBox[{"unorderedFace", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "unorderedFace", "]"}], "]"}]}], "}"}]}], 
      "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "In[389]:=",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"connectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{
    "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered edges\>\""}]}], 
   "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"connectivity", "[", 
    RowBox[{"m", ",", 
     RowBox[{"\"\<vertices\>\"", "->", "\"\<ordered faces\>\""}]}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", 
     RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]], "Code",
 CellLabel->
  "In[390]:=",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"connectivity", "::", "badcombo"}], "=", 
   "\"\<Methods are not recognized in this combination.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"connectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], " ", ",", " ", 
    RowBox[{"Rule", "[", 
     RowBox[{"_", ",", "_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"connectivity", "::", "badcombo"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[391]:=",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["boundaryVertices[], boundaryEdges[], boundaryFaces[]", "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"boundaryEdges", "[", 
   RowBox[{"m_", "?", "mechanismQ"}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"facePairs", "=", 
       RowBox[{"connectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"edges", "=", 
       RowBox[{"connectivity", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}],
         "]"}]}], ",", "\n", "\t", "boundary"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"boundary", "=", 
      RowBox[{"Pick", "[", " ", 
       RowBox[{"edges", ",", " ", 
        RowBox[{"Length", " ", "/@", " ", "facePairs"}], ",", " ", "1"}], " ",
        "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "boundary", "]"}], "==", "0"}], ",", "\n", 
       "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"List", "@@", "#"}], "&"}], ",", 
         RowBox[{"FindCycle", "[", 
          RowBox[{
           RowBox[{"Graph", "[", "boundary", "]"}], ",", "Infinity", ",", 
           "All"}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[393]:=",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"boundaryVertices", "[", 
   RowBox[{"m_", "?", "mechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"First", "@@", "#"}], "&"}], " ", ",", " ", 
    RowBox[{"boundaryEdges", "[", "m", "]"}], " ", ",", " ", 
    RowBox[{"{", "2", "}"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "In[394]:=",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"boundaryFaces", "[", 
   RowBox[{"m_", "?", "mechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"boundary", " ", "=", " ", 
         RowBox[{"boundaryVertices", "[", "m", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"faces", " ", "=", " ", 
         RowBox[{"connectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{"Table", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{"faces", ",", " ", 
          RowBox[{
           RowBox[{"ContainsAny", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], " ",
          "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "boundary", "]"}]}], "}"}]}], "\n", "\t\t", 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[395]:=",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],

Cell[CellGroupData[{

Cell["interiorEdges[], interiorVertices[]", "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interiorEdges", "[", 
   RowBox[{"mr_", "?", "mechanismQ"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"Pick", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"connectivity", "[", " ", 
     RowBox[{"mr", ",", " ", 
      RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
     "]"}], ",", "\n", "\t\t", 
    RowBox[{"Length", " ", "/@", " ", 
     RowBox[{"connectivity", "[", 
      RowBox[{"mr", ",", " ", 
       RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
      "]"}]}], ",", "\n", "\t\t", "2"}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "In[396]:=",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],

Cell[BoxData[
 RowBox[{
  RowBox[{"interiorVertices", "[", 
   RowBox[{"mr_", "?", "mechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Complement", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"interiorEdges", "[", "mr", "]"}], "]"}], " ", "]"}], ",", "\n",
     "\t", 
    RowBox[{"Flatten", " ", "@", " ", 
     RowBox[{"boundaryVertices", "[", "mr", "]"}]}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "In[397]:=",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],

Cell[CellGroupData[{

Cell["orientedQ[]", "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"orientedQ", "[", 
   RowBox[{"mr_", "?", "mechanismQ"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"AllTrue", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"connectivity", "[", 
       RowBox[{"mr", ",", 
        RowBox[{"\"\<edges\>\"", "->", "\"\<faces\>\""}]}], "]"}], " ", ",", 
      " ", 
      RowBox[{"{", "_", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
    "facePairOrientedQ"}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"orientedQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "In[398]:=",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"{", 
    RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"v1_", ",", "v2_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[400]:=",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],

Cell[CellGroupData[{

Cell["embeddingDimension[], displayDimension[]", "Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"embeddingDimension", "[", " ", 
   RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], ":=", " ", 
  RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"embeddingDimension", "[", " ", 
     RowBox[{"d", " ", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"oldPositions", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"1", " ", "\[Rule]", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"oldPositions", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "oldPositions", "]"}], ",", "d"}], "}"}]}],
          " ", "]"}]}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"embeddingDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"embeddingDimension", "[", " ", "d_", " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"embeddingDimension", "::", "dim"}], ",", " ", "d"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"embeddingDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "d_"}], "]"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"embeddingDimension", "[", "d", "]"}], "[", "m", "]"}]}]}], "Code",\

 CellLabel->
  "In[402]:=",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displayDimension", "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", "\"\<DisplayDimension\>\"", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displayDimension", " ", "[", " ", 
     RowBox[{"d", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", 
    RowBox[{"m_", "?", "mechanismQ"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"mechanisms`Private`addMeshRegion", "[", 
        RowBox[{"m", ",", "d"}], "]"}]}], "}"}], ",", " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"mechanismQ", "[", "res", "]"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displayDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"displayDimension", "[", " ", "d_", " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"displayDimension", "::", "dim"}], ",", " ", "d"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displayDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "d_"}], " ", "]"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"displayDimension", "[", "d", "]"}], "[", "m", "]"}]}]}], "Code",
 CellLabel->
  "In[407]:=",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDanglingVertices[]", "Subsection",ExpressionUUID->"2b820542-dab3-4d0b-9a97-bb3be4d7c4e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deleteDanglingVertices", "[", "m_origami", "]"}], " ", ":=", " ", 
  RowBox[{"deleteDanglingVertices", "[", 
   RowBox[{"m", ",", "\"\<faces\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"deleteDanglingVertices", "[", "m_framework", "]"}], " ", ":=", " ", 
  RowBox[{"deleteDanglingVertices", "[", 
   RowBox[{"m", ",", "\"\<edges\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"type", ":", " ", 
      RowBox[{"\"\<faces\>\"", "|", "\"\<edges\>\""}]}]}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"deleteDanglingVertices", "[", 
    RowBox[{"m", ",", "type"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "\"\<faces\>\""}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"vertexSelector", "=", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}], ",", " ", 
          RowBox[{"Length", " ", "/@", " ", 
           RowBox[{"connectivity", "[", 
            RowBox[{"m", ",", 
             RowBox[{"\"\<vertices\>\"", "\[Rule]", "\"\<faces\>\""}]}], 
            "]"}]}]}], "}"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"deleteVertices", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"vertexSelector", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "<", "1"}], "&"}]}], "]"}], "[", 
        
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deleteDanglingVertices", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", "\"\<edges\>\""}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"vertexSelector", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"connectivity", "[", 
           RowBox[{"m", ",", 
            RowBox[{"\"\<vertices\>\"", "\[Rule]", "\"\<edges\>\""}]}], "]"}],
           "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"deleteVertices", "[", 
      RowBox[{"m", ",", "vertexSelector"}], "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"deleteDanglingVertices", "[", "type_", "]"}], "[", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"deleteDanglingVertices", "[", 
    RowBox[{"m", ",", " ", "type"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deleteDanglingVertices", "::", "typ"}], "=", 
   "\"\<Second argument should be either \\\"faces\\\" or \\\"edges\\\" to \
whether dangling vertices are indicated by a lack of faces or lack of \
edges.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"deleteDanglingVertices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", "_String"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"deleteDanglingVertices", "::", "typ"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[412]:=",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
RegionDimension[], RegionEmbeddingDimension[], MeshCellCount[]\
\>", "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionEmbeddingDimension", "[", "o_framework", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"embeddingDimension", "[", "o", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionEmbeddingDimension", "[", "o_origami", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"embeddingDimension", "[", "o", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionDimension", "[", "o_framework", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDimension", "[", " ", 
   RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionDimension", "[", "o_origami", "]"}], " ", "^:=", " ", 
   RowBox[{"RegionDimension", "[", " ", 
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{"o_framework", ",", " ", "d___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "d"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{"o_origami", ",", " ", "d___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"MeshCellCount", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "d"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[420]:=",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["vertex positions and displacements", "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],

Cell[CellGroupData[{

Cell["listParameters[],expandExpression[]", "Subsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listParameters", "[", "expr_", "]"}], ":=", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Extract", "[", 
       RowBox[{"expr", ",", "#"}], "]"}], "&"}], ")"}], "/@", 
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"List", "@@", "expr"}], ",", 
      RowBox[{"infinitesimal", "[", 
       RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[426]:=",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"This", " ", "basically", " ", "does", " ", "what", " ", 
    RowBox[{"Series", "[", "]"}], " ", "does", " ", "in", " ", "a", " ", 
    "somewhat", " ", "dumber", " ", 
    RowBox[{"way", ".", "\n", "\t", "It"}], " ", 
    RowBox[{"won", "'"}], "t", " ", "handle", " ", "limits", " ", "as", " ", 
    "nicely", " ", "as", " ", 
    RowBox[{"Series", "[", "]"}], " ", "but", " ", "it", " ", "typically", 
    " ", "presents", " ", "results", " ", "that", " ", "look", "\n", "\t", 
    "more", " ", "useful", " ", "for", " ", "analytic", " ", 
    RowBox[{"expressions", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", ",", "param_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "tmp"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"tmp", "@@", "param"}], ")"}], "^", "i"}], " ", 
            RowBox[{
             RowBox[{"D", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"{", 
                RowBox[{"param", ",", "i"}], "}"}]}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{"i", "!"}], ")"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"param", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "/.", 
         RowBox[{"param", "->", "0"}]}], "]"}], "/.", 
       RowBox[{"tmp", "->", "infinitesimal"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", "?", "NumericQ"}], "]"}], ":=", "expr"}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", "expr_", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"params", "=", 
        RowBox[{"listParameters", "[", "expr", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"Fold", "[", 
       RowBox[{"expandExpression", ",", "expr", ",", 
        RowBox[{"Reverse", "@", "params"}]}], "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[427]:=",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
vertexCoordinatesQ[], numericCoordinatesQ[], \
numericMachinePrecisionCoordinatesQ[]\
\>", "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vertexCoordinatesQ", "[", " ", 
   RowBox[{"coord_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "\[Equal]", "2"}], "||", 
      RowBox[{"#", "\[Equal]", "3"}]}], " ", "&"}], ")"}], "[", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", "coord", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"coord_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Dimensions", "[", "coord", "]"}], " ", "\[Equal]", " ", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[430]:=",ExpressionUUID->"a5ac437a-ac13-4dcc-937b-78f37d29cde8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"numericCoordinatesQ", "[", " ", 
   RowBox[{"coord_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "\[Equal]", "2"}], "||", 
      RowBox[{"#", "\[Equal]", "3"}]}], " ", "&"}], ")"}], "[", 
   RowBox[{"Dimensions", "[", "coord", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"numericCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"coord_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"Dimensions", "[", "coord", "]"}], " ", "\[Equal]", " ", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[432]:=",ExpressionUUID->"d5b5a4b2-1d6e-49b3-81b5-095c109c65b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"numericMachinePrecisionCoordinatesQ", "[", " ", 
   RowBox[{"coord_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "\[Equal]", "2"}], "||", 
      RowBox[{"#", "\[Equal]", "3"}]}], " ", "&"}], ")"}], "[", 
   RowBox[{"Dimensions", "[", "coord", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"numericMachinePrecisionCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"coord_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}]}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Dimensions", "[", "coord", "]"}], " ", "\[Equal]", " ", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[434]:=",ExpressionUUID->"b9a5f3ca-82c9-4e0e-b0f1-f8a346553919"]
}, Closed]],

Cell[CellGroupData[{

Cell["orthogonalizeDisplacements[]", "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"orthogonalizeDisplacements", "[", " ", 
   RowBox[{
    RowBox[{"displacements", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "vertexCoordinatesQ"}], "}"}]}], ",", " ", 
    RowBox[{"tol", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "8"}], ")"}]}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{
        RowBox[{"Dimensions", "[", "displacements", "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", " ", 
      RowBox[{"tolsq", " ", "=", " ", 
       RowBox[{"tol", "^", "2"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"Select", "[", " ", 
      RowBox[{
       RowBox[{"Orthogonalize", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", " ", "/@", " ", "displacements"}], ",", " ", 
         RowBox[{"Tolerance", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], ",",
        " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", ".", " ", "#"}], " ", ">", " ", "tolsq"}], " ", 
        "&"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[436]:=",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"orthogonalizeDisplacements", "::", "notdispl"}], "=", 
   "\"\<Not a list of valid vertex displacements of the same \
dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"orthogonalizeDisplacements", "::", "tol"}], "=", 
    "\"\<Tolerance must be numeric.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"orthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "___"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"orthogonalizeDisplacements", "::", "notdispl"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"orthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"orthogonalizeDisplacements", "::", "tol"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[437]:=",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],

Cell[CellGroupData[{

Cell["normalizeDisplacement[]", "Subsection",ExpressionUUID->"55d1c213-4bb2-4451-ba1c-fdc21c15bcf2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normalizeDisplacement", "[", 
   RowBox[{"displacement_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"Partition", "[", 
   RowBox[{
    RowBox[{"Normalize", "[", 
     RowBox[{"Flatten", "[", "displacement", "]"}], "]"}], ",", 
    RowBox[{"Last", "[", 
     RowBox[{"Dimensions", "[", "displacement", "]"}], "]"}]}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[441]:=",ExpressionUUID->"b074e873-e000-444e-bfd3-912d2da5f9f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["vertexPosition[], vertexDisplacement[], to3D, to2D, toDim", "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$coordinateSymbols", "[", "3", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$coordinateSymbols", "[", "2", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"vertexPosition", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"All", "[", " ", "d_Integer", " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"vertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", "m_Integer"}], "]"}], " ", ":=", " ", 
  RowBox[{"vertexPosition", "[", 
   RowBox[{"n", ",", " ", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexPosition", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"Range", "[", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{
      RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexPosition", "[", 
    RowBox[{"m_", "?", "mechanismQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"vertexPosition", "[", 
    RowBox[{"m", ",", " ", 
     RowBox[{"All", "[", " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"All", "[", "d_Integer", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", "m_Integer"}], "]"}], ":=", 
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{"n", ",", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", 
   RowBox[{"Range", "[", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{
      RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexDisplacement", "[", 
    RowBox[{"m_", "?", "mechanismQ"}], "]"}], ":=", 
   RowBox[{"vertexDisplacement", "[", 
    RowBox[{"m", ",", 
     RowBox[{"All", "[", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], "]"}]}], "]"}]}],
   "\n", "\n", 
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
   "Convert", " ", "vertex", " ", "positions", " ", "and", " ", 
    "displacements", " ", "in", " ", "various", " ", 
    RowBox[{"ways", "."}]}], "\n", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"to3D", "=", 
   RowBox[{
    RowBox[{"PadRight", "[", 
     RowBox[{"#", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Length", "[", "#", "]"}], ",", "3"}], "}"}]}], "]"}], 
    "&"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"to2D", "=", 
    RowBox[{
     RowBox[{"PadRight", "[", 
      RowBox[{"#", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "#", "]"}], ",", "2"}], "}"}]}], "]"}], 
     "&"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toDim", "::", "dim"}], "=", 
   "\"\<Number of dimensions is not a positive integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"toDim", "[", "n_Integer", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"PadRight", "[", 
     RowBox[{"#", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Length", "[", "#", "]"}], ",", "n"}], "}"}]}], "]"}], "&"}], 
   " ", "/;", " ", 
   RowBox[{"n", ">", "0"}]}]}], "\n", 
 RowBox[{
  RowBox[{"toDim", "[", "n_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"toDim", "::", "dim"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[442]:=",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"]
}, Closed]],

Cell[CellGroupData[{

Cell["displacementRules[], positionRules[]", "Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementRules", "[", " ", 
    RowBox[{"positions_", "?", "vertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"dataRules", "[", 
    RowBox[{"vertexDisplacement", ",", " ", "positions"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementRules", "::", "disp"}], " ", "=", " ", 
   "\"\<Displacements are not of valid form.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementRules", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"displacementRules", "::", "disp"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"positionRules", "[", " ", 
   RowBox[{"positions_", "?", "vertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"dataRules", "[", 
   RowBox[{"vertexPosition", ",", " ", "positions"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"positionRules", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions are not of valid form.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"positionRules", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"positionRules", "::", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"dataRules", "[", 
   RowBox[{
    RowBox[{"head", " ", ":", " ", 
     RowBox[{"vertexPosition", "|", "vertexDisplacement"}]}], ",", " ", 
    RowBox[{"positions_", "?", "vertexCoordinatesQ"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numberOfVertices", ",", "dim"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"numberOfVertices", ",", "dim"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
     RowBox[{"Thread", "[", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"head", "[", 
         RowBox[{
          RowBox[{"Range", "[", "numberOfVertices", "]"}], ",", 
          RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "]"}], " ", 
       "\[Rule]", " ", 
       RowBox[{"Flatten", "[", "positions", "]"}]}], " ", "]"}]}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dataRules", "[", " ", 
    RowBox[{
     RowBox[{"head", " ", ":", " ", 
      RowBox[{"vertexPosition", "|", "vertexDisplacement"}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"positions__", "?", "vertexCoordinatesQ"}], "}"}]}], " ", "]"}],
    " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"dataRules", "[", 
      RowBox[{"head", ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
    "positions"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dataRules", "::", "head"}], "=", "\"\<Invalid head.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dataRules", "::", "coord"}], "=", 
   "\"\<Second argument should be valid vertex coordinates.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"dataRules", "[", 
   RowBox[{"_", ",", 
    RowBox[{"positions_", "?", "vertexCoordinatesQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"dataRules", "::", "head"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"dataRules", "[", 
   RowBox[{
    RowBox[{"vertexPosition", "|", "vertexDisplacement"}], ",", 
    "positions_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"dataRules", "::", "coord"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[461]:=",ExpressionUUID->"f76ffa41-d78a-4aad-aca7-58faa9383c44"]
}, Closed]],

Cell[CellGroupData[{

Cell["randomDisplacements[]", "Subsection",ExpressionUUID->"5ef4575d-ff53-410b-b2dc-0721806c9003"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacementsInternal", "[", " ", 
    RowBox[{"positions_", ",", " ", "distribution_", ",", " ", 
     RowBox[{"precision_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
         RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], ",", " ", 
     RowBox[{"{", "}"}], ",", " ", 
     RowBox[{"numDisplacements_Integer", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "numberOfVertices", ",", " ", "dim", ",", " ", "randomNumbers"}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=", 
       " ", 
       RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
      RowBox[{"Check", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"positions", ",", " ", "numDisplacements"}], "]"}], " ", 
         "+", " ", 
         RowBox[{"RandomVariate", "[", " ", 
          RowBox[{"distribution", ",", " ", 
           RowBox[{"{", 
            RowBox[{
            "numDisplacements", ",", " ", "numberOfVertices", ",", "dim"}], 
            "}"}], ",", " ", 
           RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", "precision"}]}], 
          " ", "]"}]}], ",", "\n", "\n", "\t\t", "$Failed"}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacementsInternal", "[", " ", 
   RowBox[{"positions_", ",", " ", "distribution_", ",", " ", 
    RowBox[{"precision_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
        RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], ",", " ", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{
         RowBox[{"vertexDisplacement", "[", 
          RowBox[{"_", ",", "_"}], "]"}], ",", "_"}], "]"}], ".."}], "}"}]}], 
    ",", " ", 
    RowBox[{"numDisplacements_Integer", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
     "numberOfVertices", ",", " ", "dim", ",", " ", "displacements", ",", " ",
       "arbitraryDisplacements"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=", 
      " ", 
      RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
     RowBox[{"displacements", " ", "=", " ", 
      RowBox[{
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"vertexDisplacement", "[", 
           RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"numberOfVertices", ",", "dim"}], "}"}]}], "]"}], " ", "//.",
        " ", "rules"}]}], ";", "\n", "\t", 
     RowBox[{"arbitraryDisplacements", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", "displacements", "]"}], ",", " ", 
        "_vertexDisplacement"}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"Check", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"positions", ",", " ", "numDisplacements"}], "]"}], " ", "+",
         " ", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"displacements", " ", "/.", " ", 
             RowBox[{"Thread", "[", 
              RowBox[{"arbitraryDisplacements", "->", 
               RowBox[{"RandomVariate", "[", "\n", "\t\t\t", 
                RowBox[{"distribution", ",", "\n", "\t\t\t", 
                 RowBox[{"Length", "[", "arbitraryDisplacements", "]"}], ",", 
                 "\n", "\t\t\t", 
                 RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "\n",
                 "\t\t", "]"}]}], "]"}]}], " ", "&"}], ")"}], ",", " ", 
          "numDisplacements"}], " ", "]"}]}], ",", "\n", "\n", "\t\t", 
       "$Failed"}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[473]:=",ExpressionUUID->"e2d65e56-4673-4c8e-8227-2994bb1c0619"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "::", "numpos"}], "=", 
   "\"\<Not a valid number of displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "::", "precision"}], "=", 
   "\"\<Working precision should be a real, positive number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomDisplacements", "::", "rules"}], "=", 
    "\"\<List of rules must be of the form {vertexDisplacements[_,_]->_, \
..}\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacementsInternal", "[", " ", 
   RowBox[{
   "positions_", ",", " ", "distribution_", ",", " ", "precision_", ",", " ", 
    "rules_", ",", " ", "numDisplacements_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"NumericQ", "[", "precision", "]"}], " ", "&&", " ", 
       RowBox[{"precision", " ", ">", " ", "0"}]}], "]"}], ",", "\n", "\t\t", 
     
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"randomDisplacements", "::", "precision"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"IntegerQ", "[", "numDisplacements", "]"}], " ", "&&", " ", 
       RowBox[{"numDisplacements", " ", ">", " ", "0"}]}], "]"}], ",", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"randomDisplacements", "::", "numpos"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"randomDisplacements", "::", "rules"}], "]"}], ";", " ", 
      "False"}]}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[475]:=",ExpressionUUID->"097af00b-cd95-484d-a8cd-bcd98c53194e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "randomDisplacements", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<distribution\>\"", "->", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"WorkingPrecision", "->", "MachinePrecision"}], ",", "\n", "\t", 
      RowBox[{"\"\<rules\>\"", "\[Rule]", 
       RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacements", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"randomDisplacementsInternal", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", "1"}], 
       "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"res", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "randomDisplacementsInternal"}], " ", "&&", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], " ", ",", " ", "numDisplacements_", 
     ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"randomDisplacementsInternal", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
         
         RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", 
         "numDisplacements"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "randomDisplacementsInternal"}], " ", "&&", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], "\n",
   "\n", 
  RowBox[{"(*", 
   RowBox[{"choose", " ", "your", " ", "own", " ", "coordinates"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacements", "[", 
   RowBox[{
    RowBox[{"coordinates_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
  
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"randomDisplacementsInternal", "[", 
       RowBox[{"coordinates", ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", "1"}], 
       "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"res", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "randomDisplacementsInternal"}], " ", "&&", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "[", 
    RowBox[{
     RowBox[{"coordinates_", "?", "vertexCoordinatesQ"}], " ", ",", " ", 
     "numDisplacements_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"randomDisplacementsInternal", "[", 
        RowBox[{"coordinates", ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
         
         RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", 
         "numDisplacements"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "randomDisplacementsInternal"}], " ", "&&", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], "\n",
   "\n", 
  RowBox[{"(*", "***)"}]}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacements", "[", 
   RowBox[{
    RowBox[{"numVertices_Integer", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
    RowBox[{"All", "[", " ", 
     RowBox[{"dim", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
  
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"randomDisplacementsInternal", "[", " ", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", " ", 
          RowBox[{"{", 
           RowBox[{"numVertices", ",", " ", "dim"}], "}"}]}], " ", "]"}], " ",
         ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", "1"}], 
       "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"res", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "randomDisplacementsInternal"}], " ", "&&", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "[", 
    RowBox[{
     RowBox[{"numVertices_Integer", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"All", "[", " ", 
      RowBox[{"dim", ":", " ", 
       RowBox[{"2", "|", "3"}]}], " ", "]"}], " ", ",", " ", 
     "numDisplacements_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"randomDisplacementsInternal", "[", " ", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"{", 
            RowBox[{"numVertices", ",", " ", "dim"}], "}"}]}], " ", "]"}], 
         " ", ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<distribution\>\"", "]"}], ",", " ", 
         
         RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}], ",", " ", 
         "numDisplacements"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "randomDisplacementsInternal"}], " ", "&&", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomDisplacements", "::", "dim"}], "=", 
   "\"\<Dimension must be either 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomDisplacements", "::", "numvert"}], "=", 
    "\"\<Not a valid number of vertices.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"randomDisplacements", "[", 
   RowBox[{"numVertices_", ",", " ", "dim_", " ", ",", " ", "___"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", " ", 
      RowBox[{
       RowBox[{"IntegerQ", "[", "numVertices", "]"}], " ", "&&", " ", 
       RowBox[{"numVertices", " ", ">", " ", "0"}]}], " ", "]"}], ",", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"randomDisplacements", "::", "numvert"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"dim", " ", "\[NotEqual]", " ", "2"}], " ", "&&", " ", 
      RowBox[{"dim", " ", "\[NotEqual]", " ", "3"}]}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"randomDisplacements", "::", "dim"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", " ", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[479]:=",ExpressionUUID->"eb2c692b-8016-46c8-9bbf-9494375f1de4"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Periodic mechanisms", "Section",ExpressionUUID->"6c87b55b-aadb-402e-9eef-99119af5b41f"],

Cell[CellGroupData[{

Cell["periodicIdentification[]", "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mapQ", "[", 
   RowBox[{"{", 
    RowBox[{"f_", ",", " ", 
     RowBox[{"map", ":", "_Function"}]}], "}"}], "]"}], ":=", "True"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"maoQ", "[", "_", "]"}], ":=", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"periodicIdentificationData", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "mapQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"labels", " ", "=", " ", 
         RowBox[{"f", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"maps", " ", "=", " ", 
         RowBox[{"f", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"pos", " ", "=", " ", 
         RowBox[{"mechanismPositions", "[", "m", "]"}]}], ",", " ", 
        RowBox[{"dim", " ", "=", " ", 
         RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"ruleFunction", "=", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "x", "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
             RowBox[{"x", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}]}], " ", "]"}]}],
         ",", "\n", "\t", 
        RowBox[{"vertices", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "]"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"labels", ",", "\n", "\t\t", 
        RowBox[{"vertices", " ", "//.", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"MapThread", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ruleFunction", "[", "#1", "]"}], " ", "/@", " ", 
              RowBox[{"overlappingVertices", "[", 
               RowBox[{"pos", ",", " ", 
                RowBox[{"#2", " ", "/@", " ", "pos"}]}], "]"}]}], "&"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"labels", ",", "maps"}], "}"}]}], "\n", "\t\t", "]"}], 
          "]"}]}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[489]:=",ExpressionUUID->"894f0b58-5723-4d0e-809d-4ee4d9dc3d49"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"periodicIdentification", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"transf", " ", ":", " ", 
      RowBox[{"{", "__Function", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", 
       RowBox[{"f", "=", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "]"}], "&"}], ",", 
          RowBox[{"Length", "[", "transf", "]"}]}], " ", "]"}]}]}], "}"}], 
     ",", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"embeddingDimension", "[", "m", "]"}]}], ",", "\n", 
         RowBox[{"data", " ", "=", " ", 
          RowBox[{"periodicIdentificationData", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Transpose", "[", " ", 
             RowBox[{"{", 
              RowBox[{"f", ",", " ", "transf"}], "}"}], " ", "]"}]}], " ", 
           "]"}]}], ",", "\n", 
         RowBox[{"cleanupRule", " ", "=", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{"f", "\[Rule]", "Identity"}], "]"}]}]}], "\n", "}"}], ",", 
       "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "/.", " ", 
         RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
          RowBox[{"vertexPosition", "[", 
           RowBox[{"x", ",", 
            RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", " ", 
        "cleanupRule"}]}], "\n", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"periodicIdentification", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "func_List", ",", " ", 
    RowBox[{"transf", " ", ":", " ", 
     RowBox[{"{", "__Function", "}"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", "y", ",", " ", 
       RowBox[{"f", "=", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "]"}], "&"}], ",", 
          RowBox[{"Length", "[", "transf", "]"}]}], " ", "]"}]}]}], "}"}], 
     ",", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"embeddingDimension", "[", "m", "]"}]}], ",", "\n", 
         RowBox[{"data", " ", "=", " ", 
          RowBox[{"periodicIdentificationData", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Transpose", "[", " ", 
             RowBox[{"{", 
              RowBox[{"f", ",", " ", "transf"}], "}"}], " ", "]"}]}], " ", 
           "]"}]}], ",", "\n", 
         RowBox[{"cleanupRule", " ", "=", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{"f", "\[Rule]", "func"}], "]"}]}]}], "\n", "}"}], ",", 
       "\n", "\t", 
       RowBox[{"DeleteCases", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"vertexPosition", "[", "m", "]"}], "]"}], " ", "\[Rule]", 
           " ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"data", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "/.", " ", 
              RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
               RowBox[{"vertexPosition", "[", 
                RowBox[{"x", ",", 
                 RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", 
             " ", "cleanupRule"}], " ", "]"}]}], " ", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"y_", " ", "\[Rule]", " ", "y_"}]}], "\n", "\t", "]"}]}], 
      "\n", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "func", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"Length", "[", "transf", "]"}]}]}]}]}], "Code",
 CellLabel->
  "In[492]:=",ExpressionUUID->"b2e7dc4a-fb6d-44f9-b0b0-6d6b222a28ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"periodicIdentification", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"vars_", "?", "VectorQ"}], ",", " ", 
    RowBox[{"latticeVectors_", "?", "MatrixQ"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", " ", "y", ",", " ", "z", ",", " ", 
       RowBox[{"f", "=", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "]"}], "&"}], ",", 
          RowBox[{"Length", "[", "vars", "]"}]}], "]"}]}]}], "}"}], ",", " ", 
     
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"embeddingDimension", "[", "m", "]"}]}], ",", "\n", 
         RowBox[{"data", " ", "=", " ", 
          RowBox[{"periodicIdentificationData", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Transpose", "[", " ", 
             RowBox[{"{", 
              RowBox[{"f", ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"Function", "[", 
                  RowBox[{
                   RowBox[{"{", "z", "}"}], ",", 
                   RowBox[{"z", " ", "+", " ", "#"}]}], "]"}], "&"}], " ", "/@",
                 " ", "latticeVectors"}]}], "}"}], " ", "]"}]}], " ", "]"}]}],
          ",", "\n", 
         RowBox[{"cleanupRule", " ", "=", " ", 
          RowBox[{"Thread", "[", " ", 
           RowBox[{"f", " ", "\[Rule]", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{
                 RowBox[{"{", "y", "}"}], ",", " ", 
                 RowBox[{"#", " ", "y"}]}], "]"}], "&"}], "/@", "vars"}], 
             ")"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{"DeleteCases", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"data", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "/.", " ", 
              RowBox[{"x_Integer", " ", "\[RuleDelayed]", " ", 
               RowBox[{"vertexDisplacement", "[", 
                RowBox[{"x", ",", 
                 RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", "/.", 
             " ", "cleanupRule"}], " ", "]"}]}], " ", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"z_", " ", "\[Rule]", " ", "z_"}]}], "\n", "\t", "]"}]}], 
      "\n", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "vars", "]"}], "\[Equal]", 
     RowBox[{"Length", "[", "latticeVectors", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Last", "[", " ", 
      RowBox[{"Dimensions", "[", "latticeVectors", "]"}], " ", "]"}], " ", 
     "\[Equal]", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}]}]}]], "Code",
 CellLabel->
  "In[494]:=",ExpressionUUID->"b9b089d6-add9-4269-87bb-d50c23ee1f14"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "overlappingVertices", " ", "returns", " ", "a", " ", "list", " ", "of", 
    " ", "which", " ", "vertices", " ", "in", " ", "the", " ", "first", " ", 
    "set", " ", "of", " ", "positions", " ", "can", " ", "be", "\n", "\t", 
    "identified", " ", "in", " ", "the", " ", "second", " ", 
    RowBox[{"set", ".", "\n", "\t", "\n", "\t", 
     RowBox[{"overlappingVertices", "[", 
      RowBox[{
       RowBox[{"positions", " ", "1"}], ",", " ", 
       RowBox[{"positions", " ", "2"}]}], "]"}]}], " ", "returns", " ", "a", 
    " ", "list", " ", "of", " ", "which", " ", "vertices", " ", "listed", " ",
     "in", " ", "1", " ", "can", " ", "be", " ", "found", " ", "in", " ", 
    "2."}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"overlappingVertices", "[", 
    RowBox[{
     RowBox[{"positions1_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"positions2_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "5"}], ")"}]}]}]}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"nearestList", ",", " ", "selectorList"}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"(*", "\n", "\t", 
       RowBox[{
       "get", " ", "the", " ", "points", " ", "in", " ", "list", " ", "1", 
        " ", "that", " ", "are", " ", "closest", " ", "to", " ", "each", " ", 
        "of", " ", "the", " ", "points", " ", "in", " ", "list", " ", "2"}], 
       "\n", "\t", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"nearestList", " ", "=", " ", 
        RowBox[{
         RowBox[{"Nearest", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"positions1", " ", "\[Rule]", " ", 
             RowBox[{"Range", "[", " ", 
              RowBox[{"Length", "[", "positions1", "]"}], " ", "]"}]}], "]"}],
            ",", " ", "positions2"}], " ", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", ";", "\n", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "the", " ", "actual", " ", "overlapping", " ", "points", 
         " ", "according", " ", "to", " ", "the", " ", "provided", " ", 
         "tolerance"}], "*)"}], "\n", "\t", 
       RowBox[{"selectorList", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", "#"}], "<", 
            RowBox[{"tol", "^", "2"}]}], "&"}], ")"}], " ", "/@", " ", 
         RowBox[{"(", " ", 
          RowBox[{"positions2", "-", 
           RowBox[{"positions1", "[", 
            RowBox[{"[", " ", "nearestList", " ", "]"}], "]"}]}], " ", 
          ")"}]}]}], " ", ";", "\n", "\n", "\t", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"nearestList", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", " ", 
            RowBox[{"Length", " ", "@", " ", "positions1"}], "]"}]}], " ", 
          "]"}], ",", " ", "selectorList"}], " ", "]"}]}]}], "\n", "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "positions1", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", "positions2", "]"}]}]}]}]}]], "Code",
 CellLabel->
  "In[495]:=",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["minimalMechanism[]", "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"minimalMechanism", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
       ")"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"badVertices", "=", 
        RowBox[{"Check", "[", 
         RowBox[{
          RowBox[{"DeleteDuplicates", "[", " ", 
           RowBox[{
            RowBox[{"periodicIdentification", "[", 
             RowBox[{"m", ",", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"1", ",", 
                RowBox[{"Length", "[", "basis", "]"}]}], "]"}], ",", 
              "basis"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          "$Failed"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"badEdges", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"connectivity", "[", 
               RowBox[{"m", ",", 
                RowBox[{"\"\<edges\>\"", "\[Rule]", "\"\<vertices\>\""}]}], 
               "]"}], ",", 
              RowBox[{
               RowBox[{"ContainsAll", "[", 
                RowBox[{"badVertices", ",", "#"}], "]"}], "&"}]}], "]"}]}], 
           ",", "\n", "\t\t", 
           RowBox[{"badFaces", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{
              RowBox[{"connectivity", "[", 
               RowBox[{"m", ",", 
                RowBox[{"\"\<faces\>\"", "\[Rule]", "\"\<vertices\>\""}]}], 
               "]"}], ",", 
              RowBox[{
               RowBox[{"ContainsAll", "[", 
                RowBox[{"badVertices", ",", "#"}], "]"}], "&"}]}], "]"}]}]}], 
          "\n", "\t", "}"}], ",", "\n", "\t\t", 
         RowBox[{"deleteDanglingVertices", "[", "\n", "\t\t\t", 
          RowBox[{"deleteCells", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Alternatives", " ", "@@", " ", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"_", "/@", "badEdges"}], ",", 
               RowBox[{"_", "/@", "badFaces"}]}], "]"}]}]}], " ", "]"}], "\n",
           "\t\t", "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
       RowBox[{"badVertices", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "basis", "]"}], "\[Equal]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"embeddingDimension", "[", "m", "]"}], ",", 
         RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}], ",", 
      "True", ",", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"minimalMechanism", "::", "dim"}], "]"}], ";", " ", 
       "False"}]}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"minimalMechanism", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"basis_", "?", "MatrixQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"minimalMechanism", "::", "num"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"minimalMechanism", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"basis", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_", "?", "MatrixQ"}], "]"}]}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"minimalMechanism", "::", "num"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"minimalMechanism", "[", 
   RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"minimalMechanism", "::", "num"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[496]:=",ExpressionUUID->"ffd7ea39-a364-44f4-94e2-69aab71ecae0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"minimalMechanism", "::", "dim"}], "=", 
   "\"\<Dimension of basis must match embedding dimension of \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimalMechanism", "::", "num"}], "=", 
   "\"\<Second argument should be a numeric basis.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[500]:=",ExpressionUUID->"f855b1b9-6eff-4966-88ee-3d609bef8039"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["geometry", "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],

Cell[CellGroupData[{

Cell["Measuring cell functions", "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],

Cell[CellGroupData[{

Cell["displacementVector[]", "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementVector", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementVector", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", "_Integer"}], "}"}], ".."}], "}"}]}]}], 
    "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementVectorInternal", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"pos_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementVectorInternal", "[", " ", 
     RowBox[{"pos", " ", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementVector", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"edgeList", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}], 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"displacementVectorInternal", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
     "edgeList"}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
     "1"}]}]}]}]}], "Code",
 CellLabel->
  "In[502]:=",ExpressionUUID->"17b69bef-e499-4349-baa1-daabc117b244"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementVectorInternal", "[", 
    RowBox[{
     RowBox[{"positions_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
     "edgeList_"}], "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"displacementVectorCompiled", "[", "]"}], "[", 
    RowBox[{"positions", ",", "edgeList"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementVectorInternal", "[", 
    RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flippedEdgeList", "=", 
       RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementVectorCompiled", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"displacementVectorCompiled", "[", "]"}], "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"positions", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edgeList", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"flippedEdgeList", "=", 
         RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"flippedEdgeList", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"flippedEdgeList", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "\t", 
      "]"}]}], "\[IndentingNewLine]", "]"}]}]}]}], "Code",
 CellLabel->
  "In[506]:=",ExpressionUUID->"b3dd01b3-e2b3-4f86-9379-bb750cf02b0f"]
}, Closed]],

Cell[CellGroupData[{

Cell["displacementLength[]", "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementLength", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLength", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthInternal", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLength", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthInternal", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLength", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthInternal", "[", " ", 
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
      "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"MeshCellCount", "[", 
       RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "edgelist_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"displacementLengthCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthInternal", "[", 
   RowBox[{"positions_", ",", "edgelist_"}], "]"}], ":=", 
  RowBox[{"displacementLengthAnalytic", "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[509]:=",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthCompiled", "[", "d_Integer", "]"}], ":=", 
   RowBox[{
    RowBox[{"displacementLengthCompiled", "[", "d", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"index1", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
              "\t\t\t", 
              RowBox[{"index2", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
             "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
                "^", "2"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], 
           "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Sqrt", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], " ", "/@", " ", 
     RowBox[{"displacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[515]:=",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],

Cell[CellGroupData[{

Cell["displacementLengthSquared[]", "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthSquared", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthSquared", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthSquaredInternal", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthSquared", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthSquaredInternal", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthSquared", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthSquaredInternal", "[", " ", 
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
      "edgeList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"MeshCellCount", "[", 
       RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthSquaredInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "edgelist_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"displacementLengthSquaredCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthSquaredInternal", "[", 
   RowBox[{"positions_", ",", "edgelist_"}], "]"}], ":=", 
  RowBox[{"displacementLengthSquaredAnalytic", "[", 
   RowBox[{"positions", ",", 
    RowBox[{"ToPackedArray", "[", "edgelist", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[517]:=",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"displacementLengthSquaredCompiled", "[", "d_Integer", "]"}], ":=", 
  
  RowBox[{
   RowBox[{"displacementLengthSquaredCompiled", "[", "d", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"index1", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"index2", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
            "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
              "^", "2"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], "\n", 
          "\t\t\t", "]"}], ",", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthSquaredAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ",", 
     RowBox[{"displacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[523]:=",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],

Cell[CellGroupData[{

Cell["turningAngle[]", "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"turningAngle", "[", 
    RowBox[{"p__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"turningAngle", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tripleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer"}], "}"}], 
        ".."}], "}"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"turningAngleInternal", "[", 
     RowBox[{"positions", ",", " ", "tripleList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"turningAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tripleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer"}], "}"}], 
        ".."}], "}"}]}]}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"turningAngleInternal", "[", 
     RowBox[{"positions", ",", " ", "tripleList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"turningAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"tripleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer"}], "}"}], 
        ".."}], "}"}]}]}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"turningAngleInternal", "[", " ", 
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
      "tripleList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"MeshCellCount", "[", 
       RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"turningAngleInternal", "[", 
   RowBox[{
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "tripleList_"}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"turningAngleCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
    RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"turningAngleInternal", "[", 
   RowBox[{"positions_", ",", "tripleList_"}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"turningAngleAnalytic", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "positions", ",", 
    RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[525]:=",ExpressionUUID->"fe12d61c-c2b8-41f3-93cc-6879d3615206"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"turningAngleCompiled", "[", "3", "]"}], ":=", 
   RowBox[{
    RowBox[{"turningAngleCompiled", "[", "3", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",",
       "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"p1x", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p1y", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p1z", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2x", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2y", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
               "]"}]}]}], ",", "\n", "\t\t\t", 
            RowBox[{"p2z", "=", 
             RowBox[{
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
               "]"}], "-", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"pos", ",", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
               "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
          RowBox[{"ArcCos", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p1x", " ", "p2x"}], "+", 
              RowBox[{"p1y", " ", "p2y"}], "+", 
              RowBox[{"p1z", " ", "p2z"}]}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"p1x", "^", "2"}], "+", 
                RowBox[{"p1y", "^", "2"}], "+", 
                RowBox[{"p1z", "^", "2"}]}], "]"}], " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"p2x", "^", "2"}], "+", 
                RowBox[{"p2y", "^", "2"}], "+", 
                RowBox[{"p2z", "^", "2"}]}], "]"}]}], ")"}]}], "]"}]}], "\n", 
         "\t\t", "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"turningAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"turningAngleCompiled", "[", "2", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"p1x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p1y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"p1x", " ", "p2x"}], " ", "+", " ", 
              RowBox[{"p1y", " ", "p2y"}]}], ",", 
             RowBox[{
              RowBox[{"p1x", " ", "p2y"}], " ", "-", " ", 
              RowBox[{"p2x", " ", "p1y"}]}]}], "]"}]}], "\n", "\t\t", "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], "\n",
       "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[531]:=",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "this", " ", "funny", " ", "construction", " ", "here", " ", "works", " ",
      "better", " ", "during", " ", "expansions", " ", "because", " ", "of", 
     " ", "the", " ", "branch", " ", "cuts", " ", "of", " ", 
     RowBox[{"ArcCos", "[", "]"}], "\n", "\n", "The", " ", "problem", " ", 
     "arises", " ", "in", " ", 
     RowBox[{"Series", "[", 
      RowBox[{
       RowBox[{"ArcCos", "[", 
        RowBox[{"1", "-", 
         RowBox[{"xx", "^", "2"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"xx", ",", "0", ",", "2"}], "}"}]}], "]"}], " ", "which", " ",
      "requires", " ", "the", " ", "choice", " ", "of", " ", "a", " ", 
     RowBox[{"branch", ".", " ", "This"}], " ", "last", " ", "part", "\n", 
     RowBox[{"hasn", "'"}], "t", " ", "been", " ", "solved", " ", "but", " ", 
     "at", " ", "least", " ", "the", " ", "answer", " ", "comes", " ", "out", 
     " ", 
     RowBox[{"faster", ".", " ", "The"}], " ", "rest", " ", "of", " ", "the", 
     " ", "branch", " ", "cut", " ", "issues", "\n", "are", " ", "handled", 
     " ", "automatically", " ", "in", " ", 
     RowBox[{"expandExpression", "[", "]"}]}], ",", " ", 
    RowBox[{
    "which", " ", "does", " ", "what", " ", "it", " ", "can", " ", "to", " ", 
     "make", " ", "imaginary", " ", "components", " ", 
     RowBox[{"zero", ".", "\n", "\n", "There"}], " ", "should", " ", "be", 
     " ", "a", " ", "better", " ", "way", " ", "to", " ", "handle", " ", 
     "this", " ", "but", " ", "this", " ", "seems", " ", "to", " ", "work", 
     " ", "in", " ", "most", " ", 
     RowBox[{"cases", "."}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"turningAngleAnalytic", "[", 
     RowBox[{"3", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"cosvectorAngle3D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", " ", "xx"}], "+", 
               RowBox[{"y", " ", "yy"}], "+", 
               RowBox[{"z", " ", "zz"}]}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"x", "^", "2"}], "+", 
                 RowBox[{"y", "^", "2"}], "+", 
                 RowBox[{"z", "^", "2"}]}], "]"}], " ", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"xx", "^", "2"}], "+", 
                 RowBox[{"yy", "^", "2"}], "+", 
                 RowBox[{"zz", "^", "2"}]}], "]"}]}], ")"}]}]}], "\n", "\t\t",
            "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"expandExpression", "@", 
              RowBox[{"cosvectorAngle3D", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], 
           "]"}]}], ")"}], "&"}], "/@", "tripleList"}]}], "\n", "]"}]}], "\n",
    "\n", 
   RowBox[{
    RowBox[{"turningAngleAnalytic", "[", 
     RowBox[{"2", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"vectorAngle2D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"x", " ", "xx"}], " ", "+", " ", 
               RowBox[{"y", " ", "yy"}]}], ",", 
              RowBox[{
               RowBox[{"x", " ", "yy"}], " ", "-", " ", 
               RowBox[{"xx", " ", "y"}]}]}], "]"}]}], "\t", "\n", "\t\t", 
           "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"vectorAngle2D", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], ")"}], 
        "&"}], "/@", "tripleList"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[533]:=",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],

Cell[CellGroupData[{

Cell["normalVector[]", "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "normalVector", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<normalize\>\"", "\[Rule]", "True"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVector", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVector", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"faces", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], ".."}], "}"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"normalVectorInternal", "[", 
     RowBox[{"positions", ",", " ", "faces", ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "faces", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "faces", "]"}], " ", "\[GreaterEqual]", " ", "1"}], 
     " ", "&&", " ", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"faces", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], ".."}], "}"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"normalVectorInternal", "[", 
     RowBox[{
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "faces", ",", 
      " ", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "faces", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", " ", 
     
     RowBox[{
      RowBox[{"Min", "[", "faces", "]"}], " ", "\[GreaterEqual]", " ", "1"}], 
     " ", "&&", " ", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVector", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"faces", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "__Integer", "}"}], ".."}], "}"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"normalVectorInternal", "[", 
     RowBox[{"positions", ",", " ", "faces", ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "faces", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "faces", "]"}], " ", "\[GreaterEqual]", " ", "1"}], 
     " ", "&&", " ", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<normalize\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"normalVectorInternal", "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "faces_", ",", 
    RowBox[{"normalize_", " ", ":", " ", "True"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"normalize", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"pos", ",", 
    RowBox[{"ToPackedArray", "[", "faces", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"normalVectorInternal", "[", 
   RowBox[{"pos_", ",", "faces_", ",", 
    RowBox[{"normalize_", " ", ":", " ", "True"}]}], "]"}], ":=", 
  RowBox[{"normalVectorAnalytic", "[", 
   RowBox[{"normalize", ",", 
    RowBox[{"Length", "[", 
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "pos", ",", "faces"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[535]:=",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normalVectorCompiled", "[", 
   RowBox[{"True", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"True", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "yy"}], " ", "z"}], "+", 
                RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "z"}], "-", 
                RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "xx"}], " ", "y"}], "+", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}]}],
             "\n", "\t\t\t", "}"}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"normalVectorCompiled", "[", 
   RowBox[{"False", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"False", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "yy"}], " ", "z"}], "+", 
               RowBox[{"y", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"xx", " ", "z"}], "-", 
               RowBox[{"x", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "xx"}], " ", "y"}], "+", 
               RowBox[{"x", " ", "yy"}]}], ")"}]}], "\n", "\t\t\t", "}"}]}], 
          "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"True", ",", "2"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"normalVectorCompiled", "[", 
     RowBox[{"True", ",", "2"}], "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Sign", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}], "]"}]}], "\n", "\t\t\t", "]"}], ",",
           "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"False", ",", "2"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"normalVectorCompiled", "[", 
     RowBox[{"False", ",", "2"}], "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "xx"}], " ", "y"}], "+", 
             RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVectorAnalytic", "[", 
    RowBox[{"True", " ", 
     RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
     "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
       RowBox[{"normalVector3D", "=", 
        RowBox[{"Function", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], 
                "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}], 
         "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "=", 
           RowBox[{"data", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"normalVector3D", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
       "triples"}]}], "\n", "]"}]}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"normalVectorAnalytic", "[", 
   RowBox[{"False", " ", 
    RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
    "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"unnormalVector3D", "=", 
       RowBox[{"Function", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], ",",
            "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"-", "yy"}], " ", "z"}], "+", 
              RowBox[{"y", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"xx", " ", "z"}], "-", 
              RowBox[{"x", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"unnormalVector3D", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "triples"}]}], "\n", "]"}], " "}]}], "Code",
 CellLabel->
  "In[542]:=",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],

Cell[CellGroupData[{

Cell["planarAngle[]", "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"planarAngle", "[", 
    RowBox[{"__", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"planarAngle", "[", 
    RowBox[{
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tripleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer"}], "}"}], 
        ".."}], "}"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"planarAngleInternal", "[", 
     RowBox[{"positions", ",", " ", "tripleList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"planarAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tripleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer"}], "}"}], 
        ".."}], "}"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"planarAngleInternal", "[", 
     RowBox[{"positions", ",", " ", "tripleList"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"planarAngle", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"tripleList", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", " ", "_Integer", ",", " ", "_Integer"}], 
        "}"}], ".."}], "}"}]}]}], " ", "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"planarAngleInternal", "[", 
    RowBox[{
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "tripleList"}], 
    "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Max", "[", "tripleList", "]"}], " ", "\[LessEqual]", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "tripleList", "]"}], " ", "\[GreaterEqual]", " ", 
     "1"}]}]}]}]}], "Code",
 CellLabel->
  "In[548]:=",ExpressionUUID->"39e4fbce-94cb-4ec1-909a-9be6211b734a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"planarAngleInternal", "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "triples_"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"planarAngleCompiled", "[", 
    RowBox[{"Length", "[", 
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
   RowBox[{"pos", ",", "triples"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"planarAngleInternal", "[", 
   RowBox[{"pos_", ",", "triples_"}], "]"}], " ", ":=", " ", 
  RowBox[{"planarAngleAnalytic", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"pos", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "pos", ",", "triples"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[552]:=",ExpressionUUID->"c161f406-b316-4337-bc62-09fbc7236f0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"planarAngleCompiled", "[", "3", "]"}], ":=", 
  RowBox[{
   RowBox[{"planarAngleCompiled", "[", "3", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"planarAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"planarAngleCompiled", "[", "2", "]"}], "=", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "\n", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[554]:=",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"planarAngleAnalytic", "[", 
   RowBox[{"3", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[556]:=",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"planarAngleAnalytic", "[", 
   RowBox[{"2", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[557]:=",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],

Cell[CellGroupData[{

Cell["foldAngle[]", "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"foldAngle", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"foldAngle", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"foldAngle", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"edgeList", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}], ".."}], "}"}]}]}], " ", 
   "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"foldAngleInternal", "[", 
    RowBox[{"m", ",", " ", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
     RowBox[{"listQuadruples", "[", 
      RowBox[{"m", ",", "edgeList"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
     "1"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"foldAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edgeList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", "_Integer"}], "}"}], ".."}], "}"}]}]}], " ",
     "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"foldAngleInternal", "[", 
     RowBox[{"m", ",", " ", "positions", ",", " ", 
      RowBox[{"listQuadruples", "[", 
       RowBox[{"m", ",", " ", "edgeList"}], "]"}]}], " ", "]"}], " ", "/;", 
    " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"foldAngle", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_", "?", "vertexCoordinatesQ"}], ".."}], "}"}]}], ",", " ", 
     RowBox[{"edgelist", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], ".."}], "}"}]}]}],
     " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"quadruples", " ", "=", " ", 
        RowBox[{"listQuadruples", "[", 
         RowBox[{"m", ",", "edgelist"}], "]"}]}], "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"foldAngleInternal", "[", 
         RowBox[{"m", ",", " ", "#", ",", " ", "quadruples"}], "]"}], "&"}], 
       " ", "/@", " ", "positions"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "edgelist", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", " ", 
     
     RowBox[{
      RowBox[{"Min", "[", "edgelist", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"listQuadruples", "[", 
   RowBox[{"m_", ",", "edgelist_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"faces", "=", 
      RowBox[{
       RowBox[{"connectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<edges\>\"", "\[Rule]", "\"\<ordered faces\>\""}]}], 
        "]"}], "[", 
       RowBox[{"[", " ", 
        RowBox[{
         RowBox[{"MeshCellIndex", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", 
           RowBox[{"Line", " ", "/@", " ", "edgelist"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}], "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"ToPackedArray", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "==", "2"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"Last", "@", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", "0", ",", "0"}], 
          "}"}]}], "]"}], "&"}], "/@", "faces"}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[558]:=",ExpressionUUID->"105425f9-6faa-403b-bf41-cd3b92587bc2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"foldAngleInternal", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    "quadruples_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"foldAngleCompiled", "[", "]"}], "[", 
   RowBox[{"positions", ",", "quadruples"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"foldAngleInternal", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "positions_", ",", " ", 
     "quadruples_"}], "]"}], ":=", 
   RowBox[{"foldAngleAnalytic", "[", 
    RowBox[{"positions", ",", "quadruples"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"foldAngleCompiled", "[", "]"}], ":=", 
   RowBox[{
    RowBox[{"foldAngleCompiled", "[", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", 
      RowBox[{"Table", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"faces", ",", "i", ",", "3"}], "]"}], "==", "0"}], ",", 
          "\n", "\t", "0", ",", "\n", "\t", 
          RowBox[{"With", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t", 
             RowBox[{
              RowBox[{"p1x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "4"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "4"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"faces", ",", "i", ",", "4"}], "]"}], ",", "3"}], 
                "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3y"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3z"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3y"}], "-", 
                  RowBox[{"p2y", " ", "p3z"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], 
               " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
                 RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
                 RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
                 RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
                 RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
                 RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
                 RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p1z", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2x", " ", "p3y"}], "-", 
                    RowBox[{"p3y", " ", "p4x"}], "+", 
                    RowBox[{"p2y", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
                    RowBox[{"p2x", " ", "p4y"}], "+", 
                    RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
                    RowBox[{"p2y", " ", "p3x"}], "+", 
                    RowBox[{"p1x", " ", "p3y"}], "-", 
                    RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
                 RowBox[{"p1y", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2z", " ", "p3x"}], "-", 
                    RowBox[{"p2x", " ", "p3z"}], "-", 
                    RowBox[{"p2z", " ", "p4x"}], "+", 
                    RowBox[{"p3z", " ", "p4x"}], "+", 
                    RowBox[{"p2x", " ", "p4z"}], "-", 
                    RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], 
             "]"}]}], "\n", "\t", "]"}]}], "]"}], ",", "\n", "\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "faces", "]"}]}], "}"}]}], "\n", "]"}], ",", 
      "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"foldAngleAnalytic", "[", 
   RowBox[{"positions_", ",", "quadrupleList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"With", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"p1x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p2x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p3x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p4x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}]}], 
       "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"expandExpression", "@", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3y"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3z"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3y"}], "-", 
             RowBox[{"p2y", " ", "p3z"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
            RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
            RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
            RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
            RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
            RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
            RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p1z", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2x", " ", "p3y"}], "-", 
               RowBox[{"p3y", " ", "p4x"}], "+", 
               RowBox[{"p2y", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
               RowBox[{"p2x", " ", "p4y"}], "+", 
               RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
               RowBox[{"p2y", " ", "p3x"}], "+", 
               RowBox[{"p1x", " ", "p3y"}], "-", 
               RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
            RowBox[{"p1y", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2z", " ", "p3x"}], "-", 
               RowBox[{"p2x", " ", "p3z"}], "-", 
               RowBox[{"p2z", " ", "p4x"}], "+", 
               RowBox[{"p3z", " ", "p4x"}], "+", 
               RowBox[{"p2x", " ", "p4z"}], "-", 
               RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], "]"}]}]}],
      "\n", "\t", "]"}], "&"}], "/@", "quadrupleList"}]}]}], "Code",
 CellLabel->
  "In[564]:=",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["gaussianCurvature[]", "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gaussianCurvature", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"gaussianCurvature", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"gaussianCurvature", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"vertexList", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"gaussianCurvatureInternal", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "vertexList"}], 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "&&", " ", 
     
     RowBox[{
      RowBox[{"Min", "[", "vertexList", "]"}], " ", "\[GreaterEqual]", " ", 
      "1"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"gaussianCurvature", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"vertexList", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"gaussianCurvatureInternal", "[", 
    RowBox[{"m", ",", " ", "positions", ",", " ", "vertexList"}], "]"}], " ", 
   "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", "positions", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{
       RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}]}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Min", "[", "vertexList", "]"}], " ", "\[GreaterEqual]", " ", 
     "1"}]}]}]}]}], "Code",
 CellLabel->
  "In[568]:=",ExpressionUUID->"c2dc76eb-f1f2-4627-94b2-322d01f7c229"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"gaussianCurvatureInternal", "[", 
    RowBox[{"m_", ",", " ", "pos_", ",", "vertexlist_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"ConstantArray", "[", 
     RowBox[{"0", ",", 
      RowBox[{"Length", "[", "vertexlist", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"embeddingDimension", "[", "m", "]"}], "\[Equal]", "2"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"gaussianCurvatureInternal", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "MachineRealQ"}], "]"}], "&"}], ")"}]}], ",", 
    "vertexlist_"}], "]"}], ":=", "\n", "\t\t", 
  RowBox[{
   RowBox[{"gaussianCurvatureCompiled", "[", "]"}], "[", 
   RowBox[{"pos", ",", "\n", "\t\t\t", 
    RowBox[{"ToPackedArray", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"PadRight", "[", 
        RowBox[{"connectivity", "[", 
         RowBox[{"m", ",", 
          RowBox[{"\"\<vertices\>\"", "->", "\"\<ordered faces\>\""}]}], 
         "]"}], "]"}], "[", 
       RowBox[{"[", "vertexlist", "]"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", 
        RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], "]"}]}], "\n", "\t", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"gaussianCurvatureInternal", "[", 
   RowBox[{"m_", ",", " ", "pos_", ",", "vertexlist_"}], "]"}], ":=", "\n", 
  "\t", 
  RowBox[{"gaussianCurvatureAnalytic", "[", "\n", "\t\t", 
   RowBox[{"pos", ",", "\n", "\t\t", 
    RowBox[{"ToPackedArray", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{"RotateRight", ",", " ", 
        RowBox[{
         RowBox[{"connectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<vertices\>\"", " ", "\[Rule]", " ", 
            "\"\<ordered faces\>\""}]}], "]"}], "[", 
         RowBox[{"[", "vertexlist", "]"}], "]"}], ",", 
        RowBox[{"{", "2", "}"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", 
        RowBox[{"1", ";;", "3"}]}], "]"}], "]"}], "\n", "\t\t", "]"}]}], "\n",
    "\t", "]"}]}]}], "Code",
 CellLabel->
  "In[572]:=",ExpressionUUID->"983639bb-e7ad-4ed8-a16b-1a1e153cc30e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaussianCurvatureCompiled", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"gaussianCurvatureCompiled", "[", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "3"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", " ", "Pi"}], "-", 
          RowBox[{"Sum", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}], "==",
                "0"}], ",", "\n", "\t\t\t", "0", ",", "\n", "\t\t\t", 
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"x", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"y", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"z", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"xx", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"yy", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"zz", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", 
                "\n", "\t\t\t", 
                RowBox[{"ArcTan", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"x", " ", "xx"}], "+", 
                   RowBox[{"y", " ", "yy"}], "+", 
                   RowBox[{"z", " ", "zz"}]}], ",", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
                 "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "]"}], ",", 
            "\n", "\t\t", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j"}], "]"}], "]"}]}], "}"}]}], 
           RowBox[{"(*", " ", "Sum", " ", "*)"}], "\n", "\t", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], " ", 
      
      RowBox[{"(*", " ", "Table", " ", "*)"}], "\n", "\t", "]"}], ",", "\n", 
     "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$compilationTarget"}]}], "\n", 
    "]"}]}]}]], "Code",
 CellLabel->
  "In[575]:=",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gaussianCurvatureAnalytic", "[", 
   RowBox[{"pos_", ",", 
    RowBox[{"{", 
     RowBox[{"triples__", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], "}"}]}], 
   "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"expandExpression", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", "Pi"}], "-", 
        RowBox[{"Total", "[", 
         RowBox[{"planarAngle", "[", 
          RowBox[{"pos", ",", "#"}], "]"}], "]"}]}], ")"}]}], ")"}], "&"}], "/@", 
   RowBox[{"{", "triples", "}"}]}]}]], "Code",
 CellLabel->
  "In[576]:=",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global geometry functions", "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],

Cell[CellGroupData[{

Cell["FindGeometricTransform[], alignMechanism[]", "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_origami", ",", " ", "r___"}], " ", "]"}], " ",
   "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FindGeometricTransform", "[", 
    RowBox[{"m1_origami", ",", " ", "m2_origami", ",", " ", "r___"}], "]"}], 
   " ", "^:=", " ", 
   RowBox[{"FindGeometricTransform", "[", " ", 
    RowBox[{
     RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", 
     RowBox[{"m2", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_framework", ",", " ", "r___"}], " ", "]"}], 
  " ", "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"m1_framework", ",", " ", "m2_framework", ",", " ", "r___"}], 
   "]"}], " ", "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{
    RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", 
    RowBox[{"m2", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[577]:=",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"alignMechanismInternal", "[", " ", 
   RowBox[{
    RowBox[{"positionsFrom_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"positionsTo_", "?", "vertexCoordinatesQ"}], ",", " ", 
    "options_"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"transformation", " ", "=", " ", 
      RowBox[{"FindGeometricTransform", "[", 
       RowBox[{"positionsFrom", ",", " ", "positionsTo", ",", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"options", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], 
             ",", " ", 
             RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ",
             "}"}]}], "}"}], "]"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "transformation", "]"}], " ", "===", " ", 
       "FindGeometricTransform"}], ",", " ", "$Failed", ",", " ", 
      RowBox[{"transformation", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "In[581]:=",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "alignMechanism", "]"}], "=", 
    RowBox[{"Options", "[", "FindGeometricTransform", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "[", 
    RowBox[{
     RowBox[{"mFrom_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"mTo_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"alignMechanismInternal", "[", " ", 
         RowBox[{
          RowBox[{"mFrom", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"mechanismPositions", "[", " ", 
        RowBox[{"mTo", " ", "\[Rule]", " ", 
         RowBox[{"res", "[", 
          RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "]"}],
        " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mFrom", "[", "\"\<VertexNumber\>\"", "]"}], ",", 
       RowBox[{"embeddingDimension", "[", "mFrom", "]"}]}], "}"}], " ", 
     "\[Equal]", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mTo", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
       RowBox[{"embeddingDimension", "[", "mTo", "]"}]}], "}"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "[", 
    RowBox[{
     RowBox[{"positionsFrom_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"mTo_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"alignMechanismInternal", "[", " ", 
         RowBox[{"positionsFrom", ",", " ", 
          RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"mechanismPositions", "[", " ", 
        RowBox[{"mTo", " ", "\[Rule]", " ", 
         RowBox[{"res", "[", 
          RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], "]"}]}], " ", "]"}],
        " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{"numericCoordinatesQ", "[", 
     RowBox[{"mTo", ",", " ", "positionsFrom"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "[", 
    RowBox[{
     RowBox[{"positionsFrom_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mTo_", "?", "mechanismQ"}], ",", " ", 
       RowBox[{"vertexList", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"alignMechanismInternal", "[", " ", 
         RowBox[{"positionsFrom", ",", " ", 
          RowBox[{
           RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], "[", 
           RowBox[{"[", " ", "vertexList", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"mechanismPositions", "[", " ", 
        RowBox[{"mTo", " ", "\[Rule]", " ", 
         RowBox[{"res", "[", " ", 
          RowBox[{"mTo", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}], " ", 
        "]"}], " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", 
      RowBox[{"positionsFrom", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
     
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "positionsFrom", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", 
      RowBox[{"embeddingDimension", "[", "mTo", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "positionsFrom", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Length", "[", "vertexList", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"mTo", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "[", 
    RowBox[{
     RowBox[{"mFrom_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"positionsTo_", "?", "vertexCoordinatesQ"}], ",", " ", 
       RowBox[{"vertexList", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"alignMechanismInternal", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"mFrom", "[", "\"\<positions\>\"", "]"}], "[", 
           RowBox[{"[", " ", "vertexList", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"positionsTo", "[", 
           RowBox[{"[", " ", "vertexList", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"res", "[", " ", "positionsTo", " ", "]"}], " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", 
      RowBox[{"positionsTo", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "positionsTo", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", 
      RowBox[{"embeddingDimension", "[", "mFrom", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"mFrom", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "[", 
    RowBox[{
     RowBox[{"mFrom_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positionsTo_", "?", "vertexCoordinatesQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"alignMechanismInternal", "[", " ", 
         RowBox[{
          RowBox[{"mFrom", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          "positionsTo", ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"res", "[", " ", "positionsTo", " ", "]"}], " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", 
      RowBox[{"positionsTo", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "positionsTo", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"mFrom", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
        RowBox[{"embeddingDimension", "[", "mFrom", "]"}]}], " ", 
       "}"}]}]}]}]}], "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "::", "match"}], "=", 
   "\"\<Mechanisms must have the same number of vertices and embedding \
dimension and positions must be numeric.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "::", "vert"}], "=", 
   "\"\<Vertices are out of bound\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"alignMechanism", "::", "number"}], "=", 
   "\"\<Number of vertices must match number of points.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"alignMechanism", "[", 
   RowBox[{
    RowBox[{"_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"alignMechanism", "::", "match"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"alignMechanism", "[", 
   RowBox[{
    RowBox[{"_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"alignMechanism", "::", "match"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"alignMechanism", "[", " ", 
   RowBox[{
    RowBox[{"pos", " ", ":", " ", 
     RowBox[{"_", "?", "vertexCoordinatesQ"}]}], ",", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"mTo", " ", ":", " ", 
       RowBox[{"_", "?", "mechanismQ"}]}], ",", " ", 
      RowBox[{"vertexList", " ", ":", " ", 
       RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", " ", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"pos", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dimensions", "[", "pos", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", 
        RowBox[{"embeddingDimension", "[", "mTo", "]"}]}]}], " ", "]"}], ",", 
     " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"alignMechanism", "::", "match"}], "]"}], ";", " ", "False"}], 
     ",", "\n", "\t", 
     RowBox[{"Not", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
        RowBox[{"mTo", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}]}], " ", 
      "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"alignMechanism", "::", "vert"}], "]"}], ";", " ", "False"}], 
     ",", "\n", "\t", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"alignMechanism", "::", "number"}], "]"}], ";", " ", 
      "False"}]}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[582]:=",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"]
}, Closed]],

Cell[CellGroupData[{

Cell["congruentQ[]", "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"congruentQ", "[", 
    RowBox[{
     RowBox[{"m1_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"m2_", "?", "mechanismQ"}], ",", " ", "tolerance_"}], " ", "]"}],
    " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"congruentQ", "[", 
        RowBox[{
         RowBox[{"m1", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         RowBox[{"m2", "[", "\"\<positions\>\"", "]"}], ",", "tolerance"}], 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", "congruentQ"}]}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"congruentQ", "[", 
   RowBox[{
    RowBox[{"pos1_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "vertexCoordinatesQ"}], ",", " ", "tolerance_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"False", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "pos1", "]"}], " ", "\[NotEqual]", " ", 
    RowBox[{"Dimensions", "[", "pos2", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"congruentQ", "[", 
    RowBox[{
     RowBox[{"pos1_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"pos2_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tolerance", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{"#", " ", ">", " ", "0"}]}], "&"}], ")"}]}]}]}], " ", "]"}],
    " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"FindGeometricTransform", "[", " ", 
         RowBox[{"pos1", ",", " ", "pos2", ",", " ", 
          RowBox[{
          "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], ",", 
          " ", 
          RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ", 
         "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"newPos", " ", "=", " ", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", " ", "pos2", " ", "]"}]}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pos1", " ", "-", " ", "newPos"}], ")"}], " ", ".", " ", 
          RowBox[{"(", 
           RowBox[{"pos1", " ", "-", " ", "newPos"}], ")"}]}], " ", "<", " ", 
         
         RowBox[{"tolerance", "^", "2"}]}]}], "\n", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"congruentQ", "[", 
   RowBox[{
    RowBox[{"pos1_", "?", "vertexCoordinatesQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "vertexCoordinatesQ"}], ",", " ", "tolerance_", ",",
     " ", 
    RowBox[{"vertexList", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"False", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "pos1", "]"}], " ", "\[NotEqual]", " ", 
    RowBox[{"Dimensions", "[", "pos2", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"congruentQ", "[", 
    RowBox[{
     RowBox[{"pos1_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"pos2_", "?", "vertexCoordinatesQ"}], ",", " ", 
     RowBox[{"tolerance", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{"#", " ", ">", " ", "0"}]}], "&"}], ")"}]}]}], " ", ",", 
     " ", 
     RowBox[{"vertexList", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"FindGeometricTransform", "[", " ", 
         RowBox[{
          RowBox[{"pos1", "[", 
           RowBox[{"[", " ", "vertexList", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"pos2", "[", 
           RowBox[{"[", " ", "vertexList", " ", "]"}], "]"}], ",", " ", 
          RowBox[{
          "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], ",", 
          " ", 
          RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ", 
         "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"newPos", " ", "=", " ", 
          RowBox[{
           RowBox[{"res", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "[", " ", "pos2", " ", "]"}]}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pos1", " ", "-", " ", "newPos"}], ")"}], " ", ".", " ", 
          RowBox[{"(", 
           RowBox[{"pos1", " ", "-", " ", "newPos"}], ")"}]}], " ", "<", " ", 
         
         RowBox[{"tolerance", "^", "2"}]}]}], "\n", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pos1", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Max", "[", "vertexList", "]"}], " ", "\[LessEqual]", " ", 
      RowBox[{"Length", "[", "pos1", "]"}]}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"congruentQ", "[", "tolerance__", "]"}], "[", 
   RowBox[{"a_", ",", "b_"}], "]"}], " ", ":=", " ", 
  RowBox[{"congruentQ", "[", 
   RowBox[{"a", ",", "b", ",", "tolerance"}], "]"}]}]}], "Code",
 CellLabel->
  "In[594]:=",ExpressionUUID->"2b8c3072-deb2-4963-8d04-f459f5914cdd"]
}, Closed]],

Cell[CellGroupData[{

Cell["BoundingRegion[]", "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_framework", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<positions\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[600]:=",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionNearest[]", "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_framework", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionNearest", "[", " ", "f_framework", " ", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"RegionNearest", "[", " ", 
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", "f_origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[602]:=",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionMember[]", "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_framework", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionMember", "[", " ", "f_framework", " ", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"RegionMember", "[", " ", 
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", "f_origami", " ", "]"}], " ", "^:=", " ", 
  
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[606]:=",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionBounds[]", "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_framework", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_origami", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[610]:=",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomPoint[]", "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_framework", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_origami", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[612]:=",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionCentroid[]", "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_framework", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_origami", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "In[614]:=",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionDistance[], SignedRegionDistance[]", "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_framework", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[616]:=",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_framework", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[618]:=",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics/output", "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],

Cell[CellGroupData[{

Cell["plotDisplacement[]", "Subsection",ExpressionUUID->"04217e2e-b144-490c-abab-cc24a563308d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "plotDisplacement", "]"}], "=", 
   RowBox[{"Join", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<scale\>\"", "->", "1"}], ",", " ", 
       RowBox[{"\"\<arrowFunction\>\"", " ", "\[Rule]", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Arrow", "[", 
           RowBox[{"{", 
            RowBox[{"#1", ",", " ", "#2"}], "}"}], "]"}], "&"}], ")"}]}], ",",
        " ", 
       RowBox[{"\"\<arrowStyle\>\"", "\[Rule]", "Red"}]}], " ", "}"}], ",", 
     " ", 
     RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[620]:=",ExpressionUUID->"e5de9c33-e0a8-4208-9edb-de245aa9f157"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], " ", ",", " ", 
     RowBox[{"positionInput", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{
           RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
        ")"}]}], " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"displacement_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"globalScale", "=", 
        RowBox[{"Last", " ", "@", " ", 
         RowBox[{"BoundingRegion", "[", " ", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"embeddingDimension", "[", "m", "]"}], " ", "\[Equal]", 
              " ", "2"}], ",", "\"\<MinDisk\>\"", ",", "\"\<MinBall\>\""}], 
            "]"}]}], " ", "]"}]}]}], ",", "\n", "\t", 
       RowBox[{"graphics", "=", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"embeddingDimension", "[", "m", "]"}], " ", "\[Equal]", 
           " ", "2"}], ",", " ", "Graphics", ",", " ", "Graphics3D"}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"positionInput", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          "positionInput"}], " ", "]"}]}], ",", "\n", "\t", 
       RowBox[{"userScale", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", 
            RowBox[{"OptionValue", "[", "\"\<scale\>\"", "]"}], "]"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<scale\>\"", "]"}], ">", "0"}]}], 
          ",", " ", "\n", "\t\t", 
          RowBox[{"OptionValue", "[", "\"\<scale\>\"", "]"}], ",", " ", "\n", 
          "\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{"plotDisplacement", "::", "scale"}], "]"}], ";", " ", 
           "1"}]}], "\n", "\t", "]"}]}], ",", "\n", "\t", 
       RowBox[{"arrowFunction", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<arrowFunction\>\"", "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Show", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"plotMechanism", "[", 
         RowBox[{"m", ",", " ", "positions", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "opt", "}"}], ",", 
            RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}], " ", 
         "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{"MapThread", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"graphics", "[", 
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"OptionValue", "[", "\"\<arrowStyle\>\"", "]"}], ",", 
               " ", 
               RowBox[{"arrowFunction", "[", 
                RowBox[{"#1", ",", " ", 
                 RowBox[{"#1", " ", "+", " ", 
                  RowBox[{"userScale", " ", "globalScale", " ", "#2"}]}]}], 
                "]"}]}], "}"}]}], "]"}], "&"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"positions", ",", "displacement"}], "}"}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{"PlotRange", "\[Rule]", "All"}]}], "\n", "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"Dimensions", "[", "displacement", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"MeshCellCount", "[", 
          RowBox[{"m", ",", "0"}], "]"}], ",", 
         RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}], " ", 
       "\[Equal]", " ", 
       RowBox[{"Dimensions", "[", "positions", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "::", "scale"}], " ", "=", " ", 
   "\"\<Option \\\"scale\\\" is not a positive numeric value. Defaulting to \
1.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "::", "match"}], "=", 
   "\"\<Displacement does not have correct number of vertices or is not of \
the correct dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "::", "matchpos"}], "=", 
   "\"\<Positions do not have correct number of vertices or are not of the \
correct dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "::", "displ"}], "=", 
   "\"\<Displacement is not numeric and cannot be plotted.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacement", "::", "displ"}], "=", 
   "\"\<Positions are not numeric and cannot be plotted.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"plotDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "positions_", ",", " ", 
    "displacement_", ",", " ", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{
         RowBox[{"N", "[", "positions", "]"}], ",", "NumericQ"}], "]"}], " ", 
       "||", " ", 
       RowBox[{"positions", " ", "===", " ", "Automatic"}]}], "]"}], ",", 
     "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"plotDisplacement", "::", "pos"}], "]"}], ";", " ", "False"}], 
     ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"MatrixQ", "[", 
       RowBox[{
        RowBox[{"N", "[", "displacement", "]"}], ",", "NumericQ"}], "]"}], 
      "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"plotDisplacement", "::", "displ"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Dimensions", "[", "displacement", "]"}], "\[NotEqual]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MeshCellCount", "[", 
         RowBox[{"m", ",", "0"}], "]"}], ",", 
        RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}], ",", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"plotDisplacement", "::", "match"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Dimensions", "[", "positions", "]"}], "\[NotEqual]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MeshCellCount", "[", 
         RowBox[{"m", ",", "0"}], "]"}], ",", 
        RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}], ",", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"plotDisplacement", "::", "matchpos"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", " ", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[621]:=",ExpressionUUID->"58062daf-5fe8-4b9b-993e-402d18f21d7a"]
}, Closed]],

Cell[CellGroupData[{

Cell["angleMarker[], angleText[]", "Subsection",ExpressionUUID->"2c80579a-c9ea-4023-b2bf-bcf398290f97"],

Cell[BoxData[
 RowBox[{
  RowBox[{"angleText", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"label_", " ", ":", " ", "\"\<\>\""}], ",", 
    RowBox[{"distance", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", "0"}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"angleLocation", "=", 
       RowBox[{
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"v2", ",", 
          RowBox[{"1", ";;", 
           RowBox[{"displayDimension", "[", "m", "]"}]}]}], "]"}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"vectors", "=", 
       RowBox[{"-", 
        RowBox[{
         RowBox[{"displacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v3", ",", "v2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v1", ",", "v2"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", 
            RowBox[{"displayDimension", "[", "m", "]"}]}]}], "]"}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Text", "[", 
     RowBox[{"label", ",", 
      RowBox[{"angleLocation", " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"distance", "+", "0.12"}], ")"}], " ", 
        RowBox[{"Mean", "[", "vectors", "]"}]}]}]}], "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[628]:=",ExpressionUUID->"22eef36c-01a6-4184-b4f4-8a062ba1c7f6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"angleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
         " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
       "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"v2", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{
         RowBox[{"displacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v2", ",", "v1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Circle", "[", 
      RowBox[{"angleLocation", ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Abs", "[", "radius", "]"}], " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "<", 
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"2", "Pi"}]}], "}"}], "+", "#"}], ",", "#"}], "]"}], 
          "&"}], ")"}], "[", 
        RowBox[{"ArcTan", "@@@", "vectors"}], "]"}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"displayDimension", "[", "m", "]"}], "\[Equal]", "2"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "In[629]:=",ExpressionUUID->"ab1e67a8-ea5d-4cbf-8c48-2af8c388a741"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Code", " ", "borrowed", " ", "from", " ", 
     RowBox[{"https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "10957"}], "/", "an"}], "-", "efficient", "-", 
     "circular", "-", "arc", "-", "primitive", "-", "for", "-", 
     "graphics3d"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "splineCircle2", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"splineCircle", "[", 
     RowBox[{"m_List", ",", " ", "r_", ",", " ", 
      RowBox[{"angles_List", ":", " ", 
       RowBox[{"{", 
        RowBox[{"0.", ",", " ", 
         RowBox[{"2.", " ", "\[Pi]"}]}], "}"}]}]}], "]"}], " ", ":=", " ", 
    "\n", " ", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "seg", ",", " ", "\[Phi]", ",", " ", "start", ",", " ", "end", ",", 
         " ", "pts", ",", " ", "w", ",", " ", "k", ",", " ", "pihalf"}], 
        "}"}], ",", "\n", "   ", 
       RowBox[{
        RowBox[{"pihalf", " ", "=", " ", 
         RowBox[{"0.5", " ", "\[Pi]"}]}], ";", "\n", "   ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"start", ",", " ", "end"}], "}"}], " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", "angles", "]"}], ",", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"end", " ", "<=", " ", "start"}], ",", " ", 
          RowBox[{"end", " ", "+=", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}]}], "]"}], ";", "\n", "   ", 
        RowBox[{"seg", " ", "=", " ", 
         RowBox[{"Quotient", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"\[Phi]", " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"seg", " ", "==", " ", "4"}], ",", " ", 
          RowBox[{
           RowBox[{"seg", " ", "=", " ", "3"}], ";", " ", 
           RowBox[{"\[Phi]", " ", "=", " ", "pihalf"}]}]}], "]"}], ";", "\n", 
        "   ", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "     ", 
           RowBox[{
            RowBox[{"cseg", " ", "=", " ", 
             RowBox[{"Cos", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", " ", 
            RowBox[{"sseg", " ", "=", " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"c\[Phi]", " ", "=", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ",", " ", 
            RowBox[{"s\[Phi]", " ", "=", " ", 
             RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", " ", "\n", "     ", 
            RowBox[{"t\[Phi]", " ", "=", " ", 
             RowBox[{"Tan", "[", 
              RowBox[{"0.5", " ", "\[Phi]"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"rcs", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Cos", "[", "start", "]"}]}]}], ",", " ", 
            RowBox[{"rss", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Sin", "[", "start", "]"}]}]}]}], "\n", "     ", "}"}], 
          ",", "\n", "    ", 
          RowBox[{"pts", " ", "=", " ", 
           RowBox[{
            RowBox[{"Join", "[", "\n", "       ", 
             RowBox[{
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}]}], "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], 
              ",", "\n", "       ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"cseg", " ", "-", " ", 
                   RowBox[{"sseg", " ", "t\[Phi]"}]}], ",", " ", 
                  RowBox[{"sseg", " ", "+", " ", 
                   RowBox[{"cseg", " ", "t\[Phi]"}]}]}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cseg", " ", "c\[Phi]"}], " ", "-", " ", 
                   RowBox[{"sseg", " ", "s\[Phi]"}]}], ",", " ", 
                  RowBox[{
                   RowBox[{"c\[Phi]", " ", "sseg"}], " ", "+", " ", 
                   RowBox[{"cseg", " ", "s\[Phi]"}]}]}], "}"}]}], "}"}]}], 
             "\n", "       ", "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"rcs", ",", " ", "rss"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "rss"}], ",", " ", "rcs"}], "}"}]}], "}"}]}]}]}],
          "\n", "    ", "]"}], ";", "\n", "   ", 
        RowBox[{"pts", " ", "=", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Length", "[", "pts", "]"}]}], "]"}], " ", "+", " ", "\n",
           "     ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], ",", 
            " ", "\n", "      ", "pts", ",", " ", "\n", "      ", 
            RowBox[{"Join", "[", 
             RowBox[{"pts", ",", " ", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{
                RowBox[{"{", "0.", "}"}], ",", " ", 
                RowBox[{"Length", "[", "pts", "]"}]}], "]"}], ",", " ", "2"}],
              "]"}]}], "\n", "     ", "]"}]}]}], ";", "\n", "   ", 
        RowBox[{"w", " ", "=", " ", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c", " ", "=", " ", 
             RowBox[{"1.", "/", 
              RowBox[{"Sqrt", "[", "2.", "]"}]}]}], "}"}], ",", " ", "\n", 
           "     ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "1.", ",", " ", "c", ",", " ", "1.", ",", " ", "c", ",", " ", 
                 "1.", ",", " ", "c", ",", " ", "1."}], "}"}], ",", " ", 
               RowBox[{
                RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], ",",
              " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"0.5", " ", "\[Phi]"}], "]"}], ",", " ", "1."}], 
              "}"}]}], "]"}]}], "\n", "     ", "]"}]}], ";", "\n", "   ", 
        RowBox[{"k", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Riffle", "[", 
              RowBox[{"#", ",", " ", "#"}], "]"}], " ", "&"}], "@", 
            RowBox[{"Range", "[", 
             RowBox[{"seg", " ", "+", " ", "1"}], "]"}]}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"seg", " ", "+", " ", "1"}], "}"}]}], "]"}]}], ";", "\n", 
        "   ", 
        RowBox[{"BSplineCurve", "[", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"SplineDegree", " ", "->", " ", "2"}], ",", " ", 
          RowBox[{"SplineKnots", " ", "->", " ", "k"}], ",", " ", 
          RowBox[{"SplineWeights", " ", "->", " ", "w"}]}], "]"}]}]}], "\n", 
      "   ", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], " ", "||", 
      " ", 
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "3"}]}]}]}], "\n", 
   " ", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "circleFromPoints", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"arc", " ", "->", " ", "False"}], "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"circleFromPoints", "[", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"q1_", ",", " ", "q2_", ",", " ", "q3_"}], "}"}]}], ",", " ", 
      
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "c", ",", " ", "r", ",", " ", "\[Phi]1", ",", " ", "\[Phi]2", ",", 
         " ", "p1", ",", " ", "p2", ",", " ", "p3", ",", " ", "h", ",", " ", 
         "\n", "        ", 
         RowBox[{"rot", " ", "=", " ", 
          RowBox[{
           RowBox[{"Quiet", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}], ",", " ", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"#1", " ", "-", " ", "#2"}], ",", " ", 
                  RowBox[{"#3", " ", "-", " ", "#2"}]}], "]"}]}], "}"}], 
              "]"}], ",", 
             RowBox[{"RotationMatrix", "::", "spln"}]}], "]"}], " ", 
           "&"}]}]}], "}"}], ",", "\n", "  ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "}"}], ".", 
          RowBox[{"rot", "[", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}]}]}], ";", 
        "\n", "  ", 
        RowBox[{"h", " ", "=", " ", 
         RowBox[{"p1", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", 
            RowBox[{";;", " ", "2"}]}], "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"c", ",", " ", "r"}], "}"}], " ", "=", " ", 
         RowBox[{"List", " ", "@@", " ", 
          RowBox[{"Circumsphere", "[", 
           RowBox[{"{", 
            RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "]"}]}]}], 
        ";", "\n", "  ", 
        RowBox[{"\[Phi]1", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p3", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"\[Phi]2", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p1", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", " ", "h"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"OptionValue", "[", "arc", "]"}], " ", "//", " ", 
           "TrueQ"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r", ",", " ", 
              RowBox[{"{", 
               RowBox[{"\[Phi]1", ",", " ", "\[Phi]2"}], "}"}]}], "]"}], ",", 
            " ", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r"}], "]"}], ",", " ", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "\n", "  ", "]"}]}]}], "\n", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"m", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Dimensions", "[", "m", "]"}], " ", "==", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", " ", "3"}], "}"}]}]}]}]}]}]}]], "Code",
 CellLabel->
  "In[630]:=",ExpressionUUID->"af45631a-f570-480f-9684-dbbf41a91605"],

Cell[BoxData[
 RowBox[{
  RowBox[{"angleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
          " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
        "*)"}], "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{"displacementVector", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"v2", ",", "v1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"circleFromPoints", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"vectors", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"vectors", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/", 
            RowBox[{"Sqrt", "[", "2", "]"}]}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], ",", 
       RowBox[{"arc", " ", "\[Rule]", "True"}]}], "]"}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{
     RowBox[{"displayDimension", "[", "m", "]"}], "\[Equal]", "3"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{"m", ",", "0"}], "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "In[634]:=",ExpressionUUID->"09182b61-089e-491b-bc71-1654808d915d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"angleMarker", "::", "bounds"}], "=", 
   "\"\<Vertices are out of bounds.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"angleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}]}], 
   "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"angleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"angleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"angleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"angleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_", ",", 
    RowBox[{"_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"angleMarker", "::", "bounds"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[635]:=",ExpressionUUID->"d18c3dfb-7910-49e5-9f90-650f5ac32782"]
}, Closed]],

Cell[CellGroupData[{

Cell["saveToFOLD[], loadFromFOLD[]", "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],

Cell["\<\
Save the mechanism using the .fold specification \
(https://github.com/edemaine/fold/blob/master/doc/spec.md)\
\>", "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"incrementVertices", "[", "d_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "+", "1"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"decrementVertices", "[", "d_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "-", "1"}], "&"}], "/@", "d"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"surfaceQ", "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"AllTrue", "[", " ", 
    RowBox[{
     RowBox[{"Length", " ", "/@", " ", 
      RowBox[{"connectivity", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
       " ", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"#", " ", "\[LessEqual]", " ", "2"}], "&"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"saveToFOLD", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], " ", ",", " ", "filename_String"}], 
   " ", "]"}], ":=", "\n", 
  RowBox[{"Export", "[", 
   RowBox[{"filename", ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
      "\"\<file_spec\>\"", " ", "\[Rule]", " ", "$mechanismsVersion"}], ",", 
      "\n", "\t", 
      RowBox[{
      "\"\<file_creator\>\"", " ", "\[Rule]", " ", "\"\<mechanisms\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<file_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<singleModel\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<creasePattern\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_attributes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Switch", "[", " ", 
          RowBox[{
           RowBox[{"displayDimension", "[", "m", "]"}], ",", " ", "2", ",", 
           " ", "\"\<2D\>\"", ",", " ", "3", ",", " ", "\"\<3D\>\"", ",", "_",
            ",", " ", "Nothing"}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "m", "]"}], "===", 
            RowBox[{"origami", " ", ">", " ", "0"}]}], ",", " ", 
           "\"\<manifold\>\"", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"orientedQ", "[", " ", "m", " ", "]"}], ",", " ", 
           "\"\<orientable\>\"", ",", " ", "\"\<nonOrientable\>\""}], " ", 
          "]"}]}], "\n", "\t", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_unit\>\"", " ", "\[Rule]", " ", "\"\<unit\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<vertices_coords\>\"", " ", "\[Rule]", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<edges_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"connectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"\"\<faces_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"listFaces", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\"\<JSON\>\""}], "]"}]}]}], "Code",
 CellLabel->
  "In[639]:=",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "loadFromFOLD", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"\"\<face\>\"", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"face", "[", "#", "]"}], "&"}], ")"}]}], "}"}], ",", " ", 
      RowBox[{"Options", "[", "origami", "]"}]}], " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"loadFromFOLD", "[", 
   RowBox[{"filename_String", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"inputData", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", "\"\<JSON\>\""}], "]"}]}], ",", "\n", "\t", 
      "coords", ",", "edges", ",", "faces"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"inputData", " ", "===", " ", "$Failed"}], ",", "\n", "\t\t", 
      "$Failed", ",", "\n", "\n", "\t\t", 
      RowBox[{
       RowBox[{"coords", "=", 
        RowBox[{"\"\<vertices_coords\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"edges", "=", 
        RowBox[{"\"\<edges_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"faces", "=", 
        RowBox[{"\"\<faces_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\n", "\t\t", 
       RowBox[{"origami", "[", " ", 
        RowBox[{"coords", ",", " ", 
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\"\<face\>\"", "]"}], " ", "/@", " ", 
           
           RowBox[{"incrementVertices", " ", "/@", " ", "faces"}]}], "]"}], 
         ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "origami", "]"}]}], "]"}]}], " ", 
        "]"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[643]:=",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[645]:=",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanisms`rigidity: rigidity and linkage functions", "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<mechanisms`rigidity`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[647]:=",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"toFramework", "::", "usage"}], "=", "\n", 
    "\"\<toFramework[ obj ] attempts to create a framework from some other \
object (e.g. Graph[], MeshRegion[], etc.).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomCellNetwork", "::", "usage"}], "=", 
    "\"\<randomCellNetwork[n] returns a random network of cells that can be \
tesselated in 2D.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomTriangulatedNetwork", "::", "usage"}], "=", 
    "\"\<randomTriangulatedNetwork[n] returns a random triangulated network \
that can be tesselated in 2D.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Henneberg", "::", "usage"}], "=", 
   "\"\<Henneberg[1][vertices, label -> pos] is an Henneberg operation of \
type 1 that creates a new vertex at a position and attaches it to vertices.\n\
Henneberg[2][ {v1,v2,v3},label -> pos] is a Henneberg operation of type 2 \
that subdivides an edge {v1,v2} and places the new vertex and connects it to \
vertex v3.\nHenneberg[t][pos] is a random Henneberg operation of type t, \
placing the new vertex at position pos.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[648]:=",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"cellData", "::", "usage"}], " ", "=", " ", 
   "\"\<cellData[ m, cellType, dataType ] returns the equilibrium data of a \
certain type for a certain cell type.\ncellData[ m, positions, cellType, \
dataType ] uses provided vertex positions to compute equilibrium data where \
not specified explicitly.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[652]:=",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"constraintEquations", "::", "usage"}], "=", "\n", 
    "\"\<constraintEquations[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\
\"]\)(, \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)), \
\!\(\*StyleBox[\"order\",FontSlant->\"Italic\"]\)] returns constraint \
equations valid to some order in the displacements.\n\
\!\(\*StyleBox[\"order\",FontSlant->\"Italic\"]\) should be 1, 2 or Infinity. \
Use option \\\"constraints\\\" to set additional constraints.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"mechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<mechanismEnergy[ \!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\
\) ] returns an energy expression for a mechanism.\nmechanismEnergy[ \
\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\) ] returns an energy \
expression for vertices at arbitrary positions but using the provided \
positions to determine equilibrium parameters where necessary.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compiledMechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<compiledMechanismEnergy[ \
\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\) ] compiles an energy \
and gradient for a mechanism.\ncompiledMechanismEnergy[ \
\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\) ] compiles an energy and gradient for a mechanism starting from a set of \
positions.\n\nUndefined symbols in the energy must be set using ReplaceAll[].\
\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compiledMechanismEnergyQ", "::", "usage"}], "=", "\n", 
    "\"\<compiledMechanismEnergyQ[ energy ] returns True if and only if \
energy is a compiledMechanismEnergy[] object.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "::", "usage"}], "=", 
   "\"\<$defaultStiffness[\!\(\*StyleBox[\"component\",FontSlant->\"Italic\"]\
\)] returns the default stiffness in case the constraint is rigid.\nUse \
$defaultStiffness[\\\"constraints\\\"] to find the stiffness of added \
constraints.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[653]:=",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"constraintMatrix", "::", "usage"}], "=", 
    "\"\<constraintMatrix[ m ] returns a constraint matrix for the \
first-order constraints.\nconstraintMatrix[ m, positions ] returns a \
constraint matrix using positions to determine matrix element.\n\nOptions: \\\
\"constraints\\\" to add additional constraints, \\\"pattern\\\" to restrict \
which components will provide constraints, \\\"rules\\\" eliminates variables \
from the constraint matrix.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"zeroModes", "::", "usage"}], "=", 
    "\"\<zeroModes[m] returns a list of numerical zero modes (linear \
isometries) associated with the constraints of mechanism m.\n\nIt takes the \
options of constraintMatrix[] and Eigensystem. Option Tolerance can be used \
to set a numerical value to correspond to 0.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"selfStresses", "::", "usage"}], "=", 
    "\"\<selfStresses[m] returns a list of numerical self-stresses () modes \
associated with the constraints of mechanism m.\n\nIt takes the options of \
constraintMatrix[] and Eigensystem. Option Tolerance can be used to set a \
numerical value to correspond to 0.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"infinitesimalMotions", "::", "usage"}], "=", "\n", 
    "\"\<infinitesimalMotions[\!\(\*StyleBox[\\\"mechanism\\\",FontSlant->\\\"\
Italic\\\"]\)(, \
\!\(\*StyleBox[\\\"positions\\\",FontSlant->\\\"Italic\\\"]\))] returns a \
list of two elements: an infinitesimal linear motion and, if necessary, a \
list of quadratic constraints they must satisfy.\n\nUse option \
\\\"variables\\\" to control the form of the output.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stressMatrix", "::", "usage"}], "=", "\n", 
   "\"\<stressMatrix[ m, vec ] returns a stress matrix associated with the \
stress vector vec. The (i,j) component of the stress matrix is the negative \
of the corresponding stress vector component (and zero otherwise) and \
diagonal components are chosen so that rows and columns sum to zero.\n\n(see \
Connelly on generic global rigidity)\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[658]:=",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"minimizeEnergy", "::", "usage"}], "=", "\n", 
    "\"\<minimizeEnergy[\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)], minimizeEnergy[ \
\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\) ] minimizes the energy of \
a mechanism, returning {\!\(\*StyleBox[\"minimum\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"mininal\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\n\nThe optional argument \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)can be either an expression or a compiled \
mechanism energy.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"repeatedMinimizeEnergy", "::", "usage"}], "=", "\n", 
    "\"\<repeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\"\
Italic\"]\), \!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"number\",FontSlant->\"Italic\"]\)] minimizes the energy \
number times using random initial conditions.\n\
repeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\),\
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\),\!\(\*StyleBox[\"number\",\
FontSlant->\"Italic\"]\),\!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"value\",FontSlant->\
\"Italic\"]\)] uses a numeric test value to determine if two vertex positions \
are the same.\n\
repeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\),\
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\),\!\(\*StyleBox[\"number\",\
FontSlant->\"Italic\"]\),\!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"function\",FontSlant->\"Italic\"]\
\)] uses a test function to determine if two vertex positions are the same.\>\
\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"tallyRepeatedMinimizeEnergy", "::", "usage"}], "=", "\n", 
    "\"\<tallyRepeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\
\"Italic\"]\), \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"number\",FontSlant->\"Italic\"]\)]\
 minimizes the energy number times using random initial conditions and \
tallies the results.\n\
tallyRepeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"\
]\),energy,\!\(\*StyleBox[\"number\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\
,\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"value\",FontSlant->\"Italic\"]\)] \
uses a numeric test value to determine if two vertexPositions are the same.\n\
tallyRepeatedMinimizeEnergy[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"\
]\),energy,\!\(\*StyleBox[\"number\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\
,\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"function\",FontSlant->\"Italic\"]\
\)] uses a test function to determine if two vertexPositions are the \
same.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"dynamicalSystem", "::", "usage"}], "=", "\n", 
    "\"\<dynamicalSystem[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\"initial\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\
\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"initial\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"velocities\",FontSlant->\"Italic\"\
]\)\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"variable\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\)] returns a list of functions \
specifying how vertices will move as a function of \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\).\n\nUse options \\\"mass\\\" \
and \\\"drag\\\" to set the mass and drag coefficient for the \
particles.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "::", "usage"}], "=", "\n", 
   "\"\<dynamicalSystemEquations[\!\(\*StyleBox[\"mech\",FontSlant->\"Italic\"\
]\), {\!\(\*StyleBox[\"variable\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\)}] returns dynamical \
equations for vertex positions, using \!\(\*StyleBox[\"variable\",FontSlant->\
\"Italic\"]\) as vertex names, and \
\!\(\*StyleBox[\"time\",FontSlant->\"Italic\"]\) as the symbol for time.\n\n\
Use options \\\"mass\\\" and \\\"drag\\\" to set the mass and drag \
coefficient for the particles.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[663]:=",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"isometricTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<isometricTrajectory[\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\
\"]\), \!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",\
FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] creates a trajectory using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) steps through the configuration \
space of a mechanism starting in the\ndisplacement direction \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\). Each step is specified by the \
option \\\"stepMethod\\\" using options \\\"stepOptions\\\".\n\n\
isometricTrajectory[mechanism, direction, {variable, start, end}] attempts to \
find an isometric trajectory for a system with one degree of freedom.\n\
\!\(\*StyleBox[\"direction\",FontSlant->\"Italic\"]\) is either +1 or -1. It \
returns a list of InterpolatingFunctions as a function of \
\!\(\*StyleBox[\"variable\",FontSlant->\"Italic\"]\) representing the \
positions of the vertices.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findMinimalTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<findMinimalTrajectory[\!\(\*StyleBox[\"mechanism\",FontSlant->\"\
Italic\"]\), \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] attempts to find a valid \
trajectory from \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\) to \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\) configurations using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) intermediate steps.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"genericGloballyRigidQ", "::", "usage"}], "=", "\n", 
    "\"\<genericGloballyRigidQ[m] returns True if it can be determined that \
the system is generically globally rigid according to Connelly's criteria \
based on the stress matrix.\nIf it returns True, the specific mechanism may \
still be non-rigid.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"genericDOF", "::", "usage"}], "=", 
   "\"\<genericDOF[ mechanism ] measures the dimension of the configuration \
space in a generic mechanism. The actual number of dimensions for specific \
configurations may differ.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[668]:=",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotStress", "::", "usage"}], "=", 
   "\"\<plotStress[ m, edges, stresses ] plots a mechanism with edge stresses \
denoted by double-headed arrows.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[672]:=",ExpressionUUID->"7b07195b-81ae-4c6b-b53b-c12da7b91d15"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data", "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`geometry`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[673]:=",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"]
}, Open  ]],

Cell[CellGroupData[{

Cell["private rigidity functions", "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],

Cell[CellGroupData[{

Cell["linearMotions[]", "Subsection",ExpressionUUID->"99d232f2-b91d-458c-a3db-d922760b95e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "linearMotions", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "NullSpace", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"linearMotions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "rigidityMatrix_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"embeddingDimension", "[", "m", "]"}]}], ",", " ", 
      RowBox[{"lin", " ", "=", " ", 
       RowBox[{"NullSpace", "[", 
        RowBox[{"rigidityMatrix", ",", "opt"}], "]"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "lin", "]"}], ">", "0"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Partition", "[", " ", 
        RowBox[{
         RowBox[{"Orthogonalize", "[", "lin", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", "dim"}], "}"}]}], " ", "]"}], "[", 
       RowBox[{"[", " ", 
        RowBox[{"All", ",", " ", "All", ",", " ", "1"}], " ", "]"}], "]"}], 
      ",", "\n", "\t\t", 
      RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[676]:=",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],

Cell[CellGroupData[{

Cell["numericExpressionQ[]", "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "does", " ", "an", " ", "expression", " ", "evaluate", " ", "to", " ", "a",
     " ", "number", " ", "if", " ", "the", " ", "vertex", " ", "positions", 
    " ", "or", " ", "displacements", " ", "are", " ", 
    RowBox[{"set", "?"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"numericExpressionQ", "[", 
    RowBox[{"positions_", ",", " ", "expression_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reducedExpression", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], "[", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"expression", " ", "/.", " ", 
            RowBox[{"positionRules", "[", " ", 
             RowBox[{"N", "[", "positions", "]"}], " ", "]"}]}], " ", "/.", 
           " ", 
           RowBox[{
            RowBox[{"vertexDisplacement", "[", 
             RowBox[{"_", ",", "_"}], "]"}], "\[Rule]", "0.001"}]}], "}"}], 
         " ", "]"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"NumericQ", "[", "reducedExpression", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{"Im", "[", "reducedExpression", "]"}], "]"}], "\[Equal]", 
       "0"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "In[678]:=",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseExpression[]", "Subsection",ExpressionUUID->"8488fe5a-cff7-4dfa-ac4b-5654c56b2c7f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"foldAngle", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"displacementLength", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"parseValidTokenQ", "[", 
   RowBox[{"displacementLengthSquared", "[", 
    RowBox[{"{", 
     RowBox[{"_Integer", ",", "_Integer"}], "}"}], "]"}], "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseValidTokenQ", "[", "_", "]"}], ":=", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseExtractTokens", "[", "expr_", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rawTokens", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Variables", "[", "expr", "]"}], ",", "parseValidTokenQ"}], 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], "/@", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"rawTokens", ",", "Head"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"foldAngle", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"foldAngle", "/@", "data"}], ")"}], " ", "\[Rule]", " ", 
    RowBox[{"foldAngle", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"displacementLength", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"displacementLength", "/@", "data"}], ")"}], " ", "\[Rule]", " ", 
    RowBox[{"displacementLength", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseEvaluateTokens", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"displacementLengthSquared", "[", "data_", "]"}]}], "]"}], ":=", 
  RowBox[{"Thread", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"displacementLengthSquared", "/@", "data"}], ")"}], " ", 
    "\[Rule]", " ", 
    RowBox[{"displacementLengthSquared", "[", 
     RowBox[{"m", ",", "positions", ",", "data"}], "]"}]}], "]"}]}]}], "Code",\

 CellLabel->
  "In[679]:=",ExpressionUUID->"379532fc-ab3b-4100-8b5e-6183b7f55947"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"parseComponentData", "[", 
    RowBox[{"m_", ",", "positions_", ",", 
     RowBox[{"rigidBar", "[", 
      RowBox[{"indices_", ",", "data_"}], "]"}]}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"lengths", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Automatic"}], ",", "#1", ",", "#2"}], 
            "]"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"displacementLength", "[", 
             RowBox[{"positions", ",", "indices"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"stiffnesses", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"length", "/@", "indices"}], ")"}], "\[Rule]", "lengths"}], 
        "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"length", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "lengths"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lengthSquared", "/@", "indices"}], ")"}], "\[Rule]", 
         RowBox[{"lengths", "^", "2"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lengthSquared", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         RowBox[{"lengths", "^", "2"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"stiffness", "/@", "indices"}], ")"}], "\[Rule]", 
         "stiffnesses"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"stiffness", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "stiffnesses"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseComponentData", "[", 
    RowBox[{"m_", ",", "positions_", ",", 
     RowBox[{"foldAngle", "[", 
      RowBox[{"indices_", ",", "data_"}], "]"}]}], "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles", "=", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#2", "===", "Automatic"}], ",", "#1", ",", "#2"}], 
            "]"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"displacementLength", "[", 
             RowBox[{"positions", ",", "indices"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"torsionalStiffnesses", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angle", "/@", "indices"}], ")"}], "\[Rule]", "angles"}], 
        "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angle", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "angles"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"torsionalStiffness", "/@", "indices"}], ")"}], "\[Rule]", 
         "torsionalStiffnesses"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"torsionalStiffness", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "/@", "indices"}], ")"}]}], ")"}], "\[Rule]", 
         "torsionalStiffnesses"}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseComponentData", "[", 
   RowBox[{"m_", ",", "positions_", ",", "_"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[687]:=",ExpressionUUID->"2e6066e1-9346-4cd8-aed9-3d85923df3d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"parseExpression", "[", 
   RowBox[{"m_", ",", "positions_", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"parsingRules", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"parseComponentData", "[", 
            RowBox[{"m", ",", "positions", ",", "#"}], "]"}], "&"}], "/@", 
          RowBox[{"m", "[", "\"\<components\>\"", "]"}]}], ",", "\n", "\t\t", 
         
         RowBox[{
          RowBox[{
           RowBox[{"parseEvaluateTokens", "[", 
            RowBox[{"m", ",", 
             RowBox[{"vertexPosition", "[", "m", "]"}], ",", "#"}], "]"}], 
           "&"}], "/@", 
          RowBox[{"parseExtractTokens", "[", "expr", "]"}]}]}], "\n", "\t", 
        "}"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"expr", "//.", 
     RowBox[{"Dispatch", "[", "parsingRules", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[690]:=",ExpressionUUID->"1215db5f-4226-4914-976f-95e9ec2bdd56"]
}, Closed]],

Cell[CellGroupData[{

Cell["constraintVector[], reduceConstraintToOrder[]", "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"get", " ", "a", " ", "set", " ", "of", " ", "user"}], "-", 
    RowBox[{
    "specified", " ", "constraints", " ", "into", " ", "the", " ", "form", 
     " ", "of", " ", "a", " ", "vector", " ", "equal", " ", "to", " ", "zero",
      " ", "when", " ", "constraints", " ", "are", " ", "satisfied"}]}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"constraintVector", "[", 
     RowBox[{"positions_", ",", "None"}], "]"}], ":=", 
    RowBox[{"{", "}"}]}], "\n", 
   RowBox[{
    RowBox[{"constraintVector", "[", 
     RowBox[{"positions_", ",", "constraints_"}], "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"equations", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"equationToExpression", "[", "constraints", "]"}], "}"}], 
          "]"}]}], ",", "\n", 
        RowBox[{"dimensions", "=", 
         RowBox[{"Dimensions", "[", "positions", "]"}]}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"equations", " ", "/.", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"displacementRules", "[", " ", 
         RowBox[{
          RowBox[{"vertexPosition", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
            RowBox[{"All", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], " ", "]"}], " ", "-", 
          " ", "positions"}], "]"}], "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"equationToExpression", "[", 
     RowBox[{"Equal", "[", 
      RowBox[{"a_", ",", "b_"}], "]"}], "]"}], ":=", 
    RowBox[{"a", "-", "b"}]}], "\n", 
   RowBox[{
    RowBox[{"equationToExpression", "[", 
     RowBox[{"Equal", "[", 
      RowBox[{"a_", ",", "b__"}], "]"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"a", ",", 
       RowBox[{"Length", "[", 
        RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "-", 
     RowBox[{"{", "b", "}"}]}]}], "\n", 
   RowBox[{
    RowBox[{"equationToExpression", "[", 
     RowBox[{"a", ":", 
      RowBox[{"Except", "[", "_Equal", "]"}]}], "]"}], ":=", "a"}], "\n", 
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"equationToExpression", ",", "Listable"}], "]"}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[691]:=",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "express", " ", "the", " ", "constraints", " ", "to", " ", "be", " ", 
    "valid", " ", "at", " ", "a", " ", "certain", " ", "order"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"positions_", ",", "constraintVector_", ",", 
      RowBox[{"order_Integer", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">=", "0"}], "&"}], ")"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"dimensions", "=", 
         RowBox[{"Dimensions", "[", "positions", "]"}]}], ",", "\n", 
        "expandedExpression", ",", "x"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"expandedExpression", " ", "=", " ", 
        RowBox[{"constraintVector", " ", "/.", " ", 
         RowBox[{"Dispatch", "[", " ", 
          RowBox[{"positionRules", "[", " ", 
           RowBox[{"positions", " ", "+", " ", 
            RowBox[{"x", " ", 
             RowBox[{"vertexDisplacement", "[", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
               RowBox[{"All", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}]}], "]"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Total", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"expandedExpression", ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "#"}], "}"}]}], "]"}], "/", 
            RowBox[{"Factorial", "[", "#", "]"}]}], "&"}], " ", "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "order"}], "]"}]}], " ", "/.", " ", 
         RowBox[{"x", "\[Rule]", "0"}]}], "]"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"positions_", ",", "constraintVector_", ",", "_"}], "]"}], ":=", 
    "constraintVector"}]}]}]], "Code",
 CellLabel->
  "In[697]:=",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
solveLinearConstraints[], dynamicVariables[], processConstraintEquations[], \
nonlinearConstraintVector[]\
\>", "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Fastest", " ", "way", " ", "to", " ", "pull", " ", "out", " ", 
    "equations", " ", "that", " ", "are", " ", "definitely", " ", "linear", 
    " ", "and", " ", "can", " ", "be", " ", "solved", " ", "explicitly"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"linearEquationQ", "[", 
     RowBox[{"eq_", ",", "var_"}], "]"}], ":=", 
    RowBox[{"VectorQ", "[", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"eq", ",", 
        RowBox[{"{", "var", "}"}]}], "]"}], ",", "NumericQ"}], "]"}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"given", " ", "a", " ", "set", " ", "constraints"}], ",", " ", 
     RowBox[{
     "select", " ", "out", " ", "the", " ", "linear", " ", "ones", " ", "and",
       " ", "solve", " ", 
      RowBox[{"them", "."}]}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"solveLinearEquations", "[", 
     RowBox[{"constraintVec_", ",", " ", "var_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "soln", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Quiet", "[", " ", 
        RowBox[{"soln", " ", "=", " ", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", " ", 
             RowBox[{"constraintVec", ",", " ", 
              RowBox[{
               RowBox[{"linearEquationQ", "[", 
                RowBox[{"#", ",", " ", "var"}], "]"}], "&"}]}], " ", "]"}], 
            " ", "\[Equal]", " ", "0"}], ",", " ", "var"}], " ", "]"}]}], " ",
         "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "soln", "]"}], " ", "=!=", " ", "Solve"}], ",",
          " ", 
         RowBox[{"soln", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[699]:=",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"processConstraintEquations", "[", " ", 
    RowBox[{
     RowBox[{"initial", " ", "positions"}], ",", " ", 
     RowBox[{"constraint", " ", "equations"}]}], " ", "]"}], "\n", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"processConstraintEquations", "[", 
     RowBox[{"positions_", ",", " ", "constraintEq_"}], "]"}], " ", ":=", " ",
     "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"constraints", " ", "=", " ", 
         RowBox[{"constraintVector", "[", " ", 
          RowBox[{"positions", ",", " ", "constraintEq"}], " ", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"Array", "[", " ", 
           RowBox[{"vertexPosition", ",", " ", 
            RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}]}], 
        ",", "\n", "\t", "linearEquationSelector", ",", "\n", "\t", 
        "solvedLinearConstraints", ",", "\n", "\t", "constrainedPositions"}], 
       "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"linearEquationSelector", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"linearEquationQ", "[", 
           RowBox[{"#", ",", " ", "vars"}], "]"}], "&"}], " ", "/@", " ", 
         "constraints"}]}], ";", "\n", "\t", 
       RowBox[{"solvedLinearConstraints", " ", "=", " ", 
        RowBox[{"Quiet", "[", " ", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Pick", "[", " ", 
             RowBox[{"constraints", ",", " ", "linearEquationSelector"}], " ",
              "]"}], " ", "\[Equal]", " ", "0"}], ",", " ", "vars"}], " ", 
          "]"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "solvedLinearConstraints", "]"}], " ", "===", 
          " ", "Solve"}], ",", "\n", "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"\"\<linear solutions\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", " ", "\n", "\t\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Array", "[", 
             RowBox[{"vertexPosition", ",", " ", 
              RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], 
           ",", "\n", "\t\t\t", 
           RowBox[{
           "\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            "constraints"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t", "\n", 
         "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{
           "rules", " ", "that", " ", "solve", " ", "the", " ", "linear", " ",
             "constraints"}], "*)"}], "\n", "\t\t", 
          RowBox[{
           RowBox[{"\"\<linear solutions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"First", "[", "solvedLinearConstraints", "]"}]}], ",", 
           "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "positions", " ", "with", " ", "linear", " ", "solutions", " ", 
             "applied"}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"(", " ", 
             RowBox[{"constrainedPositions", " ", "=", " ", 
              RowBox[{
               RowBox[{"Array", "[", 
                RowBox[{"vertexPosition", ",", " ", 
                 RowBox[{"Dimensions", "[", "positions", "]"}]}], "]"}], " ", 
               "/.", " ", 
               RowBox[{"Dispatch", "[", 
                RowBox[{"First", "[", "solvedLinearConstraints", "]"}], 
                "]"}]}]}], " ", ")"}]}], ",", "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{"remaining", " ", "nonlinear", " ", "constraints"}], 
            "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Pick", "[", " ", 
             RowBox[{
             "constraints", ",", " ", "linearEquationSelector", ",", " ", 
              "False"}], " ", "]"}]}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"nonlinearConstraintVector", "[", 
     RowBox[{"positions_", ",", " ", "constraintEq_"}], "]"}], " ", ":=", " ",
     "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"constraints", " ", "=", " ", 
         RowBox[{"constraintVector", "[", " ", 
          RowBox[{"positions", ",", " ", "constraintEq"}], " ", "]"}]}], ",", 
        " ", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"Array", "[", 
           RowBox[{"vertexPosition", ",", " ", 
            RowBox[{"Dimensions", "[", "positions", "]"}]}], "]"}], " ", 
          "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"Select", "[", " ", 
       RowBox[{"constraints", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"linearEquationQ", "[", 
           RowBox[{"#", ",", "vars"}], "]"}], "&"}], " ", "/@", " ", 
         "constraintEq"}]}], "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[701]:=",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "is", " ", "an", " ", "old", " ", "version", " ", "of", " ", 
    "the", " ", "function", " ", "that", " ", "will", " ", "be", " ", 
    "removed", " ", "eventually"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"dynamicVariables", "[", 
     RowBox[{"m_", ",", " ", "pinnedVertices_", ",", "initialPositions_"}], 
     "]"}], ":=", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", 
     RowBox[{
      RowBox[{"Cases", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"vertexPosition", "[", "m", "]"}]}], ",", 
            RowBox[{"Flatten", " ", "@", " ", "initialPositions"}]}], "}"}], 
          "]"}], " ", "/.", " ", "pinnedVertices"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"_vertexPosition", ",", "_"}], "}"}]}], "\n", "\t", "]"}], 
      ",", " ", "First"}], " ", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions_", ",", " ", "processedConstraints_Association"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions", ",", " ", 
      RowBox[{
      "processedConstraints", "[", "\"\<constrained positions\>\"", "]"}]}], 
     " ", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"dynamicVariables", "[", " ", 
     RowBox[{"positions_", ",", " ", "constrainedPositions_"}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", " ", 
     RowBox[{
      RowBox[{"Cases", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Flatten", " ", "@", " ", "constrainedPositions"}], ",", 
           " ", 
           RowBox[{"Flatten", " ", "@", " ", "positions"}]}], " ", "}"}], " ",
          "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"_vertexPosition", ",", " ", "_"}], "}"}]}], "\n", "\t", 
       "]"}], ",", " ", "First"}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "In[703]:=",ExpressionUUID->"d950c243-7cbd-4fa7-9959-4787123d60ec"]
}, Closed]],

Cell[CellGroupData[{

Cell["evaluateEnergy[]", "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_compiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"positionRules", "[", "positions", "]"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
     RowBox[{"energy", ":", " ", 
      RowBox[{"Except", "[", "_compiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
    "\n", "\t", 
   RowBox[{"energy", " ", "/.", " ", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"vertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
       "positions"}], "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"evaluateEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"energy_", "?", "compiledMechanismEnergyQ"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"energy", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "positions", "]"}], ",", 
     RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"evaluateEnergy", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
    RowBox[{"energy_", "?", "compiledMechanismEnergyQ"}]}], "]"}], ":=", "\n",
   "\t", 
  RowBox[{
   RowBox[{"energy", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "[", 
   RowBox[{"positions", ",", 
    RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "In[706]:=",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],

Cell[CellGroupData[{

Cell["analyticEnergyQ[]", "Subsection",ExpressionUUID->"8bb00a64-b11b-49dc-8019-90801a7f898c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"analyticEnergyQ", "[", 
    RowBox[{"Automatic", " ", ",", " ", "positions_"}], "]"}], ":=", "True"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"analyticEnergyQ", "[", 
   RowBox[{"energyExpression_", " ", ",", " ", "positions_"}], "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"number", " ", "=", " ", 
      RowBox[{"N", "[", " ", 
       RowBox[{"energyExpression", " ", "/.", " ", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"positionRules", "[", "positions", "]"}], "]"}]}], " ", 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Im", "[", 
       RowBox[{"Chop", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
      "0"}], " ", "&&", " ", 
     RowBox[{"NumericQ", "[", "number", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Chop", "[", 
       RowBox[{"Im", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
      "0"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[710]:=",ExpressionUUID->"d5b77de4-6377-4475-99bc-9c004e543f84"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["modifying and creating linkages", "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],

Cell[CellGroupData[{

Cell["toFramework[]", "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "toFramework", "]"}], "=", 
    RowBox[{"Options", "[", "framework", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toFramework", "[", 
    RowBox[{"mr_MeshRegion", ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"framework", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"meshCells", "[", "mr", "]"}], " ", "/.", " ", 
      RowBox[{"Line", "->", "rigidBar"}]}], ",", "\n", "\t", "opt"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toFramework", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g_Graph", ",", "data___"}], "}"}], ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"framework", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", 
      RowBox[{"g", ",", "data"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"rigidBar", "[", 
        RowBox[{"List", "@@", "#"}], "]"}], "&"}], " ", "/@", " ", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ",", "\n", "\t", "opt"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toFramework", "[", 
    RowBox[{"g_Graph", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"framework", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", "g", "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"rigidBar", "[", 
        RowBox[{"List", "@@", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"EdgeList", "[", "g", "]"}]}], ",", "\n", "\t", "opt"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toFramework", "::", "bad"}], "=", 
   "\"\<Unable to turn `1` into a framework.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"toFramework", "[", " ", 
   RowBox[{"obj_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"toFramework", "::", "bad"}], ",", " ", 
     RowBox[{"Head", "[", "obj", "]"}]}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "In[712]:=",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],

Cell[CellGroupData[{

Cell["randomCellNetwork[]", "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "randomCellNetwork", "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\"\<faces\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<map\>\"", "\[Rule]", "Identity"}]}], " ", "}"}], ",", 
       " ", 
       RowBox[{"Options", "[", "framework", "]"}]}], " ", "]"}]}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"randomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"#", ">", "0"}], " ", "&"}], " ", ")"}]}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", "j", ",", "selectedPrimitives", ",", " ", "positions", ",", 
        " ", "mappedPositions"}], "}"}], ",", "\n", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"randomPoints", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "1"}], "/", "2"}], ",", 
              RowBox[{"1", "/", "2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], "}"}], ",", 
        "\n", "\n", "\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"expandedMesh", "=", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{
              RowBox[{"VoronoiMesh", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"randomPoints", "+", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}], ",", "numPoints"}], 
                    "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"j", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
                 "2"}], "]"}], "]"}], ",", "2"}], "]"}]}], "}"}], ",", "\n", 
          "\n", "\t\t", 
          RowBox[{
           RowBox[{"selectedPrimitives", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{"expandedMesh", ",", 
              RowBox[{
               RowBox[{"Or", "@@", 
                RowBox[{"RegionMember", "[", 
                 RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"positions", " ", "=", " ", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"selectedPrimitives", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"mappedPositions", " ", "=", " ", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<map\>\"", "]"}], " ", "/@", " ",
              "positions"}]}], ";", "\n", "\n", "\t\t", 
           RowBox[{
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mesh", " ", "=", " ", 
                RowBox[{"MeshRegion", "[", 
                 RowBox[{"positions", ",", " ", 
                  RowBox[{"Polygon", " ", "/@", " ", 
                   RowBox[{"Flatten", " ", "/@", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"selectedPrimitives", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
                    RowBox[{"PositionIndex", "[", "positions", "]"}]}], " ", 
                    ")"}]}]}]}], "]"}]}], "}"}], ",", "\t", "\n", "\n", 
              "\t\t\t", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"BooleanQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<faces\>\"", "]"}], "]"}], 
                 " ", "&&", " ", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<faces\>\"", "]"}], " ", 
                  "\[Equal]", " ", "True"}]}], ",", "\n", "\t\t\t\t", 
                RowBox[{"framework", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "2"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Polygon", "\[Rule]", "face"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "framework", "]"}]}], " ", 
                   "]"}]}], " ", "]"}], ",", "\n", "\t\t\t\t", 
                RowBox[{"framework", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Line", "\[Rule]", "spring"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "framework", "]"}]}], " ", 
                   "]"}]}], " ", "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\n",
              "\t\t", "]"}], " ", "/;", " ", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"MatrixQ", "[", 
                RowBox[{"mappedPositions", ",", "NumericQ"}], "]"}], " ", "&&",
                " ", 
               RowBox[{
                RowBox[{"Last", "[", 
                 RowBox[{"Dimensions", "[", "mappedPositions", "]"}], "]"}], 
                "\[Equal]", "2"}]}], ",", "\n", "\t\t\t", "True", ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"randomCellNetwork", "::", "map"}], "]"}], ";", " ", 
               "False"}]}], "\n", "\t\t", "]"}]}]}]}], "\n", "\t", "]"}]}], 
       "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"randomCellNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"randomCellNetwork", "::", "num"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomCellNetwork", "::", "map"}], "=", 
     "\"\<Option \\\"map\\\" is not a function taking a point in 2D to a \
point in 2D.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomCellNetwork", "::", "num"}], "=", 
     "\"\<Number of points should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[718]:=",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["randomTriangulatedNetwork[]", "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "randomTriangulatedNetwork", "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"\"\<faces\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<map\>\"", "\[Rule]", "Identity"}]}], " ", "}"}], ",", 
       " ", 
       RowBox[{"Options", "[", "framework", "]"}]}], " ", "]"}]}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"randomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"#", ">", "0"}], " ", "&"}], " ", ")"}]}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", "j", ",", "selectedPrimitives", ",", " ", "positions", ",", 
        " ", "mappedPositions"}], "}"}], ",", "\n", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"randomPoints", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "1"}], "/", "2"}], ",", 
              RowBox[{"1", "/", "2"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], "}"}], ",", 
        "\n", "\n", "\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"expandedMesh", "=", 
            RowBox[{"MeshPrimitives", "[", 
             RowBox[{
              RowBox[{"DelaunayMesh", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"randomPoints", "+", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}], ",", "numPoints"}], 
                    "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"j", ",", 
                    RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", 
                 "2"}], "]"}], "]"}], ",", "2"}], "]"}]}], "}"}], ",", "\n", 
          "\n", "\t\t", 
          RowBox[{
           RowBox[{"selectedPrimitives", " ", "=", " ", 
            RowBox[{"Select", "[", 
             RowBox[{"expandedMesh", ",", 
              RowBox[{
               RowBox[{"Or", "@@", 
                RowBox[{"RegionMember", "[", 
                 RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"positions", " ", "=", " ", 
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"selectedPrimitives", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], 
             "]"}]}], ";", "\n", "\t\t", 
           RowBox[{"mappedPositions", " ", "=", " ", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<map\>\"", "]"}], " ", "/@", " ",
              "positions"}]}], ";", "\n", "\n", "\t\t", 
           RowBox[{
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mesh", " ", "=", " ", 
                RowBox[{"MeshRegion", "[", 
                 RowBox[{"positions", ",", " ", 
                  RowBox[{"Polygon", " ", "/@", " ", 
                   RowBox[{"Flatten", " ", "/@", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"selectedPrimitives", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
                    RowBox[{"PositionIndex", "[", "positions", "]"}]}], " ", 
                    ")"}]}]}]}], "]"}]}], "}"}], ",", "\t", "\n", "\n", 
              "\t\t\t", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"BooleanQ", "[", 
                  RowBox[{"OptionValue", "[", "\"\<faces\>\"", "]"}], "]"}], 
                 " ", "&&", " ", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "\"\<faces\>\"", "]"}], " ", 
                  "\[Equal]", " ", "True"}]}], ",", "\n", "\t\t\t\t", 
                RowBox[{"framework", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "2"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Polygon", "\[Rule]", "face"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "framework", "]"}]}], " ", 
                   "]"}]}], " ", "]"}], ",", "\n", "\t\t\t\t", 
                RowBox[{"framework", "[", " ", 
                 RowBox[{"mappedPositions", ",", " ", 
                  RowBox[{
                   RowBox[{"MeshCells", "[", 
                    RowBox[{"mesh", ",", "1"}], "]"}], " ", "/.", " ", 
                   RowBox[{"Line", "\[Rule]", "spring"}]}], ",", " ", 
                  RowBox[{"FilterRules", "[", 
                   RowBox[{
                    RowBox[{"{", "opt", "}"}], ",", " ", 
                    RowBox[{"Options", "[", "framework", "]"}]}], " ", 
                   "]"}]}], " ", "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\n",
              "\t\t", "]"}], " ", "/;", " ", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"MatrixQ", "[", 
                RowBox[{"mappedPositions", ",", "NumericQ"}], "]"}], " ", "&&",
                " ", 
               RowBox[{
                RowBox[{"Last", "[", 
                 RowBox[{"Dimensions", "[", "mappedPositions", "]"}], "]"}], 
                "\[Equal]", "2"}]}], ",", "\n", "\t\t\t", "True", ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"randomCellNetwork", "::", "map"}], "]"}], ";", " ", 
               "False"}]}], "\n", "\t\t", "]"}]}]}]}], "\n", "\t", "]"}]}], 
       "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"randomTriangulatedNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"randomTriangulatedNetwork", "::", "num"}], "]"}]}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomTriangulatedNetwork", "::", "map"}], "=", 
     "\"\<Option \\\"map\\\" is not a function taking a point in 2D to a \
point in 2D.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomTriangulatedNetwork", "::", "num"}], "=", 
     "\"\<Number of points should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "In[723]:=",ExpressionUUID->"c1058285-daa4-49c3-b6e6-cf523195583e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Henneberg", "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "1", "]"}], "[", 
     RowBox[{
      RowBox[{"n_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"label_", " ", "\[Rule]", " ", 
       RowBox[{"pos_", "?", "VectorQ"}]}]}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"addCells", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Point", "[", 
        RowBox[{"label", " ", "\[Rule]", " ", 
         RowBox[{"PadRight", "[", 
          RowBox[{"pos", ",", " ", 
           RowBox[{"embeddingDimension", "[", "m", "]"}]}], "]"}]}], " ", 
        "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"rigidBar", "[", 
          RowBox[{"{", 
           RowBox[{"#", ",", "label"}], "}"}], "]"}], "&"}], " ", "/@", " ", 
        "n"}]}], " ", "}"}], " ", "]"}], "[", "m", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "1", "]"}], "[", 
     RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"vertices", " ", "=", " ", 
       RowBox[{"RandomSample", "[", " ", 
        RowBox[{
         RowBox[{"Range", "[", " ", 
          RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}], ",", 
         " ", "2"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Henneberg", "[", "1", "]"}], "[", 
       RowBox[{"vertices", ",", " ", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
       "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}], "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "2", "]"}], "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n1_", ",", " ", "n2_", ",", "n3_"}], "}"}], ",", " ", 
      RowBox[{"label_", " ", "\[Rule]", " ", "pos_"}]}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"addCells", "[", 
     RowBox[{"{", 
      RowBox[{"rigidBar", "[", 
       RowBox[{"{", 
        RowBox[{"label", ",", " ", "n3"}], "}"}], "]"}], "}"}], "]"}], " ", 
    "@", " ", 
    RowBox[{
     RowBox[{"splitEdge", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2"}], "}"}], ",", " ", 
       RowBox[{"label", " ", "\[Rule]", " ", "pos"}]}], " ", "]"}], "[", " ", 
     "m", " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", "2", "]"}], "[", 
     RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
    RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"edge", " ", "=", " ", 
       RowBox[{"RandomChoice", "[", " ", 
        RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Henneberg", "[", "2", "]"}], "[", 
       RowBox[{
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"{", " ", 
          RowBox[{"edge", ",", " ", 
           RowBox[{"RandomChoice", "[", " ", 
            RowBox[{"Complement", "[", " ", 
             RowBox[{
              RowBox[{"Range", "[", " ", 
               RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}], 
              ",", " ", "edge"}], "]"}], " ", "]"}]}], " ", "}"}], " ", "]"}],
         ",", " ", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
       "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Henneberg", "[", 
    RowBox[{"d", ":", 
     RowBox[{"1", "|", "2"}]}], "]"}], "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "x__"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Henneberg", "[", "d", "]"}], "[", "x", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[728]:=",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["extracting rigidity data", "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],

Cell[CellGroupData[{

Cell["cellData[]", "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cellData", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"pos", " ", ":", " ", 
      RowBox[{
       RowBox[{"_", "?", "MatrixQ"}], "|", "Automatic"}], " ", ":", " ", 
      "Automatic"}], ",", " ", 
     RowBox[{"{", " ", 
      RowBox[{"head_", ",", " ", "dataType_"}], " ", "}"}]}], " ", "]"}], " ",
    ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"positions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"pos", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "pos"}], " ",
         "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"cellDataInternal", "[", " ", 
       RowBox[{"dataType", ",", " ", "m", ",", " ", "positions", ",", " ", 
        RowBox[{"FirstCase", "[", " ", 
         RowBox[{
          RowBox[{"mechanismComponents", "[", "m", "]"}], " ", ",", " ", 
          RowBox[{"head", "[", "__", "]"}]}], " ", "]"}]}], " ", "]"}], " ", "/;",
       " ", 
      RowBox[{"cellDataArgumentsQ", "[", " ", 
       RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellData", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions do not have same dimensions as mechanism positions.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"cellDataArgumentsQ", "[", " ", 
   RowBox[{"m_", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"True", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", "positions", "]"}], " ", "==", " ", 
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"cellDataArgumentsQ", "[", " ", 
   RowBox[{"m_", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"cellData", "::", "pos"}], "]"}], ";", " ", "False"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "In[733]:=",ExpressionUUID->"a9a1bea0-2eb1-4498-a4f6-e0fb5682d5b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"specifiedCells", "[", " ", 
   RowBox[{"numberOfCells_", ",", " ", "data_", ",", " ", "default_"}], " ", 
   "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"newData", " ", "=", " ", 
      RowBox[{"List", " ", "@@@", " ", 
       RowBox[{"Drop", "[", " ", 
        RowBox[{
         RowBox[{"ArrayRules", "[", " ", 
          RowBox[{"data", " ", ",", " ", "default"}], " ", "]"}], ",", " ", 
         RowBox[{"-", "1"}]}], " ", "]"}]}]}], " ", "}"}], ",", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"automaticCells", " ", "=", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"Complement", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", "numberOfCells", "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"newData", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], " ", "]"}], 
         " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{"automaticCells", ",", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"newData", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", " ", 
        RowBox[{"newData", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "\n", "]"}]}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[737]:=",ExpressionUUID->"adb373c8-874b-46e0-9e67-0de750560642"],

Cell[CellGroupData[{

Cell["cellDataInternal[]", "Subsubsection",ExpressionUUID->"68e02d8f-32be-40d7-8ce6-63dba577fda3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"rigidBar", "[", "]"}], " ", "constraint", " ", "equations"}], 
   " ", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<length\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"rigidBar", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], "]"}]}], " ", "]"}], " ", 
    ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<length\>\"", "]"}], ",", " ", 
          "\"\<Automatic\>\""}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"displacementLength", "[", " ", 
           RowBox[{"m", ",", " ", "positions", ",", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", " ", 
              RowBox[{"data", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], " ", 
           "]"}], ",", "\n", "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<stiffness\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"rigidBar", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], "]"}]}], " ", "]"}], " ", 
    ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<stiffness\>\"", "]"}], " ", ",", " ", 
          "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"Infinity", ",", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{"All", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"rigidBar", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"length", ",", " ", "stiffness"}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"length", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<length\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
              RowBox[{"rigidBar", "[", " ", 
               RowBox[{"indices", ",", " ", "dataSpec"}], " ", "]"}]}], " ", 
             "]"}], "  ", "]"}], ",", " ", "First"}], " ", "]"}], " ", 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<stiffness\>\"", ",", " ", "m", ",", " ", "positions", ",", 
              " ", 
              RowBox[{"rigidBar", "[", " ", 
               RowBox[{"indices", ",", " ", "dataSpec"}], " ", "]"}]}], " ", 
             "]"}], " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}],
        ";", "\n", "\t", "\n", "\t", 
       RowBox[{"Association", "[", " ", 
        RowBox[{
         RowBox[{"\"\<indices\>\"", " ", "\[Rule]", " ", 
          RowBox[{"length", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<length\>\"", " ", "\[Rule]", " ", 
          RowBox[{"length", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<stiffness\>\"", " ", "\[Rule]", " ", 
          RowBox[{"stiffness", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[738]:=",ExpressionUUID->"348deadf-43ea-4531-be6e-31a20693e23d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"fold", "[", "]"}], " ", "constraint", " ", "equations"}], " ", 
   "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<angle\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"fold", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<angle\>\"", "]"}], ",", " ", 
          "\"\<Automatic\>\""}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"foldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "positions", ",", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", " ", 
              RowBox[{"data", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], " ", 
           "]"}], ",", "\n", "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<torsionalStiffness\>\"", ",", " ", "m_", ",", " ", "positions_", 
      ",", " ", 
      RowBox[{"fold", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<torsionalStiffness\>\"", "]"}], ",", 
          " ", "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"Infinity", ",", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{"All", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"fold", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"angle", ",", " ", "stiffness"}], " ", "}"}], ",", "\n", "\t", 
      
      RowBox[{
       RowBox[{"angle", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<angle\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
              
              RowBox[{"fold", "[", 
               RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}],
             " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<torsionalStiffness\>\"", ",", " ", "m", ",", " ", 
              "positions", ",", " ", 
              RowBox[{"fold", "[", 
               RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}],
             " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"Association", "[", " ", 
        RowBox[{
         RowBox[{"\"\<indices\>\"", " ", "\[Rule]", " ", 
          RowBox[{"angle", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<angle\>\"", " ", "\[Rule]", " ", 
          RowBox[{"angle", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<torsionalStiffness\>\"", " ", "\[Rule]", " ", 
          RowBox[{"stiffness", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[741]:=",ExpressionUUID->"2f6ca2b6-1182-476c-a59a-eca5207db206"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"spring", "[", "]"}], " ", "constraint", " ", "equations"}], " ", 
   "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<length\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"spring", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<length\>\"", "]"}], ",", " ", 
          "\"\<Automatic\>\""}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"displacementLength", "[", " ", 
           RowBox[{"m", ",", " ", "positions", ",", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", " ", 
              RowBox[{"data", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], " ", 
           "]"}], ",", "\n", "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<stiffness\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"spring", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<stiffness\>\"", "]"}], ",", " ", 
          "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"Infinity", ",", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{
     "\"\<strain\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"spring", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"specifiedCells", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
          RowBox[{"dataSpec", "[", "\"\<strain\>\"", "]"}], " ", ",", " ", 
          "\"\<linear\>\""}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"data", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
        "\n", "\t", 
        RowBox[{"Join", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#1", "-", "#2"}], "&"}], ",", " ", 
            RowBox[{"Length", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellDataInternal", "[", " ", 
     RowBox[{"All", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"spring", "[", " ", 
       RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
    " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"length", ",", " ", "stiffness", ",", " ", "strain"}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"length", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<length\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
              RowBox[{"spring", "[", 
               RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}],
             " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<stiffness\>\"", ",", " ", "m", ",", " ", "positions", ",", 
              " ", 
              RowBox[{"spring", "[", 
               RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}],
             " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"strain", " ", "=", " ", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"SortBy", "[", " ", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"cellDataInternal", "[", " ", 
             RowBox[{
             "\"\<strain\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
              RowBox[{"spring", "[", 
               RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}],
             " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"Association", "[", " ", 
        RowBox[{
         RowBox[{"\"\<indices\>\"", " ", "\[Rule]", " ", 
          RowBox[{"length", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<length\>\"", " ", "\[Rule]", " ", 
          RowBox[{"length", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<stiffness\>\"", " ", "\[Rule]", " ", 
          RowBox[{"stiffness", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
         RowBox[{"\"\<strain\>\"", " ", "\[Rule]", " ", 
          RowBox[{"strain", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "In[744]:=",ExpressionUUID->"6f665ef1-43eb-4788-8831-d0a461934b69"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cellDataInternal", "[", " ", 
    RowBox[{
    "\"\<pinningStiffness\>\"", ",", " ", "m_", ",", " ", "positions_", ",", 
     " ", 
     RowBox[{"joint", "[", " ", 
      RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"specifiedCells", "[", " ", 
        RowBox[{
         RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
         RowBox[{"dataSpec", "[", "\"\<pinningStiffness\>\"", "]"}], ",", " ",
          "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
       "\n", "\t\t", 
       RowBox[{"Join", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{"Infinity", ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"data", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t",
       "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellDataInternal", "[", " ", 
    RowBox[{
    "\"\<constraint\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"joint", "[", " ", 
      RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"specifiedCells", "[", " ", 
        RowBox[{
         RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
         RowBox[{"dataSpec", "[", "\"\<constraint\>\"", "]"}], ",", " ", 
         "\"\<Automatic\>\""}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
       "\n", "\t", 
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Map", "[", " ", 
          RowBox[{"autopin", " ", ",", " ", 
           RowBox[{"positions", "[", 
            RowBox[{"[", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", " ", 
               RowBox[{"data", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}], " ", "]"}],
             "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"data", "[", 
           RowBox[{"[", "3", "]"}], "]"}], " ", "]"}]}], "\n", "\t", "]"}]}], 
      "\n", "\t", "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"autopin", "[", "position_", "]"}], " ", ":=", " ", 
   RowBox[{"(", " ", 
    RowBox[{
     RowBox[{"#", " ", "-", "  ", "position"}], " ", "&"}], ")"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"cellDataInternal", "[", " ", 
   RowBox[{"All", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
    RowBox[{"joint", "[", " ", 
     RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"constraint", ",", " ", "stiffness"}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"constraint", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"SortBy", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"cellDataInternal", "[", " ", 
           RowBox[{
           "\"\<constraint\>\"", ",", " ", "m", ",", " ", "positions", ",", 
            " ", 
            RowBox[{"joint", "[", 
             RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}], 
          " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
     "\n", "\t", 
     RowBox[{"stiffness", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"SortBy", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"cellDataInternal", "[", " ", 
           RowBox[{
           "\"\<pinningStiffness\>\"", ",", " ", "m", ",", " ", "positions", 
            ",", " ", 
            RowBox[{"joint", "[", 
             RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}], 
          " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"Association", "[", " ", 
      RowBox[{
       RowBox[{"\"\<indices\>\"", " ", "\[Rule]", " ", 
        RowBox[{"constraint", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
       RowBox[{"\"\<constraint\>\"", " ", "\[Rule]", " ", 
        RowBox[{"constraint", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
       RowBox[{"\"\<pinningStiffness\>\"", " ", "\[Rule]", " ", 
        RowBox[{"stiffness", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[748]:=",ExpressionUUID->"4726adc9-b131-4ca2-bf4a-c62109e08d6d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cellDataInternal", "[", " ", 
    RowBox[{
    "\"\<angleStiffness\>\"", ",", " ", "m_", ",", " ", "positions_", ",", 
     " ", 
     RowBox[{"angleJoint", "[", " ", 
      RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], ":=",
    " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"specifiedCells", "[", " ", 
        RowBox[{
         RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
         RowBox[{"dataSpec", "[", "\"\<angleStiffness\>\"", "]"}], ",", " ", 
         "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"data", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
       "\n", "\t", 
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{"Infinity", ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"data", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellDataInternal", "[", " ", 
    RowBox[{"\"\<angle\>\"", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"angleJoint", "[", " ", 
      RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], ":=",
    " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"specifiedCells", "[", " ", 
        RowBox[{
         RowBox[{"Length", "[", "indices", "]"}], ",", " ", 
         RowBox[{"dataSpec", "[", "\"\<angle\>\"", "]"}], ",", " ", 
         "Infinity"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"data", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "]"}], "]"}], ",", 
       "\n", "\t", 
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"turningAngle", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"data", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "\n", "\t", "]"}]}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cellDataInternal", "[", " ", 
   RowBox[{"All", ",", " ", "m_", ",", " ", "positions_", ",", " ", 
    RowBox[{"angleJoint", "[", " ", 
     RowBox[{"indices_", ",", " ", "dataSpec_"}], " ", "]"}]}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"angle", ",", " ", "stiffness"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"angle", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"SortBy", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"cellDataInternal", "[", " ", 
           RowBox[{
           "\"\<angle\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
            RowBox[{"angleJoint", "[", 
             RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}], 
          " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
     "\n", "\t", 
     RowBox[{"stiffness", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"SortBy", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"cellDataInternal", "[", " ", 
           RowBox[{
           "\"\<angleStiffness\>\"", ",", " ", "m", ",", " ", "positions", 
            ",", " ", 
            RowBox[{"angleJoint", "[", 
             RowBox[{"indices", ",", " ", "dataSpec"}], "]"}]}], " ", "]"}], 
          " ", "]"}], ",", " ", "First"}], " ", "]"}], " ", "]"}]}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"Association", "[", " ", 
      RowBox[{
       RowBox[{"\"\<indices\>\"", " ", "\[Rule]", " ", 
        RowBox[{"angle", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
       RowBox[{"\"\<constraint\>\"", " ", "\[Rule]", " ", 
        RowBox[{"angle", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
       RowBox[{"\"\<angleStiffness\>\"", " ", "\[Rule]", " ", 
        RowBox[{"stiffness", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[752]:=",ExpressionUUID->"2087cd22-5e91-4329-8449-2ab14c98e71f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cellDataInternal", "[", " ", 
   RowBox[{"_", ",", " ", "_", ",", " ", "_", ",", " ", "_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}]}], "}"}]}]], "Code",
 CellLabel->
  "In[755]:=",ExpressionUUID->"74c6f492-69a5-40d3-ab96-931470c95193"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["constraintEquations[]", "Subsection",ExpressionUUID->"b7156b33-cb6c-4b74-aacf-f98656168e47"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "constraintEquations", " ", "]"}], " ", "=", 
    " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", "None"}], ",", "\n",
       "\t", 
      RowBox[{"\"\<output\>\"", " ", "\[Rule]", " ", "vertexDisplacement"}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<pattern\>\"", " ", "\[Rule]", " ", "_"}]}], "\n", "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"orderQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"orderQ", "[", " ", "Infinity", " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orderQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"constraintEquations", "::", "order"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"constraintEquations", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "MatrixQ"}], "|", "Automatic"}]}], ",", " ", 
    RowBox[{"order_", "?", "orderQ"}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"actualPositions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"positions", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         "positions"}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{"output", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<output\>\"", "]"}]}]}], "\n", "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"constraintEquationsInternal", "[", 
      RowBox[{"m", ",", " ", "actualPositions", ",", " ", "order", ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<pattern\>\"", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}], ",", " ", 
       "output"}], " ", "]"}], " ", "/;", " ", 
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"vertexCoordinatesQ", "[", " ", 
         RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}], ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"constraintEquations", "::", "pos"}], "]"}], ";", " ", 
        "False"}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"Or", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"IntegerQ", "[", "order", "]"}], " ", "&&", " ", 
           RowBox[{"order", " ", ">", " ", "0"}]}], ",", " ", 
          RowBox[{"order", " ", "===", " ", "Infinity"}]}], " ", "]"}]}], ",",
        " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"constraintEquations", "::", "order"}], "]"}], ";", " ", 
        "False"}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"output", ",", " ", 
          RowBox[{"vertexDisplacement", "|", "vertexPosition"}]}], "]"}]}], 
       ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"constraintEquations", "::", "output"}], "]"}], ";", " ", 
        "False"}], ",", "\n", "\t\t", "True", ",", " ", "True"}], "\n", "\t", 
      "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEquations", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"order_", "?", "orderQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"constraintEquations", "[", " ", 
    RowBox[{"m", ",", " ", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "order", ",", 
     " ", "opt"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEquations", "::", "pos"}], "=", 
   "\"\<Positions do not correspond to mechanism vertices.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEquations", "::", "output"}], "=", 
   "\"\<Option \\\"output\\\" must be either vertexDisplacement or \
vertexPosition.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintEquations", "::", "order"}], "=", 
   "\"\<Order of expansion must be a positive integer or Infinity.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[756]:=",ExpressionUUID->"b0b15184-d1a1-457a-8b95-c43845ad02d9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"constraintEquationsInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "order_", ",", " ", "pattern_", 
    ",", " ", "constraints_", ",", " ", 
    RowBox[{"output", " ", ":", " ", 
     RowBox[{"vertexDisplacement", " ", "|", " ", "vertexPosition"}]}]}], " ",
    "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tmp", ",", " ", "tmpPositions"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"tmpPositions", " ", "=", " ", 
      RowBox[{"positions", " ", "/.", " ", 
       RowBox[{"vertexPosition", " ", "\[Rule]", " ", "tmp"}]}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"ReplaceAll", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"reduceConstraintToOrder", "[", "\n", "\t\t\t", 
         RowBox[{"positions", ",", "\n", "\t\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"componentToConstraints", "[", 
                 RowBox[{"m", " ", ",", " ", "tmpPositions", ",", " ", 
                  RowBox[{"vertexPosition", "[", "m", "]"}], ",", " ", "#"}], 
                 " ", "]"}], "&"}], " ", "/@", " ", 
               RowBox[{"constrainedComponents", "[", 
                RowBox[{"m", " ", ",", " ", "pattern"}], " ", "]"}]}], ")"}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{"constraintVector", "[", " ", 
              RowBox[{"tmpPositions", ",", " ", "constraints"}], " ", "]"}]}],
             "\n", "\t\t\t", "}"}], "]"}], ",", "\n", "\t\t\t", "order"}], 
         "\n", "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{"Which", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"order", " ", "===", " ", "Infinity"}], " ", "&&", " ", 
           RowBox[{"output", " ", "===", " ", "vertexDisplacement"}]}], ",", 
          " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"positionRules", "[", " ", 
            RowBox[{"positions", " ", "+", " ", 
             RowBox[{"vertexDisplacement", "[", "m", "]"}]}], " ", "]"}], 
           "]"}], ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "order", "]"}], " ", "&&", " ", 
           RowBox[{"output", " ", "===", " ", "vertexPosition"}]}], ",", " ", 
          
          RowBox[{"Dispatch", "[", 
           RowBox[{"displacementRules", "[", " ", 
            RowBox[{
             RowBox[{"vertexPosition", "[", "m", "]"}], " ", "-", " ", 
             "positions"}], " ", "]"}], "]"}], ",", "\n", "\t\t\t", "True", 
          ",", " ", 
          RowBox[{"{", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}], " ",
       "/.", " ", 
      RowBox[{"tmp", " ", "\[Rule]", " ", "vertexPosition"}]}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[765]:=",ExpressionUUID->"1541376a-e966-4f59-8e04-b3265424a372"],

Cell[CellGroupData[{

Cell["componentToConstraints[]", "Subsubsection",ExpressionUUID->"8eb12589-13d0-4db1-8d82-5a7f3627cf24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "bar_rigidBar"}], " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"constrainedBars", " ", "=", " ", 
      RowBox[{"cellDataInternal", "[", " ", 
       RowBox[{
       "\"\<length\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
        "bar"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"displacementLengthSquared", "[", " ", 
       RowBox[{"arbitraryPositions", ",", " ", 
        RowBox[{"constrainedBars", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"constrainedBars", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}], ")"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[766]:=",ExpressionUUID->"d23ba088-27d1-4486-af97-c5061397f6ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "bar_spring"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"constrainedBars", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", 
        RowBox[{
        "\"\<length\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
         "bar"}], "]"}]}], ",", " ", 
      RowBox[{"strain", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "\"\<strain\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
         "bar"}], " ", "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"#1", "[", 
        RowBox[{"#2", ",", " ", "#3"}], "]"}], "&"}], ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"strain", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
        RowBox[{"displacementLength", "[", " ", 
         RowBox[{"arbitraryPositions", ",", " ", 
          RowBox[{"constrainedBars", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], ",", " ", 
        RowBox[{"constrainedBars", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}]}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[767]:=",ExpressionUUID->"782ed89f-bdb4-4a7a-8b66-41dc46d0a1a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "bar_fold"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"constrainedBars", " ", "=", " ", 
      RowBox[{"cellDataInternal", "[", " ", 
       RowBox[{
       "\"\<angle\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
        "bar"}], "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"foldAngle", "[", " ", 
      RowBox[{"m", ",", " ", "arbitraryPositions", ",", " ", 
       RowBox[{"constrainedBars", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], " ", "-", " ", 
     RowBox[{"constrainedBars", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[768]:=",ExpressionUUID->"cca4c994-4bdb-4262-8a73-59346334dcf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "vertices_joint"}], " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"constrainedVertices", " ", "=", " ", 
      RowBox[{"cellDataInternal", "[", " ", 
       RowBox[{
       "\"\<constraint\>\"", ",", " ", "m", ",", " ", "positions", ",", " ", 
        "vertices"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"constrainedVertices", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "\[Equal]", " ", "0"}], 
      ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", " ", "\n", "\t\t", 
      RowBox[{"MapThread", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "[", "#2", "]"}], "&"}], ",", "\n", "\t\t\t", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"constrainedVertices", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "\n", "\t\t\t", 
          RowBox[{"vertexPosition", "[", " ", 
           RowBox[{
            RowBox[{"constrainedVertices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"All", "[", " ", 
             RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
             "]"}]}], " ", "]"}], ",", "\n", "\t\t\t", "\n", "\t\t\t", 
          RowBox[{"(*", 
           RowBox[{"this", " ", "is", " ", "not", " ", "used", " ", "yet"}], 
           "*)"}], "\n", "\t\t\t", 
          RowBox[{"positions", "[", 
           RowBox[{"[", " ", 
            RowBox[{"constrainedVertices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], "]"}]}], "\n", 
         "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[769]:=",ExpressionUUID->"45528231-7bba-4542-a290-17553f1ce429"],

Cell[BoxData[
 RowBox[{
  RowBox[{"componentToConstraints", "[", " ", "___", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"{", "}"}]}]], "Code",
 CellLabel->
  "In[770]:=",ExpressionUUID->"49ff6c33-b326-4e81-9f7f-58b38ecac55a"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanismEnergy[]", "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$defaultStiffness", "[", "\"\<Methods\>\"", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
   "rigidBar", ",", " ", "spring", ",", " ", "fold", ",", " ", "joint", ",", 
    " ", "angleJoint", ",", " ", "\"\<constraints\>\""}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "rigidBar", "]"}], "=", "1"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "spring", "]"}], "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "fold", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "joint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "angleJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$defaultStiffness", "[", "\"\<constraints\>\"", "]"}], "=", 
    RowBox[{"10", "^", 
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "::", "err"}], "=", 
   "\"\<`1` does not have a default stiffness.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$defaultStiffness", "[", "s_", "]"}], ":=", 
   RowBox[{"\"\<nothing\>\"", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"$defaultStiffness", "::", "err"}], ",", "s"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "mechanismEnergy", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<constraints\>\"", "->", "None"}], ",", " ", 
      RowBox[{"\"\<pattern\>\"", " ", "\[Rule]", " ", "_"}]}], "}"}]}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"actualPositions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"positions", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         "positions"}], "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"mechanismEnergyInternal", "[", 
       RowBox[{"m", ",", " ", "actualPositions", ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<pattern\>\"", "]"}]}], " ", "]"}], 
      " ", "/;", " ", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", " ", "actualPositions"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismEnergy", "::", "pos"}], "=", 
   "\"\<Positions do not correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"mechanismEnergy", "::", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mechanismEnergyInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "constraints_", ",", " ", 
    "pattern_"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"components", " ", "=", " ", 
       RowBox[{"mechanismComponents", "[", 
        RowBox[{"m", ",", " ", "pattern"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"nonlinearConstraints", " ", "=", " ", 
       RowBox[{"nonlinearConstraintVector", "[", 
        RowBox[{"positions", ",", " ", "constraints"}], "]"}]}], ",", "\n", 
      "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"vertexPosition", "[", "m", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"Total", " ", "@", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"componentEnergy", "[", 
           RowBox[{
           "m", ",", " ", "positions", ",", " ", "arbitraryPositions", ",", 
            " ", "#"}], "]"}], "&"}], " ", "/@", " ", "components"}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{"$defaultStiffness", "[", "\"\<constraints\>\"", "]"}], " ", 
         
         RowBox[{
          RowBox[{
          "nonlinearConstraints", " ", ".", " ", "nonlinearConstraints"}], 
          "/", "2"}]}]}], "\n", "\t", "}"}], "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[771]:=",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     "bar_rigidBar"}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "All", ",", " ", "m", ",", " ", "positions", ",", " ", "bar"}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "this", " ", "form", " ", "has", " ", "the", " ", "property", " ", 
       "that", " ", "the", " ", "elastic", " ", "energy", " ", "to", " ", 
       "apply", " ", "a", " ", "fixed", " ", "strain", " ", "to", " ", "N", 
       " ", "beams", " ", "in", " ", "series", " ", "is", " ", "the", " ", 
       RowBox[{"same", "."}]}], " ", "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<stiffness\>\"", "]"}], " ", "/.", " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$defaultStiffness", "[", "rigidBar", "]"}]}]}], " ", ")"}], 
      " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"displacementLengthSquared", "[", 
            RowBox[{"arbitraryPositions", ",", " ", 
             RowBox[{"data", "[", "\"\<indices\>\"", "]"}]}], " ", "]"}], "/", 
           RowBox[{
            RowBox[{"data", "[", "\"\<length\>\"", "]"}], "^", "2"}]}], " ", 
          "-", " ", "1"}], " ", ")"}], "^", "2"}], "/", "8"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     "bar_spring"}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "All", ",", " ", "m", ",", " ", "positions", ",", " ", "bar"}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"data", "[", "\"\<stiffness\>\"", "]"}], " ", "/.", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$defaultStiffness", "[", "spring", "]"}]}]}], ")"}], "  ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"#2", ",", "#3"}], "]"}], "^", "2"}], "/", "2"}], "&"}], 
        ",", " ", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"data", "[", "\"\<strain\>\"", "]"}], ",", " ", 
          RowBox[{"displacementLength", "[", 
           RowBox[{"arbitraryPositions", ",", " ", 
            RowBox[{"data", "[", "\"\<indices\>\"", "]"}]}], "]"}], ",", " ", 
          
          RowBox[{"data", "[", "\"\<length\>\"", "]"}]}], " ", "}"}]}], " ", 
       "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     "bar_fold"}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "All", ",", " ", "m", ",", " ", "positions", ",", " ", "bar"}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<torsionalStiffness\>\"", "]"}], "  ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$defaultStiffness", "[", "fold", "]"}]}]}], " ", ")"}], " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"foldAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", 
            RowBox[{"data", "[", "\"\<indices\>\"", "]"}]}], "]"}], " ", "-", 
          " ", 
          RowBox[{"data", "[", "\"\<angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     "angles_angleJoint"}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "All", ",", " ", "m", ",", " ", "positions", ",", " ", "angles"}], 
        " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<angularStiffness\>\"", "]"}], "  ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$defaultStiffness", "[", "angleJoint", "]"}]}]}], " ", 
       ")"}], " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"turningAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", 
            RowBox[{"data", "[", "\"\<indices\>\"", "]"}]}], "]"}], " ", "-", 
          " ", 
          RowBox[{"data", "[", "\"\<angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"componentEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     "ind_joint"}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cellDataInternal", "[", " ", 
        RowBox[{
        "All", ",", " ", "m", ",", " ", "positions", ",", " ", "ind"}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<pinningStiffness\>\"", "]"}], "  ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$defaultStiffness", "[", "joint", "]"}]}]}], " ", ")"}], 
      " ", 
      RowBox[{"(", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", "#2", "]"}], "^", "2"}], "/", "2"}], "&"}], 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"data", "[", "\"\<constraint\>\"", "]"}], " ", ",", " ", 
           RowBox[{"arbitraryPositions", "[", 
            RowBox[{"[", " ", 
             RowBox[{"data", "[", "\"\<indices\>\"", "]"}], " ", "]"}], 
            "]"}]}], " ", "}"}]}], " ", "]"}], " ", ")"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"componentEnergy", "[", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "ind_face"}], " ", "]"}], ":=", 
  RowBox[{"{", "0", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"componentEnergy", "[", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "ind_Polygon"}], " ", "]"}], ":=", 
  RowBox[{"{", "0", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"componentEnergy", "[", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "ind_Line"}], " ", "]"}], ":=", 
  RowBox[{"{", "0", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"componentEnergy", "[", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
    "ind_Point"}], " ", "]"}], ":=", 
  RowBox[{"{", "0", "}"}]}]}], "Code",
 CellLabel->
  "In[785]:=",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"]
}, Closed]],

Cell[CellGroupData[{

Cell["compiledMechanismEnergy[]", "Subsection",ExpressionUUID->"fdb08a27-d392-4708-8d7c-e22a50d18359"],

Cell[CellGroupData[{

Cell["compiledMechanismEnergy[] data structure", "Subsubsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<variables\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"compiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", "\n", 
  RowBox[{"StringJoin", "[", "\n", "\t", 
   RowBox[{"\"\<compiledMechanismEnergy[\>\"", ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "variables", "]"}], "<", "10"}], ",", "\n", 
      "\t\t", 
      RowBox[{"ToString", "[", "variables", "]"}], ",", "\n", "\t\t", 
      RowBox[{"\"\<{\>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"First", "[", "variables", "]"}], "<>", "\"\<...\>\"", "<>", 
         
         RowBox[{"Last", "[", "variables", "]"}], "<>", "\"\<}\>\""}], 
        "]"}]}]}], "\n", "\t", "]"}], ",", "\n", "\t", "\"\<]\>\""}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[794]:=",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compiledMechanismEnergy", "[", 
     RowBox[{
      RowBox[{"variables_", "?", "VectorQ"}], ",", "energy_CompiledFunction", 
      ",", "gradient_CompiledFunction"}], "]"}], "[", "\"\<data\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"compiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<energy\>\"", "]"}], "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", "data_"}],
    "]"}], " ", ":=", " ", 
  RowBox[{"energy", "[", 
   RowBox[{"pos", ",", "data"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"compiledMechanismEnergy", "[", 
      RowBox[{
      "variables_List", ",", "energy_CompiledFunction", ",", 
       "gradient_CompiledFunction"}], "]"}], "[", "\"\<gradient\>\"", "]"}], 
    "[", 
    RowBox[{
     RowBox[{"pos_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
     "data_"}], "]"}], " ", ":=", " ", 
   RowBox[{"gradient", "[", 
    RowBox[{"pos", ",", "data"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "[", 
   RowBox[{"v_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", 
  RowBox[{"compiledMechanismEnergy", "[", 
   RowBox[{"v", ",", "energy", ",", "gradient"}], "]"}]}]}], "Code",
 CellLabel->
  "In[796]:=",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
compiledMechanismEnergyQ[], compiledNumericalMechanismEnergyQ[]\
\>", "Subsubsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"compiledMechanismEnergyQ", "[", 
   RowBox[{"compiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", "variables", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compiledMechanismEnergyQ", "[", "_", "]"}], ":=", "False"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", 
   RowBox[{"compiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", 
   RowBox[{"variables", ",", "NumericQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", "_", "]"}], ":=", 
  "False"}]}], "Code",
 CellLabel->
  "In[800]:=",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],

Cell[CellGroupData[{

Cell["compiledMechanismEnergy[]", "Subsubsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "compiledMechanismEnergy", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<constraints\>\"", "\[Rule]", "None"}], ",", " ", 
     RowBox[{"\"\<additional\>\"", "\[Rule]", "0"}], ",", " ", 
     RowBox[{"\"\<pattern\>\"", " ", "\[Rule]", " ", "_"}]}], "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[804]:=",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compiledMechanismEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"pos", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"actualPositions", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"pos", "===", "Automatic"}], ",", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "pos"}], "]"}]}], 
      "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"Module", "[", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"compiledMechanismEnergyInternal", "[", 
           RowBox[{"m", ",", "actualPositions", ",", 
            RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}], ",", 
            RowBox[{"OptionValue", "[", "\"\<additional\>\"", "]"}], ",", " ", 
            RowBox[{"OptionValue", "[", "\"\<pattern\>\"", "]"}]}], " ", 
           "]"}]}], "}"}], ",", "\n", "\t", 
        RowBox[{"res", "/;", 
         RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "]"}], "/;", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "actualPositions"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"compiledMechanismEnergy", "::", "pos"}], "=", 
   "\"\<Provided positions do not correspond to mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"compiledMechanismEnergy", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"pos", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_Rule", "|", "Automatic"}], "]"}]}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"compiledMechanismEnergy", "::", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[805]:=",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compiledMechanismEnergyInternal", "[", 
   RowBox[{
   "m_", ",", "positions_", ",", "constraints_", ",", "additional_", ",", " ",
     "pattern_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"symbols", ",", 
      RowBox[{"energy", "=", 
       RowBox[{
        RowBox[{"mechanismEnergy", "[", 
         RowBox[{"m", ",", "positions", ",", 
          RowBox[{"\"\<constraints\>\"", "\[Rule]", "constraints"}], ",", " ", 
          RowBox[{"\"\<pattern\>\"", " ", "\[Rule]", " ", "_"}]}], "]"}], "+",
         "additional"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"symbols", "=", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"energy", ",", "_Symbol", ",", "Infinity"}], "]"}], ",", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"NumericQ", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}]}], 
     ";", "\n", "\n", "\t", 
     RowBox[{"Check", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"compiledMechanismEnergy", "[", "\n", "\t\t\t", 
        RowBox[{"symbols", ",", "\n", "\t\t\t", 
         RowBox[{"compileEnergy", "[", 
          RowBox[{
          "m", ",", "energy", ",", "symbols", ",", "$compilationTarget"}], 
          "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"compileGradient", "[", 
          RowBox[{
          "m", ",", "energy", ",", "symbols", ",", "$compilationTarget"}], 
          "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", "$Failed"}], "\n", 
      "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[808]:=",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compileEnergy", "[", 
   RowBox[{"m_", ",", "energy_", ",", "symbols_", ",", "compiler_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"body", ",", "\n", 
      RowBox[{"variables", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", 
      "injector", ",", "c", ",", "\n", "dataInjector", ",", "data"}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"injector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"variables", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "variables"}], "]"}]}], ")"}]}], "]"}]}]}],
      ";", "\n", "\t", 
     RowBox[{"dataInjector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"symbols", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "symbols"}], "]"}]}], ")"}]}], "]"}]}]}], 
     ";", "\n", "\t", 
     RowBox[{"body", "=", 
      RowBox[{
       RowBox[{"energy", "/.", "injector"}], "/.", "dataInjector"}]}], ";", 
     "\n", "\t", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{
       RowBox[{"Hold", "[", "Compile", "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c", ",", "_Real", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"data", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        "\n", "\t\t", "body", ",", "\n", "\t\t", 
        RowBox[{"RuntimeOptions", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<EvaluateSymbolically\>\"", "->", "False"}], "}"}]}], 
        ",", "\n", "\t\t", 
        RowBox[{"CompilationTarget", "->", "compiler"}]}], "\n", "\t", "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[809]:=",ExpressionUUID->"92ffeed0-c3d9-4161-bdf3-36b3e40fc494"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compileGradient", "[", 
   RowBox[{"m_", ",", "energy_", ",", "symbols_", ",", "compiler_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"body", ",", "\n", 
      RowBox[{"variables", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", 
      "injector", ",", "c", ",", "\n", "dataInjector", ",", "data"}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"injector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"variables", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "variables"}], "]"}]}], ")"}]}], "]"}]}]}],
      ";", "\n", "\t", 
     RowBox[{"dataInjector", "=", 
      RowBox[{"Dispatch", "@", 
       RowBox[{"Thread", "[", 
        RowBox[{"symbols", "->", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "symbols"}], "]"}]}], ")"}]}], "]"}]}]}], 
     ";", "\n", "\t", 
     RowBox[{"body", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"energy", ",", 
          RowBox[{"{", "variables", "}"}]}], "]"}], "/.", "injector"}], "/.", 
       "dataInjector"}]}], ";", "\n", "\t", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{
       RowBox[{"Hold", "[", "Compile", "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c", ",", "_Real", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"data", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        "\n", "\t\t", "body", ",", "\n", "\t\t", 
        RowBox[{"RuntimeOptions", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<EvaluateSymbolically\>\"", "->", "False"}], "}"}]}], 
        ",", "\n", "\t\t", 
        RowBox[{"CompilationTarget", "->", "compiler"}]}], "\n", "\t", "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[810]:=",ExpressionUUID->"fc66d059-3816-4b04-a69b-80ebdc0fcb74"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["local rigidity", "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],

Cell[CellGroupData[{

Cell["constraintMatrix[]", "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "constraintMatrix", "]"}], "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
      
      RowBox[{"\"\<pattern\>\"", " ", "\[Rule]", " ", "_"}], ",", " ", 
      RowBox[{"\"\<rules\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"constraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"constraintMatrix", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintMatrix", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "positions_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"constraintMatrices", ",", " ", "vars"}], " ", "}"}], ",", 
      "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"vars", " ", "=", " ", 
        RowBox[{"Check", "[", " ", 
         RowBox[{
          RowBox[{"reduceVariables", "[", " ", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}], " ", ",", 
            " ", 
            RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], " ", "]"}], 
          ",", " ", "$Failed"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"constraintMatrices", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"vars", " ", "===", " ", "$Failed"}], ",", "\n", "\n", 
          "\t\t", 
          RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"constraintEquations", "[", " ", 
             RowBox[{"m", ",", " ", "positions", ",", " ", "1", ",", " ", 
              RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", 
               RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}], 
              ",", " ", 
              RowBox[{"\"\<pattern\>\"", "\[Rule]", 
               RowBox[{"OptionValue", "[", "\"\<pattern\>\"", "]"}]}], ",", 
              " ", 
              RowBox[{
              "\"\<output\>\"", " ", "\[Rule]", " ", "vertexDisplacement"}]}],
              " ", "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"Flatten", "[", 
             RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}]}], "\n", 
           "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
          RowBox[{"CoefficientArrays", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"constraintEquations", "[", " ", 
              RowBox[{"m", ",", " ", "positions", ",", " ", "1", ",", " ", 
               RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", 
                RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}], 
               ",", " ", 
               RowBox[{"\"\<pattern\>\"", "\[Rule]", 
                RowBox[{"OptionValue", "[", "\"\<pattern\>\"", "]"}]}], ",", 
               " ", 
               RowBox[{
               "\"\<output\>\"", " ", "\[Rule]", " ", 
                "vertexDisplacement"}]}], " ", "]"}], " ", "//.", " ", 
             RowBox[{"OptionValue", "[", "\"\<rules\>\"", "]"}]}], ",", "\n", 
            "\t\t\t", "vars"}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}], 
       ";", "\n", "\t", "\n", "\t", 
       RowBox[{"Which", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"constraintMatrices", "\[Equal]", 
          RowBox[{"{", 
           RowBox[{"{", "}"}], "}"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{
             RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
             RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "]"}], 
          "}"}], ",", "\n", "\t\t", "\n", "\t\t", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"positions", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Chop", "[", " ", 
            RowBox[{
             RowBox[{"N", "[", 
              RowBox[{"constraintMatrices", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ".", " ", 
             RowBox[{"N", "[", 
              RowBox[{"constraintMatrices", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}], " ", 
           "\[NotEqual]", " ", "0"}]}], ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"outputStressError", "[", " ", 
           RowBox[{"N", "[", 
            RowBox[{"constraintMatrices", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "]"}], ";", "\n", 
          "\t\t\t", 
          RowBox[{"constraintMatrices", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "\n", "\t\t", "\n", "\t\t", 
         "True", ",", "\n", "\t\t\t", 
         RowBox[{"constraintMatrices", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{"vertexCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintMatrix", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"Except", "[", " ", "__Rule", " ", "]"}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"constraintMatrix", "::", "vcoord"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"outputStressError", "[", " ", "vec_", " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"stresses", " ", "=", " ", 
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{
          RowBox[{"Transpose", "[", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "vec", "]"}], "]"}], ",", " ", "vec"}], 
            "}"}], " ", "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Chop", "[", 
             RowBox[{"Abs", "[", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], " ", "]"}], "]"}], " ", ">", 
            " ", "0"}], " ", "&"}]}], " ", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"Message", "[", " ", 
      RowBox[{
       RowBox[{"constraintMatrix", "::", "stressed"}], ",", " ", 
       RowBox[{
        RowBox[{"N", "[", "vec", "]"}], " ", ".", " ", 
        RowBox[{"N", "[", "vec", "]"}]}], ",", " ", "stresses"}], " ", 
      "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"{", "}"}]}], "]"}], ":=", "vars"}], "\n", 
 RowBox[{
  RowBox[{"reduceVariables", "[", 
   RowBox[{"vars_", ",", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Rule", "[", " ", 
        RowBox[{
         RowBox[{"vertexDisplacement", "[", 
          RowBox[{"_", ",", "_"}], "]"}], ",", " ", "_"}], " ", "]"}], ".."}],
       "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"Variables", "[", 
     RowBox[{"vars", " ", "//.", " ", "rules"}], "]"}], ",", 
    "_vertexDisplacement"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"reduceVariables", "[", 
    RowBox[{"vars_", ",", " ", "notRules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"constraintMatrix", "::", "rules"}], "]"}], ";", " ", "vars"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintMatrix", "::", "vcoord"}], "=", 
   "\"\<Vertex positions do not match mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintMatrix", "::", "stressed"}], "=", 
   "\"\<Warning: Mechanism is stressed (residual is `1`) at constraints `2`. \
Constraint matrix may not be useful.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"constraintMatrix", "::", "rules"}], "=", 
   "\"\<Replacement rules are not of the form { vertexDisplacement[v1, c1] -> \
.., .. }.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[811]:=",ExpressionUUID->"d218d248-ce20-48a5-af65-68e0c4272cc5"]
}, Closed]],

Cell[CellGroupData[{

Cell["zeroModes[], selfStresses[]", "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "zeroModes", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "constraintMatrix", "]"}], ",", " ", 
      RowBox[{"Options", "[", "Eigensystem", "]"}], " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"Tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "10"}], ")"}]}]}], "}"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"zeroModes", "::", "num"}], "=", 
    "\"\<The constraint matrix is not numerical.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"zeroModes", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"zeroModes", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"zeroModes", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "positions_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"mat", "=", 
         RowBox[{"constraintMatrix", "[", 
          RowBox[{"m", ",", " ", "positions", ",", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "constraintMatrix", "]"}]}], " ", 
            "]"}]}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"dim", "=", 
         RowBox[{"embeddingDimension", "[", "m", "]"}]}], ",", "\n", "\t", 
        "evalues"}], "\n", "}"}], ",", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"evalues", " ", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Transpose", "[", "mat", "]"}], " ", ".", " ", "mat"}],
               ",", " ", 
              RowBox[{"FilterRules", "[", " ", 
               RowBox[{
                RowBox[{"{", "opt", "}"}], ",", " ", 
                RowBox[{"Options", "[", "Eigenvalues", "]"}]}], " ", "]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"evalues", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
            RowBox[{"-", 
             RowBox[{"Count", "[", 
              RowBox[{
               RowBox[{"evalues", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "]"}]}]}], 
           "]"}]}]}], "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", " ", "@", " ", 
          RowBox[{"MatrixQ", "[", 
           RowBox[{"mat", ",", " ", "NumericQ"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"zeroModes", "::", "num"}], "]"}], ";", " ", "False"}], 
         ",", " ", "True"}], "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"numericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"zeroModes", "::", "vcoord"}], "=", 
   "\"\<Vertex positions do not match mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"zeroModes", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"Except", "[", " ", "__Rule", " ", "]"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"zeroModes", "::", "vcoord"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[822]:=",ExpressionUUID->"ae1e713b-def1-4284-a80c-7c15c0aec447"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "selfStresses", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "constraintMatrix", "]"}], ",", " ", 
      RowBox[{"Options", "[", "Eigensystem", "]"}], " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"Tolerance", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "10"}], ")"}]}]}], "}"}]}], " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"selfStresses", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"selfStresses", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selfStresses", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "positions_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"mat", "=", 
         RowBox[{"constraintMatrix", "[", 
          RowBox[{"m", ",", " ", "positions", ",", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "constraintMatrix", "]"}]}], " ", 
            "]"}]}], "]"}]}], ",", "\n", "\t", "evalues"}], "\n", "}"}], ",", 
      
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"evalues", " ", "=", " ", 
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{
              RowBox[{"mat", " ", ".", " ", 
               RowBox[{"Transpose", "[", "mat", "]"}]}], " ", ",", " ", 
              RowBox[{"FilterRules", "[", " ", 
               RowBox[{
                RowBox[{"{", "opt", "}"}], ",", " ", 
                RowBox[{"Options", "[", "Eigenvalues", "]"}]}], " ", "]"}]}], 
             "]"}], ",", " ", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"evalues", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"-", 
            RowBox[{"Count", "[", 
             RowBox[{
              RowBox[{"evalues", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "]"}]}]}], "]"}]}],
         "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", " ", "@", " ", 
          RowBox[{"MatrixQ", "[", 
           RowBox[{"mat", ",", " ", "NumericQ"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"selfStresses", "::", "num"}], "]"}], ";", " ", "False"}], 
         ",", " ", "True"}], "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"numericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selfStresses", "::", "vcoord"}], "=", 
   "\"\<Vertex positions do not match mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"selfStresses", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"Except", "[", " ", "__Rule", " ", "]"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"selfStresses", "::", "vcoord"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[828]:=",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],

Cell[CellGroupData[{

Cell["stressMatrix[]", "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"stressMatrix", "[", " ", 
     RowBox[{"m", ",", " ", "vec"}], " ", "]"}], " ", "returns", " ", "a", 
    " ", "stress", " ", "matrix", " ", "associated", " ", "with", " ", "the", 
    " ", "stress", " ", "vector", " ", 
    RowBox[{"vec", ".", " ", "The"}], " ", 
    RowBox[{"(", 
     RowBox[{"i", ",", "j"}], ")"}], " ", "component", " ", "of", " ", "the", 
    " ", "stress", " ", "matrix", " ", "is", " ", "the", " ", "negative", " ",
     "of", " ", "the", " ", "corresponding", "\n", "stress", " ", "vector", 
    " ", "component", " ", 
    RowBox[{"(", 
     RowBox[{"and", " ", "zero", " ", "otherwise"}], ")"}], " ", "and", " ", 
    "diagonal", " ", "components", " ", "are", " ", "chosen", " ", "so", " ", 
    "that", " ", "rows", " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", "Columns"}], " ", "should", " ", "also", 
    " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", 
     RowBox[{"(", 
      RowBox[{
      "see", " ", "Connelly", " ", "on", " ", "generic", " ", "global", " ", 
       "rigidity"}], ")"}]}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"stressMatrix", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "stressVector_"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
        "offDiagonalComponents", ",", " ", "diagonalComponents", ",", " ", 
         RowBox[{"edges", " ", "=", " ", 
          RowBox[{"connectivity", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{
            "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
           "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"offDiagonalComponents", " ", "=", " ", "\n", "\t", 
         RowBox[{
          RowBox[{"(", "\n", "\t\t", 
           RowBox[{"(*", "symmetrize", "*)"}], "\n", "\t\t", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", " ", "+", " ", 
              RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], " ", ")"}], 
           "\n", "\t", ")"}], " ", "@", " ", 
          RowBox[{"SparseArray", "[", " ", "\n", "\t\t", 
           RowBox[{
            RowBox[{"Thread", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "\[Rule]", " ", 
              RowBox[{"-", "stressVector"}]}], " ", "]"}], ",", "\n", "\t\t", 
            
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
              RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "}"}]}],
            "\n", "\t", "]"}]}]}], ";", "\n", "\t", 
        RowBox[{"diagonalComponents", " ", "=", " ", 
         RowBox[{"SparseArray", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", "#"}], "}"}], "&"}], " ", "/@", " ", 
               RowBox[{"Range", "[", " ", 
                RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "]"}]}],
               ")"}], " ", "\[Rule]", " ", 
             RowBox[{"(", 
              RowBox[{"-", " ", 
               RowBox[{"Total", " ", "/@", " ", 
                RowBox[{"Map", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"offDiagonalComponents", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "]"}], 
                   "&"}], ",", " ", 
                  RowBox[{"connectivity", "[", 
                   RowBox[{"m", ",", " ", 
                    RowBox[{
                    "\"\<vertices\>\"", " ", "\[Rule]", " ", 
                    "\"\<edges\>\""}]}], "]"}], " ", ",", " ", 
                  RowBox[{"{", "2", "}"}]}], " ", "]"}]}]}], ")"}]}], " ", 
            "]"}], ",", "\n", "\t\t", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
             RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "}"}]}], 
          "\n", "\t", "]"}]}], ";", "\n", "\t", "\n", "\t", 
        RowBox[{
        "offDiagonalComponents", " ", "+", " ", "diagonalComponents"}]}]}], 
      "\n", "]"}], " ", "/;", " ", 
     RowBox[{"stressMatrixArgumentsQ", "[", " ", 
      RowBox[{"m", ",", " ", "stressVector"}], " ", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"stressMatrix", "::", "svec"}], "=", 
     "\"\<Stress vector is not a vector.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"stressMatrix", "::", "len"}], "=", 
     "\"\<Stress vector length is not the same as the number of edges.\>\""}],
     ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"stressMatrixArgumentsQ", "[", " ", 
     RowBox[{"m_", ",", " ", "stressVector_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"Which", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Not", " ", "@", " ", 
       RowBox[{"VectorQ", "[", " ", "stressVector", " ", "]"}]}], " ", ",", 
      "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"stressMatrix", "::", "svec"}], "]"}], ";", " ", "False"}], 
      ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"m", "[", "\"\<edges\>\"", "]"}], "]"}], " ", "\[NotEqual]", 
       " ", 
       RowBox[{"Length", "[", "stressVector", "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"stressMatrix", "::", "len"}], "]"}], ";", " ", "False"}], 
      ",", "\n", "\t", "True", ",", " ", "True"}], "\n", "]"}]}]}]}]], "Code",\

 CellLabel->
  "In[833]:=",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]],

Cell[CellGroupData[{

Cell["infinitesimalMotions[]", "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "infinitesimalMotions", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<constraints\>\"", "\[Rule]", "None"}], ",", " ", 
       RowBox[{"\"\<variables\>\"", "\[Rule]", "Automatic"}]}], "}"}], ",", 
     " ", 
     RowBox[{"Options", "[", "NullSpace", "]"}]}], " ", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[837]:=",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"positions", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"actualPositions", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"positions", "===", "Automatic"}], ",", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "positions"}], 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"infinitesimalMotionsInternal", "[", 
           RowBox[{"m", ",", "actualPositions", ",", 
            RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}], ",", 
            RowBox[{"OptionValue", "[", "\"\<variables\>\"", "]"}], ",", " ", 
            
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", 
              RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], "]"}]}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "\t ", "]"}], " ", "/;",
       " ", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "actualPositions"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "failed"}], "=", 
   "\"\<Failed to find an appropriate solution. Check the constraints.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "pos"}], "=", 
   "\"\<Positions do not match those of mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"infinitesimalMotions", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"Automatic", "|", "_Rule"}], "]"}]}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", "\n", "\t", 
   RowBox[{"Which", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"infinitesimalMotions", "::", "pos"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t\t", "True", ",", " ", "False"}], "\n", "\t", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[838]:=",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "var"}], "=", 
   "\"\<Variables listed are not of the form vertexDisplacement[n,c].\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "sing"}], "=", 
   "\"\<Jacobian matrix is singular. Recovering using generic \
variables.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "jac"}], "=", 
   "\"\<Jacobian matrix may not be invertible. Choosing different \
displacements may give better results.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"infinitesimalMotions", "::", "lin"}], "=", 
   "\"\<Found `1` linear motions so `1` displacements are needed.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[842]:=",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"infinitesimalMotionsInternal", "[", 
   RowBox[{
   "m_", ",", "positions_", ",", "inputConstraints_", ",", "v_", ",", 
    "nullspaceOptions_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"matrix", ",", "dependencies", ",", "solution"}], "}"}], ",", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"variables", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}]}], ",", "\n", 
        "\n", 
        RowBox[{"(*", 
         RowBox[{
         "collect", " ", "all", " ", "the", " ", "constraints", " ", "valid", 
          " ", "to", " ", "2", "nd", " ", "order", " ", "in", " ", "the", " ",
           "displacements"}], " ", "*)"}], "\n", 
        RowBox[{"equations", "=", 
         RowBox[{"constraintEquationsInternal", "[", 
          RowBox[{
          "m", ",", " ", "positions", ",", " ", "2", ",", " ", "_", ",", " ", 
           "inputConstraints", ",", " ", "vertexDisplacement"}], "]"}]}]}], 
       "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"linearize", " ", "the", " ", "equations"}], "*)"}], "\n", 
      "\t", 
      RowBox[{
       RowBox[{"matrix", "=", 
        RowBox[{"CoefficientArrays", "[", 
         RowBox[{"equations", ",", "variables", ",", " ", 
          RowBox[{"\"\<Symmetric\>\"", "\[Rule]", "True"}]}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"(*", "\n", "\t", 
        RowBox[{
         RowBox[{
         "Find", " ", "dependencies", " ", "among", " ", "the", " ", "linear",
           " ", 
          RowBox[{"equations", ".", "\n", "\n", "\t", "When"}], " ", "the", 
          " ", "constraints", " ", "arise", " ", "only", " ", "from", " ", 
          "edge", " ", "stretching"}], ",", " ", 
         RowBox[{
          RowBox[{
          "these", " ", "dependences", " ", "are", " ", "the", " ", "self"}], 
          "-", 
          RowBox[{"stresses", "."}]}]}], "\n", "\t", "*)"}], "\n", "\t", 
       RowBox[{"dependencies", "=", 
        RowBox[{"Orthogonalize", "[", 
         RowBox[{"NullSpace", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"matrix", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "nullspaceOptions"}],
           "]"}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "linear", " ", "displacements", " ", "that", " ", "are", 
         " ", "allowed"}], "*)"}], "\n", "\t", 
       RowBox[{"solution", "=", 
        RowBox[{"linearMotionsToDisplacementRules", "[", 
         RowBox[{"m", ",", 
          RowBox[{"linearMotions", "[", 
           RowBox[{"m", ",", 
            RowBox[{"matrix", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "nullspaceOptions"}], "]"}],
           ",", "v"}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Which", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"solution", "===", "$Failed"}], ",", " ", "$Failed", ",", 
         "\n", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Length", "[", "solution", "]"}], ">", "0"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"Expand", "[", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "analytical", " ", "processing", " ", "that", " ", "I", " ", 
             "prefer"}], ",", " ", 
            RowBox[{
            "but", " ", "should", " ", "not", " ", "take", " ", "a", " ", 
             "long", " ", "time", " ", "to", " ", "perform"}]}], "*)"}], "\n",
           "\t\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"vertexDisplacement", "[", "m", "]"}], ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "dependencies", "]"}], ">", "0"}], ",", 
               RowBox[{"dependencies", " ", ".", " ", "equations"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], " ", "/.",
            " ", 
           RowBox[{"Dispatch", "[", "solution", "]"}]}], "\n", "\t\t\t", 
          "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "no", " ", "solution", " ", "but", " ", "no", " ", "errors", " ", 
           "either"}], "*)"}], "\n", "\t\t", "True", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"infinitesimalMotions", "::", "failed"}], "]"}], ";", "\n",
           "\t\t\t", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"{", "}"}]}], "}"}]}]}], "\n", "\t", "]"}]}]}], "\n", 
     "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[846]:=",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_"}], "]"}], 
   ":=", 
   RowBox[{
    RowBox[{"{", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_List"}], 
    "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{"(*", 
     RowBox[{"preprocess", " ", "arguments"}], "*)"}], "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"displacements", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "inputDisplacements", "}"}], "]"}]}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"Module", "[", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "x", ",", "y", ",", "c", ",", "rules", ",", "jacobianMatrix", ",", 
          "inverseJacobian", ",", "displacementIndices"}], "}"}], ",", "\n", 
        "\t", 
        RowBox[{
         RowBox[{"displacementIndices", "=", 
          RowBox[{
           RowBox[{"displacements", "/.", 
            RowBox[{
             RowBox[{"vertexDisplacement", "[", 
              RowBox[{"x_", ",", "y_"}], "]"}], "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<x\>\"", "\[Rule]", "1"}], ",", 
             RowBox[{"\"\<y\>\"", "\[Rule]", "2"}], ",", 
             RowBox[{"\"\<z\>\"", "\[Rule]", "3"}]}], "}"}]}]}], ";", "\n", 
         "\t", 
         RowBox[{"jacobianMatrix", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"linearMotions", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"Sequence", "@@", "#"}]}], "]"}], "]"}], "&"}], "/@", 
           "displacementIndices"}]}], ";", "\n", "\t", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "if", " ", "inverting", " ", "the", " ", "jacobian", " ", "fails", 
            " ", "entirely"}], ",", " ", 
           RowBox[{
            RowBox[{"we", "'"}], "ll", " ", "need", " ", "to", " ", "deal", 
            " ", "with", " ", 
            RowBox[{"that", "."}]}]}], "*)"}], "\n", "\t", 
         RowBox[{"inverseJacobian", "=", 
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"Inverse", "[", "jacobianMatrix", "]"}], ",", "\n", 
            "\t\t", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"infinitesimalMotions", "::", "sing"}], "]"}], ";", 
             "\n", "\t\t", 
             RowBox[{"Return", "[", 
              RowBox[{"linearMotionsToDisplacementRules", "[", 
               RowBox[{"m", ",", "linearMotions", ",", "Automatic"}], "]"}], 
              "]"}]}], ",", "\n", "\t\t", 
            RowBox[{"Inverse", "::", "sing"}]}], "\n", "\t", "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
          "warn", " ", "that", " ", "the", " ", "jacobian", " ", "matrix", 
           " ", "is", " ", "almost", " ", "singular"}], "*)"}], "\n", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Det", "[", "jacobianMatrix", "]"}], "]"}], "<", 
            RowBox[{"10", "^", 
             RowBox[{"(", 
              RowBox[{"-", "16"}], ")"}]}]}], ",", 
           RowBox[{"Message", "[", 
            RowBox[{"infinitesimalMotions", "::", "jac"}], "]"}]}], "]"}], 
         ";", "\n", "\n", "\t", 
         RowBox[{"rules", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Array", "[", 
             RowBox[{"c", ",", 
              RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], "->", 
            RowBox[{"inverseJacobian", " ", ".", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "displacements", "}"}], "]"}]}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Array", "[", 
               RowBox[{"c", ",", 
                RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], " ", 
              ".", " ", "linearMotions"}], "/.", "rules"}], "]"}]}], 
          "]"}]}]}], "\n", "\n", "]"}], "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "&&", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"displacements", ",", 
         RowBox[{"{", "__vertexDisplacement", "}"}]}], "]"}]}]}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "Automatic"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", "=", 
        RowBox[{"Unique", "[", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{"v", ",", 
            RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
          " ", "linearMotions"}], "]"}]}], "]"}]}], "\n", "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"linearMotionsToDisplacementRules", "[", 
   RowBox[{"m_", ",", "linearMotions_", ",", "c_Symbol"}], "]"}], ":=", "\n", 
  "\t", 
  RowBox[{
   RowBox[{"Thread", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Array", "[", 
        RowBox[{"c", ",", 
         RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
       " ", "linearMotions"}], "]"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}]}], "Code",
 CellLabel->
  "In[847]:=",ExpressionUUID->"acf53775-617a-4c64-abce-1ca8d0a00a98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"linearMotionsToDisplacementRules", "[", 
   RowBox[{"m_", ",", "linearMotions_", ",", "displacements_"}], "]"}], ":=", 
  
  RowBox[{"Which", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Not", "[", 
     RowBox[{"MatchQ", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "displacements", "}"}], "]"}], ",", 
       RowBox[{"{", "__vertexDisplacement", "}"}]}], "]"}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"infinitesimalMotions", "::", "var"}], "]"}], ";", "\n", "\t\t",
      "$Failed"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[NotEqual]", 
     RowBox[{"Length", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "displacements", "}"}], "]"}], "]"}]}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"infinitesimalMotions", "::", "lin"}], ",", 
       RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], ";", "\n", 
     "\t\t", "$Failed"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
    "$Failed"}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[851]:=",ExpressionUUID->"cc158a20-c3f3-4d03-9644-fc087c2118ee"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["energy minimization", "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],

Cell[CellGroupData[{

Cell["minimizeEnergy[]", "Subsection",ExpressionUUID->"73422a9f-f78f-40d0-b5cf-0b9ca1818700"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "minimizeEnergy", "]"}], "=", 
   RowBox[{"Join", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<initial\>\"", "->", "Automatic"}], "}"}], ",", " ", 
     RowBox[{"Options", "[", "mechanismEnergy", "]"}], ",", " ", 
     RowBox[{"Options", "[", "FindMinimum", "]"}]}], " ", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"minimizeEnergy", ",", "HoldRest"}], "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergy", "::", "badinitial"}], "=", 
   "\"\<Initial conditions are not well-formed numeric positions matching the \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergy", "::", "data"}], "=", 
   "\"\<Data for compiled function not a vector of numerical values.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergy", "::", "energy"}], "=", 
   "\"\<Energy is not numerical at initial condition.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "In[852]:=",ExpressionUUID->"3e97a0de-a970-4d5c-ab00-d0691ecf3e87"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergy", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"energy", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"minimizeEnergyInternal", "[", " ", 
        RowBox[{"m", ",", " ", "energy", ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<initial\>\"", "]"}], ",", " ", 
         RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"minimizeEnergyInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "energyExpression_", ",", " ", "initial_", ",", " ", 
    "opt_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{"minimizeEnergyComputeEnergy", "[", 
        RowBox[{"m", ",", " ", "energyExpression", ",", " ", "opt"}], " ", 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"minimizeEnergyInitialPositions", "[", 
        RowBox[{"m", ",", " ", "initial"}], " ", "]"}]}], ",", "\n", "\t", 
      "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"energy", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"initialPositions", " ", "=!=", " ", "$Failed"}]}], ",", "\n", 
      "\t\t", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"minimizeEnergyMinimize", "[", " ", 
         RowBox[{
         "m", ",", " ", "energy", ",", " ", "initialPositions", ",", " ", 
          "opt"}], " ", "]"}]}], ";", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", " ", 
           RowBox[{"Dimensions", "[", "initial", "]"}], " ", "]"}], " ", 
          "\[Equal]", " ", "3"}], ",", " ", "res", ",", " ", 
         RowBox[{"First", "[", "res", "]"}]}], " ", "]"}]}], ",", "\n", 
      "\t\t", "$Failed"}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[857]:=",ExpressionUUID->"cad7656e-ac79-4b74-bd8a-9e72c0644b19"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"parse", " ", "the", " ", "arguments"}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"minimizeEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"{", "initialPositions", "}"}], " ", "/;", " ", 
     RowBox[{"numericCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "initialPositions"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayQ", "[", 
          RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"initialPositions", " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "initialPositions", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], " ", "\[Equal]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}]}]}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"minimizeEnergy", "::", "badinitial"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{"(*", "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic", ",", " ", "options_"}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"mechanismEnergy", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"{", "options", "}"}], ",", " ", 
        RowBox[{"Options", "[", "mechanismEnergy", "]"}]}], "]"}]}], " ", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "compiledNumericalMechanismEnergyQ"}], ",", " ",
       "options_"}], " ", "]"}], " ", ":=", " ", "energy"}], "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "analyticEnergy_", ",", " ", "options_"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"analyticEnergy", " ", "/;", " ", 
     RowBox[{"analyticEnergyQ", "[", 
      RowBox[{"analyticEnergy", ",", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "]"}]}]}], "\n", "\n", 
   
   RowBox[{
    RowBox[{"minimizeEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "compiledMechanismEnergyQ"}], ",", " ", 
      "options_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"minimizeEnergy", "::", "data"}], "]"}], ";", " ", "$Failed"}],
      ")"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "badEnergy_", ",", " ", "options_"}], " ", "]"}],
     " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"minimizeEnergy", "::", "energy"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}]}]}]], "Code",
 CellLabel->
  "In[859]:=",ExpressionUUID->"9357dc4e-c4b9-4298-9e85-37d87e5d3ebc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergyMinimize", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"energy_", "?", "compiledNumericalMechanismEnergyQ"}], ",", " ", 
     "initialPositions_", ",", " ", "options_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"constraintData", " ", "=", " ", 
        RowBox[{"processConstraintEquations", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t\t", 
          RowBox[{"constraintEquations", "[", " ", 
           RowBox[{"m", ",", " ", 
            RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
            "Infinity", ",", " ", 
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "\"\<output\>\"", " ", "\[Rule]", " ", "vertexPosition"}], ",",
                " ", 
               RowBox[{"FilterRules", "[", 
                RowBox[{"options", ",", " ", 
                 RowBox[{"Options", "[", "constraintEquations", "]"}]}], " ", 
                "]"}]}], " ", "}"}]}]}], " ", "]"}]}], "\n", "\t", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], ",", " ", 
       RowBox[{"allVariables", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", "\t", 
       "variables", ",", " ", "variableSpecifications", ",", " ", 
       "linearConstraints", ",", "\n", "\t", "\n", "\t", 
       RowBox[{"minimizationOptions", " ", "=", " ", 
        RowBox[{"Sequence", " ", "@@", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}]}], ",", 
       "\n", "\t", "minimizationResults"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"variables", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{
        "constraintData", "[", " ", "\"\<constrained positions\>\"", " ", 
         "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"variableSpecifications", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"allVariables", ",", " ", 
            RowBox[{"Flatten", " ", "@", " ", "#"}]}], "}"}], " ", "]"}], 
         "&"}], " ", "/@", " ", "initialPositions"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "turn", " ", "the", " ", "solved", " ", "linear", " ", "constraints", 
        " ", "into", " ", "simple", " ", "linear", " ", "constraints"}], 
       "*)"}], "\n", "\t", 
      RowBox[{"linearConstraints", " ", "=", " ", 
       RowBox[{"Equal", " ", "@@@", " ", 
        RowBox[{
        "constraintData", "[", " ", "\"\<linear solutions\>\"", " ", 
         "]"}]}]}], ";", "\n", "\n", "\t", 
      RowBox[{"minimizationResults", " ", "=", " ", 
       RowBox[{"Cases", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Map", "[", " ", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"executeMinimizationCompiled", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"energy", "[", "\"\<energy\>\"", "]"}], "[", 
               RowBox[{"variables", ",", " ", "data"}], "]"}], ",", " ", 
              "linearConstraints", ",", " ", "#", ",", " ", 
              RowBox[{
               RowBox[{"energy", "[", "\"\<gradient\>\"", "]"}], "[", 
               RowBox[{"variables", ",", "data"}], "]"}], ",", " ", 
              "minimizationOptions"}], " ", "]"}], "&"}], ",", "\n", 
           "\t\t\t ", "variableSpecifications"}], "\n", "\t\t", "]"}], ",", 
         "\n", "\t\t", "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"_", "?", "NumericQ"}], ",", " ", 
           RowBox[{"{", "__Rule", "}"}]}], "}"}]}], "\n", "\t", "]"}]}], ";", 
      "\n", "\t", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
          RowBox[{
           RowBox[{
           "constraintData", "[", "\"\<constrained positions\>\"", "]"}], " ",
            "/.", " ", 
           RowBox[{"Dispatch", "[", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "]"}]}]}], " ", "}"}], 
        "&"}], " ", "/@", " ", "minimizationResults"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"executeMinimizationCompiled", "[", " ", 
    RowBox[{
    "energy_", ",", " ", "constraints_", ",", " ", "initial_", ",", " ", 
     "gradient_", ",", " ", "options_"}], " ", "]"}], ":=", " ", "\n", "\t", 
   RowBox[{"(", 
    RowBox[{"FindMinimum", " ", "@@", " ", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"{", 
         RowBox[{"energy", ",", " ", "constraints"}], "}"}], " ", "]"}], ",", 
       " ", 
       RowBox[{"Sequence", " ", "@@", " ", "initial"}], ",", " ", 
       RowBox[{"Gradient", " ", "\[RuleDelayed]", " ", "gradient"}], ",", " ",
        "options"}], " ", "\n", "\t", "}"}]}], ")"}]}], "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"minimizeEnergyMinimize", "[", " ", 
    RowBox[{
    "m_", ",", " ", "energy_", ",", " ", "initialPositions_", ",", " ", 
     "options_"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"constraintData", " ", "=", " ", 
        RowBox[{"processConstraintEquations", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "\n", "\t\t", 
          RowBox[{"constraintEquations", "[", " ", 
           RowBox[{"m", ",", " ", 
            RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
            "Infinity", ",", " ", 
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
               "\"\<output\>\"", " ", "\[Rule]", " ", "vertexPosition"}], ",",
                " ", 
               RowBox[{"FilterRules", "[", 
                RowBox[{"options", ",", " ", 
                 RowBox[{"Options", "[", "constraintEquations", "]"}]}], " ", 
                "]"}]}], " ", "}"}]}]}], " ", "]"}]}], "\n", "\t", "]"}]}], 
       ",", "\n", "\t", "constrainedEnergy", ",", " ", 
       "variableSpecifications", ",", "\n", "\t", 
       RowBox[{"minimizationOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{"options", ",", 
          RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", "\n", 
       "\t", "minimizationResults"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"variableSpecifications", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"dynamicVariables", "[", " ", 
          RowBox[{"#", ",", " ", "constraintData"}], " ", "]"}], "&"}], " ", "/@",
         " ", "initialPositions"}]}], ";", "\n", "\t", 
      RowBox[{"constrainedEnergy", " ", "=", " ", 
       RowBox[{"energy", " ", "/.", " ", 
        RowBox[{"constraintData", "[", "\"\<linear solutions\>\"", "]"}]}]}], 
      ";", "\n", "\n", "\t", 
      RowBox[{"minimizationResults", " ", "=", " ", 
       RowBox[{"Cases", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Map", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"executeMinimizationAnalytic", "[", " ", 
             RowBox[{
             "constrainedEnergy", ",", " ", "#", ",", " ", 
              "minimizationOptions"}], " ", "]"}], " ", "&"}], " ", ",", " ", 
           "variableSpecifications"}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"_", "?", "NumericQ"}], ",", " ", 
           RowBox[{"{", "__Rule", "}"}]}], "}"}]}], "\n", "\t", "]"}]}], ";", 
      "\n", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
          RowBox[{
           RowBox[{
           "constraintData", "[", "\"\<constrained positions\>\"", "]"}], " ",
            "/.", " ", 
           RowBox[{"Dispatch", "[", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "]"}]}]}], " ", "}"}], 
        "&"}], " ", "/@", " ", "minimizationResults"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"executeMinimizationAnalytic", "[", " ", 
   RowBox[{"energy_", ",", " ", "data_", ",", " ", "options_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"FindMinimum", " ", "@@", " ", 
   RowBox[{"{", 
    RowBox[{"energy", ",", " ", "data", ",", " ", 
     RowBox[{"Sequence", " ", "@@", " ", "options"}]}], " ", 
    "}"}]}]}]}], "Code",
 CellLabel->
  "In[868]:=",ExpressionUUID->"9c6a83e3-770d-4c96-b30e-1d9e09063824"]
}, Closed]],

Cell[CellGroupData[{

Cell["repeatedMinimizeEnergy[]", "Subsection",ExpressionUUID->"89d07baf-29ff-40b5-a155-6ae60f411f0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "repeatedMinimizeEnergy", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<MaxEnergy\>\"", "->", "Infinity"}], "}"}], ",", 
     RowBox[{"Options", "[", "randomDisplacements", "]"}], ",", 
     RowBox[{"Options", "[", "minimizeEnergy", "]"}]}], "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[872]:=",ExpressionUUID->"638cc8ea-f6a2-4655-af57-88c8956ec0e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"repeatedMinimizeEnergy", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"energy", " ", ":", " ", 
     RowBox[{"Except", "[", "_Integer", "]"}], " ", ":", " ", "Automatic"}], 
    ",", " ", "num_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"positions", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<initial\>\"", "]"}], "===", 
         "Automatic"}], ",", " ", 
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "\"\<initial\>\"", "]"}]}], " ", "]"}]}], 
     " ", "}"}], ",", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"repeatedMinimizeEnergyInternal", "[", " ", 
         RowBox[{
         "m", ",", " ", "positions", ",", " ", "energy", ",", " ", "num", ",",
           " ", 
          RowBox[{"OptionValue", "[", "\"\<MaxEnergy\>\"", "]"}], ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "repeatedMinimizeEnergyInternal"}]}]}], "\n", "]"}]}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[873]:=",ExpressionUUID->"bfcda39c-0644-435b-8e52-c73864eff3b0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"repeatedMinimizeEnergyInternal", "[", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", "energy_", ",", " ", 
     RowBox[{"number_Integer", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"maxEnergy", " ", ":", " ", 
      RowBox[{
       RowBox[{"_", "?", "NumericQ"}], "|", "Infinity"}]}], ",", " ", 
     "options_"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"displacementOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "randomDisplacements", "]"}]}], "]"}]}], 
        ",", "\n", 
        RowBox[{"minimizationOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "minimizeEnergy", "]"}]}], "]"}]}], ",", 
        "\n", "res"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"minimizeEnergyInternal", "[", " ", 
         RowBox[{"m", ",", " ", "energy", ",", " ", 
          RowBox[{"randomDisplacements", "[", " ", 
           RowBox[{
           "positions", ",", " ", "number", ",", " ", "displacementOptions"}],
            " ", "]"}], ",", " ", "minimizationOptions"}], " ", "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"res", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", "\[LessEqual]", " ", 
            "maxEnergy"}], " ", "&"}]}], " ", "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"res", " ", "=!=", " ", "minimizeEnergyInternal"}], " ", "&&",
          " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}]}], "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{"numericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"repeatedMinimizeEnergyInternal", "[", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "energy_", ",", " ", "number_", 
    ",", " ", "maxEnergy_", ",", " ", "options_"}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"numericCoordinatesQ", "[", 
       RowBox[{"m", ",", " ", "positions"}], "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"repeatedMinimizeEnergy", "::", "pos"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", " ", 
      RowBox[{
       RowBox[{"IntegerQ", "[", "number", "]"}], " ", "&&", " ", 
       RowBox[{"number", " ", ">", " ", "0"}]}], " ", "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"repeatedMinimizeEnergy", "::", "numneg"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", " ", 
      RowBox[{
       RowBox[{"NumericQ", "[", "maxEnergy", "]"}], " ", "||", " ", 
       RowBox[{"maxEnergy", " ", "\[Equal]", " ", "Infinity"}]}], " ", "]"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"repeatedMinimizeEnergy", "::", "max"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", " ", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[874]:=",ExpressionUUID->"57ce5909-974b-48ac-99ba-c0f6a103d000"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"repeatedMinimizeEnergy", "::", "numneg"}], "=", 
   "\"\<Number of repetitions should be a positive integer.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"repeatedMinimizeEnergy", "::", "max"}], "=", 
   "\"\<Option \\\"MaxEnergy\\\" does not have a valid value.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"repeatedMinimizeEnergy", "::", "pos"}], "=", 
   "\"\<Initial positions are not numerical and valid.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "In[876]:=",ExpressionUUID->"f5756fcc-4f46-47b4-924b-eae4cdafeb53"]
}, Closed]],

Cell[CellGroupData[{

Cell["tallyRepeatedMinimizeEnergy[]", "Subsection",ExpressionUUID->"fdbbe4fd-2f77-4cbe-91b2-9746fc3ae9f9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "tallyRepeatedMinimizeEnergy", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Options", "[", "repeatedMinimizeEnergy", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"SameTest", " ", "\[Rule]", " ", "Automatic"}], "}"}]}], 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tallyRepeatedMinimizeEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", "num_Integer", ",", 
     RowBox[{"tol", ":", 
      RowBox[{"_", "?", "NumericQ"}], ":", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "6"}], ")"}]}]}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"repeatedMinimizeEnergy", "[", 
        RowBox[{"m", ",", "num", ",", "opt"}], "]"}]}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"tallyRepeatedMinimizeEnergyOutput", "[", 
       RowBox[{"res", ",", "tol"}], "]"}], "/;", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], "=!=", 
       "repeatedMinimizeEnergy"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tallyRepeatedMinimizeEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", "energy_", ",", "num_Integer", 
     ",", 
     RowBox[{"tol", ":", 
      RowBox[{"_", "?", "NumericQ"}], ":", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "6"}], ")"}]}]}], ",", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"repeatedMinimizeEnergy", "[", 
        RowBox[{"m", ",", "energy", ",", "num", ",", "opt"}], "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"tallyRepeatedMinimizeEnergyOutput", "[", 
       RowBox[{"res", ",", "tol"}], "]"}], "/;", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], "=!=", 
       "repeatedMinimizeEnergy"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tallyRepeatedMinimizeEnergyOutput", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "_"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"tallyRepeatedMinimizeEnergyOutput", "[", 
   RowBox[{"res_", ",", "tol_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"output", "=", 
      RowBox[{"Transpose", "[", "res", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"output", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
      RowBox[{"Tally", "[", 
       RowBox[{
        RowBox[{"output", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#1", "-", "#2"}], "]"}], ".", 
           RowBox[{"Flatten", "[", 
            RowBox[{"#1", "-", "#2"}], "]"}]}], "<", 
          RowBox[{"tol", "^", "2"}]}], "&"}]}], " ", "]"}]}], "}"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[879]:=",ExpressionUUID->"db89b083-f6f8-4ef9-be0e-ba614297f87d"]
}, Closed]],

Cell[CellGroupData[{

Cell["dynamicalSystem[], dynamicalSystemEquations[]", "Subsection",ExpressionUUID->"f771deb2-a4a2-400f-b0c2-7680cc5b00ac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "dynamicalSystemEquations", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<constraints\>\"", "\[Rule]", "None"}], ",", " ", 
      RowBox[{"(*", 
       RowBox[{"a", " ", "list", " ", "of", " ", "constraints"}], "*)"}], 
      "\n", "\t", 
      RowBox[{"\"\<mass\>\"", "\[Rule]", "1"}], ",", "\n", "\t", 
      RowBox[{"\"\<drag\>\"", "\[Rule]", "0"}], ",", "\n", "\t", 
      RowBox[{"\"\<additional\>\"", "\[Rule]", "0"}]}], " ", 
     RowBox[{"(*", 
      RowBox[{
      "additional", " ", "terms", " ", "to", " ", "add", " ", "to", " ", 
       "the", " ", "energy"}], "*)"}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "dynamicalSystem", "]"}], "=", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "dynamicalSystemEquations", "]"}], ",", "\n", 
     "\t", 
     RowBox[{"Options", "[", "NDSolve", "]"}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "In[884]:=",ExpressionUUID->"4315eb56-9425-419f-b071-2e2f797f402d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "::", "drag"}], "=", 
   "\"\<Option \\\"drag\\\" cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "::", "mass"}], "=", 
   "\"\<Option \\\"mass\\\" cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "::", "pos"}], "=", 
   "\"\<Not a valid set of positions.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "::", "var"}], "=", 
   "\"\<Variables should be of the form {variable, time}.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "In[886]:=",ExpressionUUID->"f36975ed-8d9f-4ec4-babc-cce78e40b1a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"validEquationsParamQ", "[", 
   RowBox[{"value_", "?", "NumericQ"}], "]"}], ":=", 
  RowBox[{"value", " ", "\[GreaterEqual]", " ", "0"}]}], "\n", 
 RowBox[{
  RowBox[{"validEquationsParamQ", "[", 
   RowBox[{"value", " ", ":", " ", 
    RowBox[{"Except", "[", "_List", "]"}]}], "]"}], ":=", 
  RowBox[{"Not", "[", 
   RowBox[{"NumericQ", "[", "value", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"validEquationsParamQ", "[", "_", "]"}], ":=", "False"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags_", "?", "validEquationsParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"drags", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validEquationsParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"drags", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "drags", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationDrags", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandEquationDrags", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"dynamicalSystemEquations", "::", "drag"}], "]"}], ";", " ", 
     "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses_", "?", "validEquationsParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"masses", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validEquationsParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"masses", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "masses", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandEquationMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"None", " ", "|", " ", "0"}]}], "]"}], ":=", "None"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandEquationMasses", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"dynamicalSystemEquations", "::", "mass"}], "]"}], ";", " ", 
     "$Failed"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], ":=", 
  RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "positions_"}], "]"}], ":=", 
  RowBox[{"positions", " ", "/;", " ", 
   RowBox[{"vertexPositionsQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"evaluateEquationPositions", "[", 
   RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"dynamicalSystemEquations", "::", "pos"}], "]"}], ";", " ", 
    "$Failed"}], ")"}]}]}], "Code",
 CellLabel->
  "In[890]:=",ExpressionUUID->"bd2ebe0c-ce7f-45f7-bfc1-49aa1aec9a95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystemEquations", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"variableName_Symbol", ",", " ", "timeVariable_Symbol"}], "}"}],
      ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"mechanismEnergy", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}]}], 
          "]"}], " ", "+", " ", 
         RowBox[{"OptionValue", "[", "\"\<additional\>\"", "]"}]}]}], ",", 
       "\n", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"evaluateEquationPositions", "[", 
         RowBox[{"m", ",", "initialPositions"}], "]"}]}], ",", "\n", 
       RowBox[{"drags", " ", "=", " ", 
        RowBox[{"expandEquationDrags", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<drag\>\"", "]"}]}], "]"}]}], ",", 
       "\n", 
       RowBox[{"masses", " ", "=", " ", 
        RowBox[{"expandEquationMasses", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<mass\>\"", "]"}]}], "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"dynamicalSystemEquationsInternal", "[", 
           RowBox[{
           "m", ",", " ", "positions", ",", " ", "variableName", ",", " ", 
            "timeVariable", ",", " ", "masses", ",", " ", "drags", ",", " ", 
            "energy"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"drags", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"masses", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"positions", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"variableName", " ", "=!=", " ", "timeVariable"}]}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"dynamicalSystemEquations", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"dynamicalSystemEquations", "::", "vars"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"dynamicalSystemEquations", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"initialPositions_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"Except", "[", "_List", "]"}], " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"dynamicalSystemEquations", "::", "vars"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[904]:=",ExpressionUUID->"1b30499b-3dd1-4129-8c80-b3664c73ca01"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystem", "::", "drag"}], "=", 
   "\"\<Option \\\"drag\\\" cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystem", "::", "mass"}], "=", 
   "\"\<Option \\\"mass\\\" cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystem", "::", "timespec"}], "=", 
   "\"\<The last argument should be of the form {time variable, start time, \
end time} with start and end times being numerical and the time variable \
being a Symbol.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[907]:=",ExpressionUUID->"e01b2e15-065d-44be-a333-3bb058054274"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"validDynamicalParamQ", "[", "value_", "]"}], ":=", 
   RowBox[{
    RowBox[{"NumericQ", "[", "value", "]"}], " ", "&&", " ", 
    RowBox[{"value", " ", "\[GreaterEqual]", " ", "0"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags_", "?", "validDynamicalParamQ"}]}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"drags", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"drags", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validDynamicalParamQ"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"drags", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "drags", "]"}], "\[Equal]", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalDrags", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"MeshCellCount", "[", 
     RowBox[{"m", ",", "0"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandDynamicalDrags", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"dynamicalSystem", "::", "drag"}], "]"}], ";", " ", "$Failed"}],
     ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "expandDynamicalMasses", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"None", " ", "|", " ", "0"}]}], "]"}], ":=", " ", 
  "None"}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses_", "?", "validDynamicalParamQ"}]}], "]"}], ":=", " ", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"masses", ",", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"masses", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "validDynamicalParamQ"}], "}"}]}]}], "]"}], ":=", 
  " ", 
  RowBox[{"masses", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "masses", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"expandDynamicalMasses", "[", 
   RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"dynamicalSystem", "::", "mass"}], "]"}], ";", " ", "$Failed"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "In[910]:=",ExpressionUUID->"a850dc3b-621f-4bd6-aaee-873395b1bb45"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parseInitialConditions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "Automatic"}]}]}], "]"}], 
  ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"parsePositions", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], ",", " ", 
    RowBox[{"parseVelocities", "[", 
     RowBox[{"m", ",", " ", "None"}], "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"parseInitialConditions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"positions", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "Automatic"}]}], ",", 
      " ", 
      RowBox[{"velocities_", "?", "MatrixQ"}]}], "}"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"parsePositions", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], ",", " ", 
    RowBox[{"parseVelocities", "[", 
     RowBox[{"m", ",", " ", "velocities"}], "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parseInitialConditions", "[", 
    RowBox[{"m_", ",", " ", "_"}], "]"}], ":=", "$Failed"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parsePositions", "[", 
   RowBox[{"m_", ",", " ", "Automatic"}], "]"}], ":=", 
  RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parsePositions", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions_", "?", "MatrixQ"}]}], "]"}], ":=", 
  RowBox[{"positions", " ", "/;", " ", 
   RowBox[{"numericCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"parsePositions", "[", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"positions_", "?", "MatrixQ"}]}], "]"}], ":=", "$Failed"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseVelocities", "[", 
   RowBox[{"m_", ",", " ", "velocities_"}], "]"}], ":=", " ", 
  RowBox[{"velocities", " ", "/;", " ", 
   RowBox[{"numericCoordinatesQ", "[", 
    RowBox[{"m", ",", " ", "velocities"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"parseVelocities", "[", 
   RowBox[{"m_", ",", " ", "None"}], "]"}], ":=", " ", 
  RowBox[{"ConstantArray", "[", 
   RowBox[{"0", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], ",", " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "In[920]:=",ExpressionUUID->"d0b96612-939a-4fb2-8f6e-a03a87c8f541"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dynamicalSystem", "[", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"initialConditions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"time_Symbol", ",", " ", 
       RowBox[{"start_", "?", "NumericQ"}], ",", " ", 
       RowBox[{"end_", "?", "NumericQ"}]}], "}"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"mechanismEnergy", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}]}], 
          "]"}], " ", "+", " ", 
         RowBox[{"OptionValue", "[", "\"\<additional\>\"", "]"}]}]}], ",", 
       "\n", 
       RowBox[{"parsedInitialConditions", " ", "=", " ", 
        RowBox[{"parseInitialConditions", "[", 
         RowBox[{"m", ",", " ", "initialConditions"}], "]"}]}], ",", "\n", 
       RowBox[{"drags", " ", "=", " ", 
        RowBox[{"expandDynamicalDrags", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<drag\>\"", "]"}]}], "]"}]}], ",", 
       "\n", 
       RowBox[{"masses", " ", "=", " ", 
        RowBox[{"expandDynamicalMasses", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<mass\>\"", "]"}]}], "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"dynamicalSystemInternal", "[", 
           RowBox[{
           "m", ",", " ", "masses", ",", " ", "drags", ",", " ", 
            "parsedInitialConditions", ",", " ", "energy", ",", " ", 
            RowBox[{"{", 
             RowBox[{"time", ",", " ", "start", ",", " ", "end"}], "}"}], ",",
             " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", " ", 
              RowBox[{"Options", "[", "NDSolve", "]"}]}], "]"}]}], " ", 
           "]"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{
       RowBox[{"drags", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"masses", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"parsedInitialConditions", " ", "=!=", " ", "$Failed"}]}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"dynamicalSystem", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "_", ",", "_"}], "}"}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"dynamicalSystem", "::", "timespec"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"dynamicalSystem", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"_", " ", ":", " ", "Automatic"}], ",", " ", 
    RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"dynamicalSystem", "::", "timespec"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[928]:=",ExpressionUUID->"d9dde884-5ff3-466a-b915-739df74cc11a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dynamicalSystemEquationsInternal", "[", 
   RowBox[{
   "m_", ",", " ", "initialPositions_", ",", " ", "v_", ",", " ", 
    "timeVariable_", ",", " ", "masses_", ",", " ", "drags_", ",", " ", 
    "energy_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pinnedVertices", " ", "=", " ", 
       RowBox[{"Dispatch", "[", " ", 
        RowBox[{"solveLinearEquations", "[", 
         RowBox[{
          RowBox[{"constraintEquations", "[", 
           RowBox[{"m", ",", "initialPositions", ",", "Infinity", ",", 
            RowBox[{"\"\<output\>\"", "\[Rule]", "vertexPosition"}]}], "]"}], 
          ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}], 
        " ", "]"}]}], ",", " ", "\n", "variables", ",", " ", "gradient", ",", 
      " ", "equationSystem", ",", " ", "i", ",", " ", "j", ",", " ", "t"}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"variables", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"vertexPosition", "[", "m", "]"}], " ", "/.", " ", 
        "pinnedVertices"}], " ", "/.", " ", 
       RowBox[{
        RowBox[{"vertexPosition", "[", 
         RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"i", ",", " ", "j"}], "]"}], "[", "t", "]"}]}]}]}], ";", 
     "\n", "\t", 
     RowBox[{"gradient", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", " ", 
         RowBox[{
          RowBox[{"D", "[", " ", 
           RowBox[{"energy", ",", " ", 
            RowBox[{"{", " ", 
             RowBox[{"Flatten", "[", " ", 
              RowBox[{"vertexPosition", "[", "m", "]"}], " ", "]"}], " ", 
             "}"}]}], "]"}], ",", " ", 
          RowBox[{"embeddingDimension", "[", "m", "]"}]}], " ", "]"}], " ", "/.",
         " ", "pinnedVertices"}], " ", "/.", " ", 
       RowBox[{
        RowBox[{"vertexPosition", "[", 
         RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"i", ",", " ", "j"}], "]"}], "[", "t", "]"}]}]}]}], ";", 
     "\n", "\t", "\n", "\t", 
     RowBox[{"equationSystem", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"masses", " ", "===", " ", "None"}], ",", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", " ", 
             RowBox[{"Dimensions", "[", "initialPositions", "]"}]}], " ", 
            "]"}], ",", " ", 
           RowBox[{
            RowBox[{"DiagonalMatrix", "[", " ", "masses", " ", "]"}], " ", 
            ".", " ", 
            RowBox[{"D", "[", " ", 
             RowBox[{"variables", ",", " ", 
              RowBox[{"{", 
               RowBox[{"t", ",", " ", "2"}], "}"}]}], " ", "]"}]}]}], " ", 
          "]"}], " ", "\n", "\t\t\t", "+", " ", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", " ", "drags", " ", "]"}], " ", ".", 
          " ", 
          RowBox[{"D", "[", " ", 
           RowBox[{"variables", ",", " ", 
            RowBox[{"{", 
             RowBox[{"t", ",", " ", "1"}], "}"}]}], " ", "]"}]}], " ", "+", 
         " ", "gradient"}], "\n", "\t", "]"}], " ", "/.", " ", 
       RowBox[{"t", "\[Rule]", "timeVariable"}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "we", " ", "need", " ", "to", " ", "explicitly", " ", "eliminate", " ", 
       "the", " ", "equations", " ", "that", " ", "are", " ", "predetermined",
        " ", "by", " ", "the", " ", "pinned", " ", "vertices", " ", "or", " ",
        "there", " ", "will", " ", "be", " ", "too", " ", "many", " ", 
       "equations"}], "*)"}], "\n", "\t", 
     RowBox[{"Pick", "[", " ", 
      RowBox[{"equationSystem", ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{"NumericQ", "[", "#", "]"}], " ", "]"}], "&"}], " ", "/@", 
        " ", 
        RowBox[{"Flatten", "[", "variables", "]"}]}]}], " ", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[931]:=",ExpressionUUID->"78b2f67f-dc48-44fe-9713-fc2cd8b3ffff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dynamicalSystemInternal", "[", 
   RowBox[{"m_", ",", " ", "masses_", ",", " ", "drags_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"initialPositions_", ",", " ", "initialVelocities_"}], "}"}], 
    ",", " ", "energy_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"timeVariable_", ",", " ", "start_", ",", " ", "end_"}], "}"}], 
    ",", " ", "opt_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "equations", ",", " ", "v", ",", " ", "variables", ",", " ", 
      "processedVariables", ",", " ", "solution", ",", " ", "i", ",", " ", 
      "j", ",", " ", "\n", 
      RowBox[{"pinnedVertices", " ", "=", " ", 
       RowBox[{"Dispatch", "[", " ", 
        RowBox[{"solveLinearEquations", "[", 
         RowBox[{
          RowBox[{"constraintEquations", "[", 
           RowBox[{"m", ",", "initialPositions", ",", "Infinity", ",", 
            RowBox[{"\"\<output\>\"", "\[Rule]", "vertexPosition"}]}], "]"}], 
          ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}], 
        " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"list", " ", "only", " ", "the", " ", "non"}], "-", 
      RowBox[{"pinned", " ", "variables"}]}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"variables", " ", "=", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"vertexPosition", "[", "m", "]"}], " ", "/.", " ", 
         "pinnedVertices"}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"vertexPosition", "[", 
          RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"i", ",", " ", "j"}], "]"}], "[", "timeVariable", 
          "]"}]}]}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"equations", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{"the", " ", "dynamical", " ", "system", " ", "equations"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"dynamicalSystemEquationsInternal", "[", 
          RowBox[{
          "m", ",", " ", "initialPositions", ",", " ", "v", ",", " ", 
           "timeVariable", ",", " ", "masses", ",", " ", "drags", ",", " ", 
           "energy"}], "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"initial", " ", "positions"}], "*)"}], "\n", "\t\t", 
         RowBox[{"Select", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"variables", " ", "/.", " ", 
               RowBox[{"timeVariable", "\[Rule]", "0"}]}], ")"}], " ", "-", 
             " ", 
             RowBox[{"Flatten", "[", "initialPositions", "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{
            RowBox[{"Not", "[", " ", 
             RowBox[{"NumericQ", "[", " ", "#", " ", "]"}], " ", "]"}], 
            "&"}]}], " ", "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"initial", " ", "velocities", " ", "if", " ", "needed"}], 
          "*)"}], "\n", "\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"masses", " ", "===", " ", "None"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"Select", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", " ", 
                RowBox[{
                 RowBox[{"D", "[", " ", 
                  RowBox[{"variables", ",", " ", "timeVariable"}], " ", "]"}],
                  " ", "/.", " ", 
                 RowBox[{"timeVariable", "\[Rule]", "0"}]}], " ", ")"}], " ", 
               "-", " ", 
               RowBox[{"Flatten", "[", "initialVelocities", "]"}]}], ")"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"Not", "[", " ", 
               RowBox[{"NumericQ", "[", " ", "#", " ", "]"}], " ", "]"}], 
              "&"}]}], " ", "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "}"}],
        "]"}]}], ";", "\n", "\t", "\n", "\t", 
     RowBox[{"solution", " ", "=", " ", 
      RowBox[{"NDSolve", "[", " ", 
       RowBox[{
        RowBox[{"Thread", "[", " ", 
         RowBox[{"equations", " ", "\[Equal]", " ", "0"}], " ", "]"}], ",", 
        "  ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{"variables", ",", " ", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"NumericQ", "[", "#", "]"}], " ", "]"}], " ", "&"}]}], 
         " ", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"timeVariable", ",", " ", "start", ",", " ", "end"}], " ", 
         "}"}], ",", " ", "opt"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "did", " ", "NDSolve", " ", "return", " ", "a", " ", "list", " ", "of", 
       " ", 
       RowBox[{"rules", "?"}]}], "*)"}], "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MatchQ", "[", 
        RowBox[{"solution", ",", 
         RowBox[{"{", 
          RowBox[{"{", "__Rule", "}"}], "}"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"vertexPosition", "[", "m", "]"}], " ", "/.", " ", 
          "pinnedVertices"}], " ", "/.", " ", 
         RowBox[{
          RowBox[{"vertexPosition", "[", 
           RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", "\[RuleDelayed]", " ", 
          
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"i", ",", " ", "j"}], "]"}], "[", "timeVariable", 
           "]"}]}]}], " ", "/.", " ", 
        RowBox[{"solution", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", "\n", "\t\t", "$Failed"}], 
      "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[932]:=",ExpressionUUID->"e09521af-e51f-454e-acee-9ae42f06aee1"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global rigidity", "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],

Cell[CellGroupData[{

Cell["isometricTrajectory[]", "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "isometricTrajectory", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<initial\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
      "\n", "\t", 
      RowBox[{"\"\<constraints\>\"", " ", "\[Rule]", " ", "None"}], ",", "\n",
       "\t", 
      RowBox[{"Method", " ", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"\"\<Minimization\>\"", ",", " ", 
         RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
          RowBox[{"10", "^", "4"}]}]}], "}"}]}], ",", "\n", "\t", 
      RowBox[{"Tolerance", " ", "\[Rule]", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "8"}], ")"}]}]}], ",", "\n", "\t", 
      RowBox[{"\"\<stepsize\>\"", " ", "\[Rule]", " ", "0.1"}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<compile\>\"", " ", "\[Rule]", " ", "False"}]}], "\n", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"isometricTrajectory", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "directionSpecification_", 
    ",", " ", 
    RowBox[{"steps_", "?", "stepNumberQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"positions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<initial\>\"", "]"}], " ", "===", 
          " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<initial\>\"", "]"}]}], " ", "]"}]}],
       ",", "\n", "\t", 
      RowBox[{"methodOptions", " ", "=", " ", 
       RowBox[{"Sequence", " ", "@@", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Rest", "[", 
          RowBox[{"OptionValue", "[", "Method", "]"}], "]"}], "]"}]}]}]}], 
     "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", " ", "=", " ", 
         RowBox[{"isometricTrajectoryStepperInternal", "[", " ", "\n", "\t\t", 
          RowBox[{"m", ",", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{"positions", ",", " ", "directionSpecification"}], "}"}], 
           ",", " ", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{"steps", ",", " ", 
             RowBox[{"OptionValue", "[", "\"\<stepsize\>\"", "]"}]}], "}"}], 
           ",", " ", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<compile\>\"", "]"}], ",", " ", 
             RowBox[{"constraintVector", "[", 
              RowBox[{"positions", ",", 
               RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}], 
              "]"}]}], "}"}], ",", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"First", "[", 
              RowBox[{"OptionValue", "[", "Method", "]"}], "]"}], ",", " ", 
             RowBox[{"OptionValue", "[", "Tolerance", "]"}], ",", " ", 
             "methodOptions"}], " ", "}"}]}], "\n", "\t\t", "]"}]}], "}"}], 
       ",", "\n", "\t\t", 
       RowBox[{"res", " ", "/;", " ", 
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], " ", "===", " ", "List"}]}]}], 
      "\n", "\t", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"directionQ", "[", " ", 
       RowBox[{"m", ",", " ", "directionSpecification"}], " ", "]"}], " ", "&&",
       " ", 
      RowBox[{"positionsQ", "[", " ", 
       RowBox[{"m", ",", " ", "positions"}], " ", "]"}], " ", "&&", " ", 
      RowBox[{"stepsizeQ", "[", 
       RowBox[{"OptionValue", "[", "\"\<stepsize\>\"", "]"}], "]"}], " ", "&&",
       " ", 
      RowBox[{"compileQ", "[", " ", 
       RowBox[{"OptionValue", "[", "\"\<compile\>\"", "]"}], " ", "]"}]}]}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[933]:=",ExpressionUUID->"f766b5d0-2b0a-4658-998d-1d2ffeb53538"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "steps"}], "=", 
   "\"\<Number of steps is not a positive integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"stepNumberQ", "[", " ", 
   RowBox[{"num_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepNumberQ", "[", " ", "num_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", " ", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"isometricTrajectory", "::", "steps"}], "]"}], ";", " ", 
     "False"}], " ", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "dir"}], "=", 
   "\"\<Initial direction is not numerical.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "dir2"}], "=", 
   "\"\<Initial direction is not a valid set of vertex displacements.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"directionQ", "[", " ", 
   RowBox[{"m_", ",", " ", "v_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"True", " ", "/;", " ", 
   RowBox[{"numericCoordinatesQ", "[", 
    RowBox[{"m", ",", " ", "v"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"directionQ", "[", " ", 
    RowBox[{"m_", ",", " ", "v_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"vertexCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "v"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"isometricTrajectory", "::", "dir2"}], " ", "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"isometricTrajectory", "::", "dir"}], " ", "]"}], ";", " ", 
      "False"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "pos"}], "=", 
   "\"\<Initial positions are not numerical or are not compatible with \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "pos2"}], "=", 
   "\"\<Initial positions are not a valid set of vertex positions.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"positionsQ", "[", " ", 
   RowBox[{"m_", ",", " ", "v_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"True", " ", "/;", " ", 
   RowBox[{"numericCoordinatesQ", "[", 
    RowBox[{"m", ",", " ", "v"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"positionsQ", "[", " ", 
    RowBox[{"m_", ",", " ", "v_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"vertexCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "v"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"isometricTrajectory", "::", "pos2"}], " ", "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"isometricTrajectory", "::", "pos"}], " ", "]"}], ";", " ", 
      "False"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "stepsize"}], "=", 
   "\"\<Option \\\"stepsize\\\" should be a positive, real number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"stepsizeQ", "[", " ", 
   RowBox[{"num_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepsizeQ", "[", " ", "num_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"isometricTrajectory", "::", "stepsize"}], " ", "]"}], ";", " ",
      "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectory", "::", "compile"}], "=", 
   "\"\<Option \\\"compile\\\" should be a Boolean indicating if the \
constraints should be precompiled or compiled energy.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"compileQ", "[", " ", 
   RowBox[{"x_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"compileQ", "[", " ", 
   RowBox[{"x_", "?", "compiledMechanismEnergyQ"}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"compileQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"isometricTrajectory", "::", "compile"}], "]"}], ";", " ", 
    "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[935]:=",ExpressionUUID->"d1684dc1-97c6-4969-af60-093d8fe550b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"isometricTrajectoryStepperInternal", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"initialPositions_", ",", "initialDirection_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"steps_", ",", "stepsize_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"energy_", ",", "constraintVec_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"method_", ",", "tolerance_", ",", "stepOptions_"}], "}"}]}], 
   "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"energyTemp", ",", "out"}], "}"}], ",", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"variables", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vertexDisplacement", "[", "m", "]"}], "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"blankPositions", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"positions", "=", 
         RowBox[{"Flatten", "[", "initialPositions", "]"}]}], ",", "\n", "\t", 
        RowBox[{"initialDirectionNormalized", "=", 
         RowBox[{"Normalize", "[", 
          RowBox[{"Flatten", "[", "initialDirection", "]"}], "]"}]}], ",", 
        "\n", "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{
         "figure", " ", "out", " ", "the", " ", "constraints", " ", "we", " ",
           "want", " ", "to", " ", "use", " ", "at", " ", "1", "st", " ", 
          "order", " ", "and", " ", "at", " ", "infinite", " ", "order"}], 
         "*)"}], "\n", "\t", 
        RowBox[{"firstOrderConstraints", "=", 
         RowBox[{"Join", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"constraintEquationsInternal", "[", " ", 
            RowBox[{"m", ",", " ", 
             RowBox[{"vertexPosition", "[", "m", "]"}], ",", " ", "1", ",", 
             " ", "_", ",", " ", "None", ",", " ", "vertexDisplacement"}], 
            " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"reduceConstraintToOrder", "[", 
            RowBox[{
             RowBox[{"vertexPosition", "[", "m", "]"}], ",", "constraintVec", 
             ",", "1"}], "]"}]}], "\n", "\t\t", "]"}]}], ",", "\n", "\n", 
        "\t", 
        RowBox[{"fullConstraints", "=", 
         RowBox[{"Join", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"constraintEquationsInternal", "[", " ", 
            RowBox[{
            "m", ",", " ", "initialPositions", ",", " ", "Infinity", ",", " ",
              "_", ",", " ", "None", ",", " ", "vertexPosition"}], " ", "]"}],
            ",", "\n", "\t\t", "constraintVec"}], "\n", "\t\t", "]"}]}]}], 
       "\n", "\t", "}"}], ",", "\n", "\n", "\t", 
      RowBox[{"With", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"{", "\n", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
          "this", " ", "function", " ", "will", " ", "find", " ", "the", " ", 
           "numerical", " ", "1", "st", " ", "order", " ", "constraint", " ", 
           "matrix"}], "*)"}], "\n", "\t", 
         RowBox[{
          RowBox[{"constraintMatFunction", "=", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"CoefficientArrays", "[", 
               RowBox[{
                RowBox[{"firstOrderConstraints", "/.", 
                 RowBox[{"Dispatch", "[", 
                  RowBox[{"Thread", "[", 
                   RowBox[{"blankPositions", "\[Rule]", "#"}], "]"}], "]"}]}],
                 ",", "variables"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "&"}], ")"}]}], ",", "\n", "\n",
           "\t", 
          RowBox[{"(*", 
           RowBox[{
           "figure", " ", "out", " ", "the", " ", "energy", " ", "we", " ", 
            "want", " ", "to", " ", "use"}], "*)"}], "\n", "\t", 
          RowBox[{"constraintEnergy", "=", 
           RowBox[{"Which", "[", "\n", "\t\t", 
            RowBox[{
             RowBox[{"energy", "===", "False"}], ",", " ", 
             RowBox[{"fullConstraints", " ", ".", " ", "fullConstraints"}], 
             ",", "\n", "\t\t", 
             RowBox[{"energy", "===", "True"}], ",", " ", 
             RowBox[{"compiledMechanismEnergy", "[", 
              RowBox[{
               RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
               RowBox[{"compileEnergy", "[", 
                RowBox[{"m", ",", 
                 RowBox[{
                 "fullConstraints", " ", ".", " ", "fullConstraints"}], ",", 
                 RowBox[{"{", "}"}], ",", "$compilationTarget"}], "]"}], ",", 
               "\n", "\t\t\t", 
               RowBox[{"compileGradient", "[", 
                RowBox[{"m", ",", 
                 RowBox[{
                 "fullConstraints", " ", ".", " ", "fullConstraints"}], ",", 
                 RowBox[{"{", "}"}], ",", "$compilationTarget"}], "]"}]}], 
              "]"}], ",", "\n", "\t\t", "True", ",", " ", "energy"}], " ", 
            RowBox[{"(*", 
             RowBox[{
             "user", " ", "may", " ", "be", " ", "passing", " ", "an", " ", 
              "energy"}], "*)"}], "\n", "\t\t", "]"}]}]}], "\n", "}"}], ",", 
        "\n", "\n", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "#", "]"}], ",", 
              RowBox[{"MeshCellCount", "[", 
               RowBox[{"m", ",", "0"}], "]"}], ",", 
              RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}], "]"}],
           "&"}], "[", " ", "\n", "\t\t", 
         RowBox[{
          RowBox[{"FoldList", "[", "\n", "\t\t\t", 
           RowBox[{"(*", 
            RowBox[{"take", " ", "one", " ", "step"}], "*)"}], "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"(", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"energyTemp", "=", 
                RowBox[{"evaluateEnergy", "[", 
                 RowBox[{"m", ",", " ", 
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                  "constraintEnergy"}], "]"}]}], ";", "\n", "\t\t\t", 
               RowBox[{"isometricTrajectoryStep", "[", "\n", "\t\t\t\t", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"method", ",", "stepsize", ",", "tolerance"}], 
                  "}"}], ",", "\n", "\t\t\t\t", "m", ",", "\n", "\t\t\t\t", 
                 "#1", ",", " ", 
                 RowBox[{"(*", 
                  RowBox[{
                  "the", " ", "latest", " ", "position", " ", "and", " ", 
                   "step", " ", "direction"}], "*)"}], "\n", "\t\t\t\t", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"constraintMatFunction", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                   "constraintEnergy"}], "}"}], ",", " ", 
                 RowBox[{"(*", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    "the", " ", "matrix", " ", "of", " ", "linear", " ", 
                    "constraints"}], ",", " ", 
                    RowBox[{
                    "an", " ", "energy", " ", "associated", " ", "with", " ", 
                    "the", " ", "constraints"}]}], "}"}], " ", "*)"}], "\n", 
                 "\t\t\t\t", "variables", ",", "\n", "\t\t\t\t", 
                 "stepOptions"}], "]"}]}], "\n", "\t\t\t", ")"}], "&"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"positions", ",", "initialDirectionNormalized"}], "}"}], 
            ",", "\n", "\t\t", 
            RowBox[{"Range", "[", "steps", "]"}]}], "\n", "\t\t", "]"}], "[", 
          
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "\n", "\t", "]"}]}], "\n",
        "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[953]:=",ExpressionUUID->"0eac91ae-7451-41aa-9cbb-65adae11b2f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectoryStep", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<Minimization\>\"", ",", "stepsize_", ",", "tolerance_"}], 
      "}"}], ",", "m_", ",", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"constraintMat_", ",", "constraintEnergy_"}], "}"}], ",", 
     "var_", ",", "stepOptions_"}], "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"nullspaceBasis", "=", 
        RowBox[{"Orthogonalize", "[", 
         RowBox[{"NullSpace", "[", 
          RowBox[{"constraintMat", ",", 
           RowBox[{"FilterRules", "[", 
            RowBox[{"stepOptions", ",", 
             RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], "]"}], 
         "]"}]}], ",", "\n", "\t", "newDirection", ",", "\n", "\t", 
       "trialStep", " ", ",", " ", "test"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newDirection", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "nullspaceBasis", "]"}], ">", "0"}], ",", 
         "\n", "\t\t", 
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", "nullspaceBasis", "]"}], " ", ".", " ", 
           "nullspaceBasis", " ", ".", " ", "lastDirection"}], "]"}], ",", 
         "\n", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"isometricTrajectory", "::", "dirns"}], ",", 
            "positions"}], "]"}], ";", "\n", "\t\t", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Length", "[", "positions", "]"}]}], "]"}]}]}], "\n", 
        "\t", "]"}]}], ";", "\n", "\t", 
      RowBox[{"trialStep", "=", 
       RowBox[{"positions", "+", " ", 
        RowBox[{"stepsize", " ", "newDirection"}]}]}], ";", "\n", "\n", "\t", 
      
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"evaluateEnergy", "[", 
            RowBox[{
            "m", ",", " ", "trialStep", ",", " ", "constraintEnergy"}], "]"}],
            " ", ">", " ", "tolerance"}], ",", "\n", "\t\t", 
          RowBox[{"Flatten", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"minimizeEnergyInternal", "[", 
             RowBox[{"m", ",", " ", "constraintEnergy", ",", " ", 
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"positions", "+", 
                 RowBox[{"stepsize", " ", "newDirection"}]}], ",", 
                RowBox[{"embeddingDimension", "[", "m", "]"}]}], "]"}], ",", 
              " ", 
              RowBox[{"FilterRules", "[", 
               RowBox[{"stepOptions", ",", " ", 
                RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], 
             "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "\n", "\t\t", "]"}], ",", "\n", 
          "\t\t", "trialStep"}], "\n", "\t", "]"}], ",", "\n", "\t", 
        "newDirection"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"isometricTrajectoryStep", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<RandomWalk\>\"", ",", "stepsize_", ",", "tolerance_"}], 
      "}"}], ",", "m_", ",", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"constraintMat_", ",", "constraintEnergy_"}], "}"}], ",", 
     "var_", ",", "stepOptions_"}], "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"nullspaceBasis", "=", 
        RowBox[{"Orthogonalize", "[", 
         RowBox[{"NullSpace", "[", 
          RowBox[{"constraintMat", ",", 
           RowBox[{"FilterRules", "[", 
            RowBox[{"stepOptions", ",", 
             RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], "]"}], 
         "]"}]}], ",", "\n", "newDirection", ",", "trialStep"}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newDirection", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "nullspaceBasis", "]"}], ">", "0"}], ",", 
         "\n", "\t\t", 
         RowBox[{"Normalize", "[", 
          RowBox[{
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "stepsize"}], ",", "stepsize"}], "}"}], ",", 
             RowBox[{"Length", "[", "nullspaceBasis", "]"}]}], "]"}], " ", 
           ".", " ", "nullspaceBasis"}], "]"}], ",", "\n", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"isometricTrajectory", "::", "dirns"}], ",", 
            "positions"}], "]"}], ";", "\n", "\t\t", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Length", "[", "positions", "]"}]}], "]"}]}]}], "\n", 
        "\t", "]"}]}], ";", "\n", "\t", 
      RowBox[{"trialStep", "=", 
       RowBox[{"positions", "+", " ", 
        RowBox[{"stepsize", " ", "newDirection"}]}]}], ";", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"evaluateEnergy", "[", 
            RowBox[{
            "m", ",", " ", "trialStep", ",", " ", "constraintEnergy"}], "]"}],
            " ", ">", " ", "tolerance"}], ",", "\n", "\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"minimizeEnergyInternal", "[", 
             RowBox[{"m", ",", "constraintEnergy", ",", " ", 
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"positions", "+", 
                 RowBox[{"stepsize", " ", "newDirection"}]}], ",", 
                RowBox[{"embeddingDimension", "[", "m", "]"}]}], "]"}], ",", 
              " ", 
              RowBox[{"FilterRules", "[", 
               RowBox[{"stepOptions", ",", 
                RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], 
             "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", "\n", "\t\t", 
          "trialStep"}], "\n", "\t", "]"}], ",", "\n", "\t", "newDirection"}],
        "\n", "\t", "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"isometricTrajectoryStep", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"None", ",", "stepsize_", ",", "tolerance_"}], "}"}], ",", "m_", 
    ",", 
    RowBox[{"{", 
     RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"constraintMat_", ",", "constraintEnergy_"}], "}"}], ",", "var_",
     ",", "stepOptions_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"nullspaceBasis", "=", 
       RowBox[{"Orthogonalize", "[", 
        RowBox[{"NullSpace", "[", 
         RowBox[{"constraintMat", ",", 
          RowBox[{"FilterRules", "[", 
           RowBox[{"stepOptions", ",", 
            RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], "]"}], 
        "]"}]}], ",", "\n", "\t", "newDirection"}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"newDirection", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "nullspaceBasis", "]"}], ">", "0"}], ",", 
        "\n", "\t\t", 
        RowBox[{"Normalize", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", "nullspaceBasis", "]"}], " ", ".", " ", 
          "nullspaceBasis", " ", ".", " ", "lastDirection"}], "]"}], ",", 
        "\n", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"isometricTrajectory", "::", "dirns"}], ",", "positions"}],
           "]"}], ";", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"Length", "[", "positions", "]"}]}], "]"}]}]}], "\n", "\t",
        "]"}]}], ";", "\n", "\t", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"positions", "+", 
        RowBox[{"stepsize", " ", "newDirection"}]}], ",", "newDirection"}], 
      "}"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[954]:=",ExpressionUUID->"37ffa1ef-c32e-45a9-8b39-8215cca0dac2"]
}, Closed]],

Cell[CellGroupData[{

Cell["findMinimalTrajectory[]", "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "findMinimalTrajectory", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<additional\>\"", "->", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<constraints\>\"", "\[Rule]", "None"}], ",", "\n", "\t", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
        RowBox[{"MaxIterations", "\[Rule]", 
         RowBox[{"10", "^", "5"}]}], ",", " ", 
        RowBox[{"\"\<stiffness\>\"", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}]}], "}"}]}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[957]:=",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findMinimalTrajectory", "[", "\"\<Methods\>\"", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<stiffness\>\"", "\[Rule]", 
           RowBox[{"10", "^", 
            RowBox[{"(", 
             RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
         "\"\<Options[FindMinimum]\>\""}], "]"}]}], "}"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findMinimalTrajectory", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "start_", ",", " ", "end_", 
     ",", " ", "steps_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"method", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}]}], ",", 
       " ", "res"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"First", "[", "method", "]"}], ",", "\n", "\t\t", 
         "\"\<ElasticBand\>\"", ",", "\n", "\t\t\t", 
         RowBox[{"findMinimalTrajectoryElasticBand", "[", 
          RowBox[{
          "m", ",", " ", "start", ",", " ", "end", ",", " ", "steps", ",", 
           " ", 
           RowBox[{
            RowBox[{"mechanismEnergy", "[", 
             RowBox[{"m", ",", " ", 
              RowBox[{"\"\<constraints\>\"", "->", 
               RowBox[{"OptionValue", "[", "\"\<constraints\>\"", "]"}]}]}], 
             "]"}], "+", 
            RowBox[{"OptionValue", "[", "\"\<additional\>\"", "]"}]}], ",", 
           " ", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"Rest", "[", "method", "]"}]}]}], " ", "]"}], ",", "\n", 
         "\t\t", "_", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"findMinimalTrajectory", "::", "meth"}], "]"}], ";", "\n", 
          "\t\t\t", "$Failed"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", "\n",
       "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findMinimalTrajectory", "::", "method"}], "=", 
   "\"\<`1` is not a recognized method. Only \\\"ElasticBand\\\" is currently \
recognized.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[958]:=",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"findMinimalTrajectory", "::", "ebstiff"}], "=", 
   "\"\<Stiffness in \\\"ElasticBand\\\" method must be a positive numerical \
value.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findMinimalTrajectory", "::", "ebstart"}], "=", 
   "\"\<Start positions are not numeric coordinates corresponding to \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findMinimalTrajectory", "::", "ebend"}], "=", 
   "\"\<End positions are not numeric coordinates corresponding to mechanism.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findMinimalTrajectory", "::", "steps"}], "=", 
    "\"\<Number of steps should be a positive integer.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "findMinimalTrajectoryElasticBand", "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "findMinimalTrajectoryElasticBand", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<stiffness\>\"", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
      RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"findMinimalTrajectoryElasticBand", "[", 
   RowBox[{
   "m_", ",", " ", "startPositions_", ",", "endPositions_", ",", " ", 
    "steps_", ",", " ", "energy_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<stiffness\>\"", "]"}]}], ",", "\n", 
      RowBox[{"fixedVertices", " ", "=", " ", 
       RowBox[{"solveLinearEquations", "[", 
        RowBox[{
         RowBox[{"constraintEquations", "[", 
          RowBox[{"m", ",", "startPositions", ",", "Infinity", ",", 
           RowBox[{"\"\<output\>\"", "\[Rule]", "vertexPosition"}]}], "]"}], 
         ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}]}], 
      ",", " ", "\n", "variable", ",", " ", "internalVariables", ",", " ", 
      "partialEnergy", ",", " ", "newVariables", ",", " ", "potentialEnergy", 
      ",", " ", "initialConditions", ",", "\n", 
      RowBox[{"minimizationOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", 
         RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", " ", 
      "solution"}], "\n", "}"}], ",", "\n", "\n", "\t", 
    RowBox[{
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"NumericQ", "[", "stiffness", "]"}], " ", "&&", " ", 
         RowBox[{"stiffness", " ", ">", " ", "0"}]}], " ", "]"}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"findMinimalTrajectory", "::", "ebstiff"}], "]"}], ";", " ", 
        
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"numericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "startPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"findMinimalTrajectory", "::", "ebstart"}], "]"}], ";", " ", 
        
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"numericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "endPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"findMinimalTrajectory", "::", "ebend"}], "]"}], ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "steps", "]"}], " ", "&&", " ", 
         RowBox[{"steps", ">", "0"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"findMinimalTrajectory", "::", "steps"}], "]"}], ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\n", "\t", "]"}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"internalVariables", "=", " ", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"positionRules", "[", "startPositions", "]"}], "}"}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], "&"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"vertexPosition", "[", "m", "]"}], ",", " ", "#"}], 
               "}"}], ",", " ", "2"}], "]"}], ",", "2"}], "]"}], "&"}], " ", "/@",
          " ", 
         RowBox[{"Array", "[", 
          RowBox[{"variable", ",", " ", 
           RowBox[{"{", 
            RowBox[{"steps", ",", " ", 
             RowBox[{"MeshCellCount", "[", 
              RowBox[{"m", ",", "0"}], "]"}], ",", 
             RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}], 
          "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"positionRules", "[", "endPositions", "]"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"newVariables", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"vertexPosition", "[", "m", "]"}], " ", "/.", " ", 
         "fixedVertices"}], "]"}], " ", "/.", " ", "internalVariables"}]}], 
     ";", "\n", "\n", "\t", 
     RowBox[{"partialEnergy", " ", "=", " ", 
      RowBox[{"energy", " ", "/.", " ", "fixedVertices"}]}], ";", "\n", "\n", 
     "\t", 
     RowBox[{"potentialEnergy", " ", "=", " ", 
      RowBox[{"Total", " ", "@", " ", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"{", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{"local", " ", "equations"}], "*)"}], "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"partialEnergy", " ", "/.", " ", "#"}], " ", "&"}], 
            ")"}], " ", "/@", " ", "internalVariables"}], ",", "\n", "\n", 
          "\t", 
          RowBox[{"(*", 
           RowBox[{"elastic", " ", "band", " ", "equations"}], "*)"}], "\n", 
          "\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"stiffness", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], " ", ".", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "&"}], ")"}], 
           " ", "/@", " ", 
           RowBox[{"Partition", "[", 
            RowBox[{"newVariables", ",", " ", "2", ",", " ", "1"}], "]"}]}]}],
          "\n", "\t", "}"}]}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"initialConditions", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Transpose", " ", "@", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"Drop", "[", " ", 
             RowBox[{
              RowBox[{"Rest", " ", "@", " ", "newVariables"}], ",", " ", 
              RowBox[{"-", "1"}]}], "]"}], " ", "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"startPositions", " ", "+", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"endPositions", " ", "-", " ", "startPositions"}], 
                  ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"steps", "+", "1"}], ")"}]}], " ", "#"}]}], "&"}], 
             " ", "/@", " ", 
             RowBox[{"Range", "[", "steps", "]"}]}], " ", "]"}]}], "}"}]}], 
        ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ",", " ", "_"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"solution", " ", "=", " ", 
      RowBox[{"FindMinimum", " ", "@@", " ", 
       RowBox[{"{", 
        RowBox[{
        "potentialEnergy", ",", " ", "initialConditions", ",", " ", 
         "minimizationOptions"}], " ", "}"}]}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "solution", "]"}], " ", "=!=", " ", 
        "FindMinimum"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", ",", 
           RowBox[{"embeddingDimension", "[", "m", "]"}]}], "]"}], "&"}], " ",
         "/@", " ", 
        RowBox[{"(", 
         RowBox[{"newVariables", " ", "/.", " ", 
          RowBox[{"solution", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], ",", " ", "$Failed"}], 
      "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[961]:=",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Closed]],

Cell[CellGroupData[{

Cell["genericGloballyRigidQ[]", "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "genericGloballyRigidQ", "]"}], "=", 
    RowBox[{"Options", "[", "selfStresses", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"genericGloballyRigidQ", "[", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
      RowBox[{"num", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"Or", " ", "@@", " ", 
     RowBox[{"(", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixRank", "[", 
           RowBox[{
            RowBox[{"stressMatrix", "[", 
             RowBox[{"m", ",", " ", "#"}], "]"}], ",", " ", 
            RowBox[{"Tolerance", " ", "\[Rule]", " ", 
             RowBox[{"OptionValue", "[", "Tolerance", "]"}]}]}], " ", "]"}], 
          " ", "\[Equal]", " ", 
          RowBox[{"num", " ", "-", " ", "dim", " ", "-", " ", "1"}]}], ")"}], 
        "&"}], " ", "/@", " ", 
       RowBox[{"selfStresses", "[", 
        RowBox[{"m", ",", " ", "opt"}], "]"}]}], "\n", "\t", ")"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[968]:=",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]],

Cell[CellGroupData[{

Cell["genericDOF[]", "Subsection",ExpressionUUID->"a9afe4a2-3d1f-4c3c-87c4-873f2341a9d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"genericDOF", "[", " ", 
   RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
      RowBox[{"num", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}]}], " ", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"Max", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"dim", "*", "num"}], " ", "-", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"listEdges", "[", "m", "]"}], "]"}], " ", "-", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"dim", " ", "\[Equal]", " ", "2"}], ",", " ", "3", ",", " ", 
         "6"}], " ", "]"}]}], ",", " ", "0"}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "In[970]:=",ExpressionUUID->"72bdf617-f2b0-45b4-a828-df6fb87fae5e"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics", "Section",ExpressionUUID->"bd288e6b-ab27-46a4-bc3d-2647f91f2f63"],

Cell[CellGroupData[{

Cell["plotStress[]", "Subsection",ExpressionUUID->"a8eb6a67-78ad-4ba4-8cec-269a8a1b24d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "plotStress", "]"}], " ", "=", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Options", "[", "plotMechanism", "]"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"\"\<style\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
        "\n", "\t", 
        RowBox[{"\"\<scale\>\"", " ", "\[Rule]", " ", "0.1"}]}], "\n", "\t", 
       "}"}]}], "\n", "}"}], " ", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[971]:=",ExpressionUUID->"b053c690-a872-4439-b574-8c9fac1b5b54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plotStress", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"edgeList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    RowBox[{"stressList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", " ", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
    
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", 
      RowBox[{
       RowBox[{"stressStyleFunction", " ", "=", " ", 
        RowBox[{"getStressStyleFunction", "[", " ", 
         RowBox[{"OptionValue", "[", "\"\<style\>\"", "]"}], " ", "]"}]}], 
       ",", " ", "\n", 
       RowBox[{"minStress", " ", "=", " ", 
        RowBox[{"Min", "[", "stressList", "]"}]}], ",", " ", "\n", 
       RowBox[{"maxStress", " ", "=", " ", 
        RowBox[{"Max", "[", "stressList", "]"}]}], ",", "\n", 
       RowBox[{"edge", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"m", "[", "\"\<positions\>\"", "]"}], "[", 
           RowBox[{"[", "#", "]"}], "]"}], "&"}], " ", "/@", " ", 
         "edgeList"}]}], ",", "\n", 
       RowBox[{"graphicsWrapper", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"displayDimension", "[", "m", "]"}], " ", "\[Equal]", " ", 
           "2"}], ",", " ", "Graphics", ",", " ", "Graphics3D"}], " ", 
         "]"}]}], ",", "\n", 
       RowBox[{"scale", " ", "=", " ", 
        RowBox[{"Abs", "[", 
         RowBox[{"OptionValue", "[", "\"\<scale\>\"", "]"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Show", " ", "@", " ", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"plotMechanism", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", 
              RowBox[{"Options", "[", "plotMechanism", "]"}]}], "]"}]}], " ", 
           "]"}], ",", "\n", "\t\t", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{
            RowBox[{"arrowFunction", "[", 
             RowBox[{
             "graphicsWrapper", ",", " ", "scale", ",", " ", "minStress", ",",
               " ", "maxStress"}], "]"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"edge", ",", " ", "stressList", ",", " ", 
              RowBox[{"stressStyleFunction", " ", "/@", " ", 
               RowBox[{"Chop", "[", 
                RowBox[{"N", "[", "stressList", "]"}], "]"}]}]}], " ", 
             "}"}]}], " ", "]"}]}], "\n", "\t", "}"}]}]}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"NumericQ", "[", "scale", "]"}], " ", "&&", " ", 
       RowBox[{"NumericQ", "[", "minStress", "]"}], " ", "&&", " ", 
       RowBox[{"NumericQ", "[", "maxStress", "]"}]}]}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "edgeList", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "stressList", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Max", "[", "edgeList", "]"}], " ", "\[LessEqual]", " ", 
     RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "edgeList", "]"}], " ", "\[GreaterEqual]", " ", 
     "1"}]}]}]}]], "Code",
 CellLabel->
  "In[972]:=",ExpressionUUID->"1794a1de-92c7-4194-afbf-fa7220a883c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getStressStyleFunction", "[", " ", "Automatic", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{"Which", "[", " ", 
    RowBox[{
     RowBox[{"#", " ", ">", " ", "0"}], ",", " ", "Red", ",", " ", 
     RowBox[{"#", " ", "<", " ", "0"}], ",", " ", "Blue", ",", " ", "True", 
     ",", " ", "Black"}], " ", "]"}], "&"}]}], "\n", 
 RowBox[{
  RowBox[{"getStressStyleFunction", "[", " ", 
   RowBox[{"f", " ", ":", " ", 
    RowBox[{"Except", "[", "Automatic", "]"}]}], " ", "]"}], " ", ":=", " ", 
  "f"}]}], "Code",
 CellLabel->
  "In[973]:=",ExpressionUUID->"a68f133e-ebe3-4506-bf7a-0e202cc8d679"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"arrowFunction", "[", 
     RowBox[{
     "gr_", ",", " ", "inscale_", ",", " ", "min_", ",", " ", "max_"}], "]"}],
     "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"v1", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
       RowBox[{"v2", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{"__", "?", "NumericQ"}], "}"}]}]}], " ", "}"}], ",", " ", 
     RowBox[{"stress_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Chop", "[", 
          RowBox[{"N", "[", "#", "]"}], "]"}], ">", "0"}], "&"}], ")"}]}], 
     ",", " ", "style_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"center", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"v1", " ", "+", " ", "v2"}], ")"}], "/", "2"}]}], ",", " ", 
       
       RowBox[{"scale", " ", "=", " ", 
        RowBox[{"stress", "/", 
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "max", "]"}], ",", 
           RowBox[{"Abs", "[", "min", "]"}]}], "]"}]}]}]}], " ", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"gr", " ", "@", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{"style", ",", " ", 
         RowBox[{"Arrowheads", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "inscale"}], ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"inscale", ",", " ", "1"}], "}"}]}], "}"}], " ", "]"}], 
         ",", " ", 
         RowBox[{"Arrow", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"center", " ", "+", " ", 
             RowBox[{"scale", " ", 
              RowBox[{"(", 
               RowBox[{"v1", " ", "-", " ", "center"}], ")"}]}]}], ",", " ", 
            RowBox[{"center", " ", "+", " ", 
             RowBox[{"scale", " ", 
              RowBox[{"(", 
               RowBox[{"v2", " ", "-", " ", "center"}], ")"}]}]}]}], "}"}], 
          " ", "]"}]}], " ", "}"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"arrowFunction", "[", 
     RowBox[{
     "gr_", ",", " ", "inscale_", ",", " ", "min_", ",", " ", "max_"}], "]"}],
     "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"v1", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
       RowBox[{"v2", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{"__", "?", "NumericQ"}], "}"}]}]}], " ", "}"}], ",", " ", 
     RowBox[{"stress_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Chop", "[", 
          RowBox[{"N", "[", "#", "]"}], "]"}], "<", "0"}], "&"}], ")"}]}], 
     ",", " ", "style_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"center", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"v1", " ", "+", " ", "v2"}], ")"}], "/", "2"}]}], ",", " ", 
       
       RowBox[{"scale", " ", "=", " ", 
        RowBox[{"stress", "/", 
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"Abs", "[", "max", "]"}], ",", 
           RowBox[{"Abs", "[", "min", "]"}]}], "]"}]}]}]}], " ", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"gr", " ", "@", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{"style", ",", " ", 
         RowBox[{"Arrowheads", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "inscale"}], ",", " ", 
              RowBox[{"1", "-", "inscale"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"inscale", ",", " ", "inscale"}], "}"}]}], "}"}], " ", 
          "]"}], ",", " ", 
         RowBox[{"Arrow", "[", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"center", " ", "+", " ", 
             RowBox[{"scale", " ", 
              RowBox[{"(", 
               RowBox[{"v1", " ", "-", " ", "center"}], ")"}]}]}], ",", " ", 
            RowBox[{"center", " ", "+", " ", 
             RowBox[{"scale", " ", 
              RowBox[{"(", 
               RowBox[{"v2", " ", "-", " ", "center"}], ")"}]}]}]}], "}"}], 
          " ", "]"}]}], " ", "}"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"arrowFunction", "[", 
    RowBox[{"gr_", ",", " ", "inscale_", ",", " ", "min_", ",", " ", "max_"}],
     "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"v1", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
      RowBox[{"v2", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"__", "?", "NumericQ"}], "}"}]}]}], " ", "}"}], ",", " ", 
    "stress_", ",", " ", "style_"}], " ", "]"}], " ", ":=", " ", 
  "Nothing"}]}], "Code",
 CellLabel->
  "In[975]:=",ExpressionUUID->"99b44e1e-10ac-4496-b564-51e26a057933"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[978]:=",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["mechanisms`origami: specialty functions for origami", "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<mechanisms`origami`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "In[980]:=",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"origamiQ", "::", "usage"}], "=", 
   "\"\<origamiQ[ obj ] returns True if obj can be turned into origami \
(perhaps with defects).\>\""}], ";"}]], "Code",
 CellLabel->
  "In[981]:=",ExpressionUUID->"1b53aab2-8ab9-4869-815e-f8ca47d5626d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"kawasakiQ", "::", "usage"}], "=", "\n", 
   "\"\<kawasakiQ[\!\(\*StyleBox[\"origami\",FontSlant->\"Italic\"]\)] \
returns True if it can be determined that the origami satisfies Kawasaki's \
theorem at each vertex.\nUse option ZeroTest to modify how the function tests \
for zero. Use option WorkingPrecision to set a number of digits for the test.\
\>\""}], ";"}]], "Code",
 CellLabel->
  "In[982]:=",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"foldMatrix", "::", "usage"}], "=", "\n", 
    "\"\<foldMatrix[\!\(\*StyleBox[\"origami\",FontSlant->\"Italic\"]\)] \
returns the fold matrix mapping linear vertex displacements to linear fold \
angle changes.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"angularFoldMatrix", "::", "usage"}], "=", "\n", 
   "\"\<angularFoldMatrix[\!\(\*StyleBox[\"origami\",FontSlant->\"Italic\"]\),\
 (\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), ) \
\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\)] returns the angular fold \
matrix of a vertex mapping the angular displacements of the folds from the xy \
plane to the fold angle changes.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[983]:=",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"toOrigami", "::", "usage"}], "=", "\n", 
   "\"\<toOrigami[ \!\(\*StyleBox[\"object\",FontSlant->\"Italic\"]\) ] \
converts an object to an origami mechanism. Effectively this only works for \
some MeshRegion[] or framework[] objects.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[985]:=",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"singleVertex", "::", "usage"}], "=", "\n", 
    "\"\<singleVertex[ {\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 1, \
\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 2, ...} ] returns a single \
vertex origami with angles as sector angles.\nsingleVertex[ \
{\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 1, \
\!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) 2, ...}, \
{\!\(\*StyleBox[\"length\",FontSlant->\"Italic\"]\) 1, ...} ] returns a \
single vertex origami with angles as sector angles and fold lengths given by \
the list of lengths.\n\nSee options \\\"angles\\\" and \\\"torsional \
stiffnesses\\\" to set the equilibrium angles and torsional \
stiffnesses.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomOrigami", "::", "usage"}], "=", "\n", 
    "\"\<randomOrigami[ \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) ] \
returns random origami with n internal vertices.\>\""}], ";"}], "\n"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"miuraOri", "::", "usage"}], "=", "\n", 
    "\"\<miuraOri[ \!\(\*StyleBox[\"angle\",FontSlant->\"Italic\"]\) ] \
returns a Miura ori at a particular angle.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"addFold", "::", "usage"}], "=", 
   "\"\<addFold[ m, edge ] creates an edge across a face.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"subdivideFaces", "::", "usage"}], "=", 
   "\"\<subdivideFaces[m] subdivides all the faces of a mechanism until all \
faces are triangles.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[986]:=",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"flatOrigamiQ", "::", "usage"}], "=", "\n", 
   "\"\<flatOrigamiQ[ \!\(\*StyleBox[\"origami\",FontSlant->\"Italic\"]\) ] \
returns True if the origami mechanism is flat.\nUse option ZeroTest to \
specify how to test for zero. Use option WorkingPrecision to choose the \
precision.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[991]:=",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"yoshimuraOrigami", "::", "usage"}], "=", "\n", 
   "\"\<yoshimuraOrigami[{\!\(\*StyleBox[\"#\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"azimuthal\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"cells\",FontSlant->\"Italic\"]\), \
#\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"of\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"rings\",FontSlant->\
\"Italic\"]\)(, \
\!\(\*StyleBox[\"twist\",FontSlant->\"Italic\"]\))},\!\(\*StyleBox[\"overall\"\
,FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"scale\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"height\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"ratio\",FontSlant->\"Italic\"]\)] \
creates a Yoshimura fold pattern of a particular radius, height, and integer \
twist if specified.\>\""}], ";"}]], "Code",
 CellLabel->
  "In[992]:=",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MVAssignment", "::", "usage"}], " ", "=", " ", 
    "\"\<MVAssignment[ o (, positions), tolerance_ (, assignmentFunction)] \
returns a list of rules assigning a value to mountain or valley folds up to \
the value of tolerance.\nThe function assignmentFunction should take one of \
the values {-1,0,1} for valley, flat, or mountain folds respectively.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "::", "usage"}], " ", "=", " ", 
   "\"\<flattenOrigami[m, tolerance] attempts to flatten an origami \
structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[993]:=",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sameFoldAnglesQ", "::", "usage"}], "=", 
   "\"\<sameFoldAnglesQ[ origami, (folds,) (precision) ] is a function that \
compares the positions of two origami structures and returns True if they \
have the same fold angles.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameMVAnglesQ", "::", "usage"}], "=", 
   "\"\<sameMVAnglesQ[ origami, (folds,) (precision) ] is a function that \
compares the positions of two origami structures and returns True if they \
have the same mountain-valley assignments.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[995]:=",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"butterflyDecompositionQ", "::", "usage"}], " ", "=", " ", 
   "\"\<butterflyDecompositionQ[ origami ] returns True if origami can be \
decomposed into pairs of \\\"butterfly\\\" faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"butterflyDecomposition", "::", "usage"}], " ", "=", " ", 
   "\"\<butterflyDecomposition[ origami ] returns a list of \\\"butterfly\\\" \
face pairs and a non-butterfly-decomposible kernel after removing butterfly \
faces. You can apply deleteDanglingVertices[] to extract the underlying \
origami structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[997]:=",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"texture", "::", "usage"}], "=", 
   "\"\<texture[ s ] returns a texture having the name s. Use texture[] to \
see examples.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "usage"}], " ", "=", " ", 
   "\"\<plotOrigami[ o ] plots an origami.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[999]:=",ExpressionUUID->"60a1aaf8-9e55-4804-8020-19c6fa0e5e13"]
}, Closed]],

Cell[CellGroupData[{

Cell["global", "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<mechanisms`rigidity`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "In[1001]:=",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["new origami structures", "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],

Cell[CellGroupData[{

Cell["origamiQ[]", "Subsection",ExpressionUUID->"8042e1d7-58bf-4a7b-a670-9ef09527dcb3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"origamiQ", "[", " ", "mr_MeshRegion", " ", "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{"(*", 
    RowBox[{
    "there", " ", "should", " ", "be", " ", "at", " ", "least", " ", "one", 
     " ", "face"}], "*)"}], "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"RegionDimension", "[", "mr", "]"}], " ", "\[Equal]", " ", "2"}],
     ",", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{"embedding", " ", "dimension"}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "\[Equal]", "2"}], "||", 
        RowBox[{"#", "\[Equal]", "3"}]}], "&"}], ")"}], " ", "@", " ", 
     RowBox[{"RegionEmbeddingDimension", "[", "mr", "]"}]}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"origamiQ", "[", " ", "f_framework", " ", "]"}], " ", ":=", " ", 
  "\n", "\t", 
  RowBox[{"And", "[", "\n", "\t\t", 
   RowBox[{"(*", 
    RowBox[{
    "there", " ", "should", " ", "be", " ", "at", " ", "least", " ", "one", 
     " ", "face"}], "*)"}], "\n", "\t\t", 
   RowBox[{
    RowBox[{
     RowBox[{"RegionDimension", "[", " ", 
      RowBox[{"f", "[", "\"\<mesh\>\"", "]"}], " ", "]"}], " ", "\[Equal]", 
     " ", "2"}], ",", "\n", "\t\t", 
    RowBox[{"(*", 
     RowBox[{"embedding", " ", "dimension"}], "*)"}], "\n", "\t\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "\[Equal]", "2"}], "||", 
        RowBox[{"#", "\[Equal]", "3"}]}], "&"}], ")"}], " ", "@", " ", 
     RowBox[{"f", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}], "\n", "\t", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"origamiQ", "[", " ", "o_origami", " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"origamiQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
  "False"}]}], "Code",
 CellLabel->
  "In[1005]:=",ExpressionUUID->"5cbe27db-29f9-4589-9b2f-70c34eebdd51"]
}, Closed]],

Cell[CellGroupData[{

Cell["toOrigami[]", "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"toOrigami", "::", "notsurface"}], "=", 
   "\"\<Input does not seem to be origami compatible because it is not a \
valid surface.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toOrigami", "::", "prec"}], "=", 
   "\"\<Precision must be valid number of digits.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[1009]:=",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "toOrigami", " ", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"Precision", " ", "\[Rule]", " ", "Automatic"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toOrigami", "[", 
    RowBox[{
     RowBox[{"mr_MeshRegion", "?", "origamiQ"}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"origami", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "===", " ", 
         "Automatic"}], ",", "\n", "\t\t\t", 
        RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"N", "[", " ", 
         RowBox[{
          RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Precision", "]"}]}], " ", "]"}]}], 
       "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"MeshCells", "[", 
          RowBox[{"mr", ",", "2"}], "]"}], " ", "/.", " ", 
         RowBox[{"Polygon", "->", "face"}]}], " ", "}"}], "]"}]}], "\n", "\t",
      "]"}], " ", "/;", " ", 
    RowBox[{"precisionQ", "[", 
     RowBox[{"OptionValue", "[", "Precision", "]"}], "]"}]}]}], "\n"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"toOrigami", "[", 
    RowBox[{
     RowBox[{"f_framework", "?", "origamiQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"f", "[", "\"\<positions\>\"", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "===", " ", 
         "Automatic"}], ",", " ", 
        RowBox[{"origami", "@@", "f"}], ",", " ", 
        RowBox[{"N", "[", " ", 
         RowBox[{
          RowBox[{"origami", "@@", "f"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Precision", "]"}]}], " ", "]"}]}], " ",
        "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"precisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", "Precision", "]"}], " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"precisionQ", "[", " ", "prec_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Which", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"prec", " ", "===", " ", "Automatic"}], ",", " ", "True", ",", 
    "\n", "\t", 
    RowBox[{"prec", " ", "===", " ", "MachinePrecision"}], ",", " ", "True", 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"NumericQ", "[", " ", "prec", " ", "]"}], " ", "&&", " ", 
     RowBox[{"prec", " ", ">", " ", "0"}]}], ",", " ", "True", ",", "\n", 
    "\t", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", " ", 
      RowBox[{"toOrigami", "::", "prec"}], " ", "]"}], ";", " ", "False"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[1011]:=",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toOrigami", "[", "_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"toOrigami", "::", "notsurface"}], "]"}]}]}]], "Code",
 CellLabel->
  "In[1015]:=",ExpressionUUID->"e14ea647-8b7f-4eae-a125-7e43a795f52c"]
}, Closed]],

Cell[CellGroupData[{

Cell["singleVertex[]", "Subsection",ExpressionUUID->"f78cb6e6-e17d-4401-b894-51df89a02adc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "singleVertex", "]"}], "=", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Options", "[", "origami", "]"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"\"\<angles\>\"", "->", "None"}], ",", "\n", "\t", 
        RowBox[{"\"\<torsionalStiffnesses\>\"", "->", "None"}]}], "\n", "\t", 
       "}"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"vertexOptionQ", "[", 
   RowBox[{"None", ",", "_"}], "]"}], ":=", "True"}], "\n", 
 RowBox[{
  RowBox[{"vertexOptionQ", "[", 
   RowBox[{
    RowBox[{"x_", "?", "VectorQ"}], ",", "n_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Length", "[", "x", "]"}], "==", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexOptionQ", "[", 
   RowBox[{"_", ",", "_"}], "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "In[1016]:=",ExpressionUUID->"baf9e747-4ee8-4def-a102-84008b907460"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"angleData", "[", 
   RowBox[{"stiffnesses_List", ",", "angles_List"}], "]"}], ":=", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"fold", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "#1"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<torsionalStiffness\>\"", "->", "#2"}], ",", 
         RowBox[{"\"\<angle\>\"", "->", "#3"}]}], "}"}]}], "]"}], "&"}], ",", 
    
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"Length", "[", "stiffnesses", "]"}], "+", "1"}]}], "]"}], 
      ",", "stiffnesses", ",", "angles"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"angleData", "[", 
   RowBox[{"None", ",", "angles_List"}], "]"}], ":=", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"fold", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "#1"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<torsionalStiffness\>\"", "->", "0"}], ",", 
         RowBox[{"\"\<angle\>\"", "->", "#2"}]}], "}"}]}], "]"}], "&"}], ",", 
    
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"Length", "[", "angles", "]"}], "+", "1"}]}], "]"}], ",", 
      "angles"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"angleData", "[", 
   RowBox[{"stiffnesses_List", ",", "None"}], "]"}], ":=", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"fold", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "#1"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<torsionalStiffness\>\"", "->", "#2"}], ",", 
         RowBox[{"\"\<angle\>\"", "->", "0"}]}], "}"}]}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"2", ",", 
        RowBox[{
         RowBox[{"Length", "[", "stiffnesses", "]"}], "+", "1"}]}], "]"}], 
      ",", "stiffnesses"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"angleData", "[", 
   RowBox[{"None", ",", "None"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "In[1020]:=",ExpressionUUID->"a1d9feb9-62c4-409e-be0b-ea49889e8b01"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"singleVertex", "[", 
   RowBox[{
    RowBox[{"angles", ":", 
     RowBox[{"{", 
      RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"singleVertexCreator", "[", "\n", "\t\t", 
    RowBox[{"angles", ",", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"1", ",", 
       RowBox[{"Length", "[", "angles", "]"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"angleData", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], ",", 
       RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}]}], "]"}], ",", 
     "\n", "\t\t", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}], "\n", "\t", 
    "]"}], "/;", " ", 
   RowBox[{"(", "\n", "\t\t", 
    RowBox[{"(*", 
     RowBox[{
     "check", " ", "the", " ", "options", " ", "to", " ", "make", " ", "sure",
       " ", "they", " ", "make", " ", "sense"}], "*)"}], "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "angles", "]"}], ">", "2"}], "&&", 
     RowBox[{"vertexOptionQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}], ",", 
       RowBox[{"Length", "[", "angles", "]"}]}], "]"}], "&&", 
     RowBox[{"vertexOptionQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], ",", 
       RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], "\n", "\t", 
    ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "[", 
    RowBox[{
     RowBox[{"angles", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
     RowBox[{"lengths", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"__", "?", "NumericQ"}], "}"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"singleVertexCreator", "[", "\n", "\t\t", 
     RowBox[{"angles", ",", "lengths", ",", "\n", "\t\t", 
      RowBox[{"angleData", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], 
        ",", 
        RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}]}], "]"}], ",", 
      "\n", "\t\t", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"{", "opt", "}"}], ",", 
        RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}], "\n", "\t", 
     "]"}], "/;", " ", 
    RowBox[{"(", "\n", "\t\t", 
     RowBox[{"(*", 
      RowBox[{
      "check", " ", "the", " ", "options", " ", "to", " ", "make", " ", 
       "sure", " ", "they", " ", "make", " ", "sense"}], "*)"}], "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "angles", "]"}], ">", "2"}], "&&", 
      RowBox[{
       RowBox[{"Length", "[", "angles", "]"}], "==", 
       RowBox[{"Length", "[", "lengths", "]"}]}], "&&", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}], ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}], "&&", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], 
        ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], "\n", "\t", 
     ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "::", "sectorangles"}], "=", 
   "\"\<Sector angles are not a vector of numerical values.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "::", "length"}], "=", 
   "\"\<Lengths are not a vector of numerical values.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "::", "lengthmatch"}], "=", 
   "\"\<Number of sector angles does not agree with number of lengths.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "::", "folds"}], "=", 
   "\"\<Number of fold stiffnesses does not match number of sector \
angles.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"singleVertex", "::", "angles"}], "=", 
    "\"\<Number of fold angles does not match number of sector angles.\>\""}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"singleVertex", "[", 
   RowBox[{"angles_List", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"VectorQ", "[", 
       RowBox[{"angles", ",", "NumericQ"}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "sectorangles"}], "]"}], ",", "\n", "\t", 
     
     RowBox[{"Not", "@", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], 
        ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "folds"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "@", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}], ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "angles"}], "]"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"singleVertex", "[", 
   RowBox[{"angles_List", ",", "lengths_List", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "@", 
      RowBox[{"VectorQ", "[", 
       RowBox[{"angles", ",", "NumericQ"}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "sectorangles"}], "]"}], ",", "\n", "\t", 
     
     RowBox[{"Not", "@", 
      RowBox[{"VectorQ", "[", 
       RowBox[{"lengths", ",", "NumericQ"}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "length"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Length", "[", "angles", "]"}], "!=", 
      RowBox[{"Length", "[", "lengths", "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "lengthmatch"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "@", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<torsionalStiffnesses\>\"", "]"}], 
        ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "folds"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "@", 
      RowBox[{"vertexOptionQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<angles\>\"", "]"}], ",", 
        RowBox[{"Length", "[", "angles", "]"}]}], "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"singleVertex", "::", "angles"}], "]"}]}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[1024]:=",ExpressionUUID->"829b1b73-0d4f-4926-b6ea-e84e57819e82"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "singleVertexCreator", "]"}], "=", 
    RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "for", " ", "Gaussian", " ", "curvature", " ", "zero", " ", "vertices"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"singleVertexCreator", "[", 
   RowBox[{"angles_", ",", "lengths_", ",", "extraCells_", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "tmp", "}"}], ",", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"foldDirections", "=", 
          RowBox[{"Accumulate", "[", "angles", "]"}]}], ",", "\n", "\t", 
         RowBox[{"vertices", "=", 
          RowBox[{"Range", "[", 
           RowBox[{"2", ",", 
            RowBox[{
             RowBox[{"Length", "[", "angles", "]"}], "+", "1"}]}], "]"}]}]}], 
        "\n", "}"}], ",", "\n", "\t", 
       RowBox[{"origami", "[", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{"construct", " ", "vertex", " ", "locations"}], "*)"}], "\n",
         "\t\t", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}], "}"}], ",", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#2", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Cos", "[", "#1", "]"}], ",", 
                 RowBox[{"Sin", "[", "#1", "]"}]}], "}"}]}], "&"}], ",", 
             RowBox[{"{", 
              RowBox[{"foldDirections", ",", "lengths"}], "}"}]}], "]"}]}], 
          "]"}], ",", "\n", "\t\t", 
         RowBox[{"Join", "[", "\n", "\t\t\t", 
          RowBox[{"(*", 
           RowBox[{
           "should", " ", "folds", " ", "be", " ", "just", " ", "edges", " ", 
            "or", " ", "torsional", " ", 
            RowBox[{"springs", "?"}]}], "*)"}], "\n", "\t\t\t", 
          RowBox[{"extraCells", ",", "\n", "\t\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "there", " ", "may", " ", "be", " ", "some", " ", "redundancy", 
             " ", "here", " ", "with", " ", "the", " ", "extra", " ", 
             "cells"}], "*)"}], "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"rigidBar", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "#"}], "}"}], "]"}], "&"}], "/@", 
            "vertices"}], ",", "\n", "\t\t\t", 
           RowBox[{"(*", 
            RowBox[{"rigid", " ", "bars", " ", "around", " ", "boundary"}], 
            " ", "*)"}], "\n", "\t\t\t", 
           RowBox[{"rigidBar", "/@", 
            RowBox[{"(", 
             RowBox[{"tmp", "=", 
              RowBox[{"Partition", "[", 
               RowBox[{"vertices", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
             ")"}]}], ",", "\n", "\t\t\t", 
           RowBox[{"(*", " ", 
            RowBox[{"faces", " ", "are", " ", "just", " ", "polygons"}], " ", 
            "*)"}], "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"Polygon", "[", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", "#"}], "]"}], "]"}], "&"}], "/@",
             "tmp"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", "opt"}], "\n",
         "\t", "]"}]}], "\n", "]"}]}], "]"}], "/;", 
   RowBox[{"PossibleZeroQ", "[", 
    RowBox[{
     RowBox[{"Total", "[", "angles", "]"}], "-", 
     RowBox[{"2", " ", "Pi"}]}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[1033]:=",ExpressionUUID->"efaea70e-7f65-44cf-a2e0-e6ecd31c63c7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"singleVertex", "::", "notflat"}], "=", 
   "\"\<Not able to handle non-flat vertices (yet).\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"singleVertexCreator", "[", "__", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"singleVertex", "::", "notflat"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[1035]:=",ExpressionUUID->"0e5dbd26-cfae-40c7-b7ee-7b5f60395896"]
}, Closed]],

Cell[CellGroupData[{

Cell["miuraOri[]", "Subsection",ExpressionUUID->"705723b3-0b89-4771-beb9-2e41ea08ce8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "miuraOri", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "[", "origami", "]"}], ",", "\n", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"\"\<Size\>\"", "->", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", "2"}], ",", 
          RowBox[{"1", "/", "2"}]}], "}"}]}], ",", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"Unit", " ", "cell", " ", "square", " ", "size"}], " ", 
        "*)"}], "\n", "\t", 
       RowBox[{"\"\<Triangulated\>\"", "->", "False"}], ",", "\n", "\t", 
       RowBox[{"\"\<primitive\>\"", "->", "False"}]}], "\n", "}"}]}], "]"}]}],
   ";"}]], "Code",
 CellLabel->
  "In[1037]:=",ExpressionUUID->"9f81df39-0a2f-4196-aab9-f31a9915fd4c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"miuraOriFaces", "[", 
    RowBox[{"False", ",", "False"}], "]"}], ":=", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5", ",", "2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4", ",", "1", ",", "3"}], "}"}], "]"}], ",", "\n", 
     "\t\t", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "7", ",", "4", ",", "6"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8", ",", "5", ",", "4"}], "}"}], "]"}], ",", "\n", 
     "\t\t", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"12", ",", "10", ",", "7", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"10", ",", "11", ",", "8", ",", "7"}], "}"}], "]"}], ",", "\n",
      "\t\t", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"5", ",", "2"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"3", ",", "6"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "12"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"12", ",", "10"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"10", ",", "11"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"11", ",", "8"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"8", ",", "5"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "10"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8"}], "}"}], "]"}]}], "\n", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"miuraOriFaces", "[", 
    RowBox[{"True", ",", "False"}], "]"}], ":=", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5", ",", "2"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "1", ",", "3"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "7", ",", "6"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "4", ",", "6"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"8", ",", "5", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"12", ",", "10", ",", "7"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"12", ",", "7", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"10", ",", "11", ",", "8"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"10", ",", "8", ",", "7"}], "}"}], "]"}], ",", "\n", "\t\t", 
     "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"5", ",", "2"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"3", ",", "6"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "12"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"12", ",", "10"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"10", ",", "11"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"11", ",", "8"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"8", ",", "5"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "10"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8"}], "}"}], "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"6", ",", "1"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n",
      "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"4", ",", "2"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n",
      "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"4", ",", "8"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n",
      "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"6", ",", "7"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n",
      "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"12", ",", "7"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n",
      "\t\t", 
     RowBox[{"Property", "[", 
      RowBox[{
       RowBox[{"Line", "[", 
        RowBox[{"{", 
         RowBox[{"10", ",", "8"}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"MeshCellStyle", "->", 
         RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}]}], "\n", 
    "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"miuraOriFaces", "[", 
    RowBox[{"False", ",", "True"}], "]"}], ":=", 
   RowBox[{"{", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5", ",", "2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4", ",", "1", ",", "3"}], "}"}], "]"}], ",", "\n", 
     "\t\t", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "7", ",", "4", ",", "6"}], "}"}], "]"}], ",", 
     RowBox[{"Polygon", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8", ",", "5", ",", "4"}], "}"}], "]"}], ",", "\n", 
     "\t\t", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"4", ",", "5"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"5", ",", "2"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"2", ",", "1"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "4"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"3", ",", "6"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"6", ",", "9"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"9", ",", "7"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "8"}], "}"}], "]"}], ",", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"8", ",", "5"}], "}"}], "]"}], ",", "\n", "\t\t", 
     RowBox[{"Line", "[", 
      RowBox[{"{", 
       RowBox[{"7", ",", "4"}], "}"}], "]"}]}], "\n", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"miuraOriFaces", "[", 
   RowBox[{"True", ",", "True"}], "]"}], ":=", 
  RowBox[{"{", "\n", "\t\t", 
   RowBox[{
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"4", ",", "5", ",", "2"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"4", ",", "2", ",", "1"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4", ",", "1"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"6", ",", "1", ",", "3"}], "}"}], "]"}], ",", "\n", "\t\t", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"9", ",", "7", ",", "6"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"7", ",", "4", ",", "6"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"7", ",", "8", ",", "4"}], "}"}], "]"}], ",", 
    RowBox[{"Polygon", "[", 
     RowBox[{"{", 
      RowBox[{"8", ",", "5", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
    "\n", "\t\t", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"4", ",", "5"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"5", ",", "2"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"2", ",", "1"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"6", ",", "4"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"1", ",", "3"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"3", ",", "6"}], "}"}], "]"}], ",", "\n", "\t\t", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"6", ",", "9"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"9", ",", "7"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"7", ",", "8"}], "}"}], "]"}], ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"8", ",", "5"}], "}"}], "]"}], ",", "\n", "\t\t", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"7", ",", "4"}], "}"}], "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
    
    RowBox[{"Property", "[", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{"6", ",", "1"}], "}"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"MeshCellStyle", "->", 
        RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{"Property", "[", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2"}], "}"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"MeshCellStyle", "->", 
        RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{"Property", "[", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{"4", ",", "8"}], "}"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"MeshCellStyle", "->", 
        RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{"Property", "[", 
     RowBox[{
      RowBox[{"Line", "[", 
       RowBox[{"{", 
        RowBox[{"6", ",", "7"}], "}"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"MeshCellStyle", "->", 
        RowBox[{"GrayLevel", "[", "0.65", "]"}]}], "}"}]}], "]"}]}], "\n", 
   "\n", "}"}]}]}], "Code",
 CellLabel->
  "In[1038]:=",ExpressionUUID->"3d99c4e1-2ed1-4a36-bd0d-901d4e1b608e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"miuraOri", "[", "\"\<Properties\>\"", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"\"\<HorizontalShift\>\"", ",", "\"\<AcuteAngle\>\""}], 
   "}"}]}]], "Code",
 CellLabel->
  "In[1042]:=",ExpressionUUID->"67dc5857-057d-4942-8b33-232e10e632fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"miuraOri", "[", 
   RowBox[{
    RowBox[{"\"\<HorizontalShift\>\"", "[", "shift_", "]"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"sizex", "=", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Size\>\"", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", 
      RowBox[{"sizey", "=", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Size\>\"", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
    RowBox[{"origami", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"2", " ", "sizey"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"sizex", ",", 
            RowBox[{"2", " ", "sizey"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "sizex"}], ",", 
            RowBox[{"2", " ", "sizey"}]}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"shift", ",", "sizey"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"sizex", "+", "shift"}], ",", "sizey"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "sizex"}], "+", "shift"}], ",", "sizey"}], "}"}], 
          ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"sizex", ",", "0"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "sizex"}], ",", "0"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"shift", ",", 
            RowBox[{"-", "sizey"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"shift", "+", "sizex"}], ",", 
            RowBox[{"-", "sizey"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"shift", "-", "sizex"}], ",", 
            RowBox[{"-", "sizey"}]}], "}"}]}], "\n", "\t\t", "}"}], ",", "\n",
         "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<primitive\>\"", "]"}], ",", "9", 
          ",", "12"}], "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"Flatten", "@", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Point", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<primitive\>\"", "]"}], ",", "9",
              ",", "12"}], "]"}], "]"}]}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"miuraOriFaces", "[", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<Triangulated\>\"", "]"}], ",", 
            RowBox[{"OptionValue", "[", "\"\<primitive\>\"", "]"}]}], "]"}], "/.", 
          RowBox[{"Line", "->", "rigidBar"}]}]}], "\n", "\t", "}"}]}], ",", 
      "\n", "\t", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"{", "opt", "}"}], ",", 
        RowBox[{"Options", "[", "origami", "]"}]}], "]"}]}], "\n", "]"}]}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[1043]:=",ExpressionUUID->"37a01b0b-a5a1-4a89-92b7-9caeadc9a336"],

Cell[BoxData[
 RowBox[{
  RowBox[{"miuraOri", "[", 
   RowBox[{
    RowBox[{"\"\<AcuteAngle\>\"", "[", "angle_", "]"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
  RowBox[{"miuraOri", "[", 
   RowBox[{
    RowBox[{"\"\<HorizontalShift\>\"", "[", 
     RowBox[{
      RowBox[{"Cot", "[", "angle", "]"}], " ", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Size\>\"", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "opt"}], "]"}]}]], "Code",\

 CellLabel->
  "In[1044]:=",ExpressionUUID->"c79ff671-dc5c-4855-97f7-8fad109232b4"],

Cell["The default Miura Ori is determined by its acute angle", "Text",ExpressionUUID->"c5baefa1-9c13-40ff-a82a-13c4da38a803"],

Cell[BoxData[
 RowBox[{
  RowBox[{"miuraOri", "[", 
   RowBox[{"angle_", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"miuraOri", "[", 
   RowBox[{
    RowBox[{"\"\<AcuteAngle\>\"", "[", "angle", "]"}], ",", "opt"}], 
   "]"}]}]], "Code",
 CellLabel->
  "In[1045]:=",ExpressionUUID->"bc255c6b-527f-4a10-b9c0-1b86173edb61"]
}, Closed]],

Cell[CellGroupData[{

Cell["yoshimura[]", "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "yoshimuraOrigami", "]"}], "=", 
   RowBox[{"Options", "[", "origami", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[1046]:=",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"yoshimuraOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"yoshimuraOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles", ",", "numHeight", ",", "twist"}], "}"}], ",", 
    "1", ",", "1", ",", "opt"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"yoshimuraOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"radius_", "?", "NumericQ"}], ",", 
    RowBox[{"heightScale_", "?", "NumericQ"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{"height", "=", 
         RowBox[{"heightScale", " ", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Cos", "[", 
               RowBox[{"Pi", "/", "numTriangles"}], "]"}], "-", 
              RowBox[{"Cos", "[", 
               RowBox[{"2", " ", 
                RowBox[{"Pi", "/", "numTriangles"}]}], "]"}]}], ")"}]}], 
           "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{"origami", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"radius", " ", 
          RowBox[{"Join", "@@", 
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], " ", "height"}]}], "\n", 
                "\t\t\t", "}"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"numHeight", "+", "1"}]}], "}"}]}], "]"}]}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}], ",", 
                    "numTriangles", ",", 
                    RowBox[{
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}]}], "]"}], 
                  ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", 
                "\t\t\t", "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}], ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "-", "1", "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", "\t\t\t",
                 "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}]}], "\n", "\t\t", 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"numHeight", "-", "1"}]}], "}"}]}], "]"}], ",", "\n", 
         "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"numTriangles", ">=", "2"}], "&&", 
    RowBox[{"numHeight", ">=", "1"}]}]}]}]}], "Code",
 CellLabel->
  "In[1047]:=",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"m", "=", 
  RowBox[{"yoshimuraOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"8", ",", "2", ",", "1"}], "}"}], ",", 
    RowBox[{"MeshCellLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", "\[Rule]", "\"\<Index\>\""}], "}"}]}]}], "]"}]}]], "Input",\

 CellLabel->
  "In[1250]:=",ExpressionUUID->"f325d84e-8b1c-4353-a4a7-917cc61544f8"],

Cell[BoxData[
 Graphics3DBox[
  TagBox[
   DynamicModuleBox[{Typeset`mesh = {
    MeshRegion, {Properties -> {{1, 1} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 2} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 3} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 4} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 5} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 6} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 7} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 8} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 9} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 10} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 11} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 12} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 13} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 14} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 15} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 16} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 17} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 18} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 19} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 20} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 21} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 22} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 23} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 24} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 25} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 26} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 27} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 28} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 29} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 30} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 31} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 32} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 33} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 34} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 35} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 36} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 37} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 38} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 39} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 40} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 41} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 42} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 43} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 44} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 45} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 46} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 47} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 48} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 49} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 50} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 51} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 52} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 53} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 54} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 55} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, 56} -> (MeshCellStyle -> {
           Thickness[0.0025], 
           GrayLevel[0]}), {1, Default} -> (MeshCellStyle -> Automatic), {
         0, Default} -> (MeshCellLabel -> "Index")}, 
      Method -> {"CoplanarityTolerance" -> 100}}}}, 
    TagBox[GraphicsComplex3DBox[CompressedData["
1:eJxTTMoPSmViYGCQAGJmID6Rsc7S+vhD+8UL+TTTZr+yZ4ACrmWZNjt+nNi/
Ieb7+elJ7+HiUHX7Yfpg4lB1+2H6YOJQdfth+tDMt4fpQzPfHqYPzXx7mD4c
6u3jX0cmfBF8ao9mPlwczT1wcTT3w8XR/LsfzXxY+OxHMx+uD818uD4c6qH2
fkU3Hy6OHv4wcfTwh4mjhz+a+fao7oebb4/q36/o7ofbCwB/1Bu6
      "], 
      {Hue[0.6, 0.3, 0.85], Opacity[0.7], EdgeForm[Hue[0.6, 0.3, 0.75]], 
       TagBox[
        Polygon3DBox[{{1, 2, 11}, {2, 3, 12}, {3, 4, 13}, {4, 5, 14}, {5, 6, 
         15}, {6, 7, 16}, {7, 8, 9}, {8, 1, 10}, {1, 11, 10}, {2, 12, 11}, {3,
          13, 12}, {4, 14, 13}, {5, 15, 14}, {6, 16, 15}, {7, 9, 16}, {8, 10, 
         9}, {9, 10, 18}, {10, 11, 19}, {11, 12, 20}, {12, 13, 21}, {13, 14, 
         22}, {14, 15, 23}, {15, 16, 24}, {16, 9, 17}, {9, 18, 17}, {10, 19, 
         18}, {11, 20, 19}, {12, 21, 20}, {13, 22, 21}, {14, 23, 22}, {15, 24,
          23}, {16, 17, 24}}],
        Annotation[#, "Geometry"]& ], 
       {GrayLevel[0], Thickness[0.0025], 
        Line3DBox[{{1, 2}, {2, 11}, {11, 1}, {2, 3}, {3, 12}, {12, 2}, {3, 
         4}, {4, 13}, {13, 3}, {4, 5}, {5, 14}, {14, 4}, {5, 6}, {6, 15}, {15,
          5}, {6, 7}, {7, 16}, {16, 6}, {7, 8}, {8, 9}, {9, 7}, {8, 1}, {1, 
         10}, {10, 8}, {11, 10}, {12, 11}, {13, 12}, {14, 13}, {15, 14}, {16, 
         15}, {9, 16}, {10, 9}, {10, 18}, {18, 9}, {11, 19}, {19, 10}, {12, 
         20}, {20, 11}, {13, 21}, {21, 12}, {14, 22}, {22, 13}, {15, 23}, {23,
          14}, {16, 24}, {24, 15}, {9, 17}, {17, 16}, {18, 17}, {19, 18}, {20,
          19}, {21, 20}, {22, 21}, {23, 22}, {24, 23}, {17, 24}}]}, {{
         Point3DBox[{1}], 
         Inset3DBox["1", {0.5555702330196022, 0.8314696123025452, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{2}], 
         Inset3DBox["2", {-0.19509032201612825`, 0.9807852804032304, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{3}], 
         Inset3DBox["3", {-0.8314696123025452, 0.5555702330196022, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{4}], 
         Inset3DBox["4", {-0.9807852804032304, -0.19509032201612825`, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{5}], 
         Inset3DBox["5", {-0.5555702330196022, -0.8314696123025452, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{6}], 
         Inset3DBox["6", {0.19509032201612825`, -0.9807852804032304, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{7}], 
         Inset3DBox["7", {0.8314696123025452, -0.5555702330196022, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{8}], 
         Inset3DBox["8", {0.9807852804032304, 0.19509032201612825`, 0.}, {-1, -1},
          
          BaseStyle->"Graphics"]}, {Point3DBox[{9}], 
         Inset3DBox["9", {0.8314696123025452, 0.5555702330196022, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{10}], 
         Inset3DBox["10", {0.19509032201612825`, 0.9807852804032304, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{11}], 
         Inset3DBox["11", {-0.5555702330196022, 0.8314696123025452, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{12}], 
         Inset3DBox["12", {-0.9807852804032304, 0.19509032201612825`, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{13}], 
         Inset3DBox["13", {-0.8314696123025452, -0.5555702330196022, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{14}], 
         Inset3DBox["14", {-0.19509032201612825`, -0.9807852804032304, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{15}], 
         Inset3DBox["15", {0.5555702330196022, -0.8314696123025452, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{16}], 
         Inset3DBox["16", {0.9807852804032304, -0.19509032201612825`, 
          0.6584417230472858}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{17}], 
         Inset3DBox["17", {0.5555702330196022, 0.8314696123025452, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{18}], 
         Inset3DBox["18", {-0.19509032201612825`, 0.9807852804032304, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{19}], 
         Inset3DBox["19", {-0.8314696123025452, 0.5555702330196022, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{20}], 
         Inset3DBox["20", {-0.9807852804032304, -0.19509032201612825`, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{21}], 
         Inset3DBox["21", {-0.5555702330196022, -0.8314696123025452, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{22}], 
         Inset3DBox["22", {0.19509032201612825`, -0.9807852804032304, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{23}], 
         Inset3DBox["23", {0.8314696123025452, -0.5555702330196022, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}, {Point3DBox[{24}], 
         Inset3DBox["24", {0.9807852804032304, 0.19509032201612825`, 
          1.3168834460945715`}, {-1, -1},
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["LinkHand"]],
    AllowKernelInitialization->False],
   "MeshGraphics3D",
   AutoDelete->True,
   Editable->False,
   Selectable->False],
  Boxed->False,
  DefaultBaseStyle->{
   "MeshGraphics3D", FrontEnd`GraphicsHighlightColor -> Hue[0.1, 1, 0.7]},
  ImageSize->{365.84716085088616`, 354.1967171904828},
  ImageSizeRaw->Automatic,
  Lighting->{{"Ambient", 
     GrayLevel[0.45]}, {"Directional", 
     GrayLevel[0.3], 
     ImageScaled[{2, 0, 2}]}, {"Directional", 
     GrayLevel[0.33], 
     ImageScaled[{2, 2, 2}]}, {"Directional", 
     GrayLevel[0.3], 
     ImageScaled[{0, 2, 2}]}},
  ViewPoint->{1.1969232879592, -2.279747559887293, 2.1954784685641697`},
  ViewVertical->{-0.04725614614043552, 0.05822357643666488, 
   1.4853612978130926`}]], "Output",
 CellLabel->
  "Out[1250]=",ExpressionUUID->"81a5acf0-2ec5-467c-86a2-c9168823fa90"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["randomOrigami[]", "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "randomOrigami", "]"}], "=", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "origami", "]"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"Precision", "\[Rule]", "Automatic"}], ",", "\n", "\t", 
       RowBox[{"MaxIterations", "->", "20"}], ",", "\n", "\t", 
       RowBox[{"\"\<minimumFolds\>\"", "->", "4"}], ",", "\n", "\t", 
       RowBox[{"\"\<boundary\>\"", "->", 
        RowBox[{"CirclePoints", "[", "4", "]"}]}]}], "\n", "\t", "}"}]}], 
    "\n", "]"}]}], ";"}]], "Code",
 CellLabel->
  "In[1049]:=",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"randomOrigami", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"ctr", " ", "=", " ", "1"}], ",", "\n", 
        RowBox[{"firstMesh", " ", "=", " ", 
         RowBox[{"randomMesh", "[", " ", 
          RowBox[{"numberOfVertices", ",", " ", 
           RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<boundary\>\"", "]"}]}], " ", 
          "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"meshTry", " ", "=", " ", 
          RowBox[{"toOrigami", "[", " ", 
           RowBox[{"firstMesh", " ", ",", " ", 
            RowBox[{"Precision", " ", "\[Rule]", " ", 
             RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", "]"}]}],
          ";", "\n", "\t", 
         RowBox[{"While", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", " ", "@", " ", 
             RowBox[{"validrandomOrigamiQ", "[", " ", 
              RowBox[{"numberOfVertices", ",", " ", "meshTry", ",", " ", 
               RowBox[{"OptionValue", "[", "\"\<minimumFolds\>\"", "]"}], ",",
                " ", 
               RowBox[{"Length", "[", 
                RowBox[{"OptionValue", "[", "\"\<boundary\>\"", "]"}], 
                "]"}]}], " ", "]"}]}], " ", "&&", " ", 
            RowBox[{"ctr", " ", "\[LessEqual]", " ", 
             RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}]}], ",", 
           "\n", "\t\t", 
           RowBox[{
            RowBox[{"meshTry", " ", "=", " ", 
             RowBox[{"toOrigami", "[", " ", 
              RowBox[{
               RowBox[{"randomMesh", "[", " ", 
                RowBox[{"numberOfVertices", ",", " ", 
                 RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
                 RowBox[{"OptionValue", "[", "\"\<boundary\>\"", "]"}]}], " ",
                 "]"}], ",", " ", 
               RowBox[{"Precision", " ", "\[Rule]", " ", 
                RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", 
              "]"}]}], ";", " ", 
            RowBox[{"ctr", "++"}]}]}], "\n", "\t", "]"}], ";", "\n", "\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"ctr", " ", ">", " ", 
            RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}], ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"randomOrigami", "::", "max"}], ",", " ", 
             RowBox[{"ctr", " ", "-", " ", "1"}]}], "]"}]}], " ", "]"}], ";", 
         "\n", "\t", "\n", "\t", 
         RowBox[{"origami", "[", " ", 
          RowBox[{"meshTry", ",", " ", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "origami", "]"}]}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"MeshRegionQ", "[", "firstMesh", "]"}]}]}], "\n", "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"randomOrigamiMinFoldsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "\"\<minimumFolds\>\"", " ", "]"}], 
      " ", "]"}], " ", "&&", " ", 
     RowBox[{"randomOrigamiMaxIterationsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "MaxIterations", " ", "]"}], " ", 
      "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"randomOrigami", "::", "max"}], "=", 
    "\"\<Maximum number of iterations reached at `1` without finding a \
suitable random origami.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"validrandomOrigamiQ", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", "minimumFolds_", ",", " ", 
     "boundarySize_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"AllTrue", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"Drop", "[", " ", 
        RowBox[{
         RowBox[{"connectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
          "]"}], ",", " ", "boundarySize"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"#", " ", "\[GreaterEqual]", " ", "minimumFolds"}], " ", 
       "&"}]}], "\n", "\t", "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], "-", "boundarySize"}], 
     " ", "\[Equal]", " ", "numberOfVertices"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomOrigami", "::", "mfold"}], "=", 
   "\"\<Minimum number of folds, `1`,  must be a position integer.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"randomOrigamiMinFoldsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomOrigamiMinFoldsQ", "[", " ", "f_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"randomOrigami", "::", "mfold"}], ",", " ", "f"}], "]"}], ";", 
     " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomOrigami", "::", "miter"}], "=", 
   "\"\<Maximum number of iterations, `1`, must be a position integer.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{"randomOrigamiMaxIterationsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"randomOrigamiMaxIterationsQ", "[", " ", "f_", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"randomOrigami", "::", "miter"}], ",", " ", "f"}], "]"}], ";", 
    " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "In[1050]:=",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "get", " ", "a", " ", "Delaunay", " ", "triangulation", " ", "from", " ", 
    "a", " ", "set", " ", "of", " ", "random", " ", "points"}], " ", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"randomMesh", "[", 
     RowBox[{
      RowBox[{"numberOfVertices_Integer", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
            RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], "|", "Automatic", "|", 
        "MachinePrecision"}]}], ",", " ", 
      RowBox[{"boundary_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "points", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"points", "=", 
         RowBox[{"Join", "[", "\n", "\t\t", 
          RowBox[{"boundary", ",", "\n", "\t\t", 
           RowBox[{"Select", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"RandomVariate", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"UniformDistribution", "[", 
                RowBox[{"RegionBounds", "[", 
                 RowBox[{"Polygon", "[", "boundary", "]"}], "]"}], "]"}], ",",
                "\n", "\t\t\t\t", "numberOfVertices", ",", "\n", "\t\t\t\t", 
               RowBox[{"WorkingPrecision", "->", "precision"}]}], "\n", 
              "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
             RowBox[{"RegionMember", "[", 
              RowBox[{"Polygon", "[", "boundary", "]"}], "]"}]}], "\n", 
            "\t\t", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
        RowBox[{"DelaunayMesh", "[", "points", "]"}]}]}], "\n", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"Last", "[", " ", 
       RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], " ", "]"}], 
      " ", "\[Equal]", " ", "2"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomOrigami", "::", "vnum"}], "=", 
     "\"\<Number of vertices `1` should be a positive integer.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomOrigami", "::", "prec"}], "=", 
     "\"\<Option Precision must be a positive number.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"randomOrigami", "::", "bound"}], "=", 
     "\"\<Boundary points should be a list of vertices in 2D.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{"randomMesh", "[", " ", 
     RowBox[{
     "numberOfVertices_", ",", " ", "precision_", ",", " ", "boundary_"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "numberOfVertices", "]"}], " ", "&&", " ", 
           RowBox[{"numberOfVertices", " ", "\[GreaterEqual]", " ", "1"}]}], 
          " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"randomOrigami", "::", "vnum"}], ",", " ", 
           "numberOfVertices"}], " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Not", "[", " ", 
           RowBox[{
            RowBox[{"NumericQ", "[", " ", "precision", " ", "]"}], " ", "&&", 
            " ", 
            RowBox[{"precision", " ", ">", " ", "0"}]}], " ", "]"}], " ", "&&",
           " ", 
          RowBox[{"Not", "[", " ", 
           RowBox[{"precision", " ", "===", " ", "Automatic"}], " ", "]"}]}], 
         ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"randomOrigami", "::", "prec"}], ",", " ", "precision"}], 
          " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"MatrixQ", "[", " ", 
            RowBox[{"boundary", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], "]"}], 
            " ", "\[Equal]", " ", "2"}]}], " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{"randomOrigami", "::", "bound"}], " ", "]"}]}], " ", "]"}], 
       ";", "\n", "\t", "False"}], "\n", ")"}]}]}]}]}]], "Code",
 CellLabel->
  "In[1059]:=",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["addFold[]", "Subsection",ExpressionUUID->"b5299508-8322-4271-9afb-f5f337741415"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"addFold", "[", " ", 
    RowBox[{"{", 
     RowBox[{"v1_", ",", "v2_"}], "}"}], " ", "]"}], "[", " ", 
   RowBox[{"m_", "?", "mechanismQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"mapCells", "[", " ", 
    RowBox[{
     RowBox[{"splitFace", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"{", 
        RowBox[{"v1", ",", "v2"}], "}"}]}], "]"}], "&"}], " ", "]"}], " ", 
   "@", " ", "m"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"addFold", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"v1_", ",", "v2_"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"mapCells", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"splitFace", "[", 
       RowBox[{"#", ",", " ", 
        RowBox[{"{", 
         RowBox[{"v1", ",", "v2"}], "}"}]}], "]"}], "&"}], ",", " ", "m"}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"splitFace", "[", " ", 
   RowBox[{
    RowBox[{"cell", ":", " ", 
     RowBox[{"{", 
      RowBox[{"head_", ",", " ", 
       RowBox[{"{", 
        RowBox[{"v1_", ",", "l___", ",", " ", "v2_"}], "}"}], ",", " ", 
       "data_", ",", " ", "display_"}], "}"}]}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", " ", "v2_Integer"}], "}"}]}], " ", "]"}], " ",
   ":=", " ", "cell"}], "\n", 
 RowBox[{
  RowBox[{"splitFace", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"head_", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
       "l1___", ",", " ", "v1_", ",", " ", "l2__", ",", " ", "v2_", ",", " ", 
        "l3___"}], "}"}], " ", ",", " ", "data_", ",", " ", "display_"}], 
     "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", " ", "v2_Integer"}], "}"}]}], " ", "]"}], " ",
   ":=", "\[IndentingNewLine]", "\t", 
  RowBox[{"Sequence", "[", "\[IndentingNewLine]", "\t\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"head", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "l2", ",", "v2"}], "}"}], ",", "data", ",", " ", 
      "display"}], "}"}], ",", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"{", 
     RowBox[{"head", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v2", ",", " ", "l3", ",", " ", "l1", ",", " ", "v1"}], "}"}], 
      ",", " ", "data", ",", " ", "display"}], "}"}], ",", 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"{", 
     RowBox[{"rigidBar", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2"}], "}"}], ",", " ", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}]}], "}"}]}], "\[IndentingNewLine]", "\t", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"splitFace", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"head_", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
       "l1___", ",", " ", "v1_", ",", " ", "l2__", ",", " ", "v2_", ",", " ", 
        "l3___"}], "}"}], " ", ",", " ", "data_", ",", " ", "display_"}], 
     "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v2_Integer", ",", " ", "v1_Integer"}], "}"}]}], " ", "]"}], " ",
   ":=", "\[IndentingNewLine]", "\t", 
  RowBox[{"Sequence", "[", "\[IndentingNewLine]", "\t\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"head", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "l2", ",", "v2"}], "}"}], ",", "data", ",", " ", 
      "display"}], "}"}], ",", "\[IndentingNewLine]", "\t\t", 
    RowBox[{"{", 
     RowBox[{"head", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v2", ",", " ", "l3", ",", " ", "l1", ",", " ", "v1"}], "}"}], 
      ",", " ", "data", ",", " ", "display"}], "}"}], ",", 
    "\[IndentingNewLine]", "\t\t", 
    RowBox[{"{", 
     RowBox[{"rigidBar", ",", " ", 
      RowBox[{"{", 
       RowBox[{"v2", ",", "v1"}], "}"}], ",", " ", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}]}], "}"}]}], "\[IndentingNewLine]", "\t", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"splitFace", "[", " ", 
   RowBox[{"cell_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", " ", "v2_Integer"}], "}"}]}], " ", "]"}], " ",
   ":=", " ", "cell"}]}], "Code",
 CellLabel->
  "In[1064]:=",ExpressionUUID->"c88252b2-ffad-4dd1-859c-2bd8cba16a86"]
}, Closed]],

Cell[CellGroupData[{

Cell["subdivideFaces[]", "Subsection",ExpressionUUID->"8f6d6aa2-a5f3-44bd-b466-85e186e748fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "polygonDiagonals", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"polygonDiagonals", "[", " ", "vertices_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"guesses", " ", "=", " ", 
        RowBox[{"Tuples", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", "2"}], 
         " ", "]"}]}], ",", " ", 
       RowBox[{"l", " ", "=", " ", 
        RowBox[{"Length", "[", "vertices", "]"}]}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{"DeleteDuplicatesBy", "[", " ", 
      RowBox[{
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"vertices", "[", 
           RowBox[{"[", "#", "]"}], "]"}], "&"}], ",", " ", 
         RowBox[{"Select", "[", " ", 
          RowBox[{"guesses", ",", " ", 
           RowBox[{
            RowBox[{"Between", "[", " ", 
             RowBox[{
              RowBox[{"Abs", "[", " ", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "  ", 
              RowBox[{"{", 
               RowBox[{"2", ",", " ", 
                RowBox[{
                 RowBox[{"Length", "[", "vertices", "]"}], "-", "2"}]}], 
               "}"}]}], " ", "]"}], " ", "&"}]}], " ", "]"}], ",", " ", 
         RowBox[{"{", "2", "}"}]}], " ", "]"}], ",", " ", "Sort"}], "]"}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"findShortestDiagonal", "[", " ", 
    RowBox[{"coordinates_", ",", " ", 
     RowBox[{"vertices", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"diagonals", " ", "=", " ", 
       RowBox[{"polygonDiagonals", "[", " ", "vertices", " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"MinimalBy", "[", " ", 
       RowBox[{
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"{", " ", 
          RowBox[{"diagonals", " ", ",", " ", 
           RowBox[{"displacementLength", "[", " ", 
            RowBox[{"coordinates", ",", " ", "diagonals"}], " ", "]"}]}], " ",
           "}"}], " ", "]"}], " ", ",", " ", "Last"}], " ", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "addFoldToFace", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"addFoldToFace", "[", " ", 
   RowBox[{
   "coordinates_", ",", " ", "dataNew_", ",", " ", "displayNew_", ",", " ", 
    RowBox[{"{", " ", 
     RowBox[{
     "face", " ", ",", " ", "indices_", ",", " ", "data_", ",", " ", 
      "display_"}], " ", "}"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Sequence", " ", "@@", " ", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"shortestDiagonal", " ", "=", " ", 
        RowBox[{"findShortestDiagonal", "[", " ", 
         RowBox[{"coordinates", ",", " ", "indices"}], " ", "]"}]}], "}"}], 
      ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"splitFace", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "face", ",", " ", "indices", ",", " ", "data", ",", " ", 
            "display"}], "}"}], " ", ",", " ", "shortestDiagonal"}], " ", 
         "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{
         "fold", ",", " ", "shortestDiagonal", ",", " ", "dataNew", ",", " ", 
          "displayNew"}], " ", "}"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "indices", "]"}], " ", ">", " ", "3"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"addFoldToFace", "[", " ", 
    RowBox[{
    "coordinates_", ",", " ", "data_", ",", " ", "display_", ",", " ", 
     "cell_"}], " ", "]"}], " ", ":=", " ", "cell"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "subdivideFaces", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<display\>\"", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\"\<data\>\"", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<angle\>\"", " ", "\[Rule]", " ", "0"}], " ", ",", " ", 
        RowBox[{
        "\"\<torsionalStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}]}], 
       " ", "}"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"subdivideFaces", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "mechanismQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"coordinates", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], ",", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<data\>\"", "]"}]}], ",", " ", 
      RowBox[{"display", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<display\>\"", "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"FixedPoint", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"mapCells", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"addFoldToFace", "[", " ", 
           RowBox[{
           "coordinates", ",", " ", "data", ",", " ", "display", " ", ",", 
            " ", "#"}], " ", "]"}], "&"}], ",", " ", "#"}], " ", "]"}], " ", 
       "&"}], ",", " ", "m"}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "In[1070]:=",ExpressionUUID->"992ac084-622b-46f9-88a6-1e6f80acfc8a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["origami queries", "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],

Cell[CellGroupData[{

Cell["flatOrigamiQ[]", "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "flatOrigamiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "Automatic"}], ",", "\n", "\t", 
     RowBox[{"Precision", "->", "Infinity"}]}], "\n", "}"}]}], ";"}]], "Code",\

 CellLabel->
  "In[1078]:=",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"flatOrigamiQ", "::", "precision"}], "=", 
   "\"\<Precision is not a positive real number or Infinity.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flatOrigamiQ", "::", "zerotest"}], "=", 
   "\"\<ZeroTest function must return True or False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "In[1079]:=",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  RowBox[{"Precision", "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"precision_", "?", "NumericQ"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{"Precision", "[", "m", "]"}], ",", "precision"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"precision", ">", "0"}]}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "_"}], "]"}], " ", ":=", " ", "$Failed"}]}], "Code",
 CellLabel->
  "In[1081]:=",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  "PossibleZeroQ"}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", "#", "]"}], "<=", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "precision"}], "+", "1"}], ")"}]}]}], "&"}], 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"f_", ",", "_"}], "]"}], " ", ":=", " ", "f"}]}], "Code",
 CellLabel->
  "In[1084]:=",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flatOrigamiQ", "[", 
   RowBox[{"m_origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"actualPrecision", " ", "=", " ", 
       RowBox[{"computePrecision", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "Precision", "]"}]}], "]"}]}], ",", " ", 
      "zerotestFunction", ",", " ", "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"zerotestFunction", "=", 
      RowBox[{"computeZeroTestFunction", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], ",", " ", 
        "actualPrecision"}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "=", 
      RowBox[{"flatOrigamiInternalQ", "[", 
       RowBox[{"m", ",", "actualPrecision", ",", "zerotestFunction"}], 
       "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "/;", 
      RowBox[{"Which", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], "=!=", "flatOrigamiInternalQ"}], 
        ",", "\n", "\t\t\t", "True", ",", "\n", "\t\t", 
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", 
          RowBox[{"zerotestFunction", "[", "0", "]"}], "]"}], "]"}], ",", 
        "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"flatOrigamiQ", "::", "zerotest"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", 
        RowBox[{"actualPrecision", "===", "$Failed"}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"flatOrigamiQ", "::", "precision"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", "True", ",", "False"}], "\n", "\t", 
       "]"}]}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[1087]:=",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flatOrigamiInternalQ", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "NumericQ"}], " ", "|", " ", "Infinity"}]}], ",", " ", 
    RowBox[{"zerotestFunction_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"BooleanQ", "[", 
        RowBox[{"#", "[", "0", "]"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  "\n", "\t", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"gaussianCurvature", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "precision"}],
        "]"}], " ", ",", " ", 
      RowBox[{"interiorVertices", "[", "m", "]"}]}], " ", "]"}], ",", " ", 
    "zerotestFunction"}], "]"}]}]], "Code",
 CellLabel->
  "In[1088]:=",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],

Cell[CellGroupData[{

Cell["kawasakiQ[]", "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "kawasakiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "PossibleZeroQ"}], ",", "\n", "\t", 
     RowBox[{"WorkingPrecision", "->", "Infinity"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "In[1089]:=",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],

Cell[BoxData[
 RowBox[{
  RowBox[{"kawasakiQ", "[", 
   RowBox[{"m_origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"v", "=", 
        RowBox[{"interiorVertices", "[", "m", "]"}]}], ",", "\n", "\t", 
       RowBox[{"mNum", "=", 
        RowBox[{"N", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"flatOrigamiQ", "[", 
        RowBox[{"m", ",", "opt"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"And", "@@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", 
            RowBox[{"kawasakiAlternatingSum", "[", 
             RowBox[{"mNum", ",", "#"}], "]"}], "]"}], "&"}], "/@", "v"}], 
         ")"}]}], ",", "\n", "\t\t", "False"}], "\n", "\t", "]"}]}], "\n", 
    "]"}], "/;", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", "\n", "\t", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], ")"}], "&&", "\n", "\t", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], 
      "]"}]}], "\n", ")"}]}]}]], "Code",
 CellLabel->
  "In[1090]:=",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],

Cell[BoxData[
 RowBox[{
  RowBox[{"kawasakiAlternatingSum", "[", 
   RowBox[{"m_", ",", "v_Integer"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"faces", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
       RowBox[{"listFaces", "[", 
        RowBox[{"m", ",", "v"}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"OddQ", "[", 
       RowBox[{"Length", "[", "faces", "]"}], "]"}], ",", "\n", "\t\t", "1", 
      ",", "\n", "\t\t", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "1"}], ")"}], "^", "#"}], " ", "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "faces", "]"}], "]"}]}], "]"}], " ", ".", 
        " ", 
        RowBox[{"planarAngle", "[", 
         RowBox[{"m", ",", "faces"}], "]"}]}], "]"}]}], "\n", "\t", "]"}]}], 
   "\n", "]"}]}]], "Code",
 CellLabel->
  "In[1091]:=",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"kawasakiQ", "::", "workingprecision"}], "=", 
   "\"\<Working precesion must be a real value larger than 0.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"kawasakiQ", "::", "zerotest"}], "=", 
    "\"\<Zero test does not return True or False.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"kawasakiQ", "[", 
   RowBox[{"m_origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"kawasakiQ", "::", "workingprecision"}], "]"}], ";", "\n", 
      "\t\t", "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"BooleanQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], "]"}],
       "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"kawasakiQ", "::", "zerotest"}], "]"}], ";", "\n", "\t\t", 
      "False"}], ",", "\n", "\t", "True", ",", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[1092]:=",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],

Cell[CellGroupData[{

Cell["sameFoldAnglesQ[]", "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sameFoldAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"folds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"foldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos1", ",", " ", "folds"}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"foldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos2", ",", " ", "folds"}], " ", "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", " ", 
      RowBox[{"precision", "^", "2"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sameFoldAnglesQ", "[", 
     RowBox[{"m_origami", ",", " ", 
      RowBox[{"folds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameFoldAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"folds", " ", "=", " ", 
       RowBox[{"interiorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"angles1", " ", "=", " ", 
          RowBox[{"foldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos1", ",", " ", "folds"}], " ", "]"}]}], 
         ",", "\n", "\t", 
         RowBox[{"angles2", " ", "=", " ", 
          RowBox[{"foldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos2", ",", " ", "folds"}], " ", "]"}]}]}],
         "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", " ", 
         RowBox[{"(", 
          RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", 
        " ", 
        RowBox[{"precision", "^", "2"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}],
    " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameFoldAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "In[1095]:=",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],

Cell[CellGroupData[{

Cell["sameMVAnglesQ[]", "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sameMVAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"folds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
      "0.1"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"foldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos1", ",", " ", "folds"}], " ", "]"}]}], 
         " ", "]"}]}], ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"foldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos2", ",", " ", "folds"}], " ", "]"}]}], 
         " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"And", " ", "@@", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", "]"}],
    " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sameMVAnglesQ", "[", 
     RowBox[{"m_origami", ",", " ", 
      RowBox[{"folds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "Integer"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameMVAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"folds", " ", "=", " ", 
       RowBox[{"interiorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"angles1", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"foldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos1", ",", " ", "folds"}], " ", "]"}]}],
            " ", "]"}]}], ",", "\n", "\t", 
         RowBox[{"angles2", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"foldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos2", ",", " ", "folds"}], " ", "]"}]}],
            " ", "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{"And", " ", "@@", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", 
      "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MeshCellCount", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<mesh\>\"", "]"}], ",", "0"}], "]"}], ",", 
       RowBox[{"embeddingDimension", "[", "m", "]"}]}], "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameMVAnglesQ", "[", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "In[1099]:=",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["origami data", "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],

Cell[CellGroupData[{

Cell["foldMatrix[]", "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"foldMatrix", "[", "m_origami", "]"}], ":=", 
  RowBox[{"foldMatrixInternal", "[", 
   RowBox[{"m", ",", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
    RowBox[{"interiorEdges", "[", "m", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"foldMatrix", "[", 
   RowBox[{"m_origami", ",", "positions_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"foldMatrixInternal", "[", 
    RowBox[{"m", ",", 
     RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
     RowBox[{"interiorEdges", "[", "m", "]"}]}], "]"}], "/;", 
   RowBox[{"vertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"foldMatrix", "[", 
   RowBox[{"m_origami", ",", "positions_", ",", 
    RowBox[{"indices_", "?", "edgeListQ"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"foldMatrixInternal", "[", 
    RowBox[{"m", ",", "positions", ",", "indices"}], "]"}], "/;", 
   RowBox[{"vertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}]}], "Code",
 CellLabel->
  "In[1103]:=",ExpressionUUID->"5a272a8d-b37b-477f-a024-ee728ce8ca49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"foldMatrixInternal", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"indices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"displacements", "=", 
      RowBox[{"vertexDisplacement", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"foldAngle", "[", 
        RowBox[{"m", ",", 
         RowBox[{"positions", "+", "displacements"}], ",", "indices"}], "]"}],
        ",", 
       RowBox[{"{", 
        RowBox[{"Flatten", "[", "displacements", "]"}], "}"}]}], "]"}], "/.", 
     
     RowBox[{"Dispatch", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "displacements", "]"}], "->", "0"}], "]"}], 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[1106]:=",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"foldMatrix", "::", "notorig"}], "=", 
   "\"\<Mechanism is not origami.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"foldMatrix", "::", "pos"}], "=", 
   "\"\<Positions do not correspond to the mechanism provided.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"foldMatrix", "::", "indices"}], "=", 
    "\"\<Indices provided do not correspond to a list of edges.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"foldMatrix", "[", "m_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"foldMatrix", "::", "notorig"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"foldMatrix", "[", 
   RowBox[{"m_", ",", "positions_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"foldMatrix", "::", "notorig"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"foldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", "True", 
     ",", "False"}], "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"foldMatrix", "[", 
   RowBox[{"m_", ",", "positions_", ",", "indices_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"foldMatrix", "::", "notorig"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"foldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"Dimensions", "[", "indices", "]"}], "]"}], "!=", "2"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"foldMatrix", "::", "indices"}], "]"}], ",", "\n", "\t", "True",
      ",", "False"}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[1107]:=",ExpressionUUID->"0f22cd14-f2c6-414f-9ee6-3d896ed5cfcc"]
}, Closed]],

Cell[CellGroupData[{

Cell["angularFoldMatrix[]", "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"angularFoldMatrix", "[", 
   RowBox[{"m_origami", ",", "vertex_Integer"}], "]"}], ":=", 
  RowBox[{"angularFoldMatrix", "[", 
   RowBox[{"m", ",", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", "vertex"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"angularFoldMatrix", "[", 
   RowBox[{"m_origami", ",", 
    RowBox[{"positions_", "?", "MatrixQ"}], ",", "vertex_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vertices", "=", 
        RowBox[{"listVertices", "[", 
         RowBox[{"m", ",", "vertex"}], "]"}]}], ",", "foldLengths", ",", 
       "angles", ",", "heights"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"foldLengths", "=", 
       RowBox[{"displacementLength", "[", 
        RowBox[{
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", "vertices"}]}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"heights", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"vertexDisplacement", "[", 
          RowBox[{"vertices", ",", "\"\<z\>\""}], "]"}], "->", 
         RowBox[{"foldLengths", " ", 
          RowBox[{"Array", "[", 
           RowBox[{"angles", ",", 
            RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}]}], "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"Last", "@", 
       RowBox[{"CoefficientArrays", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{
             RowBox[{"foldMatrixInternal", "[", 
              RowBox[{"m", ",", "positions", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", 
                "vertices"}]}], "]"}], " ", ".", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"vertexDisplacement", "[", 
               RowBox[{"m", ",", 
                RowBox[{"All", "[", "3", "]"}]}], "]"}], "]"}]}]}], "/.", 
           "heights"}], "/.", 
          RowBox[{
           RowBox[{"vertexDisplacement", "[", 
            RowBox[{"_", ",", "_"}], "]"}], "->", "0"}]}], ",", "\n", "\t\t", 
         
         RowBox[{"Array", "[", 
          RowBox[{"angles", ",", 
           RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}], "\n", "\t", 
        "]"}]}]}]}], "\n", "]"}], "/;", 
   RowBox[{"MemberQ", "[", 
    RowBox[{
     RowBox[{"interiorVertices", "[", "m", "]"}], ",", "vertex"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[1113]:=",ExpressionUUID->"9464b0a7-e384-4ae5-9af9-43a3e239bf92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"angularFoldMatrix", "::", "notintv"}], "=", 
   "\"\<Vertex should be an interior vertex.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"angularFoldMatrix", "::", "orig"}], "=", 
   "\"\<Mechanism is not origami.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"angularFoldMatrix", "::", "pos"}], "=", 
    "\"\<Positions do not correspond to the mechanism provided.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"angularFoldMatrix", "[", 
   RowBox[{"m_origami", ",", "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"angularFoldMatrix", "::", "notintv"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"angularFoldMatrix", "[", 
   RowBox[{"m_", ",", "positions_", ",", "v_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "=!=", "origami"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"angularFoldMatrix", "::", "orig"}], "]"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"vertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"angularFoldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"IntegerQ", "[", "v", "]"}], "]"}], "||", 
      RowBox[{"Not", "[", 
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"interiorVertices", "[", "m", "]"}], ",", "v"}], "]"}], 
       "]"}]}], ",", 
     RowBox[{"Message", "[", 
      RowBox[{"angularFoldMatrix", "::", "notintv"}], "]"}], ",", "\n", "\t", 
     "True", ",", "False"}], "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "In[1115]:=",ExpressionUUID->"abf836c2-0f64-4bef-a1a6-0c0029eb66ae"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics and geometry", "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],

Cell[CellGroupData[{

Cell["butterflyDecomposition[], butterflyDecomposableQ[]", "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"butterflyDecomposition", "[", " ", "o_origami", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"results", " ", "=", " ", 
        RowBox[{"FixedPointList", "[", " ", 
         RowBox[{"butterflyDecompositionStep", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", "o"}], "}"}]}], " ", "]"}]}], ",", " ", 
       "remainingOrigami"}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"remainingOrigami", " ", "=", " ", 
       RowBox[{
        RowBox[{"Last", "[", "results", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"Drop", "[", " ", 
         RowBox[{
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"results", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], ",", " ", 
        "remainingOrigami"}], " ", "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"butterflyDecompositionStep", "[", " ", 
   RowBox[{"{", 
    RowBox[{"facepair_", ",", " ", "o_origami"}], "}"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"boundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"connectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         " ", "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"butterfly", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"deleteCells", "[", 
            RowBox[{"o", ",", " ", 
             RowBox[{"Alternatives", "@@", 
              RowBox[{"(", " ", 
               RowBox[{"face", " ", "/@", " ", 
                RowBox[{"butterfly", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", ")"}]}]}], " ", 
            "]"}]}], " ", "}"}]}], ",", "\n", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"facepair", ",", " ", "o"}], "}"}]}], "\n", "\t", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"butterflyDecompositionStep", "[", " ", 
    RowBox[{"{", 
     RowBox[{"facepair_", ",", "o_origami"}], "}"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", 
    RowBox[{"facepair", ",", "o"}], "}"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "version", " ", "shows", " ", "little", " ", "speed", " ", 
    "improvements", " ", "over", " ", "solving", " ", "everything", " ", 
    "explicitly"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"butterflyDecompositionQ", "[", " ", "o_origami", " ", "]"}], " ", 
   ":=", " ", 
   RowBox[{"FixedPoint", "[", " ", 
    RowBox[{"butterflyDecompositionStepQ", ",", " ", "o"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"butterflyDecompositionStepQ", "[", " ", 
   RowBox[{"f_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", "f"}], "\n", 
 RowBox[{
  RowBox[{"butterflyDecompositionStepQ", "[", " ", "o_origami", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"boundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"connectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         " ", "\n", "\t\t", 
         RowBox[{"deleteVertices", "[", 
          RowBox[{"o", ",", " ", 
           RowBox[{"{", 
            RowBox[{"butterfly", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}]}], ",", "\n", 
        "\n", "\t\t", "False"}], "\n", "\t", "]"}]}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{"butterflyDecompositionStepQ", "[", " ", "o_origami", " ", "]"}], 
  " ", ":=", " ", "True"}]}], "Code",
 CellLabel->
  "In[1120]:=",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],

Cell[CellGroupData[{

Cell["flattenOrigami[]", "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unfoldOrigami", "[", " ", "m_origami", " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"folds", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"fold", "[", "#", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<angle\>\"", " ", "\[Rule]", " ", "0"}], "}"}]}], " ",
           "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"interiorEdges", "[", "m", "]"}]}]}], ",", "\n", "\t", 
      "selfflatteningOrigami", ",", " ", "res"}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"selfflatteningOrigami", " ", "=", " ", 
      RowBox[{"addCells", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"deleteCells", "[", " ", "_joint", " ", "]"}], " ", "@", " ", 
         RowBox[{
          RowBox[{"deleteCells", "[", " ", "_fold", " ", "]"}], " ", "@", " ",
           "m"}]}], ",", " ", "folds"}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"minimizeEnergy", "[", " ", 
       RowBox[{"selfflatteningOrigami", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "6"}]}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], "===", "List"}], ",", " ", "res", 
       ",", " ", 
       RowBox[{"{", 
        RowBox[{"Infinity", ",", " ", 
         RowBox[{"m", "[", "\"\<positions\>\"", "]"}]}], "}"}]}], " ", 
      "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "In[1127]:=",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chooseBoundaryFace", "[", " ", "m_origami", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"First", " ", "@", " ", 
   RowBox[{"SelectFirst", "[", " ", 
    RowBox[{
     RowBox[{"connectivity", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ",
       "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], " ", "&"}]}], 
    " ", "]"}]}]}]], "Code",
 CellLabel->
  "In[1128]:=",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rotateFaceToXYPlane", "[", " ", 
    RowBox[{"positions_", ",", " ", 
     RowBox[{"face", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"initialPoints", " ", "=", " ", 
        RowBox[{"positions", "[", 
         RowBox[{"[", " ", 
          RowBox[{"face", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "3"}], "]"}], "]"}], " ", "]"}], "]"}]}], ",", 
       " ", "lengths", ",", " ", "angle", ",", " ", "newPointLocations", ",", 
       " ", "residual", ",", " ", "transform"}], " ", "}"}], ",", " ", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"lengths", " ", "=", " ", 
       RowBox[{"displacementLength", "[", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", 
           RowBox[{"face", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "}"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"angle", " ", "=", " ", 
       RowBox[{"First", " ", "@", " ", 
        RowBox[{"planarAngle", "[", " ", 
         RowBox[{"positions", ",", " ", 
          RowBox[{"{", 
           RowBox[{"face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "3"}], "]"}], "]"}], "}"}]}], " ", "]"}]}]}], 
      ";", "\t", "\n", "\t", 
      RowBox[{"newPointLocations", " ", "=", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"lengths", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
         "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"lengths", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cos", "[", " ", "angle", " ", "]"}], ",", " ", 
            RowBox[{"Sin", "[", " ", "angle", " ", "]"}], ",", " ", "0"}], 
           " ", "}"}]}]}], "\n", "\t", "}"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"residual", ",", " ", "transform"}], " ", "}"}], " ", "=", 
       " ", 
       RowBox[{"FindGeometricTransform", "[", " ", 
        RowBox[{"newPointLocations", ",", "initialPoints", ",", " ", 
         RowBox[{
         "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], ",", 
         " ", 
         RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ", 
        "]"}]}], ";", "\n", "\n", "\t", "transform"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "::", "face"}], "=", 
   "\"\<Unable to identify faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rotateFaceToXYPlane", "[", " ", 
   RowBox[{"m_origami", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"flattenOrigami", "::", "face"}], "]"}], ";", " ", "Identity"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "In[1129]:=",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "flattenOrigami", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "[", " ", 
    RowBox[{"m_origami", " ", ",", " ", 
     RowBox[{"tol_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
         RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "unfoldedEnergy", ",", " ", "unfoldedPositions", ",", " ", "transform", 
       ",", " ", "xyPositions", ",", " ", "newOrigami"}], " ", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"flatOrigamiQ", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Precision", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"flattenOrigami", "::", "flat"}], "]"}]}], " ", "]"}], ";", 
      "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"unfoldedEnergy", ",", " ", "unfoldedPositions"}], " ", "}"}],
        " ", "=", " ", 
       RowBox[{"unfoldOrigami", "[", "m", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ")"}], " ", "@", 
          " ", 
          RowBox[{"foldAngle", "[", 
           RowBox[{"m", ",", " ", "unfoldedPositions", ",", " ", 
            RowBox[{"interiorEdges", "[", "m", "]"}]}], "]"}]}], " ", ">", 
         " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}], ",", " ", 
        RowBox[{"Message", "[", " ", 
         RowBox[{"flattenOrigami", "::", "notflt"}], " ", "]"}]}], " ", "]"}],
       ";", "\n", "\n", "\t", 
      RowBox[{"transform", " ", "=", " ", 
       RowBox[{"rotateFaceToXYPlane", "[", " ", 
        RowBox[{"unfoldedPositions", ",", " ", 
         RowBox[{"chooseBoundaryFace", "[", "m", "]"}]}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"xyPositions", " ", "=", " ", 
       RowBox[{"PadRight", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"transform", "[", " ", "unfoldedPositions", " ", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "unfoldedPositions", "]"}], ",", " ", "3"}],
           " ", "}"}]}], " ", "]"}]}], ";", "\n", "\t\t\t", "\n", "\t", 
      RowBox[{"mechanisms`Private`addMeshRegion", "[", " ", 
       RowBox[{
        RowBox[{"origami", "[", " ", 
         RowBox[{"xyPositions", ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], ",", " ", 
        "Automatic", ",", " ", "opt"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "::", "notflt"}], "=", 
   "\"\<Origami flat energy may be too large to get good results.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "::", "flat"}], "=", 
   "\"\<Gaussian curvature of vertices is not flat to desired tolerance \
`1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flattenOrigami", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance `1` should be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"flattenOrigami", "::", "tol2"}], " ", "=", " ", 
    "\"\<Second argument should be a tolerance.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"flattenOrigami", "[", " ", 
   RowBox[{"m_origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"flattenOrigami", "::", "tol2"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"flattenOrigami", "[", " ", 
   RowBox[{"m_origami", ",", " ", "tol_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"flattenOrigami", "::", "tol"}], ",", " ", "tol"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "In[1132]:=",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],

Cell[CellGroupData[{

Cell["MVAssignment[]", "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MVAssignment", "[", " ", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"positions_", " ", ":", " ", "Automatic"}], ",", " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}]}], ",", " ", 
     RowBox[{"color_", " ", ":", " ", "Automatic"}]}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"pos", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"positions", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", 
          "positions"}], "]"}]}], ",", " ", "\n", "\t", 
       RowBox[{"colorFunction", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"color", " ", "===", " ", "Automatic"}], ",", " ", 
          "MVdefaultColor", ",", " ", "color"}], " ", "]"}]}], ",", " ", "\n",
        "\t", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"interiorEdges", "[", "m", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"angles", " ", "=", " ", 
          RowBox[{"foldAngle", "[", 
           RowBox[{"m", ",", " ", "pos", ",", " ", "edges"}], "]"}]}], " ", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#1", " ", "\[Rule]", " ", 
             RowBox[{"colorFunction", "[", " ", 
              RowBox[{"assignMVForFold", "[", " ", 
               RowBox[{"#2", ",", " ", "tol"}], " ", "]"}], " ", "]"}]}], " ",
             ")"}], " ", "&"}], " ", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"edges", ",", " ", "angles"}], " ", "}"}]}], " ", "]"}]}], 
       "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{"numericCoordinatesQ", "[", 
       RowBox[{"m", ",", " ", "pos"}], "]"}]}]}], "\n", "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{"1", " ", "/;", " ", 
   RowBox[{"angle", " ", ">", " ", 
    RowBox[{"Abs", "[", "tol", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"-", "1"}], " ", "/;", " ", 
   RowBox[{"angle", " ", "<", " ", 
    RowBox[{"-", 
     RowBox[{"Abs", "[", "tol", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"assignMVForFold", "[", 
    RowBox[{"_", ",", "_"}], "]"}], ":=", "0"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "1", "]"}], " ", ":=", " ", "Red"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", 
   RowBox[{"-", "1"}], "]"}], " ", ":=", " ", "Blue"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "0", "]"}], " ", ":=", " ", 
  "Black"}]}], "Code",
 CellLabel->
  "In[1140]:=",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["SurfaceArea[], RegionMeasure[], RegionMoment[]", "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SurfaceArea", "[", 
   RowBox[{"o_origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"SurfaceArea", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMeasure", "[", 
   RowBox[{"o_origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMeasure", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMoment", "[", 
   RowBox[{"o_origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMoment", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<mesh\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "In[1147]:=",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],

Cell[CellGroupData[{

Cell["texture[]", "Subsection",ExpressionUUID->"ca8bfc39-6cbe-49cd-916b-27aa904950fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"texture", "[", "]"}], " ", ":=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
     "\"\<WhitePaper\>\"", ",", " ", "\"\<GrayPaper\>\"", ",", " ", 
      "\"\<WrinkledPaper\>\""}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$dataDirectory", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{"PacletFind", "[", "\"\<Mechanisms\>\"", "]"}]}], ")"}], 
        "[", "\"\<Location\>\"", "]"}], ",", "\"\<Resources\>\"", ",", 
       "\"\<Textures\>\""}], "}"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"texture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"texture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", "=", " ", 
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<crinkled-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"texture", "[", "\"\<WhitePaper\>\"", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"texture", "[", "\"\<WhitePaper\>\"", "]"}], " ", "=", " ", 
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<white-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"texture", "[", "\"\<GrayPaper\>\"", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"texture", "[", "\"\<GrayPaper\>\"", "]"}], " ", "=", " ", 
    RowBox[{"Texture", " ", "@", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"Import", "[", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"$dataDirectory", ",", "\"\<blue-paper.jpeg\>\""}], "}"}], 
        "]"}], "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"texture", "::", "bad"}], "=", 
   "\"\<Unrecognized texture `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"texture", "[", "s_", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"texture", "::", "bad"}], ",", " ", "s"}], "]"}]}]}]}], "Code",Ex\
pressionUUID->"fcf85ece-3c2a-4192-b269-84aca2ba61c1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["plotOrigami[]", "Subsection",ExpressionUUID->"0d47f488-fc16-43ad-8fe4-3fc44f943dcd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "plotOrigami", " ", "]"}], " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<folds\>\"", " ", "\[Rule]", " ", "None"}], ",", "  ", 
      RowBox[{"\"\<face\>\"", " ", "\[Rule]", " ", "\"\<WrinkledPaper\>\""}], 
      ",", " ", 
      RowBox[{"\"\<thickness\>\"", " ", "\[Rule]", " ", "0.003"}]}], " ", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"plotOrigami", "[", " ", 
   RowBox[{"m_origami", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"plotOrigami", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<positions\>\"", "]"}], ",", " ", "opt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "[", " ", 
    RowBox[{"m_origami", ",", " ", 
     RowBox[{"pos_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"faces", ",", " ", "positions", " ", ",", "\n", "\t", 
        RowBox[{"folds", " ", "=", " ", 
         RowBox[{"interiorEdges", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"boundary", " ", "=", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{
           RowBox[{"boundaryEdges", "[", "m", "]"}], " ", ",", " ", "1"}], 
          " ", "]"}]}], ",", "\n", "\t", 
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"displayDimension", "[", "m", "]"}]}], ",", "\n", "\t", 
        "positionMap"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"pos", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "pos", "]"}], ",", " ", "d"}], "}"}]}], 
         " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"positionMap", " ", "=", " ", 
        RowBox[{"Dispatch", "[", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", " ", 
            RowBox[{"Length", "[", "pos", "]"}], " ", "]"}], " ", "\[Rule]", 
           " ", "positions"}], " ", "]"}], " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"faces", " ", "=", " ", 
        RowBox[{"toGraphics", "[", " ", 
         RowBox[{"m", ",", " ", "positions", ",", " ", "2", ",", " ", 
          RowBox[{
          "VertexTextureCoordinates", " ", "\[Rule]", " ", "positions"}]}], 
         " ", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Show", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"d", "\[Equal]", "2"}], ",", " ", "Graphics", ",", " ", 
            "Graphics3D"}], " ", "]"}], " ", "/@", "\n", "\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"Check", "[", " ", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"StringQ", "[", " ", 
                   RowBox[{"OptionValue", "[", "\"\<face\>\"", "]"}], " ", 
                   "]"}], ",", " ", 
                  RowBox[{"texture", "[", 
                   RowBox[{"OptionValue", "[", "\"\<face\>\"", "]"}], "]"}], 
                  " ", ",", " ", 
                  RowBox[{"OptionValue", "[", "\"\<face\>\"", "]"}]}], " ", 
                 "]"}], " ", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", 
              "\t\t\t", "faces"}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t", 
            "\n", "\t\t\t", 
            RowBox[{"Flatten", " ", "@", " ", 
             RowBox[{"{", " ", 
              RowBox[{
               RowBox[{"Thickness", "[", " ", 
                RowBox[{"2", " ", 
                 RowBox[{"OptionValue", "[", "\"\<thickness\>\"", "]"}]}], 
                " ", "]"}], ",", " ", "Black", ",", " ", 
               RowBox[{"Line", " ", "/@", " ", 
                RowBox[{"(", 
                 RowBox[{"boundary", " ", "/.", " ", "positionMap"}], 
                 ")"}]}]}], " ", "}"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"Check", "[", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"MapThread", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", " ", 
                   RowBox[{"#1", ",", " ", 
                    RowBox[{"Thickness", "[", " ", 
                    RowBox[{"OptionValue", "[", "\"\<thickness\>\"", "]"}], 
                    " ", "]"}], ",", "  ", 
                    RowBox[{"Line", "[", "#2", "]"}]}], " ", "}"}], "]"}], 
                 " ", "&"}], " ", ",", " ", 
                RowBox[{"{", " ", 
                 RowBox[{
                  RowBox[{"foldStyleGraphics", "[", " ", 
                   RowBox[{"folds", ",", " ", 
                    RowBox[{"OptionValue", "[", "\"\<folds\>\"", "]"}]}], " ",
                    "]"}], ",", "  ", 
                  RowBox[{"(", 
                   RowBox[{"folds", " ", "/.", " ", "positionMap"}], ")"}]}], 
                 "}"}]}], " ", "]"}], ",", "\n", "\t\t\t\t", "Nothing"}], 
             "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "}"}]}], ",", "\n", 
         "\t\t", 
         RowBox[{"Boxed", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"BoxRatios", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ",", " ", 
         RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}]}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"lineThicknessQ", "[", " ", 
      RowBox[{"OptionValue", "[", "\"\<thickness\>\"", "]"}], " ", "]"}], " ",
      "&&", " ", 
     RowBox[{"checkVertexNumberQ", "[", " ", 
      RowBox[{
       RowBox[{"m", "[", "\"\<VertexNumber\>\"", "]"}], " ", "\[Equal]", " ", 
       
       RowBox[{"Length", "[", "pos", "]"}]}], " ", "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "vert"}], " ", "=", " ", 
   "\"\<Number of vertices does not match number of vertex positions \
provided.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"checkVertexNumberQ", "[", " ", 
    RowBox[{"b_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", "[", "b", "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"plotOrigami", "::", "vert"}], "]"}]}], " ", "]"}], ";", " ", 
     "b"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "thick"}], " ", "=", " ", 
   "\"\<Line thickness, `1`, should be a positive real number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"lineThicknessQ", "[", " ", 
   RowBox[{"t_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lineThicknessQ", "[", " ", "t_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"plotOrigami", "::", "thick"}], ",", " ", "t"}], "]"}], ";", 
     " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotOrigami", "::", "folds"}], " ", "=", " ", 
   "\"\<Folds should be of the form {{v1,v2}, ... } -> { style1, ... \
}.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"foldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", "None"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ConstantArray", "[", " ", 
   RowBox[{"Black", ",", " ", 
    RowBox[{"Length", "[", "allFolds", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"foldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"folds_", "?", "MatrixQ"}], " ", "\[Rule]", " ", "style_List"}],
      "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"foldStyleGraphics", "[", " ", 
   RowBox[{"allFolds", ",", " ", 
    RowBox[{"folds", " ", "\[Rule]", " ", "style"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"foldStyleGraphics", "[", " ", 
   RowBox[{"allFolds_", ",", " ", 
    RowBox[{
     RowBox[{"folds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], " ", 
     "\[Rule]", " ", "style_List"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"rules", " ", "=", " ", 
       RowBox[{"Dispatch", " ", "@", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Sort", " ", "/@", " ", "folds"}], ")"}], " ", "\[Rule]", 
          " ", "style"}], " ", "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Sort", "/@", "allFolds"}], ")"}], " ", "/.", " ", "rules"}], 
      " ", "/.", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", " ", "_Integer"}], "}"}], " ", "\[Rule]", 
       " ", "Black"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"Dimensions", "[", " ", "folds", " ", "]"}], "]"}], " ", 
     "\[Equal]", " ", "2"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", "folds", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Length", "[", "style", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"foldStyleGraphics", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"plotOrigami", "::", "folds"}], "]"}], ";", " ", "$Failed"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "In[1156]:=",ExpressionUUID->"be26471b-7aca-47f8-a89c-7add247b3d4f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "In[1169]:=",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1898, 715},
WindowMargins->{{Automatic, 884}, {Automatic, 331}},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"10003f09-38cd-4dfb-802f-fa234ab7339b"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 107, 0, 98, "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],
Cell[690, 24, 168, 4, 81, "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],
Cell[CellGroupData[{
Cell[883, 32, 100, 0, 45, "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],
Cell[986, 34, 222, 5, 35, "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],
Cell[1211, 41, 164, 4, 35, "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],
Cell[1378, 47, 234, 5, 35, "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],
Cell[1615, 54, 202, 4, 35, "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],
Cell[1820, 60, 235, 3, 58, "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2092, 68, 109, 0, 45, "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],
Cell[2204, 70, 387, 7, 58, "Text",ExpressionUUID->"01e0f39a-cdd3-4398-9885-4e9122d860da"],
Cell[2594, 79, 229, 3, 35, "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2860, 87, 123, 0, 69, "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],
Cell[2986, 89, 399, 9, 91, "Code",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"],
Cell[CellGroupData[{
Cell[3410, 102, 79, 0, 67, "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],
Cell[3492, 104, 478, 11, 72, "Code",ExpressionUUID->"83532984-f8e5-44f9-a21e-beb9bdc10ddf"],
Cell[3973, 117, 1481, 39, 186, "Code",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],
Cell[5457, 158, 2301, 42, 490, "Code",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],
Cell[7761, 202, 998, 22, 129, "Code",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],
Cell[8762, 226, 3026, 70, 566, "Code",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],
Cell[11791, 298, 1943, 43, 281, "Code",ExpressionUUID->"9273de87-effd-4686-9b2e-608fcb430619"],
Cell[13737, 343, 526, 9, 72, "Code",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"],
Cell[14266, 354, 871, 20, 186, "Code",ExpressionUUID->"1e4167c3-01ad-404a-90d1-cf374df1ec7c"],
Cell[15140, 376, 579, 16, 91, "Code",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"]
}, Closed]],
Cell[CellGroupData[{
Cell[15756, 397, 98, 0, 53, "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],
Cell[15857, 399, 170, 3, 52, "Code",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],
Cell[16030, 404, 1353, 41, 245, "Code",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"]
}, Closed]],
Cell[CellGroupData[{
Cell[17420, 450, 103, 0, 53, "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],
Cell[CellGroupData[{
Cell[17548, 454, 119, 0, 54, "Subsection",ExpressionUUID->"45520b83-5856-4e70-aec9-9e641ed75ec5"],
Cell[17670, 456, 2030, 55, 167, "Code",ExpressionUUID->"ab7cfd9a-2e32-4f78-9985-f607ab5d6072"],
Cell[19703, 513, 1473, 39, 186, "Code",ExpressionUUID->"b3631e97-3f29-4a3d-9eb1-fc44906b4a23"],
Cell[21179, 554, 5609, 136, 794, "Code",ExpressionUUID->"f3037e78-242f-4ef4-8cf8-1e4845b0d8f1"]
}, Closed]],
Cell[CellGroupData[{
Cell[26825, 695, 124, 0, 38, "Subsection",ExpressionUUID->"e2629fb7-9d1d-43f3-bf65-3eef685b1359"],
Cell[26952, 697, 1520, 40, 148, "Code",ExpressionUUID->"234639ac-ea1e-4bb7-a2eb-b8edc3acb6eb"],
Cell[28475, 739, 2587, 71, 224, "Code",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],
Cell[CellGroupData[{
Cell[31099, 815, 121, 0, 38, "Subsection",ExpressionUUID->"71534006-f481-46da-b362-358b3b617b31"],
Cell[CellGroupData[{
Cell[31245, 819, 100, 0, 45, "Subsubsection",ExpressionUUID->"e0ceec4e-875d-447b-a6b3-9644e1be5a13"],
Cell[31348, 821, 2338, 59, 300, "Code",ExpressionUUID->"0f195ae0-3152-4bb8-a197-b14572dd8cd2"]
}, Closed]],
Cell[CellGroupData[{
Cell[33723, 885, 102, 0, 37, "Subsubsection",ExpressionUUID->"ee2b47a4-44a4-4abc-a1c7-f625848196b2"],
Cell[33828, 887, 1547, 40, 129, "Code",ExpressionUUID->"f537bf47-ac17-4bbd-9e7c-f61d88a7c2e4"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[35424, 933, 110, 0, 38, "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],
Cell[35537, 935, 2022, 55, 167, "Code",ExpressionUUID->"0bf45db9-7619-45bc-b186-38923d0a0307"],
Cell[37562, 992, 2668, 73, 262, "Code",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],
Cell[CellGroupData[{
Cell[40267, 1070, 154, 2, 38, "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],
Cell[40424, 1074, 4659, 130, 395, "Code",ExpressionUUID->"2553df87-0843-40e9-9b50-dcbdea5eaf4a"],
Cell[45086, 1206, 4339, 119, 566, "Code",ExpressionUUID->"c9202516-8006-40a6-bb3c-8907e6d4a898"]
}, Closed]],
Cell[CellGroupData[{
Cell[49462, 1330, 138, 1, 38, "Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],
Cell[49603, 1333, 1927, 51, 205, "Code",ExpressionUUID->"0ff05a13-c239-4798-89ca-6d3f02a331ca"],
Cell[51533, 1386, 4326, 112, 490, "Code",ExpressionUUID->"1f00d229-04f4-4a9f-9953-92a56ddcdcb8"],
Cell[55862, 1500, 4046, 104, 395, "Code",ExpressionUUID->"6db92788-a167-4c04-a0c8-42d1ff845760"]
}, Closed]],
Cell[CellGroupData[{
Cell[59945, 1609, 103, 0, 38, "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],
Cell[60051, 1611, 1448, 36, 300, "Code",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],
Cell[61502, 1649, 1046, 27, 205, "Code",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],
Cell[CellGroupData[{
Cell[62585, 1681, 89, 0, 38, "Subsection",ExpressionUUID->"4273560f-e54b-4adb-9bee-6b091dbf1483"],
Cell[62677, 1683, 2056, 57, 300, "Code",ExpressionUUID->"1eb45753-deab-496b-bd81-ec8edaa850d6"]
}, Closed]],
Cell[CellGroupData[{
Cell[64770, 1745, 114, 0, 38, "Subsection",ExpressionUUID->"4f1a2276-83b8-453b-a0ab-cc4833ce2963"],
Cell[64887, 1747, 2597, 68, 358, "Code",ExpressionUUID->"07c56442-9200-48cd-877a-3ca14a40d794"],
Cell[67487, 1817, 3550, 91, 320, "Code",ExpressionUUID->"8fb05295-5368-4801-8f75-90c91dd21d9d"]
}, Closed]],
Cell[CellGroupData[{
Cell[71074, 1913, 92, 0, 38, "Subsection",ExpressionUUID->"d37ea0da-1dee-450b-b972-925398878608"],
Cell[71169, 1915, 973, 26, 72, "Code",ExpressionUUID->"b8d9c7eb-bb3b-4146-ae25-dfe39c4117d6"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[72191, 1947, 107, 0, 53, "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],
Cell[CellGroupData[{
Cell[72323, 1951, 97, 0, 54, "Subsection",ExpressionUUID->"88b16f67-88c4-4552-ac8f-f05e470433fe"],
Cell[72423, 1953, 530, 16, 72, "Code",ExpressionUUID->"406e5bda-df8e-4f18-b704-dc62be933d56"]
}, Closed]],
Cell[CellGroupData[{
Cell[72990, 1974, 88, 0, 38, "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],
Cell[73081, 1976, 957, 26, 110, "Code",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"],
Cell[74041, 2004, 4896, 124, 699, "Code",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"],
Cell[78940, 2130, 7469, 194, 738, "Code",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"]
}, Closed]],
Cell[CellGroupData[{
Cell[86446, 2329, 86, 0, 38, "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],
Cell[86535, 2331, 948, 26, 110, "Code",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"],
Cell[87486, 2359, 5376, 134, 756, "Code",ExpressionUUID->"bddf89f6-b517-416e-b7e7-6e4fe168a0c1"],
Cell[92865, 2495, 7681, 200, 738, "Code",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"]
}, Closed]],
Cell[CellGroupData[{
Cell[100583, 2700, 107, 0, 38, "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],
Cell[100693, 2702, 3283, 82, 452, "Code",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],
Cell[CellGroupData[{
Cell[104013, 2789, 113, 0, 38, "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],
Cell[104129, 2791, 600, 13, 72, "Code",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],
Cell[CellGroupData[{
Cell[104766, 2809, 89, 0, 38, "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],
Cell[104858, 2811, 4467, 114, 433, "Code",ExpressionUUID->"fac8421b-0907-4aa8-8985-486ee81d1798"],
Cell[109328, 2927, 4800, 113, 357, "Code",ExpressionUUID->"8adeae4f-37d5-4438-a96f-9fdde2cba2b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[114165, 3045, 91, 0, 38, "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],
Cell[114259, 3047, 2551, 69, 281, "Code",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[116859, 3122, 108, 0, 53, "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],
Cell[CellGroupData[{
Cell[116992, 3126, 90, 0, 54, "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],
Cell[117085, 3128, 3251, 84, 376, "Code",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],
Cell[120339, 3214, 875, 23, 72, "Code",ExpressionUUID->"64bb5b47-556a-4e46-8b4d-f51ef1d8a346"]
}, Closed]],
Cell[CellGroupData[{
Cell[121251, 3242, 111, 0, 38, "Subsection",ExpressionUUID->"901ddd13-737f-4e91-b19e-1ed99e5bece8"],
Cell[121365, 3244, 3409, 93, 397, "Code",ExpressionUUID->"70f625df-561a-4796-a043-b09f24c338ff"],
Cell[124777, 3339, 836, 21, 72, "Code",ExpressionUUID->"37afab49-8fac-4645-8358-cb2bfeee5c7f"]
}, Closed]],
Cell[CellGroupData[{
Cell[125650, 3365, 87, 0, 38, "Subsection",ExpressionUUID->"5fcbe626-6c14-44c5-bab9-9d2d729d4048"],
Cell[125740, 3367, 3025, 82, 263, "Code",ExpressionUUID->"a6ffe01d-8df3-4581-a8a3-67e15d54ebde"]
}, Closed]],
Cell[CellGroupData[{
Cell[128802, 3454, 90, 0, 38, "Subsection",ExpressionUUID->"7c158d78-4fa5-4987-8d54-d4f45a2f6c7d"],
Cell[128895, 3456, 1190, 32, 205, "Code",ExpressionUUID->"32f57e85-ddf8-44d8-919a-9bb69ab25708"],
Cell[130088, 3490, 443, 12, 52, "Code",ExpressionUUID->"c0315f13-2705-44fb-a3d4-f24325b79ef7"]
}, Closed]],
Cell[CellGroupData[{
Cell[130568, 3507, 87, 0, 38, "Subsection",ExpressionUUID->"3aff73a6-10d2-421c-a3eb-3899330f45fd"],
Cell[130658, 3509, 2590, 67, 319, "Code",ExpressionUUID->"95bfe1df-9c1b-4d36-a1b9-02340e19ec89"],
Cell[133251, 3578, 570, 15, 52, "Code",ExpressionUUID->"cde68282-69ce-49d3-b164-4a4070393ff2"],
Cell[133824, 3595, 1038, 29, 129, "Code",ExpressionUUID->"39fbf181-116b-4086-9bf3-53d3e3e15741"]
}, Closed]],
Cell[CellGroupData[{
Cell[134899, 3629, 112, 0, 38, "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],
Cell[135014, 3631, 5677, 160, 510, "Code",ExpressionUUID->"3b0edd43-f179-414d-aa01-523bd36dc076"],
Cell[140694, 3793, 6498, 179, 586, "Code",ExpressionUUID->"dc6fae3e-0250-465d-b252-f2807af8cf17"],
Cell[147195, 3974, 810, 22, 72, "Code",ExpressionUUID->"e71eaeac-52c8-47a5-808b-97451c4d3a99"]
}, Closed]],
Cell[CellGroupData[{
Cell[148042, 4001, 93, 0, 38, "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],
Cell[148138, 4003, 3167, 79, 263, "Code",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],
Cell[151308, 4084, 457, 12, 52, "Code",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],
Cell[CellGroupData[{
Cell[151802, 4101, 87, 0, 38, "Subsection",ExpressionUUID->"4b83baad-cf9c-4e33-a249-8b29b2e3b88f"],
Cell[151892, 4103, 1908, 54, 281, "Code",ExpressionUUID->"fe916ab9-6145-4201-b3c5-46c8bd2c8e48"]
}, Closed]],
Cell[CellGroupData[{
Cell[153837, 4162, 92, 0, 38, "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],
Cell[153932, 4164, 5670, 136, 510, "Code",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],
Cell[CellGroupData[{
Cell[159639, 4305, 82, 0, 38, "Subsection",ExpressionUUID->"3ab5e732-329f-4489-88fd-99e349e91f19"],
Cell[159724, 4307, 2988, 74, 224, "Code",ExpressionUUID->"716f9373-6de2-4d61-b7b3-deac55ae485c"]
}, Closed]],
Cell[CellGroupData[{
Cell[162749, 4386, 97, 0, 38, "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],
Cell[162849, 4388, 356, 10, 52, "Code",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],
Cell[163208, 4400, 2582, 71, 300, "Code",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],
Cell[165793, 4473, 1101, 29, 72, "Code",ExpressionUUID->"24a3cca9-6e03-4a93-af32-ff27501bcfeb"],
Cell[166897, 4504, 2990, 79, 243, "Code",ExpressionUUID->"e9498b49-9495-4125-b6b0-60afecc5e553"],
Cell[169890, 4585, 3846, 95, 262, "Code",ExpressionUUID->"255e4dc9-2433-4339-8133-1c21b5d429d1"]
}, Closed]],
Cell[CellGroupData[{
Cell[173773, 4685, 89, 0, 38, "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],
Cell[173865, 4687, 1223, 33, 110, "Code",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Closed]],
Cell[CellGroupData[{
Cell[175125, 4725, 108, 0, 38, "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],
Cell[175236, 4727, 482, 10, 72, "Code",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],
Cell[175721, 4739, 906, 24, 72, "Code",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],
Cell[176630, 4765, 866, 24, 72, "Code",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[177545, 4795, 122, 0, 53, "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],
Cell[CellGroupData[{
Cell[177692, 4799, 110, 0, 54, "Subsection",ExpressionUUID->"9ac8c75a-4c63-4e05-9934-61e116371563"],
Cell[177805, 4801, 1354, 37, 72, "Code",ExpressionUUID->"eb4d2ca6-bac8-46f2-bbd5-c654d47af440"]
}, Closed]],
Cell[CellGroupData[{
Cell[179196, 4843, 92, 0, 38, "Subsection",ExpressionUUID->"dea4a3c2-e7ee-4f47-bf96-66929b110d6a"],
Cell[179291, 4845, 881, 22, 72, "Code",ExpressionUUID->"d8fcb9d4-f2da-407c-83ae-ce3be9bbccf0"],
Cell[180175, 4869, 1429, 35, 91, "Code",ExpressionUUID->"595f3be6-92fa-471c-b4ef-1180cdfca216"],
Cell[181607, 4906, 246, 6, 52, "Code",ExpressionUUID->"ac5d691b-d0db-4dce-aa67-9c7c4a5c42ca"],
Cell[181856, 4914, 1765, 46, 243, "Code",ExpressionUUID->"f646d260-5ae8-4d55-a107-8169291bb17e"]
}, Closed]],
Cell[CellGroupData[{
Cell[183658, 4965, 98, 0, 38, "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],
Cell[183759, 4967, 1939, 52, 148, "Code",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"]
}, Closed]],
Cell[CellGroupData[{
Cell[185735, 5024, 123, 0, 38, "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],
Cell[185861, 5026, 2561, 64, 205, "Code",ExpressionUUID->"c031031c-ffd7-4d83-bcd8-d42371a77d31"],
Cell[188425, 5092, 2282, 61, 243, "Code",ExpressionUUID->"41df8914-964f-4940-a28f-5ee27f20f2bd"]
}, Closed]],
Cell[CellGroupData[{
Cell[190744, 5158, 117, 0, 38, "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],
Cell[190864, 5160, 699, 18, 91, "Code",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[191612, 5184, 82, 0, 53, "Section",ExpressionUUID->"92311aed-1ba4-4416-8cbb-ce6d57c7314a"],
Cell[CellGroupData[{
Cell[191719, 5188, 92, 0, 54, "Subsection",ExpressionUUID->"1cedf5c8-718e-4179-9513-b3eb43a0ece1"],
Cell[191814, 5190, 3181, 83, 414, "Code",ExpressionUUID->"110ac425-d5bf-408c-93ca-c93ae47dcdc3"],
Cell[194998, 5275, 6322, 165, 661, "Code",ExpressionUUID->"fc20e590-6bb1-44a9-beb0-edf70fd6414d"]
}, Closed]],
Cell[CellGroupData[{
Cell[201357, 5445, 88, 0, 38, "Subsection",ExpressionUUID->"cdd4da67-16db-4c3e-8fda-67bcde70c743"],
Cell[201448, 5447, 2851, 76, 319, "Code",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"]
}, Closed]],
Cell[CellGroupData[{
Cell[204336, 5528, 108, 0, 38, "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],
Cell[204447, 5530, 1642, 39, 243, "Code",ExpressionUUID->"2d410e1a-3b13-4969-8633-a57c72f640aa"],
Cell[206092, 5571, 7215, 191, 738, "Code",ExpressionUUID->"0d89744f-504c-4c93-bb5d-2c78c8866bf1"],
Cell[213310, 5764, 5299, 144, 338, "Code",ExpressionUUID->"517ca84f-1b48-4167-8dd8-f29e4a199c54"],
Cell[218612, 5910, 954, 24, 205, "Code",ExpressionUUID->"d7938666-fb0c-4728-8ef9-4feffb3fbc15"]
}, Closed]],
Cell[CellGroupData[{
Cell[219603, 5939, 89, 0, 38, "Subsection",ExpressionUUID->"0ec15f42-cc8e-4e3f-b345-1da6922a1e35"],
Cell[219695, 5941, 2320, 60, 207, "Code",ExpressionUUID->"3f31a774-d66f-4f55-aef4-e00b3f3a7fa9"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[222064, 6007, 78, 0, 53, "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],
Cell[222145, 6009, 233, 7, 91, "Code",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[222427, 6022, 124, 0, 58, "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],
Cell[222554, 6024, 195, 5, 52, "Code",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],
Cell[CellGroupData[{
Cell[222774, 6033, 142, 1, 45, "Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],
Cell[222919, 6036, 2253, 58, 300, "Code",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[225209, 6099, 79, 0, 53, "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],
Cell[225291, 6101, 265, 7, 52, "Code",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],
Cell[225559, 6110, 294, 7, 52, "Code",ExpressionUUID->"dbb93444-1867-4df8-88d7-4358e4ecd562"],
Cell[225856, 6119, 2409, 54, 281, "Code",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],
Cell[228268, 6175, 3710, 84, 471, "Code",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],
Cell[231981, 6261, 1012, 19, 167, "Code",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],
Cell[232996, 6282, 6994, 137, 965, "Code",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"],
Cell[239993, 6421, 762, 19, 129, "Code",ExpressionUUID->"85f89386-d411-4cb2-812f-3385b9ddc119"]
}, Closed]],
Cell[CellGroupData[{
Cell[240792, 6445, 98, 0, 53, "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],
Cell[240893, 6447, 274, 7, 91, "Code",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[241204, 6459, 82, 0, 67, "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],
Cell[CellGroupData[{
Cell[241311, 6463, 91, 0, 54, "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],
Cell[CellGroupData[{
Cell[241427, 6467, 92, 0, 45, "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],
Cell[241522, 6469, 337, 8, 127, "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],
Cell[241862, 6479, 1430, 42, 243, "Code",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],
Cell[243295, 6523, 900, 25, 91, "Code",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],
Cell[CellGroupData[{
Cell[244232, 6553, 90, 0, 37, "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],
Cell[244325, 6555, 876, 27, 72, "Code",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Closed]],
Cell[CellGroupData[{
Cell[245238, 6587, 92, 0, 37, "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],
Cell[245333, 6589, 492, 15, 52, "Code",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],
Cell[CellGroupData[{
Cell[245862, 6609, 94, 0, 37, "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],
Cell[245959, 6611, 551, 16, 52, "Code",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],
Cell[246513, 6629, 638, 16, 72, "Code",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],
Cell[247154, 6647, 2313, 62, 262, "Code",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],
Cell[249470, 6711, 1191, 32, 110, "Code",ExpressionUUID->"d4b93424-3000-4189-9724-831b1489b36f"],
Cell[250664, 6745, 3562, 103, 319, "Code",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],
Cell[254229, 6850, 1038, 29, 110, "Code",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],
Cell[255270, 6881, 2385, 65, 300, "Code",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],
Cell[257658, 6948, 968, 28, 167, "Code",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],
Cell[258629, 6978, 574, 17, 52, "Code",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],
Cell[259206, 6997, 580, 15, 72, "Code",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[259835, 7018, 129, 0, 38, "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],
Cell[259967, 7020, 1555, 41, 281, "Code",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],
Cell[261525, 7063, 431, 11, 52, "Code",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],
Cell[261959, 7076, 1338, 34, 262, "Code",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],
Cell[CellGroupData[{
Cell[263334, 7115, 112, 0, 38, "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],
Cell[263449, 7117, 683, 16, 148, "Code",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],
Cell[264135, 7135, 539, 14, 129, "Code",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],
Cell[CellGroupData[{
Cell[264711, 7154, 88, 0, 38, "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],
Cell[264802, 7156, 656, 17, 148, "Code",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],
Cell[265461, 7175, 2155, 63, 300, "Code",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],
Cell[CellGroupData[{
Cell[267653, 7243, 117, 0, 38, "Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],
Cell[267773, 7245, 1891, 50, 225, "Code",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],
Cell[269667, 7297, 1664, 44, 206, "Code",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],
Cell[CellGroupData[{
Cell[271368, 7346, 101, 0, 38, "Subsection",ExpressionUUID->"2b820542-dab3-4d0b-9a97-bb3be4d7c4e1"],
Cell[271472, 7348, 3623, 96, 377, "Code",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"]
}, Closed]],
Cell[CellGroupData[{
Cell[275132, 7449, 147, 2, 38, "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],
Cell[275282, 7453, 1346, 34, 186, "Code",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[276677, 7493, 108, 0, 67, "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],
Cell[CellGroupData[{
Cell[276810, 7497, 112, 0, 54, "Subsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],
Cell[276925, 7499, 529, 15, 52, "Code",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],
Cell[277457, 7516, 2345, 59, 281, "Code",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]],
Cell[CellGroupData[{
Cell[279839, 7580, 169, 3, 38, "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],
Cell[280011, 7585, 846, 22, 72, "Code",ExpressionUUID->"a5ac437a-ac13-4dcc-937b-78f37d29cde8"],
Cell[280860, 7609, 1051, 31, 72, "Code",ExpressionUUID->"d5b5a4b2-1d6e-49b3-81b5-095c109c65b1"],
Cell[281914, 7642, 1092, 31, 72, "Code",ExpressionUUID->"b9a5f3ca-82c9-4e0e-b0f1-f8a346553919"]
}, Closed]],
Cell[CellGroupData[{
Cell[283043, 7678, 105, 0, 38, "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],
Cell[283151, 7680, 1418, 38, 110, "Code",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],
Cell[284572, 7720, 953, 24, 129, "Code",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],
Cell[CellGroupData[{
Cell[285562, 7749, 100, 0, 38, "Subsection",ExpressionUUID->"55d1c213-4bb2-4451-ba1c-fdc21c15bcf2"],
Cell[285665, 7751, 456, 12, 52, "Code",ExpressionUUID->"b074e873-e000-444e-bfd3-912d2da5f9f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[286158, 7768, 134, 0, 38, "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],
Cell[286295, 7770, 5829, 179, 549, "Code",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"]
}, Closed]],
Cell[CellGroupData[{
Cell[292161, 7954, 113, 0, 38, "Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],
Cell[292277, 7956, 3598, 100, 416, "Code",ExpressionUUID->"f76ffa41-d78a-4aad-aca7-58faa9383c44"]
}, Closed]],
Cell[CellGroupData[{
Cell[295912, 8061, 98, 0, 38, "Subsection",ExpressionUUID->"5ef4575d-ff53-410b-b2dc-0721806c9003"],
Cell[296013, 8063, 4511, 114, 623, "Code",ExpressionUUID->"e2d65e56-4673-4c8e-8227-2994bb1c0619"],
Cell[300527, 8179, 1843, 47, 262, "Code",ExpressionUUID->"097af00b-cd95-484d-a8cd-bcd98c53194e"],
Cell[302373, 8228, 8879, 225, 891, "Code",ExpressionUUID->"eb2c692b-8016-46c8-9bbf-9494375f1de4"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[311301, 8459, 93, 0, 67, "Section",ExpressionUUID->"6c87b55b-aadb-402e-9eef-99119af5b41f"],
Cell[CellGroupData[{
Cell[311419, 8463, 101, 0, 54, "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],
Cell[311523, 8465, 2656, 70, 395, "Code",ExpressionUUID->"894f0b58-5723-4d0e-809d-4ee4d9dc3d49"],
Cell[314182, 8537, 3997, 104, 414, "Code",ExpressionUUID->"b2e7dc4a-fb6d-44f9-b0b0-6d6b222a28ee"],
Cell[318182, 8643, 3204, 80, 243, "Code",ExpressionUUID->"b9b089d6-add9-4269-87bb-d50c23ee1f14"],
Cell[321389, 8725, 3490, 80, 414, "Code",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[324916, 8810, 95, 0, 38, "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],
Cell[325014, 8812, 4121, 107, 357, "Code",ExpressionUUID->"ffd7ea39-a364-44f4-94e2-69aab71ecae0"],
Cell[329138, 8921, 415, 11, 72, "Code",ExpressionUUID->"f855b1b9-6eff-4966-88ee-3d609bef8039"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[329602, 8938, 82, 0, 67, "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],
Cell[CellGroupData[{
Cell[329709, 8942, 101, 0, 54, "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],
Cell[CellGroupData[{
Cell[329835, 8946, 100, 0, 45, "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],
Cell[329938, 8948, 2674, 74, 224, "Code",ExpressionUUID->"17b69bef-e499-4349-baa1-daabc117b244"],
Cell[332615, 9024, 2252, 64, 262, "Code",ExpressionUUID->"b3dd01b3-e2b3-4f86-9379-bb750cf02b0f"]
}, Closed]],
Cell[CellGroupData[{
Cell[334904, 9093, 100, 0, 37, "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],
Cell[335007, 9095, 3539, 97, 281, "Code",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],
Cell[338549, 9194, 2719, 67, 414, "Code",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],
Cell[CellGroupData[{
Cell[341305, 9266, 107, 0, 37, "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],
Cell[341415, 9268, 3616, 97, 281, "Code",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],
Cell[345034, 9367, 2586, 65, 395, "Code",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],
Cell[CellGroupData[{
Cell[347657, 9437, 94, 0, 37, "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],
Cell[347754, 9439, 3757, 101, 319, "Code",ExpressionUUID->"fe12d61c-c2b8-41f3-93cc-6879d3615206"],
Cell[351514, 9542, 8891, 204, 699, "Code",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],
Cell[360408, 9748, 7187, 175, 680, "Code",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],
Cell[CellGroupData[{
Cell[367632, 9928, 94, 0, 37, "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],
Cell[367729, 9930, 4442, 123, 319, "Code",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],
Cell[372174, 10055, 28470, 680, 2599, "Code",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],
Cell[CellGroupData[{
Cell[400681, 10740, 93, 0, 37, "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],
Cell[400777, 10742, 2729, 74, 224, "Code",ExpressionUUID->"39e4fbce-94cb-4ec1-909a-9be6211b734a"],
Cell[403509, 10818, 894, 26, 72, "Code",ExpressionUUID->"c161f406-b316-4337-bc62-09fbc7236f0c"],
Cell[404406, 10846, 9259, 214, 680, "Code",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],
Cell[413668, 11062, 3158, 84, 281, "Code",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],
Cell[416829, 11148, 2387, 65, 281, "Code",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],
Cell[CellGroupData[{
Cell[419253, 11218, 91, 0, 37, "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],
Cell[419347, 11220, 5396, 152, 376, "Code",ExpressionUUID->"105425f9-6faa-403b-bf41-cd3b92587bc2"],
Cell[424746, 11374, 19331, 477, 832, "Code",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[444114, 11856, 99, 0, 45, "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],
Cell[444216, 11858, 2274, 61, 186, "Code",ExpressionUUID->"c2dc76eb-f1f2-4627-94b2-322d01f7c229"],
Cell[446493, 11921, 2226, 60, 281, "Code",ExpressionUUID->"983639bb-e7ad-4ed8-a16b-1a1e153cc30e"],
Cell[448722, 11983, 6896, 148, 452, "Code",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],
Cell[455621, 12133, 753, 23, 72, "Code",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[456423, 12162, 102, 0, 54, "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],
Cell[CellGroupData[{
Cell[456550, 12166, 122, 0, 45, "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],
Cell[456675, 12168, 1478, 37, 129, "Code",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],
Cell[458156, 12207, 1302, 32, 110, "Code",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"],
Cell[459461, 12241, 11149, 280, 870, "Code",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"]
}, Closed]],
Cell[CellGroupData[{
Cell[470647, 12526, 92, 0, 37, "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],
Cell[470742, 12528, 5879, 155, 395, "Code",ExpressionUUID->"2b8c3072-deb2-4963-8d04-f459f5914cdd"]
}, Closed]],
Cell[CellGroupData[{
Cell[476658, 12688, 96, 0, 37, "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],
Cell[476757, 12690, 614, 16, 72, "Code",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],
Cell[CellGroupData[{
Cell[477408, 12711, 95, 0, 37, "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],
Cell[477506, 12713, 1034, 26, 129, "Code",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[478577, 12744, 94, 0, 37, "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],
Cell[478674, 12746, 1029, 27, 129, "Code",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],
Cell[CellGroupData[{
Cell[479740, 12778, 94, 0, 37, "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],
Cell[479837, 12780, 631, 17, 72, "Code",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],
Cell[CellGroupData[{
Cell[480505, 12802, 93, 0, 37, "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],
Cell[480601, 12804, 620, 16, 72, "Code",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],
Cell[CellGroupData[{
Cell[481258, 12825, 96, 0, 37, "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],
Cell[481357, 12827, 498, 12, 72, "Code",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],
Cell[CellGroupData[{
Cell[481892, 12844, 120, 0, 37, "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],
Cell[482015, 12846, 624, 16, 72, "Code",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],
Cell[482642, 12864, 648, 16, 72, "Code",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[483351, 12887, 89, 0, 67, "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],
Cell[CellGroupData[{
Cell[483465, 12891, 95, 0, 54, "Subsection",ExpressionUUID->"04217e2e-b144-490c-abab-cc24a563308d"],
Cell[483563, 12893, 736, 21, 52, "Code",ExpressionUUID->"e5de9c33-e0a8-4208-9edb-de245aa9f157"],
Cell[484302, 12916, 7453, 191, 794, "Code",ExpressionUUID->"58062daf-5fe8-4b9b-993e-402d18f21d7a"]
}, Closed]],
Cell[CellGroupData[{
Cell[491792, 13112, 103, 0, 38, "Subsection",ExpressionUUID->"2c80579a-c9ea-4023-b2bf-bcf398290f97"],
Cell[491898, 13114, 1773, 49, 167, "Code",ExpressionUUID->"22eef36c-01a6-4184-b4f4-8a062ba1c7f6"],
Cell[493674, 13165, 3421, 96, 243, "Code",ExpressionUUID->"ab1e67a8-ea5d-4cbf-8c48-2af8c388a741"],
Cell[497098, 13263, 13936, 342, 984, "Code",ExpressionUUID->"af45631a-f570-480f-9684-dbbf41a91605"],
Cell[511037, 13607, 2787, 77, 186, "Code",ExpressionUUID->"09182b61-089e-491b-bc71-1654808d915d"],
Cell[513827, 13686, 1319, 37, 110, "Code",ExpressionUUID->"d18c3dfb-7910-49e5-9f90-650f5ac32782"]
}, Closed]],
Cell[CellGroupData[{
Cell[515183, 13728, 105, 0, 38, "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],
Cell[515291, 13730, 188, 3, 35, "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],
Cell[515482, 13735, 3520, 84, 452, "Code",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],
Cell[519005, 13821, 2100, 55, 357, "Code",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[521154, 13882, 78, 0, 67, "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],
Cell[521235, 13884, 233, 7, 91, "Code",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[521517, 13897, 125, 0, 58, "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],
Cell[521645, 13899, 195, 5, 52, "Code",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],
Cell[CellGroupData[{
Cell[521865, 13908, 79, 0, 67, "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],
Cell[521947, 13910, 1304, 29, 224, "Code",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],
Cell[523254, 13941, 454, 9, 72, "Code",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],
Cell[523711, 13952, 2436, 50, 395, "Code",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],
Cell[526150, 14004, 2329, 47, 452, "Code",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],
Cell[528482, 14053, 6285, 110, 490, "Code",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],
Cell[534770, 14165, 3652, 63, 319, "Code",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"],
Cell[538425, 14230, 302, 7, 52, "Code",ExpressionUUID->"7b07195b-81ae-4c6b-b53b-c12da7b91d15"]
}, Closed]],
Cell[CellGroupData[{
Cell[538764, 14242, 85, 0, 53, "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],
Cell[538852, 14244, 363, 10, 110, "Code",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"]
}, Open  ]],
Cell[CellGroupData[{
Cell[539252, 14259, 100, 0, 67, "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],
Cell[CellGroupData[{
Cell[539377, 14263, 92, 0, 54, "Subsection",ExpressionUUID->"99d232f2-b91d-458c-a3db-d922760b95e4"],
Cell[539472, 14265, 1380, 36, 205, "Code",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],
Cell[CellGroupData[{
Cell[540889, 14306, 97, 0, 38, "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],
Cell[540989, 14308, 1471, 37, 129, "Code",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],
Cell[CellGroupData[{
Cell[542497, 14350, 94, 0, 38, "Subsection",ExpressionUUID->"8488fe5a-cff7-4dfa-ac4b-5654c56b2c7f"],
Cell[542594, 14352, 2763, 78, 262, "Code",ExpressionUUID->"379532fc-ab3b-4100-8b5e-6183b7f55947"],
Cell[545360, 14432, 4870, 134, 585, "Code",ExpressionUUID->"2e6066e1-9346-4cd8-aed9-3d85923df3d3"],
Cell[550233, 14568, 1108, 29, 205, "Code",ExpressionUUID->"1215db5f-4226-4914-976f-95e9ec2bdd56"]
}, Closed]],
Cell[CellGroupData[{
Cell[551378, 14602, 122, 0, 38, "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],
Cell[551503, 14604, 2529, 67, 300, "Code",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],
Cell[554035, 14673, 2238, 56, 224, "Code",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],
Cell[CellGroupData[{
Cell[556310, 14734, 190, 3, 38, "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],
Cell[556503, 14739, 2009, 53, 186, "Code",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],
Cell[558515, 14794, 5374, 122, 775, "Code",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"],
Cell[563892, 14918, 2232, 55, 281, "Code",ExpressionUUID->"d950c243-7cbd-4fa7-9959-4787123d60ec"]
}, Closed]],
Cell[CellGroupData[{
Cell[566161, 14978, 93, 0, 38, "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],
Cell[566257, 14980, 2060, 57, 243, "Code",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],
Cell[CellGroupData[{
Cell[568354, 15042, 94, 0, 38, "Subsection",ExpressionUUID->"8bb00a64-b11b-49dc-8019-90801a7f898c"],
Cell[568451, 15044, 1103, 30, 186, "Code",ExpressionUUID->"d5b77de4-6377-4475-99bc-9c004e543f84"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[569603, 15080, 105, 0, 67, "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],
Cell[CellGroupData[{
Cell[569733, 15084, 90, 0, 54, "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],
Cell[569826, 15086, 2364, 66, 452, "Code",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],
Cell[CellGroupData[{
Cell[572227, 15157, 96, 0, 38, "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],
Cell[572326, 15159, 7703, 181, 623, "Code",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[580066, 15345, 104, 0, 38, "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],
Cell[580173, 15347, 7756, 182, 623, "Code",ExpressionUUID->"c1058285-daa4-49c3-b6e6-cf523195583e"]
}, Closed]],
Cell[CellGroupData[{
Cell[587966, 15534, 86, 0, 38, "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],
Cell[588055, 15536, 4187, 118, 376, "Code",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[592291, 15660, 98, 0, 67, "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],
Cell[CellGroupData[{
Cell[592414, 15664, 87, 0, 54, "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],
Cell[592504, 15666, 2136, 55, 187, "Code",ExpressionUUID->"a9a1bea0-2eb1-4498-a4f6-e0fb5682d5b7"],
Cell[594643, 15723, 1547, 39, 129, "Code",ExpressionUUID->"adb373c8-874b-46e0-9e67-0de750560642"],
Cell[CellGroupData[{
Cell[596215, 15766, 98, 0, 45, "Subsubsection",ExpressionUUID->"68e02d8f-32be-40d7-8ce6-63dba577fda3"],
Cell[596316, 15768, 5500, 134, 680, "Code",ExpressionUUID->"348deadf-43ea-4531-be6e-31a20693e23d"],
Cell[601819, 15904, 5483, 136, 642, "Code",ExpressionUUID->"2f6ca2b6-1182-476c-a59a-eca5207db206"],
Cell[607305, 16042, 7748, 189, 908, "Code",ExpressionUUID->"6f665ef1-43eb-4788-8831-d0a461934b69"],
Cell[615056, 16233, 5586, 142, 680, "Code",ExpressionUUID->"4726adc9-b131-4ca2-bf4a-c62109e08d6d"],
Cell[620645, 16377, 5043, 126, 642, "Code",ExpressionUUID->"2087cd22-5e91-4329-8449-2ab14c98e71f"],
Cell[625691, 16505, 344, 10, 52, "Code",ExpressionUUID->"74c6f492-69a5-40d3-ab96-931470c95193"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[626084, 16521, 98, 0, 38, "Subsection",ExpressionUUID->"b7156b33-cb6c-4b74-aacf-f98656168e47"],
Cell[626185, 16523, 4676, 119, 568, "Code",ExpressionUUID->"b0b15184-d1a1-457a-8b95-c43845ad02d9"],
Cell[630864, 16644, 2967, 66, 415, "Code",ExpressionUUID->"1541376a-e966-4f59-8e04-b3265424a372"],
Cell[CellGroupData[{
Cell[633856, 16714, 104, 0, 45, "Subsubsection",ExpressionUUID->"8eb12589-13d0-4db1-8d82-5a7f3627cf24"],
Cell[633963, 16716, 984, 25, 110, "Code",ExpressionUUID->"d23ba088-27d1-4486-af97-c5061397f6ff"],
Cell[634950, 16743, 1464, 37, 110, "Code",ExpressionUUID->"782ed89f-bdb4-4a7a-8b66-41dc46d0a1a5"],
Cell[636417, 16782, 918, 22, 110, "Code",ExpressionUUID->"cca4c994-4bdb-4262-8a73-59346334dcf8"],
Cell[637338, 16806, 2015, 47, 338, "Code",ExpressionUUID->"45528231-7bba-4542-a290-17553f1ce429"],
Cell[639356, 16855, 224, 6, 52, "Code",ExpressionUUID->"49ff6c33-b326-4e81-9f7f-58b38ecac55a"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[639629, 16867, 94, 0, 38, "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],
Cell[639726, 16869, 5044, 138, 661, "Code",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],
Cell[644773, 17009, 7708, 204, 832, "Code",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"]
}, Closed]],
Cell[CellGroupData[{
Cell[652518, 17218, 102, 0, 38, "Subsection",ExpressionUUID->"fdb08a27-d392-4708-8d7c-e22a50d18359"],
Cell[CellGroupData[{
Cell[652645, 17222, 120, 0, 45, "Subsubsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],
Cell[652768, 17224, 1248, 32, 243, "Code",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],
Cell[654019, 17258, 1941, 58, 148, "Code",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],
Cell[CellGroupData[{
Cell[655997, 17321, 151, 2, 37, "Subsubsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],
Cell[656151, 17325, 911, 24, 129, "Code",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],
Cell[CellGroupData[{
Cell[657099, 17354, 105, 0, 37, "Subsubsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],
Cell[657207, 17356, 437, 11, 52, "Code",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],
Cell[657647, 17369, 2101, 54, 224, "Code",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],
Cell[659751, 17425, 1743, 42, 338, "Code",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],
Cell[661497, 17469, 2341, 62, 357, "Code",ExpressionUUID->"92ffeed0-c3d9-4161-bdf3-36b3e40fc494"],
Cell[663841, 17533, 2448, 65, 357, "Code",ExpressionUUID->"fc66d059-3816-4b04-a69b-80ebdc0fcb74"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[666350, 17605, 88, 0, 67, "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],
Cell[CellGroupData[{
Cell[666463, 17609, 95, 0, 54, "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],
Cell[666561, 17611, 8647, 211, 908, "Code",ExpressionUUID->"d218d248-ce20-48a5-af65-68e0c4272cc5"]
}, Closed]],
Cell[CellGroupData[{
Cell[675245, 17827, 104, 0, 38, "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],
Cell[675352, 17829, 4202, 111, 376, "Code",ExpressionUUID->"ae1e713b-def1-4284-a80c-7c15c0aec447"],
Cell[679557, 17942, 3789, 98, 319, "Code",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],
Cell[CellGroupData[{
Cell[683383, 18045, 91, 0, 38, "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],
Cell[683477, 18047, 6064, 141, 737, "Code",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]],
Cell[CellGroupData[{
Cell[689578, 18193, 99, 0, 38, "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],
Cell[689680, 18195, 495, 14, 52, "Code",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],
Cell[690178, 18211, 2767, 70, 377, "Code",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],
Cell[692948, 18283, 821, 22, 110, "Code",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],
Cell[693772, 18307, 4885, 117, 756, "Code",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],
Cell[698660, 18426, 6483, 165, 623, "Code",ExpressionUUID->"acf53775-617a-4c64-abce-1ca8d0a00a98"],
Cell[705146, 18593, 1225, 31, 224, "Code",ExpressionUUID->"cc158a20-c3f3-4d03-9644-fc087c2118ee"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[706420, 18630, 93, 0, 67, "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],
Cell[CellGroupData[{
Cell[706538, 18634, 93, 0, 54, "Subsection",ExpressionUUID->"73422a9f-f78f-40d0-b5cf-0b9ca1818700"],
Cell[706634, 18636, 1105, 31, 148, "Code",ExpressionUUID->"3e97a0de-a970-4d5c-ab00-d0691ecf3e87"],
Cell[707742, 18669, 2511, 61, 357, "Code",ExpressionUUID->"cad7656e-ac79-4b74-bd8a-9e72c0644b19"],
Cell[710256, 18732, 3697, 93, 357, "Code",ExpressionUUID->"9357dc4e-c4b9-4298-9e85-37d87e5d3ebc"],
Cell[713956, 18827, 9049, 209, 1174, "Code",ExpressionUUID->"9c6a83e3-770d-4c96-b30e-1d9e09063824"]
}, Closed]],
Cell[CellGroupData[{
Cell[723042, 19041, 101, 0, 38, "Subsection",ExpressionUUID->"89d07baf-29ff-40b5-a155-6ae60f411f0b"],
Cell[723146, 19043, 457, 12, 52, "Code",ExpressionUUID->"638cc8ea-f6a2-4655-af57-88c8956ec0e0"],
Cell[723606, 19057, 1540, 38, 129, "Code",ExpressionUUID->"bfcda39c-0644-435b-8e52-c73864eff3b0"],
Cell[725149, 19097, 3551, 86, 339, "Code",ExpressionUUID->"57ce5909-974b-48ac-99ba-c0f6a103d000"],
Cell[728703, 19185, 591, 17, 91, "Code",ExpressionUUID->"f5756fcc-4f46-47b4-924b-eae4cdafeb53"]
}, Closed]],
Cell[CellGroupData[{
Cell[729331, 19207, 106, 0, 38, "Subsection",ExpressionUUID->"fdbbe4fd-2f77-4cbe-91b2-9746fc3ae9f9"],
Cell[729440, 19209, 3262, 94, 338, "Code",ExpressionUUID->"db89b083-f6f8-4ef9-be0e-ba614297f87d"]
}, Closed]],
Cell[CellGroupData[{
Cell[732739, 19308, 122, 0, 38, "Subsection",ExpressionUUID->"f771deb2-a4a2-400f-b0c2-7680cc5b00ac"],
Cell[732864, 19310, 1108, 28, 243, "Code",ExpressionUUID->"4315eb56-9425-419f-b071-2e2f797f402d"],
Cell[733975, 19340, 705, 19, 110, "Code",ExpressionUUID->"f36975ed-8d9f-4ec4-babc-cce78e40b1a9"],
Cell[734683, 19361, 3680, 101, 358, "Code",ExpressionUUID->"bd2ebe0c-ce7f-45f7-bfc1-49aa1aec9a95"],
Cell[738366, 19464, 3419, 79, 300, "Code",ExpressionUUID->"1b30499b-3dd1-4129-8c80-b3664c73ca01"],
Cell[741788, 19545, 650, 16, 91, "Code",ExpressionUUID->"e01b2e15-065d-44be-a333-3bb058054274"],
Cell[742441, 19563, 2770, 76, 263, "Code",ExpressionUUID->"a850dc3b-621f-4bd6-aaee-873395b1bb45"],
Cell[745214, 19641, 2452, 68, 226, "Code",ExpressionUUID->"d0b96612-939a-4fb2-8f6e-a03a87c8f541"],
Cell[747669, 19711, 3538, 84, 300, "Code",ExpressionUUID->"d9dde884-5ff3-466a-b915-739df74cc11a"],
Cell[751210, 19797, 4275, 102, 300, "Code",ExpressionUUID->"78b2f67f-dc48-44fe-9713-fc2cd8b3ffff"],
Cell[755488, 19901, 5960, 142, 566, "Code",ExpressionUUID->"e09521af-e51f-454e-acee-9ae42f06aee1"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[761497, 20049, 89, 0, 67, "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],
Cell[CellGroupData[{
Cell[761611, 20053, 98, 0, 54, "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],
Cell[761712, 20055, 4063, 97, 509, "Code",ExpressionUUID->"f766b5d0-2b0a-4658-998d-1d2ffeb53538"],
Cell[765778, 20154, 4536, 124, 642, "Code",ExpressionUUID->"d1684dc1-97c6-4969-af60-093d8fe550b5"],
Cell[770317, 20280, 8042, 177, 1060, "Code",ExpressionUUID->"0eac91ae-7451-41aa-9cbb-65adae11b2f0"],
Cell[778362, 20459, 8364, 208, 1155, "Code",ExpressionUUID->"37ffa1ef-c32e-45a9-8b39-8215cca0dac2"]
}, Closed]],
Cell[CellGroupData[{
Cell[786763, 20672, 100, 0, 38, "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],
Cell[786866, 20674, 763, 19, 129, "Code",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],
Cell[787632, 20695, 2681, 69, 338, "Code",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],
Cell[790316, 20766, 9535, 237, 1041, "Code",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Closed]],
Cell[CellGroupData[{
Cell[799888, 21008, 100, 0, 38, "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],
Cell[799991, 21010, 1520, 40, 186, "Code",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]],
Cell[CellGroupData[{
Cell[801548, 21055, 89, 0, 38, "Subsection",ExpressionUUID->"a9afe4a2-3d1f-4c3c-87c4-873f2341a9d6"],
Cell[801640, 21057, 944, 25, 110, "Code",ExpressionUUID->"72bdf617-f2b0-45b4-a828-df6fb87fae5e"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[802633, 21088, 82, 0, 67, "Section",ExpressionUUID->"bd288e6b-ab27-46a4-bc3d-2647f91f2f63"],
Cell[CellGroupData[{
Cell[802740, 21092, 89, 0, 54, "Subsection",ExpressionUUID->"a8eb6a67-78ad-4ba4-8cec-269a8a1b24d2"],
Cell[802832, 21094, 599, 15, 148, "Code",ExpressionUUID->"b053c690-a872-4439-b574-8c9fac1b5b54"],
Cell[803434, 21111, 3659, 89, 319, "Code",ExpressionUUID->"1794a1de-92c7-4194-afbf-fa7220a883c9"],
Cell[807096, 21202, 638, 16, 72, "Code",ExpressionUUID->"a68f133e-ebe3-4506-bf7a-0e202cc8d679"],
Cell[807737, 21220, 5201, 149, 243, "Code",ExpressionUUID->"99b44e1e-10ac-4496-b564-51e26a057933"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[812987, 21375, 78, 0, 67, "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],
Cell[813068, 21377, 233, 7, 91, "Code",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[813350, 21390, 125, 0, 58, "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],
Cell[813478, 21392, 194, 5, 52, "Code",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],
Cell[CellGroupData[{
Cell[813697, 21401, 79, 0, 67, "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],
Cell[813779, 21403, 284, 7, 52, "Code",ExpressionUUID->"1b53aab2-8ab9-4869-815e-f8ca47d5626d"],
Cell[814066, 21412, 504, 10, 91, "Code",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],
Cell[814573, 21424, 822, 17, 129, "Code",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],
Cell[815398, 21443, 388, 8, 72, "Code",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],
Cell[815789, 21453, 1673, 38, 300, "Code",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],
Cell[817465, 21493, 433, 9, 91, "Code",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],
Cell[817901, 21504, 1127, 21, 72, "Code",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],
Cell[819031, 21527, 717, 16, 110, "Code",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],
Cell[819751, 21545, 666, 14, 72, "Code",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],
Cell[820420, 21561, 704, 14, 72, "Code",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],
Cell[821127, 21577, 424, 11, 72, "Code",ExpressionUUID->"60a1aaf8-9e55-4804-8020-19c6fa0e5e13"]
}, Closed]],
Cell[CellGroupData[{
Cell[821588, 21593, 80, 0, 53, "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],
Cell[821671, 21595, 451, 12, 129, "Code",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[822159, 21612, 96, 0, 67, "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],
Cell[CellGroupData[{
Cell[822280, 21616, 87, 0, 54, "Subsection",ExpressionUUID->"8042e1d7-58bf-4a7b-a670-9ef09527dcb3"],
Cell[822370, 21618, 1893, 52, 319, "Code",ExpressionUUID->"5cbe27db-29f9-4589-9b2f-70c34eebdd51"]
}, Closed]],
Cell[CellGroupData[{
Cell[824300, 21675, 88, 0, 38, "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],
Cell[824391, 21677, 425, 11, 72, "Code",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],
Cell[824819, 21690, 3149, 83, 452, "Code",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"],
Cell[827971, 21775, 295, 7, 52, "Code",ExpressionUUID->"e14ea647-8b7f-4eae-a125-7e43a795f52c"]
}, Closed]],
Cell[CellGroupData[{
Cell[828303, 21787, 91, 0, 38, "Subsection",ExpressionUUID->"f78cb6e6-e17d-4401-b894-51df89a02adc"],
Cell[828397, 21789, 959, 26, 243, "Code",ExpressionUUID->"baf9e747-4ee8-4def-a102-84008b907460"],
Cell[829359, 21817, 2400, 74, 110, "Code",ExpressionUUID->"a1d9feb9-62c4-409e-be0b-ea49889e8b01"],
Cell[831762, 21893, 7103, 183, 737, "Code",ExpressionUUID->"829b1b73-0d4f-4926-b6ea-e84e57819e82"],
Cell[838868, 22078, 3774, 95, 509, "Code",ExpressionUUID->"efaea70e-7f65-44cf-a2e0-e6ecd31c63c7"],
Cell[842645, 22175, 445, 11, 72, "Code",ExpressionUUID->"0e5dbd26-cfae-40c7-b7ee-7b5f60395896"]
}, Closed]],
Cell[CellGroupData[{
Cell[843127, 22191, 87, 0, 38, "Subsection",ExpressionUUID->"705723b3-0b89-4771-beb9-2e41ea08ce8f"],
Cell[843217, 22193, 790, 21, 148, "Code",ExpressionUUID->"9f81df39-0a2f-4196-aab9-f31a9915fd4c"],
Cell[844010, 22216, 13440, 387, 1098, "Code",ExpressionUUID->"3d99c4e1-2ed1-4a36-bd0d-901d4e1b608e"],
Cell[857453, 22605, 275, 7, 52, "Code",ExpressionUUID->"67dc5857-057d-4942-8b33-232e10e632fb"],
Cell[857731, 22614, 3467, 92, 395, "Code",ExpressionUUID->"37a01b0b-a5a1-4a89-92b7-9caeadc9a336"],
Cell[861201, 22708, 615, 17, 72, "Code",ExpressionUUID->"c79ff671-dc5c-4855-97f7-8fad109232b4"],
Cell[861819, 22727, 125, 0, 35, "Text",ExpressionUUID->"c5baefa1-9c13-40ff-a82a-13c4da38a803"],
Cell[861947, 22729, 379, 11, 52, "Code",ExpressionUUID->"bc255c6b-527f-4a10-b9c0-1b86173edb61"]
}, Closed]],
Cell[CellGroupData[{
Cell[862363, 22745, 88, 0, 38, "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],
Cell[862454, 22747, 241, 6, 52, "Code",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],
Cell[862698, 22755, 7781, 190, 661, "Code",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"],
Cell[CellGroupData[{
Cell[870504, 22949, 377, 11, 30, "Input",ExpressionUUID->"f325d84e-8b1c-4353-a4a7-917cc61544f8"],
Cell[870884, 22962, 11553, 240, 394, "Output",ExpressionUUID->"81a5acf0-2ec5-467c-86a2-c9168823fa90"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[882486, 23208, 92, 0, 38, "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],
Cell[882581, 23210, 694, 16, 205, "Code",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],
Cell[883278, 23228, 6200, 154, 642, "Code",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],
Cell[889481, 23384, 4797, 120, 510, "Code",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],
Cell[CellGroupData[{
Cell[894315, 23509, 86, 0, 38, "Subsection",ExpressionUUID->"b5299508-8322-4271-9afb-f5f337741415"],
Cell[894404, 23511, 4146, 115, 357, "Code",ExpressionUUID->"c88252b2-ffad-4dd1-859c-2bd8cba16a86"]
}, Closed]],
Cell[CellGroupData[{
Cell[898587, 23631, 93, 0, 38, "Subsection",ExpressionUUID->"8f6d6aa2-a5f3-44bd-b466-85e186e748fc"],
Cell[898683, 23633, 5760, 151, 490, "Code",ExpressionUUID->"992ac084-622b-46f9-88a6-1e6f80acfc8a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[904492, 23790, 89, 0, 67, "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],
Cell[CellGroupData[{
Cell[904606, 23794, 91, 0, 54, "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],
Cell[904700, 23796, 361, 10, 110, "Code",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],
Cell[905064, 23808, 411, 11, 72, "Code",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],
Cell[905478, 23821, 700, 19, 91, "Code",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],
Cell[906181, 23842, 794, 23, 91, "Code",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],
Cell[906978, 23867, 1902, 45, 357, "Code",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],
Cell[908883, 23914, 886, 24, 73, "Code",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],
Cell[CellGroupData[{
Cell[909806, 23943, 88, 0, 38, "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],
Cell[909897, 23945, 370, 10, 110, "Code",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],
Cell[910270, 23957, 1858, 52, 319, "Code",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],
Cell[912131, 24011, 1213, 34, 224, "Code",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],
Cell[913347, 24047, 1691, 47, 262, "Code",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],
Cell[CellGroupData[{
Cell[915075, 24099, 94, 0, 38, "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],
Cell[915172, 24101, 5137, 140, 452, "Code",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],
Cell[CellGroupData[{
Cell[920346, 24246, 92, 0, 38, "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],
Cell[920441, 24248, 6313, 172, 452, "Code",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[926803, 24426, 86, 0, 67, "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],
Cell[CellGroupData[{
Cell[926914, 24430, 89, 0, 54, "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],
Cell[927006, 24432, 1093, 27, 91, "Code",ExpressionUUID->"5a272a8d-b37b-477f-a024-ee728ce8ca49"],
Cell[928102, 24461, 1053, 31, 110, "Code",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"],
Cell[929158, 24494, 2267, 59, 338, "Code",ExpressionUUID->"0f22cd14-f2c6-414f-9ee6-3d896ed5cfcc"]
}, Closed]],
Cell[CellGroupData[{
Cell[931462, 24558, 96, 0, 38, "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],
Cell[931561, 24560, 2740, 73, 224, "Code",ExpressionUUID->"9464b0a7-e384-4ae5-9af9-43a3e239bf92"],
Cell[934304, 24635, 1840, 48, 243, "Code",ExpressionUUID->"abf836c2-0f64-4bef-a1a6-0c0029eb66ae"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[936193, 24689, 95, 0, 67, "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],
Cell[CellGroupData[{
Cell[936313, 24693, 127, 0, 54, "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],
Cell[936443, 24695, 6682, 177, 718, "Code",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],
Cell[CellGroupData[{
Cell[943162, 24877, 93, 0, 38, "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],
Cell[943258, 24879, 1747, 44, 243, "Code",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],
Cell[945008, 24925, 582, 16, 52, "Code",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],
Cell[945593, 24943, 3307, 85, 357, "Code",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],
Cell[948903, 25030, 4780, 124, 452, "Code",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],
Cell[CellGroupData[{
Cell[953720, 25159, 91, 0, 38, "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],
Cell[953814, 25161, 3045, 79, 414, "Code",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],
Cell[CellGroupData[{
Cell[956896, 25245, 123, 0, 38, "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],
Cell[957022, 25247, 842, 23, 91, "Code",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],
Cell[CellGroupData[{
Cell[957901, 25275, 86, 0, 38, "Subsection",ExpressionUUID->"ca8bfc39-6cbe-49cd-916b-27aa904950fa"],
Cell[957990, 25277, 2428, 65, 224, "Code",ExpressionUUID->"fcf85ece-3c2a-4192-b269-84aca2ba61c1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[960455, 25347, 90, 0, 54, "Subsection",ExpressionUUID->"0d47f488-fc16-43ad-8fe4-3fc44f943dcd"],
Cell[960548, 25349, 10064, 251, 946, "Code",ExpressionUUID->"be26471b-7aca-47f8-a89c-7add247b3d4f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[970661, 25606, 78, 0, 67, "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],
Cell[970742, 25608, 234, 7, 91, "Code",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)


(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1975880,      50157]
NotebookOptionsPosition[   1882461,      48743]
NotebookOutlinePosition[   1882874,      48760]
CellTagsIndexPosition[   1882831,      48757]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Mechanisms package", "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],

Cell["\<\
version 1.0b
Christian Santangelo, Physics Department, Syracuse University
Copyright 2023\
\>", "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],

Cell[CellGroupData[{

Cell["Package organization", "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],

Cell[TextData[{
 StyleBox["mechanisms: ",
  FontWeight->"Bold"],
 "The mechanisms main package contains functions for manipulating and using \
mechanisms."
}], "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],

Cell[TextData[{
 StyleBox["geometry ",
  FontWeight->"Bold"],
 ": Mechanism geometry subpackage."
}], "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],

Cell[TextData[{
 StyleBox["rigidity",
  FontWeight->"Bold"],
 ": This subpackage contains functions for basic rigidity of mechanisms and \
some functions for linkages"
}], "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],

Cell[TextData[{
 StyleBox["origami",
  FontWeight->"Bold"],
 ": this sub package contains functions for handling origami specifically."
}], "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],

Cell[TextData[{
 StyleBox["graphics",
  FontWeight->"Bold"],
 " : this sub package contains functions for handling graphics."
}], "Text",ExpressionUUID->"85ea895a-171e-480f-b701-c119aed055d6"],

Cell[TextData[{
 StyleBox["critical",
  FontWeight->"Bold"],
 " : this sub package contains experimental routines to play with \
second-order critical points"
}], "Text",ExpressionUUID->"7a480a6f-f888-43dc-8777-8cbd2eb306f6"],

Cell["\<\
These packages also use the Mathematica Developer package to take advantage \
of packed arrays when possible. A C compiler is recommended to improve the \
speed of some numeric algorithms but isn\[CloseCurlyQuote]t strictly \
necessary.\
\>", "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],

Cell[CellGroupData[{

Cell["To do list and known bug list", "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],

Cell["\<\
The function removeOverlappingVertices[] may sometimes fail if two vertices \
have exactly the same distance apart and those distances are within tolerance.\
\>", "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"],

Cell["\<\
Sometimes ToGraphicsComplex[] produces something that should be a polyhedron \
but cannot be Canonicalized? I applied a fix that just cleans those up and \
hopes for the best.\
\>", "Text",ExpressionUUID->"3c29e79e-c97c-45d3-a1ea-174eedb8cf96"],

Cell["\<\
ElasticTriangle[] must check that it is a triangle or expand into several \
triangles.\
\>", "Text",ExpressionUUID->"50f80464-0989-4dbe-adb2-45b20020c8a6"],

Cell["\<\
Create more informative errors for geometric functions: TurningAngle[]\
\>", "Text",ExpressionUUID->"3e1ff100-05de-4b71-bc6f-3e0fe0f5e7e6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Bug fixes and new features", "Subsubsection",ExpressionUUID->"996e8192-dd83-4d95-8bb9-82a6d1e6f792"],

Cell["\<\
New functions that begin to allow finding and analyzing critical points and \
to walk along critical surfaces.\
\>", "Text",ExpressionUUID->"a26cd813-d33b-4e4f-9693-02bd8df2ecc3"],

Cell["\<\
Use of a new keyword, Deformed[mechanism , positions], for many functions \
where you can compute quantities in mechanism m which has been stretched and \
deformed to new positions. Use PlaceVertices[ mechanism, positions] when you \
mean to be redefining the mechanism positions entirely.\
\>", "Text",ExpressionUUID->"22721566-57b5-4fb2-ab1a-2082383c99f9"],

Cell["\<\
FixMechanism[] resets all equilibrium data to their current values rather \
than being determined Automatically.\
\>", "Text",ExpressionUUID->"88d7e353-9f10-49cf-a722-102c87abfad2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Installation as Paclet", "Subsubsection",ExpressionUUID->"7669e260-6590-4d78-9fd1-a329f9dd1f60"],

Cell["Use this code to install yourself as a Paclet:", "Text",ExpressionUUID->"de519dea-c6ba-4b6e-b9b8-68b8224f3d40"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "#", "]"}], ">", "0"}], ",", " ", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Other installed versions: \>\"", ",", " ", "#"}], "]"}], 
      ";"}]}], "]"}], "&"}], "[", 
  RowBox[{"PacletFind", "[", "\"\<Mechanisms*\>\"", "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"location", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Dropbox\>\"", ",", "\"\<Mathematica Packages\>\"", ",", 
      "\"\<Mechanisms\>\"", ",", "\"\<v1p0\>\""}], "}"}], "]"}]}], ";", 
  RowBox[{"PacletInstall", "[", 
   RowBox[{"CreatePacletArchive", "[", "location", "]"}], "]"}]}]}], "Input",
 CellLabel->
  "12/31/23 21:51:33 \
In[3929]:=",ExpressionUUID->"bdc64312-753d-4eb5-8a7c-c436ed551c43"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   TagBox["PacletObject",
    "SummaryHead"], "[", 
   DynamicModuleBox[{Typeset`open$$ = False, Typeset`embedState$$ = "Ready"}, 
    
    TemplateBox[{
      PaneSelectorBox[{False -> GridBox[{{
            PaneBox[
             ButtonBox[
              DynamicBox[
               FEPrivate`FrontEndResource["FEBitmaps", "SummaryBoxOpener"]], 
              ButtonFunction :> (Typeset`open$$ = True), Appearance -> None, 
              BaseStyle -> {}, Evaluator -> Automatic, Method -> 
              "Preemptive"], Alignment -> {Center, Center}, ImageSize -> 
             Dynamic[{
               Automatic, 
                3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                 Magnification])}]], 
            GraphicsBox[{
              Thickness[0.0416667], {
               FaceForm[{
                 RGBColor[0.961, 0.961, 0.961], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.5454, 
                22.5972}, {7.5464, 20.5002}, {2.5454, 18.4022}, {2.5454, 
                12.5982}, {2.5454, 12.5972}, {2.5454, 6.7952}, {7.5454, 
                4.6962}, {7.546, 4.6972}, {12.5454, 2.5992}, {17.5454, 
                4.6972}, {17.5454, 4.6962}, {22.5454, 6.7952}, {22.5454, 
                12.5972}, {22.5454, 12.5982}, {22.5454, 18.4022}}}]}, {
               FaceForm[{
                 RGBColor[0.898, 0.898, 0.898], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 8.3359}, {17.125, 
                14.0569}, {16.875, 14.0569}, {16.875, 8.3359}, {17., 
                8.1169}, {21.952, 6.0399}, {22.049, 6.2709}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 8.3359}, {7.125, 14.0569}, {
                6.875, 14.0569}, {6.875, 8.3359}, {1.952, 6.2709}, {2.048, 
                6.0399}, {7., 8.1169}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8745, 6.2383}, {6.9515, 4.1733}, {7.0475, 
                3.9423}, {11.9995, 6.0193}, {16.9515, 3.9423}, {17.0475, 
                4.1733}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 14.1392}, {17.125, 
                19.8602}, {16.875, 19.8602}, {16.875, 14.1392}, {17., 
                13.9202}, {21.952, 11.8432}, {22.049, 12.0742}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 14.1392}, {7.125, 19.8602}, {
                6.875, 19.8602}, {6.875, 14.1392}, {1.952, 12.0742}, {2.048, 
                11.8432}, {7., 13.9202}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8746, 21.3633}, {11.8746, 18.3563}, {
                11.9996, 18.3033}, {12.1246, 18.3563}, {12.1246, 21.3633}, {
                11.9996, 21.4153}}}]}, {
               FaceForm[{
                 RGBColor[0.749, 0.749, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
                 3}}}, {{{8.292, 19.8594}, {12., 21.4154}, {15.707, 
                 19.8594}, {12., 18.3034}}, {{17.5, 19.5274}, {17.5, 
                 20.1924}, {12., 22.5004}, {6.5, 20.1924}, {6.5, 19.5284}, {
                 12., 17.2194}, {12., 17.2194}, {15.7, 18.7724}, {17.5, 
                 19.5274}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.5, 8.5156}, {11.5, 6.4876}, {11.5, 
                5.4026}, {12.5, 5.8226}, {12.5, 8.5156}, {12., 8.3056}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{21.5, 6.4873}, {17.5, 4.8083}, {17.5, 
                 9.5283}, {21.5, 11.2073}}, {{21.5, 12.7113}, {21.5, 
                 12.2913}, {17., 10.4033}, {16.5, 10.6133}, {16.5, 10.1943}, {
                 15.707, 9.8613}, {16.5, 9.5283}, {16.5, 4.8083}, {16.5, 
                 4.8093}, {16.5, 4.3903}, {15.707, 4.0573}, {17., 3.5143}, {
                 22.5, 5.8223}, {22.5, 12.2913}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{6.5, 4.8086}, {2.5, 6.4876}, {2.5, 
                 11.2066}, {6.5, 9.5286}}, {{7.5, 9.1096}, {7.5, 9.1096}, {
                 7.5, 9.5286}, {8.292, 9.8616}, {7.5, 10.1936}, {7.5, 
                 10.6136}, {7., 10.4036}, {2.5, 12.2906}, {2.5, 12.7106}, {
                 1.5, 12.2916}, {1.5, 5.8226}, {7., 3.5146}, {8.293, 
                 4.0576}, {7.5, 4.3906}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{3.2925, 17.7622}, {7.0005, 
                 19.3182}, {10.7075, 17.7622}, {7.0005, 16.2062}}, {{6.5005, 
                 10.6122}, {2.5005, 12.2912}, {2.5005, 17.0102}, {6.5005, 
                 15.3322}}, {{7.5005, 10.1932}, {7.5005, 10.6122}, {7.5005, 
                 15.3322}, {12.0005, 17.2202}, {12.5005, 17.0102}, {12.5005, 
                 18.0952}, {7.0005, 20.4032}, {1.5005, 18.0952}, {1.5005, 
                 11.6262}, {7.0005, 9.3182}, {8.2935, 9.8612}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{21.5, 12.291}, {17.5, 10.612}, {
                 17.5, 15.332}, {21.5, 17.01}}, {{13.293, 17.762}, {17., 
                 19.318}, {20.708, 17.762}, {17., 16.207}}, {{17., 20.403}, {
                 11.5, 18.095}, {11.5, 17.01}, {12., 17.22}, {16.5, 15.332}, {
                 16.5, 10.612}, {16.5, 10.194}, {15.706, 9.861}, {17., 
                 9.318}, {22.5, 11.626}, {22.5, 18.095}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{16.4995, 4.3906}, {12.4995, 
                 2.7116}, {12.4995, 7.4316}, {16.4995, 9.1096}}, {{11.4995, 
                 2.7116}, {7.4995, 4.3906}, {7.4995, 9.1096}, {11.4995, 
                 7.4316}}, {{16.4995, 10.6136}, {16.4995, 10.1946}, {11.9995, 
                 8.3056}, {8.2915, 9.8616}, {7.4995, 10.1936}, {7.4995, 
                 10.6146}, {6.4995, 10.1946}, {6.4995, 3.7256}, {11.9995, 
                 1.4176}, {17.4995, 3.7256}, {17.4995, 10.1946}}}]}, {
               FaceForm[{
                 RGBColor[0.965, 0.765, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{12., 17.6616}, {16.945, 15.5856}, {16.945, 
                9.9376}, {12., 7.8636}, {7.055, 9.9376}, {7.055, 
                15.5856}}}]}, {
               FaceForm[{
                 RGBColor[0.91, 0.655, 0.635], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.125, 
                17.7627}, {11.875, 17.7627}, {11.875, 12.0407}, {6.952, 
                9.9757}, {7.048, 9.7447}, {12., 11.8227}, {16.952, 9.7447}, {
                17.048, 9.9757}, {12.125, 12.0407}}}]}, {
               FaceForm[{
                 RGBColor[0.867, 0.067, 0.], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}}}, {{{12.5, 8.5146}, {12.5, 13.2336}, {16.5, 14.9116}, {
                 16.5, 10.1926}}, {{7.5, 14.9116}, {11.5, 13.2336}, {11.5, 
                 8.5146}, {7.5, 10.1926}}, {{15.708, 15.6636}, {12., 
                 14.1086}, {8.292, 15.6636}, {12., 17.2206}}, {{12., 
                 18.3046}, {6.5, 15.9956}, {6.5, 9.5286}, {12., 7.2206}, {
                 17.5, 9.5286}, {17.5, 15.9956}}}]}}, AspectRatio -> 
             Automatic, ImageSize -> {24., 24.}, 
             PlotRange -> {{0., 24.}, {0., 24.}}], 
            GridBox[{{
               RowBox[{
                 TagBox["\"Name: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"Mechanisms\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Version: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"1.0\"", "SummaryItem"]}]}}, 
             GridBoxAlignment -> {
              "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
             False, GridBoxItemSize -> {
              "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
             GridBoxSpacings -> {"Columns" -> {{2}}, "Rows" -> {{Automatic}}},
              BaseStyle -> {
              ShowStringCharacters -> False, NumberMarks -> False, 
               PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
          GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
          AutoDelete -> False, 
          GridBoxItemSize -> {
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
          BaselinePosition -> {1, 1}], True -> GridBox[{{
            PaneBox[
             ButtonBox[
              DynamicBox[
               FEPrivate`FrontEndResource["FEBitmaps", "SummaryBoxCloser"]], 
              ButtonFunction :> (Typeset`open$$ = False), Appearance -> None, 
              BaseStyle -> {}, Evaluator -> Automatic, Method -> 
              "Preemptive"], Alignment -> {Center, Center}, ImageSize -> 
             Dynamic[{
               Automatic, 
                3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
                 Magnification])}]], 
            GraphicsBox[{
              Thickness[0.0416667], {
               FaceForm[{
                 RGBColor[0.961, 0.961, 0.961], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.5454, 
                22.5972}, {7.5464, 20.5002}, {2.5454, 18.4022}, {2.5454, 
                12.5982}, {2.5454, 12.5972}, {2.5454, 6.7952}, {7.5454, 
                4.6962}, {7.546, 4.6972}, {12.5454, 2.5992}, {17.5454, 
                4.6972}, {17.5454, 4.6962}, {22.5454, 6.7952}, {22.5454, 
                12.5972}, {22.5454, 12.5982}, {22.5454, 18.4022}}}]}, {
               FaceForm[{
                 RGBColor[0.898, 0.898, 0.898], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 8.3359}, {17.125, 
                14.0569}, {16.875, 14.0569}, {16.875, 8.3359}, {17., 
                8.1169}, {21.952, 6.0399}, {22.049, 6.2709}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 8.3359}, {7.125, 14.0569}, {
                6.875, 14.0569}, {6.875, 8.3359}, {1.952, 6.2709}, {2.048, 
                6.0399}, {7., 8.1169}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8745, 6.2383}, {6.9515, 4.1733}, {7.0475, 
                3.9423}, {11.9995, 6.0193}, {16.9515, 3.9423}, {17.0475, 
                4.1733}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{17.125, 14.1392}, {17.125, 
                19.8602}, {16.875, 19.8602}, {16.875, 14.1392}, {17., 
                13.9202}, {21.952, 11.8432}, {22.049, 12.0742}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}}}, {{{7.125, 14.1392}, {7.125, 19.8602}, {
                6.875, 19.8602}, {6.875, 14.1392}, {1.952, 12.0742}, {2.048, 
                11.8432}, {7., 13.9202}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.8746, 21.3633}, {11.8746, 18.3563}, {
                11.9996, 18.3033}, {12.1246, 18.3563}, {12.1246, 21.3633}, {
                11.9996, 21.4153}}}]}, {
               FaceForm[{
                 RGBColor[0.749, 0.749, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {1, 3, 
                 3}}}, {{{8.292, 19.8594}, {12., 21.4154}, {15.707, 
                 19.8594}, {12., 18.3034}}, {{17.5, 19.5274}, {17.5, 
                 20.1924}, {12., 22.5004}, {6.5, 20.1924}, {6.5, 19.5284}, {
                 12., 17.2194}, {12., 17.2194}, {15.7, 18.7724}, {17.5, 
                 19.5274}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{11.5, 8.5156}, {11.5, 6.4876}, {11.5, 
                5.4026}, {12.5, 5.8226}, {12.5, 8.5156}, {12., 8.3056}}}], 
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{21.5, 6.4873}, {17.5, 4.8083}, {17.5, 
                 9.5283}, {21.5, 11.2073}}, {{21.5, 12.7113}, {21.5, 
                 12.2913}, {17., 10.4033}, {16.5, 10.6133}, {16.5, 10.1943}, {
                 15.707, 9.8613}, {16.5, 9.5283}, {16.5, 4.8083}, {16.5, 
                 4.8093}, {16.5, 4.3903}, {15.707, 4.0573}, {17., 3.5143}, {
                 22.5, 5.8223}, {22.5, 12.2913}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}}}, {{{6.5, 4.8086}, {2.5, 6.4876}, {2.5, 
                 11.2066}, {6.5, 9.5286}}, {{7.5, 9.1096}, {7.5, 9.1096}, {
                 7.5, 9.5286}, {8.292, 9.8616}, {7.5, 10.1936}, {7.5, 
                 10.6136}, {7., 10.4036}, {2.5, 12.2906}, {2.5, 12.7106}, {
                 1.5, 12.2916}, {1.5, 5.8226}, {7., 3.5146}, {8.293, 
                 4.0576}, {7.5, 4.3906}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{3.2925, 17.7622}, {7.0005, 
                 19.3182}, {10.7075, 17.7622}, {7.0005, 16.2062}}, {{6.5005, 
                 10.6122}, {2.5005, 12.2912}, {2.5005, 17.0102}, {6.5005, 
                 15.3322}}, {{7.5005, 10.1932}, {7.5005, 10.6122}, {7.5005, 
                 15.3322}, {12.0005, 17.2202}, {12.5005, 17.0102}, {12.5005, 
                 18.0952}, {7.0005, 20.4032}, {1.5005, 18.0952}, {1.5005, 
                 11.6262}, {7.0005, 9.3182}, {8.2935, 9.8612}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{21.5, 12.291}, {17.5, 10.612}, {
                 17.5, 15.332}, {21.5, 17.01}}, {{13.293, 17.762}, {17., 
                 19.318}, {20.708, 17.762}, {17., 16.207}}, {{17., 20.403}, {
                 11.5, 18.095}, {11.5, 17.01}, {12., 17.22}, {16.5, 15.332}, {
                 16.5, 10.612}, {16.5, 10.194}, {15.706, 9.861}, {17., 
                 9.318}, {22.5, 11.626}, {22.5, 18.095}}}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                 0, 1, 0}, {0, 1, 0}}}, {{{16.4995, 4.3906}, {12.4995, 
                 2.7116}, {12.4995, 7.4316}, {16.4995, 9.1096}}, {{11.4995, 
                 2.7116}, {7.4995, 4.3906}, {7.4995, 9.1096}, {11.4995, 
                 7.4316}}, {{16.4995, 10.6136}, {16.4995, 10.1946}, {11.9995, 
                 8.3056}, {8.2915, 9.8616}, {7.4995, 10.1936}, {7.4995, 
                 10.6146}, {6.4995, 10.1946}, {6.4995, 3.7256}, {11.9995, 
                 1.4176}, {17.4995, 3.7256}, {17.4995, 10.1946}}}]}, {
               FaceForm[{
                 RGBColor[0.965, 0.765, 0.749], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}}}, {{{12., 17.6616}, {16.945, 15.5856}, {16.945, 
                9.9376}, {12., 7.8636}, {7.055, 9.9376}, {7.055, 
                15.5856}}}]}, {
               FaceForm[{
                 RGBColor[0.91, 0.655, 0.635], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {
                0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.125, 
                17.7627}, {11.875, 17.7627}, {11.875, 12.0407}, {6.952, 
                9.9757}, {7.048, 9.7447}, {12., 11.8227}, {16.952, 9.7447}, {
                17.048, 9.9757}, {12.125, 12.0407}}}]}, {
               FaceForm[{
                 RGBColor[0.867, 0.067, 0.], 
                 Opacity[1.]}], 
               
               FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 
                 0}, {0, 1, 0}, {0, 1, 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 
                 0}}, {{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
                 0}}}, {{{12.5, 8.5146}, {12.5, 13.2336}, {16.5, 14.9116}, {
                 16.5, 10.1926}}, {{7.5, 14.9116}, {11.5, 13.2336}, {11.5, 
                 8.5146}, {7.5, 10.1926}}, {{15.708, 15.6636}, {12., 
                 14.1086}, {8.292, 15.6636}, {12., 17.2206}}, {{12., 
                 18.3046}, {6.5, 15.9956}, {6.5, 9.5286}, {12., 7.2206}, {
                 17.5, 9.5286}, {17.5, 15.9956}}}]}}, AspectRatio -> 
             Automatic, ImageSize -> {24., 24.}, 
             PlotRange -> {{0., 24.}, {0., 24.}}], 
            GridBox[{{
               RowBox[{
                 TagBox["\"Name: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"Mechanisms\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Version: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox["\"1.0\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Location: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox[
                 "\"/Users/cdsantan/Library/Mathematica/Paclets/Repository/\
Mechanisms-1.0\"", "SummaryItem"]}]}, {
               RowBox[{
                 TagBox["\"Description: \"", "SummaryItemAnnotation"], 
                 "\[InvisibleSpace]", 
                 TagBox[
                  TagBox["\"Mechanisms package\"", Short], "SummaryItem"]}]}},
              GridBoxAlignment -> {
              "Columns" -> {{Left}}, "Rows" -> {{Automatic}}}, AutoDelete -> 
             False, GridBoxItemSize -> {
              "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
             GridBoxSpacings -> {"Columns" -> {{2}}, "Rows" -> {{Automatic}}},
              BaseStyle -> {
              ShowStringCharacters -> False, NumberMarks -> False, 
               PrintPrecision -> 3, ShowSyntaxStyles -> False}]}}, 
          GridBoxAlignment -> {"Columns" -> {{Left}}, "Rows" -> {{Top}}}, 
          AutoDelete -> False, 
          GridBoxItemSize -> {
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}, 
          BaselinePosition -> {1, 1}]}, 
       Dynamic[Typeset`open$$], ImageSize -> Automatic]},
     "SummaryPanel"],
    DynamicModuleValues:>{}], "]"}],
  PacletObject[<|
   "Name" -> "Mechanisms", "Version" -> "1.0", "Creator" -> 
    "cdsantan@syr.edu", "Description" -> "Mechanisms package", 
    "WolframVersion" -> "11+", 
    "Extensions" -> {{
      "Kernel", "Root" -> "Kernel", "Context" -> {"Mechanisms`"}}, {
      "Resource", "Root" -> "Resources", 
       "Resources" -> {{"CrinkledPaper", "Textures/crinkled-paper.jpg"}}}, {
      "Documentation", "Language" -> "English", "MainPage" -> 
       "Guides/Mechanisms", 
       "Resources" -> {
        "ReferencePages/Symbols/RigidBar", "ReferencePages/Symbols/Spring", 
         "ReferencePages/Symbols/PinnedJoint", 
         "ReferencePages/Symbols/Linkage"}}}, "Location" -> 
    "/Users/cdsantan/Library/Mathematica/Paclets/Repository/Mechanisms-1.0"|>],
  Editable->False,
  SelectWithContents->True,
  Selectable->False]], "Output",
 CellLabel->
  "12/31/23 21:51:39 \
Out[3930]=",ExpressionUUID->"01974d94-2789-441a-b669-c057da36a718"]
}, Open  ]],

Cell[TextData[StyleBox["If you are using a version before 13, you might need \
to change PacletObject[] in the PacletInfo.m file to Paclet[] to install the \
paclet.",
 FontSlant->"Italic"]], "Text",ExpressionUUID->"5d4c8443-1f18-4a6f-93cf-\
acd6c17ec2a0"],

Cell["Use this to uninstall the paclet:", "Text",ExpressionUUID->"8c0f275a-0a6f-49f8-8b27-df573f355ff7"],

Cell[BoxData[
 RowBox[{"PacletUninstall", "[", "\"\<Mechanisms\>\"", "]"}]], "Input",
 CellLabel->
  "12/31/23 21:51:30 \
In[3928]:=",ExpressionUUID->"bae0a72b-16f7-4640-9196-dd8e0df27892"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms", "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<Mechanisms`\>\"", ",", 
    RowBox[{"{", "\"\<Developer`\>\"", "}"}]}], "]"}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:57 \
In[5980]:=",ExpressionUUID->"19f747a5-46c1-4c74-9468-5aa2b9f8da15"],

Cell[CellGroupData[{

Cell["Version definitions", "Section",ExpressionUUID->"e8755456-61af-4d01-a4b3-3c63afdd42db"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$MechanismsVersion", "::", "usage"}], " ", "=", " ", 
   "\"\<$MechanismsVersion returns the version number of the package.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$MechanismsVersionText", "::", "usage"}], " ", "=", " ", 
    "\"\<$MechanismsVersionText returns the version number of the package as \
a string.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"$MechanismsVersion", "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$MechanismsVersionText", "=", "\"\<Mechanisms version 1.0b\>\""}],
    ";"}], "\n", "\n", 
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "We", " ", "use", " ", "MeshRegion", " ", "in", " ", "this", " ", 
    "package", " ", "to", " ", "work", " ", "so", " ", "make", " ", "sure", 
    " ", "we", " ", "are", " ", "using", " ", "at", " ", "least", " ", 
    "version", " ", "10", " ", "of", " ", "Mathematica"}], "\n", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Mechanism", "::", "usage"}], " ", "=", " ", 
    "\"\<Keyword used to report some errors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "version"}], "=", 
   "\"\<Mathematica version may be too low.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "paclet"}], "=", 
   "\"\<Mathematica version may be too low to install Paclet.\nFix by \
changing Paclet[] to PacletObject[] in the file PacletInfo.m\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"Which", "[", " ", 
   RowBox[{
    RowBox[{"$VersionNumber", "<", "11"}], ",", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"Mechanism", "::", "version"}], "]"}], " ", ",", " ", 
    RowBox[{"$VersionNumber", "<", "13"}], ",", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"Mechanism", "::", "versionpaclet"}], "]"}]}], "]"}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[5981]:=",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"]
}, Closed]],

Cell[CellGroupData[{

Cell["Usage", "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellTypes", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCellTypes[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns all mechanism cell types in a mechanism.\nMechanismCellTypes[] \
returns all possible mechanism cell types.\>\""}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"mechanism", " ", "cells"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RigidBar", "::", "usage"}], "=", 
   "\"\<RigidBar[ {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)} ] is a rigid bar. Use DefaultCellProperties[ RigidBar ] \
to see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Spring", "::", "usage"}], "=", 
   "\"\<Spring[ {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)} ] is a Spring allowing you to set an arbitrary force. \
Use DefaultCellData[ Spring ] to see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Face", "::", "usage"}], "=", 
   "\"\<Face[ {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...} ] is a Face. Use DefaultCellProperties[ Face ] to \
see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringFace", "::", "usage"}], "=", 
   "\"\<SpringFace[ \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...} ] is a Face that expands to a face with spring \
sides.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticTriangle", "::", "usage"}], "=", 
   "\"\<ElasticTriangle[ \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...} ] is an elastic Face. Use DefaultCellProperties[ \
Face ] to see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFold", "::", "usage"}], "=", 
   "\"\<TorsionalFold[ {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\
\"], \"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)} ] is a TorsionalFold with torsional Spring controlling \
its angle. Use DefaultCellProperties[ TorsionalFold ] to see its associated \
data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJoint", "::", "usage"}], "=", 
   "\"\<FreeJoint[\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)] is a free joint.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AngleJoint", "::", "usage"}], "=", 
   "\"\<AngleJoint[{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)}] \
is a torsional spring attached to a joint \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\). Use \
DefaultCellProperties[ AngleJoint ] to see its associated data.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJoint", "::", "usage"}], "=", 
   "\"\<PinnedJoint[\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)] is a pinned FreeJoint. Use DefaultCellProperties[ PinnedJoint ] to \
see its associated data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"StraightJoint", "::", "usage"}], "=", 
    "\"\<StraightJoint[{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\
\"], \"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)}] \
maintains a straight joint \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\) between \
two other vertices. Use DefaultCellProperties[ StraightJoint ] to see its \
associated data.\>\""}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"an", " ", "extra", " ", "type"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AnyJoint", "::", "usage"}], "=", 
    "\"\<AnyJoint is a pattern that matches either a PinnedJoint or a \
FreeJoint.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DefaultCellProperties", "::", "usage"}], "=", 
   "\"\<DefaultCellProperties[ \!\(\*StyleBox[\"cell\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"type\",FontSlant->\"Italic\"]\) ] \
returns the default properties associated with a cell type.\nAll cells also \
take the properties \\\"Style\\\", \\\"Shape\\\", and \\\"Label\\\", which \
act like MeshCellStyle, MeshCellShapeFunction, and MeshCellLabel.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[5989]:=",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CellPattern", "::", "usage"}], "=", 
   "\"\<CellPattern is an option in the Mechanisms package to specify \
patterns for cells.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6002]:=",ExpressionUUID->"6a2885be-244c-4caa-9110-a2e59332412c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismVertexCells", "::", "usage"}], "=", 
   "\"\<MechanismVertexCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns all cells associated with vertices.\n\
MechanismVertexCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...}] returns a list of all vertex cells with indices \!\
\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...\n\
MechanismVertexCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] returns a list of all vertex \
cells output by \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\)]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdgeCells", "::", "usage"}], "=", 
   "\"\<MechanismEdgeCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns all cells associated with edges.\n\
MechanismEdgeCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...}] returns a list of all edge cells with indices \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...}\n\
MechanismEdgeCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] returns a list of all edge \
cells output by \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\)]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaceCells", "::", "usage"}], "=", 
   "\"\<MechanismFaceCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns all cells associated with faces.\n\
MechanismFaceCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], RowBox[{\"2\", \",\", \" \", \"...\"}]]\)}, ...}] returns a list \
of all face cells with indices \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], RowBox[{\"2\", \",\", \" \", \"...\"}]]\)}, ...}.\n\
MechanismFaceCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] returns a list of all face \
cells output by \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\)]\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6003]:=",ExpressionUUID->"f1ba8c9f-55ca-4f86-a5a2-8ba1395def9e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Basic", " ", "elements", " ", "of", " ", "a", " ", "mechanism", " ", 
    "and", " ", "checks"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"MechanismFaces", "::", "usage"}], "=", 
     "\"\<MechanismFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns a list of Faces in the Mechanism.\nMechanismEdgeIndex[\!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\) , \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...} ] returns an index with the location the specific \
edge {{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...} would appear in a list of all edges.\n\
MechanismFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"f\",FontSlant->\"Italic\"]\)] returns a list of face indices associated \
with \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[\"m\",\
FontSlant->\"Italic\"]\)].\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismEdges", "::", "usage"}], "=", 
     "\"\<MechanismEdges[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns a list of edges in the Mechanism.\nMechanismFaceIndex[\!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\) , \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...}, ...} ] returns an index with the location the \
specific face {{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\
\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...}, ...} would appear in a list of all edges.\n\
MechanismEdges[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"f\",FontSlant->\"Italic\"]\)] returns a list of edges indices associated \
with \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[\"m\",\
FontSlant->\"Italic\"]\)].\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismVertices", "::", "usage"}], "=", 
     "\"\<MechanismVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns a list of vertices in the mechanism.\n\
MechanismVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\), ...} ] returns the integer indices of a list of \
vertices.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismCells", "::", "usage"}], " ", "=", " ", 
     "\"\<MechanismCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns a list of all cells of the form {celltype1[ {i1, i2, ...} ], ...}.\n\
MechanismCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"pattern\",FontSlant->\"Italic\"]\)] returns a list of cells matching \
\!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\).\n\
MechanismCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"cell\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\)\
, \!\(\*StyleBox[\"dataType\",FontSlant->\"Italic\"]\) -> \
\!\(\*StyleBox[\"dataPattern\",FontSlant->\"Italic\"]\)] returns cells \
matching \!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\) having \
\!\(\*StyleBox[\"dataType\",FontSlant->\"Italic\"]\) whose value matches \!\(\
\*StyleBox[\"dataPattern\",FontSlant->\"Italic\"]\).\n\
MechanismCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"tag\",FontSlant->\"Italic\"]\)] returns the indices associated with a \
string \!\(\*StyleBox[\"tag\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\".\",\
FontSlant->\"Italic\"]\)\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismVertexQ", "::", "usage"}], "=", 
     "\"\<MechanismVertexQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), {\!\
\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], RowBox[{\"2\", \",\", \" \", \"...\"}]]\)}] returns True if all \
vertices are in the mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismEdgeQ", "::", "usage"}], "=", 
     "\"\<MechanismEdgeQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...}] returns True if all edges are in the mechanism \!\
\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismFaceQ", "::", "usage"}], "=", 
     "\"\<MechanismFaceQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], RowBox[{\"2\", \",\", \" \", \"...\"}]]\)}, ...}}] returns True if \
all Faces are in the mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\
\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ValidMechanismEdgeQ", "::", "usage"}], "=", 
     "\"\<ValidMechanismEdgeQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}, ...}] returns True if all edges could be an edge in \
mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"ValidMechanismFaceQ", "::", "usage"}], "=", 
     "\"\<ValidMechanismFaceQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], RowBox[{\"2\", \",\", \" \", \"...\"}]]\)}, ...}] returns True if \
all Faces could be a Face in mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ValidMechanismCellQ", "::", "usage"}], "=", 
     "\"\<ValidMechanismCellQ[ \
\!\(\*StyleBox[\"cellSpec\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"cellSpec\",FontSlant->\"Italic\"]\) is a properly specified \
cell.\nValidMechanismCellQ[] returns a pattern that can be used to test if a \
cell has a valid specification.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ValidMechanismCellHeadQ", "::", "usage"}], "=", 
     "\"\<ValidMechanismCellHeadQ[ \
\!\(\*StyleBox[\"cell\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"cell\",FontSlant->\"Italic\"]\) is a cell type. Use \
MechanismCellTypes[] to see a list of cell types.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6006]:=",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"VertexPosition", "::", "usage"}], "=", "\n", 
   "\"\<VertexPosition[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"c\",FontSlant->\"Italic\"]\)] represents the position of \
vertex \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) along a particular \
component \!\(\*StyleBox[\"c\",FontSlant->\"Italic\"]\).\n\
\!\(\*StyleBox[\"c\",FontSlant->\"Italic\"]\) is one of \\\"x\\\", \\\"y\\\", \
\\\"z\\\" or All[\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\)] where \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\) is the number of dimensions.\n\
VertexPosition[{\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"1\
\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\
\"n\",FontSlant->\"Italic\"], \
\"2\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[\
StyleBox[\"n\",FontSlant->\"Italic\"], \
\"3\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)...}, \
{\!\(\*SubscriptBox[StyleBox[\"c\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"c\",FontSlant->\"\
Italic\"], \"2\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\) ...}] \
expands to a list of vertex positions.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"VertexPosition", ",", 
    RowBox[{"{", 
     RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexDisplacement", "::", "usage"}], "=", "\n", 
   "\"\<VertexDisplacement[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"c\",FontSlant->\"Italic\"]\)] represents the displacement of \
vertex n along a particular component c.\n\
\!\(\*StyleBox[\"c\",FontSlant->\"Italic\"]\) is one of \\\"x\\\", \\\"y\\\", \
\\\"z\\\" or All[\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\)] where \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\) is the number of dimensions.\n\
VertexDisplacement[{\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[\
StyleBox[\"n\",FontSlant->\"Italic\"], \
\"2\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[\
StyleBox[\"n\",FontSlant->\"Italic\"], \
\"3\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)...}, \
{\!\(\*SubscriptBox[StyleBox[\"c\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"c\",FontSlant->\"\
Italic\"], \"2\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\) ...}] \
expands to a list of vertex displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"VertexDisplacement", ",", 
    RowBox[{"{", 
     RowBox[{"NHoldAll", ",", "Constant"}], "}"}]}], "]"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPositions", "::", "usage"}], "=", "\n", 
   "\"\<MechanismPositions[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns the coordinates of the vertices of mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\nMechanismPositions[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) ] returns a new Mechanism \
with coordinates given by positions.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6017]:=",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "::", "usage"}], " ", "=", " ", 
    "\"\<Linkage[ {{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \
\"1\"]\), \!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \
\"1\"]\)}, {\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \
\"2\"]\), \!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \
\"2\"]\)},...}, {\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \
\"1\"]\)[ {\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \
\"1\"]\), \!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), \
..} ], ... } ] returns a linkage in 2D with vertices at { \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"1\"]\)}, \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"2\"]\)},...} and \
made from the specified cells.\nLinkage[ \
{{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"1\"],FontSlant->\"Italic\"]\)}, \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"2\"],FontSlant->\"Italic\"]\)},...}, {\!\
\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), ..} ], \
... } ] returns a linkage in 3D with vertices at {{x1, y1}, ..} and made from \
the specified cells.\n\nUse Linkage[\\\"Examples\\\"] to list some examples \
that can be accessed by Linkage[ \
\!\(\*StyleBox[\"example\",FontSlant->\"Italic\"]\) ] to generate it.\n\n\
Properties:\\n\nCell properties can be specified by Property[ \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), ..} ], \
{\!\(\*SubscriptBox[StyleBox[\"property\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"value\",FontSlant->\"Italic\"], \
\"1\"]\), ... } ].\nProperties are \\\"Style\\\", \\\"Shape\\\" (to specify a \
shape function), \\\"Label\\\". \
MechanismCellTypes[\!\(\*StyleBox[\"cell\",FontSlant->\"Italic\"]\)] will \
list additional properties that can be specified for a cell.\n\nOptions:\\n\n\
Linkage[] takes the option OverlapPrecision which determines how close \
vertices need to be in order to be mapped onto each other. This could be set \
to 0 (or None).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "::", "usage"}], "=", "\n", 
    "\"\<Origami[ {{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \
\"1\"]\), \!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \
\"1\"]\)}, {\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \
\"2\"]\), \!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \
\"2\"]\)},...}, {\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \
\"1\"]\)[ {\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \
\"1\"]\), \!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), \
..} ], ... } ] returns an Origami in 3D (displayed in 2D) with vertices at {{\
\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"1\"]\)}, \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"2\"]\)},...} and \
made from the specified cells.\nOrigami[ \
{{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"1\"],FontSlant->\"Italic\"]\)}, \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"2\"],FontSlant->\"Italic\"]\)},...}, {\!\
\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), ..} ], \
... } ] returns an Origami in 3D with vertices at \
{{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"1\"],FontSlant->\"Italic\"]\)}, \
{\!\(\*SubscriptBox[StyleBox[\"x\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"y\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*StyleBox[SubscriptBox[\"z\", \"2\"],FontSlant->\"Italic\"]\)},...} and \
made from the specified cells.\n\nUse Origami[\\\"Examples\\\"] to list some \
examples that can be accessed by Origami[ example ].\n\nProperties:\\n\nCell \
properties can be specified by Property[ \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"i\",FontSlant->\"Italic\"], \"2\"]\), ..} ], \
{\!\(\*SubscriptBox[StyleBox[\"property\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"value\",FontSlant->\"Italic\"], \
\"1\"]\), ... } ].\nProperties are \\\"Style\\\", \\\"Shape\\\" (to specify a \
shape function), \\\"Label\\\". \
MechanismCellTypes[\!\(\*StyleBox[\"cell\",FontSlant->\"Italic\"]\)] will \
list additional properties that can be specified for a cell.\\n\n\nOptions:\n\
\nOrigami[] takes the option OverlapPrecision which determines how close \
vertices need to be in order to be mapped onto each other. This could be set \
to 0 (or None).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismQ", "::", "usage"}], "=", 
   "\"\<MechanismQ[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] returns \
True if \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) is a Mechanism.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6022]:=",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToLinkage", "::", "usage"}], "=", "\n", 
    "\"\<ToLinkage[\!\(\*StyleBox[\"obj\",FontSlant->\"Italic\"]\)] attempts \
to create a Linkage from some other object (e.g. Graph[], MeshRegion[], \
etc.). It takes the same options as Linkage[].\n\
ToLinkage[\!\(\*StyleBox[\"obj\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"rules\",FontSlant->\"Italic\"]\) ] attempts to create a \
Linkage using a list of rules of the form {Point \[RightArrow] FreeJoint, \
Line \[RightArrow] RigidBar, Polygon \[RightArrow] Face} to assign elastic \
objects. The rules are not checked for errors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "::", "usage"}], "=", "\n", 
   "\"\<ToOrigami[ \!\(\*StyleBox[\"object\",FontSlant->\"Italic\"]\) ] \
converts an object to an Origami Mechanism. Effectively, this only works for \
some MeshRegion[] or Linkage[] objects.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6025]:=",ExpressionUUID->"256a186e-82a8-4d54-8ce2-d06f99a7462a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OverlapPrecision", "::", "usage"}], "=", 
   "\"\<OverlapPrecision is an option that indicates how close points have to \
be to be considered identical.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6027]:=",ExpressionUUID->"22907678-8e63-445b-bf88-1cf1b4802c34"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"cell", " ", "modifiers"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"TagCells", "::", "usage"}], "=", " ", 
     "\"\<TagCells[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"[\",\
FontSlant->\"Italic\"]\){\!\(\*SubscriptBox[StyleBox[\"index\",FontSlant->\"\
Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"index\",FontSlant->\"Italic\"], \"2\"]\),...} ] \
] adds a data tag to the indices.\n\
TagCells[\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"[\"\
,FontSlant->\"Italic\"]\){\!\(\*SubscriptBox[StyleBox[\"index\",FontSlant->\"\
Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"index\",FontSlant->\"Italic\"], \"2\"]\),...}] \
] is a version that can be applied to a mechanism.\>\""}], ";"}], "\n", "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"LabelVertices", "::", "usage"}], "=", 
     "\"\<LabelVertices[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) , \!\(\
\*StyleBox[\"labels\",FontSlant->\"Italic\"]\) ] adds \!\(\*StyleBox[\"labels\
\",FontSlant->\"Italic\"]\) to the vertices of a mechanism.\nlabels can be \\\
\"Name\\\", \\\"Index\\\", None, a list \
{\!\(\*SubscriptBox[StyleBox[\"label\",FontSlant->\"Italic\"], \"1\"]\), \!\(\
\*StyleBox[SubscriptBox[\"label\", \"2\"],FontSlant->\"Italic\"]\), ...} for \
all vertices or a list of rules \
{\!\(\*SubscriptBox[StyleBox[\"vertex\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"label\",FontSlant->\"Italic\"], \
\"1\"]\), ...}\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SelectCells", "::", "usage"}], "=", "\n", 
     "\"\<SelectCells[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*StyleBox[SubscriptBox[\"cell\", \
\"1\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\
\"Italic\"]\)} ] selects a sub-Mechanism with cell specification matching \
pattern.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteCells", "::", "usage"}], "=", 
     "\"\<DeleteCells[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*StyleBox[SubscriptBox[\"cell\", \
\"1\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\
\"Italic\"]\)} ] deletes a subset of cells in a mechanism.\>\""}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AddCells", "::", "usage"}], "=", 
     "\"\<AddCells[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*StyleBox[SubscriptBox[\"cell\", \
\"1\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\
\"Italic\"]\)} ] adds cells to a mechanism.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "::", "usage"}], "=", 
     "\"\<SubdivideCells[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\
\*StyleBox[\"cell\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\) ] adds a vertex to a cell \
at its centroid named by \!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\). \
cell has the form {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\),...}\n\
SubdivideCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...}, \
\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\)] subdivides a list of \
cells, naming the new vertices a variation of \
\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"DivideFaces", "::", "usage"}], "=", 
     "\"\<DivideFaces[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}} ] divides a face along diagonal \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\)}. The new faces match the orientation of their parent \
face.\nDivideFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*StyleBox[SubscriptBox[\"e\", \
\"1\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"e\",FontSlant->\"\
Italic\"], \"2\"]\), ...}] divides several faces along the listed edges read \
from left to right.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DivideEdges", "::", "usage"}], "=", 
     "\"\<DivideEdges[ m, edges ] adds a vertex at the center of each edge.\n\
DivideEdges[ m, edges , label] adds a vertex named by label to the center of \
each specified edge.\n\nThe function breaks up associated faces \
appropriately.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"TriangulateFaces", "::", "usage"}], "=", 
     "\"\<TriangulateFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
triangulates all Faces along the shortest diagonal recursively, leaving \
triangles alone.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PlaceVertices", "::", "usage"}], "=", 
     "\"\<PlaceVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"pos\",FontSlant->\"Italic\"], \"1\
\"]\), ...} ] moves vertices to new positions.\nPlaceVertices[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), { \!\(\*SubscriptBox[StyleBox[\
\"pos\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"pos\",FontSlant->\"Italic\"], \"2\"]\), ... } ] \
replaces all vertex positions by a list of new positions.\>\""}], ";"}], "\n",
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DisplaceVertices", "::", "usage"}], "=", 
     "\"\<DisplaceVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), {\!\
\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"disp\",FontSlant->\"Italic\"], \
\"1\"]\), ...} ] displaces vertices by a displacement.\nDisplaceVertices[\!\(\
\*StyleBox[\"m\",FontSlant->\"Italic\"]\), { \
\!\(\*SubscriptBox[StyleBox[\"disp\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"disp\",FontSlant->\"Italic\"], \"2\"]\), ... } \
] displaces all vertices by a list of displacements.\n\
DisplaceVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) ] changes a mechanism with \
positions {\!\(\*StyleBox[SubscriptBox[\"p\", \
\"1\"],FontSlant->\"Italic\"]\), \!\(\*StyleBox[SubscriptBox[\"p\", \
\"2\"],FontSlant->\"Italic\"]\), ...} to one with \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[{\!\(\*StyleBox[SubscriptBox[\"\
p\", \"1\"],FontSlant->\"Italic\"]\), \!\(\*StyleBox[SubscriptBox[\"p\", \
\"2\"],FontSlant->\"Italic\"]\), ...}].\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MapVertices", "::", "usage"}], "=", 
     "\"\<MapVertices[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] applies \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) to every vertex position and \
returns a new mechanism.\n\
MapVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\"f\
\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\),...}] replaces vertex positions {p1,p2,...} with \
{\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*StyleBox[SubscriptBox[\"\
p\", \"1\"],FontSlant->\"Italic\"]\), \!\(\*StyleBox[SubscriptBox[\"v\", \
\"1\"],FontSlant->\"Italic\"]\)], \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\
\)[\!\(\*StyleBox[SubscriptBox[\"p\", \
\"2\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[SubscriptBox[\"v\", \"2\"],FontSlant->\"Italic\"]\)], ...}.\n\
MapVertices[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\"f\
\",FontSlant->\"Italic\"]\), \
{{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"11\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"12\"]\), ...}, \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"21\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"22\"]\), ...}, ...} ] replaces vertex positions with \
{f[\!\(\*StyleBox[SubscriptBox[\"p\", \"1\"],FontSlant->\"Italic\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"21\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"22\"]\), ...], f[\!\(\*StyleBox[SubscriptBox[\"p\", \
\"2\"],FontSlant->\"Italic\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"21\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"22\"]\), ...], ...}\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteVertices", "::", "usage"}], "=", 
     "\"\<DeleteVertices[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"\
Italic\"], \"2\"]\),...} ] deletes a list of vertices and all cells \
associated with those vertices.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MapCells", "::", "usage"}], "=", 
     "\"\<MapCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] applies a map \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) to each of the cells of a \
mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   
   RowBox[{
    RowBox[{
     RowBox[{"ReplaceCells", "::", "usage"}], "=", 
     "\"\<ReplaceCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] applies rules \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) to the cells of a mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"JoinMechanism", "::", "usage"}], "=", 
     "\"\<JoinMechanism[ \!\(\*StyleBox[SubscriptBox[\"m\", \
\"1\"],FontSlant->\"Italic\"]\), \!\(\*StyleBox[SubscriptBox[\"m\", \
\"2\"],FontSlant->\"Italic\"]\), ... ] joins a list of Mechanisms of the same \
type together.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6028]:=",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "usage"}], "=", 
   "\"\<ChangeCellData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"head\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], \!\(\*StyleBox[\"dataSpec\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\)] modifies the data of \
specific cells in mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\n\
ChangeCellData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\
\"f\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"dataSpec\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\)] uses \
\!\(\*StyleBox[\"f\",FontSlant->\"Plain\"]\)\!\(\*StyleBox[\"[\",FontSlant->\"\
Plain\"]\)\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"]\",\
FontSlant->\"Italic\"]\) to generate a list of cells to change.\n\n\
\!\(\*StyleBox[\"dataSpec\",FontSlant->\"Italic\"]\) is either appropriate \
data specification for the cells or one of \\\"Style\\\", \\\"Shape\\\", or \
\\\"Label\\\".\n\n\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\) can be one \
of three things:\n\t{\!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\
\"], \"1\"]\), \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \
\"2\"]\), ...}\n\ta single element is evaluated as a list of identical data\n\
\ta function \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) is evaluated as \
the data {\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*SubscriptBox[\
StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\)], \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)[\!\(\*SubscriptBox[StyleBox[\"\
cell\",FontSlant->\"Italic\"], \"2\"]\)], ...}\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6044]:=",ExpressionUUID->"ee63bb43-3ce4-4d8a-a461-67e8703ba434"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AddOption", "::", "usage"}], "=", 
   "\"\<AddOption[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"key\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"value\",FontSlant->\"Italic\"], \
\"1\"]\), ...} ] adds a list of options to a mechanism, flattening the \
options.\nAddOption[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"key\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"value\",FontSlant->\"Italic\"], \
\"1\"]\), ...} , \!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\)] adds a list \
of options to a mechanism, using function \
\!\(\*StyleBox[\"f\",FontSlant->\"Italic\"]\) to merge.\n\nYou can also use \
KeyExistsQ[] and Delete[] to test and delete options.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6045]:=",ExpressionUUID->"a87484c2-87d5-4419-891d-49b8756ecec4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "usage"}], "=", "\n", 
   "\"\<TesselateMechanism[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"primitive\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vector\",FontSlant->\"Italic\"]\),\
 \!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"1\"]\) ], \
TesselateMechanism[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\)}, {\!\
\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \
\"2\"]\)}],  \
TesselateMechanism[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \
\"2\"]\),\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \
\"3\"]\)}, {\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \
\"2\"]\),\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"3\"]\)}] \
tesselates a mechanism using a set of 2D or 3D primitive vectors as an \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"1\"]\) x \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"1\"]\) x \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"2\"]\) x \
\!\(\*SubscriptBox[StyleBox[\"n\",FontSlant->\"Italic\"], \"3\"]\)} celled \
mechanism.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6046]:=",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Example", " ", "linkages"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PinnedFourBarLinkage", "::", "usage"}], "=", 
     "\"\<PinnedFourBarLinkage[{\!\(\*StyleBox[\"width\",FontSlant->\"Italic\"\
]\) , \!\(\*StyleBox[\"height\",FontSlant->\"Italic\"]\)}] represents a \
pinned, four-bar linkage with a given \
\!\(\*StyleBox[\"width\",FontSlant->\"Italic\"]\) and \!\(\*StyleBox[\"height\
\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChainLinkage", "::", "usage"}], "=", 
     "\"\<ChainLinkage[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\), \
{\!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\)}] represents a chain of n \
bars between a \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\) and \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\). Endpoints are vertex 1 and \
2.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PolygonalLinkage", "::", "usage"}], "=", 
     "\"\<PolygonalLinkage[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] \
represents a polygonal linkage in 2D with n equal length segments.\>\""}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"WattLinkage", "::", "usage"}], "=", 
     "\"\<WattLinkage represents a Watt linkage with equal length bars.\n\
WattLinkage[ \!\(\*StyleBox[\"l\",FontSlant->\"Italic\"]\) ] represents a \
Watt linkage with middle bar of length \
\!\(\*StyleBox[\"l\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ConnellyServatiusLinkage", "::", "usage"}], "=", 
     "\"\<ConnellyServatiusLinkage represents the ConnellyServatius linkage \
with cusp singularity.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Connelly2ndOrderRigidLinkage", "::", "usage"}], "=", 
     "\"\<Connelly2ndOrderRigidLinkage represents Connelly's example of a 2nd \
order rigid linkage that is not prestress stable.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PeaucellierLinkage", "::", "usage"}], "=", 
     "\"\<PeaucellierLinkage represents the Peaucellier linkage with a vertex \
that moves along a straight line. Changing the distance between fixed joints \
changes the trajectory to a curved arc.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Pantograph", "::", "usage"}], "=", 
     "\"\<Pantograph[\!\(\*StyleBox[\"length\",FontSlant->\"Italic\"]\)], \
Pantograph[] represents a Pantograph (a copying mechanism).\>\""}], ";"}], 
   "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"Example", " ", "origami"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"BirdsFoot", "::", "usage"}], "=", 
     "\"\<BirdsFoot represents a single bird's foot origami.\nBirdsFoot[ \!\(\
\*StyleBox[\"a\",FontSlant->\"Italic\"]\) ] represents a bird's foot with an \
interior angle \!\(\*StyleBox[\"a\",FontSlant->\"Italic\"]\).\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SingleVertex", "::", "usage"}], "=", 
     "\"\<SingleVertex[ \
{\!\(\*SubscriptBox[StyleBox[\"a\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"a\",FontSlant->\"\
Italic\"], \"2\"]\), ...} ] represents a single vertex with sector angles {\!\
\(\*SubscriptBox[StyleBox[\"a\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"a\",FontSlant->\"\
Italic\"], \"2\"]\), ...}\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandlettBirdOrigami", "::", "usage"}], "=", 
     "\"\<RandlettBirdOrigami represents an unfolded Randlett bird. \
RandlettBirdOrigami[\\\"Folded\\\"] represents a folded version of the \
Randlett bird.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"WaterBombBase", "::", "usage"}], "=", 
     "\"\<WaterBombBase represents a unit cell of the water bomb base \
origami.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MiuraOriCell", "::", "usage"}], "=", 
     "\"\<MiuraOriCell[\!\(\*StyleBox[\"x\",FontSlant->\"Italic\"]\)] \
represents the unit cell of a Miura ori origami with vertical folds offset \
from vertex by \!\(\*StyleBox[\"x\",FontSlant->\"Italic\"]\).\n\
MiuraOriCell[x, \\\"Triangulated\\\"] is a triangulated Miura ori unit cell \
with vertical folds offset from vertex by \
\!\(\*StyleBox[\"x\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SteffanPolyhedron", "::", "usage"}], "=", 
     "\"\<SteffanPolyhedron[], \
SteffanPolyhedron[\!\(\*StyleBox[\"t\",FontSlant->\"Italic\"]\)] represents a \
Steffan polyhedron origami with angle \
\!\(\*StyleBox[\"t\",FontSlant->\"Italic\"]\). The Steffan polyhedron is a \
non-convex polyhedron that can flex.\nIts evaluation is partially numeric but \
the equilibirum edge lengths are given exactly.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"KagomeUnitCell", "::", "usage"}], "=", 
     "\"\<KagomeUnitCell[] represents a unit cell for a Kagome lattice. The \
lattice vectors are {2 Sqrt[3],0},{Sqrt[3],3}}.\nKagomeUnitCell[ s ] \
represents a unit cell for a Kagome lattice whose size is rescaled by \
s.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6047]:=",ExpressionUUID->"b3ce6a72-fd97-4ba7-91fc-018986a4f1ec"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6062]:=",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$meshRegionProperties", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MeshCellStyle", " ", "\[Rule]", " ", "\"\<Style\>\""}], ",", 
      " ", 
      RowBox[{"MeshCellLabel", " ", "\[Rule]", " ", "\"\<Label\>\""}], " ", 
      ",", " ", 
      RowBox[{
      "MeshCellShapeFunction", " ", "\[Rule]", " ", "\"\<Shape\>\""}]}], 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"packedCellPattern", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "[", 
      RowBox[{"_", ",", "_"}], "]"}], "..."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"labelPattern", " ", "=", " ", 
    RowBox[{"{", "___Rule", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern2D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern3D", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"_", ",", " ", "_", ",", " ", "_"}], "}"}], ".."}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinatePattern", " ", "=", " ", 
   RowBox[{"coordinatePattern2D", " ", "|", " ", "coordinatePattern3D"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6063]:=",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"],

Cell[CellGroupData[{

Cell["MechanismQ[]", "Subsection",ExpressionUUID->"eff07146-d872-4431-837d-c7f0a6ec7629"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPattern", " ", "=", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"Linkage", "|", "Origami"}], ")"}], "[", " ", 
     RowBox[{
     "coordinatePattern", ",", " ", "_", " ", ",", " ", "packedCellPattern", 
      ",", " ", "labelPattern", " ", ",", " ", "_Association"}], " ", "]"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismQ", "[", " ", "mechanismPattern", " ", "]"}], ":=", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"MechanismQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6069]:=",ExpressionUUID->"a5aa8b49-bcf0-48ef-881c-d1ffc63e1b4c"]
}, Closed]],

Cell[CellGroupData[{

Cell["DefaultCellProperties[] and expansion rules for cells", "Subsection",ExpressionUUID->"5cf74a85-b4c1-4085-b474-db69e3569d24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "define", " ", "how", " ", "the", " ", "indices", " ", "work", " ", "for", 
    " ", "these", " ", "types", " ", "of", " ", "cells"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"vertexCells", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"FreeJoint", " ", ",", " ", "PinnedJoint"}], " ", "}"}]}], " ", 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"edgeCells", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
      "RigidBar", " ", ",", " ", "Spring", " ", ",", " ", "TorsionalFold"}], 
      " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"faceCells", " ", "=", " ", 
     RowBox[{"{", " ", "Face", " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"angleCells", " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{
      "AngleJoint", " ", ",", " ", "StraightJoint", ",", " ", 
       "ElasticTriangle"}], " ", 
      RowBox[{"(*", 
       RowBox[{
       "this", " ", "is", " ", "really", " ", "a", " ", "triangular", " ", 
        "face"}], "*)"}], "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"$MechanismCellTypes", " ", "=", " ", 
     RowBox[{"Join", "[", " ", 
      RowBox[{
      "vertexCells", ",", " ", "edgeCells", ",", " ", "faceCells", ",", " ", 
       "angleCells"}], " ", "]"}]}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6072]:=",ExpressionUUID->"70919af2-7965-4a0c-8692-fec7696c86d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"some", " ", "cells", " ", "should", " ", "expand"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"cellParsingExpansionRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Face", "[", " ", 
        RowBox[{"i_", " ", ",", " ", "properties_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Face", "[", " ", 
          RowBox[{"i", " ", ",", " ", "properties"}], " ", "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"RigidBar", "[", " ", 
            RowBox[{"#", ",", " ", "properties"}], " ", "]"}], " ", "&"}], 
          " ", "/@", " ", 
          RowBox[{"Partition", "[", " ", 
           RowBox[{"i", " ", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], 
           " ", "]"}]}]}], " ", "}"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Polygon", "[", " ", 
        RowBox[{"i_", " ", ",", " ", "properties_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"Face", "[", " ", 
        RowBox[{"i", " ", ",", " ", "properties"}], " ", "]"}]}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"SpringFace", "[", 
        RowBox[{"i_", ",", " ", "properties_"}], " ", "]"}], " ", ":>", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Face", "[", " ", 
          RowBox[{"i", " ", ",", " ", "properties"}], " ", "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Spring", "[", " ", 
            RowBox[{"#", ",", " ", "properties"}], " ", "]"}], " ", "&"}], 
          " ", "/@", " ", 
          RowBox[{"Partition", "[", " ", 
           RowBox[{"i", " ", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], 
           " ", "]"}]}]}], " ", "}"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"StraightJoint", "[", 
        RowBox[{"i_List", ",", " ", "properties_"}], " ", "]"}], " ", ":>", 
       " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"FreeJoint", "[", 
          RowBox[{
           RowBox[{"i", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "properties"}], 
          "]"}], ",", " ", 
         RowBox[{"StraightJoint", "[", 
          RowBox[{"i", ",", " ", "properties"}], "]"}]}], "}"}]}]}], "\n", 
     "}"}]}], ";"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6077]:=",ExpressionUUID->"70585b2e-2fea-45e2-81c4-afc444157acf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "default", " ", "data", " ", "in", " ", "all", " ", "cell", " ", "types"}],
    " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "RigidBar", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
       "\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
       " ", 
       RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}]}], 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "Spring", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
       "\"\<EquilibriumLength\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
       " ", 
       RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",", 
       " ", 
       RowBox[{
       "\"\<Strain\>\"", " ", "\[Rule]", " ", "\"\<LinearStrain\>\""}]}], 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "Face", "]"}], " ", "=", " ", 
     RowBox[{"{", " ", 
      RowBox[{"\"\<FaceStiffness\>\"", "->", "0"}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "ElasticTriangle", "]"}], " ", "=",
      " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"\"\<YoungsModulus\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       " ", ",", " ", 
       RowBox[{"\"\<PoissonRatio\>\"", " ", "\[Rule]", " ", 
        RowBox[{"1", "/", "3"}]}]}], " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "TorsionalFold", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{
       "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], ",", 
       " ", 
       RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "FreeJoint", "]"}], " ", "=", " ", 
     
     RowBox[{"{", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "PinnedJoint", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"\"\<PinningStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       ",", " ", 
       RowBox[{
       "\"\<ConstraintFunction\>\"", " ", "\[Rule]", " ", "Automatic"}]}], 
      " ", "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "AngleJoint", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<AngleStiffness\>\"", " ", "\[Rule]", " ", "Infinity"}], 
       ",", " ", 
       RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "Automatic"}]}], " ", 
      "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "StraightJoint", "]"}], " ", "=", 
     " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<Distance\>\"", " ", "->", " ", "Automatic"}], ",", " ", 
       RowBox[{"\"\<AngleStiffness\>\"", "->", "Infinity"}]}], "}"}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "_String", "]"}], " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"DefaultCellProperties", "[", " ", "head_", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"Mechanism", "::", "cellerr"}], ",", " ", "head"}], "]"}], 
      ";", " ", 
      RowBox[{"{", "}"}]}], ")"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Mechanism", "::", "cellerr"}], "=", 
     "\"\<Cell type `1` is not recognized.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6078]:=",ExpressionUUID->"f5ce23c9-dd88-49e3-8ce9-d15ea2f4a0f2"]
}, Closed]],

Cell[CellGroupData[{

Cell["ValidMechanismCellHeadQ[], ValidMechanismCellQ[]", "Subsection",ExpressionUUID->"d1bfb2ec-05b0-4a63-91f8-fcaf3033211d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "pattern", " ", "for", " ", "all", " ", "possible", " ", "cell", " ", 
    "heads"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"celltypePattern", " ", "=", " ", 
     RowBox[{"Alternatives", " ", "@@", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
        "vertexCells", ",", " ", "edgeCells", ",", " ", "faceCells", " ", ",",
          " ", "angleCells"}], " ", "}"}], "]"}]}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"pattern", " ", "for", " ", "cells"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"inputCellPattern", " ", "=", " ", "\n", "\t", 
     RowBox[{"Alternatives", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "edgeCells"}], ")"}], "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Except", "[", "_List", "]"}], " ", ",", " ", 
          RowBox[{"Except", "[", "_List", "]"}]}], " ", "}"}], " ", "]"}], 
       ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "vertexCells"}], ")"}], "[", " ", 
        RowBox[{"Except", "[", "_List", "]"}], " ", "]"}], ",", "\n", "\t\t", 
       
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "faceCells"}], ")"}], "[", " ", 
        RowBox[{"_", "?", "VectorQ"}], " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "angleCells"}], ")"}], "[", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Except", "[", "_List", "]"}], ",", 
          RowBox[{"Except", "[", "_List", "]"}], ",", 
          RowBox[{"Except", "[", "_List", "]"}]}], "}"}], " ", "]"}]}], "\n", 
      "\t", "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "pattern", " ", "for", " ", "cells", " ", "with", " ", "integer", " ", 
     "indices", " ", "only"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"exactCellPattern", " ", "=", "\n", "\t", 
     RowBox[{"Alternatives", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "edgeCells"}], ")"}], "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{"_Integer", " ", ",", " ", "_Integer"}], " ", "}"}], " ", 
        "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "vertexCells"}], ")"}], "[", " ", 
        "_Integer", " ", "]"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "faceCells"}], ")"}], "[", " ", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"VectorQ", "[", 
            RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], " ", "]"}],
        ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Alternatives", "@@", "angleCells"}], ")"}], "[", " ", 
        RowBox[{"{", 
         RowBox[{"_Integer", ",", " ", "_Integer", ",", " ", "_Integer"}], 
         "}"}], " ", "]"}]}], "\n", "\t", "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"ValidMechanismCellHeadQ", "[", " ", "cell_", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"MatchQ", "[", " ", 
     RowBox[{"cell", ",", " ", "celltypePattern"}], " ", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"ValidMechanismCellQ", "[", " ", "cell_", " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"MatchQ", "[", " ", 
     RowBox[{"cell", ",", " ", "exactCellPattern"}], " ", "]"}]}]}]}]], "Code",\

 CellLabel->
  "1/2/24 10:11:58 \
In[6090]:=",ExpressionUUID->"ed571078-958d-4e2f-a397-1d8c061345b0"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["private functions to manipulate cells", "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],

Cell[CellGroupData[{

Cell["dataForm[]", "Subsection",ExpressionUUID->"af8d39d2-e6d6-4050-8965-bc05f40569d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dataForm", "[", " ", "head_", " ", "]"}], ":=", " ", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"DefaultCellProperties", "[", "head", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<Shape\>\"", ",", "\"\<Label\>\"", ",", "\"\<Style\>\""}], 
     "}"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6095]:=",ExpressionUUID->"7fbf1a47-bbdd-40af-8183-29e1ca6e4192"]
}, Closed]],

Cell[CellGroupData[{

Cell["packCells[]", "Subsection",ExpressionUUID->"3140d306-2fe3-4d80-8519-e5c1a3a2179c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "take", " ", "a", " ", "list", " ", "of", " ", "cells", " ", "with", " ", 
    "elements", " ", "of", " ", "the", " ", "form", "\n", "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{"index", " ", ",", " ", "data"}], " ", "]"}], "\n", "\n", "and", 
    " ", "combine", " ", "them", " ", "into", " ", "a", " ", "compressed", 
    " ", "form", " ", "for", " ", 
    RowBox[{"storage", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"packCells", "[", " ", 
     RowBox[{"cells", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"_", "[", 
         RowBox[{"_", ",", "_"}], "]"}], "..."}], "}"}]}], " ", "]"}], " ", ":=",
     "\n", "\t", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"groupedCells", " ", "=", " ", 
        RowBox[{"GatherBy", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"preparseCellsForStorage", " ", "/@", " ", "cells"}], 
           "]"}], ",", " ", "Head"}], " ", "]"}]}], " ", "}"}], ",", "\n", 
      "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"packCellsOfSameType", "[", "  ", 
         RowBox[{
          RowBox[{"Head", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}]}], " ", "]"}], "&"}], " ",
        "/@", " ", "groupedCells"}]}], "\n", "\t", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"packCellsOfSameType", "[", " ", 
     RowBox[{"s_String", ",", " ", "indices_", ",", " ", "data_"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"s", "[", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "indices", "]"}], ",", 
      RowBox[{"{", "}"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"packCellsOfSameType", "[", " ", 
     RowBox[{"head_Symbol", ",", " ", "indices_", ",", " ", "data_"}], " ", 
     "]"}], " ", ":=", " ", "\n", "\t", 
    RowBox[{"head", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "indices", "]"}], " ", ",", " ", "\n", 
      "\t\t", 
      RowBox[{"compressCellData", "[", " ", 
       RowBox[{"head", ",", " ", "data"}], " ", "]"}]}], "\n", "\t", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6096]:=",ExpressionUUID->"d441c2cb-db4c-4b3c-be58-c401dbbf458e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"preparseCellsForStorage", "[", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "properties_"}], " ", "]"}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", 
      RowBox[{
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", " ", "\[Rule]", " ", "_"}], " ", "&"}], ")"}], " ", "/@",
          " ", 
         RowBox[{"dataForm", "[", "head", "]"}]}]}], ",", " ", "\n", 
       RowBox[{"untagged", " ", "=", " ", 
        RowBox[{"DeleteCases", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", " ", "@", " ", 
           RowBox[{"{", "properties", "}"}]}], ",", " ", "_String"}], " ", 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"indices", ",", 
           RowBox[{"{", "}"}]}], "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"{", "properties", "}"}]}], ",", " ", "_String"}], " ", 
         "]"}]}], ",", " ", 
       RowBox[{"(*", 
        RowBox[{"tag", " ", "cells", " ", "look", " ", "like", " ", "this"}], 
        "*)"}], "\n", "\t\t", 
       RowBox[{"head", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"untagged", ",", " ", "rules"}], " ", "]"}]}], " ", "]"}]}],
       " ", 
      RowBox[{"(*", 
       RowBox[{
       "remove", " ", "bad", " ", "properties", " ", "from", " ", "mechanism",
         " ", "cells"}], "*)"}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "badprop"}], " ", "=", " ", 
   "\"\<Properties `1` do not exist for cell `2`.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6099]:=",ExpressionUUID->"c533ba08-40c1-4f85-a5d9-ebd3d51e166d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compressCellData", "[", " ", 
    RowBox[{"head_", " ", ",", " ", "data_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"mergedData", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Merge", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
             RowBox[{"Flatten", "[", "#", "]"}], "&"}]}], "]"}], "&"}], " ", "/@",
          " ", "data"}]}], ",", "\n", "\t\t", 
       RowBox[{"default", " ", "=", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"DefaultCellProperties", "[", "head", "]"}], ",", " ", 
          "\"\<Style\>\""}], " ", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"cellData", " ", "=", " ", 
        RowBox[{
         RowBox[{"DefaultCellProperties", "[", "head", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"defaultValues", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"DefaultCellProperties", "[", "head", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "/.", " ", 
         RowBox[{"Automatic", " ", "->", " ", "\"\<Automatic\>\""}]}]}]}], 
      "\n", "\t", "}"}], ",", "\n", "\t", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"MapThread", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"combineData", "[", " ", 
           RowBox[{
           "#1", ",", " ", "#2", " ", ",", " ", "mergedData", ",", " ", 
            "Last"}], " ", "]"}], "&"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{"cellData", ",", "\n", "\t\t\t", "defaultValues"}], "\n", 
          "\t\t\t", "}"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"combineData", "[", " ", 
          RowBox[{
          "\"\<Shape\>\"", ",", " ", "\"\<Automatic\>\"", ",", " ", 
           "mergedData", " ", ",", " ", "Last"}], "]"}], ",", "\n", "\t\t\t", 
         
         RowBox[{"combineData", "[", " ", 
          RowBox[{
          "\"\<Label\>\"", ",", " ", "None", ",", " ", "mergedData", " ", ",",
            " ", "Last"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"combineDataList", "[", " ", 
          RowBox[{
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<Style\>\"", " ", "/.", " ", "mergedData"}], " ", "/.",
              " ", "default"}], " ", "/.", " ", 
            RowBox[{"\"\<Style\>\"", "\[Rule]", 
             RowBox[{"{", "}"}]}]}]}], " ", "]"}]}], "\n", "\t\t", "}"}]}], 
      "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "combine", " ", "data", " ", "presented", " ", "as", " ", "a", " ", 
    "list"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"combineDataList", "[", " ", 
   RowBox[{"default_", " ", ",", " ", "data_"}], "  ", "]"}], " ", ":=", " ", 
  
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Last", " ", "/@", " ", 
      RowBox[{"GatherBy", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"default", ",", " ", "#"}], "}"}], " ", "]"}], ",", " ", 
        "directiveQ"}], " ", "]"}]}], ")"}], "&"}], " ", "/@", " ", 
   "data"}]}], "\n", 
 RowBox[{
  RowBox[{"directiveQ", "[", " ", 
   RowBox[{
    RowBox[{"_", "?", "ColorQ"}], "|", "_Hue", "|", "_RGBColor", "|", 
    "_GrayLevel", "|", "_CMYKColor", "|", "_LCHColor", "|", "_LUVColor", "|", 
    "_XYZColor"}], " ", "]"}], " ", ":=", " ", "\"\<color\>\""}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"directiveQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Head", "[", "x", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"combine", " ", "single", " ", "atom", " ", "data"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"combineData", "[", " ", 
   RowBox[{
   "dataType_", ",", " ", "DefaultCellProperties_", ",", " ", "data_", " ", 
    ",", " ", "f_"}], " ", "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"SparseArray", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"f", " ", "/@", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"dataType", " ", "/.", " ", "data"}], " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{"dataType", " ", "\[Rule]", " ", 
          RowBox[{"{", "DefaultCellProperties", "}"}]}], "}"}]}], " ", "/.", 
       " ", 
       RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], 
      ")"}]}], ",", "\n", "\t\t", 
    RowBox[{"Length", "[", "data", "]"}], ",", "\n", "\t\t", 
    "DefaultCellProperties"}], "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6101]:=",ExpressionUUID->"3dd53cf3-60d9-466a-835b-f9f10dab12f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["unpackCells[]", "Subsection",ExpressionUUID->"ee5265f2-5b85-4a46-a28b-a243bc9ff076"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"unpackCells", "[", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Flatten", "[", 
    RowBox[{"unpackCellsOfOneType", " ", "/@", " ", "cells"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"unpackCellsOfOneType", "[", " ", 
    RowBox[{"s_String", "[", " ", "indices_", " ", "]"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"s", " ", "/@", " ", "indices"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"unpackCellsOfOneType", "[", " ", 
    RowBox[{"head_Symbol", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"MapThread", "[", "\n", "\t\t", 
    RowBox[{"head", ",", "\n", "\t\t\t", 
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{"indices", ",", "\n", "\t\t\t", 
       RowBox[{"Transpose", " ", "@", " ", 
        RowBox[{"uncompressCellData", "[", " ", 
         RowBox[{"head", ",", " ", "indices", ",", " ", "data"}], " ", 
         "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"uncompressCellData", "[", " ", 
   RowBox[{"head_", " ", ",", " ", "indices_", ",", " ", "data_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"dataNames", "=", 
       RowBox[{"dataForm", "[", "head", "]"}]}], " ", ",", " ", 
      RowBox[{"length", " ", "=", " ", 
       RowBox[{"Length", "[", "indices", "]"}]}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Thread", "[", " ", 
        RowBox[{
         RowBox[{"ConstantArray", "[", 
          RowBox[{"#1", ",", " ", "length"}], "]"}], " ", "->", " ", "#2"}], 
        " ", "]"}], " ", "&"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"dataNames", " ", ",", " ", "data"}], "}"}]}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6106]:=",ExpressionUUID->"4875f961-32d2-4913-98ea-6cdd16c6277c"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
replaceCellIndices[], replaceRepeatedCellIndices[], replaceCellData[]\
\>", "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "do", " ", "a", " ", "regular", " ", "ReplaceAll", " ", "on", " ", "just", 
    " ", "cell", " ", "indices"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"replaceCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
     "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "#", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"ReplaceAll", "[", " ", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], 
       ",", " ", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
    "cells"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6110]:=",ExpressionUUID->"f1139107-b69c-4fd4-8921-cbf950ea380f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "do", " ", "a", " ", "regular", " ", "ReplaceRepeated", " ", "on", " ", 
    "just", " ", "cell", " ", "indices"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"replaceRepeatedCellIndices", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
     "rules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "#", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"ReplaceRepeated", "[", " ", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", "rules"}], " ", "]"}], 
       ",", " ", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
    "cells"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6111]:=",ExpressionUUID->"aedb8fbc-7b63-4e91-8f14-89eba922e5be"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "do", " ", "a", " ", "ReplaceAll", " ", "on", " ", "the", " ", "data", " ",
     "stored", " ", "in", " ", "a", " ", "type", " ", "of", " ", "cell"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"replaceCellData", "[", " ", 
     RowBox[{
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      "rules_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "[", " ", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"replaceElement", "[", " ", 
           RowBox[{"#", ",", " ", "rules"}], " ", "]"}], " ", "&"}], " ", "/@",
          " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "]"}], "&"}], " ", "/@", 
     " ", "cells"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"(*", "\n", 
     RowBox[{
      RowBox[{"from", ":", " ", "https", ":"}], "//", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
          "questions"}], "/", "13790"}], "/", "using"}], "-", "replaceall", 
       "-", "on", "-", "sparsearray"}]}], "\n", "*)"}], "\n", 
    RowBox[{
     RowBox[{"replaceElement", "[", 
      RowBox[{"s_SparseArray", ",", " ", "rule_"}], "]"}], " ", ":=", " ", 
     RowBox[{"With", "[", "\n", "    ", 
      RowBox[{
       RowBox[{"{", "\n", "    ", 
        RowBox[{
         RowBox[{"elem", " ", "=", " ", 
          RowBox[{"ReplaceAll", "[", 
           RowBox[{
            RowBox[{"s", "[", "\"\<NonzeroValues\>\"", "]"}], ",", " ", 
            "rule"}], "]"}]}], ",", "\n", "    ", 
         RowBox[{"def", " ", "=", " ", 
          RowBox[{"ReplaceAll", "[", 
           RowBox[{
            RowBox[{"s", "[", "\"\<Background\>\"", "]"}], ",", " ", "rule"}],
            "]"}]}]}], "\n", "    ", "}"}], ",", "\n", "\n", "    ", 
       RowBox[{"Replace", "[", "\n", "        ", 
        RowBox[{"s", ",", "\n", "        ", 
         RowBox[{
          RowBox[{
           RowBox[{"Verbatim", "[", "SparseArray", "]"}], "[", 
           RowBox[{"a__", ",", " ", "_", ",", " ", 
            RowBox[{"{", 
             RowBox[{"b__", ",", " ", "_"}], "}"}]}], "]"}], " ", 
          "\[RuleDelayed]", " ", 
          RowBox[{"SparseArray", "[", 
           RowBox[{"a", ",", " ", "def", ",", " ", 
            RowBox[{"{", 
             RowBox[{"b", ",", " ", "elem"}], "}"}]}], "]"}]}]}], "\n", 
        "    ", "]"}]}], "\n", "]"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"replaceElement", "[", " ", 
     RowBox[{"s_SparseArray", ",", " ", "rule_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"#", "/.", "rule"}], ")"}], "&"}], "/@", "s"}], ")"}]}], "\n", 
   RowBox[{"(*", "\n", 
    RowBox[{"if", " ", "the", " ", "data", " ", 
     RowBox[{"isn", "'"}], "t", " ", "a", " ", "SparseArray"}], "\n", "*)"}], 
   "\n", 
   RowBox[{
    RowBox[{"replaceElement", "[", " ", 
     RowBox[{"s_", ",", " ", "rule_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"ReplaceAll", "[", " ", 
     RowBox[{"s", ",", " ", "rule"}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6112]:=",ExpressionUUID->"b5a4e93b-03e7-40af-85c4-fe8ffd3be9b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["sortCellType[], orderCellType[]", "Subsection",ExpressionUUID->"530c0200-8cec-4ba0-ac9d-8bb8ee2048af"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Sort", " ", "cells", " ", "of", " ", "one", " ", "type", " ", "by", " ", 
    "a", " ", "sorting", " ", "function"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"sortCellType", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], ",", " ", 
     RowBox[{"sortingFunction_", " ", ":", " ", "Identity"}]}], " ", "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"order", " ", "=", " ", 
       RowBox[{"OrderingBy", "[", " ", 
        RowBox[{"indices", ",", " ", "sortingFunction"}], " ", "]"}]}], " ", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"head", "[", " ", 
      RowBox[{
       RowBox[{"indices", "[", 
        RowBox[{"[", " ", "order", " ", "]"}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", " ", "order", " ", "]"}], "]"}], "&"}], " ", "/@", " ",
         "data"}]}], " ", "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6115]:=",ExpressionUUID->"3dcbb299-d60d-4ccd-b0a6-8765b702245a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
   "sort", " ", "cells", " ", "of", " ", "one", " ", "type", " ", "by", " ", 
    "a", " ", "list", " ", "of", " ", "integers", "\n", "This", " ", 
    "function", " ", "should", " ", "technically", " ", "also", " ", "allow", 
    " ", "deleting", " ", "cells", " ", "not", " ", 
    RowBox[{"listed", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"orderCellType", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{"indices_", ",", "data_"}], " ", "]"}], ",", " ", "ordering_"}],
     " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"head", "[", " ", 
    RowBox[{
     RowBox[{"indices", "[", 
      RowBox[{"[", " ", "ordering", " ", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", " ", "ordering", " ", "]"}], "]"}], "&"}], " ", "/@", 
      " ", "data"}]}], " ", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6116]:=",ExpressionUUID->"102c4a3c-1dcf-48e5-af1a-6ac1cb37098a"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDuplicateCells[]", "Subsection",ExpressionUUID->"66a4fa93-b1cb-408a-b53d-07229a966a10"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"this", " ", "function", " ", "unpacked", " ", "arrays"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"deleteDuplicateCells", "[", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"deleteDuplicateCells", " ", "/@", " ", "cells"}]}], "\n", 
   RowBox[{
    RowBox[{"deleteDuplicateCells", "[", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"indexList", " ", "=", " ", 
        RowBox[{
         RowBox[{"DeleteDuplicatesBy", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Transpose", "[", " ", 
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"Range", "[", " ", 
               RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], ",", " ", 
              "indices"}], " ", "}"}], " ", "]"}], ",", " ", "\n", "\t\t", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"Last", "[", "#", "]"}], "}"}], "]"}], "]"}], "&"}]}], 
          " ", "\n", "\t", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"head", "[", " ", 
       RowBox[{
        RowBox[{"ToPackedArray", " ", "@", " ", 
         RowBox[{"indices", "[", 
          RowBox[{"[", " ", "indexList", " ", "]"}], "]"}]}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", " ", "indexList", " ", "]"}], "]"}], "&"}], " ", "/@",
          " ", "data"}]}], " ", "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6117]:=",ExpressionUUID->"64d17235-533b-4916-b535-0ebabd865c68"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDegenerateCells[]", "Subsection",ExpressionUUID->"31a2a4ca-20a8-4cbc-b01c-74d8e07dc5cb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deleteDegenerateCells", "[", " ", 
   RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"deleteDegenerateCells", " ", "/@", " ", "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"deleteDegenerateCells", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"id", " ", "=", " ", 
      RowBox[{"Pick", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"DuplicateFreeQ", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "#", "}"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "indices"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"head", "[", " ", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "id", "]"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "id", "]"}], "]"}], "&"}], "/@", "data"}]}], " ", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6119]:=",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteOutOfRangeCells[]", "Subsection",ExpressionUUID->"cc99abc8-e331-4953-92b3-a1c47ba4bc34"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deleteOutOfRangeCells", "[", " ", 
   RowBox[{"range_", " ", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"Transpose", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"deleteOutOfRangeCells", "[", 
      RowBox[{"range", ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
    "cells"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"deleteOutOfRangeCells", "[", " ", 
   RowBox[{"range_", " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"selector", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"And", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Min", "[", "#", "]"}], " ", ">", " ", "0"}], ",", " ", 
          RowBox[{
           RowBox[{"Max", "[", "#", "]"}], " ", "<=", " ", "range"}], ",", 
          " ", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "#", "]"}], " ", "||", " ", 
           RowBox[{"VectorQ", "[", 
            RowBox[{"#", ",", "NumericQ"}], "]"}]}]}], "]"}], "&"}], " ", "/@",
        " ", "indices"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"id", " ", "=", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
           "selector"}], " ", "]"}]}], " ", ",", " ", 
        RowBox[{"badid", " ", "=", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
           "selector", " ", ",", " ", "False"}], "]"}]}]}], "}"}], ",", "\n", 
      "\t\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"head", "[", " ", 
         RowBox[{
          RowBox[{"indices", "[", 
           RowBox[{"[", "id", "]"}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "id", "]"}], "]"}], "&"}], " ", "/@", " ", 
           "data"}]}], " ", "]"}], ",", " ", 
        RowBox[{"head", " ", "/@", " ", 
         RowBox[{"indices", "[", 
          RowBox[{"[", "badid", "]"}], "]"}]}]}], "}"}]}], "\n", "\t", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6121]:=",ExpressionUUID->"1e0e07f6-211b-4e69-acf1-1a551cb32302"]
}, Closed]],

Cell[CellGroupData[{

Cell["joinCells[]", "Subsection",ExpressionUUID->"9b7efb19-fa3f-458c-b10d-055c4761c19a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"joinCells", "[", " ", "cells_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"joinCellType", " ", "/@", " ", 
    RowBox[{"GatherBy", "[", " ", 
     RowBox[{
      RowBox[{"Flatten", "[", "cells", "]"}], ",", " ", "Head"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"joinCellType", "[", " ", 
   RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"head", " ", "=", " ", 
       RowBox[{"Head", "[", 
        RowBox[{"cells", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"indices", " ", "=", " ", 
       RowBox[{"cells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"cells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
    
    RowBox[{"sortCellType", " ", "@", " ", 
     RowBox[{"deleteDegenerateCells", " ", "@", " ", 
      RowBox[{"deleteDuplicateCells", " ", "@", " ", 
       RowBox[{"head", "[", " ", 
        RowBox[{
         RowBox[{"Join", " ", "@@", " ", "indices"}], " ", ",", " ", 
         RowBox[{"Join", " ", "@@@", " ", 
          RowBox[{"Transpose", "[", " ", "data", " ", "]"}]}]}], " ", 
        "]"}]}]}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6123]:=",ExpressionUUID->"b44baf22-b49e-49eb-8d47-48ae6f6bc8b6"]
}, Closed]],

Cell[CellGroupData[{

Cell["parseCells[], unparseCells[]", "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"facePattern", " ", "=", " ", 
   RowBox[{"Alternatives", " ", "@@", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{"faceCells", ",", "SpringFace", ",", " ", "Polygon"}], "}"}], 
     "]"}]}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"edgePattern", " ", "=", " ", 
   RowBox[{"Alternatives", " ", "@@", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", "edgeCells", "}"}], "]"}]}]}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"vertexPattern", " ", "=", " ", 
   RowBox[{"Alternatives", " ", "@@", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", "vertexCells", "}"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"anglePattern", " ", "=", " ", 
   RowBox[{"Alternatives", " ", "@@", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", "angleCells", "}"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"cellSpecPattern", " ", "=", " ", 
   RowBox[{
   "facePattern", "|", "edgePattern", "|", "vertexPattern", "|", 
    "anglePattern", "|", "_String"}]}], " ", ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6125]:=",ExpressionUUID->"a1e8e63b-acfc-4881-bf13-620eb284f367"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"edgeLoopQ", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"VectorQ", "[", "#", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], " ", "&"}], ")"}]}], 
  " ", ";"}], "\n", 
 RowBox[{
  RowBox[{"faceListQ", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", " ", "VectorQ"}], "]"}], "&"}], ")"}]}], " ", 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tripleListQ", " ", "=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "#", "]"}], " ", "&"}], ")"}]}], " ", ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"distributePropertyRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", 
          RowBox[{
          "facePattern", "|", "edgePattern", "|", "vertexPattern", "|", 
           "anglePattern"}]}], ")"}], "[", " ", "indices_", " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "cellSpecPattern"}], ")"}], "[", " ", 
        RowBox[{"indices_", ",", " ", "properties_Rule"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"{", "properties", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{"h_List", ",", " ", "properties_"}], " ", "]"}], " ", 
       "\[RuleDelayed]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Property", "[", " ", 
           RowBox[{"#", ",", " ", "properties"}], " ", "]"}], "&"}], " ", "/@",
          " ", "h"}], ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Property", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{"h", " ", ":", " ", "cellSpecPattern"}], ")"}], "[", " ", 
          RowBox[{"indices_", ",", " ", "properties_"}], " ", "]"}], " ", ",",
          " ", "newProperties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"h", "[", 
        RowBox[{"indices", ",", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"{", " ", 
           RowBox[{"properties", ",", " ", "newProperties"}], " ", "}"}], " ",
           "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "vertexPattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "VectorQ"}], " ", ",", " ", "properties_"}],
         " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "edgePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "faceListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "edgePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "edgeLoopQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", 
         RowBox[{"Partition", "[", 
          RowBox[{"indices", ",", "2", ",", "1"}], "]"}]}], " ", ")"}]}], ",",
       "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "facePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "faceListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"(", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], "  ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "anglePattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"indices_", "?", "tripleListQ"}], " ", ",", " ", 
         "properties_"}], " ", "]"}], " ", ":>", " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", " ", 
           RowBox[{"#", " ", ",", " ", "properties"}], " ", "]"}], "&"}], " ",
          "/@", " ", "indices"}], " ", ")"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"h", " ", ":", " ", "vertexPattern"}], ")"}], "[", " ", 
        RowBox[{
         RowBox[{"label_", " ", "\[Rule]", " ", "coordinates_"}], " ", ",", 
         " ", "properties_"}], " ", "]"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"h", "[", " ", 
          RowBox[{"label", ",", " ", "properties"}], " ", "]"}], ",", " ", 
         RowBox[{"add", "[", " ", 
          RowBox[{"label", " ", ",", " ", "coordinates"}], " ", "]"}]}], " ", 
        "}"}]}]}], "\n", "}"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "should", " ", "be", " ", "applied", " ", "to", " ", "the", 
    " ", "top", " ", "level", " ", "after", " ", "everything", " ", "else", 
    " ", "has", " ", "been", " ", 
    RowBox[{"processed", "."}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tagExpansionRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"h", " ", ":", " ", "_String"}], ")"}], "[", " ", "indices_", 
       " ", "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"h", "[", 
       RowBox[{"indices", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"coordinateRules", "[", 
   RowBox[{"coords_", "?", "MatrixQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"max", " ", "=", " ", 
       RowBox[{"Length", "[", "coords", "]"}]}], ",", " ", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "coords", "]"}], ">", "0"}], ",", " ", 
         RowBox[{"Length", "[", 
          RowBox[{"coords", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "0"}], "]"}]}]}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"VertexPosition", "[", " ", 
          RowBox[{"n_Integer", " ", ",", " ", "\"\<x\>\""}], " ", "]"}], " ", 
         "/;", " ", 
         RowBox[{"(", 
          RowBox[{"0", "<", "n", "<=", "max"}], ")"}]}], " ", ":>", " ", 
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"n", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexPosition", "[", " ", 
          RowBox[{"n_Integer", " ", ",", " ", "\"\<y\>\""}], " ", "]"}], " ", 
         "/;", " ", 
         RowBox[{"(", 
          RowBox[{"0", "<", "n", "<=", "max"}], ")"}]}], " ", ":>", " ", 
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"n", ",", "2"}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexPosition", "[", " ", 
          RowBox[{"n_Integer", " ", ",", " ", "\"\<z\>\""}], " ", "]"}], " ", 
         "/;", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"0", "<", "n", "<=", "max"}], " ", "&&", " ", 
           RowBox[{"dim", " ", "==", " ", "3"}]}], ")"}]}], " ", ":>", " ", 
        RowBox[{"coords", "[", 
         RowBox[{"[", 
          RowBox[{"n", ",", "3"}], "]"}], "]"}]}]}], "\n", "\t", "}"}], " ", "/;",
      " ", 
     RowBox[{"dim", " ", ">=", " ", "2"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6130]:=",ExpressionUUID->"eb718079-61c4-4ca0-995a-7b96ba132a18"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"simplifyBadCell", "[", " ", 
   RowBox[{"head_", "[", 
    RowBox[{"x_", ",", " ", "y___"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"head", "[", "x", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"simplifyBadCell", "[", " ", "head_", " ", "]"}], " ", ":=", " ", 
  "head"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6136]:=",ExpressionUUID->"785bf8c8-60a5-44bd-a384-aea2e2c9eef1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"properCellPattern", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", "vertexPattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"Except", "[", "_List", "]"}], ",", " ", "_"}], " ", "]"}], 
     " ", "|", " ", 
     RowBox[{
      RowBox[{"(", "edgePattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], "==", "2"}]}], "&"}], ")"}]}], 
       ",", " ", "_"}], " ", "]"}], " ", "|", " ", 
     RowBox[{
      RowBox[{"(", "facePattern", ")"}], "[", " ", 
      RowBox[{
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "2"}]}], "&"}], ")"}]}], 
       " ", ",", " ", "_"}], "]"}], "|", 
     RowBox[{"(", 
      RowBox[{"anglePattern", "[", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"VectorQ", "[", "#", "]"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "==", "3"}]}], "&"}], ")"}]}],
         ",", "_"}], "]"}], ")"}], "|", 
     RowBox[{"_String", "[", 
      RowBox[{"_", ",", "_"}], "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"parseCells", "[", " ", "cells_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"parseCells", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}]}], "}"}], ",", " ", "cells"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"parseCells", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "oldcoordinates_", ",", " ", "oldcells_", " ", ",", " ", "oldlabels_"}], 
     "}"}], ",", " ", "cells_List"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
     "expandedCells", " ", ",", " ", "goodCells", ",", " ", "badCells", ",", 
      " ", "newcoordinates", " ", ",", " ", "labels", ",", " ", "newlabels", 
      ",", " ", "coordinateCells"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"expandedCells", " ", "=", " ", 
      RowBox[{"Replace", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", " ", "@", " ", 
         RowBox[{"ReplaceAll", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", " ", "@", " ", 
            RowBox[{"ReplaceRepeated", "[", " ", 
             RowBox[{
              RowBox[{"Flatten", "[", "cells", "]"}], ",", " ", 
              "distributePropertyRules"}], "]"}]}], " ", ",", " ", 
           "cellParsingExpansionRules"}], " ", "]"}]}], ",", " ", 
        "tagExpansionRules", ",", " ", "1"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"coordinateCells", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"expandedCells", " ", ",", " ", 
        RowBox[{"add", "[", 
         RowBox[{"_", ",", "_"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"goodCells", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"expandedCells", ",", " ", "properCellPattern"}], " ", "]"}]}],
      ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"if", " ", "there", " ", "are", " ", "bad", " ", "cells"}], 
       ",", " ", 
       RowBox[{"report", " ", "a", " ", "warning"}]}], "*)"}], "\n", "\t", 
     RowBox[{"badCells", " ", "=", " ", 
      RowBox[{"simplifyBadCell", " ", "/@", " ", 
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{"expandedCells", ",", " ", 
         RowBox[{"properCellPattern", "|", "_add"}]}], " ", "]"}]}]}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "badCells", "]"}], ">", "0"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"Mechanism", "::", "badcells"}], ",", " ", "badCells"}], " ",
         "]"}]}], " ", "]"}], ";", "\n", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "any", " ", "vertices", " ", "that", " ", "got", " ", "added", " ", 
       "as", " ", "cells", " ", "get", " ", "taken", " ", "care", " ", "of", 
       " ", "here"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"{", "  ", 
       RowBox[{"labels", " ", ",", " ", "newcoordinates"}], " ", "}"}], " ", 
      "=", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinateCells", "]"}], " ", ">", " ", 
         "0"}], ",", "\n", "\t\t", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"List", " ", "@@@", " ", "coordinateCells"}], "]"}], " ", 
        ",", "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"{", "}"}]}], " ", "}"}]}], "\n", "\t", "]"}]}], ";", "\n", 
     "\n", "\t", 
     RowBox[{"newlabels", " ", "=", " ", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{"oldlabels", ",", "\n", "\t\t", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"labels", " ", "\[Rule]", " ", 
          RowBox[{"Range", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "oldcoordinates", "]"}], " ", "+", " ", 
             "1"}], " ", ",", " ", 
            RowBox[{
             RowBox[{"Length", "[", "oldcoordinates", "]"}], " ", "+", " ", 
             RowBox[{"Length", "[", "newcoordinates", "]"}]}]}], " ", "]"}]}],
          " ", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{"(*", " ", 
       RowBox[{"new", " ", "coordinates"}], " ", "*)"}], "\n", "\t\t", 
      RowBox[{
       RowBox[{"ToPackedArray", " ", "@", " ", 
        RowBox[{"PadRight", "[", 
         RowBox[{"Join", "[", " ", 
          RowBox[{"oldcoordinates", ",", " ", 
           RowBox[{"newcoordinates", " ", "/.", " ", 
            RowBox[{"coordinateRules", "[", "oldcoordinates", "]"}]}]}], " ", 
          "]"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"(*", " ", "cells", " ", "*)"}], "\n", "\t\t", 
       RowBox[{"sortCellType", " ", "/@", " ", 
        RowBox[{"joinCells", "[", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"replaceCellIndices", "[", " ", 
             RowBox[{
              RowBox[{"packCells", "[", " ", "goodCells", " ", "]"}], ",", 
              " ", 
              RowBox[{"Dispatch", " ", "@", " ", "newlabels"}]}], "]"}], ",", 
            " ", "oldcells"}], " ", "}"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
       "newlabels"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6138]:=",ExpressionUUID->"3e48711c-51f0-4af3-a14f-17eb5878f2bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "badcells"}], " ", "=", " ", 
   "\"\<Cells `1` cannot be parsed and will be ignored.\>\""}], ";"}]], "Code",\

 CellLabel->
  "1/2/24 10:11:58 \
In[6141]:=",ExpressionUUID->"18f7d81c-3e4a-4d14-8b8f-8a0d0cf9a5fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"unparseCells", "[", " ", 
    RowBox[{
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
     RowBox[{"head", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{"unparseCellType", " ", "/@", " ", 
     RowBox[{"Pick", "[", " ", 
      RowBox[{"cells", ",", " ", 
       RowBox[{"Head", "/@", "cells"}], ",", " ", "head"}], " ", "]"}]}], " ",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"unparseCellType", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", " ", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"head", " ", "/@", " ", "indices"}]}], "\n", 
 RowBox[{
  RowBox[{"unparseCellType", "[", " ", 
   RowBox[{"head_", "[", " ", 
    RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}], " ", "]"}], " ",
   ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"dataRules", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", "#"}], 
         " ", "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"Transpose", "[", "data", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"head", "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{"indices", ",", " ", "dataRules"}], " ", "}"}]}], " ", "]"}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:58 \
In[6142]:=",ExpressionUUID->"e760c130-8b29-4ddc-8403-453272bb4643"]
}, Closed]],

Cell[CellGroupData[{

Cell["cellPattern[]", "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cellPattern", "[", " ", "r_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"groupedByHead", " ", "=", " ", 
       RowBox[{"GatherBy", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"recursiveCellPattern", "[", " ", "r", " ", "]"}], " ", 
          "]"}], ",", " ", "Head"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", " ", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "===", "List"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "1"}]}], ",", 
           "Alternatives", ",", " ", "Identity"}], "]"}], " ", "@@", " ", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}], "&"}], " ", 
      "/@", " ", "groupedByHead"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "None", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"{", 
   RowBox[{"None", "[", "None", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "r_Alternatives", " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"recursiveCellPattern", " ", "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "r"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"recursiveCellPattern", "[", " ", "x_Blank", " ", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", "x", "]"}], "==", "0"}]}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"_", "[", "_", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"recursiveCellPattern", "[", 
   RowBox[{
    RowBox[{"x", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "[", " ", "_", " ", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", "x_String", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"{", 
   RowBox[{"x", "[", "_", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"AnyJoint", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"recursiveCellPattern", " ", "/@", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"FreeJoint", "[", " ", "ind", " ", "]"}], ",", " ", 
     RowBox[{"PinnedJoint", "[", " ", "ind", " ", "]"}]}], "}"}]}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"head_", "[", " ", "ind_Alternatives", " ", "]"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"recursiveCellPattern", "[", " ", 
     RowBox[{"head", "[", "#", "]"}], " ", "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "ind"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"head_Alternatives", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"recursiveCellPattern", "[", " ", 
     RowBox[{"#", "[", "ind", "]"}], "]"}], "&"}], "/@", " ", 
   RowBox[{"(", 
    RowBox[{"List", "@@", "head"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{"recursiveCellPattern", "[", " ", 
   RowBox[{"head_", "[", " ", "ind_", " ", "]"}], " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"{", 
   RowBox[{"head", "[", " ", 
    RowBox[{"indexPattern", "[", " ", "ind", " ", "]"}], " ", "]"}], 
   "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"recursiveCellPattern", "[", 
    RowBox[{"patt", " ", ":", " ", "_Pattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"Mechanism", "::", "err"}], ",", " ", "patt"}], "]"}], ";", 
     " ", 
     RowBox[{"{", "}"}]}], ")"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "anything", " ", "that", " ", "cannot", " ", "be", " ", "made", " ", 
    "sense", " ", "of", " ", "as", " ", "a", " ", "pattern", " ", "for", " ", 
    "cells"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"recursiveCellPattern", "[", " ", 
    RowBox[{"head", " ", ":", " ", 
     RowBox[{"_Rule", "|", "_Symbol", "|", 
      RowBox[{"_", "?", "NumericQ"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"Mechanism", "::", "err"}], ",", " ", "head"}], "]"}], ";", 
     " ", 
     RowBox[{"{", " ", 
      RowBox[{"None", "[", "None", "]"}], " ", "}"}]}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "x_Blank", " ", "]"}], " ", ":=", " ", 
  "x"}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "r_Alternatives", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"indexPattern", " ", "/@", " ", "r"}]}], "\n", 
 RowBox[{
  RowBox[{"indexPattern", "[", " ", "n_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"numbers", " ", "=", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "n", "]"}], "]"}]}], " ", "}"}], ",", " ", 
    RowBox[{"Alternatives", " ", "@@", " ", 
     RowBox[{"Map", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"n", ",", "#"}], "]"}], "&"}], ",", " ", "numbers"}], " ", 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"indexPattern", "[", " ", 
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_Alternatives", "|", "_List"}], "]"}]}], " ", "]"}], " ", ":=",
    " ", "n"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "err"}], " ", "=", " ", 
   "\"\<`1` is not a properly formed cell pattern.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6145]:=",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
casesCellType[], selectCellType[], \
identifyCellFromList[],identifyCellFromList2[], casesCellFromDataType[], \
selectCellFromDataType[]\
\>", "Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"casesCellType", "[", " ", 
   RowBox[{"pattern_", " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"Pick", "[", " ", 
   RowBox[{
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
    RowBox[{"head", "/@", "indices"}], " ", ",", " ", 
    RowBox[{"Alternatives", " ", "@@", " ", "pattern"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"selectCellType", "[", " ", 
    RowBox[{"f_", " ", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"Pick", "[", " ", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"head", "[", "#", "]"}], "]"}], "&"}], " ", "/@", " ", 
      "indices"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"identifyCellFromList", "[", " ", 
    RowBox[{"headSpec_", " ", ",", " ", 
     RowBox[{"indexList_", "?", "VectorQ"}], " ", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{
       RowBox[{"indices_", "?", "VectorQ"}], ",", " ", "data_"}], " ", 
      "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"table", " ", "=", " ", 
        RowBox[{"Association", " ", "@@", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{"Rule", "[", 
           RowBox[{"indices", " ", ",", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], 
          " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"DeleteMissing", "[", " ", 
       RowBox[{"table", " ", "/@", " ", "indexList"}], " ", "]"}]}], "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{"MatchQ", "[", 
     RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"identifyCellFromList", "[", " ", 
   RowBox[{"headSpec_", " ", ",", " ", 
    RowBox[{"indexList", " ", ":", " ", 
     RowBox[{"{", "___List", "}"}]}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{
      RowBox[{"indices", " ", ":", " ", 
       RowBox[{"{", "___List", "}"}]}], ",", " ", "data_"}], " ", "]"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"table", " ", "=", " ", 
       RowBox[{"Association", " ", "@@", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"Rule", "[", " ", 
          RowBox[{
           RowBox[{"Sort", " ", "/@", " ", "indices"}], " ", ",", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], " ",
          "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteMissing", "[", " ", 
      RowBox[{"table", " ", "/@", " ", 
       RowBox[{"(", 
        RowBox[{"Sort", " ", "/@", " ", "indexList"}], ")"}]}], " ", "]"}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{"MatchQ", "[", 
    RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"identifyCellFromList", "[", " ", 
    RowBox[{"_", " ", ",", " ", "indexList_", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{"_", ",", " ", "_"}], " ", "]"}]}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"casesCellFromDataType", "[", " ", 
   RowBox[{
    RowBox[{"dataSpec_", " ", "\[Rule]", " ", "dataPattern_"}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"datalist", " ", "=", " ", 
      RowBox[{"dataForm", "[", "head", "]"}]}], " ", "}"}], ",", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"dataIndex", " ", "=", " ", 
        RowBox[{"dataSpec", " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"datalist", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "datalist", "]"}], "]"}]}], "]"}]}]}], " ",
        "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", " ", "\n", "\t\t", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"Normal", "@", 
            RowBox[{"data", "[", 
             RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}]}], " ", "/.", 
           " ", 
           RowBox[{"\"\<Automatic\>\"", "->", "Automatic"}]}], ",", " ", 
          "dataPattern"}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"selectCellFromDataType", "[", " ", 
   RowBox[{
    RowBox[{"dataSpec_", " ", "\[Rule]", " ", "selector_"}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"datalist", " ", "=", " ", 
      RowBox[{"dataForm", "[", "head", "]"}]}], " ", "}"}], ",", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"dataIndex", " ", "=", " ", 
        RowBox[{"dataSpec", " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"datalist", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "datalist", "]"}], "]"}]}], "]"}]}]}], " ",
        "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", " ", "\n", "\t\t", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "indices", "]"}], "]"}], ",", " ", 
          RowBox[{"selector", " ", "/@", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"data", "[", 
              RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}], " ", "/.", 
             " ", 
             RowBox[{"\"\<Automatic\>\"", "->", "Automatic"}]}], ")"}]}]}], 
         " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6162]:=",ExpressionUUID->"58cae39b-f26e-4c92-93be-35567681d0c7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"identifyCellFromList2", "[", " ", 
    RowBox[{"headSpec_", " ", ",", " ", 
     RowBox[{"indexList_", "?", "VectorQ"}], " ", ",", " ", 
     RowBox[{"head_", "[", " ", 
      RowBox[{
       RowBox[{"indices_", "?", "VectorQ"}], ",", " ", "data_"}], " ", 
      "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"table", " ", "=", " ", 
        RowBox[{"Association", " ", "@@", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{"Rule", "[", 
           RowBox[{"indices", " ", ",", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], 
          " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Pick", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "indexList", "]"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"Not", "[", 
               RowBox[{"MissingQ", "[", "#", "]"}], "]"}], "&"}], "/@", 
             "#"}]}], " ", "]"}], ",", 
          RowBox[{"DeleteMissing", "[", "#", "]"}]}], "}"}], " ", "&"}], " ", 
       "@", " ", 
       RowBox[{"(", 
        RowBox[{"table", " ", "/@", " ", "indexList"}], ")"}]}]}], "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{"MatchQ", "[", 
     RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"identifyCellFromList2", "[", " ", 
   RowBox[{"headSpec_", " ", ",", " ", 
    RowBox[{"indexList", " ", ":", " ", 
     RowBox[{"{", "___List", "}"}]}], " ", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{
      RowBox[{"indices", " ", ":", " ", 
       RowBox[{"{", "___List", "}"}]}], ",", " ", "data_"}], " ", "]"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"table", " ", "=", " ", 
       RowBox[{"Association", " ", "@@", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"Rule", "[", " ", 
          RowBox[{
           RowBox[{"Sort", " ", "/@", " ", "indices"}], " ", ",", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indices", "]"}], "]"}]}], " ", "]"}], " ",
          "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "indexList", "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Not", "[", 
              RowBox[{"MissingQ", "[", "#", "]"}], "]"}], "&"}], "/@", 
            "#"}]}], " ", "]"}], ",", 
         RowBox[{"DeleteMissing", "[", "#", "]"}]}], "}"}], " ", "&"}], " ", 
      "@", 
      RowBox[{"(", 
       RowBox[{"table", " ", "/@", " ", 
        RowBox[{"(", 
         RowBox[{"Sort", " ", "/@", " ", "indexList"}], ")"}]}], ")"}]}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{"MatchQ", "[", 
    RowBox[{"head", ",", " ", "headSpec"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"identifyCellFromList2", "[", " ", 
   RowBox[{"_", " ", ",", " ", "indexList_", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"_", ",", " ", "_"}], " ", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}]}], "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6169]:=",ExpressionUUID->"a072fd21-0967-4826-aa32-1d9266e08648"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeCells[], takeCells[]", "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"removeCells", "[", " ", 
   RowBox[{
    RowBox[{"deletedCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"remainingCells", " ", "=", " ", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", " ", 
         RowBox[{"Length", "[", "indices", "]"}], " ", "]"}], " ", ",", " ", 
        "deletedCells"}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
       "0"}], ",", "\n", "\t\t", 
      RowBox[{"{", "}"}], ",", "\n", "\t\t", 
      RowBox[{"head", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"indices", "[", 
         RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}]}], "\n", 
       "\t\t", "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6172]:=",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"takeCells", "[", " ", 
   RowBox[{
    RowBox[{"remainingCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
    RowBox[{"head_", "[", 
     RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "remainingCells", "]"}], " ", "\[Equal]", " ", 
     "0"}], ",", "\n", "\t\t", 
    RowBox[{"{", "}"}], ",", "\n", "\t\t", 
    RowBox[{"head", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"indices", "[", 
       RowBox[{"[", "remainingCells", "]"}], "]"}], ",", "\n", "\t\t\t", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", " ", "remainingCells"}], "]"}], "]"}]}], "\n", 
     "\t\t", "]"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6173]:=",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],

Cell[CellGroupData[{

Cell["changeCellDataInternal[], changeCellDataType[]", "Subsection",ExpressionUUID->"27f84a4e-e698-437b-94f5-cbe3588f169d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"data1", ",", " ", "data2", ",", " ", "..."}], "}"}], ",", 
       " ", "cells"}], " ", "]"}], " ", "replaces", " ", "the", " ", "old", 
     " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{"...", " ", "with", " ", "data1"}], ",", " ", 
    RowBox[{"...", "\n", 
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", 
       RowBox[{"{", "data", "}"}], ",", " ", "cells"}], " ", "]"}], " ", 
     "replaces", " ", "the", " ", "old", " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{"...", " ", "all", " ", "with", " ", 
     RowBox[{"data", ".", "\n", 
      RowBox[{"ChangeCellData", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"c1", ",", "c2", ",", "..."}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"head", ",", " ", "dataType"}], "}"}], ",", " ", "dataFunc", 
        ",", " ", "cells"}], " ", "]"}]}], " ", "replaces", " ", "the", " ", 
     "old", " ", "data", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "type", " ", "dataType"}], ")"}], " ", "for", " ", 
     "cells", " ", "indexed", " ", "by", " ", "c1"}], ",", " ", 
    RowBox[{
    "...", " ", "by", " ", "applying", " ", "dataFunc", " ", "to", " ", "the",
      " ", "old", " ", 
     RowBox[{"data", "."}]}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"changeCellDataInternal", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"spec", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"_", " ", ",", " ", "_"}], "}"}]}], ",", " ", 
      "specifiedData_List", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"changeCellDataType", "[", " ", 
       RowBox[{
       "changingCells", ",", " ", "spec", ",", " ", "specifiedData", ",", " ",
         "#"}], " ", "]"}], "&"}], " ", "/@", " ", "cells"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"changeCellDataType", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"headSpec_", ",", " ", "dataSpec_"}], "}"}], ",", " ", 
      "specifiedData_", " ", ",", " ", 
      RowBox[{"headSpec_", "[", " ", 
       RowBox[{"indices_", " ", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}],
     " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"length", " ", "=", " ", 
         RowBox[{"Length", "[", "indices", "]"}]}], ",", "\n", 
        RowBox[{"newData", " ", "=", " ", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"ListQ", "[", "specifiedData", "]"}], " ", "&&", " ", 
            RowBox[{
             RowBox[{"Length", "[", "specifiedData", "]"}], "\[Equal]", "1"}],
             " ", "&&", " ", 
            RowBox[{
             RowBox[{"Length", "[", "changingCells", "]"}], ">", "1"}]}], ",",
            "  ", 
           RowBox[{"(*", 
            RowBox[{
            "it", " ", "is", " ", "a", " ", "list", " ", "with", " ", "one", 
             " ", "element", " ", "but", " ", "there", " ", "are", " ", 
             "more", " ", "cells"}], "*)"}], "\n", "\t", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"specifiedData", ",", " ", 
             RowBox[{"Length", "[", "changingCells", "]"}]}], "]"}], ",", " ",
            "\n", "\t", "specifiedData"}], "\n", "\t", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"dataIndex", " ", "=", " ", 
         RowBox[{"dataSpec", " ", "/.", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"dataForm", "[", "headSpec", "]"}], " ", "\[Rule]", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"dataForm", "[", "headSpec", "]"}], "]"}], "]"}]}], 
           "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"IntegerQ", "[", "dataIndex", "]"}], ",", "\n", "\t\t", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"changedCells", " ", "=", " ", 
            RowBox[{"Select", "[", " ", 
             RowBox[{"changingCells", ",", " ", 
              RowBox[{
               RowBox[{
               "0", " ", "<", " ", "#", " ", "\[LessEqual]", " ", "length"}], 
               "&"}]}], "]"}]}], " ", 
           RowBox[{"(*", 
            RowBox[{
            "these", " ", "are", " ", "the", " ", "cells", " ", "within", " ",
              "range"}], "*)"}], "}"}], ",", "\n", "\t\t\t", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "changedCells", "]"}], ">", "0"}], ",", 
            "\n", "\t\t\t\t", 
            RowBox[{"headSpec", "[", "\n", "\t\t\t\t\t", 
             RowBox[{"indices", ",", "\n", "\t\t\t\t\t", 
              RowBox[{"ReplacePart", "[", " ", 
               RowBox[{"data", ",", " ", 
                RowBox[{"dataIndex", " ", "\[Rule]", " ", 
                 RowBox[{"changeData", "[", " ", "\n", "\t\t\t\t\t\t\t", 
                  RowBox[{"changedCells", ",", " ", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}], ",", 
                   " ", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"if", " ", "its", " ", "a", " ", "list"}], ",", 
                    " ", 
                    RowBox[{"use", " ", "it"}], ",", " ", 
                    RowBox[{"if", " ", "not", " ", "map", " ", "it"}]}], 
                    "*)"}], " ", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"ListQ", "[", "newData", "]"}], ",", " ", 
                    "newData", ",", " ", 
                    RowBox[{"newData", " ", "/@", " ", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", " ", "dataIndex", " ", "]"}], "]"}]}]}], " ",
                     "]"}]}], " ", "\n", "\t\t\t\t\t\t\t", "]"}]}]}], " ", 
               "]"}]}], "\n", "\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"headSpec", "[", " ", 
             RowBox[{"indices", ",", " ", "data"}], " ", "]"}]}], "\n", 
           "\t\t\t", "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"headSpec", "[", 
         RowBox[{"indices", ",", "data"}], "]"}]}], "\n", "\t", "]"}]}], "\n",
      "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"changeCellDataType", "[", " ", 
     RowBox[{
      RowBox[{"changingCells", " ", ":", " ", 
       RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"headSpec_", ",", " ", "dataSpec_"}], "}"}], ",", " ", 
      "newData_", " ", ",", " ", 
      RowBox[{"spec", " ", ":", " ", 
       RowBox[{"_", "[", " ", 
        RowBox[{"_", " ", ",", " ", "data_"}], " ", "]"}]}]}], " ", "]"}], 
    " ", ":=", " ", "spec"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6174]:=",ExpressionUUID->"31a72297-71f7-4b0b-a689-6535b1e08576"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cleanupData", "[", "data_List", "]"}], " ", ":=", " ", 
  RowBox[{"data", "[", 
   RowBox[{"[", 
    RowBox[{"-", "1"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cleanupData", "[", 
    RowBox[{"data", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], "]"}], ":=", " ", "data"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"changeData", "[", " ", 
    RowBox[{
     RowBox[{"changedCells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", "data_SparseArray", ",", 
     " ", "newdata_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"processedData", " ", "=", " ", 
        RowBox[{
         RowBox[{"cleanupData", "/@", "newdata"}], " ", "/.", " ", 
         RowBox[{"Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
       ",", "\n", "\t", 
       RowBox[{"processedIndices", " ", "=", " ", 
        RowBox[{"List", " ", "/@", " ", "changedCells"}]}], ",", "\n", "\t", 
       "newRules"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newRules", " ", "=", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{"processedIndices", " ", "\[Rule]", " ", "processedData"}], 
        " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"SparseArray", "[", " ", 
       RowBox[{
        RowBox[{"Join", "[", " ", 
         RowBox[{"newRules", " ", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"ArrayRules", "[", " ", "data", " ", "]"}], ",", " ", 
            RowBox[{"Except", "[", "newRules", "]"}]}], "]"}]}], " ", "]"}], 
        " ", ",", " ", 
        RowBox[{"Length", "[", " ", "data", " ", "]"}]}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"changeData", "[", " ", 
    RowBox[{
     RowBox[{"changedCells", " ", ":", " ", 
      RowBox[{"{", "___Integer", "}"}]}], ",", " ", 
     RowBox[{"data", " ", ":", " ", 
      RowBox[{"{", "__List", "}"}]}], ",", " ", "newdata_"}], " ", "]"}], " ",
    ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"processedData", " ", "=", " ", 
        RowBox[{"ArrayRules", "[", " ", 
         RowBox[{"\"\<data\>\"", " ", "/@", " ", "data"}], " ", "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"processedIndices", " ", "=", " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", " ", "/@", " ", "changedCells"}], ")"}], " ", 
          "\[Rule]", " ", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<data\>\"", "[", 
              RowBox[{"mergeDataList", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}], "]"}], "&"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"data", "[", 
               RowBox[{"[", " ", "changedCells", " ", "]"}], "]"}], ",", " ", 
              
              RowBox[{"newdata", " ", "/.", " ", 
               RowBox[{
               "Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
             "}"}]}], " ", "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Normal", "[", " ", 
       RowBox[{"SparseArray", "[", " ", 
        RowBox[{
         RowBox[{"Join", "[", " ", 
          RowBox[{"processedIndices", ",", " ", "processedData"}], "]"}], " ",
          ",", " ", 
         RowBox[{"Length", "[", "data", "]"}]}], " ", "]"}], " ", "]"}], "[", 
      
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"changeData", "[", " ", 
   RowBox[{
    RowBox[{"changedCells", " ", ":", " ", 
     RowBox[{"{", "___Integer", "}"}]}], ",", " ", "data_List", ",", " ", 
    "newdata_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"processedData", " ", "=", " ", 
       RowBox[{"ArrayRules", "[", " ", 
        RowBox[{"\"\<data\>\"", " ", "/@", " ", "data"}], " ", "]"}]}], ",", 
      "\n", "\t", 
      RowBox[{"processedIndices", " ", "=", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"List", " ", "/@", " ", "changedCells"}], ")"}], " ", 
         "\[Rule]", " ", 
         RowBox[{"MapThread", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"\"\<data\>\"", "[", "#2", "]"}], "&"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"data", "[", 
              RowBox[{"[", " ", "changedCells", " ", "]"}], "]"}], ",", " ", 
             RowBox[{"newdata", " ", "/.", " ", 
              RowBox[{
              "Automatic", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}]}], 
            "}"}]}], " ", "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"Normal", "[", " ", 
      RowBox[{"SparseArray", "[", " ", 
       RowBox[{
        RowBox[{"Join", "[", " ", 
         RowBox[{"processedIndices", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{"processedData", ",", " ", 
            RowBox[{"Except", "[", "processedIndices", "]"}]}], "]"}]}], 
         "]"}], " ", ",", " ", 
        RowBox[{"Length", "[", "data", "]"}]}], " ", "]"}], " ", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "Code",\

 CellLabel->
  "1/2/24 10:11:59 \
In[6177]:=",ExpressionUUID->"3302b513-e9fe-45e5-b7f9-d675ecefb2c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mergeDataList", "[", " ", 
   RowBox[{"data1_", " ", ",", " ", "data2_"}], "  ", "]"}], " ", ":=", " ", 
  RowBox[{"Last", " ", "/@", " ", 
   RowBox[{"GatherBy", "[", " ", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"data1", ",", " ", "data2"}], "}"}], " ", "]"}], ",", " ", 
     "directiveQ"}], " ", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6182]:=",ExpressionUUID->"2b8c3df9-7cd3-41f4-b20d-28cb2d4c46bc"]
}, Closed]],

Cell[CellGroupData[{

Cell["mapCellsInternal[], replaceCellsInternal[]", "Subsection",ExpressionUUID->"5a94c171-934c-4d12-ad62-4dfa84b8a359"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mapCellsInternal", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"mapCellType", "[", 
     RowBox[{"f", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
   "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"mapCellType", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"celltype", " ", ":", " ", 
     RowBox[{"_", "[", 
      RowBox[{"_", ",", "_"}], "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"parseCells", "[", " ", 
    RowBox[{"f", " ", "/@", " ", 
     RowBox[{"unparseCells", "[", "celltype", "]"}]}], " ", "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6183]:=",ExpressionUUID->"0e91cd52-98a9-4991-bd33-c8a77649afb7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"replaceCellsInternal", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"replaceCellTypeInternal", "[", 
     RowBox[{"f", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
   "cells"}]}], "\n", 
 RowBox[{
  RowBox[{"replaceCellTypeInternal", "[", " ", 
   RowBox[{"f_", ",", " ", 
    RowBox[{"celltype", " ", ":", " ", 
     RowBox[{"_", "[", 
      RowBox[{"_", ",", "_"}], "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"parseCells", "[", " ", 
    RowBox[{
     RowBox[{"unparseCells", "[", "celltype", "]"}], " ", "/.", " ", "f"}], 
    " ", "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6185]:=",ExpressionUUID->"6bcdd31a-8086-490f-9f4e-e4b06ce350fd"]
}, Closed]],

Cell[CellGroupData[{

Cell["outputCells[]", "Subsection",ExpressionUUID->"b05847f7-0cfe-43d6-88c4-014ef3ddb0dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "formatting", " ", "outputted", " ", "lists", " ", "of", " ", "cells"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$cellOutputFormats", "=", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Threaded\>\"", ",", "\"\<Unthreaded\>\"", ",", " ", 
       "\"\<Index\>\""}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"validOutputFormatQ", "[", "data_", "]"}], " ", ":=", " ", 
    RowBox[{"MatchQ", "[", 
     RowBox[{"data", ",", " ", 
      RowBox[{"Alternatives", " ", "@@", " ", "$cellOutputFormats"}]}], 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"outputCells", "[", " ", 
     RowBox[{"pattern_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"outputCellType", "[", 
       RowBox[{"\"\<Threaded\>\"", ",", " ", "pattern", ",", " ", "#"}], 
       "]"}], "&"}], " ", "/@", " ", "cells"}]}], "\n", 
   RowBox[{
    RowBox[{"outputCells", "[", " ", 
     RowBox[{"outputFormat_", " ", ",", " ", "pattern_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}]}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"outputCellType", "[", 
       RowBox[{"outputFormat", ",", " ", "pattern", ",", " ", "#"}], "]"}], 
      "&"}], " ", "/@", " ", "cells"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "there", " ", "is", " ", "no", " ", "data", " ", "to", " ", "display"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"outputCellType", "[", " ", 
     RowBox[{"_", ",", " ", "_", ",", " ", 
      RowBox[{"head_", "[", 
       RowBox[{"indices_", ",", 
        RowBox[{"{", "}"}]}], "]"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"head", "[", "indices", "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{"matches", " ", "no", " ", "data"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"outputCellType", "[", " ", 
     RowBox[{"_", ",", " ", "None", ",", " ", 
      RowBox[{"head_", "[", 
       RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"head", "[", "indices", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"just", " ", "output", " ", "the", " ", "indices"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"outputCellType", "[", " ", 
     RowBox[{"\"\<Index\>\"", ",", " ", "_", " ", ",", " ", 
      RowBox[{"head_", "[", 
       RowBox[{"indices_", ",", "data_"}], "]"}]}], "]"}], " ", ":=", " ", 
    "indices"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "only", " ", "output", " ", "data", " ", "that", " ", "matches", " ", "a",
      " ", "particular", " ", "pattern"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"outputCellType", "[", " ", 
     RowBox[{"\"\<Unthreaded\>\"", ",", " ", "pattern_", ",", " ", 
      RowBox[{"head_", "[", 
       RowBox[{"indices_", ",", "data_"}], "]"}]}], " ", "]"}], " ", ":=", 
    " ", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"head", "[", "indices", "]"}], " ", "->", " ", 
      RowBox[{"FilterRules", "[", " ", 
       RowBox[{
        RowBox[{"Thread", "[", " ", 
         RowBox[{
          RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", 
          RowBox[{"Normal", "[", "data", "]"}]}], " ", "]"}], ",", " ", 
        "pattern"}], "]"}]}], " ", "/.", " ", 
     RowBox[{"\"\<Automatic\>\"", " ", "->", " ", "Automatic"}]}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"outputCellType", "[", " ", 
     RowBox[{"_", ",", " ", "pattern_", ",", " ", 
      RowBox[{"head_", "[", 
       RowBox[{"indices_", ",", " ", "data_"}], "]"}]}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"(*", 
     RowBox[{"this", " ", "is", " ", "the", " ", 
      RowBox[{"default", " ", "--"}], " ", "\"\<Threaded\>\""}], "*)"}], "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"dataRules", " ", "=", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"Thread", " ", "/@", " ", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"Thread", "[", " ", 
              RowBox[{
               RowBox[{"dataForm", "[", "head", "]"}], " ", "\[Rule]", " ", 
               "data"}], " ", "]"}], ",", " ", "pattern"}], "]"}]}], " ", 
          "]"}], " ", "/.", " ", 
         RowBox[{"\"\<Automatic\>\"", "\[Rule]", "Automatic"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"head", "[", "indices", "]"}], " ", "\[Rule]", " ", 
       "dataRules"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6187]:=",ExpressionUUID->"3e3005a5-6c98-4e26-bd10-dad515d4dea7"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["private functions to manipulate and create mechanisms", "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],

Cell[CellGroupData[{

Cell["replaceRules[]", "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"{", "}"}], ",", " ", "appliedRules__"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules_", ",", " ", "appliedRules_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{"rules", ",", " ", "appliedRules", ",", " ", "1"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"replaceRules", "[", " ", 
    RowBox[{
     RowBox[{"rules", " ", ":", " ", 
      RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
     "1"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"flippedRules", " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Rule", " ", "@@@", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Replace", "[", " ", 
          RowBox[{
           RowBox[{"flippedRules", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "appliedRules", 
           ",", " ", 
           RowBox[{"{", "1", "}"}]}], " ", "]"}], ",", " ", 
         RowBox[{"flippedRules", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"replaceRules", "[", " ", 
   RowBox[{
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", "__Rule", "}"}]}], ",", " ", "appliedRules_", ",", " ", 
    "2"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"flippedRules", " ", "=", " ", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"List", " ", "@@@", " ", "rules"}], " ", "]"}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"Rule", " ", "@@@", " ", 
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flippedRules", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"Replace", "[", " ", 
         RowBox[{
          RowBox[{"flippedRules", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "appliedRules", ",",
           " ", 
          RowBox[{"{", "1", "}"}]}], " ", "]"}]}], " ", "}"}], " ", "]"}]}]}],
    "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6196]:=",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]],

Cell[CellGroupData[{

Cell["removeOverlappingCoordinates[]", "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"removeOverlappingCoordinates", "[", " ", 
    RowBox[{
     RowBox[{"head_", "[", 
      RowBox[{
      "coordinateList_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
       "labels_", ",", " ", "rest_"}], "]"}], ",", " ", 
     RowBox[{"None", "|", "0"}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{"head", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "coordinateList", "]"}], ",", "\n", "\t\t",
      "mr", ",", "\n", "\t\t", 
     RowBox[{"deleteDuplicateCells", " ", "@", " ", "cells"}], ",", "\n", 
     "\t\t", "labels", ",", "\n", "\t\t", "rest"}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"removeOverlappingCoordinates", "[", " ", 
   RowBox[{
    RowBox[{"head_", "[", 
     RowBox[{
     "coordinateList_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", 
      "labels_", " ", ",", " ", "rest_"}], "]"}], ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"N", "[", "#", "]"}], "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ">", "0"}]}], " ", "&"}], ")"}]}], 
     " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "12"}], ")"}]}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"numberedVertices", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"Range", " ", "@", " ", 
           RowBox[{"Length", " ", "@", " ", "coordinateList"}]}], ",", " ", 
          "coordinateList"}], " ", "}"}], "]"}]}], ",", "\n", "\t", 
      "gatheredVertices", ",", "rules"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"gatheredVertices", "=", 
      RowBox[{"GatherBy", "[", "\n", "\t\t", 
       RowBox[{"numberedVertices", ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "they", " ", "are", " ", "the", " ", "same", " ", "if", " ", "they", 
          " ", "are", " ", "the", " ", "same", " ", "within", " ", "the", " ",
           "specified", " ", 
          RowBox[{"precision", "."}]}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"Rationalize", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", "precision"}], 
          "]"}], "&"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
     RowBox[{"rules", "=", 
      RowBox[{"Dispatch", " ", "@", " ", 
       RowBox[{"Flatten", "[", " ", 
        RowBox[{"(*", 
         RowBox[{
         "two", " ", "levels", " ", "to", " ", "thread", " ", "through"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"Thread", " ", "/@", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"gatheredVertices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "gatheredVertices", "]"}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", "]"}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"head", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"ToPackedArray", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
         "gatheredVertices"}], "]"}], ",", "\n", "\t\t", "mr", ",", "\n", 
       "\t\t", 
       RowBox[{"deleteDuplicateCells", " ", "@", " ", 
        RowBox[{"replaceCellIndices", "[", 
         RowBox[{"cells", ",", "rules"}], "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"replaceRules", "[", " ", 
        RowBox[{"labels", ",", " ", "rules", ",", " ", "2"}], " ", "]"}], ",",
        "\n", "\t\t", 
       RowBox[{"rest", " ", "/.", " ", "rules"}]}], "\n", "\t", "]"}]}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6200]:=",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteDegenerateCellsFromMechanism[]", "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
   RowBox[{"head_", "[", 
    RowBox[{
    "coordinates_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", "labels_", 
     ",", " ", "rest_"}], "]"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"head", "[", " ", 
   RowBox[{"coordinates", ",", " ", "mr", ",", " ", 
    RowBox[{"deleteDegenerateCells", "[", "cells", "]"}], ",", " ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Reverse", "[", "labels", "]"}], "]"}], ",", " ", "rest"}], 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6202]:=",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],

Cell[CellGroupData[{

Cell["deleteImpossibleCellsFromMechanism[]", "Subsection",ExpressionUUID->"b98e9445-2688-44f9-90fe-c61b41d2cefa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deleteImpossibleCellsFromMechanism", "[", " ", 
   RowBox[{"head_", "[", 
    RowBox[{
    "coordinates_", ",", " ", "mr_", ",", " ", "cells_", ",", " ", "labels_", 
     ",", " ", "rest_"}], "]"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"splitCells", " ", "=", " ", 
      RowBox[{"deleteOutOfRangeCells", "[", " ", 
       RowBox[{
        RowBox[{"Length", "[", "coordinates", "]"}], ",", " ", "cells"}], 
       "]"}]}], "}"}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"splitCells", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ">", "0"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"Mechanism", "::", "badcells"}], ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"splitCells", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], " ", "]"}]}], "]"}], ";", 
     "\n", "\t\t", 
     RowBox[{"head", "[", " ", 
      RowBox[{"coordinates", ",", " ", "mr", ",", " ", 
       RowBox[{"splitCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "labels", ",", " ", 
       "rest"}], " ", "]"}]}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6203]:=",ExpressionUUID->"bcdc8d0f-6f6b-4412-aed1-a015394185f5"]
}, Closed]],

Cell[CellGroupData[{

Cell["missingVertices[]", "Subsection",ExpressionUUID->"f40fca3b-5ac3-45df-9833-1ec262db5844"],

Cell[BoxData[
 RowBox[{
  RowBox[{"missingVertices", "[", " ", 
   RowBox[{"numberOfVertices_", " ", ",", " ", "cells_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"freeJoints", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{"cells", ",", " ", 
        RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], " ", "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", " ", "freeJoints", " ", "]"}], " ", "\[Equal]", 
       " ", "0"}], ",", " ", "\n", "\t\t", 
      RowBox[{"Range", "[", "numberOfVertices", "]"}], ",", "\n", "\t\t", 
      RowBox[{"Complement", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", "numberOfVertices", "]"}], ",", " ", 
        RowBox[{"Flatten", "[", " ", 
         RowBox[{"freeJoints", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}]}], " ", 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6204]:=",ExpressionUUID->"89ea601f-aa9b-4950-84c3-22eafdcf6db0"]
}, Closed]],

Cell[CellGroupData[{

Cell["addMeshRegion[], createMeshRegion[]", "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"choose", " ", "your", " ", "own", " ", "dimension"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", 
       RowBox[{
        RowBox[{"coordinates_", "?", "MatrixQ"}], " ", ",", " ", "_", " ", 
        ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
        "labels_", " ", ",", " ", "rest_"}], "]"}], ",", " ", "Automatic", 
      ",", " ", "options_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"chooseDimension", "[", " ", 
         RowBox[{"head", ",", " ", "coordinates"}], " ", "]"}]}], " ", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"head", "[", "\n", "\t\t", 
       RowBox[{"coordinates", " ", ",", " ", "\n", "\t\t", 
        RowBox[{"createMeshRegion", "[", " ", 
         RowBox[{"head", ",", " ", 
          RowBox[{"PadRight", "[", " ", 
           RowBox[{"coordinates", ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
              "dim"}], "}"}]}], " ", "]"}], ",", " ", "cells", " ", ",", " ", 
          "options", ",", " ", "labels", ",", " ", "rest"}], "]"}], ",", " ", 
        "\n", "\t\t", "cells", ",", "\n", "\t\t", "labels", ",", "\n", "\t\t",
         "rest"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", 
       RowBox[{
        RowBox[{"coordinates_", "?", "MatrixQ"}], " ", ",", " ", "_", " ", 
        ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], " ", ",", " ", 
        "labels_", ",", " ", "rest_"}], " ", "]"}], ",", " ", "dimSpec_", ",",
       " ", "options_"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"head", "[", "\n", "\t\t", 
     RowBox[{"coordinates", " ", ",", "\n", "\t\t", 
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"head", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], ",", " ", 
            "dimSpec"}], "}"}]}], " ", "]"}], ",", " ", "cells", " ", ",", 
        " ", "options", ",", " ", "labels", ",", " ", "rest"}], "]"}], ",", 
      " ", "\n", "\t\t", "cells", ",", " ", "\n", "\t\t", "labels", ",", "\n",
       "\t\t", "rest"}], "\n", "\t", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"addMeshRegion", "[", " ", 
     RowBox[{"x_", ",", " ", "__"}], " ", "]"}], " ", ":=", " ", "x"}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"chooseDimension", "[", " ", 
     RowBox[{"Origami", ",", " ", "coordinates_"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", ".", " ", 
         RowBox[{"coordinates", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}]}], " ", "<", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], ",", " ", "2", ",", " ", "3"}], " ",
       "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", " ", 
       RowBox[{"coordinates", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "\[Equal]", " ", 
      "3"}]}]}], "\n", 
   RowBox[{
    RowBox[{"chooseDimension", "[", " ", 
     RowBox[{"head_", ",", " ", "coordinates_"}], " ", "]"}], " ", ":=", " ", 
    
    RowBox[{"Length", "[", " ", 
     RowBox[{"coordinates", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6205]:=",ExpressionUUID->"2fd91df5-6766-4d60-a3c7-53d9a52d7b96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"stripTextWrapper", "[", "labels_", "]"}], " ", ":=", " ", 
   RowBox[{"ReplaceAll", "[", " ", 
    RowBox[{"labels", " ", ",", " ", 
     RowBox[{
      RowBox[{"Text", "[", 
       RowBox[{"x_", ",", "___"}], "]"}], " ", ":>", " ", "x"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"createMeshRegion", "[", " ", 
   RowBox[{"head_", ",", " ", 
    RowBox[{"coordinates_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
    
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
    "options_", " ", ",", " ", 
    RowBox[{"labels_", " ", ":", " ", 
     RowBox[{"{", "}"}]}], ",", " ", 
    RowBox[{"rest_", " ", ":", " ", 
     RowBox[{"{", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", " ", 
     RowBox[{"displayCells", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"toDisplayCells", "[", 
         RowBox[{"head", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
       "cells"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"MeshRegion", "[", " ", 
     RowBox[{"coordinates", " ", ",", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"displayCells", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", "\n", 
      "\t\t", 
      RowBox[{"Flatten", " ", "@", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"MeshCellLabel", " ", "\[Rule]", "  ", 
           RowBox[{"Join", "[", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Point", "[", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "->", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "&"}], " ", "/@", " ", 
               "labels"}], ","}], "*)"}], " ", 
            RowBox[{"stripTextWrapper", "[", " ", 
             RowBox[{"Flatten", "[", " ", 
              RowBox[{
               RowBox[{"displayCells", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "4"}], "]"}], "]"}], " ", ",", " ", 
               "1"}], " ", "]"}], " ", "]"}], "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"MeshCellStyle", " ", "\[Rule]", "  ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"displayCells", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", ",", " ", "1"}], 
            " ", "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"MeshCellShapeFunction", " ", "\[Rule]", "  ", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{
             RowBox[{"displayCells", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", ",", " ", "1"}], 
            " ", "]"}]}], ",", "\n", "\t\t", 
          RowBox[{"Method", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CoplanarityTolerance", "->", "100"}], ",", " ", 
             RowBox[{"DeleteDuplicateCoordinates", "->", "False"}]}], "}"}]}],
           ",", "\n", "\t\t", "options"}], "\n", "\t\t", "}"}], "]"}]}]}], 
     "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"createMeshRegion", "[", " ", 
   RowBox[{"head_", ",", " ", "coordinates_", " ", ",", " ", 
    RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
    "options__"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6210]:=",ExpressionUUID->"3ccd1308-4b25-462c-bf14-ca7dea82c5fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Spring", "|", "TorsionalFold"}], ",", " ", 
    "_"}], " ", "]"}], " ", ":=", " ", "Line"}], "\n", 
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", " ", "|", " ", "PinnedJoint"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", "Point"}], "\n", 
 RowBox[{
  RowBox[{"cellMeshPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", "Polygon"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellMeshPrimitive", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", "None"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"toDisplayCells", "[", 
   RowBox[{"mechType_", ",", " ", 
    RowBox[{"head_", "[", " ", 
     RowBox[{"indices_", ",", " ", "data_"}], " ", "]"}]}], " ", "]"}], ":=", 
  "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"dataLocations", " ", "=", " ", 
       RowBox[{"PositionIndex", "[", 
        RowBox[{"dataForm", "[", "head", "]"}], "]"}]}], " ", ",", " ", "\n", 
      
      RowBox[{"primitive", " ", "=", " ", 
       RowBox[{"cellMeshPrimitive", "[", " ", 
        RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}], ",", " ", 
      "primitives"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"primitive", " ", "=!=", " ", "None"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"primitives", " ", "=", " ", 
        RowBox[{"primitive", " ", "/@", " ", "indices"}]}], ";", "\n", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{"primitives", ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellStyle", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Style\>\"", "]"}]}], " ", "]"}],
          ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellShapeFunction", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Shape\>\"", "]"}]}], " ", "]"}],
          ",", "\n", "\t\t\t", 
         RowBox[{"toMeshCellLabel", "[", " ", 
          RowBox[{
          "mechType", ",", " ", "head", ",", " ", "primitives", ",", " ", 
           "data", " ", ",", " ", 
           RowBox[{"dataLocations", "[", "\"\<Label\>\"", "]"}]}], " ", 
          "]"}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t\t", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "}"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6213]:=",ExpressionUUID->"64b7b531-8b24-4dab-9ace-34e5f065c8da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "TorsionalFold"}], ",", " ", "_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"CapForm", "[", "\"\<Round\>\"", "]"}], ",", "Black"}], 
   "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"Spring", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", " ", "|", " ", "PinnedJoint"}], " ", ",", "_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"Face", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"GrayLevel", "[", "0.85", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshStyle", "[", " ", 
   RowBox[{"ElasticTriangle", " ", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"{", 
     RowBox[{"0.85", ",", "0.85", ",", "0.95"}], "}"}], "]"}], "}"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"defaultMeshStyle", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"toMeshCellStyle", "[", " ", 
   RowBox[{
   "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", " ",
     ",", " ", 
    RowBox[{"{", "index_", "}"}]}], "]"}], ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"styles", " ", "=", " ", 
       RowBox[{"data", "[", 
        RowBox[{"[", " ", "index", " ", "]"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"defaultStyle", " ", "=", " ", 
       RowBox[{"defaultMeshStyle", "[", " ", 
        RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}]}], "\n", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", "\[Rule]", " ", 
          RowBox[{"Directive", "@@", 
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"{", 
             RowBox[{"defaultStyle", " ", ",", " ", "#2"}], "}"}], " ", 
            "]"}]}]}], "&"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{"prims", ",", " ", "styles"}], "}"}]}], " ", "]"}], " ", ",",
       " ", 
      RowBox[{"_", " ", "\[Rule]", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "0"}], "&"}], 
         ")"}]}]}]}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6218]:=",ExpressionUUID->"c2262ab8-69cd-440e-b350-a060080f50e2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toMeshCellLabel", "[", " ", 
   RowBox[{
   "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", ",",
     " ", 
    RowBox[{"{", "index_", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"labels", " ", "=", " ", 
      RowBox[{"data", "[", 
       RowBox[{"[", " ", "index", " ", "]"}], "]"}]}], "\n", "}"}], ",", "\n",
     "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"Thread", "[", 
       RowBox[{"prims", " ", "\[Rule]", " ", "labels"}], "]"}], " ", ",", " ", 
      RowBox[{"_", " ", "\[Rule]", " ", "None"}]}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6225]:=",ExpressionUUID->"2e1f31ff-6557-4fb9-aaa5-ab2f5e0c76c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultMeshShapeFunction", "[", " ", 
   RowBox[{"Spring", " ", ",", " ", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Mechanisms`graphics`SpringShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultMeshShapeFunction", "[", " ", 
   RowBox[{"PinnedJoint", " ", ",", " ", "Linkage"}], "]"}], " ", ":=", " ", 
  RowBox[{"Mechanisms`graphics`PinnedJointShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultMeshShapeFunction", "[", " ", 
    RowBox[{"_", " ", ",", "_"}], "]"}], " ", ":=", " ", 
   "\"\<Automatic\>\""}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toMeshCellShapeFunction", "[", " ", 
    RowBox[{
    "mechType_", ",", " ", "head_", ",", " ", "prims_", ",", " ", "data_", 
     ",", " ", 
     RowBox[{"{", "index_", "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"labels", " ", "=", " ", 
       RowBox[{
        RowBox[{"Normal", "[", 
         RowBox[{"data", "[", 
          RowBox[{"[", " ", "index", " ", "]"}], "]"}], "]"}], " ", "/.", " ", 
        RowBox[{"\"\<Automatic\>\"", " ", "\[Rule]", " ", 
         RowBox[{"defaultMeshShapeFunction", "[", " ", 
          RowBox[{"head", ",", " ", "mechType"}], " ", "]"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"cleanupShapeFunction", " ", "/@", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{"prims", " ", "\[Rule]", " ", "labels"}], "]"}], " ", ",", 
        " ", 
        RowBox[{"_", " ", "\[Rule]", " ", "\"\<Automatic\>\""}]}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{"cell_", " ", "\[Rule]", " ", "None"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"cell", " ", "\[Rule]", " ", "None"}]}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{
    RowBox[{"rule", " ", ":", " ", "_"}], " ", "\[Rule]", " ", "_Function"}], 
   " ", "]"}], " ", ":=", " ", "rule"}], "\n", 
 RowBox[{
  RowBox[{"cleanupShapeFunction", "[", " ", 
   RowBox[{"cell_", " ", "\[Rule]", " ", "shape_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"cell", " ", "\[Rule]", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"shape", "[", 
      RowBox[{"#1", ",", "#3", ",", 
       RowBox[{"#2", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ")"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6226]:=",ExpressionUUID->"380d18c6-2716-430c-9643-2330072de554"]
}, Closed]],

Cell[CellGroupData[{

Cell["general error messages", "Subsection",ExpressionUUID->"f146e525-42d8-479e-959e-c8fb6ca1c4a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "meshfail"}], "=", 
   "\"\<`1` has non-numeric coordinates.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6233]:=",ExpressionUUID->"73ad2a29-7f03-4219-8663-461f9518a7f6"]
}, Closed]],

Cell[CellGroupData[{

Cell["inputForm[]", "Subsection",ExpressionUUID->"6c3ece17-d7ac-4107-85ef-f431e4a44d87"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"inputForm", "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"graphicsRules", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Shape\>\"", "->", "Automatic"}], ",", " ", 
          RowBox[{"\"\<Style\>\"", "->", 
           RowBox[{"{", "}"}]}], ",", " ", 
          RowBox[{"\"\<Label\>\"", "->", "None"}]}], "}"}]}], ",", "\n", "\t", 
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"cleanupInputFormCells", " ", "/@", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"unparseCellType", " ", "/@", " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ")"}], " ", "/.", " ", 
           RowBox[{"\"\<Automatic\>\"", " ", "->", " ", "Automatic"}]}], 
          "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"SequenceForm", "[", "Linkage", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"MechanismPositions", "[", "m", "]"}], " ", ",", " ", 
       RowBox[{"groupAllCells", "[", " ", "cells", " ", "]"}]}], " ", "]"}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cleanupInputFormCells", "[", 
   RowBox[{"cell_", "[", "indices_", "]"}], "]"}], ":=", 
  RowBox[{"cell", "[", "indices", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cleanupInputFormCells", "[", " ", 
    RowBox[{"cell_", "[", 
     RowBox[{"indices_", ",", " ", "properties_"}], "]"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"defaultProperties", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"DefaultCellProperties", "[", "cell", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<Shape\>\"", "\[Rule]", "Automatic"}], ",", 
           RowBox[{"\"\<Label\>\"", "\[Rule]", "None"}], ",", 
           RowBox[{"\"\<Style\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}]}], "}"}]}], "]"}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"cell", "[", " ", 
       RowBox[{"indices", ",", " ", 
        RowBox[{"Sort", "[", " ", 
         RowBox[{"Select", "[", " ", 
          RowBox[{"properties", " ", ",", " ", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"MemberQ", "[", 
              RowBox[{"defaultProperties", ",", " ", "#"}], "]"}], "]"}], 
            "&"}]}], " ", "]"}], " ", "]"}]}], " ", "]"}], "  ", "/.", " ", 
      RowBox[{
       RowBox[{"c_", "[", 
        RowBox[{"n_", ",", 
         RowBox[{"{", "}"}]}], "]"}], " ", "->", " ", 
       RowBox[{"c", "[", "n", "]"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"groupAllCells", "[", " ", "cells_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Flatten", "[", 
   RowBox[{"groupCellsOfOneType", " ", "/@", " ", 
    RowBox[{"GatherBy", "[", " ", 
     RowBox[{"cells", " ", ",", " ", "Head"}], " ", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"groupCellsOfOneType", "[", " ", "cells_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"groupIdenticalCells", " ", "/@", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"GatherBy", "[", 
        RowBox[{"#", ",", " ", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
            RowBox[{"Last", "[", "#", "]"}], ",", " ", "0"}], "]"}], "&"}]}], 
        "]"}], "&"}], " ", "/@", " ", 
      RowBox[{"GatherBy", "[", " ", 
       RowBox[{"cells", " ", ",", " ", "Length"}], " ", "]"}]}], ",", " ", 
     "1"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"groupIdenticalCells", "[", " ", "cells_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"cells", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", "1"}], ",", " ", 
    RowBox[{
     RowBox[{"Head", "[", 
      RowBox[{"cells", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
     RowBox[{
      RowBox[{"cells", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"cells", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "]"}], ",", " ", 
    RowBox[{
     RowBox[{"Head", "[", 
      RowBox[{"cells", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
     RowBox[{"cells", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6234]:=",ExpressionUUID->"97c75c77-112c-4a86-9062-c60ce5e5fc97"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["functions to define and extract information from Mechanisms", "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],

Cell[CellGroupData[{

Cell["Linkage[]", "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],

Cell[CellGroupData[{

Cell["Linkage[] creator", "Subsubsection",ExpressionUUID->"27f30170-2c57-446e-aa9f-6b16083c0b48"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "Linkage", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Linkage", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
        "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
        "_Association"}], "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"meshOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", " ", 
         RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"deleteImpossibleCellsFromMechanism", " ", "@", " ", 
        RowBox[{"deleteDegenerateCellsFromMechanism", " ", "@", " ", 
         RowBox[{"removeOverlappingCoordinates", "[", " ", 
          RowBox[{"f", ",", " ", 
           RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], " ", 
          "]"}]}]}], ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t", 
       "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{"coordinateSpec_", ",", " ", "cellSpec_", " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"meshOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
        "\n", 
        RowBox[{"intermediateParsing", " ", "=", " ", 
         RowBox[{"parseCells", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"coordinateSpec", ",", " ", 
             RowBox[{"{", "}"}], ",", " ", 
             RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
           RowBox[{"{", "cellSpec", "}"}]}], " ", "]"}]}], ",", "\n", 
        "numberOfCoordinates", ",", " ", "coordinates", ",", " ", "cells", 
        ",", " ", "labels"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"numberOfCoordinates", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"intermediateParsing", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"coordinates", ",", " ", "cells", ",", " ", "labels"}], 
         "}"}], " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{"intermediateParsing", ",", " ", 
          RowBox[{"FreeJoint", " ", "/@", " ", 
           RowBox[{"missingVertices", "[", 
            RowBox[{"numberOfCoordinates", ",", " ", 
             RowBox[{"intermediateParsing", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], " ", "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"deleteImpossibleCellsFromMechanism", " ", "@", " ", 
          RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
           RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"Linkage", "[", " ", 
              RowBox[{"coordinates", ",", " ", 
               RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels", ",",
                " ", 
               RowBox[{"<|", "|>"}]}], " ", "]"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
            "\t\t\t", "]"}], "\n", "\t\t", "]"}]}], ",", "\n", "\t\t", 
         "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"LinkagePrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", " ", "OverlapPrecision", " ", "]"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "precision"}], " ", "=", " ", 
   "\"\<Precision `1` must be a non-negative number or None.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", 
   RowBox[{"None", "|", "0"}], " ", "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", 
   RowBox[{"prec_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], " ", ":=", 
  " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"LinkagePrecisionQ", "[", " ", "prec_", " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"Mechanism", "::", "precision"}], ",", " ", "prec"}], "]"}], 
    ";", " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6240]:=",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Linkage methods", "Subsubsection",ExpressionUUID->"59b46ba1-859a-4be3-8bfa-6e13247a7eda"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], " ", ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern", ",", " ", "_Association"}], " ", "]"}], "[", 
    "\"\<Methods\>\"", "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<MechanismType\>\"", ",", "\n", "\t", "\"\<VertexCoordinates\>\"", 
     ",", " ", "\n", "\t", "\"\<MeshRegion\>\"", ",", " ", "\n", "\t", 
     "\"\<Cells\>\"", ",", " ", "\n", "\t", "\"\<labels\>\"", ",", "\n", 
     "\t", "\"\<LabeledVertices\>\"", ",", " ", "\n", "\t", 
     "\"\<EmbeddingDimension\>\"", ",", " ", "\n", "\t", 
     "\"\<DisplayDimension\>\"", ",", "\n", "\t", "\"\<VertexCount\>\"", ",", 
     "\n", "\t", "\"\<EdgeRules\>\"", ",", "\"\<FaceRules\>\"", ",", "\n", 
     "\t", "\"\<edges\>\"", ",", "\n", "\t", "\"\<faces\>\""}], "\n", "\t", 
    "}"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"direct", " ", "accessors", " ", "of", " ", "the", " ", "data"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern", ",", " ", 
     "_Association"}], " ", "]"}], "[", "\"\<MechanismType\>\"", "]"}], " ", ":=",
   " ", "Linkage"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], " ", "]"}], "[", "\"\<VertexCoordinates\>\"", "]"}], 
  " ", ":=", " ", "coordinates"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
   "\"\<Cells\>\"", "]"}], " ", ":=", " ", "cells"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<labels\>\"", "]"}], " ", ":=", " ", 
   "labels"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"can", " ", "we", " ", "get", " ", "a", " ", 
    RowBox[{"mesh", "?"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<MeshRegion\>\"", "]"}], " ", ":=", 
  " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "rest_Association"}], "]"}], "[", "\"\<MeshRegion\>\"", "]"}], " ", ":=",
    " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"mesh", "=", 
       RowBox[{"createMeshRegion", "[", " ", 
        RowBox[{
        "Linkage", ",", " ", "coordinates", ",", " ", "cells", ",", " ", 
         RowBox[{"{", "}"}], ",", " ", "rest"}], " ", "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MeshRegionQ", "[", "mesh", "]"}], ",", "mesh", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Mechanism", "::", "meshfail"}], ",", "Linkage"}], "]"}], 
        ";", " ", "$Failed"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", " ", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "rest_Association"}], " ", "]"}], "[", "\"\<addendum\>\"", "]"}], " ", ":=",
   " ", "rest"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", " ", ",", 
      " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "rest_Association"}], " ", "]"}], "[", 
    RowBox[{"\"\<addendum\>\"", ",", " ", "new_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Linkage", "[", 
    RowBox[{
    "coordinates", ",", "mr", ",", "cells", ",", "labels", ",", " ", "new"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}], ",", " ", 
     "rest_Association"}], " ", "]"}], "[", 
   RowBox[{"\"\<exists\>\"", ",", " ", "option_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"KeyExistsQ", "[", " ", 
   RowBox[{"rest", " ", ",", " ", "option"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], ",", " ", 
      "rest_Association"}], " ", "]"}], "[", 
    RowBox[{"\"\<value\>\"", ",", " ", "option_"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"KeyExistsQ", "[", " ", 
      RowBox[{"rest", " ", ",", " ", "option"}], "]"}], ",", " ", 
     RowBox[{"rest", "[", "option", "]"}], ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<LabeledVertices\>\"", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", " ", ",", " ", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}], ",", " ", 
     RowBox[{"Reverse", "/@", "labels"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", ":=",
   " ", 
  RowBox[{"Length", "[", 
   RowBox[{"coordinates", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<DisplayDimension\>\"", "]"}], " ", ":=",
   " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<DisplayDimension\>\"", "]"}], " ", ":=",
    " ", 
   RowBox[{"Length", "[", 
    RowBox[{"coordinates", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<VertexCount\>\"", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
   "\"\<edges\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"Sort", " ", "@", " ", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Sort", " ", "/@", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"cells", ",", 
           RowBox[{"_Spring", "|", "_RigidBar", "|", "_Line"}]}], "]"}], "[", 
         
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{"cells", ",", 
          RowBox[{"_Face", "|", "_ElasticFace", "|", "_Polygon"}]}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", 
     "Sort"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6247]:=",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Linkage", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", " ", ",", " ", 
      
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<FaceRules\>\"", "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"faces", "=", 
       RowBox[{"DeleteDuplicatesBy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"cells", ",", 
              RowBox[{"_Face", "|", "_ElasticFace", "|", "_Polygon"}]}], 
             "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", 
         "Sort"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"OrderlessPatternSequence", "@@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "}"}], " ", "->", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], "&"}], "/@", 
         RowBox[{"Normal", "@", 
          RowBox[{"PositionIndex", "[", "faces", "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", ":", 
           RowBox[{"{", "__Integer", "}"}]}], "->", 
          RowBox[{"Missing", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], "\n",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<EdgeRules\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"edges", "=", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"Sort", "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"cells", ",", 
             RowBox[{"_Spring", "|", "_RigidBar", "|", "_Line"}]}], "]"}], 
           "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "->", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "}"}], ")"}], "&"}],
         " ", "/@", " ", 
        RowBox[{"Normal", "@", 
         RowBox[{"PositionIndex", "[", "edges", "]"}]}]}], ",", "\n", "\t\t", 
       
       RowBox[{"{", 
        RowBox[{"x_", "->", 
         RowBox[{"Missing", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6265]:=",ExpressionUUID->"4679440b-07a1-4d4a-8355-3e7f6838ac20"]
}, Closed]],

Cell[CellGroupData[{

Cell["Linkage[] display format", "Subsubsection",ExpressionUUID->"152dd0a6-0fef-45c1-91bc-be12896c37ad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Linkage", "[", " ", 
      RowBox[{
       RowBox[{"coordinates_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
       "mr_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
       RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
       "rest_Association"}], "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"Mechanisms`graphics`PlotMechanism", "[", "f", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Linkage", "[", " ", 
      RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
       "labelPattern", " ", ",", " ", "_Association"}], "]"}]}], " ", ",", 
    " ", "StandardForm"}], " ", "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v", "=", 
      RowBox[{"Length", "[", "coordinates", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"Linkage", "[", " ", 
     RowBox[{"Panel", "[", 
      RowBox[{
       RowBox[{"ToString", "[", "v", "]"}], "<>", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"v", "==", "1"}], ",", "\"\< Vertex\>\"", ",", 
         "\"\< Vertices\>\""}], "]"}]}], "]"}], " ", "]"}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Linkage", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labelPattern", " ", ",", " ", "_Association"}], "]"}]}], " ", ",", 
     " ", "InputForm"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"inputForm", "[", "f", "]"}]}], "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Linkage", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6267]:=",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Origami[]", "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],

Cell[CellGroupData[{

Cell["Origami[] creator", "Subsubsection",ExpressionUUID->"b39e76c2-5207-4bfd-9cc7-a2c36a57ba54"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "Origami", "]"}], " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "12"}], ")"}]}]}], " ", ",", " ", 
       RowBox[{"Options", "[", "MeshRegion", "]"}]}], "}"}], "]"}]}], ";"}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "\n", "This"}], " ", "is", " ", "a", " ", "kludge", " ", 
    "to", " ", 
    RowBox[{"fix", " ", "?", "Origami"}], " ", "which", " ", "returns", " ", 
    "an", " ", "error", " ", "from", " ", "PadRight", " ", "otherwise", " ", 
    "for", " ", "reasons", " ", "that", " ", "are", " ", "not", " ", 
    "entirely", " ", 
    RowBox[{"clear", "."}]}], "\n", "***)"}]}], "\n", 
 RowBox[{
  RowBox[{"mypad", "[", " ", 
   RowBox[{"c_", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n1_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", "n2_"}], "}"}]}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"c", ",", " ", 
    RowBox[{"{", 
     RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mypad", "[", " ", 
    RowBox[{"c_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", "c"}], "\n", 
  RowBox[{"(*", "*****)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
        "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
        "_Association"}], "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"meshOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", " ", 
         RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"deleteImpossibleCellsFromMechanism", " ", "@", " ", 
        RowBox[{"deleteDegenerateCellsFromMechanism", " ", "@", " ", 
         RowBox[{"removeOverlappingCoordinates", "[", " ", 
          RowBox[{"f", ",", " ", 
           RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], " ", 
          "]"}]}]}], ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t", 
       "meshOptions"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"coordinateSpec_", ",", " ", "cellSpec_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"meshOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "MeshRegion", "]"}]}], " ", "]"}]}], ",", 
       "\n", 
       RowBox[{"intermediateParsing", " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"coordinateSpec", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}]}], " ", "}"}], ",", " ", 
          RowBox[{"{", "cellSpec", "}"}]}], " ", "]"}]}], ",", "\n", 
       "numberOfCoordinates", ",", " ", "coordinates", ",", " ", "cells", ",",
        " ", "labels"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"numberOfCoordinates", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"intermediateParsing", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"coordinates", ",", " ", "cells", ",", " ", "labels"}], "}"}],
        " ", "=", " ", 
       RowBox[{"parseCells", "[", " ", 
        RowBox[{"intermediateParsing", ",", " ", 
         RowBox[{"FreeJoint", " ", "/@", " ", 
          RowBox[{"missingVertices", "[", 
           RowBox[{"numberOfCoordinates", ",", " ", 
            RowBox[{"intermediateParsing", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], " ", "]"}]}], ";", 
      "\n", "\n", "\t", 
      RowBox[{"addMeshRegion", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"deleteImpossibleCellsFromMechanism", " ", "@", " ", 
         RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t", 
          RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"Origami", "[", " ", 
             RowBox[{
              RowBox[{"mypad", "[", " ", 
               RowBox[{"coordinates", " ", ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
                  "3"}], "}"}]}], " ", "]"}], ",", " ", 
              RowBox[{"{", "}"}], ",", " ", "cells", ",", " ", "labels", ",", 
              " ", 
              RowBox[{"<|", "|>"}]}], "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
           "\t\t\t", "]"}], "\n", "\t\t", "]"}]}], ",", "\n", "\t\t", 
        "Automatic", ",", "\n", "\t\t", "meshOptions"}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{"LinkagePrecisionQ", "[", " ", 
    RowBox[{"OptionValue", "[", " ", "OverlapPrecision", " ", "]"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6271]:=",ExpressionUUID->"1c3e576c-c667-475f-89cb-197999bffac7"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami[] methods", "Subsubsection",ExpressionUUID->"cd6d5b6d-fecb-4059-8dc9-13c1b0e93fd2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"mr", " ", ":", " ", 
       RowBox[{"_MeshRegion", "|", 
        RowBox[{"{", "}"}]}]}], ",", " ", "packedCellPattern", ",", " ", 
      "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
    "\"\<Methods\>\"", "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
    "\"\<MechanismType\>\"", ",", "\n", "\t", "\"\<VertexCoordinates\>\"", 
     ",", " ", "\n", "\t", "\"\<MeshRegion\>\"", ",", " ", "\n", "\t", 
     "\"\<components\>\"", ",", " ", "\n", "\t", "\"\<labels\>\"", ",", " ", 
     "\"\<LabeledVertices\>\"", ",", "\n", "\t", "\"\<EmbeddingDimension\>\"",
      ",", " ", "\n", "\t", "\"\<DisplayDimension\>\"", ",", "\n", "\t", 
     "\"\<VertexCount\>\"", ",", "\"\<EdgeRules\>\"", ",", 
     "\"\<FaceRules\>\"", ",", "\n", "\t", "\"\<edges\>\"", ",", "\n", "\t", 
     "\"\<faces\>\""}], "\n", "\t", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<MechanismType\>\"", "]"}], " ", ":=",
    " ", "Origami"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<VertexCoordinates\>\"", "]"}], " ", ":=",
    " ", "coordinates"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<MeshRegion\>\"", "]"}], " ", ":=", 
  " ", "mr"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<MeshRegion\>\"", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mesh", "=", 
       RowBox[{"createMeshRegion", "[", " ", 
        RowBox[{"Origami", ",", " ", 
         RowBox[{"PadRight", "[", " ", 
          RowBox[{"coordinates", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
             RowBox[{"chooseDimension", "[", " ", 
              RowBox[{"Origami", ",", " ", "coordinates"}], " ", "]"}]}], 
            "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MeshRegionQ", "[", "mesh", "]"}], ",", "mesh", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Mechanism", "::", "meshfail"}], ",", "Origami"}], "]"}], 
        ";", " ", "$Failed"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
    "\"\<Cells\>\"", "]"}], " ", ":=", " ", "cells"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<labels\>\"", "]"}], " ", ":=", " ", 
   "labels"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", " ", ",", " ", 
     "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "rest_Association"}], " ", "]"}], "[", "\"\<addendum\>\"", "]"}], " ", ":=",
   " ", "rest"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", " ", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
     "rest_Association"}], " ", "]"}], "[", 
   RowBox[{"\"\<addendum\>\"", ",", " ", "new_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Origami", "[", 
   RowBox[{
   "coordinates", ",", "mr", ",", "cells", ",", "labels", ",", "new"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}], ",", " ", 
     "rest_Association"}], " ", "]"}], "[", 
   RowBox[{"\"\<exists\>\"", ",", " ", "option_"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"KeyExistsQ", "[", " ", 
   RowBox[{"rest", " ", ",", " ", "option"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_", ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], ",", " ", 
      "rest_Association"}], " ", "]"}], "[", 
    RowBox[{"\"\<value\>\"", ",", " ", "option_"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"KeyExistsQ", "[", " ", 
      RowBox[{"rest", " ", ",", " ", "option"}], "]"}], ",", " ", 
     RowBox[{"rest", "[", "option", "]"}], ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<LabeledVertices\>\"", "]"}], " ", ":=",
    "  ", 
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", " ", ",", " ", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}], ",", " ", 
     RowBox[{"Reverse", "/@", "labels"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
   ":=", " ", 
   RowBox[{"Length", "[", 
    RowBox[{"coordinates", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "mr_MeshRegion", ",",
      " ", "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<DisplayDimension\>\"", "]"}], " ", ":=",
   " ", 
  RowBox[{"Last", "[", 
   RowBox[{"Dimensions", "[", 
    RowBox[{"MeshCoordinates", "[", "mr", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"{", "}"}], ",", " ", 
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<DisplayDimension\>\"", "]"}], " ", ":=",
    " ", 
   RowBox[{"Last", "[", 
    RowBox[{"Dimensions", "[", " ", 
     RowBox[{"MeshCoordinates", "[", " ", 
      RowBox[{"createMeshRegion", "[", " ", 
       RowBox[{"Origami", ",", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"coordinates", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "coordinates", "]"}], " ", ",", " ", 
            RowBox[{"chooseDimension", "[", " ", 
             RowBox[{"Origami", ",", " ", "coordinates"}], " ", "]"}]}], 
           "}"}]}], " ", "]"}], ",", " ", "cells", ",", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}], " ", "]"}], " ", "]"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
      "packedCellPattern", ",", " ", "labelPattern", " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<VertexCount\>\"", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Length", "[", "coordinates", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
   "\"\<edges\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"Sort", "@", 
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{"Sort", "/@", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"cells", ",", 
           RowBox[{"_Spring", "|", "_RigidBar", "|", "_Line"}]}], "]"}], "[", 
         
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     "labelPattern", " ", ",", " ", "_Association"}], "]"}], "[", 
   "\"\<faces\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"ToPackedArray", " ", "@", " ", 
   RowBox[{"DeleteDuplicatesBy", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{"cells", ",", 
          RowBox[{"_Face", "|", "_ElasticFace", "|", "_Polygon"}]}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", 
     "Sort"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6276]:=",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{
      RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", " ", ",", " ", 
      
      RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
      RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
      "_Association"}], "]"}], "[", "\"\<FaceRules\>\"", "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"faces", "=", 
       RowBox[{"DeleteDuplicatesBy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"cells", ",", 
              RowBox[{"_Face", "|", "_ElasticFace", "|", "_Polygon"}]}], 
             "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}], ",", 
         "Sort"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"OrderlessPatternSequence", "@@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "}"}], " ", "->", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], "&"}], "/@", 
         RowBox[{"Normal", "@", 
          RowBox[{"PositionIndex", "[", "faces", "]"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", ":", 
           RowBox[{"{", "__Integer", "}"}]}], "->", 
          RowBox[{"Missing", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], "\n",
     "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{
     RowBox[{"coordinates_", "?", "MatrixQ"}], ",", " ", "_", ",", " ", 
     RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
     RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
     "_Association"}], "]"}], "[", "\"\<EdgeRules\>\"", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"edges", "=", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"Sort", "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"cells", ",", 
             RowBox[{"_Spring", "|", "_RigidBar", "|", "_Line"}]}], "]"}], 
           "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}]}], 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Dispatch", "[", 
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], " ", "->", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"Reverse", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "->", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "1"}], "]"}], "]"}]}]}], "}"}], ")"}], "&"}],
         " ", "/@", " ", 
        RowBox[{"Normal", "@", 
         RowBox[{"PositionIndex", "[", "edges", "]"}]}]}], ",", "\n", "\t\t", 
       
       RowBox[{"{", 
        RowBox[{"x_", "->", 
         RowBox[{"Missing", "[", "x", "]"}]}], "}"}]}], "]"}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6294]:=",ExpressionUUID->"b3ba8943-5eec-4b23-b328-7aa163c5a967"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami[] display format", "Subsubsection",ExpressionUUID->"64289b72-f6e2-4889-841a-47f6df4f723a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Origami", "[", " ", 
      RowBox[{
       RowBox[{"coordinates_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
       "mr_", ",", " ", 
       RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
       RowBox[{"labels", " ", ":", " ", "labelPattern"}], " ", ",", " ", 
       "rest_Association"}], "]"}]}], " ", ",", " ", "StandardForm"}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"Quiet", "[", 
   RowBox[{
    RowBox[{"Mechanisms`graphics`PlotMechanism", "[", 
     RowBox[{"f", ",", " ", 
      RowBox[{"DisplayDimension", " ", "->", " ", "2"}]}], "]"}], ",", " ", 
    RowBox[{"Mechanism", "::", "notflat"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labelPattern", " ", ",", " ", "_Association"}], "]"}]}], " ", ",", 
     " ", "StandardForm"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v", "=", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{"Origami", "[", " ", 
      RowBox[{"Panel", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "v", "]"}], "<>", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"v", "==", "1"}], ",", "\"\< Vertex\>\"", ",", 
          "\"\< Vertices\>\""}], "]"}]}], "]"}], " ", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Format", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Origami", "[", " ", 
       RowBox[{"coordinates_", ",", " ", "mr_", ",", " ", 
        RowBox[{"cells", " ", ":", " ", "packedCellPattern"}], ",", " ", 
        "labelPattern", " ", ",", " ", "_Association"}], "]"}]}], " ", ",", 
     " ", "InputForm"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"inputForm", "[", "f", "]"}]}], "\n"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Origami", ",", 
   RowBox[{"{", "NHoldAll", "}"}]}], "]"}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6296]:=",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["ToLinkage[]", "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"meshCells", "[", " ", "mr_MeshRegion", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Table", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Property", "[", " ", 
           RowBox[{
            RowBox[{"MeshCells", "[", " ", 
             RowBox[{"mr", ",", " ", 
              RowBox[{"{", 
               RowBox[{"i", ",", " ", "#"}], "}"}]}], " ", "]"}], ",", " ", 
            RowBox[{"getProperties", "[", " ", 
             RowBox[{"mr", ",", " ", "i", ",", " ", "#"}], " ", "]"}]}], " ", 
           "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"Range", "[", " ", 
          RowBox[{"MeshCellCount", "[", " ", 
           RowBox[{"mr", ",", " ", "i"}], " ", "]"}], " ", "]"}]}], ",", "\n",
         "\t\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", "2"}], "}"}]}], "\n", "\t", "]"}], 
      "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"getProperties", "[", " ", 
   RowBox[{"mr_MeshRegion", ",", " ", "d_", ",", " ", "cell_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"#", " ", "\[Rule]", " ", 
     RowBox[{"PropertyValue", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mr", ",", " ", 
         RowBox[{"{", 
          RowBox[{"d", ",", " ", "cell"}], "}"}]}], "}"}], ",", " ", "#"}], 
      " ", "]"}]}], " ", "&"}], " ", "/@", " ", 
   RowBox[{"Mechanisms`Private`$meshRegionProperties", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6300]:=",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ToLinkage", "]"}], "=", 
    RowBox[{"Flatten", "[", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"dictionary", " ", "for", " ", "convering", " ", "vertices"}], 
       ",", " ", "edges", ",", " ", 
       RowBox[{"and", " ", "polygons"}]}], "*)"}], "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"Line", " ", "->", " ", "RigidBar"}], ",", "\n", "\t", 
       RowBox[{"Polygon", " ", "->", " ", "Polygon"}], ",", "\n", "\t", 
       RowBox[{"Point", " ", "->", " ", "FreeJoint"}], ",", "\n", "\n", "\t", 
       
       RowBox[{"(*", 
        RowBox[{"other", " ", "options"}], "*)"}], "\n", "\t", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], "}"}], "\n", "\t", "]"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ToLinkage", "[", "m_Linkage", "]"}], " ", ":=", " ", "m"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{"mr_MeshRegion", " ", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"MeshCoordinates", "[", "mr", "]"}], ",", "\n", "\t", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"meshCells", "[", "mr", "]"}], " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Point", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "Point", "]"}]}], ",", " ", 
          RowBox[{"Line", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "Line", "]"}]}], ",", " ", 
          RowBox[{"Polygon", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "Polygon", "]"}]}]}], "}"}]}], ",", 
       " ", 
       RowBox[{"Property", "[", 
        RowBox[{
         RowBox[{"None", "[", "_", "]"}], ",", "___"}], "]"}]}], "]"}], ",", 
     "\n", "\t", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g_Graph", ",", "data___"}], "}"}], ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", 
      RowBox[{"g", ",", "data"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Line", "[", 
          RowBox[{"List", "@@", "#"}], "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"EdgeList", "[", "g", "]"}]}], ")"}], " ", "/.", " ", 
      RowBox[{"{", 
       RowBox[{"Line", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Line", "]"}]}], "}"}]}], ",", "\n", "\t", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", 
    RowBox[{"g_Graph", ",", " ", 
     RowBox[{"opt", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Linkage", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"GraphEmbedding", "[", "g", "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Line", "[", 
          RowBox[{"List", "@@", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"EdgeList", "[", "g", "]"}]}], ")"}], " ", "/.", " ", 
      RowBox[{"{", 
       RowBox[{"Line", " ", "->", " ", 
        RowBox[{"OptionValue", "[", "Line", "]"}]}], "}"}]}], ",", "\n", "\t", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "Linkage", "]"}]}], "]"}]}], "\n", "]"}]}], 
  "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"from", " ", "a", " ", "list", " ", "of", " ", "regions"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"internalLinkageConvert", "[", " ", 
    RowBox[{
     RowBox[{"reg_", "?", "RegionQ"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"point_", ",", "line_", ",", "polygon_"}], "}"}], ",", " ", 
     "opt_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"CanonicalizePolyhedron", "[", "reg", "]"}]}], " ", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "p", "]"}], "===", "Polyhedron"}], ",", "\n", 
        "\t\t", 
        RowBox[{"Linkage", "[", " ", 
         RowBox[{
          RowBox[{"PolyhedronCoordinates", "[", "p", "]"}], ",", " ", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"point", " ", "/@", " ", 
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", 
               RowBox[{"p", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", "\n", 
            "\t\t\t", 
            RowBox[{"polygon", " ", "/@", " ", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"line", " ", "/@", " ", 
             RowBox[{"DeleteDuplicates", "[", 
              RowBox[{"Sort", "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2", ",", "1", ",", "1"}], "]"}], "&"}],
                   "/@", 
                  RowBox[{"p", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], ",", "1"}], "]"}]}], 
              "]"}]}]}], "\n", "\t\t\t", "}"}], ",", " ", "\n", "\t\t\t", 
          "opt"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"Missing", "[", "]"}]}], "\n", "\t", "]"}]}], " ", "\n", 
     "]"}], "/;", " ", 
    RowBox[{
     RowBox[{"RegionEmbeddingDimension", "[", "reg", "]"}], "==", "3"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"internalLinkageConvert", "[", " ", 
    RowBox[{
     RowBox[{"reg_", "?", "RegionQ"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"point_", ",", "line_", ",", "polygon_"}], "}"}], ",", " ", 
     "opt_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"CanonicalizePolygon", "[", "reg", "]"}]}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "p", "]"}], "===", "Polygon"}], ",", "\n", 
        "\t\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "\t\t", 
           RowBox[{
            RowBox[{"coordinates", " ", "=", " ", 
             RowBox[{"PolygonCoordinates", "[", "p", "]"}]}], ",", "\n", 
            "\t\t", 
            RowBox[{"edges", " ", "=", " ", 
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "2", ",", "1", ",", 
               "1"}], "]"}]}], ",", "\n", "\t\t", 
            RowBox[{"faces", " ", "=", " ", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "\t\t", "}"}], ",", 
          "\n", "\t\t", 
          RowBox[{"Linkage", "[", " ", 
           RowBox[{"coordinates", ",", " ", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"point", " ", "/@", " ", 
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "coordinates", "]"}], "]"}]}], ",", 
              "\n", "\t\t\t", 
              RowBox[{"line", " ", "/@", " ", "edges"}], ",", "\n", "\t\t\t", 
              
              RowBox[{"polygon", "[", " ", "faces", " ", "]"}]}], "\n", 
             "\t\t\t", "}"}], ",", " ", "\n", "\t\t\t", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", " ", 
              RowBox[{"Options", "[", "Linkage", "]"}]}], "]"}]}], " ", 
           "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        RowBox[{"Missing", "[", "]"}]}], "\t", "\n", "\t", "]"}]}], " ", "\n",
      "]"}], "/;", " ", 
    RowBox[{
     RowBox[{"RegionEmbeddingDimension", "[", "reg", "]"}], "==", "2"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"donothing", "[", "x_", "]"}], " ", ":=", " ", "Nothing"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "[", " ", 
    RowBox[{
     RowBox[{"reg", " ", ":", " ", 
      RowBox[{
       RowBox[{"_", "?", "RegionQ"}], "|", 
       RowBox[{"{", 
        RowBox[{"__", "?", "RegionQ"}], "}"}]}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"options", " ", "=", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "Linkage", "]"}]}], "]"}]}], " ", ",", " ", 
       
       RowBox[{"rules", " ", "=", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OptionValue", "[", "Point", "]"}], ",", " ", 
           RowBox[{"OptionValue", "[", "Line", "]"}], ",", " ", 
           RowBox[{"OptionValue", "[", "Polygon", "]"}]}], " ", "}"}], " ", "/.",
          " ", 
         RowBox[{"None", " ", "->", " ", "donothing"}]}]}]}], " ", "}"}], ",",
      "\n", "\t", 
     RowBox[{"JoinMechanism", "[", " ", 
      RowBox[{"DeleteMissing", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"internalLinkageConvert", "[", 
          RowBox[{"#", ",", "rules", ",", " ", "options"}], "]"}], "&"}], "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "reg", "}"}], "]"}]}], "]"}], " ", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToLinkage", "::", "bad"}], "=", 
   "\"\<Unable to turn `1` into a Linkage.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ToLinkage", "[", " ", 
   RowBox[{"obj_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"ToLinkage", "::", "bad"}], ",", " ", 
     RowBox[{"Head", "[", "obj", "]"}]}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6302]:=",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],

Cell[CellGroupData[{

Cell["ToOrigami[]", "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "::", "be"}], "=", 
   "\"\<Edges `1` appear to have more than one face.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6313]:=",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "ToOrigami", " ", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "ToLinkage", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToOrigami", "[", 
    RowBox[{"f_Linkage", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"o", ",", " ", "badedges"}], "}"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"Origami", " ", "@@", " ", "f"}]}], ";", "\n", "\t\t", 
      RowBox[{"badedges", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Mechanisms`geometry`MechanismConnectivity", "[", 
          RowBox[{"f", " ", ",", " ", 
           RowBox[{"\"\<edges\>\"", "->", "\"\<faces\>\""}]}], "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}], 
      ";", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "badedges", "]"}], ">", "0"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"ToOrigami", "::", "be"}], ",", " ", "badedges"}], "]"}]}], 
       " ", "]"}], ";", "\n", "\n", "\t\t", "o"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ToOrigami", "[", " ", 
   RowBox[{
    RowBox[{"dunno", " ", ":", " ", 
     RowBox[{"Except", "[", "_Linkage", "]"}]}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"linkage", "=", 
      RowBox[{"Quiet", "[", 
       RowBox[{"ToLinkage", "[", 
        RowBox[{"dunno", ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "ToLinkage", "]"}]}], " ", "]"}]}], " ", 
        "]"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"ToOrigami", "[", 
     RowBox[{"linkage", ",", " ", "opt"}], " ", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6314]:=",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
MechanismEdgeQ[],MechanismFaceQ[],ValidMechanismEdgeQ[],ValidMechanismFaceQ[]\
\
\>", "Subsection",ExpressionUUID->"929a533b-38ca-4691-bbf0-10109000ed9f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismVertexQ", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "vertexlist_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "}"}], ",", 
    RowBox[{"AllTrue", "[", " ", 
     RowBox[{
      RowBox[{"vertexlist", " ", "/.", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], " ", ",", " ", 
      RowBox[{"Between", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "n"}], "}"}], "]"}]}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismEdgeQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "edgelist_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"edgelist", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
      RowBox[{"ContainsAll", "[", " ", 
       RowBox[{
        RowBox[{"Sort", "/@", 
         RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], ",", 
        RowBox[{"Sort", "/@", 
         RowBox[{"(", 
          RowBox[{"edgelist", "/.", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], "]"}]}], "}"}], ",", 
    "TrueQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaceQ", "[", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     "facelist_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"AllTrue", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ListQ", "[", "facelist", "]"}], ",", 
       RowBox[{"ContainsAll", "[", " ", 
        RowBox[{
         RowBox[{"Sort", "/@", 
          RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], ",", 
         RowBox[{"Sort", "/@", 
          RowBox[{"(", 
           RowBox[{"facelist", "/.", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], " ", "]"}]}], "}"}],
      ",", "TrueQ"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismEdgeQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "edges_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edgelist", "=", 
      RowBox[{"edges", "/.", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"edgelist", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
        RowBox[{
         RowBox[{"Min", "[", "edgelist", "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Max", "[", "edgelist", "]"}], "\[LessEqual]", 
         RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", 
      "TrueQ"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidMechanismEdgeQ", "[", 
    RowBox[{
     RowBox[{"pos_", "?", "MatrixQ"}], " ", ",", " ", "edgelist_"}], " ", 
    "]"}], " ", ":=", " ", 
   RowBox[{"AllTrue", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"MatrixQ", "[", "edgelist", "]"}], ",", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"edgelist", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], ",", 
       RowBox[{
        RowBox[{"Min", "[", "edgelist", "]"}], ">", "0"}], ",", 
       RowBox[{
        RowBox[{"Max", "[", "edgelist", "]"}], "\[LessEqual]", 
        RowBox[{"Length", "[", "pos", "]"}]}]}], "}"}], ",", "TrueQ"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismFaceQ", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "faces_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"facelist", "=", 
      RowBox[{"faces", "/.", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"ListQ", "[", "facelist", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Min", "[", "facelist", "]"}], ">", "0"}], ",", 
        RowBox[{
         RowBox[{"Max", "[", "facelist", "]"}], "\[LessEqual]", 
         RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", 
      "TrueQ"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ValidMechanismFaceQ", "[", 
   RowBox[{
    RowBox[{"pos_", "?", "MatrixQ"}], " ", ",", " ", "facelist_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ListQ", "[", "facelist", "]"}], ",", 
      RowBox[{
       RowBox[{"Min", "[", "facelist", "]"}], ">", "0"}], ",", 
      RowBox[{
       RowBox[{"Max", "[", "facelist", "]"}], "\[LessEqual]", 
       RowBox[{"Length", "[", "pos", "]"}]}]}], "}"}], ",", "TrueQ"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6317]:=",ExpressionUUID->"e7d99d5c-47c2-4c13-bb77-affd8f0fda8f"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
MechanismPositions[], MechanismEdges[], MechanismFaces[], MechanismVertices[] \
\>", "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismPositions", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"m", "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6324]:=",ExpressionUUID->"6bde0a51-99b4-44a6-a5ae-56f9a2569da5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismVertices", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Range", "[", " ", 
   RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismVertices", "[", " ", "something_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"MechanismVertices", "[", 
    RowBox[{"m", ",", " ", "something"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"vertexList_", "?", "VectorQ"}]}], " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"testList", " ", "=", " ", 
       RowBox[{"vertexList", " ", "/.", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], " ", ",", " ", 
      RowBox[{"max", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", "<", " ", "0"}], " ", "||", " ", 
         RowBox[{"#", " ", ">", " ", "max"}], " ", "||", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"IntegerQ", "[", "#", "]"}], "]"}]}], " ", ",", " ", 
        RowBox[{"Missing", "[", 
         RowBox[{"\"\<KeyAbsent\>\"", ",", " ", "#"}], "]"}], " ", ",", " ", 
        "#"}], "]"}], "&"}], " ", "/@", " ", "testList"}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "f_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"testList", " ", "=", " ", 
      RowBox[{
       RowBox[{"f", "[", "m", "]"}], " ", "/.", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", "testList", "]"}], " ", ",", " ", 
      RowBox[{"MechanismVertices", "[", 
       RowBox[{"m", " ", ",", " ", "testList"}], "]"}], ",", " ", 
      RowBox[{"Failure", "[", 
       RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
        RowBox[{"<|", " ", 
         RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}]}], " ", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6325]:=",ExpressionUUID->"3bfadbe7-2cb3-418f-ba5d-0606262c6e57"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdges", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEdges", "[", " ", "something_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"MechanismEdges", "[", 
    RowBox[{"m", ",", " ", "something"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEdges", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "f_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"testList", " ", "=", " ", 
      RowBox[{
       RowBox[{"f", "[", "m", "]"}], " ", "/.", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MatrixQ", "[", " ", "testList", "]"}], ",", " ", 
      RowBox[{"MechanismEdges", "[", 
       RowBox[{"m", ",", " ", "testList"}], "]"}], ",", " ", 
      RowBox[{"Failure", "[", 
       RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
        RowBox[{"<|", " ", 
         RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}]}], 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6329]:=",ExpressionUUID->"33d2f0a4-2912-403c-aaa6-32ec5c9375e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaces", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFaces", "[", " ", "something_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"MechanismFaces", "[", 
    RowBox[{"m", ",", " ", "something"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaces", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "f_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"testList", " ", "=", " ", 
      RowBox[{
       RowBox[{"f", "[", "m", "]"}], " ", "/.", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", " ", 
       RowBox[{"testList", ",", " ", "VectorQ"}], " ", "]"}], ",", " ", 
      RowBox[{"MechanismFaces", "[", 
       RowBox[{"m", ",", " ", "testList"}], "]"}], ",", " ", 
      RowBox[{"Failure", "[", 
       RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
        RowBox[{"<|", " ", 
         RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}]}], 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6332]:=",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdges", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     RowBox[{"edgeList_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"sortedEdges", " ", "=", " ", 
        RowBox[{"Sort", "/@", 
         RowBox[{"(", 
          RowBox[{"edgeList", " ", "/.", " ", 
           RowBox[{"Dispatch", "[", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ")"}]}]}], " ", ",", 
       " ", 
       RowBox[{"indexedEdges", " ", "=", " ", 
        RowBox[{"PositionIndex", "[", 
         RowBox[{"Sort", "/@", 
          RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}], "]"}]}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"ToPackedArray", " ", "@", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"indexedEdges", " ", "/@", " ", "sortedEdges"}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaces", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"faceList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "VectorQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"indexedFaces", " ", "=", " ", 
       RowBox[{"PositionIndex", "[", 
        RowBox[{"Sort", "/@", 
         RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"sortedFaces", " ", "=", " ", 
       RowBox[{"Sort", "/@", 
        RowBox[{"(", 
         RowBox[{"faceList", "/.", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ")"}]}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ToPackedArray", " ", "@", " ", 
     RowBox[{"Flatten", "[", " ", 
      RowBox[{
       RowBox[{"indexedFaces", " ", "/@", " ", "sortedFaces"}], " ", ",", " ",
        "1"}], " ", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6335]:=",ExpressionUUID->"6d279430-6816-4569-9f44-8c93afb4027d"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
MechanismVertexCells[], MechanismEdgeCells[], MechanismFaceCells[]\
\>", "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismVertexCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "vertexList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismVertexCells", "[", " ", "vertexList", " ", "]"}], "[", 
   "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismVertexCells", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"MechanismVertexCells", "[", 
    RowBox[{"Range", "[", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismVertexCells", "[", " ", 
    RowBox[{"vertexList_", "?", "VectorQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"takeCells", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", " ", 
            RowBox[{"vertexList", " ", "/.", " ", 
             RowBox[{"Dispatch", "[", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", " ", "#"}], 
           "]"}], " ", ",", " ", "#"}], "]"}], "&"}], "/@", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"Flatten", "[", "cells", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismVertexCells", "[", " ", 
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"f", "[", "m", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "cells", "]"}], " ", "===", " ", "f"}], ",", " ", 
       RowBox[{"Failure", "[", 
        RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
         RowBox[{"<|", " ", 
          RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}], " ", 
       ",", " ", 
       RowBox[{
        RowBox[{"MechanismVertexCells", "[", "cells", "]"}], "[", "m", 
        "]"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEdgeCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "edgeList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismEdgeCells", "[", " ", "edgeList", " ", "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismEdgeCells", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"MechanismEdgeCells", "[", 
    RowBox[{"m", "[", "\"\<edges\>\"", "]"}], "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEdgeCells", "[", " ", 
    RowBox[{"edgeList_", "?", "MatrixQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"takeCells", "[", " ", 
         RowBox[{
          RowBox[{"identifyCellFromList", "[", " ", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", " ", 
            RowBox[{"edgeList", " ", "/.", " ", 
             RowBox[{"Dispatch", "[", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", " ", "#"}], 
           "]"}], " ", ",", " ", "#"}], "]"}], "&"}], "/@", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"Flatten", "[", "cells", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEdgeCells", "[", " ", 
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"f", "[", "m", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "cells", "]"}], " ", "===", " ", "f"}], ",", " ", 
       RowBox[{"Failure", "[", 
        RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
         RowBox[{"<|", " ", 
          RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}], " ", 
       ",", " ", 
       RowBox[{
        RowBox[{"MechanismEdgeCells", "[", "cells", "]"}], "[", "m", "]"}]}], 
      " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaceCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "faceList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismFaceCells", "[", " ", "faceList", " ", "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismFaceCells", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"MechanismFaceCells", "[", 
    RowBox[{"m", "[", "\"\<faces\>\"", "]"}], "]"}], "[", "m", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaceCells", "[", " ", 
    RowBox[{"faceList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", " ", "VectorQ"}], "]"}], "&"}], ")"}]}], "]"}], "[",
    " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"processedFaceList", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{"faceList", ",", " ", 
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], "<", "3"}], "&"}], ")"}]}]}], 
       "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"takeCells", "[", " ", 
           RowBox[{
            RowBox[{"identifyCellFromList", "[", " ", 
             RowBox[{
              RowBox[{"Head", "[", "#", "]"}], ",", " ", 
              RowBox[{"processedFaceList", " ", "/.", " ", 
               RowBox[{"Dispatch", "[", 
                RowBox[{"m", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", " ", "#"}], 
             "]"}], " ", ",", " ", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
       RowBox[{"Flatten", "[", "cells", "]"}]}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFaceCells", "[", " ", 
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{"f", "[", "m", "]"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "cells", "]"}], " ", "===", " ", "f"}], ",", " ", 
      
      RowBox[{"Failure", "[", 
       RowBox[{"\"\<FailedEvaluation\>\"", ",", " ", 
        RowBox[{"<|", " ", 
         RowBox[{"\"\<Input\>\"", "->", " ", "f"}], "|>"}]}], "]"}], " ", ",",
       " ", 
      RowBox[{
       RowBox[{"MechanismFaceCells", "[", "cells", "]"}], "[", "m", "]"}]}], 
     " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6337]:=",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCellTypes[], MechanismCells[]", "Subsection",ExpressionUUID->"f3b80113-3224-49a9-9e96-60dda4fcc677"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismCellTypes", "[", "]"}], " ", ":=", " ", 
  "$MechanismCellTypes"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellTypes", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"DeleteDuplicates", "[", " ", 
    RowBox[{"Head", " ", "/@", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "#", "]"}], "[", 
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     "tag_String"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"mechanismCellList", "[", 
        RowBox[{
        "\"\<Threaded\>\"", ",", " ", "m", " ", ",", " ", "tag", ",", " ", 
         "None", ",", " ", "None"}], "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"res", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "mechanismCellList"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     RowBox[{"cellPattern", " ", ":", " ", 
      RowBox[{"Except", "[", "_String", "]"}]}]}], " ", "]"}], " ", ":=", " ",
    "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"mechanismCellList", "[", " ", 
        RowBox[{"\"\<Threaded\>\"", " ", ",", " ", "m", " ", ",", " ", 
         RowBox[{"cellPattern", " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", "None", " ", ",", " ", 
         "None"}], "]"}]}], "\n", "\t", "}"}], ",", "\n", "\t\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "mechanismCellList"}]}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"cellPattern", " ", ":", " ", 
      RowBox[{"Except", "[", "_String", "]"}]}], ",", " ", "dataSpec_"}], 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"mechanismCellList", "[", " ", 
        RowBox[{"\"\<Threaded\>\"", ",", " ", "m", ",", " ", 
         RowBox[{"cellPattern", " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", "dataSpec", ",", " ", 
         "None"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "mechanismCellList"}]}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "[", " ", "args__", " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"MechanismCells", "[", 
   RowBox[{"m", ",", "args"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:11:59 \
In[6349]:=",ExpressionUUID->"c4c238e8-8716-42d6-8809-5319a34d7714"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"main", " ", "routine", "\n", "\n", "outputFormat"}], " ", "=", 
    " ", 
    RowBox[{
     RowBox[{"one", " ", "of", " ", 
      RowBox[{"{", 
       RowBox[{
       "\"\<Threaded\>\"", ",", "\"\<Unthreaded\>\"", ",", " ", 
        "\"\<Index\>\""}], "}"}], " ", "from", " ", "$cellOutputFormats", 
      "\n", "cellSpec", " ", "is", " ", "a", " ", "pattern", " ", "to", " ", 
      "match", " ", "cells", "\n", "dataSpec", " ", "is", " ", "a", " ", 
      "rule", " ", "of", " ", "the", " ", "form", " ", "dataType"}], " ", "->",
      " ", 
     RowBox[{
     "dataValue", " ", "to", " ", "match", "\n", "outputSpec", " ", "matches",
       " ", "the", " ", "rules", " ", "to", " ", "determine", " ", "which", 
      " ", "should", " ", "be", " ", "listed"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"mechanismCellList", "[", " ", 
    RowBox[{
    "outputFormat_", " ", ",", " ", "m_", " ", ",", " ", "cellSpec_", " ", 
     ",", " ", "dataSpec_", " ", ",", " ", "outputSpec_"}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{"outputCells", "[", " ", 
    RowBox[{"outputFormat", ",", " ", "outputSpec", ",", " ", 
     RowBox[{"filterCellsByData", "[", 
      RowBox[{"m", " ", ",", " ", "dataSpec", " ", ",", " ", 
       RowBox[{"filterCells", "[", " ", 
        RowBox[{"m", ",", " ", "cellSpec"}], "]"}]}], " ", "]"}]}], " ", 
    "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6356]:=",ExpressionUUID->"0b41cfbf-4b5f-472d-bbed-762ff7b98655"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "filter", " ", "by", " ", "the", " ", "cell", " ", "specification"}], 
   "*)"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"{", 
    RowBox[{"head", " ", ",", " ", 
     RowBox[{"cell", " ", "list"}]}], "}"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"filterCells", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"head_", " ", ",", " ", "indices_List"}], "}"}]}], "]"}], " ", 
    ":=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"takeCells", "[", " ", 
        RowBox[{
         RowBox[{"identifyCellFromList", "[", " ", 
          RowBox[{"head", ",", " ", 
           RowBox[{"indices", " ", "/.", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], ",", " ", "#"}], " ", "]"}], 
         ",", " ", "#"}], " ", "]"}], " ", "&"}], " ", "/@", " ", 
      RowBox[{"m", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"if", " ", "it", " ", 
      RowBox[{"isn", "'"}], "t", " ", "a", " ", "list"}], ",", " ", 
     RowBox[{"assume", " ", 
      RowBox[{"it", "'"}], "s", " ", "a", " ", "pattern"}]}], " ", "*)"}], 
   "\n", 
   RowBox[{
    RowBox[{"filterCells", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"patt", " ", ":", " ", 
       RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}], " ", ":=", "\n",
     "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"pattern", " ", "=", " ", 
        RowBox[{
         RowBox[{"cellPattern", "[", "patt", "]"}], " ", "/.", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "}"}], ",", "\n", "\t\t", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"takeCells", "[", " ", 
          RowBox[{
           RowBox[{"casesCellType", "[", " ", 
            RowBox[{"pattern", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], 
          " ", "]"}], " ", "&"}], " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], "\n", "\t", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"filterCells", "[", " ", 
     RowBox[{"m_", " ", ",", " ", "patt_"}], "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismCells", "::", "cspec"}], ",", " ", "patt"}], "]"}], 
      ";", " ", 
      RowBox[{"{", "}"}]}], ")"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6357]:=",ExpressionUUID->"85692ee5-03e0-4f88-9eaa-342aec96146f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "filter", " ", "by", " ", "the", " ", "data", " ", "specification"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"filterCellsByData", "[", 
     RowBox[{"m_", ",", " ", "None", ",", " ", "cells_"}], "]"}], " ", ":=", 
    " ", "cells"}], "\n", 
   RowBox[{
    RowBox[{"filterCellsByData", "[", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"Blank", "[", "]"}], ",", " ", "cells_"}], "]"}], " ", ":=", 
    " ", "cells"}], "\n", 
   RowBox[{
    RowBox[{"filterCellsByData", "[", 
     RowBox[{"m_", " ", ",", " ", "spec_List", ",", " ", "cells_"}], "]"}], 
    " ", ":=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"filterCellsByData", "[", 
        RowBox[{"m", ",", " ", "#", ",", " ", "cells"}], "]"}], "&"}], " ", "/@",
       " ", "spec"}], "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"filterCellsByData", "[", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"dataSpec_", " ", "->", " ", "f_Function"}], ",", " ", 
      "cells_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"takeCells", "[", " ", 
        RowBox[{
         RowBox[{"selectCellFromDataType", "[", " ", 
          RowBox[{
           RowBox[{"dataSpec", " ", "->", " ", "f"}], ",", " ", "#"}], "]"}], 
         ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", "cells"}], " ", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"filterCellsByData", "[", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"dataSpec_", " ", "->", " ", "patt_"}], ",", " ", "cells_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"takeCells", "[", " ", 
        RowBox[{
         RowBox[{"casesCellFromDataType", "[", " ", 
          RowBox[{
           RowBox[{"dataSpec", " ", "->", " ", "patt"}], ",", " ", "#"}], 
          "]"}], ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
      "cells"}], " ", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"filterCellsByData", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"dataSpec", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"_List", "|", 
         RowBox[{"Blank", "[", "]"}], "|", "None"}], "]"}]}], " ", ",", " ", 
      "cells_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismCells", "::", "dspec"}], ",", " ", "dataSpec"}], 
       "]"}], ";", " ", "cells"}], ")"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6360]:=",ExpressionUUID->"43bed0ec-ac12-4481-aa49-5d11d2fe0c94"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "::", "err"}], " ", "=", " ", 
   "\"\<Patterns starting with Blank[] cannot be parsed.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "::", "dspec"}], " ", "=", " ", 
   "\"\<Data spec `1` cannot be parsed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCells", "::", "cspec"}], " ", "=", " ", 
   "\"\<Cell specification `1` should be in the form { cell , indices } or a \
cell pattern.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6366]:=",ExpressionUUID->"f1ae76f2-abd7-4a7f-99c5-ba3ccf8d7d64"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["functions to manipulate mechanisms", "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],

Cell[CellGroupData[{

Cell["PlaceVertices[], DisplaceVertices[]", "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "new", " ", "positions", " ", "have", " ", "been", " ", "provided"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"newPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ",
     "\n", "\t", 
    RowBox[{
     RowBox[{"ReplacePart", "[", " ", 
      RowBox[{"m", ",", " ", 
       RowBox[{"1", " ", "->", " ", "newPositions"}]}], " ", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "==", " ", 
      RowBox[{"Length", "[", "newPositions", "]"}]}]}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "assume", " ", "this", " ", "is", " ", "a", " ", "list", " ", "of", " ", 
     "replacement", " ", "rules", " ", "that", " ", "is", " ", "empty"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", "m"}], "\n", 
   RowBox[{"(*", 
    RowBox[{"a", " ", "list", " ", "of", " ", "replacement", " ", "rules"}], 
    "*)"}], "\n", 
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"rules", " ", ":", " ", 
       RowBox[{
        RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}]}], "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "rewrite", " ", "vertices", " ", "using", " ", "any", " ", "labels"}],
         "*)"}], "\n", "\t", 
       RowBox[{
        RowBox[{"vertices", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "rules", "}"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}]}], ",", " ", "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{"extract", " ", "positions"}], "*)"}], "\n", "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "rules", "}"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{
       RowBox[{"ReplacePart", "[", " ", 
        RowBox[{"m", ",", "\n", "\t\t", 
         RowBox[{"1", " ", "->", " ", 
          RowBox[{"ReplacePart", "[", " ", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", ",", 
            " ", "\n", "\t\t\t\t", 
            RowBox[{"Thread", "[", 
             RowBox[{"vertices", " ", "->", " ", "positions"}], "]"}]}], "\n",
            "\t\t\t", "]"}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"VectorQ", "[", " ", 
         RowBox[{"vertices", " ", ",", " ", "IntegerQ"}], " ", "]"}], " ", "&&",
         " ", 
        RowBox[{
         RowBox[{"Max", "[", "vertices", "]"}], " ", "<=", " ", 
         RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "  ", "&&", " ", 
        RowBox[{
         RowBox[{"Min", "[", "vertices", "]"}], " ", ">", " ", "0"}], " ", "&&",
         " ", 
        RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], " ", "&&", " ", 
        
        RowBox[{
         RowBox[{"Length", "[", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", 
         RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"rules", " ", ":", " ", 
       RowBox[{
        RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", "\n", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"vertices", " ", "=", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "rules", "}"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", " ", 
         RowBox[{"positions", " ", "=", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "rules", "}"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "some", " ", "vertices", " ", "are", " ", "out", " ", "of", " ", 
         "bounds"}], "*)"}], "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Not", "[", 
            RowBox[{"VectorQ", "[", " ", 
             RowBox[{
              RowBox[{"vertices", " ", "/.", " ", 
               RowBox[{"m", "[", 
                RowBox[{"[", "4", "]"}], "]"}]}], " ", ",", " ", "IntegerQ"}],
              " ", "]"}], "]"}], " ", "||", " ", 
           RowBox[{
            RowBox[{"Max", "[", "vertices", "]"}], " ", ">", " ", 
            RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "  ", "||", " ", 
           RowBox[{
            RowBox[{"Min", "[", "vertices", "]"}], " ", "<=", " ", "0"}]}], 
          ",", " ", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"PlaceVertices", "::", "vert"}], " ", ",", " ", 
            "vertices"}], "]"}]}], "]"}], ";", "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{
         "not", " ", "all", " ", "positions", " ", "have", " ", "the", " ", 
          "same", " ", "dimension"}], "*)"}], "\n", "\t", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], "]"}], ",", 
          " ", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"PlaceVertices", "::", "pos"}], ",", " ", "positions"}], 
           "]"}]}], " ", "]"}], ";", "\n", "\t", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], " ", "&&", 
           " ", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"positions", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "!=", " ", 
            RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}], ",", 
          " ", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"PlaceVertices", "::", "pos"}], ",", " ", "positions"}], 
           "]"}]}], "]"}], ";", "\n", "\t", "False"}]}], "\n", "]"}]}]}], 
   "\n", 
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"newPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "!=", " ", 
          RowBox[{"Length", "[", "newPositions", "]"}]}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"PlaceVertices", "::", "num"}], ",", " ", 
           RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}]}], " ", 
        "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], "\n", 
   RowBox[{
    RowBox[{"newVertexPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"Except", "[", 
       RowBox[{
        RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "_Rule", " ", "|", " ", 
        
        RowBox[{"{", "__Rule", "}"}], " ", "|", " ", 
        RowBox[{"{", "}"}]}], " ", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"PlaceVertices", "::", "r"}], "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6369]:=",ExpressionUUID->"9bc90bd8-31e3-4b35-9c08-abac5f345453"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaceVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "r_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"newVertexPositions", "[", " ", 
       RowBox[{"m", " ", ",", " ", "r"}], " ", "]"}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MechanismQ", "[", " ", "res", " ", "]"}], " ", ",", " ", "res",
       " ", ",", " ", "m"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaceVertices", "[", " ", "r_", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"newVertexPositions", "[", " ", 
        RowBox[{"m", " ", ",", " ", "r"}], " ", "]"}]}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"MechanismQ", "[", " ", "res", " ", "]"}], " ", ",", " ", 
       "res", " ", ",", " ", "m"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Vertices `1` are not all valid vertex indices in mechansim.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` are not valid vertex coordinates.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices should be `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaceVertices", "::", "r"}], " ", "=", " ", 
   "\"\<Argument is not a list of vertex positions or replacement rules for \
vertex positions.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6375]:=",ExpressionUUID->"386eec8d-461d-4db6-b7ab-158590f59a83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", 
    RowBox[{"newPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
  "\n", "\t", 
  RowBox[{
   RowBox[{"ReplacePart", "[", " ", 
    RowBox[{"m", ",", " ", 
     RowBox[{"1", " ", "->", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", "+", " ", 
        "newPositions"}], ")"}]}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", 
     RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}], " ", "==", 
    " ", 
    RowBox[{"Dimensions", "[", "newPositions", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", "m"}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}]}], "]"}], " ", ":=", " ",
   "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "rewrite", " ", "vertices", " ", "using", " ", "any", " ", "labels"}], 
      "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"vertices", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "rules", "}"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], ",", " ", "\n", "\t", 
      RowBox[{"positions", " ", "=", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "rules", "}"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"ReplacePart", "[", " ", 
      RowBox[{"m", ",", "\n", "\t\t", 
       RowBox[{"1", " ", "->", " ", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", "+", " ", 
          RowBox[{"ReplacePart", "[", " ", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
           RowBox[{
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", " ", 
              RowBox[{"Dimensions", "[", 
               RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}], 
             " ", "]"}], ",", " ", "\n", "\t\t\t\t\t\t\t\t\t\t\t", 
            RowBox[{"Thread", "[", 
             RowBox[{"vertices", " ", "->", " ", "positions"}], "]"}]}], "\n",
            "\t\t\t\t\t\t\t\t\t\t", "]"}]}], "\n", "\t\t\t", ")"}]}]}], "\n", 
      "\t", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", " ", 
       RowBox[{"vertices", " ", ",", " ", "IntegerQ"}], " ", "]"}], " ", "&&",
       " ", 
      RowBox[{
       RowBox[{"Max", "[", "vertices", "]"}], " ", "<=", " ", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "  ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "vertices", "]"}], " ", ">", " ", "0"}], " ", "&&",
       " ", 
      RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Length", "[", " ", 
        RowBox[{"positions", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", 
       RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}]}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"moveVertexPositions", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "f_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newPositions", " ", "=", "  ", 
       RowBox[{"f", " ", "@", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"newVertexPositions", "[", " ", 
       RowBox[{"m", " ", ",", " ", "newPositions"}], " ", "]"}], " ", "/;", 
      " ", 
      RowBox[{
       RowBox[{"MatrixQ", "[", "newPositions", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Dimensions", "[", "newPositions", "]"}], " ", "==", " ", 
        RowBox[{"Dimensions", "[", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}]}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vertices", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "rules", "}"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", "rules", "}"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "some", " ", "vertices", " ", "are", " ", "out", " ", "of", " ", 
       "bounds"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"VectorQ", "[", " ", 
           RowBox[{
            RowBox[{"vertices", " ", "/.", " ", 
             RowBox[{"m", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], " ", ",", " ", "IntegerQ"}], 
           " ", "]"}], "]"}], " ", "||", " ", 
         RowBox[{
          RowBox[{"Max", "[", "vertices", "]"}], " ", ">", " ", 
          RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "  ", "||", " ", 
         RowBox[{
          RowBox[{"Min", "[", "vertices", "]"}], " ", "<=", " ", "0"}]}], ",",
         " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplaceVertices", "::", "vert"}], " ", ",", " ", 
          "vertices"}], "]"}]}], "]"}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "not", " ", "all", " ", "positions", " ", "have", " ", "the", " ", 
        "same", " ", "dimension"}], "*)"}], "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], "]"}], ",", 
        " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplaceVertices", "::", "pos"}], ",", " ", "positions"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"MatrixQ", "[", " ", "positions", " ", "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"positions", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "!=", " ", 
          RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplaceVertices", "::", "pos"}], ",", " ", "positions"}], 
         "]"}]}], "]"}], ";", "\n", "\t", "False"}]}], "\n", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", " ", ",", " ", 
    RowBox[{"newPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "!=", " ", 
        RowBox[{"Length", "[", "newPositions", "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"DisplaceVertices", "::", "num"}], ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}]}], " ", 
      "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{"moveVertexPositions", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"Except", "[", 
     RowBox[{
      RowBox[{"_", "?", "MatrixQ"}], " ", "|", " ", "_Rule", " ", "|", " ", 
      RowBox[{"{", "__Rule", "}"}], " ", "|", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"DisplaceVertices", "::", "r"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6381]:=",ExpressionUUID->"8410b588-8af0-4d7a-8e0e-894e8bbb5f83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplaceVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "r_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"moveVertexPositions", "[", " ", 
       RowBox[{"m", " ", ",", " ", "r"}], " ", "]"}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MechanismQ", "[", " ", "res", " ", "]"}], " ", ",", " ", "res",
       " ", ",", " ", "m"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "[", " ", "r_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"moveVertexPositions", "[", " ", 
       RowBox[{"m", " ", ",", " ", "r"}], " ", "]"}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MechanismQ", "[", " ", "res", " ", "]"}], " ", ",", " ", "res",
       " ", ",", " ", "m"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "vert"}], " ", "=", " ", 
   "\"\<Vertices `1` are not all valid vertex indices in mechansim.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` are not valid vertex coordinate displacements.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Number of vertices should be `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplaceVertices", "::", "r"}], " ", "=", " ", 
   "\"\<Argument is not a list of vertex displacements, a function that \
returns new vertex positions, or a list of replacement rules indicating \
vertex displacements.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6388]:=",ExpressionUUID->"bba4b872-ab1c-4173-ae10-e4f45aa55edb"]
}, Closed]],

Cell[CellGroupData[{

Cell["MapVertices[]", "Subsection",ExpressionUUID->"c54c2186-c788-4594-b5ca-b8fb5b869f9a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MapVertices", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "ff__"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{
        RowBox[{"MapVertices", "[", "ff", "]"}], "@", "m"}]}], "}"}], ",", 
     " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "MapVertices"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapVertices", "[", " ", 
     RowBox[{"f", " ", ":", " ", 
      RowBox[{"Except", "[", "mechanismPattern", "]"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"newPositions", " ", "=", " ", 
       RowBox[{"f", " ", "/@", " ", 
        RowBox[{"m", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MatrixQ", "[", " ", 
          RowBox[{"newPositions", ",", " ", "NumericQ"}], " ", "]"}]}], " ", 
        ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"MapVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", "\n",
       "\t", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"m", ",", " ", 
        RowBox[{"1", " ", "->", " ", "newPositions"}]}], "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapVertices", "[", " ", 
     RowBox[{
      RowBox[{"f", " ", ":", " ", 
       RowBox[{"Except", "[", "mechanismPattern", "]"}]}], " ", ",", " ", 
      RowBox[{"lst_", "?", "MatrixQ"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"newPositions", " ", "=", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{"f", ",", " ", 
          RowBox[{"Join", "[", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}], " ", ",", " ", "lst"}], 
           " ", "]"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MatrixQ", "[", " ", 
           RowBox[{"newPositions", ",", " ", "NumericQ"}], " ", "]"}]}], " ", 
         ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{"MapVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
       "\n", "\t", 
       RowBox[{"ReplacePart", "[", " ", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"1", " ", "->", " ", "newPositions"}]}], " ", "]"}]}]}], 
     "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
     RowBox[{"Length", "[", 
      RowBox[{"lst", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapVertices", "[", " ", 
     RowBox[{
      RowBox[{"f", " ", ":", " ", 
       RowBox[{"Except", "[", "mechanismPattern", "]"}]}], " ", ",", " ", 
      RowBox[{"lst_", "?", "VectorQ"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"newPositions", " ", "=", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{"f", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", "lst"}], "}"}]}], " ", 
         "]"}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MatrixQ", "[", " ", 
           RowBox[{"newPositions", ",", " ", "NumericQ"}], " ", "]"}]}], " ", 
         ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{"MapVertices", "::", "num"}], "]"}]}], " ", "]"}], ";", 
       "\n", "\t", 
       RowBox[{"ReplacePart", "[", " ", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"1", " ", "->", " ", "newPositions"}]}], " ", "]"}]}]}], 
     "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
     RowBox[{"Length", "[", "lst", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MapVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "f_", 
    " ", ",", " ", "lst_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MapVertices", "::", "lst"}], ",", " ", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MapVertices", "::", "lst"}], " ", "=", " ", 
   "\"\<Provided lists for threading do not have `1` elements.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MapVertices", "::", "num"}], " ", "=", " ", 
   "\"\<Warning: new vertex positions are not numeric.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:00 \
In[6394]:=",ExpressionUUID->"57e36eff-830f-423a-9f08-bbc4d2ae6b4f"]
}, Closed]],

Cell[CellGroupData[{

Cell["MapCells[]", "Subsection",ExpressionUUID->"cb7c2df9-dda8-4d22-bcab-38d90211eab7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MapCells", "[", " ", "f_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", "_"}], "]"}]}], ",", "\n", 
      "\t", "newCells"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newCells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], " ", ",", " ", 
        RowBox[{"f", " ", "/@", " ", "cells"}]}], " ", "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"newCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"{", "}"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MapCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "  ", ",", " ", "f_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MapCells", "[", "f", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6401]:=",ExpressionUUID->"09b6a594-cbdf-4cab-a245-d13a757d3bde"]
}, Closed]],

Cell[CellGroupData[{

Cell["ChangeCellData[]", "Subsection",ExpressionUUID->"afbbe164-7b3e-47ea-a2ad-cb64baca94de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "no", " ", "data", " ", "to", " ", "process", " ", "so", " ", "do", " ", 
    "nothing"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"anything_", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", "m"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6403]:=",ExpressionUUID->"e06a8438-b3a3-4482-aaa8-b7c1fbeb97d2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"matrixCellHeads", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"Join", "[", 
     RowBox[{"angleCells", ",", " ", "edgeCells"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vertexCellHeads", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"Join", "[", 
     RowBox[{"vertexCells", ",", 
      RowBox[{"{", "AnyJoint", "}"}]}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"faceCellHeads", " ", "=", " ", 
    RowBox[{"Alternatives", "@@", "faceCells"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"modifyCellDataArguments", "[", " ", 
   RowBox[{"matrixCellHeads", " ", ",", " ", "cellList_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"MatrixQ", "[", 
   RowBox[{"cellList", ",", " ", "IntegerQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"modifyCellDataArguments", "[", " ", 
   RowBox[{"faceCellHeads", " ", ",", " ", "cellList_List"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Depth", "[", "cellList", "]"}], " ", "==", " ", "3"}], " ", "&&",
    " ", 
   RowBox[{"VectorQ", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", "cellList", "]"}], ",", " ", "IntegerQ"}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"modifyCellDataArguments", "[", " ", 
   RowBox[{"vertexCellHeads", " ", ",", " ", "cellList_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"VectorQ", "[", 
   RowBox[{"cellList", ",", " ", "IntegerQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"modifyCellDataArguments", "[", " ", 
   RowBox[{"_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6404]:=",ExpressionUUID->"2efeb8e3-c23f-4d4f-b97f-09303f5f11e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"modifyCellDataFromList", "[", " ", 
   RowBox[{
   "m_", " ", ",", " ", "headSpec_", " ", ",", " ", "cellList_", " ", ",", 
    " ", "dataSpec_", " ", ",", " ", "dataList_"}], " ", "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"specifiedCells", " ", "=", " ", 
        RowBox[{"identifyCellFromList2", "[", " ", 
         RowBox[{"headSpec", ",", " ", "cellList", ",", " ", "#"}], "]"}]}], 
       " ", "}"}], ",", "\t\t", "\n", "\t\t", 
      RowBox[{"changeCellDataType", "[", 
       RowBox[{
        RowBox[{"specifiedCells", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Head", "[", "#", "]"}], ",", " ", "dataSpec"}], "}"}], ",",
         " ", 
        RowBox[{"dataList", "[", 
         RowBox[{"[", 
          RowBox[{"specifiedCells", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", "#"}], 
       "]"}]}], "\t\t", "\n", "\t", "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"m", "[", 
    RowBox[{"[", "3", "]"}], "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6411]:=",ExpressionUUID->"0c647acf-3e46-49fa-8987-9662f2a69ea2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
     "cells__"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"ChangeCellData", "[", "cells", "]"}], "[", "m", "]"}]}], "\n", 
  "\n", 
  RowBox[{"(*", 
   RowBox[{"thread", " ", "over", " ", "data"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"data", " ", ":", " ", 
       RowBox[{"_Association", "|", "_List"}]}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"Fold", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ChangeCellData", "[", " ", 
        RowBox[{"cells", " ", ",", " ", "#2"}], " ", "]"}], "[", "#1", "]"}], 
      "&"}], " ", ",", " ", "m", " ", ",", " ", 
     RowBox[{"Normal", "@", "data"}]}], " ", "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"thread", " ", "over", " ", "cells"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{"cells_List", ",", " ", "data_"}], "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"Fold", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ChangeCellData", "[", " ", 
        RowBox[{"#2", ",", " ", "data"}], "]"}], "[", "#1", "]"}], "&"}], ",",
      " ", "m", ",", " ", "cells"}], "]"}]}], "\n", "\n", 
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "thread", " ", "over", " ", "arguments", " ", "of", " ", "the", " ", 
     "form"}], ",", "\n", "\n", "\t", 
    RowBox[{
     RowBox[{"cellSpec", "[", 
      RowBox[{"{", 
       RowBox[{"cell1", ",", " ", "cells2", ",", "..."}], "}"}], "]"}], " ", "->",
      " ", 
     RowBox[{
      RowBox[{"<|", " ", 
       RowBox[{
        RowBox[{"dataSpec1", " ", "->", " ", 
         RowBox[{"{", 
          RowBox[{"data11", ",", " ", "data12", ",", "..."}], "}"}]}], ",", 
        " ", 
        RowBox[{"dataSpec2", " ", "->", " ", 
         RowBox[{"{", 
          RowBox[{"data21", ",", " ", "data22", ",", " ", "..."}], "}"}]}], 
        ",", "..."}], " ", "|>"}], "\n", "\n", "but", " ", "allow", " ", 
      "users", " ", "to", " ", "override", " ", "the", " ", "data", " ", 
      "specified", " ", "if", " ", "they", " ", 
      RowBox[{"want", "."}]}]}]}], "\n", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", "onelist_List", " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"Fold", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ChangeCellData", "[", "#2", "]"}], "[", "#1", "]"}], "&"}], 
    ",", " ", "m", ",", " ", "onelist"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"cells_", " ", "->", " ", 
     RowBox[{"(", 
      RowBox[{"data", " ", ":", " ", 
       RowBox[{"_Association", "|", "_List"}]}], ")"}]}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"Fold", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ChangeCellData", "[", " ", 
       RowBox[{"cells", " ", ",", " ", "#2"}], " ", "]"}], "[", "#1", "]"}], 
     "&"}], " ", ",", " ", "m", " ", ",", " ", 
    RowBox[{"Normal", "@", "data"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{
     RowBox[{"cells_", " ", "->", " ", 
      RowBox[{"(", 
       RowBox[{"data", " ", ":", " ", 
        RowBox[{"_Association", "|", "_List"}]}], ")"}]}], " ", ",", " ", 
     "dataSpec_"}], "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{"cells", " ", ",", " ", "dataSpec"}], " ", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6412]:=",ExpressionUUID->"ed67aec2-e93a-4235-bdfc-437b2aa78bc3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
   "call", " ", "with", " ", "a", " ", "list", " ", "of", " ", "cells", " ", 
    "to", " ", "modify", "\n", "\n", "the", " ", "data", " ", "is", " ", 
    "either", " ", "a", " ", "list", " ", "with", " ", "the", " ", "same", 
    " ", "length", " ", "as", " ", "cellSpec", " ", "or", " ", "not", " ", 
    "a", " ", 
    RowBox[{"list", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"headSpec", " ", ":", " ", 
         RowBox[{"celltypePattern", "|", "_String", "|", "AnyJoint"}]}], 
        ")"}], "[", "cellSpec_", "]"}], ",", " ", 
      RowBox[{"dataSpec_", " ", "->", " ", "data_"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"properCellSpec", " ", "=", " ", 
        RowBox[{"cellSpec", " ", "/.", " ", 
         RowBox[{"Dispatch", "[", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], ",", "\n", "\t\t", 
       RowBox[{"properHeadSpec", " ", "=", " ", 
        RowBox[{"headSpec", " ", "/.", " ", 
         RowBox[{"AnyJoint", " ", "->", " ", 
          RowBox[{"FreeJoint", "|", "PinnedJoint"}]}]}]}]}], "\n", "\t", 
      "}"}], ",", "\n", "\t\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{"properData", " ", "=", " ", 
         RowBox[{"Which", "[", " ", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"ListQ", "[", "data", "]"}], " ", ",", " ", "data", " ", 
           ",", " ", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"Head", "[", "data", "]"}], " ", "===", " ", "Function"}],
            ",", " ", 
           RowBox[{"data", " ", "/@", " ", "properCellSpec"}], ",", "\n", 
           "\t\t\t\t", "True", ",", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"data", ",", " ", 
             RowBox[{"Length", "[", "cellSpec", "]"}]}], "]"}]}], "\n", 
          "\t\t\t", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"modifyCellDataArguments", "[", 
           RowBox[{"headSpec", ",", " ", "properCellSpec"}], " ", "]"}], " ", 
          "&&", " ", 
          RowBox[{
           RowBox[{"Length", "[", "properData", "]"}], " ", "==", " ", 
           RowBox[{"Length", "[", "cellSpec", "]"}]}]}], ",", "\t\t", "\n", 
         "\t\t\t", 
         RowBox[{
          RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t\t", 
           RowBox[{"{", "}"}], ",", "\n", "\t\t\t\t", 
           RowBox[{"modifyCellDataFromList", "[", 
            RowBox[{
            "m", ",", " ", "properHeadSpec", ",", " ", "properCellSpec", ",", 
             " ", "dataSpec", ",", " ", "properData"}], "]"}], ",", "\n", 
           "\t\t\t\t", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}], ",", "\n", "\t\t\t\t", 
           RowBox[{"m", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "\n", "\t\t\t", "]"}], ",", 
         "\n", "\t\t\t", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"modifyCellDataArguments", "[", 
              RowBox[{"headSpec", ",", " ", "properCellSpec"}], " ", "]"}]}], 
            " ", ",", " ", "\n", "\t\t\t\t", 
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", "headSpec", "]"}], "===", "String"}], ",",
               " ", "\n", "\t\t\t\t\t", 
              RowBox[{"Message", "[", 
               RowBox[{
                RowBox[{"ChangeCellData", "::", "tag"}], ",", " ", 
                RowBox[{"headSpec", "[", "cellSpec", "]"}]}], " ", "]"}], ",",
               "\n", "\t\t\t\t\t", 
              RowBox[{"Message", "[", 
               RowBox[{
                RowBox[{"ChangeCellData", "::", "errcells"}], ",", " ", 
                RowBox[{"headSpec", "[", "cellSpec", "]"}]}], " ", "]"}]}], 
             "\n", "\t\t\t\t", "]"}]}], "\n", "\t\t\t", "]"}], ";", "\n", 
          "\t\t\t", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "properData", "]"}], " ", "!=", " ", 
             RowBox[{"Length", "[", "cellSpec", "]"}]}], " ", ",", " ", 
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"ChangeCellData", "::", "datalen"}], ",", " ", 
              RowBox[{"headSpec", "[", "cellSpec", "]"}]}], " ", "]"}]}], 
           "]"}], ";", "\n", "\t\t\t", "m"}]}], "\n", "\t\t", "]"}]}], "\n", 
      "\t", "]"}]}], "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6418]:=",ExpressionUUID->"e6ce7f6c-8260-45f8-9a32-3e00b65e1e2a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "use", " ", "a", " ", "function", " ", "to", " ", "identify", " ", "data", 
    " ", "to", " ", "modify"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{
       RowBox[{"something", " ", ":", " ", 
        RowBox[{"Except", "[", 
         RowBox[{"_AnyJoint", "|", "_List", "|", 
          RowBox[{"_String", "[", "_", "]"}], "|", 
          RowBox[{"celltypePattern", "[", "_", "]"}]}], "]"}]}], ",", " ", 
       "data_"}], " ", "]"}], "[", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cellList", " ", "=", " ", 
        RowBox[{"something", "[", "m", "]"}]}], "}"}], ",", " ", "\n", "\t", 
      RowBox[{"If", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "cellList", "]"}], " ", "===", " ", 
         "something"}], " ", ",", "  ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"ChangeCellData", "::", "errcells"}], ",", " ", 
           "something"}], "]"}], ";", " ", "m"}], ",", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"ChangeCellData", "[", " ", 
          RowBox[{"cellList", " ", ",", " ", "data"}], " ", "]"}], "[", "m", 
         "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{"something", " ", ":", " ", 
       RowBox[{"_AnyJoint", "|", 
        RowBox[{"celltypePattern", "[", "_", "]"}]}]}], " ", "]"}], "[", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ChangeCellData", "::", "dataspec"}], ",", "something"}], 
       "]"}], ";", " ", "m"}], ")"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{"something", " ", ":", " ", 
       RowBox[{"_String", "[", "_", "]"}]}], " ", "]"}], "[", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"ChangeCellData", "::", "tag"}], ",", "something"}], "]"}], 
      ";", " ", "m"}], ")"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "use", " ", "a", " ", "function", " ", "to", " ", "identify", " ", "data",
      " ", "to", " ", "modify", " ", "and", " ", "what", " ", "to", " ", 
     "modify", " ", "it", " ", "to"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "[", " ", 
      RowBox[{"something", " ", ":", " ", 
       RowBox[{"Except", "[", "_List", "]"}]}], " ", "]"}], "[", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cellList", " ", "=", " ", 
        RowBox[{"something", "[", "m", "]"}]}], "}"}], ",", " ", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "cellList", "]"}], " ", "===", " ", "List"}], 
        " ", ",", " ", 
        RowBox[{
         RowBox[{"ChangeCellData", "[", " ", "cellList", " ", "]"}], "[", "m",
          "]"}], ",", "  ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"ChangeCellData", "::", "errall"}], ",", " ", 
           "something"}], "]"}], ";", " ", "m"}]}], " ", "]"}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "::", "dataspec"}], "=", 
     "\"\<`1` requires a specification of what data to modify.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "::", "tag"}], "=", 
     "\"\<`1` cannot be a tagged cell. Tagged cells have no data to \
modify\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "::", "errcells"}], "=", 
     "\"\<`1` must be of the form headSpec[{cell1, cell2, ...}] or evaluate \
to a list of cells when acting on a mechanism.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ChangeCellData", "::", "errall"}], "=", 
     "\"\<`1` must evaluate to a list of cells and a list of data to modify \
when acting on a mechanism.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6419]:=",ExpressionUUID->"ad64f41c-7efa-4de5-96f7-a7293f9b21e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", 
     RowBox[{
      RowBox[{"headSpec_", "[", "cellSpec_", "]"}], " ", ",", " ", 
      "badrule_"}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "badrule", "]"}], " ", "=!=", " ", "Rule"}], ",",
        " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"ChangeCellData", "::", "data"}], ",", " ", "badrule"}], 
        "]"}]}], "]"}], ";", "\n", "\t", "m"}], "\n", "  ", ")"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "datalen"}], " ", "=", " ", 
   "\"\<The data provided is not the same length as the cells `1`.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ChangeCellData", "::", "data"}], " ", "=", " ", 
   "\"\<The data to modify, `1`, is not of the form dataSpec -> \
newData.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6427]:=",ExpressionUUID->"779aed46-ffda-4fb2-89d9-2e35f2b4cbdf"]
}, Closed]],

Cell[CellGroupData[{

Cell["JoinMechanism[]", "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "JoinMechanism", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"OverlapPrecision", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "12"}], ")"}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JoinMechanism", "[", " ", 
    RowBox[{
     RowBox[{"meshes", " ", ":", " ", 
      RowBox[{
       RowBox[{"__", "?", "MechanismQ"}], "|", 
       RowBox[{"{", 
        RowBox[{"__", "?", "MechanismQ"}], "}"}]}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", " ", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "meshes", "}"}], "]"}]}], ",", " ", 
       RowBox[{"meshOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", " ", 
          RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}]}], " ", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"num", " ", "=", " ", 
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", "1", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "+", "1"}], "&"}], " ", "/@", " ", 
                 RowBox[{"Accumulate", "[", " ", 
                  RowBox[{"Length", " ", "/@", " ", 
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}]}],
                " ", "}"}], ",", " ", "1"}], " ", "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
        RowBox[{"addMeshRegion", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"deleteDegenerateCellsFromMechanism", "[", "\n", "\t\t\t\t", 
           RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{"m", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", "\n", 
              "\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"m", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "1"}], "]"}],
                ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"{", "}"}], ",", "\n", "\t\t\t\t\t\t", 
               RowBox[{"joinCells", "[", " ", 
                RowBox[{"Flatten", " ", "@", " ", 
                 RowBox[{"MapThread", "[", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"replaceCellIndices", "[", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{
                    "n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}]}], "]"}],
                     "&"}], ",", " ", 
                   RowBox[{"{", " ", 
                    RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], "]"}]}], " ", "]"}], ",", "\n", 
               "\t\t\t\t\t\t", 
               RowBox[{"Flatten", " ", "@", " ", 
                RowBox[{"MapThread", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"replaceRules", "[", " ", 
                    RowBox[{"#1", ",", " ", 
                    RowBox[{"n_Integer", " ", "\[Rule]", " ", 
                    RowBox[{"n", " ", "+", " ", "#2", " ", "-", " ", "1"}]}], 
                    ",", " ", "2"}], " ", "]"}], "&"}], ",", " ", 
                  RowBox[{"{", " ", 
                   RowBox[{
                    RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "4"}], "]"}], "]"}], ",", " ", 
                    "num"}], " ", "}"}]}], " ", "]"}]}], ",", "\n", 
               "\t\t\t\t\t\t", 
               RowBox[{"Join", " ", "@@", " ", 
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], " ", 
              RowBox[{"(*", 
               RowBox[{"Need", " ", "to", " ", "improve", " ", "this"}], 
               "*)"}], "\n", "\t\t\t\t\t", "]"}], ",", "\n", "\t\t\t\t\t", 
             RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", 
            "\t\t\t\t", "]"}], "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          "Automatic", ",", "\n", "\t\t\t", "meshOptions"}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"LinkagePrecisionQ", "[", " ", 
        RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}], " ", "]"}], 
       " ", "&&", " ", 
       RowBox[{"sameHeadsQ", "[", " ", "m", " ", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "comb"}], " ", "=", " ", 
   "\"\<Cannot combine Mechanisms of different types.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sameHeadsQ", "[", " ", "expr_List", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"SameQ", "[", " ", 
     RowBox[{"Head", " ", "/@", " ", "expr"}], " ", "]"}], ",", " ", "True", 
    ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"Mechanism", "::", "comb"}], "]"}], ";", " ", "False"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6430]:=",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],

Cell[CellGroupData[{

Cell["SelectCells[], DeleteCells[]", "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"makeListOfCells", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"head", " ", ":", " ", 
       RowBox[{"celltypePattern", "|", "_String"}]}], ")"}], "[", "cells_", 
     "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"identifyCellFromList", "[", " ", 
     RowBox[{"head", ",", " ", "cells", ",", " ", "#"}], "]"}], "&"}], " ", "/@",
    " ", 
   RowBox[{"m", "[", 
    RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"makeListOfCells", "[", " ", 
    RowBox[{"m_", " ", ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"head", " ", ":", " ", 
         RowBox[{"celltypePattern", "|", "_String"}]}], ")"}], "[", "cells_", 
       "]"}], " ", "->", " ", "anything_"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"identifyCellFromList", "[", " ", 
      RowBox[{"head", ",", " ", "cells", ",", " ", "#"}], "]"}], "&"}], " ", "/@",
     " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"(*", 
    RowBox[{"list", " ", "of", " ", "indices", " ", "only"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"makeListOfCells", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"cellSpec_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"VectorQ", "[", 
          RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}],
     " ", ":=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"identifyCellFromList", "[", " ", 
       RowBox[{
        RowBox[{"Head", "[", "#", "]"}], ",", " ", "cellSpec", ",", " ", 
        "#"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"m", "[", 
      RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"makeListOfCells", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "cellSpec_List"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"MapThread", "[", " ", 
    RowBox[{"Join", ",", " ", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"makeListOfCells", "[", 
          RowBox[{"m", ",", "#"}], "]"}], "&"}], " ", "/@", " ", "cellSpec"}],
        ",", " ", "$Failed"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"makeListOfCells", "[", " ", 
   RowBox[{"m_", " ", ",", " ", 
    RowBox[{"something", " ", ":", " ", 
     RowBox[{"Except", "[", 
      RowBox[{"_List", "|", "_Rule", "|", 
       RowBox[{"_String", "[", "_", "]"}]}], "]"}]}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{"something", "[", "m", "]"}]}], " ", "}"}], ",", " ", "\n", 
    "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "cells", "]"}], " ", "=!=", " ", "something"}], 
      ",", " ", 
      RowBox[{"makeListOfCells", "[", 
       RowBox[{"m", ",", " ", "cells"}], "]"}], ",", " ", "$Failed"}], 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6434]:=",ExpressionUUID->"0bcdf794-fb09-4103-a92f-306e3f19e655"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SelectCells", "[", " ", "cellSpec_", " ", "]"}], "[", 
    RowBox[{"m", ":", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"loc", "=", 
       RowBox[{"makeListOfCells", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"cellSpec", " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}]}], "]"}]}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"loc", " ", "===", " ", "$Failed"}], ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"SelectCells", "::", "spec"}], ",", " ", "cellSpec"}], 
         "]"}], ";", " ", "m"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Length", "[", "loc", "]"}], "==", "0"}], ",", " ", 
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"m", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", "True", 
       ",", " ", 
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{"takeCells", ",", " ", 
            RowBox[{"{", 
             RowBox[{"loc", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], " ", "}"}]}], " ", "]"}], 
          " ", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"m", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t",
       "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SelectCells", "[", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"addMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"SelectCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
     "Automatic", " ", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SelectCells", "::", "spec"}], "=", 
   "\"\<Selection function `1` does not evaluate to a valid list of cells \
when applied to mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6438]:=",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteCells", "[", " ", "cellSpec_", " ", "]"}], "[", 
    RowBox[{"m", ":", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"loc", "=", 
       RowBox[{"makeListOfCells", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"cellSpec", " ", "/.", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "]"}]}], "}"}], ",", "\n",
      "\t", 
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"loc", " ", "===", " ", "$Failed"}], ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DeleteCells", "::", "spec"}], ",", " ", "cellSpec"}], 
         "]"}], ";", " ", "m"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Length", "[", "loc", "]"}], "==", "0"}], ",", " ", "m", ",", 
       "\n", "\t\t", "True", ",", " ", 
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", "}"}], ",", "\n", "\t\t\t", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{"removeCells", ",", " ", 
            RowBox[{"{", 
             RowBox[{"loc", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], " ", "}"}]}], " ", "]"}], 
          " ", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"m", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t",
       "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteCells", "[", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "patt_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"addMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"DeleteCells", "[", "patt", "]"}], "[", "m", "]"}], ",", " ", 
     "Automatic", " ", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteCells", "::", "spec"}], "=", 
   "\"\<Selection function `1` does not evaluate to a valid list of cells \
when applied to mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6441]:=",ExpressionUUID->"5198b681-d64a-4e20-97b8-8e031eacc149"]
}, Closed]],

Cell[CellGroupData[{

Cell["AddCells[]", "Subsection",ExpressionUUID->"ba379b12-e39c-49a0-ba40-463bc3626108"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "AddCells", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "Linkage", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddCells", "[", " ", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"parsed", " ", "=", " ", 
        RowBox[{"parseCells", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], " ", "}"}], " ", ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "cells", "}"}], "]"}]}], "]"}]}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"deleteDegenerateCellsFromMechanism", "[", " ", 
       RowBox[{"removeOverlappingCoordinates", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "m", "]"}], "[", 
          RowBox[{
           RowBox[{"parsed", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{"parsed", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"parsed", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
           RowBox[{"m", "[", 
            RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t", 
         RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "\n", "\t", 
        "]"}], " ", "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"LinkagePrecisionQ", "[", " ", 
     RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}], " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"AddCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "cells_", ",",
     " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"AddCells", "[", " ", 
      RowBox[{"cells", ",", " ", "opt"}], " ", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", ",", " ", 
    RowBox[{"FilterRules", "[", " ", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", " ", 
      RowBox[{"Options", "[", "MeshRegion", "]"}]}], "]"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6444]:=",ExpressionUUID->"a23612de-3cf0-403e-b850-8a9c7144e63f"]
}, Closed]],

Cell[CellGroupData[{

Cell["DeleteVertices[]", "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DeleteVertices", "[", "f_", "]"}], "[", 
   RowBox[{"m", ":", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vertices", "=", 
      RowBox[{"f", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", "vertices", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"DeleteVertices", "[", "vertices", "]"}], "[", "m", "]"}], " ",
       ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"DeleteVertices", "::", "err"}], ",", " ", "f"}], "]"}], ";",
        " ", "m"}]}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteVertices", "[", " ", 
     RowBox[{"vertices_", "?", "VectorQ"}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", "\n", 
   
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pattern", " ", "=", " ", 
       RowBox[{"Alternatives", " ", "@@", " ", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"___", ",", "#", ",", "___"}], "}"}], "|", "#"}], "&"}], 
          " ", "/@", " ", "vertices"}], " ", ")"}]}]}], " ", "}"}], ",", "\n", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"remainingCells", " ", "=", " ", 
         RowBox[{"Flatten", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"removeCells", "[", " ", 
             RowBox[{
              RowBox[{"casesCellType", "[", " ", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Head", "[", "#", "]"}], "[", "pattern", "]"}], 
                 "}"}], " ", ",", " ", "#"}], " ", "]"}], ",", " ", "#"}], 
             " ", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"m", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], " ", "]"}]}], " ", "}"}], ",", 
       "\n", 
       RowBox[{"With", "[", " ", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"remainingVertices", " ", "=", " ", 
           RowBox[{"Complement", "[", " ", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", 
               RowBox[{"m", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"vertices", " ", "/.", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}]}], " ", "]"}]}], " ", "}"}], 
         ",", "\n", 
         RowBox[{"With", "[", " ", 
          RowBox[{
           RowBox[{"{", " ", 
            RowBox[{"remappingRules", " ", "=", " ", 
             RowBox[{"Thread", "[", " ", 
              RowBox[{"remainingVertices", " ", "\[Rule]", " ", 
               RowBox[{"Range", "[", 
                RowBox[{"Length", "[", "remainingVertices", "]"}], "]"}]}], 
              "]"}]}], " ", "}"}], ",", "\n", "\t", 
           RowBox[{
            RowBox[{"Head", "[", "m", "]"}], "[", "\n", "\t\t", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "remainingVertices"}], "]"}], "]"}], 
             ",", "\n", "\t\t", 
             RowBox[{"{", "}"}], ",", "\n", "\t\t", 
             RowBox[{"replaceCellIndices", "[", " ", 
              RowBox[{"remainingCells", ",", " ", "remappingRules"}], " ", 
              "]"}], ",", "\n", "\t\t", 
             RowBox[{"replaceRules", "[", " ", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", "4", "]"}], "]"}], ",", " ", "remappingRules", 
               ",", " ", "2"}], " ", "]"}], ",", "\n", "\t\t", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", "5", "]"}], "]"}], " ", "/.", " ", 
              "remappingRules"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], 
        "]"}]}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteVertices", "::", "err"}], " ", "=", " ", 
   "\"\<`1` did not evaluate to a list of vertices when evaluated.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6447]:=",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "vertices_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"DeleteVertices", "[", "vertices", "]"}], "[", "m", "]"}], ",", 
    " ", "Automatic", " ", ",", " ", 
    RowBox[{"{", "}"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6450]:=",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],

Cell[CellGroupData[{

Cell["TagCells[]", "Subsection",ExpressionUUID->"412267ca-b4cd-4402-8196-31c933c269a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TagCells", "[", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", " ", ":", " ", "_String"}], ")"}], "[", " ", "indexList_", 
     " ", "]"}], " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"Head", "[", "m", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"m", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
    RowBox[{"joinCells", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"packCells", "[", " ", 
        RowBox[{"{", 
         RowBox[{"s", "[", 
          RowBox[{"indexList", ",", " ", 
           RowBox[{"{", "}"}]}], " ", "]"}], "}"}], " ", "]"}], ",", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], " ", "}"}], " ", "]"}], ",", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "4", "]"}], "]"}], " ", ",", " ", 
    RowBox[{"m", "[", 
     RowBox[{"[", "5", "]"}], "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"TagCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", " ", ":", " ", "_String"}], ")"}], "[", " ", "indexList_", 
     " ", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"TagCells", "[", 
    RowBox[{"s", ",", "indexList"}], "]"}], "[", "m", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6451]:=",ExpressionUUID->"065b9a63-e5d1-40c0-a6bb-fb3c2b40fe15"]
}, Closed]],

Cell[CellGroupData[{

Cell["LabelVertices[]", "Subsection",ExpressionUUID->"3684becb-1fd7-4274-a7c3-48a7bbce7a72"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", "\"\<Name\>\"", " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"ChangeCellData", "[", " ", 
    RowBox[{
     RowBox[{"AnyJoint", "[", 
      RowBox[{"Range", "[", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
     RowBox[{"\"\<Label\>\"", " ", "->", " ", 
      RowBox[{"m", "[", "\"\<LabeledVertices\>\"", "]"}]}]}], " ", "]"}], " ",
    "@", " ", "m"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", "\"\<Index\>\"", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"ChangeCellData", "[", 
    RowBox[{
     RowBox[{"AnyJoint", "[", 
      RowBox[{"Range", "[", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
     RowBox[{"\"\<Label\>\"", " ", "->", " ", "\"\<Index\>\""}]}], "]"}], "@",
    "m"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", "None", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"ChangeCellData", "[", 
    RowBox[{
     RowBox[{"AnyJoint", "[", 
      RowBox[{"Range", "[", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
     RowBox[{"\"\<Label\>\"", " ", "->", " ", "None"}]}], "]"}], "@", 
   "m"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LabelVertices", "[", " ", 
     RowBox[{"rules", " ", ":", " ", 
      RowBox[{
       RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}], " ", "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ruleList", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rules", "}"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"ChangeCellData", "[", 
       RowBox[{
        RowBox[{"AnyJoint", "[", 
         RowBox[{
          RowBox[{"ruleList", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"m", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "]"}], ",", " ", 
        RowBox[{"\"\<Label\>\"", " ", "->", " ", 
         RowBox[{"ruleList", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "]"}], " ", "@", " ", 
      "m"}]}], "\n", "]"}]}], "\n", "\t"}], "\n", 
 RowBox[{
  RowBox[{"LabelVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "\"\<Name\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ChangeCellData", "[", " ", 
   RowBox[{"m", ",", " ", 
    RowBox[{"AnyJoint", "[", 
     RowBox[{"Range", "[", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
    
    RowBox[{"\"\<Label\>\"", " ", "->", " ", 
     RowBox[{"m", "[", "\"\<LabeledVertices\>\"", "]"}]}]}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"LabelVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "\"\<Index\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"ChangeCellData", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"AnyJoint", "[", 
     RowBox[{"Range", "[", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
    
    RowBox[{"\"\<Label\>\"", " ", "->", " ", "\"\<Index\>\""}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"LabelVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "None"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"ChangeCellData", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"AnyJoint", "[", 
     RowBox[{"Range", "[", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], "]"}], ",", " ", 
    
    RowBox[{"\"\<Label\>\"", " ", "->", " ", "None"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"LabelVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}]}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ruleList", " ", "=", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "rules", "}"}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"ChangeCellData", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"AnyJoint", "[", 
       RowBox[{
        RowBox[{"ruleList", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "/.", " ", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"m", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "]"}], ",", " ", 
      RowBox[{"\"\<Label\>\"", " ", "->", " ", 
       RowBox[{"ruleList", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6453]:=",ExpressionUUID->"c3606539-ede2-400e-a3d5-8726cc1277fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", "lst_List", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"ChangeCellData", "[", 
     RowBox[{
      RowBox[{"AnyJoint", "[", " ", 
       RowBox[{"Range", "[", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], " ", "]"}], 
      ",", " ", 
      RowBox[{"\"\<Label\>\"", "->", "lst"}]}], "]"}], " ", "@", " ", "m"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "lst", "]"}], "==", 
    RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LabelVertices", "[", " ", "lst_List", " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"LabelVertices", "::", "length"}], ",", " ", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"LabelVertices", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    "lst_List"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"LabelVertices", "::", "length"}], ",", " ", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "lst_List"}],
     " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"ChangeCellData", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"AnyJoint", "[", " ", 
       RowBox[{"Range", "[", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], " ", "]"}], 
      ",", " ", 
      RowBox[{"\"\<Label\>\"", "->", "lst"}]}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "lst", "]"}], "==", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", "_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"LabelVertices", "::", "bad"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", "_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"LabelVertices", "::", "bad"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "::", "length"}], "=", 
   "\"\<Length of labels does not match number of vertices, `1`.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LabelVertices", "::", "bad"}], "=", 
   "\"\<First argument should be a label, list of labels, or list of rules \
assigning labels to a vertex.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6461]:=",ExpressionUUID->"e9e16aa8-6474-42db-9f13-7de59ad6bf66"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReplaceCells[]", "Subsection",ExpressionUUID->"d0c35cf8-0b87-48ac-a7b6-ac6214c5e506"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReplaceCells", "[", " ", "f_", " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"unparseCells", "[", 
         RowBox[{
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "_"}], "]"}]}]}], ",", "\n", 
      "\t", "newCells"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newCells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], " ", ",", " ", 
        RowBox[{"cells", " ", "/.", " ", "f"}]}], " ", "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"newCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"{", "}"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ReplaceCells", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "  ", ",", " ", "f_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"addMeshRegion", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ReplaceCells", "[", "f", "]"}], "[", "m", "]"}], ",", " ", 
    "Automatic", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6469]:=",ExpressionUUID->"ae90439d-a70d-4425-a0a1-5b1950ad9dab"]
}, Closed]],

Cell[CellGroupData[{

Cell["TesselateMechanism[]", "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "TesselateMechanism", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"OverlapPrecision", "\[Rule]", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "6"}], ")"}]}]}], "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6471]:=",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "counter"}], "=", 
   "\"\<Number of cells must be positive integers corresponding to the number \
of basis elements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "dim"}], "=", 
   "\"\<Basis must be `1` dimensional to match Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "::", "num"}], "=", 
   "\"\<Basis must be numerical with vectors of the same dimension.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TesselateMechanism", "::", "basis"}], "=", 
    "\"\<Basis must be a list of `1` numerical vectors.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tesselationBasisQ", "[", " ", 
    RowBox[{"m_", ",", " ", "d_", ",", " ", "basis_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"MatrixQ", "[", 
       RowBox[{"basis", ",", "NumericQ"}], "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{"TesselateMechanism", "::", "num"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Length", "[", "basis", "]"}], " ", "\[NotEqual]", " ", "d"}], 
     ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"TesselateMechanism", "::", "basis"}], ",", " ", "d"}], " ", 
       "]"}], ";", " ", "False"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"Dimensions", "[", "basis", "]"}], "]"}], " ", "\[NotEqual]", 
      " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", " ", 
       RowBox[{
        RowBox[{"TesselateMechanism", "::", "dim"}], ",", " ", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], " ", "]"}], 
      ";", " ", "False"}], ",", "\n", "\t", "True", ",", " ", "True"}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", 
   RowBox[{"n1__Integer", "?", "Positive"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"tesselationCellCountsQ", "[", " ", "__", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"TesselateMechanism", "::", "counter"}], "]"}], ";", " ", 
    "False"}], ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6472]:=",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"translateLabels", "[", " ", 
   RowBox[{"n_", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"translateLabels", "[", 
    RowBox[{"n_", ",", " ", 
     RowBox[{"ruleList", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Rule", "[", " ", 
         RowBox[{"_", ",", " ", "_"}], " ", "]"}], ".."}], "}"}]}]}], " ", 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"labels", ",", " ", "indices", ",", " ", "nstring"}], "}"}], 
     " ", ",", "  ", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"labels", ",", " ", "indices"}], "}"}], " ", "=", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"List", " ", "@@@", " ", "ruleList"}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "create", " ", "a", " ", "string", " ", "of", " ", "the", " ", "form", 
        " ", "\"\<[n1,n2,...]\>\"", " ", "with", " ", "no", " ", "spaces"}], 
       "*)"}], "\n", "\t", 
      RowBox[{"nstring", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"\"\<[\>\"", ",", 
         RowBox[{"ToString", "/@", 
          RowBox[{"Riffle", "[", 
           RowBox[{"n", ",", "\"\<,\>\""}], "]"}]}], ",", "\"\<]\>\""}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"Rule", " ", "@@@", " ", 
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "@@", "n"}], "&"}], " ", "/@", " ", "labels"}], " ", 
          ",", " ", "indices"}], " ", "}"}], " ", "]"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"translateCoordinates", "[", " ", 
   RowBox[{"positions_", ",", " ", "translationVector_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"positions", " ", "+", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"translationVector", ",", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6479]:=",ExpressionUUID->"721a18ca-3636-47ac-8ec2-4481f8e47919"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TesselateMechanism", "[", " ", "everything___", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
  RowBox[{"TesselateMechanism", "[", 
   RowBox[{"m", ",", " ", "everything"}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6482]:=",ExpressionUUID->"dd25d513-ac16-415e-bbdb-02167d2267b4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"n1", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
       "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"n1", "-", "1"}]}], "]"}]}], ",", " ", "\n", "\t", 
       "newCoordinates", ",", " ", "translatedMechanisms"}], "\n", "}"}], ",",
      "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"basis", " ", "#"}]}], " ", "]"}], "&"}], " ", "/@", " ", 
        "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", " ", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}]}], " ", "]"}], 
          "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "1", ",", " ", 
      RowBox[{"{", "basis", "}"}]}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "1"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6483]:=",ExpressionUUID->"52292cab-859e-4526-ad11-c2375d158cee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"n1_", ",", " ", "n2_"}], "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
       "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#1", "-", "1"}], ",", 
               RowBox[{"#2", "-", "1"}]}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
       ",", "\n", "\t", "newCoordinates", ",", " ", "translatedMechanisms"}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"#", " ", ".", " ", "basis"}]}], " ", "]"}], "&"}], " ", "/@",
         " ", "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "5", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "2", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6484]:=",ExpressionUUID->"d24fd5c7-bb15-4547-9025-38b6386831cb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TesselateMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "basis_", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"n1_", ",", " ", "n2_", ",", " ", "n3_"}], "}"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
       "\t", 
       RowBox[{"unitCellIndices", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#1", "-", "1"}], ",", 
               RowBox[{"#2", "-", "1"}], ",", 
               RowBox[{"#3", "-", "1"}]}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{"n1", ",", "n2", ",", "n3"}], "}"}]}], "]"}], ",", "2"}],
          "]"}]}], ",", "\n", "\t", "newCoordinates", ",", " ", 
       "translatedMechanisms"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"newCoordinates", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"translateCoordinates", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"#", " ", ".", " ", "basis"}]}], " ", "]"}], "&"}], " ", "/@",
         " ", "unitCellIndices"}]}], ";", "\n", "\t", 
      RowBox[{"translatedMechanisms", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "m", "]"}], "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
            RowBox[{"translateLabels", "[", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"m", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], ",", " ", 
            RowBox[{"m", "[", 
             RowBox[{"[", "5", "]"}], "]"}]}], "]"}], "&"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"newCoordinates", ",", " ", "unitCellIndices"}], "}"}]}], 
        " ", "]"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"JoinMechanism", "[", " ", 
       RowBox[{"translatedMechanisms", ",", " ", "opt"}], " ", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"tesselationBasisQ", "[", 
     RowBox[{"m", ",", " ", "3", ",", " ", "basis"}], "]"}], " ", "&&", " ", 
    RowBox[{"tesselationCellCountsQ", "[", 
     RowBox[{"n1", ",", "n2", ",", "n3"}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6485]:=",ExpressionUUID->"2cf05f30-ea55-4528-b268-4f693ccc6344"]
}, Closed]],

Cell[CellGroupData[{

Cell["ReplaceAll[]", "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"replaceAll", "[", " ", 
    RowBox[{
     RowBox[{"f", " ", ":", " ", "mechanismPattern"}], ",", " ", "rule_"}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Head", "[", "f", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ReplaceAll", "[", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "rule"}], "]"}], " ", ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
     RowBox[{"replaceCellData", "[", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", " ", "rule"}], " ", "]"}], ",", 
     RowBox[{"f", "[", 
      RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
     RowBox[{"f", "[", 
      RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "rule_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"replaceAll", "[", " ", 
   RowBox[{"f", ",", " ", "rule"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ReplaceAll", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "rule_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"replaceAll", "[", 
   RowBox[{"o", ",", " ", "rule"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6486]:=",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Precision[], Rationalize[], N[]", "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Precision", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"f", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Precision", "[", " ", "o_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Precision", "[", " ", 
   RowBox[{"o", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6489]:=",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"Rationalize", "[", " ", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Rationalize", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"Rationalize", "[", " ", 
       RowBox[{
        RowBox[{"o", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6491]:=",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"f", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"N", "[", " ", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"N", "[", " ", 
   RowBox[{"o_Origami", ",", " ", "dx___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"ReplacePart", "[", " ", 
   RowBox[{"o", ",", " ", 
    RowBox[{"1", " ", "\[Rule]", " ", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"N", "[", " ", 
       RowBox[{
        RowBox[{"o", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", "dx"}], " ", "]"}], 
      "]"}]}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6493]:=",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
AddOption[], KeyExistsQ[], Keys[], Delete[], Values[], OptionValue[]\
\>", "Subsection",ExpressionUUID->"6bc909e8-5f39-4ed2-9697-1d33e51b17b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddOption", "[", " ", 
     RowBox[{
      RowBox[{"rules", " ", ":", " ", 
       RowBox[{
        RowBox[{"{", "__Rule", "}"}], "|", "_Rule"}]}], " ", ",", " ", 
      RowBox[{"f_", " ", ":", " ", "Flatten"}]}], "]"}], "[", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", 
    RowBox[{"\"\<addendum\>\"", ",", " ", 
     RowBox[{"Merge", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], " ", ",", " ", 
         RowBox[{"Association", "@@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "rules", "}"}], "]"}]}]}], " ", "}"}], ",", " ", 
       "f"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"AddOption", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    "assoc_Association", ",", " ", 
    RowBox[{"f_", " ", ":", " ", "Flatten"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", 
   RowBox[{"\"\<addendum\>\"", ",", " ", 
    RowBox[{"Merge", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], " ", ",", " ", "assoc"}],
        "}"}], ",", " ", "f"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"AddOption", "[", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
    RowBox[{"rules", " ", ":", " ", 
     RowBox[{"{", "__Rule", "}"}]}], ",", " ", 
    RowBox[{"f_", " ", ":", " ", "Flatten"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", 
   RowBox[{"\"\<addendum\>\"", ",", " ", 
    RowBox[{"Merge", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], " ", ",", " ", 
        RowBox[{"Association", "@@", "rules"}]}], "}"}], ",", " ", "f"}], 
     "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AddOption", "[", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     RowBox[{"rules", " ", ":", " ", "_Rule"}], ",", " ", 
     RowBox[{"f_", " ", ":", " ", "Flatten"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", 
    RowBox[{"\"\<addendum\>\"", ",", " ", 
     RowBox[{"Merge", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], " ", ",", " ", 
         RowBox[{"Association", "[", "rules", "]"}]}], "}"}], ",", " ", "f"}],
       "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Delete", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "option_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"m", "[", 
   RowBox[{"\"\<addendum\>\"", ",", " ", 
    RowBox[{"Delete", "[", " ", 
     RowBox[{
      RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", 
      RowBox[{"Key", "[", "option", "]"}]}], " ", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Delete", "[", " ", 
    RowBox[{"m_Linkage", ",", " ", "option_"}], " ", "]"}], " ", "^:=", " ", 
   RowBox[{"m", "[", 
    RowBox[{"\"\<addendum\>\"", ",", " ", 
     RowBox[{"Delete", "[", " ", 
      RowBox[{
       RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", 
       RowBox[{"Key", "[", "option", "]"}]}], " ", "]"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"KeyExistsQ", "[", " ", 
   RowBox[{"m_Origami", " ", ",", " ", "option_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"KeyExistsQ", "[", " ", 
   RowBox[{
    RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", "option"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"KeyExistsQ", "[", " ", 
    RowBox[{"m_Linkage", " ", ",", " ", "option_"}], "]"}], " ", "^:=", " ", 
   RowBox[{"KeyExistsQ", "[", " ", 
    RowBox[{
     RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", "option"}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Keys", "[", " ", "m_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Keys", "[", 
   RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Keys", "[", " ", "m_Linkage", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Keys", "[", 
   RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Values", "[", " ", "m_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Values", "[", 
   RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Values", "[", " ", "m_Linkage", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Values", "[", 
   RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Values", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "h_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"Values", "[", 
   RowBox[{
    RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", "h"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Values", "[", " ", 
    RowBox[{"m_Linkage", " ", ",", " ", "h_"}], "]"}], " ", "^:=", " ", 
   RowBox[{"Values", "[", 
    RowBox[{
     RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", "h"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"OptionValue", "[", 
   RowBox[{"m_Linkage", ",", " ", "option_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"Lookup", "[", " ", 
   RowBox[{
    RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", "option", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"OptionValue", "[", 
   RowBox[{"m_Origami", ",", " ", "option_"}], "]"}], " ", "^:=", " ", 
  RowBox[{"Lookup", "[", " ", 
   RowBox[{
    RowBox[{"m", "[", "\"\<addendum\>\"", "]"}], ",", " ", "option", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6495]:=",ExpressionUUID->"082dac8c-4b17-4565-a601-5accbfae66ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["DivideEdges[]", "Subsection",ExpressionUUID->"66fa220e-d189-4daf-a3ca-36eca354f7e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DivideEdges", "::", "me"}], " ", "=", " ", 
   "\"\<The edges `1` are missing from the mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideEdges", "::", "e"}], " ", "=", " ", 
   "\"\<`1` are not a list of edges.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DivideEdges", "::", "l"}], " ", "=", " ", 
    "\"\<Labels `1` are not the same length as list of edges.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"DivideEdges", "[", " ", 
   RowBox[{
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", ",", " ", 
    RowBox[{"proposedEdges_", "?", "MatrixQ"}], " ", ",", " ", 
    RowBox[{"label_", " ", ":", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ToString", "[", 
        RowBox[{"Unique", "[", "]"}], "]"}], "<>", "\"\<:\>\""}], ")"}]}]}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"addVertexToEdge", "[", 
    RowBox[{"m", " ", ",", 
     RowBox[{"proposedEdges", " ", "/.", " ", 
      RowBox[{"Dispatch", "[", 
       RowBox[{"m", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", " ", "label"}], "]"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"proposedEdges", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DivideEdges", "[", " ", 
     RowBox[{
      RowBox[{"proposedEdges_", "?", "MatrixQ"}], " ", ",", " ", 
      RowBox[{"label_", " ", ":", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"Unique", "[", "]"}], "]"}], "<>", "\"\<:\>\""}], ")"}]}]}],
      " ", "]"}], "[", " ", 
    RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"addVertexToEdge", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"proposedEdges", " ", "/.", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"m", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", " ", "label"}], "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"proposedEdges", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideEdges", "[", " ", 
    RowBox[{"proposedEdges_", " ", ",", " ", 
     RowBox[{"label_", " ", ":", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ToString", "[", 
         RowBox[{"Unique", "[", "]"}], "]"}], "<>", "\"\<:\>\""}], ")"}]}]}], 
    " ", "]"}], "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"DivideEdges", "::", "e"}], ",", " ", "proposedEdges"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideEdges", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     "proposedEdges_", " ", ",", " ", 
     RowBox[{"label_", " ", ":", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ToString", "[", 
         RowBox[{"Unique", "[", "]"}], "]"}], "<>", "\"\<:\>\""}], ")"}]}]}], 
    " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"DivideEdges", "::", "e"}], ",", " ", "proposedEdges"}], 
     "]"}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "code", " ", "adds", " ", "a", " ", "vertex", " ", "at", " ", 
    "the", " ", "midpoint", " ", "of", " ", "an", " ", "edge", " ", "and", 
    " ", "makes", " ", "sure", " ", "faces", " ", "are", " ", "adjusted", " ",
     "appropriately"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"addVertexToEdge", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "proposedEdges_", " ", ",", " ", "labelStyle_"}], 
    " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "edgeNumbers", ",", "missingEdges", ",", " ", "edges", ",", "\n", "\t", 
       
       RowBox[{"faces", " ", "=", " ", 
        RowBox[{"Mechanisms`geometry`MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"\"\<edges\>\"", " ", "->", " ", "\"\<faces\>\""}]}], 
         "]"}]}], ",", "\n", "\t", "labels", ",", " ", "proposedLabels", ",", 
       "\n", "\t", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{"MechanismPositions", "[", "m", "]"}]}], ",", "\n", "\t", 
       "verticesToAdd", ",", " ", "edgesToAdd", ",", " ", "facesToAdd", ",", 
       "\n", "\t", "edgesToDealWith", " ", ",", " ", "facesToDealWith"}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"edgeNumbers", " ", "=", " ", 
       RowBox[{"MechanismEdges", "[", " ", 
        RowBox[{"m", ",", " ", "proposedEdges"}], " ", "]"}]}], ";", "\n", 
      "\t", 
      RowBox[{"missingEdges", " ", "=", " ", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{"edgeNumbers", ",", "_Missing"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "if", " ", "the", " ", "labels", " ", "are", " ", "a", " ", "list", 
         " ", "of", " ", "the", " ", "correct", " ", "#", " ", "of", " ", 
         "possible", " ", "labels"}], ",", " ", 
        RowBox[{
         RowBox[{"we", "'"}], "ll", " ", "just", " ", "use", " ", "them"}]}], 
       "*)"}], "\n", "\t", 
      RowBox[{"proposedLabels", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "labelStyle", "]"}], "===", "List"}], ",", 
         "\n", "\t\t", 
         RowBox[{"Which", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "labelStyle", "]"}], " ", ">=", " ", 
            RowBox[{"Length", "[", "edgeNumbers", "]"}]}], ",", "\n", 
           "\t\t\t\t", 
           RowBox[{"Take", "[", 
            RowBox[{"labelStyle", ",", 
             RowBox[{"Length", "[", "edgeNumbers", "]"}]}], "]"}], ",", "\n", 
           "\t\t\t", 
           RowBox[{
            RowBox[{"Length", "[", "labelStyle", "]"}], " ", "==", " ", "0"}],
            ",", "\n", "\t\t\t\t", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", "<>", "\"\<:\>\"", "<>", 
               RowBox[{"ToString", "[", "#2", "]"}]}], "&"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"ConstantArray", "[", 
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{"Unique", "[", "]"}], "]"}], ",", 
                 RowBox[{"Length", "[", "edgeNumbers", "]"}]}], "]"}], ",", 
               " ", "edgeNumbers"}], "}"}]}], "]"}], ",", "\n", "\t\t\t", 
           "True", ",", "\n", "\t\t\t\t", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"oops", " ", "--"}], " ", "wrong", " ", "length"}], 
            "*)"}], "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"Message", "[", 
             RowBox[{
              RowBox[{"DivideEdges", "::", "l"}], ",", " ", "labelStyle"}], 
             "]"}], ";", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ToString", "[", 
                 RowBox[{"labelStyle", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "<>", 
                RowBox[{"ToString", "[", "#", "]"}]}], ")"}], "&"}], " ", "/@",
              " ", "edgeNumbers"}]}]}], "\n", "\t\t", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ToString", "[", "labelStyle", "]"}], "<>", 
             RowBox[{"ToString", "[", "#", "]"}]}], ")"}], "&"}], " ", "/@", 
          " ", "edgeNumbers"}]}], "\n", "\t", "]"}]}], ";", "\n", "\n", "\t", 
      
      RowBox[{"(*", 
       RowBox[{
       "remove", " ", "any", " ", "reference", " ", "to", " ", "missing", " ", 
        RowBox[{"edges", "."}]}], "*)"}], "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "missingEdges", "]"}], ">", "0"}], ",", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"SubdivideEdges", "::", "me"}], ",", " ", "missingEdges"}],
           "]"}], ";", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"edgeNumbers", ",", " ", "edges", ",", " ", "labels"}], 
           "}"}], " ", "=", " ", 
          RowBox[{"Transpose", "@", 
           RowBox[{"Select", "[", " ", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{
               "edgeNumbers", ",", " ", "proposedEdges", ",", 
                "proposedLabels"}], "}"}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"Not", "@", 
               RowBox[{"MissingQ", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "&"}]}], " ", 
            "]"}]}]}]}], ",", "\n", "\t", "\n", "\t\t", 
        RowBox[{
         RowBox[{"edges", " ", "=", " ", "proposedEdges"}], ";", "\n", "\t\t", 
         RowBox[{"labels", " ", "=", " ", "proposedLabels"}], ";"}]}], "\n", 
       "\t", "]"}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{"edgesToDealWith", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{"mechanismCellList", "[", " ", 
          RowBox[{"\"\<Threaded\>\"", ",", " ", "m", ",", " ", 
           RowBox[{"{", 
            RowBox[{"_", ",", " ", "edges"}], "}"}], ",", " ", "None", ",", 
           " ", "_"}], "]"}], ",", " ", 
         RowBox[{"_String", "[", "_", "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
      
      RowBox[{"facesToDealWith", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{"mechanismCellList", "[", " ", 
          RowBox[{"\"\<Threaded\>\"", ",", " ", "m", ",", " ", 
           RowBox[{"{", 
            RowBox[{"_", ",", " ", 
             RowBox[{"Flatten", "[", " ", 
              RowBox[{
               RowBox[{"faces", "[", 
                RowBox[{"[", "edgeNumbers", "]"}], "]"}], " ", ",", "1"}], 
              "]"}]}], " ", "}"}], ",", " ", "None", ",", " ", "_"}], "]"}], 
         ",", " ", 
         RowBox[{"_String", "[", "_", "]"}]}], " ", "]"}]}], ";", "\n", "\n", 
      "\t", 
      RowBox[{"verticesToAdd", " ", "=", " ", 
       RowBox[{"MapThread", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"FreeJoint", "[", 
           RowBox[{"#1", " ", "->", " ", 
            RowBox[{"Mean", "[", 
             RowBox[{"positions", "[", 
              RowBox[{"[", "#2", "]"}], "]"}], "]"}]}], "]"}], "&"}], " ", 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{"labels", ",", " ", "edges"}], "}"}]}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"edgesToAdd", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"subdivideAllEdges", "[", 
          RowBox[{"#", ",", " ", "labels"}], "]"}], "&"}], " ", "/@", " ", 
        "edgesToDealWith"}]}], ";", "\n", "\t", 
      RowBox[{"facesToAdd", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"augmentFaces", "[", 
          RowBox[{"#", ",", " ", "labels", ",", " ", "edges"}], "]"}], "&"}], 
        " ", "/@", " ", "facesToDealWith"}]}], ";", "\t", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"AddCells", "[", 
        RowBox[{"{", 
         RowBox[{
         "facesToAdd", ",", " ", "edgesToAdd", ",", " ", "verticesToAdd"}], 
         "}"}], "]"}], " ", "@", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"facesToDealWith", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", " ", "1"}], "]"}], "]"}], " ", ",", " ", 
            RowBox[{"edgesToDealWith", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], "}"}], "]"}], 
         " ", "]"}], " ", "@", " ", "m"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"subdivideEachEdge", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v1_", ",", "v2_"}], "}"}], ",", "v3_"}], "]"}], " ", ":=", " ", 
  
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"v1", ",", "v3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"v3", ",", "v2"}], "}"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"subdivideAllEdges", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"head_", "[", "edges_", "]"}], " ", "->", " ", "properties_"}], 
     " ", ",", " ", "labels_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"MapThread", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Property", "[", 
       RowBox[{
        RowBox[{"head", "[", 
         RowBox[{"subdivideEachEdge", "[", 
          RowBox[{"#1", ",", "#2"}], "]"}], "]"}], ",", "#3"}], "]"}], "&"}], 
     ",", "\n", "\t\t", 
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{
      "edges", ",", "\n", "\t\t\t", "labels", ",", "\n", "\t\t\t", 
       "properties"}], "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "these", " ", "functions", " ", "add", " ", "vertices", " ", "to", " ", 
    "the", " ", "approprite", " ", "faces"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeRules", "[", 
    RowBox[{"edges_", ",", "labels_"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Dispatch", "@", 
    RowBox[{"Flatten", "[", 
     RowBox[{"MapThread", "[", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"#1", " ", "->", " ", 
           RowBox[{"Sequence", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "#2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"#2", ",", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", "\n",
           "\t", 
          RowBox[{
           RowBox[{"Reverse", "[", "#1", "]"}], " ", "->", " ", 
           RowBox[{"Sequence", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "#2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"#2", ",", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], "\n", 
         "\t", "}"}], "&"}], ",", "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"edges", ",", " ", "labels"}], "}"}]}], "\n", "]"}], 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"augmentEachFace", "[", 
   RowBox[{"faces_", ",", " ", "label_", ",", "edges_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Partition", "[", 
        RowBox[{"#", ",", "2", ",", "1", ",", "1"}], "]"}], "&"}], " ", "/@", 
      " ", "faces"}], ")"}], "/.", 
    RowBox[{"edgeRules", "[", 
     RowBox[{"edges", ",", "label"}], "]"}]}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"augmentFaces", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"head_", "[", "faces_", "]"}], " ", "->", " ", "properties_"}], 
    " ", ",", " ", "label_", ",", " ", "edges_"}], " ", "]"}], " ", ":=", 
  "\n", "\t", 
  RowBox[{"MapThread", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Property", "[", " ", 
      RowBox[{
       RowBox[{"head", "[", "#1", "]"}], " ", ",", " ", "#2"}], "]"}], "&"}], 
    ",", "\n", "\t\t", 
    RowBox[{"{", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", "2", ",", "1", ",", "1"}], "]"}], "&"}], " ", "/@",
            " ", "faces"}], ")"}], " ", "/.", " ", 
         RowBox[{"edgeRules", "[", 
          RowBox[{"edges", ",", "label"}], "]"}]}], ")"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", "\n", 
      "\t\t\t", "properties"}], "\n", "\t\t", "}"}]}], "\n", "\t", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6511]:=",ExpressionUUID->"0df92725-9797-4f50-9c43-34f116a88527"]
}, Closed]],

Cell[CellGroupData[{

Cell["DivideFaces[]", "Subsection",ExpressionUUID->"1c9d14aa-e4fa-43c7-a463-0fb0f975c854"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", 
    RowBox[{"f", " ", ":", " ", 
     RowBox[{"Except", "[", "_List", "]"}]}], "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edges", " ", "=", " ", 
      RowBox[{"f", "[", "m", "]"}]}], "}"}], ",", " ", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "edges", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"edges", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}]}], " ", ",", " ", 
      RowBox[{
       RowBox[{"DivideFaces", "[", "edges", "]"}], "[", "m", "]"}], ",", " ", 
      
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"DivideFaces", "::", "err"}], ",", " ", "f"}], "]"}], ";", 
       " ", "m"}]}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DivideFaces", "::", "err"}], " ", "=", " ", 
    "\"\<`1` did not evaluate to a list of edges when acting on \
mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{"edgeList_", "?", "MatrixQ"}], " ", "]"}], "[", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", "Face"}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"FacelessM", " ", "=", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", 
         RowBox[{"MechanismCells", "[", "_Face", "]"}], "]"}], " ", "@", " ", 
        "m"}]}], ",", "\n", "\t", "newCells"}], "\n", "}"}], ",", "\n", "\t", 
    
    RowBox[{
     RowBox[{"newCells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"FacelessM", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"Fold", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"cutFace", "[", "#2", "]"}], " ", "/@", " ", "#1"}], 
            ")"}], " ", "&"}], ",", " ", "cells", ",", " ", 
          RowBox[{"edgeList", " ", "/.", " ", 
           RowBox[{"Dispatch", "[", 
            RowBox[{"m", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], " ", "]"}]}], " ", 
       "]"}]}], ";", "\n", "\t", 
     RowBox[{
      RowBox[{"Head", "[", "m", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"newCells", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"{", "}"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
       RowBox[{"newCells", "[", 
        RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DivideFaces", "[", " ", 
    RowBox[{
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"addMeshRegion", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"DivideFaces", "[", "edgeList", "]"}], "[", "m", "]"}], ",", 
     " ", "Automatic", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", 
    RowBox[{"{", 
     RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], "[", 
   RowBox[{"Face", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a___", ",", "v1_", ",", "b__", ",", "v2_", ",", "c___"}], 
      "}"}], ",", " ", "prop_"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "b", ",", "v2"}], "}"}], ",", "prop"}], "]"}], ",", 
    
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v2", ",", "c", ",", "a", ",", "v1"}], "}"}], ",", "prop"}], 
     "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", 
    RowBox[{"{", 
     RowBox[{"v2_", ",", "v1_"}], "}"}], "]"}], "[", 
   RowBox[{"Face", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a___", ",", "v1_", ",", "b__", ",", "v2_", ",", "c___"}], 
      "}"}], ",", " ", "prop_"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v1", ",", "b", ",", "v2"}], "}"}], ",", "prop"}], "]"}], ",", 
    
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v2", ",", "c", ",", "a", ",", "v1"}], "}"}], ",", "prop"}], 
     "]"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cutFace", "[", " ", "_", " ", "]"}], "[", "f_", "]"}], " ", ":=", 
  " ", "f"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:00 \
In[6524]:=",ExpressionUUID->"88781786-7762-436e-88e7-32ea57b8a248"]
}, Closed]],

Cell[CellGroupData[{

Cell["SubdivideCells[]", "Subsection",ExpressionUUID->"807f5525-dcf2-4be3-a3d6-f662db4b35c9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "a", " ", "single", " ", "face", " ", "or", " ", "edge", " ", "is", " ", 
    "specified"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "[", " ", 
      RowBox[{
       RowBox[{"indices_", "?", "VectorQ"}], " ", ",", " ", 
       RowBox[{"label_", " ", ":", " ", 
        RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], "[", " ", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", " ", "=", " ", 
        RowBox[{
         RowBox[{"SubdivideCells", "[", " ", 
          RowBox[{
           RowBox[{"{", "indices", "}"}], ",", "label"}], "]"}], "[", "m", 
         "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Head", "[", "tmp", "]"}], "[", " ", 
       RowBox[{
        RowBox[{"tmp", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"tmp", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"tmp", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
        RowBox[{"replaceRules", "[", " ", 
         RowBox[{
          RowBox[{"tmp", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"label", "[", "indices", "]"}], " ", "\[Rule]", " ", 
            "label"}], "}"}]}], "]"}], " ", ",", " ", 
        RowBox[{"tmp", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "a", " ", "list", " ", "of", " ", "faces", " ", "or", " ", "edges", " ", 
     "is", " ", "specified"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "[", " ", 
      RowBox[{
       RowBox[{"indices", " ", ":", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"_", ",", "__"}], "}"}], "..."}], "}"}]}], " ", ",", " ", 
       RowBox[{"label_", " ", ":", " ", 
        RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], "[", " ", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"DeleteCases", "[", " ", 
         RowBox[{
          RowBox[{"mechanismCellList", "[", " ", 
           RowBox[{"\"\<Threaded\>\"", ",", " ", "m", ",", " ", 
            RowBox[{"{", 
             RowBox[{"_", ",", " ", "indices"}], "}"}], ",", " ", "None", ",",
             " ", "_"}], "]"}], ",", " ", 
          RowBox[{"_String", "[", "_", "]"}]}], " ", "]"}]}], "\n", "}"}], 
      ",", "\n", "\t", 
      RowBox[{
       RowBox[{"AddCells", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"subdivideCellsInternal", "[", " ", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#", " ", ",", " ", 
            "label"}], "]"}], " ", "&"}], " ", "/@", " ", "cells"}], " ", 
        "]"}], " ", "@", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", 
         RowBox[{"cells", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], " ", "@", " ",
         "m"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "use", " ", "a", " ", "function", " ", "to", " ", "identify", " ", "a", 
     " ", "list", " ", "of", " ", "cells"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "[", " ", 
      RowBox[{
       RowBox[{"f", " ", ":", " ", 
        RowBox[{"Except", "[", "_List", "]"}]}], ",", " ", 
       RowBox[{"label_", " ", ":", " ", 
        RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], "[", " ", 
     RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"f", "[", "m", "]"}]}], "}"}], ",", " ", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "cells", "]"}], "===", "f"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"SubdivideCells", "::", "err"}], ",", " ", "f"}], "]"}], 
         ";", " ", "m"}], ",", " ", 
        RowBox[{
         RowBox[{"SubdivideCells", "[", 
          RowBox[{"cells", ",", " ", "label"}], "]"}], "[", "m", "]"}]}], " ",
        "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"SubdivideCells", "::", "err"}], "=", 
     "\"\<`1` did not evaluate to a list of cells to subdivide when acting on \
mechanism.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"SubdivideCells", "[", " ", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", "mechanismPattern"}], ",", " ", "indices_", 
      ",", " ", 
      RowBox[{"label_", " ", ":", " ", 
       RowBox[{"Unique", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"out", "=", 
        RowBox[{"addMeshRegion", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SubdivideCells", "[", 
            RowBox[{"indices", ",", " ", "label"}], "]"}], "[", "m", "]"}], 
          ",", " ", "Automatic", ",", " ", 
          RowBox[{"{", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"out", " ", "/;", " ", 
       RowBox[{"MechanismQ", "[", "out", "]"}]}]}], "\n", "]"}]}]}]}]], "Code",\

 CellLabel->
  "1/2/24 10:12:00 \
In[6531]:=",ExpressionUUID->"ce76c6e6-607c-4339-bc44-5002db5363e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"an", " ", "edge", " ", "cell"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"subdivideCellsInternal", "[", " ", 
     RowBox[{"coordinates_", " ", ",", " ", 
      RowBox[{"Rule", "[", " ", 
       RowBox[{
        RowBox[{"head_", "[", 
         RowBox[{"indices_", "?", "MatrixQ"}], " ", "]"}], ",", " ", 
        "data_"}], " ", "]"}], " ", ",", " ", "label_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"newVertices", " ", "=", " ", 
          RowBox[{"label", " ", "/@", " ", "indices"}]}], ",", " ", 
         RowBox[{"newVertexCoordinates", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Mean", "[", 
             RowBox[{"coordinates", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
           "indices"}]}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"FreeJoint", "[", " ", 
             RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], " ", "]"}], "&"}], 
           " ", ",", " ", 
           RowBox[{"{", 
            RowBox[{"newVertices", ",", " ", "newVertexCoordinates"}], 
            "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"new", " ", "edges"}], "*)"}], "\n", "\t\t", 
         RowBox[{"MapThread", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"head", "[", " ", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "#2"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"#2", ",", " ", 
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}], ",", " ",
               "#3"}], "]"}], "&"}], ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"indices", ",", " ", "newVertices", ",", " ", "data"}], 
            " ", "}"}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}], " ",
      "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"indices", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}]}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"a", " ", "face", " ", "cell"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"subdivideCellsInternal", "[", " ", 
     RowBox[{"coordinates_", ",", " ", 
      RowBox[{"Rule", "[", " ", 
       RowBox[{
        RowBox[{"head_", "[", " ", 
         RowBox[{"indices", " ", ":", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_", ",", "_", ",", "__"}], "}"}], "..."}], "}"}]}], " ",
          "]"}], ",", " ", "data_"}], " ", "]"}], " ", ",", " ", "label_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"newVertices", " ", "=", " ", 
         RowBox[{"label", " ", "/@", " ", "indices"}]}], ",", " ", 
        RowBox[{"newVertexCoordinates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", " ", 
            RowBox[{"coordinates", "[", 
             RowBox[{"[", "#", "]"}], "]"}], " ", "]"}], "&"}], "/@", 
          "indices"}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"FreeJoint", "[", " ", 
            RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], " ", "]"}], "&"}], ",",
           " ", 
          RowBox[{"{", 
           RowBox[{"newVertices", ",", " ", "newVertexCoordinates"}], "}"}]}],
          " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{"new", " ", "Faces"}], "*)"}], "\n", "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"head", "[", " ", 
            RowBox[{
             RowBox[{"splitFace", "[", " ", 
              RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], " ", ",", " ", 
             "#3"}], "]"}], "&"}], "  ", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{
           "indices", " ", ",", " ", "newVertices", " ", ",", " ", "data"}], 
           " ", "}"}]}], " ", "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"splitFace", "[", " ", 
     RowBox[{"indices_", " ", ",", " ", "newVertex_"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"newVertex", ",", " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}], " ", "&"}], " ", "/@", 
     " ", 
     RowBox[{"Partition", "[", " ", 
      RowBox[{"indices", " ", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], 
      "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6536]:=",ExpressionUUID->"92a81b6a-bfd3-4c11-825d-758e70402d10"]
}, Closed]],

Cell[CellGroupData[{

Cell["TriangulateFaces[]", "Subsection",ExpressionUUID->"d8651388-086c-4e91-8a1b-4321d177cd65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TriangulateFaces", "[", " ", 
   RowBox[{"m", " ", ":", " ", "mechanismPattern"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"unparseCells", "[", " ", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", "Face"}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"newm", " ", "=", " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", 
         RowBox[{"MechanismCells", "[", "_Face", "]"}], " ", "]"}], " ", "@", 
        " ", "m"}]}], ",", "\n", "\t", 
      RowBox[{"coordinates", " ", "=", " ", 
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", "\n", "\t", "newcells"}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"newcells", " ", "=", " ", 
      RowBox[{"parseCells", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"newm", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"newm", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", 
          RowBox[{"newm", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"decomposeFace", "[", " ", 
           RowBox[{"coordinates", ",", " ", "#"}], " ", "]"}], "&"}], " ", "/@",
          " ", "cells"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"addMeshRegion", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "m", "]"}], "[", 
        RowBox[{
         RowBox[{"newcells", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"newcells", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
         RowBox[{"newcells", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
         RowBox[{"m", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", " ", "Automatic", ",",
        " ", 
       RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6539]:=",ExpressionUUID->"c265f046-0659-4ba0-a446-8dd92026215b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"decomposeFace", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"Face", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}], ",", " ", "prop_"}], 
     "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Face", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", "prop"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"decomposeFace", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"Face", "[", " ", 
     RowBox[{"i_", " ", ",", " ", "prop_"}], "]"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"diag", " ", "=", " ", 
      RowBox[{"findShortestDiagonal", "[", " ", 
       RowBox[{"coordinates", ",", " ", "i"}], " ", "]"}]}], "}"}], ",", "\n",
     "\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TorsionalFold", "[", "diag", "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"decomposeFace", "[", " ", 
         RowBox[{"coordinates", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ", 
       "/@", " ", 
       RowBox[{
        RowBox[{"cutFace", "[", "diag", "]"}], "[", 
        RowBox[{"Face", "[", 
         RowBox[{"i", ",", " ", "prop"}], "]"}], "]"}]}]}], "}"}]}], "\n", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"decomposeFace", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "other_"}], " ", "]"}], " ", ":=", " ", 
   "other"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"findShortestDiagonal", "[", " ", 
   RowBox[{"coordinates_", ",", " ", 
    RowBox[{"vertices", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"diagonals", " ", "=", " ", 
      RowBox[{"polygonDiagonals", "[", " ", "vertices", " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"MinimalBy", "[", " ", 
      RowBox[{
       RowBox[{"Transpose", "[", " ", 
        RowBox[{"{", " ", 
         RowBox[{"diagonals", " ", ",", " ", 
          RowBox[{"Mechanisms`geometry`DisplacementLength", "[", " ", 
           RowBox[{"coordinates", ",", " ", "diagonals"}], " ", "]"}]}], " ", 
         "}"}], " ", "]"}], " ", ",", " ", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{"Last", "[", "#", "]"}], "]"}], "&"}]}], " ", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"polygonDiagonals", "[", " ", "vertices_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"guesses", " ", "=", " ", 
       RowBox[{"Tuples", "[", " ", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "vertices", "]"}], "]"}], ",", " ", "2"}], 
        " ", "]"}]}], ",", " ", 
      RowBox[{"l", " ", "=", " ", 
       RowBox[{"Length", "[", "vertices", "]"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteDuplicatesBy", "[", " ", 
     RowBox[{
      RowBox[{"Map", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"vertices", "[", 
          RowBox[{"[", "#", "]"}], "]"}], "&"}], ",", " ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{"guesses", ",", " ", 
          RowBox[{
           RowBox[{"Between", "[", " ", 
            RowBox[{
             RowBox[{"Abs", "[", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], ",", "  ", 
             RowBox[{"{", 
              RowBox[{"2", ",", " ", 
               RowBox[{
                RowBox[{"Length", "[", "vertices", "]"}], "-", "2"}]}], 
              "}"}]}], " ", "]"}], " ", "&"}]}], " ", "]"}], ",", " ", 
        RowBox[{"{", "2", "}"}]}], " ", "]"}], ",", " ", "Sort"}], "]"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6540]:=",ExpressionUUID->"b0c5ca40-ee5c-4e8e-a2be-e6c19ab5e11f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples", "Section",ExpressionUUID->"73acb900-2b6f-4c81-9ddd-6415f4ff3d58"],

Cell[CellGroupData[{

Cell["Linkage examples", "Subsection",ExpressionUUID->"3ac59116-95e8-4e26-96ea-fdfc9bdac013"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", "\"\<Examples\>\"", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
    "PinnedFourBarLinkage", ",", " ", "PolygonalLinkage", ",", " ", 
     "ChainLinkage", ",", " ", "WattLinkage", ",", "ConnellyServatiusLinkage",
      ",", 
     RowBox[{"Connelly2ndOrderRigidLinkage", ".", "PeaucellierLinkage"}]}], 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6545]:=",ExpressionUUID->"2cdb7c84-8edf-4d6d-b6ba-cefa10762bf3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Linkage", "[", " ", 
   RowBox[{"PinnedFourBarLinkage", "[", " ", 
    RowBox[{"{", 
     RowBox[{"width_", " ", ",", " ", "height_"}], "}"}], " ", "]"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"Linkage", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "height"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"width", ",", "height"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"width", ",", "0"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"PinnedJoint", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4"}], "}"}], "]"}]}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{"PinnedFourBarLinkage", "|", 
     RowBox[{"PinnedFourBarLinkage", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Linkage", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RigidBar", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", 
       RowBox[{"PinnedJoint", "[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], "]"}]}], "}"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{"ChainLinkage", "[", 
     RowBox[{
      RowBox[{"n_Integer", "?", "Positive"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"start_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"VectorQ", "[", 
            RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
        RowBox[{"end_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"VectorQ", "[", 
            RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "}"}]}], 
     "]"}], " ", "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{
    RowBox[{"Linkage", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"start", ",", "end"}], "}"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"start", " ", "+", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"end", "-", "start"}], ")"}], " ", 
            RowBox[{"#", "/", "n"}]}]}], " ", "&"}], "/@", " ", 
         RowBox[{"Range", "[", "n", "]"}]}]}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RigidBar", "/@", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"3", ",", 
             RowBox[{"n", "+", "1"}]}], "]"}], ",", "2", ",", "1"}], "]"}]}], 
        ",", 
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], "]"}], ",", 
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{"2", ",", 
           RowBox[{"n", "+", "1"}]}], "}"}], "]"}]}], "}"}]}], "\n", "\t", 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "start", "]"}], " ", "==", " ", 
     RowBox[{"Length", "[", "end", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", 
    RowBox[{"PolygonalLinkage", "[", 
     RowBox[{"n_Integer", "?", "Positive"}], "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"Linkage", "[", 
    RowBox[{
     RowBox[{"CirclePoints", "[", "n", "]"}], ",", 
     RowBox[{"RigidBar", "/@", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Range", "[", "n", "]"}], ",", "2", ",", "1", ",", "1"}], 
       "]"}]}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Linkage", "[", " ", 
   RowBox[{"WattLinkage", "|", 
    RowBox[{"WattLinkage", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Linkage", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", 
         RowBox[{"Cos", "[", 
          RowBox[{"Pi", "/", "4"}], "]"}]}], ",", 
        RowBox[{"Sin", "[", 
         RowBox[{"Pi", "/", "4"}], "]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"2", "+", 
         RowBox[{"Cos", "[", 
          RowBox[{"Pi", "/", "4"}], "]"}]}], ",", 
        RowBox[{"Sin", "[", 
         RowBox[{"Pi", "/", "4"}], "]"}]}], "}"}]}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", " ", 
      RowBox[{"PinnedJoint", "[", "1", "]"}], ",", 
      RowBox[{"PinnedJoint", "[", "4", "]"}]}], "}"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Linkage", "[", " ", 
    RowBox[{"WattLinkage", "[", "middle_", "]"}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"Linkage", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1", "+", 
          RowBox[{"middle", " ", 
           RowBox[{"Cos", "[", 
            RowBox[{"Pi", "/", "4"}], "]"}]}]}], ",", 
         RowBox[{"middle", " ", 
          RowBox[{"Sin", "[", 
           RowBox[{"Pi", "/", "4"}], "]"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"2", "+", 
          RowBox[{"middle", " ", 
           RowBox[{"Cos", "[", 
            RowBox[{"Pi", "/", "4"}], "]"}]}]}], ",", 
         RowBox[{"middle", " ", 
          RowBox[{"Sin", "[", 
           RowBox[{"Pi", "/", "4"}], "]"}]}]}], "}"}]}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"RigidBar", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "3"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"3", ",", "4"}], "}"}]}], "}"}], "]"}], ",", " ", 
       RowBox[{"PinnedJoint", "[", "1", "]"}], ",", 
       RowBox[{"PinnedJoint", "[", "4", "]"}]}], "}"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"Linkage", "[", " ", 
   RowBox[{"ConnellyServatiusLinkage", "|", 
    RowBox[{"ConnellyServatiusLinkage", "[", "]"}]}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"Linkage", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], "-", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "-", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "-", 
         FractionBox["1", 
          RowBox[{"2", " ", 
           SqrtBox["2"]}]]}], ",", 
        FractionBox["1", 
         RowBox[{"2", " ", 
          SqrtBox["2"]}]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", 
        FractionBox["1", 
         SqrtBox["2"]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        FractionBox["1", 
         SqrtBox["2"]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "1"}], "-", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", 
        FractionBox["1", 
         SqrtBox["2"]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"2", "+", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         FractionBox["1", "4"], " ", 
         RowBox[{"(", 
          RowBox[{"4", "+", 
           SqrtBox["2"]}], ")"}]}], ",", 
        FractionBox["1", 
         RowBox[{"2", " ", 
          SqrtBox["2"]}]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        FractionBox["1", 
         SqrtBox["2"]]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", 
         FractionBox["1", 
          SqrtBox["2"]]}], ",", 
        FractionBox["1", 
         SqrtBox["2"]]}], "}"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "9"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"4", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"4", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"7", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"8", ",", "9"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"8", ",", "11"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "10"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "11"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "11"}], "}"}]}], "}"}], "]"}], ",", "\n", "\t", 
      RowBox[{"PinnedJoint", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "5", ",", "7"}], "}"}], "]"}]}], "\n", "\t", 
     "}"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Linkage", "[", 
   RowBox[{"Connelly2ndOrderRigidLinkage", "|", 
    RowBox[{"Connelly2ndOrderRigidLinkage", "[", "]"}]}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"PlaceVertices", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Linkage", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0.001"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0", ",", "0.001"}], "}"}]}], "}"}], ",", "\n", 
      "\t ", 
      RowBox[{"{", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "6"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "7"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "5"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "7"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "5"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"4", ",", "5"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"4", ",", "6"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "6"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"5", ",", "7"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"6", ",", "7"}], "}"}]}], "}"}], "]"}], ",", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"PinnedJoint", "[", "1", "]"}], ",", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"Property", "[", 
         RowBox[{
          RowBox[{"PinnedJoint", "[", "2", "]"}], ",", 
          RowBox[{"\"\<ConstraintFunction\>\"", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", "3"}], "}"}], "]"}], "]"}], "&"}], 
            ")"}]}]}], " ", "]"}], ",", "\n", "\t", 
        RowBox[{"Property", "[", 
         RowBox[{
          RowBox[{"PinnedJoint", "[", "3", "]"}], ",", 
          RowBox[{"\"\<ConstraintFunction\>\"", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "&"}], ")"}]}]}], "]"}]}], 
       "\[IndentingNewLine]", "\t", "}"}]}], "]"}], " ", ",", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6546]:=",ExpressionUUID->"5daddf1e-5dbd-462f-bb67-77e4dfaeea29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Linkage", "[", 
   RowBox[{"PeaucellierLinkage", "|", 
    RowBox[{"PeaucellierLinkage", "[", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Linkage", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"2", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"5", "/", "2"}], ",", 
        RowBox[{"1", "/", "2"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"3", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"5", "/", "2"}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "/", "2"}]}], "}"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}], "]"}], ",", 
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4", ",", "5", ",", "6", ",", "3"}], "}"}], "]"}], 
      ",", " ", 
      RowBox[{"PinnedJoint", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], "]"}], ",", "\n", "\t", 
      RowBox[{"Property", "[", 
       RowBox[{
        RowBox[{"FreeJoint", "[", "5", "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Style\>\"", " ", "->", " ", "Blue"}], ",", " ", 
          RowBox[{"\"\<Shape\>\"", " ", "->", " ", 
           RowBox[{"FreeJointShape", "[", 
            RowBox[{"\"\<Diameter\>\"", " ", "->", " ", "0.06"}], "]"}]}]}], 
         " ", "}"}]}], "]"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6554]:=",ExpressionUUID->"660a1d53-aaff-4288-91d7-fad1007ea08b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Linkage", "[", 
   RowBox[{"Pantograph", "[", 
    RowBox[{"width_", " ", ":", " ", 
     RowBox[{"1", "/", "2"}]}], "]"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"w", " ", "=", " ", 
      RowBox[{"Clip", "[", 
       RowBox[{"width", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"Linkage", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", "2"}], ",", 
          RowBox[{"1", "/", "2"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", "4"}], ",", 
          RowBox[{"1", "/", "4"}]}], "}"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "/", "2"}], ",", 
           RowBox[{"1", "/", "2"}]}], "}"}], " ", "+", " ", 
         RowBox[{"w", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}], "/", 
           RowBox[{"Sqrt", "[", "2", "]"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "/", "4"}], ",", 
           RowBox[{"1", "/", "4"}]}], "}"}], " ", "+", " ", 
         RowBox[{"w", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "1"}]}], "}"}], "/", 
           RowBox[{"Sqrt", "[", "2", "]"}]}]}]}]}], "}"}], ",", "\n", "\t\t", 
      
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "3"}], "}"}]}], "}"}], "]"}], ",", 
        RowBox[{"StraightJoint", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], ",", 
        RowBox[{"StraightJoint", "[", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "4"}], "}"}], "]"}], ",", 
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{"4", ",", "6"}], "}"}], "]"}], ",", 
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{"6", ",", "5"}], "}"}], "]"}], ",", 
        RowBox[{"PinnedJoint", "[", "1", "]"}]}], "}"}]}], "\n", "\t", 
     "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6555]:=",ExpressionUUID->"46eac6bf-1124-44f7-951a-7744acd1dcbe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Linkage", "[", 
   RowBox[{"KagomeUnitCell", "[", 
    RowBox[{"size", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", "1"}], "]"}], "]"}], " ", 
  ":=", " ", "\n", "\t", 
  RowBox[{"Linkage", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"size", "*", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          FractionBox[
           SqrtBox["3"], "2"]}], ",", 
         RowBox[{"-", 
          FractionBox["1", "2"]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         FractionBox[
          SqrtBox["3"], "2"], ",", 
         RowBox[{"-", 
          FractionBox["1", "2"]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SqrtBox["3"], ",", 
         RowBox[{"-", "2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         FractionBox[
          RowBox[{"3", " ", 
           SqrtBox["3"]}], "2"], ",", 
         RowBox[{"-", 
          FractionBox["1", "2"]}]}], "}"}]}], "}"}]}], ",", "\n", "\t\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"FreeJoint", "[", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "4", ",", "5"}], "}"}], "]"}], 
      ",", 
      RowBox[{"RigidBar", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"4", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"5", ",", "3"}], "}"}]}], "}"}], "]"}], ",", 
      RowBox[{"Face", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4", ",", "5"}], "}"}]}], "}"}], "]"}]}], "}"}]}],
    "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6556]:=",ExpressionUUID->"1b8cf775-ebf9-4534-b135-d538b6080991"]
}, Closed]],

Cell[CellGroupData[{

Cell["Experimental linkages", "Subsection",ExpressionUUID->"e9380c8d-6b64-4bac-93a9-eeb515421900"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Linkage", "[", 
   RowBox[{"SarrusLinkage", "[", " ", "inputPolygon_Polygon", " ", "]"}], " ",
    "]"}], " ", ":=", " ", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"CanonicalizePolygon", "[", "inputPolygon", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"coord", " ", "=", " ", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"ConstantArray", "[", " ", 
            RowBox[{
             RowBox[{"Mean", "[", 
              RowBox[{"p", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"p", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}]}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"midfaces", " ", "=", " ", 
          RowBox[{"Partition", "[", " ", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"#", " ", "+", " ", 
                 RowBox[{"2", " ", 
                  RowBox[{"Length", "[", 
                   RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "&"}], " ", "/@",
                "  ", 
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
              RowBox[{"RotateLeft", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "+", 
                  RowBox[{"3", " ", 
                   RowBox[{"Length", "[", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "&"}], " ", "/@",
                 " ", 
                RowBox[{"p", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], ",", " ", 
            "2"}], " ", "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{"norm", " ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"0", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "&"}], " ", "/@",
             " ", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], "&"}], "/@",
                "coord"}], ",", "2", ",", "1", ",", "1"}], "]"}]}]}], "\n", 
          "\t", "}"}], ",", "\n", "\t\t", 
         RowBox[{"Linkage", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Join", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"-", "1"}], "/", "2"}]}], "}"}], "&"}], " ", "/@", 
              " ", "coord"}], ",", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"1", "/", "2"}]}], "}"}], "&"}], " ", "/@", " ", 
              "coord"}], " ", ",", " ", 
             RowBox[{
              RowBox[{"-", "norm"}], " ", "+", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], "&"}], 
                " ", "/@", " ", "coord"}], ")"}]}], " ", ",", "  ", 
             RowBox[{"norm", " ", "+", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}], "&"}], 
                " ", "/@", " ", "coord"}], ")"}]}]}], " ", "]"}], ",", " ", 
           "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"Face", "[", 
              RowBox[{"p", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"Face", "[", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "+", 
                  RowBox[{"Length", "[", 
                   RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}], ")"}], 
               " ", "/@", " ", 
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", "\n", "\t\t\t", 
             
             RowBox[{"Map", "[", 
              RowBox[{"Face", " ", ",", " ", 
               RowBox[{"Flatten", "/@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "2", ",", "1", ",", 
                    "1"}], "]"}], ",", " ", 
                   RowBox[{"Reverse", " ", "/@", " ", "midfaces"}]}], "}"}], 
                 "]"}]}]}], " ", "]"}], ",", "\n", "\t\t\t", 
             RowBox[{"Map", "[", 
              RowBox[{"Face", " ", ",", " ", 
               RowBox[{"Flatten", "/@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{"midfaces", ",", " ", 
                   RowBox[{"Reverse", " ", "/@", " ", 
                    RowBox[{"Partition", "[", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "+", " ", 
                    RowBox[{"Length", "[", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "&"}], " ", "/@",
                     " ", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], " ", ",", " ", "2", ",",
                     " ", "1", ",", " ", "1"}], "]"}]}]}], "}"}], "]"}]}]}], 
              " ", "]"}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"OverlapPrecision", "->", "0"}]}], "\n", "\t\t", "]"}]}], 
        "\n", "]"}]}], "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"RegionEmbeddingDimension", "[", "inputPolygon", "]"}], " ", "==",
     " ", "2"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6557]:=",ExpressionUUID->"375d8e09-4ad7-4120-9adf-da539a653fe3"]
}, Closed]],

Cell[CellGroupData[{

Cell["Origami examples", "Subsection",ExpressionUUID->"ac7777e2-ccef-4f2a-810d-62265105a2f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", "\"\<Examples\>\"", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", " ", 
    RowBox[{
    "BirdsFoot", ",", " ", "SingleVertex", ",", " ", "RandlettBirdOrigami", 
     ",", " ", "WaterBombBase", ",", " ", "MiuraOriCell", ",", " ", 
     "SteffanPolyhedron"}], " ", "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6558]:=",ExpressionUUID->"76a01b01-bb3a-4d1e-9253-6c9a7d3a5fd4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"BirdsFoot", "|", 
    RowBox[{"BirdsFoot", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Origami", "[", " ", 
   RowBox[{"SingleVertex", "[", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Pi", "/", "4"}], ",", " ", 
      RowBox[{"3", " ", 
       RowBox[{"Pi", "/", "4"}]}], " ", ",", 
      RowBox[{"3", " ", 
       RowBox[{"Pi", " ", "/", "4"}]}], ",", " ", 
      RowBox[{"Pi", "/", "4"}]}], "}"}], " ", "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"BirdsFoot", "[", 
    RowBox[{"a_", "?", "NumericQ"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{"SingleVertex", "[", " ", 
     RowBox[{"{", 
      RowBox[{"a", ",", "  ", 
       RowBox[{"Pi", " ", "-", " ", "a"}], " ", ",", 
       RowBox[{"Pi", " ", "-", " ", "a"}], ",", " ", "a"}], "}"}], " ", "]"}],
     " ", "]"}], " ", "/;", " ", 
   RowBox[{"0", " ", "<", " ", "a", " ", "<", " ", "Pi"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6559]:=",ExpressionUUID->"748c0386-08c4-47f5-9e72-f76a24957f12"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"SingleVertex", "[", "an_", "]"}], " ", "]"}], " ", "^:=", " ", 
  "\n", 
  RowBox[{
   RowBox[{"Origami", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Join", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}], "}"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Cos", "[", "#", "]"}], ",", 
           RowBox[{"Sin", "[", "#", "]"}]}], " ", "}"}], "&"}], " ", "/@", 
        " ", 
        RowBox[{"Join", "[", " ", 
         RowBox[{
          RowBox[{"{", "0", "}"}], ",", " ", 
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Accumulate", "[", " ", "an", " ", "]"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], " ", "]"}]}]}], "\n", "\t", "]"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Face", "[", " ", 
        RowBox[{"{", 
         RowBox[{"1", ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], " ", "]"}], "&"}], " ", "/@",
       " ", 
      RowBox[{"Partition", "[", " ", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"2", ",", 
          RowBox[{"1", "+", 
           RowBox[{"Length", "[", "an", "]"}]}]}], "]"}], ",", " ", "2", ",", 
        " ", "1", " ", ",", " ", "1"}], "]"}]}]}], "\n", "]"}], " ", "/;", 
   " ", 
   RowBox[{
    RowBox[{"VectorQ", "[", " ", 
     RowBox[{"an", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", "an", "]"}], " ", ">=", " ", "3"}]}]}]}]], "Code",\

 CellLabel->
  "1/2/24 10:12:01 \
In[6561]:=",ExpressionUUID->"09a1ab40-6d32-45d7-9647-f0d23127bc46"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{"RandlettBirdOrigami", "|", 
     RowBox[{"RandlettBirdOrigami", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", "\t", 
   RowBox[{"Origami", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"N", "@", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.414278593427568`", ",", 
          RowBox[{"-", "0.00012107343015166361`"}], ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.4142678318232762`", ",", "1.4140274916158289`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.00011927863201000033`", ",", "1.414016642177331`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.4142692917736754`", ",", "1.227825699827347`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.3131744350755659`", ",", "1.211870419723824`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.2781932400501788`", ",", "1.2779508631318839`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.9659583817161155`", ",", "0.9657127724823382`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "1.0728360008415996`", ",", "0.7312622802432727`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.47189742974276605`", ",", "0.9427579377876374`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.353962452288944`", ",", "0.7077633593785156`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1.2121120814828474`", ",", "1.312933079920714`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "1.2280642010424148`", ",", "1.4140260798657769`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"0.731505784488571`", ",", "1.0725852346780647`", ",", "0"}],
          "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.7073110670506855`", ",", "0.3537763181270138`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.9430090748133337`", ",", "0.47164965094818173`", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.7074588006059522`", ",", "0.7069478151898358`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "1.4142724979918373`", ",", "0.8060679230868013`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.8063082321157269`", ",", "1.4140228586178498`", ",", "0"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "0.23507732779834628`", ",", "1.1102230246251565`*^-16", ",", "0"}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "0.0001931022705954355`", ",", "0.2355241969949885`", ",", "0"}], 
         "}"}]}], "}"}]}], ",", "\n", "\t\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Face", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"15", ",", "20", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "17", ",", "15"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"11", ",", "17", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "21", ",", "11"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"18", ",", "2", ",", "16"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"16", ",", "9", ",", "18"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"16", ",", "2", ",", "15"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15", ",", "2", ",", "20"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"13", ",", "3", ",", "12"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"12", ",", "3", ",", "7"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"7", ",", "3", ",", "6"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "3", ",", "5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"21", ",", "4", ",", "11"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"11", ",", "4", ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "4", ",", "19"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"19", ",", "14", ",", "10"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "5", ",", "18"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"18", ",", "9", ",", "6"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"8", ",", "7", ",", "6"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "9", ",", "8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"12", ",", "7", ",", "8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"8", ",", "14", ",", "12"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"14", ",", "8", ",", "17"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"17", ",", "10", ",", "14"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"17", ",", "8", ",", "9"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"9", ",", "16", ",", "17"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"11", ",", "10", ",", "17"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"19", ",", "13", ",", "12"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"12", ",", "14", ",", "19"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"16", ",", "15", ",", "17"}], "}"}]}], "}"}], "]"}], ",", 
       "\n", "\t\t", 
       RowBox[{"\"\<faces\>\"", " ", "/@", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"1", ",", "11"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "15"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "8"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"6", ",", "18"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"8", ",", "12"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"9", ",", "17"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"10", ",", "19"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"12", ",", "19"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"14", ",", "17"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"16", ",", "18"}], "}"}]}], "}"}]}]}], "\n", "\t\t", 
      "}"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"RandlettBirdOrigami", "[", " ", "\"\<Folded\>\"", " ", "]"}], " ",
    "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"Origami", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.5216212272644043`", ",", "0.0041301921010017395`", ",", 
        RowBox[{"-", "0.5215774178504944`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.6376347541809082`"}], ",", "0.4420289695262909`", ",", 
        RowBox[{"-", "0.16293174028396606`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.435793399810791`"}], ",", 
        RowBox[{"-", "0.10257021337747574`"}], ",", "0.4356272220611572`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0.16264325380325317`", ",", "0.442157119512558`", ",", 
        "0.6371942758560181`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.4927003085613251`"}], ",", "0.07479492574930191`", 
        ",", "0.4173307418823242`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.4104839861392975`"}], ",", "0.11236074566841125`", 
        ",", "0.36908411979675293`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.4352164566516876`"}], ",", "0.0874059870839119`", ",",
         "0.43510642647743225`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.22010493278503418`"}], ",", 
        RowBox[{"-", "0.2338118851184845`"}], ",", "0.22003494203090668`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.13188940286636353`"}], ",", 
        RowBox[{"-", "0.15577159821987152`"}], ",", 
        RowBox[{"-", "0.008406173437833786`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
       "0.11944180727005005`", ",", "0.1096508726477623`", ",", 
        "0.06939235329627991`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.047771066427230835`", ",", 
        RowBox[{"-", "0.13527639210224152`"}], ",", "0.09195645153522491`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.3691454231739044`"}], ",", "0.11233522742986679`", 
        ",", "0.410442054271698`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.4174804091453552`"}], ",", "0.07477816939353943`", 
        ",", "0.49260756373405457`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.00845295935869217`", ",", 
        RowBox[{"-", "0.15610502660274506`"}], ",", "0.13212451338768005`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.09123314917087555`"}], ",", 
        RowBox[{"-", "0.13514138758182526`"}], ",", 
        RowBox[{"-", "0.04728326201438904`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.06939570605754852`"}], ",", "0.11028251051902771`", 
        ",", 
        RowBox[{"-", "0.11917997896671295`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.18727263808250427`"}], ",", "0.1310577541589737`", 
        ",", "0.1871875524520874`"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.41846323013305664`"}], ",", 
        RowBox[{"-", "0.254423052072525`"}], ",", "0.16566649079322815`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "0.1659073531627655`"}], ",", 
        RowBox[{"-", "0.25454390048980713`"}], ",", "0.4185855984687805`"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.3550601601600647`", ",", 
        RowBox[{"-", "0.1361958533525467`"}], ",", 
        RowBox[{"-", "0.4324187636375427`"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.43267032504081726`", ",", 
        RowBox[{"-", "0.13634231686592102`"}], ",", 
        RowBox[{"-", "0.35442548990249634`"}]}], "}"}]}], "}"}], ",", "\n", 
    "\t\t", 
    RowBox[{"{", "\n", "\t\t ", 
     RowBox[{
      RowBox[{"Face", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"15", ",", "20", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "17", ",", "15"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11", ",", "17", ",", "1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "21", ",", "11"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"18", ",", "2", ",", "16"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"16", ",", "9", ",", "18"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"16", ",", "2", ",", "15"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"15", ",", "2", ",", "20"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"13", ",", "3", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12", ",", "3", ",", "7"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"7", ",", "3", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "3", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"21", ",", "4", ",", "11"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11", ",", "4", ",", "10"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "4", ",", "19"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"19", ",", "14", ",", "10"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "5", ",", "18"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"18", ",", "9", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"8", ",", "7", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "9", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12", ",", "7", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"8", ",", "14", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"14", ",", "8", ",", "17"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"17", ",", "10", ",", "14"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"17", ",", "8", ",", "9"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "16", ",", "17"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"11", ",", "10", ",", "17"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"19", ",", "13", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12", ",", "14", ",", "19"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"16", ",", "15", ",", "17"}], "}"}]}], "}"}], "]"}], ",", 
      "\n", "\t\t ", 
      RowBox[{"\"\<faces\>\"", " ", "/@", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "11"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "15"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "8"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"6", ",", "18"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"8", ",", "12"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "17"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"10", ",", "19"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"12", ",", "19"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"14", ",", "17"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"16", ",", "18"}], "}"}]}], "}"}]}]}], "\n", "\t\t", 
     "}"}]}], "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6562]:=",ExpressionUUID->"d17e50b0-6ffc-45fe-84f4-16c7f46768e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"WaterBombBase", "|", 
    RowBox[{"WaterBombBase", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  
  RowBox[{"Origami", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], ",", 
        FractionBox["1", "2"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], ",", 
        FractionBox["1", "4"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["3", "4"], ",", 
        FractionBox["1", "2"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], ",", 
        FractionBox["3", "4"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "4"], ",", 
        FractionBox["1", "2"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        FractionBox["1", "2"]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        FractionBox["1", "2"], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        FractionBox["1", "2"]}], "}"}]}], "}"}], ",", "\n", "\t\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{"Face", "[", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "4", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "5", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "6", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "7", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "8", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "9", ",", "2"}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"2", ",", "10", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "10", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "4", ",", "11"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "11", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"7", ",", "6", ",", "12"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"7", ",", "12", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"9", ",", "8", ",", "13"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"13", ",", "2", ",", "9"}], "}"}]}], "\n", "\t\t", "}"}], 
      "]"}], "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6564]:=",ExpressionUUID->"2bcd8429-3ef1-4aa4-a4d7-eff1cb4a1f46"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Origami", "[", " ", 
     RowBox[{"MiuraOriCell", "[", 
      RowBox[{"x_", "?", "NumericQ"}], "]"}], " ", "]"}], "  ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "1"}], "/", "2"}], " ", "<", " ", "x", " ", "<", " ", 
     RowBox[{"1", "/", "2"}]}]}], " ", ":=", "\n", "\t", 
   RowBox[{"Origami", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"3", "/", "4"}], ",", 
         RowBox[{"1", "/", "2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"1", "/", "2"}], "+", "x"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"5", "/", "4"}], ",", 
         RowBox[{"1", "/", "2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"1", "/", "2"}], "+", "x"}], ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1", "/", "4"}], ",", 
         RowBox[{"1", "/", "2"}]}], "}"}]}], "\n", "\t\t", "}"}], ",", "\n", 
     "\t\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{"Face", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "9", ",", "2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "4", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "5", ",", "6", ",", "7"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "7", ",", "8", ",", "9"}], "}"}]}], "}"}], "]"}], 
      "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{"MiuraOriCell", "[", " ", 
     RowBox[{
      RowBox[{"x_", "?", "NumericQ"}], " ", ",", " ", 
      "\"\<Triangulated\>\""}], " ", "]"}], " ", "]"}], "  ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "1"}], "/", "2"}], " ", "<", " ", "x", " ", "<", " ", 
    RowBox[{"1", "/", "2"}]}]}], " ", ":=", "\n", "\t\t", 
  RowBox[{"Origami", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"3", "/", "4"}], ",", 
        RowBox[{"1", "/", "2"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", "x"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"5", "/", "4"}], ",", 
        RowBox[{"1", "/", "2"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", "x"}], ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", "4"}], ",", 
        RowBox[{"1", "/", "2"}]}], "}"}]}], "\n", "\t\t", "}"}], ",", "\n", 
    "\t\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Face", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "9", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "4", ",", "5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "5", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "6", ",", "7"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "7", ",", "9"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"7", ",", "8", ",", "9"}], "}"}]}], "}"}], "]"}], ",", "\n",
       "\t\t", 
      RowBox[{"\"\<faces\>\"", "/@", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "7"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"9", ",", "3"}], "}"}]}], "}"}]}]}], "\n", "\t\t", "}"}]}], 
   "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Origami", "[", " ", 
    RowBox[{"MiuraOriCell", "[", 
     RowBox[{"x_", ",", " ", "___"}], " ", "]"}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MiuraOriCell", "::", "offset"}], ",", "x"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MiuraOriCell", "::", "offset"}], " ", "=", " ", 
   "\"\<Offset `1` is not strictly between -1/2 and 1/2.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6565]:=",ExpressionUUID->"01ba101d-0c31-4332-b229-6654a8245df8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"SteffanPolyhedron", "|", 
    RowBox[{"SteffanPolyhedron", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Origami", "[", " ", 
   RowBox[{"SteffanPolyhedron", "[", "0", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"Origami", "[", " ", 
   RowBox[{"SteffanPolyhedron", "[", 
    RowBox[{"t_", "?", "NumericQ"}], "]"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
     "m", ",", " ", "p", ",", " ", "e", ",", " ", "l", ",", " ", "f", ",", 
      "  ", "en", ",", " ", "pos"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"p", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "12"}], ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "/", "24"}], ",", 
          RowBox[{
           RowBox[{"-", "17"}], " ", 
           RowBox[{
            RowBox[{"Sqrt", "[", "287", "]"}], "/", "24"}]}], ",", "0"}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "3"}], ",", 
          RowBox[{"4", " ", 
           RowBox[{"Cos", "[", "t", "]"}]}], ",", 
          RowBox[{"4", " ", 
           RowBox[{"Sin", "[", "t", "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "5"}], ",", 
          RowBox[{"-", "6"}], ",", 
          RowBox[{
           RowBox[{"-", "7"}], "/", "2"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"7", "/", "2"}], ",", 
          RowBox[{"1", "/", "10"}], ",", 
          RowBox[{"-", "9"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "5"}], ",", 
          RowBox[{"-", "5"}], ",", 
          RowBox[{"-", "8"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "34"}], "/", "10"}], ",", 
          RowBox[{
           RowBox[{"-", "97"}], "/", "10"}], ",", 
          RowBox[{
           RowBox[{"-", "91"}], "/", "10"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "4"}], ",", 
          RowBox[{"-", "3"}], ",", 
          RowBox[{
           RowBox[{"-", "1"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", "\n", 
     "\t", 
     RowBox[{"e", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"3", ",", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "3"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"2", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"4", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"4", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"7", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "9"}], "}"}]}], "}"}]}], ";", "\n", "\t", 
     RowBox[{"l", " ", "=", " ", 
      RowBox[{"{", " ", 
       RowBox[{
       "12", ",", " ", "12", ",", " ", "5", ",", " ", "10", ",", " ", "17", 
        ",", " ", "10", ",", " ", "11", ",", " ", "10", ",", " ", "12", ",", 
        " ", "10", ",", "12", ",", "12", ",", "12", ",", "10", ",", "5", ",", 
        " ", "10", ",", "12", ",", " ", "5", ",", " ", "10", ",", "5", ",", 
        "12"}], " ", "}"}]}], ";", "\n", "\t", 
     RowBox[{"f", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"7", ",", "3", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "4", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "4", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "5", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "6", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"4", ",", "6", ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"5", ",", "6", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "8", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"6", ",", "9", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "9", ",", "6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "7", ",", "8"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "8", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3", ",", "9"}], "}"}]}], "}"}]}], ";", "\n", "\n",
      "\t", 
     RowBox[{"m", " ", "=", " ", 
      RowBox[{
       RowBox[{"ChangeCellData", "[", 
        RowBox[{"MechanismFaceCells", ",", " ", 
         RowBox[{"\"\<Style\>\"", "->", 
          RowBox[{"Opacity", "[", "0.5", "]"}]}]}], "]"}], " ", "@", " ", 
       RowBox[{
        RowBox[{"ChangeCellData", "[", " ", 
         RowBox[{
          RowBox[{"RigidBar", "[", "e", "]"}], ",", " ", 
          RowBox[{"\"\<EquilibriumLength\>\"", " ", "->", " ", "l"}]}], " ", 
         "]"}], " ", "@", " ", 
        RowBox[{"Origami", "[", " ", 
         RowBox[{"p", ",", " ", 
          RowBox[{"Face", "[", "f", "]"}]}], " ", "]"}]}]}]}], ";", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"en", ",", " ", "pos"}], "}"}], " ", "=", " ", 
      RowBox[{"Mechanisms`rigidity`MinimizeMechanismEnergy", "[", " ", 
       RowBox[{"m", " ", ",", " ", 
        RowBox[{"MaxIterations", "->", 
         RowBox[{"10", "^", "5"}]}], ",", " ", 
        RowBox[{"Constraints", "->", 
         RowBox[{"{", 
          RowBox[{"Mechanisms`rigidity`EuclideanMotionConstraints", "[", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2", ",", "3"}], "}"}], "]"}], "}"}]}]}], 
       "]"}]}], ";", "\n", "\t", 
     RowBox[{"PlaceVertices", "[", " ", 
      RowBox[{"m", ",", " ", "pos"}], " ", "]"}]}]}], "\n", "]"}]}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:01 \
In[6569]:=",ExpressionUUID->"269230f6-fb33-44fb-976f-8c41d6738502"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6571]:=",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms`geometry: extracting mechanism geometry", "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6573]:=",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],

Cell[CellGroupData[{

Cell["code snippet to check for C compiler", "Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
    RowBox[{
    "A", " ", "snippet", " ", "of", " ", "code", " ", "to", " ", "test", " ", 
     "or", " ", "a", " ", "working", " ", "C", " ", "compiler"}], ",", " ", 
    RowBox[{
     RowBox[{"modified", " ", "from", "\n", "\t", 
      RowBox[{"https", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
         "questions"}], "/", "39837"}], "/", "check"}], "-", "whether", "-", 
      "a", "-", "working", "-", "ccompiler", "-", "is", "-", 
      "installed"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"Quiet", "[", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", " ", "0", ",", " ", 
             RowBox[{"CompilationTarget", " ", "->", " ", "\"\<C\>\""}]}], 
            "]"}], "[", "]"}], " ", "==", " ", "0"}], "]"}], ",", " ", 
        "False"}], "]"}], "]"}], ",", "\n", "  ", 
     RowBox[{"$MechanismCompilationTarget", " ", "=", " ", "\"\<C\>\""}], ",",
      "\n", "  ", 
     RowBox[{"$MechanismCompilationTarget", " ", "=", " ", "\"\<MVM\>\""}]}], 
    "\n", "]"}], ";"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:01 \
In[6574]:=",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ZeroLengthEdgeQ", "::", "usage"}], "=", 
    "\"\<ZeroLengthEdgeQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)], \
ZeroLengthEdgeQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)] returns True if \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) has any 0 length edges.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellTest", "::", "usage"}], "=", 
   "\"\<MechanismCellTest[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), {{\!\
\(\*StyleBox[SubscriptBox[\"v\", \"11\"],FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[SubscriptBox[\"v\", \"12\"],FontSlant->\"Italic\"]\), ..}, {\!\
\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"21\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"22\"]\), ..}, \
...} , \!\(\*StyleBox[\"geometric\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"computation\",FontSlant->\"Italic\
\"]\) , \!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\) ] returns a list of \
cell indices such \!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\) applied to \
\!\(\*StyleBox[\"geometric\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"computation\",FontSlant->\"Italic\
\"]\) is True.\nMechanismCellTest[{{\!\(\*StyleBox[SubscriptBox[\"v\", \
\"11\"],FontSlant->\"Italic\"]\), \!\(\*StyleBox[SubscriptBox[\"v\", \
\"12\"],FontSlant->\"Italic\"]\), ..}, \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"21\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"22\"]\), ..}, \
...} , \!\(\*StyleBox[\"geometric\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"computation\",FontSlant->\"Italic\
\"]\) , \!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\) ] can be applied to \
a mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6575]:=",ExpressionUUID->"c555d03c-e001-41c3-854c-522f379465be"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$MechanismCompilationTarget", "::", "usage"}], " ", "=", " ", 
    "\"\<Returns \\\"C\\\" if a C compiler was detected or \\\"MVM\\\" \
otherwise.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Infinitesimal", "::", "usage"}], " ", "=", " ", 
   "\"\<Infinitesimal[ \!\(\*StyleBox[\"name\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"order\",FontSlant->\"Italic\"]\) ] represents an \
Infinitesimal of name and at a particular order.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6577]:=",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementRules", "::", "usage"}], " ", "=", " ", 
    "\"\<DisplacementRules[\!\(\*StyleBox[\"displacements\",FontSlant->\"\
Italic\"]\)] returns a list of rules to assign vertex displacements to their \
values.\nDisplacementRules[ \
{\!\(\*SubscriptBox[StyleBox[\"positions\",FontSlant->\"Italic\"], \"1\"]\), \
...} ] returns a list of rules for each set of \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\).\nDisplacementRules[ \!\
\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\) ] \
returns displacement rules from a periodic mechanism data structure.\n\
DisplacementRules[ \
\!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"k\",FontSlant->\"Italic\"], \"1\"]\), ...} ] \
returns displacement rules from a periodic mechanism with a different set of \
reciprocal wave vectors \
{\!\(\*SubscriptBox[StyleBox[\"k\",FontSlant->\"Italic\"], \
\"\[Placeholder]\"]\), ...}.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PositionRules", "::", "usage"}], " ", "=", " ", 
    "\"\<PositionRules[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns rules setting the positions of mechanism m.\nPositionRules[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\) ] returns a list of \
rules assigning vertex positions to their values.\nPositionRules[ \
{\!\(\*SubscriptBox[StyleBox[\"positions\",FontSlant->\"Italic\"], \"1\"]\), \
...} ] returns a list of rules for each set of positions.\nPositionRules[ \
\!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\) ] \
returns position rules from a periodic mechanism data structure.\n\
PositionRules[ \
\!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"lattice\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vectors\",FontSlant->\"Italic\"]\)\
 ] returns position rules from a periodic mechanism with a different set of \
lattice vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PositionConstraints", "::", "usage"}], "=", 
    "\"\<PositionConstraints[ \!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\
\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"lattice\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vectors\",FontSlant->\"Italic\"]\)\
 ] returns a set of constraints associated with periodic data provided given \
lattice vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrthogonalizeDisplacements", "::", "usage"}], "=", 
    "\"\<OrthogonalizeDisplacements[ \
{\!\(\*SubscriptBox[StyleBox[\"displacement\",FontSlant->\"Italic\"], \
\"1\"]\), ...} ] returns an orthogonalized set of vertex displacements\n\
OrthogonalizeDisplacements[ \
{\!\(\*SubscriptBox[StyleBox[\"displacement\",FontSlant->\"Italic\"], \
\"1\"]\), ...}, \!\(\*StyleBox[\"tolerance\",FontSlant->\"Italic\"]\) ]  uses \
\!\(\*StyleBox[\"tolerance\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)to orthogonalize.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<VertexCoordinatesQ[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\
\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) are valid coordinates for \
mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], " ", 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexCoordinateListQ", "::", "usage"}], "=", " ", 
   "\"\<VertexCoordinateListQ[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) are a list of valid positions \
for mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], " ", 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NumericCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<NumericCoordinatesQ[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) are valid numerical \
coordinates for mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NumericMachinePrecisionCoordinatesQ", "::", "usage"}], "=", " ", 
   "\"\<NumericMachinePrecisionCoordinatesQ[ \!\(\*StyleBox[\"m\",FontSlant->\
\"Italic\"]\), \!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) ] returns True \
if \!\(\*StyleBox[\"pos\",FontSlant->\"Italic\"]\) are valid numerical, \
machine precision coordinates for mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6579]:=",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConnectivity", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismConnectivity[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \
\"2\"]\) ] returns a list cells of type \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"2\"]\) connected \
to each cell of type \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"1\"]\). \n\
MechanismConnectivity[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \
\"2\"]\), \!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\)] returns a list of \
cells of type \!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \
\"1\"]\) when \!\(\*StyleBox[\"test\",FontSlant->\"Italic\"]\) applied to \
MechanismConnectivity[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \
\"2\"]\)] is True.\n\nPossible choices of \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"1\"]\) are \
\\\"vertices\\\", \\\"edges\\\", or \\\"faces\\\". Possible types for \
\!\(\*SubscriptBox[StyleBox[\"s\",FontSlant->\"Italic\"], \"2\"]\) are \
\\\"vertices\\\", \\\"edges\\\", \\\"faces\\\", \\\"ordered edges\\\", or \
\\\"ordered faces\\\".\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismOrientedQ", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismOrientedQ[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns True if all Faces in a mechanism are oriented with their neighbors.\>\
\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryVertices", "::", "usage"}], "=", 
   "\"\<BoundaryVertices[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns a list of oriented boundary vertices belonging to boundary components \
{ \!\(\*StyleBox[SubscriptBox[\"c\", \"1\"],FontSlant->\"Italic\"]\), ...}.\n\
A boundary is defined as the boundary of a set of faces.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryEdges", "::", "usage"}], "=", 
   "\"\<BoundaryEdges[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns a list of oriented boundary edges {{\!\(\*SubscriptBox[\(v\), \(11\)]\
\), \!\(\*SubscriptBox[\(v\), \(12\)]\)},{\!\(\*SubscriptBox[\(v\), \
\(21\)]\),\!\(\*SubscriptBox[\(v\), \(11\)]\)},...}.\nA boundary is defined \
as the boundary of a set of faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BoundaryFaces", "::", "usage"}], "=", 
   "\"\<BoundaryFaces[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns a list of oriented boundary components {{\!\(\*SubscriptBox[\(f\), \
\(1\)]\), \!\(\*SubscriptBox[\(f\), \(\(2\)\(,\)\)]\)...}, ...}.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InteriorVertices", "::", "usage"}], "=", 
   "\"\<InteriorVertices[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns a list of interior vertices.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InteriorEdges", "::", "usage"}], "=", 
    "\"\<InteriorEdges[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns a list of interior edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", "::", "usage"}], "=", "\n", 
    "\"\<MechanismDisplayDimension[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] returns the display dimension \
of a Mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\n\
MechanismDisplayDimension[ \!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\) ][ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ], MechanismDisplayDimension[\!\
\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\)] changes the display dimension \
of a mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) to \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "::", "usage"}], "=", "\n", 
    "\"\<MechanismEmbeddingDimension[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] returns the embedding \
dimension of a Mechanism m.\nMechanismEmbeddingDimension[ \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\) ][ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ], MechanismEmbeddingDimension[\
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\)] changes the embedding \
dimension of mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) to \
\!\(\*StyleBox[\"d\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToFOLD", "::", "usage"}], "=", 
   "\"\<SaveToFOLD[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"filename\",FontSlant->\"Italic\"]\)] saves a FOLD file from \
mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LoadFromFOLD", "::", "usage"}], "=", "\n", 
   "\"\<LoadFromFOLD[\!\(\*StyleBox[\"filename\",FontSlant->\"Italic\"]\)] \
loads a Mechanism from a FOLD. Use option \\\"Face\\\" to choose how to treat \
a polygon.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6587]:=",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentification", "::", "usage"}], "=", "\n", 
    "\"\<PeriodicIdentification[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)]\
 returns a PeriodicIdentificationData object if a mechanism has periodic data \
attached to it.\n\
PeriodicIdentification[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"f\",FontSlant->\"Italic\"], \"1\"]\) \
\[RightArrow] \!\(\*SubscriptBox[StyleBox[\"func\",FontSlant->\"Italic\"], \
\"1\"]\),..} ] applies transformation functions \
\!\(\*SubscriptBox[StyleBox[\"func\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"func\",FontSlant->\"Italic\"], \"2\"]\), ... \
and creates a list of vertices identified via those transformations.\n\
PeriodicIdentification[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"z\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"z\",FontSlant->\"Italic\"], \"2\"]\),...}, \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\), \
...}] identifies vertices under translation vectors \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\), ...} \
and returns rules identifying VertexDisplacement objects up to corresponding \
factors of {\!\(\*SubscriptBox[StyleBox[\"z\",FontSlant->\"Italic\"], \
\"1\"]\), \!\(\*SubscriptBox[StyleBox[\"z\",FontSlant->\"Italic\"], \
\"2\"]\),...}.\n\
PeriodicIdentification[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\), \
...}] identifies vertices under translation vectors \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\), ...} \
and returns rules identifying VertexDisplacement objects.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "::", "usage"}], "=", 
   "\"\<PeriodicIdentificationData is a structure for periodic \
Mechanisms.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationDataQ", "::", "usage"}], "=", 
    "\"\<PeriodicIdentificationDataQ[ \
\!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\) is a \
PeriodicIdentificationData structure.\nPeriodicIdentificationDataQ[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\) ] returns True if \
\!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\) is a \
PeriodicIdentificationData structure that can correspond to Mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "usage"}], "=", "\n", 
   "\"\<MechanismUnitCell[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
reduces a periodic mechanism to a smallest unit cell that has periodic data \
attached to it.\n\
MechanismUnitCell[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"vector\",FontSlant->\"Italic\"], \"2\"]\), \
...}] reduces a Mechanism to the smallest unit cell that can be tesselated \
periodically according to the basis of vectors provided.\nIt relies on \
PeriodicIdentification[] but unfortunately renumbers vertices.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeleteDanglingVertices", "::", "usage"}], "=", 
    "\"\<DeleteDanglingVertices is an option for MechanismUnitCell[] to \
determine whether disconnected vertices should be deleted.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LabelPeriodicVertices", "::", "usage"}], "=", 
    "\"\<LabelPeriodicVertices[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"style\",FontSlant->\"Italic\"]\) ], LabelPeriodicVertices[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"periodic\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\) ] \
labels a mechanism consistent with its periodic data using a text \
style.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MakePeriodic", "::", "usage"}], "=", 
   "\"\<MakePeriodic[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"basis\",FontSlant->\"Italic\"]\)], \
MakePeriodic[\!\(\*StyleBox[\"basis\",FontSlant->\"Italic\"]\)][\!\(\*\
StyleBox[\"m\",FontSlant->\"Italic\"]\)] makes a mechanism periodic using \
provided basis vectors. This attaches automatic periodicity constraints to \
the mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicMechanismQ", "::", "usage"}], "=", 
   "\"\<PeriodicMechanismQ[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns True if a mechanism is periodic.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6598]:=",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementVector", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementVector[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\
\"]\), \!\(\*StyleBox[\"edge\",FontSlant->\"Italic\"]\) ] returns the vector \
pointing along an oriented edge.\nDisplacementVector[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), { \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"2\"]\), ...} ] \
returns list of displacement vectors.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLength", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementLength[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\
\"]\), \!\(\*StyleBox[\"edge\",FontSlant->\"Italic\"]\) ] returns the length \
of an edge.\nDisplacementLength[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), { \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"2\"]\), ...} ] \
returns lengths of a list of edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DisplacementLengthSquared", "::", "usage"}], "=", "\n", 
    "\"\<DisplacementLengthSquared[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"edge\",FontSlant->\"Italic\"]\) ] returns the squared length \
of an edge.\nDisplacementLengthSquared[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), { \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"2\"]\), ...} ] \
returns squared lengths of a list of edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"vectorAngle", "::", "usage"}], "=", "\n", 
    "\"\<vectorAngle[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)}] returns \
the angle at vertex 2 spanned by the other two points.\nvectorAngle[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns the vertex angles anong a list of vertex triples.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TurningAngle", "::", "usage"}], "=", "\n", 
    "\"\<TurningAngle[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)}] returns \
the turning angle at vertex 2 spanned by the other two points.\nTurningAngle[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns the turning angles anong a list of vertex triples.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NormalVector", "::", "usage"}], "=", "\n", 
    "\"\<NormalVector[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)} ] returns \
the vector normal to the plane spanned by the three points.\nNormalVector[ \!\
\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns vectors normal to the plane spanned by the list of triples.\n\
NormalVector[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"polygon\",FontSlant->\"Italic\"]\) ] returns the vector \
normal to a polygon.\nNormalVector[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"polygon\",FontSlant->\"Italic\"], \"1\"]\), \!\
\(\*SubscriptBox[StyleBox[\"polygon\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns the vectors normal to a list of polygons.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceArea", "::", "usage"}], "=", "\n", 
    "\"\<FaceArea[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), {\!\
\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)} ] returns \
the area of the Face spanned by the three points.\nFaceArea[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns the area of the Face spanned by the list of triples.\nFaceArea[ \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"polygon\",FontSlant->\"Italic\"]\) ] returns area of a \
polygon.\nFaceArea[ \!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"polygon\",FontSlant->\"Italic\"], \"1\"]\), \!\
\(\*SubscriptBox[StyleBox[\"polygon\",FontSlant->\"Italic\"], \"2\"]\), ...} \
] returns the areas of a list of polygons.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlaneAngle", "::", "usage"}], "=", "\n", 
    "\"\<PlaneAngle[\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)} ] returns \
the oriented angle at vertex v2 spanned by the other two vertices.\n\
PlaneAngle[\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"triple\",FontSlant->\"Italic\"], \"2\"]\), \
...}] returns the oriented angles at for each triple of verticles.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldAngle", "::", "usage"}], "=", "\n", 
    "\"\<TorsionalFoldAngle[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"edge\",FontSlant->\"Italic\"]\) ] returns the TorsionalFold \
angle along an edge.\nTorsionalFoldAngle[ m, \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), { \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"edge\",FontSlant->\"Italic\"], \"2\"]\), ...} ] \
returns the TorsionalFold angle of a list of edges.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DiscreteGaussianCurvature", "::", "usage"}], "=", "\n", 
    "\"\<DiscreteGaussianCurvature[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\) ] returns the discrete \
Gaussian curvature of vertex.\nDiscreteGaussianCurvature[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), ...} ] \
returns the discrete Gaussian curvature of a list of vertices.\n\
DiscreteGaussianCurvature[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"metric\",FontSlant->\"Italic\"]\), \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\), \
\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\), ...} ] \
uses a metric to explicitly compute the Gaussian curvature at each \
vertex.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AlignMechanism", "::", "usage"}], "=", 
    "\"\<AlignMechanism[ \
\!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"2\"]\) ] \
returns a list of positions that best align the second Mechanism to the \
first.\n\!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \
\"1\"]\) and \!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \
\"2\"]\) can be either be a Mechanism, a list of positions, { \!\(\*StyleBox[\
\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"vertices\",FontSlant->\"Italic\"]\) }, or \
{\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"vertices\",FontSlant->\"Italic\"]\)}.\nIf vertices are \
included, only the specified vertices will be used to determine the \
transformation.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CongruentMechanismQ", "::", "usage"}], "=", 
   "\"\<CongruentMechanismQ[ \!\(\*StyleBox[\"tol\",FontSlant->\"Italic\"]\) \
][ \!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"1\"]\), \!\
\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"2\"]\) ] \
returns True if the first and second mechsnisms are congruent up to a given \
tolerance \!\(\*StyleBox[\"tol\",FontSlant->\"Italic\"]\).\n\
\!\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"1\"]\) and \!\
\(\*SubscriptBox[StyleBox[\"mSpec\",FontSlant->\"Italic\"], \"2\"]\) can be \
either be a Mechanism, a list of positions, { \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"vertices\",FontSlant->\"Italic\"]\) }, or \
{\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"vertices\",FontSlant->\"Italic\"]\)}.\nIf vertices are \
included, only the specified vertices will be used to determine the \
transformation.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6606]:=",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"]
}, Closed]],

Cell[CellGroupData[{

Cell["global data and patterns", "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6618]:=",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"],

Cell[CellGroupData[{

Cell["listParameters[],expandExpression[]", "Subsubsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listParameters", "[", "expr_", "]"}], ":=", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Extract", "[", 
       RowBox[{"expr", ",", "#"}], "]"}], "&"}], ")"}], "/@", 
    RowBox[{"Position", "[", 
     RowBox[{
      RowBox[{"List", "@@", "expr"}], ",", 
      RowBox[{"Infinitesimal", "[", 
       RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6620]:=",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"This", " ", "basically", " ", "does", " ", "what", " ", 
    RowBox[{"Series", "[", "]"}], " ", "does", " ", "in", " ", "a", " ", 
    "somewhat", " ", "dumber", " ", 
    RowBox[{"way", ".", "\n", "\t", "It"}], " ", 
    RowBox[{"won", "'"}], "t", " ", "handle", " ", "limits", " ", "as", " ", 
    "nicely", " ", "as", " ", 
    RowBox[{"Series", "[", "]"}], " ", "but", " ", "it", " ", "typically", 
    " ", "presents", " ", "results", " ", "that", " ", "look", "\n", "\t", 
    "more", " ", "useful", " ", "for", " ", "analytic", " ", 
    RowBox[{"expressions", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", ",", "param_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "tmp"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"tmp", "@@", "param"}], ")"}], "^", "i"}], " ", 
            RowBox[{
             RowBox[{"D", "[", 
              RowBox[{"expr", ",", 
               RowBox[{"{", 
                RowBox[{"param", ",", "i"}], "}"}]}], "]"}], "/", 
             RowBox[{"(", 
              RowBox[{"i", "!"}], ")"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"param", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "/.", 
         RowBox[{"param", "->", "0"}]}], "]"}], "/.", 
       RowBox[{"tmp", "->", "Infinitesimal"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", 
     RowBox[{"expr_", "?", "NumericQ"}], "]"}], ":=", "expr"}], "\n", 
   RowBox[{
    RowBox[{"expandExpression", "[", "expr_", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"params", "=", 
        RowBox[{"listParameters", "[", "expr", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"Fold", "[", 
       RowBox[{"expandExpression", ",", "expr", ",", 
        RowBox[{"Reverse", "@", "params"}]}], "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6621]:=",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["topology", "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],

Cell[CellGroupData[{

Cell["MechanismConnectivity[]", "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],

Cell[CellGroupData[{

Cell["orderPairs[]", "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],

Cell["\<\
orderPairs[{{n1, n2}, {n3, n4}, ...}]
 When provided a list of pairs, {1, b}, sort them in order such that {{1, 2}, \
{2, 3}, {3, 4}, ...}
 
 orderPairs[list 1, list 2] orders pairs in which elements of each list are \
paired with
 the corresponding element.\
\>", "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orderPairs", "[", 
    RowBox[{"pairList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], "]"}], ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"Graph", "[", 
      RowBox[{"UndirectedEdge", "@@@", "pairList"}], "]"}], "]"}], "/;", " ", 
    
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pairList", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], "==", "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"orderPairs", "[", 
   RowBox[{"pairList_", ",", "correspondingList_"}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{"association", "=", 
       RowBox[{"Dispatch", "@", 
        RowBox[{"Thread", "[", 
         RowBox[{"pairList", "->", "correspondingList"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"orderPairs", "[", "pairList", "]"}], "/.", "association"}]}], 
    "\n", "]"}], "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "pairList", "]"}], "==", 
    RowBox[{"Length", "[", "correspondingList", "]"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6624]:=",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "does", " ", "a", " ", "topological", " ", "sort", " ", "on", 
    " ", "a", " ", "graph"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", 
     RowBox[{"g_", "?", "AcyclicGraphQ"}], "]"}], ":=", 
    RowBox[{"Partition", "[", 
     RowBox[{
      RowBox[{"TopologicalSort", "[", 
       RowBox[{"DirectedEdge", "@@@", 
        RowBox[{"EdgeList", "[", "g", "]"}]}], "]"}], ",", "2", ",", "1"}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"orderPairsTopologicalSort", "[", "g_Graph", "]"}], ":=", 
    RowBox[{"List", "@@@", 
     RowBox[{"(", 
      RowBox[{"First", "@", 
       RowBox[{"FindCycle", "[", 
        RowBox[{"g", ",", "Infinity", ",", "1"}], "]"}]}], 
      ")"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6627]:=",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],

Cell[CellGroupData[{

Cell["rotateTo[]", "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{"s_List", ",", "v_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"FirstPosition", "[", 
       RowBox[{"s", ",", "v"}], "]"}]}], "}"}], ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MissingQ", "[", "pos", "]"}], ",", "s", ",", 
      RowBox[{"RotateLeft", "[", 
       RowBox[{"s", ",", 
        RowBox[{
         RowBox[{"pos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "]"}]}], "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateTo", "[", 
   RowBox[{
    RowBox[{"h_", "[", "s_List", "]"}], ",", "v_"}], "]"}], ":=", 
  RowBox[{"h", "[", 
   RowBox[{"rotateTo", "[", 
    RowBox[{"s", ",", "v"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6629]:=",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["orderFaces[]", "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"orderFaces", "[", 
   RowBox[{"FaceList_", ",", "v_Integer"}], "]"}], ":=", 
  RowBox[{"orderPairs", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"Last", "[", "#", "]"}]}], "}"}], "&"}], "/@", "FaceList"}], 
    ",", "FaceList"}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6631]:=",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConnectivity[]", "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", "\"\<Methods\>\"", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\""}], "}"}],
      "->", 
     RowBox[{"{", 
      RowBox[{
      "\"\<vertices\>\"", ",", "\"\<edges\>\"", ",", "\"\<faces\>\"", ",", 
       "\"\<ordered faces\>\"", ",", "\"\<ordered edges\>\""}], "}"}]}], 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6632]:=",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<faces\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"m", "[", "\"\<edges\>\"", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6633]:=",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{"rotateThroughFaces", "[", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
         "]"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"GatherBy", "[", 
       RowBox[{"(*", "unpacks", "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"(*", "unpacks", "*)"}], "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", " ", 
              RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", 
              "]"}], " ", "]"}], "}"}], "]"}], ",", " ", 
          RowBox[{"(*", 
           RowBox[{
           "make", " ", "a", " ", "list", " ", "of", " ", "vertices", " ", 
            "in", " ", "order", " ", "of", " ", "the", " ", "form", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "1", "}"}], ",", 
              RowBox[{"{", "2", "}"}], ",", "..."}], "}"}]}], "*)"}], "\n", 
          "\t\t\t", "Faces"}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
        "First"}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", 
        RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"rotateThroughFaces", "[", 
    RowBox[{"{", "}"}], "]"}], ":=", 
   RowBox[{"{", "}"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "all", " ", "faces", " ", "are", " ", "the", " ", "same", " ", "length"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"rotateThroughFaces", "[", 
    RowBox[{"Faces_", "?", "MatrixQ"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"NestList", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateLeft", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "Faces", ",", 
       
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Dimensions", "[", "Faces", "]"}], "]"}], "-", "1"}]}], 
      "]"}], ",", "1"}], "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"faces", " ", "are", " ", "different", " ", "length"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"rotateThroughFaces", "[", "Faces_", "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"groupedFaces", " ", "=", " ", 
      RowBox[{"GatherBy", "[", 
       RowBox[{"Faces", ",", " ", "Length"}], "]"}]}], "\n", "}"}], ",", "\n",
     "\t", 
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{"rotateThroughFaces", " ", "/@", " ", "groupedFaces"}], ",", 
      " ", "1"}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6635]:=",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], " ", 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<faces\>\"", "->", "\"\<vertices\>\""}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"facesTOedges", "[", "cells", "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"facesTOedges", "[", 
   RowBox[{"cells2_", "?", "MatrixQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cells", "=", 
      RowBox[{"Transpose", "[", "cells2", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"Join", "[", 
           RowBox[{"cells", ",", 
            RowBox[{"{", 
             RowBox[{"cells", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", "1"}], "]"}], ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"facesTOedges", "[", "cells_", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Partition", "[", " ", 
     RowBox[{"#", ",", " ", "2", ",", " ", "1", ",", " ", "1"}], "]"}], "&"}],
    "/@", "cells"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6639]:=",ExpressionUUID->"1b0c0323-d23f-4df8-93ef-26ae105ee1ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "unpacks", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConnectivity", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ", 
     "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"edges", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}], ",", " ", 
        RowBox[{"faces", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"GatherBy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"edges", ",", 
             RowBox[{"rotateCells", "[", "faces", "]"}]}], "}"}], ",", "1"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], "&"}]}], "]"}], 
       "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"2", ";;"}]}], "]"}], "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "rotateCells", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{"\"\<Flatten\>\"", "->", "True"}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"rotateCells", "[", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sortedCells", "=", 
         RowBox[{"GatherBy", "[", 
          RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"NestList", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"RotateLeft", "[", 
               RowBox[{"#", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", 
             ",", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
           "&"}], "/@", "sortedCells"}], ",", "2"}], "]"}]}], "\n", "]"}], 
     " ", "/;", " ", 
     RowBox[{"OptionValue", "[", "\"\<Flatten\>\"", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"rotateCells", "[", 
     RowBox[{"cells_", " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sortedCells", "=", 
        RowBox[{"GatherBy", "[", 
         RowBox[{"cells", ",", "Length"}], "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"First", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"#", ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}]}], "]"}], "&"}], ",", "#", ",", 
           
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
         "&"}], "/@", "sortedCells"}], "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6642]:=",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "unpacks", "*)"}], "\n", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
    " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"Join", "[", " ", 
        RowBox[{
         RowBox[{"MechanismConnectivity", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", "#"}], "}"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}]}]}], "]"}]}],
       "}"}], ",", "\n", "\t", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"GatherBy", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"edges", ",", 
               RowBox[{"Reverse", "[", 
                RowBox[{"edges", ",", 
                 RowBox[{"{", "2", "}"}]}], "]"}]}], "}"}], ",", "1"}], "]"}],
            ",", "First"}], "]"}], ",", "First"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"a_", ",", "a_"}], "}"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6646]:=",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Unpacks", " ", 
    RowBox[{"lists", "."}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{
     "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}], " ", 
    "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"test1", "=", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", 
          RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], ",",
        "\n", 
       RowBox[{"edges", "=", 
        RowBox[{"Transpose", "[", " ", 
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"ToPackedArray", "@", 
      RowBox[{"MapThread", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "\n", "\t\t", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"{", 
                RowBox[{"__", ",", "#2"}], "}"}]}], "]"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"test1", "[", 
               RowBox[{"[", 
                RowBox[{"edges", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"edges", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", "\n", 
          "\t\t", 
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"{", 
                RowBox[{"_", ",", "#2", ",", "__"}], "}"}]}], "]"}], "&"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"test1", "[", 
               RowBox[{"[", 
                RowBox[{"edges", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"edges", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "\n", 
         "\t\t", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6647]:=",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{"Unpacks", " ", 
    RowBox[{"lists", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{
     "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered faces\>\""}]}], 
    "]"}], ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"unorderedFace", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<vertices\>\"", "->", "\"\<faces\>\""}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{"MapThread", "[", 
      RowBox[{"orderFaces", ",", 
       RowBox[{"{", 
        RowBox[{"unorderedFace", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "unorderedFace", "]"}], "]"}]}], "}"}]}], 
      "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6648]:=",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{
    "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<ordered edges\>\""}]}], 
   "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", 
    RowBox[{"m", ",", 
     RowBox[{"\"\<vertices\>\"", "->", "\"\<ordered faces\>\""}]}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", 
     RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6649]:=",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"\"\<vertices\>\"", " ", "->", " ", "end_String"}], " ", ",", 
     " ", "test_"}], " ", "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"MechanismConnectivity", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<vertices\>\"", " ", "->", " ", "end"}]}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"selector", " ", "=", " ", 
          RowBox[{"test", " ", "/@", " ", "data"}]}], "}"}], ",", "\n", 
        "\t\t", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"VectorQ", "[", " ", 
           RowBox[{"selector", ",", " ", "BooleanQ"}], "]"}], ",", " ", 
          RowBox[{"Pick", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], ",", " ", 
            "selector"}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"MechanismConnectivity", "::", "test"}], ",", " ", 
             "test", ",", " ", "end"}], "]"}], ";", " ", 
           RowBox[{"{", "}"}]}]}], " ", "]"}]}], "\n", "\t", "]"}], " ", "/;",
       " ", 
      RowBox[{
       RowBox[{"Head", "[", "data", "]"}], " ", "=!=", " ", 
       "MechanismConnectivity"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"start_String", " ", "->", " ", "end_String"}], " ", ",", " ", 
     "test_"}], " ", "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"MechanismConnectivity", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"start", " ", "->", " ", "end"}]}], "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"selector", " ", "=", " ", 
          RowBox[{"test", " ", "/@", " ", "data"}]}], "}"}], ",", "\n", 
        "\t\t", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"VectorQ", "[", " ", 
           RowBox[{"selector", ",", " ", "BooleanQ"}], "]"}], ",", " ", 
          RowBox[{"Pick", "[", " ", 
           RowBox[{
            RowBox[{"m", "[", "start", "]"}], ",", " ", "selector"}], "]"}], 
          ",", " ", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"MechanismConnectivity", "::", "test"}], ",", " ", 
             "test", ",", " ", "end"}], "]"}], ";", " ", 
           RowBox[{"{", "}"}]}]}], " ", "]"}]}], "\n", "\t", "]"}], " ", "/;",
       " ", 
      RowBox[{
       RowBox[{"Head", "[", "data", "]"}], " ", "=!=", " ", 
       "MechanismConnectivity"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "::", "test"}], " ", "=", " ", 
   "\"\<Applying `1` to list of `2` did not yield boolean values.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6650]:=",ExpressionUUID->"2ce4027e-bc52-4830-bdf4-72f275b86492"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConnectivity", "::", "badcombo"}], "=", 
   "\"\<Methods `1` -> `2` are not recognized in this combination.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConnectivity", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"Rule", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConnectivity", "::", "badcombo"}], ",", "a", ",", 
     "b"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6653]:=",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["BoundaryVertices[], BoundaryEdges[], BoundaryFaces[]", "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryEdges", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"FacePairs", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"edges", "=", 
       RowBox[{"MechanismConnectivity", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}],
         "]"}]}], ",", "\n", "\t", "boundary"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"boundary", "=", 
      RowBox[{"Pick", "[", " ", 
       RowBox[{"edges", ",", " ", 
        RowBox[{"Length", " ", "/@", " ", "FacePairs"}], ",", " ", "1"}], " ",
        "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "boundary", "]"}], "==", "0"}], ",", "\n", 
       "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"List", "@@", "#"}], "&"}], ",", 
         RowBox[{"FindCycle", "[", 
          RowBox[{
           RowBox[{"Graph", "[", "boundary", "]"}], ",", "Infinity", ",", 
           "All"}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6655]:=",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryVertices", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"Map", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"First", "@@", "#"}], "&"}], " ", ",", " ", 
    RowBox[{"BoundaryEdges", "[", "m", "]"}], " ", ",", " ", 
    RowBox[{"{", "2", "}"}]}], " ", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6656]:=",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BoundaryFaces", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"boundary", " ", "=", " ", 
         RowBox[{"BoundaryVertices", "[", "m", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"Faces", " ", "=", " ", 
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], " ", 
          "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{"Table", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Select", "[", " ", 
         RowBox[{"Faces", ",", " ", 
          RowBox[{
           RowBox[{"ContainsAny", "[", 
            RowBox[{
             RowBox[{"boundary", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}]}], " ",
          "]"}], ",", "\n", "\t\t\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "boundary", "]"}]}], "}"}]}], "\n", "\t\t", 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6657]:=",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],

Cell[CellGroupData[{

Cell["InteriorEdges[], InteriorVertices[]", "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InteriorEdges", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"testfunction", " ", "=", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", ">", "1"}], "&"}], ")"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"Pick", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"MechanismConnectivity", "[", " ", 
       RowBox[{"mr", ",", " ", 
        RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
       "]"}], ",", "\n", "\t\t", 
      RowBox[{"testfunction", " ", "/@", " ", 
       RowBox[{"Length", " ", "/@", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"mr", ",", " ", 
          RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], 
         "]"}]}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6658]:=",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InteriorVertices", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", 
  RowBox[{"Complement", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"InteriorEdges", "[", "mr", "]"}], "]"}], " ", "]"}], ",", "\n",
     "\t", 
    RowBox[{"Flatten", " ", "@", " ", 
     RowBox[{"BoundaryVertices", "[", "mr", "]"}]}]}], "\n", "]"}]}]], "Code",\

 CellLabel->
  "1/2/24 10:12:02 \
In[6659]:=",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismOrientedQ[]", "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismOrientedQ", "[", 
   RowBox[{"mr_", "?", "MechanismQ"}], "]"}], ":=", "\n", "\t", 
  RowBox[{"AllTrue", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"MechanismConnectivity", "[", 
       RowBox[{"mr", ",", 
        RowBox[{"\"\<edges\>\"", "->", "\"\<faces\>\""}]}], "]"}], " ", ",", 
      " ", 
      RowBox[{"{", "_", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
    "facePairOrientedQ"}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismOrientedQ", "[", "_", "]"}], ":=", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6660]:=",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"{", 
    RowBox[{"v1_", ",", "v2_"}], "}"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"facePairOrientedQ", "[", 
   RowBox[{"v1_", ",", "v2_"}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"eg2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"RotateLeft", "[", 
            RowBox[{"v2", ",", "#"}], "]"}], ",", "2"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v2", "]"}], "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"eg1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"RotateLeft", "[", 
             RowBox[{"v1", ",", "#"}], "]"}], ",", "2"}], "]"}], "]"}], "&"}],
         "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "v1", "]"}], "]"}]}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{"ContainsAny", "[", 
     RowBox[{"eg1", ",", "eg2"}], "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6662]:=",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEmbeddingDimension[], MechanismDisplayDimension[]", \
"Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismEmbeddingDimension", "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], ":=", " ", 
  RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "[", " ", 
     RowBox[{"d", " ", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"oldPositions", " ", "=", " ", 
       RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"1", " ", "\[Rule]", " ", 
        RowBox[{"PadRight", "[", " ", 
         RowBox[{"oldPositions", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "oldPositions", "]"}], ",", "d"}], "}"}]}],
          " ", "]"}]}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEmbeddingDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEmbeddingDimension", "[", " ", "d_", " ", "]"}], "[", 
    " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"MechanismEmbeddingDimension", "::", "dim"}], ",", " ", "d"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEmbeddingDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], "]"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismEmbeddingDimension", "[", "d", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6664]:=",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"m", "[", "\"\<DisplayDimension\>\"", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", " ", "[", " ", 
     RowBox[{"d", ":", " ", 
      RowBox[{"2", "|", "3"}]}], " ", "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Mechanisms`Private`addMeshRegion", "[", 
        RowBox[{"m", ",", "d", ",", 
         RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"MechanismQ", "[", "res", "]"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "::", "dim"}], " ", "=", " ", 
   "\"\<Dimension `1` should be 2 or 3.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismDisplayDimension", "[", " ", "d_", " ", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", " ", 
     RowBox[{
      RowBox[{"MechanismDisplayDimension", "::", "dim"}], ",", " ", "d"}], 
     " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismDisplayDimension", "[", " ", 
   RowBox[{"Rule", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], " ", "]"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MechanismDisplayDimension", "[", "d", "]"}], "[", "m", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6669]:=",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionDimension[], RegionEmbeddingDimension[]", "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionEmbeddingDimension", "[", "o_Linkage", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"MechanismEmbeddingDimension", "[", "o", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionEmbeddingDimension", "[", "o_Origami", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"MechanismEmbeddingDimension", "[", "o", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionDimension", "[", "o_Linkage", "]"}], " ", "^:=", " ", 
  RowBox[{"Which", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"MechanismFaces", "[", "o", "]"}], "]"}], ">", "0"}], ",", " ", 
    "2", ",", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"MechanismEdges", "[", "o", "]"}], "]"}], ">", "0"}], ",", " ", 
    "1", ",", " ", "True", ",", " ", "0"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionDimension", "[", "o_Origami", "]"}], " ", "^:=", " ", 
  RowBox[{"Which", "[", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"MechanismFaces", "[", "o", "]"}], "]"}], ">", "0"}], ",", " ", 
    "2", ",", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"MechanismEdges", "[", "o", "]"}], "]"}], ">", "0"}], ",", " ", 
    "1", ",", " ", "True", ",", " ", "0"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:02 \
In[6674]:=",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["vertex positions and displacements", "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],

Cell[CellGroupData[{

Cell["\<\
VertexCoordinatesQ[], NumericCoordinatesQ[], \
NumericMachinePrecisionCoordinatesQ[], VertexCoordinateListQ[]\
\>", "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VertexCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "}"}],
     ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6678]:=",ExpressionUUID->"363014a0-649a-4fa7-9e0b-27134679686f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VertexCoordinateListQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ArrayQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"ArrayDepth", "[", "coord", "]"}], "==", "3"}], " ", ",", " ", 
      
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "\[Equal]", "2"}], 
       " ", "||", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "\[Equal]", 
        "3"}]}]}], "}"}], ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexCoordinateListQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ArrayQ", "[", "coord", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"ArrayDepth", "[", "coord", "]"}], "==", "3"}], " ", ",", " ", 
      
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"coord", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6680]:=",ExpressionUUID->"972a811f-3d92-4ab4-91eb-dbcdea577d56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NumericCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", " ", "NumericQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "}"}],
     ",", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NumericCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", "NumericQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6682]:=",ExpressionUUID->"1bd477fd-b514-4438-88a5-1f619ede0e10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "NumericMachinePrecisionCoordinatesQ", "[", " ", "coord_", " ", "]"}], " ", 
  ":=", " ", "\n", "\t", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", " ", "MachineRealQ"}], "]"}], ",", "\n", 
      "\t\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "2"}], " ", "||",
        " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"coord", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[Equal]", "3"}]}]}], "\n", 
     "\t\t\t", "}"}], ",", "\n", "\t\t\t", "TrueQ"}], "\n", "\t", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"NumericMachinePrecisionCoordinatesQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "coord_"}], " ", "]"}], " ", 
  ":=", "\n", "\t", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"coord", ",", "MachineRealQ"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Length", "[", "coord", "]"}], " ", "\[Equal]", " ", 
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", " ", 
    "TrueQ"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6684]:=",ExpressionUUID->"48138634-e03b-42d4-9ae9-f9f5ceaaf2e6"]
}, Closed]],

Cell[CellGroupData[{

Cell["OrthogonalizeDisplacements[]", "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", " ", 
   RowBox[{
    RowBox[{"displacements_", "?", "VertexCoordinateListQ"}], ",", " ", 
    RowBox[{"tol", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "8"}], ")"}]}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{
        RowBox[{"Dimensions", "[", "displacements", "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ",", " ", 
      RowBox[{"tolsq", " ", "=", " ", 
       RowBox[{"tol", "^", "2"}]}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", " ", "dim"}], "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"Select", "[", " ", 
      RowBox[{
       RowBox[{"Orthogonalize", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", " ", "/@", " ", "displacements"}], ",", " ", 
         RowBox[{"Tolerance", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], ",",
        " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", ".", " ", "#"}], " ", ">", " ", "tolsq"}], " ", 
        "&"}]}], " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6686]:=",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OrthogonalizeDisplacements", "::", "notdispl"}], "=", 
   "\"\<Not a list of valid vertex displacements of the same \
dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OrthogonalizeDisplacements", "::", "tol"}], "=", 
    "\"\<Tolerance must be numeric.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "___"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"OrthogonalizeDisplacements", "::", "notdispl"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"OrthogonalizeDisplacements", "[", 
   RowBox[{"displacements_", ",", "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"OrthogonalizeDisplacements", "::", "tol"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6687]:=",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],

Cell[CellGroupData[{

Cell["VertexPosition[], VertexDisplacement[]", "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$coordinateSymbols", "[", "3", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$coordinateSymbols", "[", "2", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", 
    RowBox[{"All", "[", " ", "d_Integer", " ", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n_Integer", ",", " ", "m_Integer"}], "]"}], " ", ":=", " ", 
  RowBox[{"VertexPosition", "[", 
   RowBox[{"n", ",", " ", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "d_"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexPosition", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], " ", "/@", " ", 
   RowBox[{"Range", "[", 
    RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexPosition", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"VertexPosition", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"All", "[", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], " ",
    "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexPosition", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"n", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"VertexPosition", "[", " ", 
    RowBox[{"n", ",", " ", 
     RowBox[{"All", "[", " ", 
      RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", "n"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"d", " ", ":", " ", 
     RowBox[{
      RowBox[{"{", "__String", "}"}], "|", 
      RowBox[{"{", "__Integer", "}"}]}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", 
    RowBox[{"All", "[", "d_Integer", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
   RowBox[{"$coordinateSymbols", "[", "d", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n_Integer", ",", "m_Integer"}], "]"}], ":=", 
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"n", ",", 
    RowBox[{
     RowBox[{"$coordinateSymbols", "[", "3", "]"}], "[", 
     RowBox[{"[", "m", "]"}], "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", "d_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"VertexDisplacement", "[", 
     RowBox[{"#", ",", "d"}], "]"}], "&"}], "/@", 
   RowBox[{"Range", "[", 
    RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], ":=", 
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{"m", ",", 
    RowBox[{"All", "[", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], "]"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"VertexDisplacement", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"n", " ", ":", " ", 
     RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"VertexDisplacement", "[", " ", 
   RowBox[{"n", ",", " ", 
    RowBox[{"All", "[", " ", 
     RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", "]"}]}], " ",
    "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6691]:=",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "VertexPosition", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"p", "[", "\"\<VertexPosition\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
  "VertexDisplacement", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"p", "[", "\"\<VertexDisplacement\>\"", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6707]:=",ExpressionUUID->"90948bbb-01c4-4119-a2a2-6a57e3256c77"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementRules[], PositionRules[], PositionConstraints[]", \
"Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "PositionRules", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], " ", 
  ":=", " ", 
  RowBox[{"p", "[", "\"\<PositionRules\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"latticeVectors_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"\"\<LatticeVectors\>\"", "->", "latticeVectors"}], "]"}], "[", 
     "\"\<PositionRules\>\"", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "latticeVectors", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "::", "lat"}], "=", 
   "\"\<Lattice vectors should have dimensions `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{
    "p_PeriodicIdentificationData", " ", ",", " ", "latticeVectors_"}], " ", 
    "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"PositionRules", "::", "lat"}], ",", 
      RowBox[{"Dimensions", "[", 
       RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", 
   RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"arbitraryPositions", " ", "=", " ", 
      RowBox[{"Array", "[", " ", 
       RowBox[{"VertexPosition", ",", " ", 
        RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{"Rule", ",", " ", 
       RowBox[{"{", 
        RowBox[{"arbitraryPositions", ",", " ", "positions"}], "}"}], ",", 
       " ", "2"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "[", " ", 
    RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{"VertexPosition", ",", " ", 
         RowBox[{
          RowBox[{"Dimensions", "[", "positions", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], " ", "]"}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "/@", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"Rule", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"arbitraryPositions", ",", " ", 
            RowBox[{"Length", "[", "positions", "]"}]}], " ", "]"}], ",", " ",
           "positions"}], " ", "}"}], " ", ",", " ", "3"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PositionRules", "[", " ", "pos_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"PositionRules", "::", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionRules", "::", "pos"}], " ", "=", " ", 
   "\"\<Argument should either be a mechanism, vertex positions {pt1, \
pt2,...}, or a list of vertex positions { {pt1, ...}, ...} .\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6709]:=",ExpressionUUID->"fc8e80b7-f492-45a8-ad2d-80d222d7c4ab"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PositionConstraints", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"latticeVectors_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"\"\<LatticeVectors\>\"", "->", "latticeVectors"}], "]"}], "[", 
     "\"\<Constraints\>\"", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "latticeVectors", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PositionConstraints", "::", "lat"}], "=", 
   "\"\<Lattice vectors should have dimensions `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"PositionConstraints", "[", " ", 
   RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", "latticeVectors_"}],
    " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"PositionConstraints", "::", "lat"}], ",", 
     RowBox[{"Dimensions", "[", 
      RowBox[{"p", "[", "\"\<LatticeVectors\>\"", "]"}], "]"}]}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6718]:=",ExpressionUUID->"166d33b4-951a-4278-9c5e-954e8a50f80a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "DisplacementRules", "[", " ", "p_PeriodicIdentificationData", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"p", "[", "\"\<DisplacementRules\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"p_PeriodicIdentificationData", " ", ",", " ", 
     RowBox[{"wavevectors_", "?", "VectorQ"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"p", "[", "\"\<DisplacementRules\>\"", "]"}], " ", "/.", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"p", "[", "\"\<labels\>\"", "]"}], "->", "wavevectors"}], 
       "]"}]}], ")"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "wavevectors", "]"}], "==", 
     RowBox[{"Length", "[", 
      RowBox[{"p", "[", "\"\<labels\>\"", "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "::", "wavevectors"}], "=", 
   "\"\<You need `1` wave vectors to be provided\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"p_PeriodicIdentification", ",", " ", "_"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"DisplacementRules", "::", "wavevector"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], "]"}]}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementRules", "[", " ", 
   RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"arbitraryPositions", " ", "=", " ", 
      RowBox[{"Array", "[", " ", 
       RowBox[{"VertexDisplacement", ",", " ", 
        RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", 
     RowBox[{"MapThread", "[", 
      RowBox[{"Rule", ",", " ", 
       RowBox[{"{", 
        RowBox[{"arbitraryPositions", ",", " ", "positions"}], "}"}], ",", 
       " ", "2"}], "]"}], "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "[", " ", 
    RowBox[{"positions_", "?", "VertexCoordinateListQ"}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"arbitraryPositions", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{"VertexDisplacement", ",", " ", 
         RowBox[{
          RowBox[{"Dimensions", "[", "positions", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"2", ";;"}], "]"}], "]"}]}], " ", "]"}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "/@", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"Rule", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", " ", 
           RowBox[{"arbitraryPositions", ",", " ", 
            RowBox[{"Length", "[", "positions", "]"}]}], " ", "]"}], ",", " ",
           "positions"}], " ", "}"}], " ", ",", " ", "3"}], " ", "]"}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DisplacementRules", "[", " ", "pos_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"DisplacementRules", "::", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementRules", "::", "pos"}], " ", "=", " ", 
   "\"\<Argument should either be vertex positions {pt1, pt2,...}, or a list \
of vertex positions { {pt1, ...}, ...} .\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6721]:=",ExpressionUUID->"21b3ac33-1f56-4c92-a764-e44557b03761"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Periodic mechanisms", "Section",ExpressionUUID->"cd7a54f4-ed66-45bf-89b2-4adff5782071"],

Cell[CellGroupData[{

Cell["periodicEdges[], periodicFaces[]", "Subsection",ExpressionUUID->"154f264e-dd31-4eca-93ac-8670cfb8d68e"],

Cell["\<\
I think there is a bug here when the periodicity has fewer dimensions than \
the embedding dimension of the structure.\
\>", "Text",ExpressionUUID->"a799f3b1-f312-459d-9d78-a371ac3b9113"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"periodicEdges", "[", " ", 
    RowBox[{"m_", ",", " ", "pi_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{"pi", "[", "\"\<labels\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"edges", " ", "=", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "0"}], "}"}]}], "}"}], 
          "&"}], " ", "/@", " ", 
         RowBox[{"Sort", " ", "/@", " ", 
          RowBox[{"MechanismEdges", "[", "m", "]"}]}]}]}], " ", ",", "\n", 
       "\t", "mirroredEdges", ",", " ", "x"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"mirroredEdges", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"translateCell", " ", "/@", "  ", 
          RowBox[{
           RowBox[{"SortBy", "[", "First", "]"}], " ", "/@", " ", 
           RowBox[{"(", 
            RowBox[{"edges", " ", "//.", " ", 
             RowBox[{"pi", "[", "\"\<IdentificationRules\>\"", "]"}]}], 
            ")"}]}]}], ")"}], " ", "/.", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", "->", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"Length", "[", "labels", "]"}], "]"}]}], "]"}]}]}], ";", 
      "\n", "\t", 
      RowBox[{"collapseCell", " ", "@", " ", 
       RowBox[{"Select", "[", "  ", 
        RowBox[{
         RowBox[{"GatherBy", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"edges", " ", "->", "   ", "mirroredEdges"}], "]"}], " ", 
           ",", " ", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Last", "[", "#", "]"}], "]"}], "&"}]}], " ", "]"}], ",",
          " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "1"}], "&"}]}], " ", 
        "]"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"periodicFaces", "[", " ", 
    RowBox[{"m_", ",", " ", "pi_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{"pi", "[", "\"\<labels\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"faces", " ", "=", "  ", 
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", "0"}], "}"}], "&"}], ",", " ", 
          RowBox[{"MechanismFaces", "[", "m", "]"}], ",", " ", 
          RowBox[{"{", "2", "}"}]}], " ", "]"}]}], ",", "\n", "\t", 
       "mirroredFaces", ",", " ", "x"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"mirroredFaces", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"translateCell", " ", "/@", " ", 
          RowBox[{
           RowBox[{"SortBy", "[", "First", "]"}], " ", "/@", " ", 
           RowBox[{"(", 
            RowBox[{"faces", " ", "//.", " ", 
             RowBox[{"pi", "[", "\"\<IdentificationRules\>\"", "]"}]}], 
            ")"}]}]}], ")"}], " ", "/.", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", "->", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"Length", "[", "labels", "]"}], "]"}]}], "]"}]}]}], ";", 
      "\n", "\t", 
      RowBox[{"collapseCell", " ", "@", " ", 
       RowBox[{"Select", "[", "  ", 
        RowBox[{
         RowBox[{"GatherBy", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"faces", " ", "->", "   ", "mirroredFaces"}], "]"}], " ", 
           ",", " ", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Last", "[", "#", "]"}], "]"}], "&"}]}], " ", "]"}], ",",
          " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "#", "]"}], ">", "1"}], "&"}]}], " ", 
        "]"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"collapseCell", " ", "=", "  ", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"First", ",", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], ",", " ", "#", " ",
         ",", 
        RowBox[{"{", "3", "}"}]}], "]"}], ",", 
      RowBox[{"{", "2", "}"}]}], "]"}], "&"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"translateCell", "[", " ", "cell_List", " ", "]"}], " ", ":=", " ", 
  
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"element", " ", "=", " ", 
      RowBox[{"cell", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "}"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", "element"}]}], "}"}], "&"}], 
     " ", "/@", " ", "cell"}]}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6729]:=",ExpressionUUID->"99f31be3-ca8c-4087-acba-f5c05f25428c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"reduceCell", "[", " ", 
   RowBox[{"pi_", " ", ",", " ", "cells_List"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Transpose", " ", "/@", " ", 
   RowBox[{"translateCell", " ", "/@", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", "0"}], "}"}], "&"}], ",", " ", "cells", ",", 
          " ", 
          RowBox[{"{", "2", "}"}]}], " ", "]"}], " ", "//.", " ", 
        RowBox[{"pi", "[", "\"\<IdentificationRules\>\"", "]"}]}], " ", "/.", 
       " ", 
       RowBox[{"0", " ", "->", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0"}], "}"}]}]}], " ", "/.", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], " ", "->", " ", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], "]"}], "]"}]}], "]"}]}],
      "\n", ")"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6733]:=",ExpressionUUID->"5b59c8cb-1d68-469c-91aa-231dc671e44d"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentification[]", "Subsection",ExpressionUUID->"c9ba93b2-3e90-4f1f-8738-1c1dd5419c56"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "PeriodicIdentification", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"OverlapPrecision", "->", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "12"}], ")"}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"SelectFirst", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"Values", "[", "m", "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "#", "]"}], "===", "PeriodicIdentificationData"}],
       "&"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "basis_", " ", ",", 
     " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{"Array", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "]"}], "&"}], ",", " ", 
          RowBox[{"Length", "[", "basis", "]"}]}], "]"}]}], " ", ",", " ", 
       "\n", "\t", 
       RowBox[{"posBasis", " ", "=", " ", 
        RowBox[{"newPositionDimension", "[", 
         RowBox[{
          RowBox[{"Head", "[", "m", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"MechanismPositions", "[", "m", "]"}], " ", ",", " ", 
            "basis"}], "}"}]}], "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"periodicIdentificationInternal", "[", " ", 
           RowBox[{"posBasis", ",", " ", "labels", ",", " ", 
            RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], " ", 
           "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{
          RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
          "periodicIdentificationInternal"}]}]}], "\n", "\t", "]"}], " ", "/;",
       " ", 
      RowBox[{"periodicIdentificationArgumentsQ", "[", 
       RowBox[{"m", ",", " ", "posBasis", ",", " ", "labels", ",", " ", 
        RowBox[{"OptionValue", "[", "OverlapPrecision", "]"}]}], "]"}]}]}], 
    "\n", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "figure", " ", "out", " ", "what", " ", "dimension", " ", "to", " ", "put",
     " ", "the", " ", "basis", " ", "in"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Linkage", ":", " ", 
    RowBox[{
    "basis", " ", "dimension", " ", "is", " ", "larger", " ", "than", " ", 
     "embedding", " ", "dimension"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"newPositionDimension", "[", " ", 
    RowBox[{"Linkage", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"positions_", " ", ",", " ", 
       RowBox[{"basis_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "}"}]}], 
    " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"PadRight", "[", 
       RowBox[{"positions", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "positions", "]"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"basis", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", " ",
       "basis"}], "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"basis", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ">", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Origami", ":", " ", 
    RowBox[{
    "basis", " ", "dimension", " ", "is", " ", "larger", " ", "than", " ", 
     "embedding", " ", "dimension"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"newPositionDimension", "[", " ", 
    RowBox[{"Origami", ",", " ", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", 
       RowBox[{"basis_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatrixQ", "[", 
           RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "}"}]}], 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"positions", ",", " ", 
      RowBox[{"PadRight", "[", 
       RowBox[{"basis", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "basis", "]"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"positions", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"basis", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "<", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"default", " ", "is", " ", "nothing"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"newPositionDimension", "[", 
    RowBox[{"_", " ", ",", " ", "x_"}], "]"}], " ", ":=", " ", "x"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"periodicIdentificationArgumentsQ", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"{", 
      RowBox[{"positions_", ",", " ", "basis_"}], "}"}], ",", " ", "labels_", 
     " ", ",", "  ", "tolerance_"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"And", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ">=", " ", 
        RowBox[{"Length", "[", "basis", "]"}]}], " ", ",", " ", "True", ",", 
       " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PeriodicIdentification", "::", "numbasis"}], ",", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"positions", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ";", " ", 
        "False"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"basis", ",", "NumericQ"}], "]"}], ",", " ", "True", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeriodicIdentification", "::", "basis2"}], "]"}], ";", " ", 
        "False"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixQ", "[", "basis", "]"}], " ", "&&", " ", 
        RowBox[{
         RowBox[{"Chop", "[", 
          RowBox[{"Det", "[", " ", 
           RowBox[{
            RowBox[{"N", "[", "basis", "]"}], " ", ".", " ", 
            RowBox[{"Transpose", "[", 
             RowBox[{"N", "[", "basis", "]"}], "]"}]}], " ", "]"}], "]"}], 
         " ", "!=", " ", "0"}]}], ",", " ", "True", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeriodicIdentification", "::", "basis3"}], "]"}], ";", " ", 
        "False"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"NumericQ", "[", "tolerance", "]"}], " ", "&&", " ", 
        RowBox[{"tolerance", " ", ">=", " ", "0"}]}], ",", " ", "True", ",", 
       " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PeriodicIdentification", "::", "tol"}], ",", " ", 
          "tolerance"}], "]"}], ";", " ", "False"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"0", " ", "<", " ", 
        RowBox[{"Length", "[", "basis", "]"}], " ", "<=", " ", "3"}], ",", 
       " ", "True", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeriodicIdentification", "::", "basis"}], "]"}], ";", " ", 
        "False"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"basis", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", "True", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PeriodicIdentification", "::", "dim"}], "]"}], ";", " ", 
        "False"}]}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "tol"}], "=", 
   "\"\<OverlapPrecision `1` must be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "basis2"}], "=", 
   "\"\<Basis should be a list of linearly independet, numerical vectors of \
the same dimension.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "basis3"}], "=", 
   "\"\<Basis is not linearly independent to machine precision.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "basis"}], "=", 
   "\"\<There should be between 1 and 3 basis elements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "dim"}], "=", 
   "\"\<Dimension of basis and mechanism are incompatible.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentification", "::", "numbasis"}], " ", "=", " ", 
   "\"\<The number of basis vectors specified cannot exceed `1`.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6734]:=",ExpressionUUID->"c07ab8ce-8f01-4969-88e1-29b80e11879f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"periodicIdentificationInternal", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pos_", " ", ",", " ", "latticeVectors_"}], "}"}], ",", " ", 
     "labels_", "  ", ",", " ", "tol_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", "pi", "\n", "\t", "}"}], ",", "\n", "\t", 
     RowBox[{"PeriodicIdentificationData", "[", "\n", "\t\t", 
      RowBox[{
      "labels", ",", "\n", "\t\t", "latticeVectors", ",", "\n", "\t\t", 
       RowBox[{"pi", " ", "=", " ", 
        RowBox[{"simplifyPeriodicRules", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], ",", " ", 
          RowBox[{"positionDifferences", "[", 
           RowBox[{
           "pos", ",", " ", "labels", ",", " ", "latticeVectors", ",", " ", 
            "tol"}], "]"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "pos", "]"}], "]"}], " ", "//.", " ", 
        RowBox[{"pi", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"simplifyPeriodicRules", "[", " ", 
   RowBox[{"l_", ",", " ", "rules_"}], " ", "]"}], " ", ":=", "  ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"newrules", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", "n_"}], "}"}], " ", ":>",
          " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"n", "+", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], " ", "&"}], " ", "/@",
        " ", "rules"}]}], " ", "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"MapThread", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#1", " ", "->", " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Range", "[", "l", "]"}], ",", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Range", "[", "l", "]"}], ",", "0"}], "}"}], "]"}], " ",
            "//.", " ", "newrules"}]}], "}"}]}], "\n", "\t", "]"}], ",", " ", 
      
      RowBox[{"{", 
       RowBox[{"_", ",", "0"}], "}"}]}], "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6747]:=",ExpressionUUID->"436b0aa6-c06f-46bc-8bd2-56fb6ed94cf0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"listMutualVertexDisplacements", "[", " ", 
    RowBox[{"pos_", " ", ",", " ", "test_"}], "]"}], " ", ":=", "  ", 
   RowBox[{"Select", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Transpose", "[", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Rule", " ", "@@@", " ", 
         RowBox[{"Tuples", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "pos", "]"}], "]"}], ",", "2"}], "]"}]}], 
        ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "&"}], "/@", " ", 
         RowBox[{"Tuples", "[", 
          RowBox[{"pos", ",", "2"}], "]"}]}]}], "}"}], "]"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"test", "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}]}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"positionDifferences", "[", " ", 
    RowBox[{
    "pos_", " ", ",", " ", "labels_", " ", ",", " ", "latticeVectors_", " ", 
     ",", " ", "tol_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"inv", " ", "=", " ", 
        RowBox[{"latticeInverse", "[", "latticeVectors", "]"}]}], ",", "\n", 
       "\t", 
       RowBox[{"integerTestQ", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", ".", "#"}], "&"}], ")"}], "[", " ", 
           RowBox[{"#", "-", 
            RowBox[{"Round", "[", "#", "]"}]}], " ", "]"}], " ", "<=", " ", 
          RowBox[{"tol", "^", "2"}]}], "&"}]}], ",", "\n", "\t", 
       RowBox[{"uniqueMutualVertexDisplacements", " ", "=", " ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{
          RowBox[{"listMutualVertexDisplacements", "[", " ", 
           RowBox[{"pos", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"#", ".", "#"}], " ", ">", " ", 
              RowBox[{"tol", "^", "2"}]}], " ", "&"}]}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", ">", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], "&"}]}], " ", 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"labels", " ", ".", " ", 
          RowBox[{"Round", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}], "&"}], " ", "/@",
       " ", 
      RowBox[{"Select", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"inv", " ", ".", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "}"}], "&"}], " ", "/@",
          " ", "uniqueMutualVertexDisplacements"}], ",", " ", 
        RowBox[{
         RowBox[{"integerTestQ", "[", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}]}], "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"latticeInverse", "[", " ", 
   RowBox[{"basis_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Chop", "[", 
    RowBox[{"Inverse", "[", 
     RowBox[{"Transpose", " ", "@", " ", "basis"}], "]"}], "]"}], " ", "/;", 
   " ", 
   RowBox[{"SameQ", "@@", 
    RowBox[{"Dimensions", "[", "basis", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"latticeInverse", "[", " ", 
   RowBox[{"basis_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"newbasis", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Orthogonalize", "[", " ", 
          RowBox[{"Join", "[", 
           RowBox[{"basis", ",", " ", 
            RowBox[{"IdentityMatrix", "[", 
             RowBox[{"Length", "[", 
              RowBox[{"basis", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], " ", 
          "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"#", ".", "#"}], " ", ">", "0"}], "&"}]}], "]"}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"Chop", "[", 
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", " ", 
         RowBox[{"Transpose", " ", "@", " ", "newbasis"}], "]"}], ",", 
        RowBox[{"Length", "[", "basis", "]"}]}], "]"}], "]"}]}], "\n", "]"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], " ", ">", " ", 
       RowBox[{"#", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ")"}], "[", 
    RowBox[{"Dimensions", "[", "basis", "]"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"latticeInverse", "[", "_", "]"}], ":=", "$Failed"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6749]:=",ExpressionUUID->"a72c2ba9-d5b3-424a-bf83-535333d67dc9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\n", "\t", 
   RowBox[{
   "overlappingVertices", " ", "returns", " ", "a", " ", "list", " ", "of", 
    " ", "which", " ", "vertices", " ", "in", " ", "the", " ", "first", " ", 
    "set", " ", "of", " ", "positions", " ", "can", " ", "be", "\n", "\t", 
    "identified", " ", "in", " ", "the", " ", "second", " ", 
    RowBox[{"set", ".", "\n", "\t", "\n", "\t", 
     RowBox[{"overlappingVertices", "[", 
      RowBox[{
       RowBox[{"positions", " ", "1"}], ",", " ", 
       RowBox[{"positions", " ", "2"}]}], "]"}]}], " ", "returns", " ", "a", 
    " ", "list", " ", "of", " ", "which", " ", "vertices", " ", "listed", " ",
     "in", " ", "1", " ", "can", " ", "be", " ", "found", " ", "in", " ", 
    "2."}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"overlappingVertices", "[", 
    RowBox[{
     RowBox[{"positions1_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"positions2_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "5"}], ")"}]}]}]}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"nearestList", ",", " ", "selectorList"}], " ", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"(*", "\n", "\t", 
       RowBox[{
       "get", " ", "the", " ", "points", " ", "in", " ", "list", " ", "1", 
        " ", "that", " ", "are", " ", "closest", " ", "to", " ", "each", " ", 
        "of", " ", "the", " ", "points", " ", "in", " ", "list", " ", "2"}], 
       "\n", "\t", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"nearestList", " ", "=", " ", 
        RowBox[{
         RowBox[{"Nearest", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{"positions1", " ", "\[Rule]", " ", 
             RowBox[{"Range", "[", " ", 
              RowBox[{"Length", "[", "positions1", "]"}], " ", "]"}]}], "]"}],
            ",", " ", "positions2"}], " ", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", ";", "\n", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "the", " ", "actual", " ", "overlapping", " ", "points", 
         " ", "according", " ", "to", " ", "the", " ", "provided", " ", 
         "tolerance"}], "*)"}], "\n", "\t", 
       RowBox[{"selectorList", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", "#"}], "<", 
            RowBox[{"tol", "^", "2"}]}], "&"}], ")"}], " ", "/@", " ", 
         RowBox[{"(", " ", 
          RowBox[{"positions2", "-", 
           RowBox[{"positions1", "[", 
            RowBox[{"[", " ", "nearestList", " ", "]"}], "]"}]}], " ", 
          ")"}]}]}], " ", ";", "\n", "\n", "\t", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"nearestList", " ", "\[Rule]", " ", 
           RowBox[{"Range", "[", " ", 
            RowBox[{"Length", " ", "@", " ", "positions1"}], "]"}]}], " ", 
          "]"}], ",", " ", "selectorList"}], " ", "]"}]}]}], "\n", "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "positions1", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"Dimensions", "[", "positions2", "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6754]:=",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentificationData[]", "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<Methods\>\"", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"{", 
   RowBox[{
   "\"\<Identification\>\"", ",", "\"\<UniqueVertices\>\"", ",", 
    "\"\<LatticeVectors\>\"", ",", "\"\<labels\>\"", ",", 
    "\"\<IdentificationRules\>\"", ",", "\n", "\"\<EmbeddingDimension\>\"", 
    ",", "\"\<Constraints\>\"", ",", "\"\<VertexPosition\>\"", ",", 
    "\"\<PositionRules\>\"", ",", "\"\<VertexDisplacements\>\"", ",", 
    "\"\<DisplacementRules\>\""}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"PeriodicIdentificationData", ",", "NHoldAll"}], "]"}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6755]:=",ExpressionUUID->"df7f77be-d71a-46ab-b616-6e17020c9b7a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<Identification\>\"", "]"}], " ", ":=",
   " ", 
  RowBox[{"maps", "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
      "uniquevertices_"}], "]"}], "[", "\"\<UniqueVertices\>\"", "]"}], " ", ":=",
    " ", 
   RowBox[{"DeleteDuplicates", "[", "uniquevertices", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<LatticeVectors\>\"", "]"}], " ", ":=",
   " ", "latticeVectors"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
      "uniquevertices_"}], "]"}], "[", 
    RowBox[{"\"\<LatticeVectors\>\"", " ", "->", " ", 
     RowBox[{"basis_", "?", "MatrixQ"}]}], "]"}], " ", ":=", " ", "\n", "\t", 
   
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels", ",", " ", "basis", ",", " ", "maps", ",", " ", 
      "uniquevertices"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "basis", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "latticeVectors", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", 
     "uniquevertices_"}], "]"}], "[", "\"\<labels\>\"", "]"}], " ", ":=", " ",
   "labels"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", 
      "uniquevertices_"}], "]"}], "[", 
    RowBox[{"\"\<labels\>\"", " ", "->", " ", 
     RowBox[{"newLabels_", "?", "VectorQ"}]}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{"newLabels", ",", " ", "latticeVectors", ",", " ", 
      RowBox[{"maps", " ", "/.", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"labels", "->", "newLabels"}], "]"}]}], ",", " ", 
      "uniquevertices"}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "newLabels", "]"}], " ", "==", " ", 
     RowBox[{"Length", "[", "labels", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
      "uniquevertices_"}], "]"}], "[", "\"\<IdentificationRules\>\"", "]"}], 
   " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"starts", " ", "=", " ", 
        RowBox[{"maps", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"ends", " ", "=", " ", 
        RowBox[{"maps", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1", ",", "2"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"unitcells", " ", "=", " ", 
        RowBox[{"maps", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n",
      "\t", 
     RowBox[{"MapThread", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#1", ",", "n_"}], "}"}], " ", ":>", " ", 
          RowBox[{"{", 
           RowBox[{"#2", ",", " ", 
            RowBox[{"n", " ", "+", " ", "#3"}]}], "}"}]}], ")"}], "&"}], " ", 
       ",", " ", 
       RowBox[{"{", 
        RowBox[{"starts", ",", " ", "ends", ",", " ", "unitcells"}], "}"}]}], 
      "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", 
     "uniquevertices_"}], "]"}], "[", "\"\<EmbeddingDimension\>\"", "]"}], 
  " ", ":=", " ", 
  RowBox[{"Length", "[", 
   RowBox[{"latticeVectors", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", 
      "uniquevertices_"}], "]"}], "[", 
    RowBox[{"\"\<EmbeddingDimension\>\"", " ", "->", " ", "newDim_"}], "]"}], 
   " ", ":=", "\n", "\t", 
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{"labels", ",", " ", 
     RowBox[{"PadRight", "[", 
      RowBox[{"latticeVectors", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "latticeVectors", "]"}], ",", " ", "newDim"}],
         "}"}]}], "]"}], " ", ",", " ", "maps", ",", " ", "uniquevertices"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<Constraints\>\"", "]"}], " ", ":=",
   "\n", "\t", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"maps", " ", "/.", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", " ", "->", " ", "latticeVectors"}], " ", "]"}]}]}],
       " ", ",", " ", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"latticeVectors", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
    
    RowBox[{"Flatten", "[", 
     RowBox[{"Thread", " ", "/@", " ", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"VertexPosition", "[", " ", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", " ", 
             RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "==", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "+", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], " ", ")"}], "&"}], " ", "/@",
         " ", "data"}], ")"}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<PositionRules\>\"", "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"maps", " ", "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", " ", "->", " ", "latticeVectors"}], " ", "]"}]}]}],
       " ", ",", " ", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"latticeVectors", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
    
    RowBox[{"Flatten", "[", 
     RowBox[{"Thread", " ", "/@", " ", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"VertexPosition", "[", " ", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", " ", 
             RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "->", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "+", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], " ", ")"}], "&"}], " ", "/@",
         " ", "data"}], ")"}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
      "uniquevertices_"}], "]"}], "[", "\"\<VertexPosition\>\"", "]"}], " ", ":=",
    " ", "\n", "\t", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"maps", " ", "/.", 
         RowBox[{"Thread", "[", 
          RowBox[{"labels", " ", "->", " ", "latticeVectors"}], " ", 
          "]"}]}]}], " ", ",", " ", 
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"latticeVectors", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"VertexPosition", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "uniquevertices", "]"}], "]"}], ",", 
        RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "//.", " ", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Thread", " ", "/@", " ", 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", " ", 
            RowBox[{
             RowBox[{"VertexPosition", "[", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", " ", 
               RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "->", " ", 
             RowBox[{
              RowBox[{"VertexPosition", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "+", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], " ", ")"}], "&"}], " ", "/@",
           " ", "data"}], ")"}]}], "]"}]}]}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<DisplacementRules\>\"", "]"}], " ",
   ":=", " ", "\n", "\t", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"maps", " ", "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", " ", "->", " ", "latticeVectors"}], " ", "]"}]}]}],
       " ", ",", " ", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"latticeVectors", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
    
    RowBox[{"Flatten", "[", 
     RowBox[{"Thread", " ", "/@", " ", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"VertexDisplacement", "[", " ", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", " ", 
             RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "->", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Times", " ", "@@", " ", 
              RowBox[{"(", 
               RowBox[{"labels", "^", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], " ", 
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
               RowBox[{"All", "[", "dim", "]"}]}], "]"}]}], ")"}]}], " ", 
          ")"}], "&"}], " ", "/@", " ", "data"}], ")"}]}], "]"}]}], "\n", 
   "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "[", "\"\<VertexDisplacement\>\"", "]"}], 
  " ", ":=", " ", "\n", "\t", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"maps", " ", "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{"labels", " ", "->", " ", "latticeVectors"}], " ", "]"}]}]}],
       " ", ",", " ", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"latticeVectors", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t", 
    
    RowBox[{
     RowBox[{"VertexDisplacement", "[", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "uniquevertices", "]"}], "]"}], ",", 
       RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "//.", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Thread", " ", "/@", " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"VertexDisplacement", "[", " ", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", " ", 
              RowBox[{"All", "[", "dim", "]"}]}], "]"}], " ", "->", " ", 
            RowBox[{
             RowBox[{"Times", " ", "@@", " ", 
              RowBox[{"(", 
               RowBox[{"labels", "^", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], " ", 
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
               RowBox[{"All", "[", "dim", "]"}]}], "]"}]}]}], " ", ")"}], 
          "&"}], " ", "/@", " ", "data"}], ")"}]}], "]"}]}]}], "\n", "\t", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6757]:=",ExpressionUUID->"683810b0-7a6a-4a03-b496-f14156897a27"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"PeriodicIdentificationData", "[", 
    RowBox[{
    "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
     "uniquevertices_"}], "]"}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"PeriodicIdentificationData", "[", "\n", "\t\t", 
   RowBox[{"Panel", " ", "@", " ", 
    RowBox[{"Column", "[", 
     RowBox[{"{", "\n", "\t\t\t", 
      RowBox[{
       RowBox[{"\"\<V = \>\"", " ", "<>", " ", 
        RowBox[{"ToString", "[", 
         RowBox[{"Length", "[", 
          RowBox[{"DeleteDuplicates", "[", "uniquevertices", "]"}], "]"}], 
         "]"}]}], ",", "\n", "\t\t\t", 
       RowBox[{"Style", "[", " ", 
        RowBox[{"latticeVectors", ",", " ", "Italic"}], " ", "]"}]}], "}"}], 
     "]"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6771]:=",ExpressionUUID->"47555025-a91c-47a2-a30c-77ab1984f094"]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicIdentificationDataQ[]", "Subsection",ExpressionUUID->"9cfdc11c-7ae4-4bc5-9b1d-79dc2c28c20a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
    RowBox[{"PeriodicIdentificationData", "[", 
     RowBox[{
     "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
      "uniquevertices_"}], "]"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"AllTrue", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "labels", "]"}], " ", "==", " ", 
      RowBox[{"Length", "[", "latticeVectors", "]"}]}], ",", "\n", "\t\t", 
     "TrueQ"}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"PeriodicIdentificationData", "[", 
      RowBox[{
      "labels_", ",", " ", "latticeVectors_", ",", " ", "maps_", ",", " ", 
       "uniquevertices_"}], "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"AllTrue", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "uniquevertices", "]"}], " ", "\[Equal]", " ", 
        
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Length", "[", "labels", "]"}], " ", "==", " ", 
        RowBox[{"Length", "[", "latticeVectors", "]"}]}]}], "\n", "\t\t", 
      "}"}], ",", " ", "\n", "\t\t", "TrueQ"}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"PeriodicIdentificationDataQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "_"}], " ", "]"}], " ", ":=",
   " ", "False"}], "\n", 
 RowBox[{
  RowBox[{"PeriodicIdentificationDataQ", "[", " ", "_", " ", "]"}], " ", ":=",
   " ", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6772]:=",ExpressionUUID->"ca2e65ed-8d19-4650-9d7a-afae1df6efcc"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismUnitCell[]", "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"mechanismDeleteDanglingVertices", "[", "m_Origami", "]"}], " ", ":=",
   " ", 
  RowBox[{"mechanismDeleteDanglingVertices", "[", 
   RowBox[{"m", ",", "\"\<faces\>\""}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismDeleteDanglingVertices", "[", "m_Linkage", "]"}], " ", ":=",
    " ", 
   RowBox[{"mechanismDeleteDanglingVertices", "[", 
    RowBox[{"m", ",", "\"\<edges\>\""}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"mechanismDeleteDanglingVertices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"type", ":", " ", 
     RowBox[{"\"\<faces\>\"", "|", "\"\<edges\>\""}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vertexSelector", "=", 
      RowBox[{"Transpose", "[", " ", 
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "]"}], ",", " ", 
         RowBox[{"Length", " ", "/@", " ", 
          RowBox[{"MechanismConnectivity", "[", 
           RowBox[{"m", ",", 
            RowBox[{"\"\<vertices\>\"", "\[Rule]", "type"}]}], "]"}]}]}], 
        "}"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"DeleteVertices", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{
       RowBox[{"Select", "[", 
        RowBox[{"vertexSelector", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "<", "1"}], "&"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6776]:=",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismUnitCell", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"DeleteDanglingVertices", " ", "->", " ", "True"}], "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pi", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"Values", "[", "m", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", 
           "PeriodicIdentificationData"}], "&"}]}], "]"}]}], "}"}], ",", " ", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pi", "]"}], ">", "0"}], ",", " ", 
       RowBox[{"MechanismUnitCell", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"First", "@", "pi"}], ",", " ", "opt"}], " ", "]"}], " ", 
       ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismUnitCell", "::", "notperiodic"}], "]"}], ";", " ", 
        "m"}]}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", "=", 
        RowBox[{"mechanismUnitCellInternal", "[", 
         RowBox[{"m", ",", 
          RowBox[{"PeriodicIdentification", "[", 
           RowBox[{"m", ",", "basis"}], "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "DeleteDanglingVertices", "]"}]}], 
         "]"}]}], "}"}], ",", "\n", "\t\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", 
        "mechanismUnitCellInternal"}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"basis", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", " ", 
      "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismUnitCell", "::", "dim"}], "]"}], ";", " ", 
       "False"}]}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pi_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"mechanismUnitCellInternal", "[", 
        RowBox[{"m", ",", "pi", ",", " ", 
         RowBox[{"OptionValue", "[", "DeleteDanglingVertices", "]"}]}], 
        "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "mechanismUnitCellInternal"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismUnitCellInternal", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"pi_", "?", "PeriodicIdentificationDataQ"}], ",", " ", 
     RowBox[{"vertices_", "?", "BooleanQ"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"facesToDelete", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Rest", "/@", 
           RowBox[{"periodicFaces", "[", 
            RowBox[{"m", ",", "pi"}], "]"}]}], ",", "1"}], "]"}]}], ",", "\n",
        "\t", 
       RowBox[{"edgesToDelete", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Rest", "/@", 
           RowBox[{"periodicEdges", "[", 
            RowBox[{"m", ",", "pi"}], "]"}]}], ",", "1"}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"vertices", ",", " ", 
         RowBox[{"mechanismDeleteDanglingVertices", "[", "#", "]"}], ",", " ",
          "#"}], "]"}], "&"}], " ", "@", " ", 
      RowBox[{"DeleteCells", "[", 
       RowBox[{"m", ",", " ", 
        RowBox[{"MechanismCells", "[", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"Join", "[", " ", 
           RowBox[{
            RowBox[{"_", " ", "/@", " ", "edgesToDelete"}], " ", ",", " ", 
            RowBox[{"_", " ", "/@", " ", "facesToDelete"}]}], "]"}]}], 
         "]"}]}], "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"mechanismUnitCellInternal", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"basis_", "?", "MatrixQ"}], ",", " ", "_"}], "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"MechanismUnitCell", "::", "num"}], "]"}]}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismUnitCellInternal", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "_", " ", ",", " ", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", "#", "]"}], "]"}], "&"}], ")"}]}]}], "]"}], 
   ":=", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"MechanismUnitCell", "::", "dang"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "dim"}], "=", 
   "\"\<Dimension of primitive vectors does not match mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "dang"}], "=", 
   "\"\<Option DeleteDanglingVertices must be a Boolean.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismUnitCell", "::", "notperiodic"}], "=", 
   "\"\<Mechanism has no periodic identification attached.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6779]:=",ExpressionUUID->"19577cd0-d910-4a98-a933-8ad473cbd9de"]
}, Closed]],

Cell[CellGroupData[{

Cell["LabelPeriodicVertices[]", "Subsection",ExpressionUUID->"a2de7482-cba2-4331-aa97-96a42e271549"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LabelPeriodicVertices", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pi_", ",", " ", 
    RowBox[{"inputStyle_", " ", ":", " ", "None"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"map", " ", "=", " ", 
        RowBox[{"pi", "[", "\"\<Identification\>\"", "]"}]}], ",", " ", 
       RowBox[{"style", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"inputStyle", " ", "===", " ", "None"}], ",", " ", 
          RowBox[{"#", "&"}], ",", " ", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{"#", ",", "inputStyle"}], "]"}], "&"}]}], " ", "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"ChangeCellData", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"ChangeCellData", "[", 
         RowBox[{
          RowBox[{"FreeJoint", "[", " ", 
           RowBox[{"map", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", " ", 
          RowBox[{"\"\<Label\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{"style", "/@", " ", 
             RowBox[{"map", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ")"}]}]}], " ", 
         "]"}], " ", "@", " ", "m"}], ",", "\n", "\t\t", 
       RowBox[{"FreeJoint", "[", " ", 
        RowBox[{"map", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}], ",", " ", 
       RowBox[{"\"\<Label\>\"", " ", "\[Rule]", " ", 
        RowBox[{"map", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{"PeriodicIdentificationDataQ", "[", 
    RowBox[{"m", ",", "pi"}], "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6788]:=",ExpressionUUID->"4f17c454-da11-4447-8d57-5317848adaf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LabelPeriodicVertices", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"inputStyle_", " ", ":", " ", "None"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"constraints", " ", "=", " ", 
      RowBox[{"Select", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", 
         RowBox[{
         "\"\<value\>\"", ",", " ", "Mechanisms`rigidity`Constraints"}], 
         "]"}], ",", " ", "PeriodicIdentificationDataQ"}], " ", "]"}]}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "constraints", "]"}], " ", "==", " ", "0"}], 
      ",", " ", "\n", "\t\t", "m", ",", "\n", "\t\t", 
      RowBox[{"LabelPeriodicVertices", "[", 
       RowBox[{"m", ",", " ", 
        RowBox[{"constraints", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "inputStyle"}], 
       "]"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6789]:=",ExpressionUUID->"4c61fa27-a355-4c85-b656-e5b798656492"]
}, Closed]],

Cell[CellGroupData[{

Cell["MakePeriodic[], PeriodicMechanismQ[]", "Subsection",ExpressionUUID->"3883a17c-57fc-40d6-902d-e6807f25c4af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MakePeriodic", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismUnitCell", "]"}], ",", " ", 
      RowBox[{"\"\<Label\>\"", " ", "->", " ", "False"}]}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MakePeriodic", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "basis_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"MakePeriodic", "[", 
     RowBox[{"basis", ",", "opt"}], "]"}], " ", "@", " ", "m"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MakePeriodic", "[", " ", 
    RowBox[{
     RowBox[{"basis_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{
          RowBox[{"N", "[", "#", "]"}], ",", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"unitcell", " ", "=", " ", 
        RowBox[{"MechanismUnitCell", "[", 
         RowBox[{"m", ",", " ", "basis", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "opt", "}"}], ",", 
            RowBox[{"Options", "[", "MechanismUnitCell", "]"}]}], "]"}]}], 
         "]"}]}], ",", " ", "pi"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"pi", " ", "=", " ", 
       RowBox[{"PeriodicIdentification", "[", 
        RowBox[{"unitcell", ",", " ", "basis"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"PeriodicIdentificationDataQ", "[", "pi", "]"}], " ", "&&", 
         " ", 
         RowBox[{"MechanismQ", "[", "unitcell", "]"}]}], ",", " ", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"TrueQ", "[", 
            RowBox[{"OptionValue", "[", "\"\<Label\>\"", "]"}], "]"}], ",", 
           " ", "LabelPeriodicVertices", " ", ",", " ", 
           RowBox[{"#", "&"}]}], "]"}], " ", "@", " ", 
         RowBox[{"AddOption", "[", 
          RowBox[{"unitcell", ",", " ", 
           RowBox[{
           "Mechanisms`rigidity`Constraints", " ", "->", " ", "pi"}]}], 
          "]"}]}], ",", "\n", "\t\t", "m"}], "\n", "\t", "]"}]}]}], "\n", 
    "]"}], " ", "/;", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"basis", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
      RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", " ", 
     "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MechanismUnitCell", "::", "dim"}], "]"}], ";", " ", 
      "False"}]}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6790]:=",ExpressionUUID->"14a7875d-dde7-44db-aa64-3235184f522a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PeriodicMechanismQ", "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"AnyTrue", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"Values", "[", "m", "]"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"Head", "[", "#", "]"}], "===", "PeriodicIdentificationData"}], 
     "&"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6793]:=",ExpressionUUID->"cc41f4a2-69fb-4741-90c7-0bc22433466e"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["geometry computations", "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],

Cell[CellGroupData[{

Cell["argument checking", "Subsection",ExpressionUUID->"3c66cada-6862-4146-826a-810ea5e0da10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"geometryValidEdgesQ", "[", " ", 
   RowBox[{"positions_", " ", ",", " ", 
    RowBox[{"edgeList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", " ", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", " ", 
      RowBox[{"edgeList", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", "2"}], ",",
     "\n", "\t", 
    RowBox[{
     RowBox[{"Max", "[", " ", "edgeList", " ", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Min", "[", " ", "edgeList", " ", "]"}], " ", ">", " ", "0"}]}], 
   "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"geometryValidEdgesQ", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6794]:=",ExpressionUUID->"600de546-4911-4739-9656-3da05acc43d9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"geometryValidTriplesQ", "[", " ", 
   RowBox[{"positions_", " ", ",", " ", 
    RowBox[{"tripleList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", " ", 
      RowBox[{"tripleList", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", "3"}], ",",
     "\n", "\t", 
    RowBox[{
     RowBox[{"Max", "[", " ", "tripleList", " ", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Min", "[", " ", "tripleList", " ", "]"}], " ", ">", " ", 
     "0"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"geometryValidTriplesQ", "[", 
   RowBox[{"_", ",", " ", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6796]:=",ExpressionUUID->"0839c589-f239-4b21-bcb3-717814c3a2aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"geometryValidFacesQ", "[", " ", 
   RowBox[{"positions_", ",", " ", "faces_List"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], " ", "/@", " ", 
       "faces"}], ")"}]}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Min", "[", "faces", "]"}], ">", "0"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Max", "[", "faces", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], ",", "\n", "\t", 
    RowBox[{"AllTrue", "[", " ", 
     RowBox[{
      RowBox[{"Length", "/@", "faces"}], ",", " ", 
      RowBox[{
       RowBox[{"#", ">", "2"}], "&"}]}], " ", "]"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"geometryValidFacesQ", "[", " ", 
   RowBox[{"_", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6798]:=",ExpressionUUID->"c366179f-4a1b-49f2-b836-0fac0ea5e9b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"multiple", " ", "positions"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"numericalListQ", "[", 
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"(", 
      RowBox[{
      "NumericMachinePrecisionCoordinatesQ", " ", "/@", " ", "positions"}], 
      ")"}]}]}], "\n", 
   RowBox[{
    RowBox[{"numericalListQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
    "False"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:03 \
In[6800]:=",ExpressionUUID->"75dc5da3-8ff1-4044-a4e5-e04b8b9ee3b1"]
}, Closed]],

Cell[CellGroupData[{

Cell["Measuring cell functions", "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],

Cell[CellGroupData[{

Cell["DisplacementVector[]", "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementVector", "[", " ", 
   RowBox[{"__", " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementVector", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "edgeList_"}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", "=", 
      RowBox[{"DisplacementVector", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"edgeList", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
    ",", " ", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "DisplacementVector"}]}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", " ", ",",
      " ", "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"DisplacementVector", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"edgeList", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
     ",", " ", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "DisplacementVector"}]}]}], " ", "]"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"single", " ", "positions"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"MachineReal", "[", "]"}], " ", "positions", " ", "use", " ", "a",
     " ", "compiled", " ", "version"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
     ",", " ", "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"displacementVectorCompiled", "[", "]"}], "[", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
      RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", " ", 
     RowBox[{"positions", ",", " ", "edgeList"}], " ", "]"}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{"everything", " ", "else"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementVectorInternal", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "edgeList"}], " ", "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Multiple", " ", "positions", " ", "provided", " ", "that", " ", "are", 
    " ", 
    RowBox[{"MachineReal", "[", "]"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "numericalListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"displacementVectorCompiledMultiple", "[", "]"}], "[", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
      RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n", 
  RowBox[{"(*", 
   RowBox[{"everything", " ", "else"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementVectorInternalMultiple", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "edgeList"}], " ", "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "edgeList_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementVector", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], " ", ",", 
        " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementVector", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementVector", "::", "pos"}], ",", " ", 
          "positions"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
     "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementVector", "::", "edges"}], " ", "=", " ", 
   "\"\<Edges `1` are not a list of integer pairs.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6802]:=",ExpressionUUID->"80357110-8c3f-40bc-a1fe-6602f279ec95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementVectorInternal", "[", 
    RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flippedEdgeList", "=", 
       RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
      RowBox[{"positions", "[", 
       RowBox[{"[", 
        RowBox[{"flippedEdgeList", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementVectorCompiled", "[", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementVectorCompiled", "[", "]"}], "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"positions", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"edgeList", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",",
       "\[IndentingNewLine]", "\t\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"flippedEdgeList", "=", 
          RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", 
        "\t\t\t", 
        RowBox[{
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "\n", "\t\t", 
       "]"}]}], "\[IndentingNewLine]", "\t", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementVectorInternalMultiple", "[", 
    RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"flippedEdgeList", "=", 
       RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", "\t", 
     
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"flippedEdgeList", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "&"}], ",", " ", 
       "positions"}], "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementVectorCompiledMultiple", "[", "]"}], ":=", "\n", "\t", 
  
  RowBox[{
   RowBox[{"displacementVectorCompiledMultiple", "[", "]"}], "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"positions", ",", "_Real", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edgeList", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"flippedEdgeList", "=", 
         RowBox[{"Transpose", "[", "edgeList", "]"}]}], "}"}], ",", "\n", 
       "\t\t\t", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"flippedEdgeList", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"flippedEdgeList", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "&"}], ",", " ",
          "positions"}], "]"}]}], "\n", "\t\t", "]"}]}], 
    "\[IndentingNewLine]", "\t", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6812]:=",ExpressionUUID->"e305c076-8708-4e9f-a152-207c474f6af6"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementLength[]", "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementLength", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLength", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"DisplacementLength", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"edgeList", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "]"}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "DisplacementLength"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ",
      "edgeList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"DisplacementLength", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"edgeList", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], " ", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "DisplacementLength"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
     ",", " ", "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"displacementLengthCompiled", "[", " ", 
      RowBox[{"Length", "[", " ", 
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}], "[", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
      RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthAnalytic", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "edgeList"}], " ", "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Multiple", " ", "positions", " ", "provided", " ", "that", " ", "are", 
    " ", 
    RowBox[{"MachineReal", "[", "]"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "numericalListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"displacementLengthCompiled", "[", " ", 
         RowBox[{"Length", "[", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}], "[", 
        RowBox[{"#", ",", 
         RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], "&"}], " ",
       "/@", " ", 
      RowBox[{"ToPackedArray", "[", "positions", "]"}]}], ")"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n", 
  RowBox[{"(*", 
   RowBox[{"everything", " ", "else"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"displacementLengthAnalytic", "[", " ", 
        RowBox[{"#", " ", ",", " ", "edgeList"}], " ", "]"}], "&"}], " ", "/@",
       " ", "positions"}], ")"}], " ", "/;", " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "edgeList_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLength", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], " ", ",", 
        " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLength", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLength", "::", "pos"}], ",", " ", 
          "positions"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
     "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLength", "::", "edges"}], " ", "=", " ", 
   "\"\<Edges `1` are not a list of integer pairs.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6816]:=",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"displacementLengthCompiled", "[", "d_Integer", "]"}], " ", ":=", 
   " ", 
   RowBox[{
    RowBox[{"displacementLengthCompiled", "[", "d", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"index1", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
              "\t\t\t", 
              RowBox[{"index2", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
             "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
                "^", "2"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], "]"}]}], 
           "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], " ", ":=", " ", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Sqrt", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], " ", "/@", " ", 
     RowBox[{"displacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6826]:=",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],

Cell[CellGroupData[{

Cell["DisplacementLengthSquared[]", "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DisplacementLengthSquared", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"DisplacementLengthSquared", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edgeList_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"DisplacementLengthSquared", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"edgeList", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "]"}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "DisplacementLengthSquared"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ",
      "edgeList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"DisplacementLengthSquared", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"edgeList", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "]"}]}], " ", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "DisplacementLengthSquared"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
     ",", " ", "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"displacementLengthSquaredCompiled", "[", " ", 
      RowBox[{"Length", "[", " ", 
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}], "[", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
      RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"displacementLengthSquaredAnalytic", "[", " ", 
     RowBox[{
      RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", 
      RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", " ", "edgeList"}], "]"}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Multiple", " ", "positions", " ", "provided", " ", "that", " ", "are", 
    " ", 
    RowBox[{"MachineReal", "[", "]"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "numericalListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"displacementLengthSquaredCompiled", "[", " ", 
         RowBox[{"Length", "[", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "]"}], " ", "]"}], 
        "[", 
        RowBox[{"#", ",", 
         RowBox[{"ToPackedArray", "[", "edgeList", "]"}]}], "]"}], "&"}], " ",
       "/@", " ", 
      RowBox[{"ToPackedArray", "[", "positions", "]"}]}], ")"}], " ", "/;", 
    " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n", 
  RowBox[{"(*", 
   RowBox[{"everything", " ", "else"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", ",", " ", 
     "edgeList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"displacementLengthSquaredAnalytic", "[", " ", 
        RowBox[{"#", " ", ",", " ", "edgeList"}], " ", "]"}], "&"}], " ", "/@",
       " ", "positions"}], ")"}], " ", "/;", " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edgeList"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "edgeList_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLengthSquared", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"gometryValidEdgesQ", "[", 
           RowBox[{"positions", ",", "edgeList"}], "]"}], "]"}]}], " ", ",", 
        " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLengthSquared", "::", "edges"}], ",", " ", 
          "edgeList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DisplacementLengthSquared", "::", "pos"}], ",", " ", 
          "positions"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
     "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementLengthSquared", "::", "edges"}], " ", "=", " ", 
   "\"\<Edges `1` are not a list of integer pairs.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6828]:=",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"displacementLengthSquaredCompiled", "[", "d_Integer", "]"}], ":=", 
  
  RowBox[{
   RowBox[{"displacementLengthSquaredCompiled", "[", "d", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"edges", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"index1", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "1"}], "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"index2", "=", 
              RowBox[{"Compile`GetElement", "[", 
               RowBox[{"edges", ",", "i", ",", "2"}], "]"}]}]}], "\n", 
            "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index1", ",", "j"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", "index2", ",", "j"}], "]"}]}], ")"}], 
              "^", "2"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}]}], "\n", 
          "\t\t\t", "]"}], ",", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "edges", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"displacementLengthSquaredAnalytic", "[", 
   RowBox[{"positions_", ",", "edgeList_"}], "]"}], ":=", " ", 
  RowBox[{"expandExpression", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ",", " ", 
     RowBox[{"displacementVectorInternal", "[", 
      RowBox[{"positions", ",", "edgeList"}], "]"}]}], "]"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6838]:=",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],

Cell[CellGroupData[{

Cell["TurningAngle[]", "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TurningAngle", "[", " ", 
   RowBox[{"__", " ", ",", " ", 
    RowBox[{"{", "}"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"TurningAngle", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "tripleList_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"TurningAngle", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"tripleList", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "TurningAngle"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ",
      "tripleList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"TurningAngle", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"tripleList", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "TurningAngle"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TurningAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
    ",", " ", "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"turningAngleCompiled", "[", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", 
     RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], " ", "/;",
    " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{"positions", ",", " ", "tripleList"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TurningAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
    "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"turningAngleAnalytic", "[", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", 
     RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], " ", "/;",
    " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{"positions", ",", " ", "tripleList"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"TurningAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "numericalListQ"}], " ", ",", " ", 
    "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"turningAngleCompiled", "[", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", "]"}], "[", " ", 
       RowBox[{"#", ",", " ", 
        RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], 
      "&"}], " ", "/@", " ", 
     RowBox[{"ToPackedArray", "[", "positions", "]"}]}], ")"}], " ", "/;", 
   " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", " ", "tripleList"}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", ",", " ", 
     "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"turningAngleAnalytic", "[", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", ",", " ", "#", 
        ",", " ", 
        RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], 
      "&"}], " ", "/@", " ", "positions"}], " ", "/;", " ", 
    RowBox[{"geometryValidTriplesQ", "[", " ", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "tripleList"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "tripleList_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidTriplesQ", "[", 
           RowBox[{"positions", ",", "tripleList"}], "]"}], "]"}]}], ",", " ",
         "\n", "\t\t", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TurningAngle", "::", "triples"}], ",", " ", "tripleList"}],
          "]"}]}], "\n", "\t", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidTriplesQ", "[", 
           RowBox[{
            RowBox[{"positions", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "tripleList"}], "]"}], 
          "]"}]}], " ", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TurningAngle", "::", "triples"}], ",", " ", "tripleList"}],
          "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TurningAngle", "::", "pos"}], ",", " ", "positions"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TurningAngle", "::", "triples"}], " ", "=", " ", 
   "\"\<Triples `1` are not a list of integer triplets.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6840]:=",ExpressionUUID->"e8c265b4-1f39-4bba-b61b-2c552af080cf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"turningAngleCompiled", "[", "3", "]"}], ":=", 
   RowBox[{
    RowBox[{"turningAngleCompiled", "[", "3", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",",
       "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "in"}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"p1x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "1"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", 
                  "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
              RowBox[{"p1y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "2"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", 
                  "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
              RowBox[{"p1z", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "3"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", 
                  "3"}], "]"}]}]}], ",", "\n", "\t\t\t", 
              RowBox[{"p2x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", 
                  "1"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
              RowBox[{"p2y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", 
                  "2"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
              RowBox[{"p2z", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", 
                  "3"}], "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", 
                  "3"}], "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{
             RowBox[{"in", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"p1x", " ", "p2x"}], "+", 
                 RowBox[{"p1y", " ", "p2y"}], "+", 
                 RowBox[{"p1z", " ", "p2z"}]}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Sqrt", "[", 
                  RowBox[{
                   RowBox[{"p1x", "^", "2"}], "+", 
                   RowBox[{"p1y", "^", "2"}], "+", 
                   RowBox[{"p1z", "^", "2"}]}], "]"}], " ", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{
                   RowBox[{"p2x", "^", "2"}], "+", 
                   RowBox[{"p2y", "^", "2"}], "+", 
                   RowBox[{"p2z", "^", "2"}]}], "]"}]}], ")"}]}]}], ";", "\n",
              "\t\t\t", 
             RowBox[{"Which", "[", 
              RowBox[{
               RowBox[{"in", ">", "1"}], ",", " ", "0", ",", " ", 
               RowBox[{"in", " ", "<", " ", 
                RowBox[{"-", "1"}]}], " ", ",", " ", "Pi", ",", " ", "True", 
               ",", " ", 
               RowBox[{"ArcCos", "[", "in", "]"}]}], " ", "]"}]}]}], "\n", 
           "\t\t", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], 
       "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"turningAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"turningAngleCompiled", "[", "2", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"p1x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p1y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t\t", 
             RowBox[{"p2y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"p1x", " ", "p2x"}], " ", "+", " ", 
              RowBox[{"p1y", " ", "p2y"}]}], ",", 
             RowBox[{
              RowBox[{"p1x", " ", "p2y"}], " ", "-", " ", 
              RowBox[{"p2x", " ", "p1y"}]}]}], "]"}]}], "\n", "\t\t", "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], "\n",
       "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6850]:=",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "this", " ", "funny", " ", "construction", " ", "here", " ", "works", " ",
      "better", " ", "during", " ", "expansions", " ", "because", " ", "of", 
     " ", "the", " ", "branch", " ", "cuts", " ", "of", " ", 
     RowBox[{"ArcCos", "[", "]"}], "\n", "\n", "The", " ", "problem", " ", 
     "arises", " ", "in", " ", 
     RowBox[{"Series", "[", 
      RowBox[{
       RowBox[{"ArcCos", "[", 
        RowBox[{"1", "-", 
         RowBox[{"xx", "^", "2"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"xx", ",", "0", ",", "2"}], "}"}]}], "]"}], " ", "which", " ",
      "requires", " ", "the", " ", "choice", " ", "of", " ", "a", " ", 
     RowBox[{"branch", ".", " ", "This"}], " ", "last", " ", "part", "\n", 
     RowBox[{"hasn", "'"}], "t", " ", "been", " ", "solved", " ", "but", " ", 
     "at", " ", "least", " ", "the", " ", "answer", " ", "comes", " ", "out", 
     " ", 
     RowBox[{"faster", ".", " ", "The"}], " ", "rest", " ", "of", " ", "the", 
     " ", "branch", " ", "cut", " ", "issues", "\n", "are", " ", "handled", 
     " ", "automatically", " ", "in", " ", 
     RowBox[{"expandExpression", "[", "]"}]}], ",", " ", 
    RowBox[{
    "which", " ", "does", " ", "what", " ", "it", " ", "can", " ", "to", " ", 
     "make", " ", "imaginary", " ", "components", " ", 
     RowBox[{"zero", ".", "\n", "\n", "There"}], " ", "should", " ", "be", 
     " ", "a", " ", "better", " ", "way", " ", "to", " ", "handle", " ", 
     "this", " ", "but", " ", "this", " ", "seems", " ", "to", " ", "work", 
     " ", "in", " ", "most", " ", 
     RowBox[{"cases", "."}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"turningAngleAnalytic", "[", 
     RowBox[{"3", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"cosvectorAngle3D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"x", " ", "xx"}], "+", 
               RowBox[{"y", " ", "yy"}], "+", 
               RowBox[{"z", " ", "zz"}]}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"x", "^", "2"}], "+", 
                 RowBox[{"y", "^", "2"}], "+", 
                 RowBox[{"z", "^", "2"}]}], "]"}], " ", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{"xx", "^", "2"}], "+", 
                 RowBox[{"yy", "^", "2"}], "+", 
                 RowBox[{"zz", "^", "2"}]}], "]"}]}], ")"}]}]}], "\n", "\t\t",
            "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"ArcCos", "[", 
             RowBox[{"expandExpression", "@", 
              RowBox[{"cosvectorAngle3D", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "-", 
                 RowBox[{"pts", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], 
           "]"}]}], ")"}], "&"}], "/@", "tripleList"}]}], "\n", "]"}]}], "\n",
    "\n", 
   RowBox[{
    RowBox[{"turningAngleAnalytic", "[", 
     RowBox[{"2", ",", "data_", ",", "tripleList_"}], "]"}], ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"vectorAngle2D", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"x", " ", "xx"}], " ", "+", " ", 
               RowBox[{"y", " ", "yy"}]}], ",", 
              RowBox[{
               RowBox[{"x", " ", "yy"}], " ", "-", " ", 
               RowBox[{"xx", " ", "y"}]}]}], "]"}]}], "\t", "\n", "\t\t", 
           "]"}]}], "\n", "\t", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"pts", "=", 
              RowBox[{"data", "[", 
               RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"vectorAngle2D", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"pts", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "-", 
               RowBox[{"pts", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "]"}]}], ")"}], 
        "&"}], "/@", "tripleList"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6852]:=",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],

Cell[CellGroupData[{

Cell["NormalVector[]", "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "NormalVector", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<Normalize\>\"", "\[Rule]", "True"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"normalizeQ", "[", " ", "x_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"BooleanQ", "[", "x", "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"NormalVector", "::", "norm"}], "]"}], ";", " ", "False"}]}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NormalVector", "::", "norm"}], "=", 
    "\"\<Option \\\"normalize\\\" must be either True or False.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"faces", " ", ":", " ", 
     RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"NormalVector", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"faces", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}], ",", " ", "opt"}], " ", 
       "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "NormalVector"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ", 
     RowBox[{"faces", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"NormalVector", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"faces", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}], ",", " ", "opt"}], " ",
         "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "NormalVector"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], ",", 
    " ", "faces_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"normalVectorCompiled", "[", " ", 
     RowBox[{
      RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], ",", " ", 
      RowBox[{"Length", "[", 
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}], "[", "\n", 
    "\t\t", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", "\n", "\t\t", 
     RowBox[{"ToPackedArray", "[", 
      RowBox[{"PadRight", "[", 
       RowBox[{"faces", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "faces", "]"}], ",", " ", "3"}], "}"}]}], 
       "]"}], "]"}]}], " ", "\n", "\t", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"geometryValidFacesQ", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "faces"}], "]"}], " ", "&&", " ", 
    RowBox[{"normalizeQ", "[", 
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "faces_", 
    " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"normalVectorAnalytic", "[", " ", 
    RowBox[{
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], ",", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "\n", "\t\t", 
     "positions", ",", "\n", "\t\t", "faces"}], "\n", "\t", "]"}], " ", "/;", 
   " ", 
   RowBox[{
    RowBox[{"geometryValidFacesQ", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "faces"}], "]"}], " ", "&&", " ", 
    RowBox[{"normalizeQ", "[", 
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"NormalVector", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "numericalListQ"}], ",", " ", "faces_", " ", 
    ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"normalVectorCompiled", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], ",", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], " ", "]"}], "[", 
      "\n", "\t\t", 
      RowBox[{"#", ",", " ", "\n", "\t\t", 
       RowBox[{"ToPackedArray", "[", 
        RowBox[{"PadRight", "[", 
         RowBox[{"faces", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "faces", "]"}], ",", " ", "3"}], "}"}]}], 
         "]"}], "]"}]}], " ", "\n", "\t", "]"}], "&"}], " ", "/@", " ", 
    RowBox[{"ToPackedArray", "[", "positions", "]"}]}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"geometryValidFacesQ", "[", " ", 
     RowBox[{"positions", " ", ",", " ", "faces"}], "]"}], " ", "&&", " ", 
    RowBox[{"normalizeQ", "[", 
     RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], ",", " ", "faces_",
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"normalVectorAnalytic", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], ",", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", ",", "\n", 
        "\t\t", "#", ",", " ", "\n", "\t\t", 
        RowBox[{"ToPackedArray", "[", 
         RowBox[{"PadRight", "[", 
          RowBox[{"faces", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "faces", "]"}], ",", " ", "3"}], "}"}]}], 
          "]"}], "]"}]}], " ", "\n", "\t", "]"}], "&"}], " ", "/@", " ", 
     "positions"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"geometryValidFacesQ", "[", " ", 
      RowBox[{"positions", " ", ",", " ", "faces"}], "]"}], " ", "&&", " ", 
     RowBox[{"normalizeQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "faces_", " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", " ", 
          RowBox[{"OptionValue", "[", "\"\<Normalize\>\"", "]"}], " ", "]"}], 
         " ", "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"NormalVector", "::", "normalize"}], "]"}]}], " ", "]"}], 
      ";", " ", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidFacesQ", "[", 
           RowBox[{"positions", ",", "faces"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"NormalVector", "::", "faces"}], ",", " ", "faces"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidFacesQ", "[", 
           RowBox[{"positions", ",", "faces"}], "]"}], "]"}]}], " ", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"NormalVector", "::", "faces"}], ",", " ", "faces"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
          " ", "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"NormalVector", "::", "pos"}], ",", " ", "positions"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "normalize"}], " ", "=", " ", 
   "\"\<Option \\\"Normalize\\\" should be Boolean.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalVector", "::", "faces"}], " ", "=", " ", 
   "\"\<Faces `1` are not a list of faces.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6854]:=",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"normalVectorCompiled", "[", 
   RowBox[{"True", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"True", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "yy"}], " ", "z"}], "+", 
                RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "z"}], "-", 
                RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "xx"}], " ", "y"}], "+", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "y"}], "-", 
                   RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"xx", " ", "z"}], "-", 
                   RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"yy", " ", "z"}], "-", 
                   RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}]}],
             "\n", "\t\t\t", "}"}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"normalVectorCompiled", "[", 
   RowBox[{"False", ",", "3"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"False", ",", "3"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "yy"}], " ", "z"}], "+", 
               RowBox[{"y", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"xx", " ", "z"}], "-", 
               RowBox[{"x", " ", "zz"}]}], ")"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "xx"}], " ", "y"}], "+", 
               RowBox[{"x", " ", "yy"}]}], ")"}]}], "\n", "\t\t\t", "}"}]}], 
          "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"normalVectorCompiled", "[", 
   RowBox[{"True", ",", "2"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"True", ",", "2"}], "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
       RowBox[{"Table", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}]}], ",", "\n", "\t\t\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
           RowBox[{"Sign", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "xx"}], " ", "y"}], "+", 
             RowBox[{"x", " ", "yy"}]}], "]"}]}], "\n", "\t\t\t", "]"}], ",", 
         "\n", "\t\t\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
        "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVectorCompiled", "[", 
    RowBox[{"False", ",", "2"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"normalVectorCompiled", "[", 
     RowBox[{"False", ",", "2"}], "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "xx"}], " ", "y"}], "+", 
             RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "]"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normalVectorAnalytic", "[", 
    RowBox[{"True", " ", 
     RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
     "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
       RowBox[{"NormalVector3D", "=", 
        RowBox[{"Function", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
              ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "/", 
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], 
                "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}], 
         "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "=", 
           RowBox[{"data", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"NormalVector3D", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
       "triples"}]}], "\n", "]"}]}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"normalVectorAnalytic", "[", 
   RowBox[{"False", " ", 
    RowBox[{"(*", " ", "normalized", " ", "*)"}], ",", "3", ",", " ", 
    "positions_", ",", " ", "triples_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"unNormalVector3D", "=", 
       RowBox[{"Function", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], ",",
            "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"-", "yy"}], " ", "z"}], "+", 
              RowBox[{"y", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"xx", " ", "z"}], "-", 
              RowBox[{"x", " ", "zz"}]}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"unNormalVector3D", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "triples"}]}], "\n", "]"}], " "}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6868]:=",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],

Cell[CellGroupData[{

Cell["FaceArea[]", "Subsubsection",ExpressionUUID->"d3174cc3-0acb-46eb-8dda-1333a3ceb442"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FaceArea", "[", 
   RowBox[{"__", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"FaceArea", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "faces_"}], "]"}], " ", ":=",
   " ", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"FaceArea", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"faces", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "NormalVector"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ",
      "faces_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"NormalVector", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"faces", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "NormalVector"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"FaceArea", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], ",", 
    " ", "faces_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Total", "@", 
      RowBox[{
       RowBox[{"faceAreaCompiled", "[", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "]"}], "[", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", "\n", 
        "\t\t", "#"}], " ", "\n", "\t", "]"}]}], "&"}], " ", "/@", " ", 
    RowBox[{"tc", "[", "faces", "]"}]}], " ", "/;", " ", 
   RowBox[{"geometryValidFacesQ", "[", " ", 
    RowBox[{"positions", " ", ",", " ", "faces"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"FaceArea", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], ",", " ", "faces_"}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Total", "@", 
      RowBox[{"faceAreaAnalytic", "[", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", "\n", "\t\t", 
        "positions", ",", "\n", "\t\t", "#"}], "\n", "\t", "]"}]}], "&"}], "/@", 
    RowBox[{"tc", "[", "faces", "]"}]}], " ", "/;", " ", 
   RowBox[{"geometryValidFacesQ", "[", " ", 
    RowBox[{"positions", " ", ",", " ", "faces"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "faces_"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidFacesQ", "[", 
           RowBox[{"positions", ",", "faces"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FaceArea", "::", "faces"}], ",", " ", "faces"}], "]"}]}], 
       " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FaceArea", "::", "pos"}], ",", " ", "positions"}], "]"}]}],
        " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` are not possible vertex positions.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceArea", "::", "faces"}], " ", "=", " ", 
   "\"\<Faces `1` are not a list of valid faces.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6874]:=",ExpressionUUID->"6c498104-1432-4619-9ec2-c6d3f6ab4b18"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"break", " ", "faces", " ", "up", " ", "into", " ", "triangles"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{"tc", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"Face", ",", "_Integer", ",", "1"}], "}"}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v1", "=", 
           RowBox[{"First", "[", "Face", "]"}]}], ",", 
          RowBox[{"rest", "=", 
           RowBox[{"Rest", "[", "Face", "]"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"{", "v1", "}"}], ",", "#"}], "]"}], "&"}], ",", 
          RowBox[{"Partition", "[", 
           RowBox[{"rest", ",", "2", ",", "1"}], "]"}]}], " ", "]"}]}], 
       "\[IndentingNewLine]", "\t", "]"}], ",", "\[IndentingNewLine]", "\t", 
      RowBox[{"RuntimeAttributes", "\[Rule]", 
       RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6882]:=",ExpressionUUID->"c0b93664-439a-4955-be5b-f5ec1c3594b4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"faceAreaCompiled", "[", "3", "]"}], ":=", 
   RowBox[{
    RowBox[{"faceAreaCompiled", "[", "3", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"z", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"zz", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
           "\n", "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"faceAreaCompiled", "[", "2", "]"}], ":=", 
   RowBox[{
    RowBox[{"faceAreaCompiled", "[", "2", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", "\n", "\t\t", 
        RowBox[{"Table", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"y", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"xx", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                 "]"}]}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{"yy", "=", 
               RowBox[{
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                 "]"}], "-", 
                RowBox[{"Compile`GetElement", "[", 
                 RowBox[{"pos", ",", 
                  RowBox[{"Compile`GetElement", "[", 
                   RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                 "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Abs", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "xx"}], " ", "y"}], "+", 
              RowBox[{"x", " ", "yy"}]}], "]"}]}], "\n", "\t\t\t", "]"}], ",",
           "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "\t\t", 
         "]"}]}], "\n", "\t", "]"}], ",", "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"faceAreaAnalytic", "[", 
    RowBox[{"3", ",", " ", "positions_", ",", " ", "triples_"}], "]"}], ":=", 
   "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
       RowBox[{"unNormalVector3D", "=", 
        RowBox[{"Function", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"x", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"y", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"z", "=", 
               RowBox[{"p1", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{"xx", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"yy", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{"zz", "=", 
               RowBox[{"p2", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "yy"}], " ", "z"}], "+", 
                 RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"xx", " ", "z"}], "-", 
                 RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "xx"}], " ", "y"}], "+", 
                 RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
           "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", "=", 
           RowBox[{"data", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"expandExpression", "@", 
          RowBox[{"unNormalVector3D", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"p", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
       "triples"}]}], "\n", "]"}]}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{"faceAreaAnalytic", "[", 
   RowBox[{"2", ",", " ", "positions_", ",", " ", "triples_"}], "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"unNormalVector3D", "=", 
       RowBox[{"Function", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "\t\t\t", "}"}], ",",
            "\n", "\t\t\t", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "xx"}], " ", "y"}], "+", 
               RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "]"}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"p", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"unNormalVector3D", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"p", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "triples"}]}], "\n", "]"}], " "}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6883]:=",ExpressionUUID->"b05096c8-cccb-4a62-8f5e-3eadb3574667"]
}, Closed]],

Cell[CellGroupData[{

Cell["PlaneAngle[]", "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PlaneAngle", "[", " ", 
   RowBox[{"__", " ", ",", " ", 
    RowBox[{"{", "}"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngle", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "tripleList_"}], " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"PlaneAngle", "[", " ", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        RowBox[{"tripleList", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], " ", "]"}]}], "}"}], 
    ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", "PlaneAngle"}]}]}], 
   "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ",
      "tripleList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"PlaneAngle", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"tripleList", " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "]"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", "PlaneAngle"}]}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
    ",", " ", "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"planeAngleCompiled", "[", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", 
     RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], " ", "/;",
    " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{"positions", ",", " ", "tripleList"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
    "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"planeAngleAnalytic", "[", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
     RowBox[{"ToPackedArray", "[", "positions", "]"}], ",", " ", 
     RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], " ", "/;",
    " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{"positions", ",", " ", "tripleList"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"PlaneAngle", "[", " ", 
   RowBox[{
    RowBox[{"positions_", "?", "numericalListQ"}], " ", ",", " ", 
    "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"planeAngleCompiled", "[", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", "]"}], "[", " ", 
       RowBox[{"#", ",", " ", 
        RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], 
      "&"}], " ", "/@", " ", 
     RowBox[{"ToPackedArray", "[", "positions", "]"}]}], ")"}], " ", "/;", 
   " ", 
   RowBox[{"geometryValidTriplesQ", "[", " ", 
    RowBox[{
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], ",", " ", "tripleList"}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", " ", 
    RowBox[{
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], " ", ",", " ", 
     "tripleList_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"planeAngleAnalytic", "[", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", ",", " ", "#", 
        ",", " ", 
        RowBox[{"ToPackedArray", "[", "tripleList", "]"}]}], " ", "]"}], 
      "&"}], " ", "/@", " ", "positions"}], " ", "/;", " ", 
    RowBox[{"geometryValidTriplesQ", "[", " ", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", "tripleList"}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "[", " ", 
    RowBox[{"positions_", " ", ",", " ", "tripleList_"}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidTriplesQ", "[", 
           RowBox[{"positions", ",", "tripleList"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PlaneAngle", "::", "triples"}], ",", " ", "tripleList"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], 
         " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{"geometryValidTriplesQ", "[", 
           RowBox[{"positions", ",", "tripleList"}], "]"}], "]"}]}], " ", ",",
         " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PlaneAngle", "::", "triples"}], ",", " ", "tripleList"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"MechanismQ", "[", "positions", "]"}], "]"}], " ", "&&", 
         " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Not", "[", " ", 
            RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "]"}],
            " ", "||", " ", 
           RowBox[{"Not", "[", " ", 
            RowBox[{
            "VertexCoordinateListQ", "[", " ", "positions", " ", "]"}], " ", 
            "]"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PlaneAngle", "::", "pos"}], ",", " ", "positions"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` provided are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlaneAngle", "::", "triples"}], " ", "=", " ", 
   "\"\<Triples `1` are not a list of integer triplets.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6887]:=",ExpressionUUID->"b2bd5b20-2674-4926-93c2-74dbf8bcfb03"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"planeAngleCompiled", "[", "3", "]"}], ":=", 
  RowBox[{
   RowBox[{"planeAngleCompiled", "[", "3", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
     
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"z", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"zz", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "3"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "3"}],
                 "]"}]}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"planeAngleCompiled", "[", "2", "]"}], ":=", 
  RowBox[{
   RowBox[{"planeAngleCompiled", "[", "2", "]"}], "=", 
   RowBox[{"Compile", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "i", "}"}], ",", "\n", "\t", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"y", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "1"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"xx", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "1"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "1"}],
                 "]"}]}]}], ",", "\n", "\t\t", 
             RowBox[{"yy", "=", 
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "3"}], "]"}], ",", "2"}],
                 "]"}], "-", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"triplets", ",", "i", ",", "2"}], "]"}], ",", "2"}],
                 "]"}]}]}]}], "\n", "\t", "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "\n", "\t", 
        "]"}]}], "\n", "]"}], ",", "\n", "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6897]:=",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"planeAngleAnalytic", "[", 
   RowBox[{"3", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"z", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"zz", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}], "+", 
              RowBox[{"z", " ", "zz"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "y"}], "-", 
                  RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"xx", " ", "z"}], "-", 
                  RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"yy", " ", "z"}], "-", 
                  RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
            "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6899]:=",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"planeAngleAnalytic", "[", 
   RowBox[{"2", ",", "positions_", ",", "tripleList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"data", "=", "positions"}], ",", "\n", "\t", 
      RowBox[{"angleFunc", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", "p2"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"y", "=", 
              RowBox[{"p1", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"xx", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], ",", 
             RowBox[{"yy", "=", 
              RowBox[{"p2", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", " ", "xx"}], "+", 
              RowBox[{"y", " ", "yy"}]}], ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"xx", " ", "y"}], "-", 
                RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}]}], "]"}]}], 
          "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pts", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "#", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"expandExpression", "@", 
         RowBox[{"angleFunc", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"pts", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "-", 
            RowBox[{"pts", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "&"}], "/@",
      "tripleList"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6900]:=",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],

Cell[CellGroupData[{

Cell["TorsionalFoldAngle[]", "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "_", " ", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edges_"}], " ", "]"}], " ",
    ":=", " ", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"TorsionalFoldAngle", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         "edges"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "TorsionalFoldAngle"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldAngle", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
    ",", " ", "edges_"}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}], ",", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", " ", 
       RowBox[{"Length", "[", "edges", "]"}]}], " ", "]"}], " ", ",", "\n", 
     "\t\t", 
     RowBox[{
      RowBox[{"torsionalFoldAngleCompiled", "[", "]"}], "[", " ", 
      RowBox[{"positions", " ", ",", " ", 
       RowBox[{"turnEdgesIntoFaces", "[", " ", 
        RowBox[{"m", " ", ",", " ", "edges"}], "]"}]}], " ", "]"}]}], "\n", 
    "\t", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "positions"}], " ", "]"}], " ", "&&", " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{"positions", ",", "edges"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", " ", ",",
      " ", "edges_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"positions", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "2"}], ",", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", " ", 
        RowBox[{"Length", "[", "edges", "]"}]}], " ", "]"}], " ", ",", "\n", 
      "\t\t", 
      RowBox[{"torsionalFoldAngleAnalytic", "[", " ", 
       RowBox[{"positions", " ", ",", " ", 
        RowBox[{"turnEdgesIntoFaces", "[", " ", 
         RowBox[{"m", " ", ",", " ", "edges"}], "]"}]}], " ", "]"}]}], "\n", 
     "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"VertexCoordinatesQ", "[", " ", 
      RowBox[{"m", " ", ",", " ", "positions"}], " ", "]"}], " ", "&&", " ", 
     RowBox[{"geometryValidEdgesQ", "[", 
      RowBox[{"positions", ",", "edges"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldAngle", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "numericalListQ"}], ",", " ", "edges_"}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"positions", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "==", "2"}], ",", "\n",
      "\t\t", 
     RowBox[{"ConstantArray", "[", " ", 
      RowBox[{"0", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "positions", "]"}], ",", " ", 
         RowBox[{"Length", "[", "edges", "]"}]}], " ", "}"}]}], "]"}], ",", 
     "\n", "\t\t", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"quads", " ", "=", " ", 
         RowBox[{"turnEdgesIntoFaces", "[", " ", 
          RowBox[{"m", ",", " ", "edges"}], "]"}]}], " ", "}"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"torsionalFoldAngleCompiled", "[", "]"}], "[", " ", 
          RowBox[{"#", " ", ",", " ", "quads"}], "]"}], "&"}], " ", "/@", " ",
         "positions"}]}], " ", "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", ",", " ", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], " ", "&&", " ", 
    RowBox[{"geometryValidEdgesQ", "[", 
     RowBox[{
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "edges"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "VertexCoordinateListQ"}], ",", " ", 
     "edges_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "==", "2"}], ",", 
      "\n", "\t\t", 
      RowBox[{"ConstantArray", "[", " ", 
       RowBox[{"0", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "positions", "]"}], ",", " ", 
          RowBox[{"Length", "[", "edges", "]"}]}], " ", "}"}]}], "]"}], ",", 
      "\n", "\t\t", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"quads", " ", "=", " ", 
          RowBox[{"turnEdgesIntoFaces", "[", " ", 
           RowBox[{"m", ",", " ", "edges"}], "]"}]}], " ", "}"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"torsionalFoldAngleAnalytic", "[", "]"}], "[", " ", 
           RowBox[{"#", " ", ",", " ", "quads"}], "]"}], "&"}], " ", "/@", 
         " ", "positions"}]}], " ", "]"}]}], "\n", "\t", "]"}], " ", "/;", 
    " ", 
    RowBox[{
     RowBox[{"VertexCoordinatesQ", "[", " ", 
      RowBox[{"m", ",", " ", 
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], " ", "]"}], " ", "&&", " ", 
     RowBox[{"geometryValidEdgesQ", "[", 
      RowBox[{
       RowBox[{"positions", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "edges"}], "]"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"turnEdgesIntoFaces", "[", " ", 
    RowBox[{"m_", ",", " ", "edges_"}], " ", "]"}], " ", ":=", " ", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"edgeIndices", " ", "=", " ", 
        RowBox[{"MechanismEdges", "[", 
         RowBox[{"m", ",", " ", "edges"}], "]"}]}], " ", ",", " ", 
       RowBox[{"faces", " ", "=", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "->", " ", "\"\<ordered faces\>\""}]}], 
         "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"edgeIndices", ",", "_Missing"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], " ", ">", " ", 
         "0"}], ",", " ", 
        RowBox[{"(*", 
         RowBox[{"some", " ", "edges", " ", 
          RowBox[{"don", "'"}], "t", " ", "exist"}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"TorsionalFoldAngle", "::", "notedge"}], ",", " ", 
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"edgeIndices", ",", "_Missing"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], ";", " ", "\n",
          "\t\t", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"remove", " ", "non"}], "-", 
           RowBox[{"existant", " ", "edges"}]}], "*)"}], "\n", "\t\t", 
         RowBox[{"edgeIndices", " ", "=", " ", 
          RowBox[{"DeleteMissing", "[", "edgeIndices", "]"}]}]}]}], "\n", 
       "\t", "]"}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "edges", " ", "abutting", " ", "one", " ", "face", " ", "are", " ", 
        "on", " ", "the", " ", "boundary"}], "*)"}], "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"AnyTrue", "[", 
         RowBox[{
          RowBox[{"Length", "/@", 
           RowBox[{"faces", "[", 
            RowBox[{"[", "edgeIndices", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#", "==", "1"}], "&"}]}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TorsionalFoldAngle", "::", "boundary"}], ",", " ", 
          RowBox[{
           RowBox[{"MechanismEdges", "[", "m", "]"}], "[", 
           RowBox[{"[", " ", 
            RowBox[{"Pick", "[", " ", 
             RowBox[{"edgeIndices", ",", " ", 
              RowBox[{"Length", "/@", 
               RowBox[{"faces", "[", 
                RowBox[{"[", "edgeIndices", "]"}], "]"}]}], ",", " ", "1"}], 
             "]"}], " ", "]"}], "]"}]}], "]"}]}], "]"}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "edges", " ", "abutting", " ", "more", " ", "than", " ", "2", " ", 
        "faces", " ", "are", " ", "not", " ", "supported"}], "*)"}], "\n", 
      "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"AnyTrue", "[", 
         RowBox[{
          RowBox[{"Length", "/@", 
           RowBox[{"faces", "[", 
            RowBox[{"[", "edgeIndices", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#", ">", "2"}], "&"}]}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TorsionalFoldAngle", "::", "notbin"}], ",", " ", 
          RowBox[{
           RowBox[{"MechanismEdges", "[", "m", "]"}], "[", 
           RowBox[{"[", " ", 
            RowBox[{"Pick", "[", " ", 
             RowBox[{"edgeIndices", ",", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", ">", "2"}], "&"}], ")"}], "/@", 
               RowBox[{"Length", "/@", 
                RowBox[{"faces", "[", 
                 RowBox[{"[", "edgeIndices", "]"}], "]"}]}]}]}], " ", "]"}], 
            " ", "]"}], "]"}]}], "]"}]}], "]"}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "send", " ", "in", " ", "only", " ", "the", " ", "edges", " ", 
        "abutting", " ", "two", " ", 
        RowBox[{"faces", "."}]}], "*)"}], "\n", "\t", 
      RowBox[{"listQuadruples", "[", " ", 
       RowBox[{"faces", "[", 
        RowBox[{"[", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{"edgeIndices", ",", " ", 
           RowBox[{"Length", "/@", 
            RowBox[{"faces", "[", 
             RowBox[{"[", "edgeIndices", "]"}], "]"}]}], ",", " ", "2"}], " ",
           "]"}], " ", "]"}], "]"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", " ", ",",
      " ", "edges_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"VertexCoordinatesQ", "[", "positions", "]"}], " ", "&&", 
         " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"geometryValidEdgesQ", "[", " ", 
           RowBox[{"positions", ",", " ", "edges"}], " ", "]"}], " ", "]"}]}],
         ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"TorsionalFoldAngle", "::", "syn"}], "]"}]}], " ", "]"}], 
      ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"ListQ", "[", "positions", "]"}], " ", "&&", " ", 
         RowBox[{"VertexCoordinatesQ", "[", 
          RowBox[{"positions", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "&&", " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"geometryValidEdgesQ", "[", " ", 
           RowBox[{
            RowBox[{"positions", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", "edges"}], " ", "]"}], 
          " ", "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"TorsionalFoldAngle", "::", "syn"}], "]"}]}], " ", "]"}], 
      ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinatesQ", "[", " ", 
           RowBox[{"m", " ", ",", " ", "positions"}], " ", "]"}], "]"}], " ", 
         "&&", " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinateListQ", "[", "positions", "]"}], "]"}]}], 
        " ", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"TorsionalFoldAngle", "::", "pos"}], ",", " ", 
          "positions"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
     "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "syn"}], " ", "=", " ", 
   "\"\<Edges must be pairs of vertices.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "notedge"}], " ", "=", " ", 
   "\"\<`1` are not valid edges.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "boundary"}], " ", "=", " ", 
   "\"\<Edges `1` are on the boundary.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "notbin"}], " ", "=", " ", 
   "\"\<Edges `1` are not between a unique pair of faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldAngle", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:04 \
In[6901]:=",ExpressionUUID->"d01c233c-d04b-4c31-8a19-cd8a996d4e8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"listQuadruples", "[", "faces_", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"ToPackedArray", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "#", "]"}], "==", "2"}], ",", "\n", "\t\t\t", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"2", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"Last", "@", 
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", "\n", "\t\t\t", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"#", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", "0", ",", "0"}], 
        "}"}]}], "\n", "\t\t", "]"}], "&"}], "/@", "faces"}], "\n", "\t", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6914]:=",ExpressionUUID->"9f8e77b2-2246-466f-bbc8-7d10df6911a0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"torsionalFoldAngleCompiled", "[", "]"}], ":=", 
   RowBox[{
    RowBox[{"torsionalFoldAngleCompiled", "[", "]"}], "=", "\n", 
    RowBox[{"Compile", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Faces", ",", "_Integer", ",", "2"}], "}"}]}], "}"}], ",", 
      "\n", 
      RowBox[{"Table", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Compile`GetElement", "[", 
            RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], "==", "0"}], ",", 
          "\n", "\t", "0", ",", "\n", "\t", 
          RowBox[{"With", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t", 
             RowBox[{
              RowBox[{"p1x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p1z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "1"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p2z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "2"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p3z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "3"}], "]"}], ",", "3"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4x", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "1"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4y", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "2"}], 
                "]"}]}], ",", "\n", "\t\t", 
              RowBox[{"p4z", "=", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"pos", ",", 
                 RowBox[{"Compile`GetElement", "[", 
                  RowBox[{"Faces", ",", "i", ",", "4"}], "]"}], ",", "3"}], 
                "]"}]}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
            RowBox[{"ArcTan", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3y"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3x"}], "-", 
                  RowBox[{"p2x", " ", "p3z"}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
                  RowBox[{"p1x", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
                  RowBox[{"p2z", " ", "p3y"}], "-", 
                  RowBox[{"p2y", " ", "p3z"}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
                  RowBox[{"p1z", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
                  RowBox[{"p1y", " ", 
                   RowBox[{"(", 
                    RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
                  RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], 
               " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
                 RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
                 RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
                 RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
                 RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
                 RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
                 RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
                 RowBox[{"p1z", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2x", " ", "p3y"}], "-", 
                    RowBox[{"p3y", " ", "p4x"}], "+", 
                    RowBox[{"p2y", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
                    RowBox[{"p2x", " ", "p4y"}], "+", 
                    RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
                    RowBox[{"p2y", " ", "p3x"}], "+", 
                    RowBox[{"p1x", " ", "p3y"}], "-", 
                    RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
                 RowBox[{"p1y", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"p2z", " ", "p3x"}], "-", 
                    RowBox[{"p2x", " ", "p3z"}], "-", 
                    RowBox[{"p2z", " ", "p4x"}], "+", 
                    RowBox[{"p3z", " ", "p4x"}], "+", 
                    RowBox[{"p2x", " ", "p4z"}], "-", 
                    RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], 
             "]"}]}], "\n", "\t", "]"}]}], "]"}], ",", "\n", "\t", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "Faces", "]"}]}], "}"}]}], "\n", "]"}], ",", 
      "\n", "\t", 
      RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
     "\n", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"torsionalFoldAngleAnalytic", "[", 
   RowBox[{"positions_", ",", "quadrupleList_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"With", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"p1x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p1z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p2x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p2z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p3x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p3z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"p4x", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "1"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4y", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "2"}], "]"}], "]"}]}], ",", 
        
        RowBox[{"p4z", "=", 
         RowBox[{"positions", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "4", "]"}], "]"}], ",", "3"}], "]"}], "]"}]}]}], 
       "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"expandExpression", "@", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3y"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p3y"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2y"}], " ", "p4x"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p4y"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4y"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2x", "-", "p3x"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3x"}], "-", 
             RowBox[{"p2x", " ", "p3z"}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4x"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2x"}], "+", "p4x"}], ")"}]}], "+", 
             RowBox[{"p1x", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2x", " ", "p4z"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{"p2y", "-", "p3y"}], ")"}]}], "+", 
             RowBox[{"p2z", " ", "p3y"}], "-", 
             RowBox[{"p2y", " ", "p3z"}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2z"}], "+", "p3z"}], ")"}]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "p2z"}], " ", "p4y"}], "+", 
             RowBox[{"p1z", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "p2y"}], "+", "p4y"}], ")"}]}], "+", 
             RowBox[{"p1y", " ", 
              RowBox[{"(", 
               RowBox[{"p2z", "-", "p4z"}], ")"}]}], "+", 
             RowBox[{"p2y", " ", "p4z"}]}], ")"}]}]}], ",", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1x", "-", "p2x"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1y", "-", "p2y"}], ")"}], "^", "2"}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"p1z", "-", "p2z"}], ")"}], "^", "2"}]}], "]"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "p1x"}], " ", "p2z", " ", "p3y"}], "+", 
            RowBox[{"p1x", " ", "p2y", " ", "p3z"}], "+", 
            RowBox[{"p2z", " ", "p3y", " ", "p4x"}], "-", 
            RowBox[{"p2y", " ", "p3z", " ", "p4x"}], "+", 
            RowBox[{"p1x", " ", "p2z", " ", "p4y"}], "-", 
            RowBox[{"p2z", " ", "p3x", " ", "p4y"}], "-", 
            RowBox[{"p1x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p2x", " ", "p3z", " ", "p4y"}], "+", 
            RowBox[{"p1z", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2x", " ", "p3y"}], "-", 
               RowBox[{"p3y", " ", "p4x"}], "+", 
               RowBox[{"p2y", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "p3x"}], "+", "p4x"}], ")"}]}], "-", 
               RowBox[{"p2x", " ", "p4y"}], "+", 
               RowBox[{"p3x", " ", "p4y"}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "p1x"}], " ", "p2y"}], "+", 
               RowBox[{"p2y", " ", "p3x"}], "+", 
               RowBox[{"p1x", " ", "p3y"}], "-", 
               RowBox[{"p2x", " ", "p3y"}]}], ")"}], " ", "p4z"}], "+", 
            RowBox[{"p1y", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p2z", " ", "p3x"}], "-", 
               RowBox[{"p2x", " ", "p3z"}], "-", 
               RowBox[{"p2z", " ", "p4x"}], "+", 
               RowBox[{"p3z", " ", "p4x"}], "+", 
               RowBox[{"p2x", " ", "p4z"}], "-", 
               RowBox[{"p3x", " ", "p4z"}]}], ")"}]}]}], ")"}]}]}], "]"}]}]}],
      "\n", "\t", "]"}], "&"}], "/@", "quadrupleList"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6915]:=",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Closed]],

Cell[CellGroupData[{

Cell["DiscreteGaussianCurvature[]", "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DiscreteGaussianCurvature", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "_", ",", " ", 
     RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "vertexList_"}], " ", "]"}],
    " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", 
       RowBox[{"DiscreteGaussianCurvature", "[", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         "vertexList"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "DiscreteGaussianCurvature"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"DiscreteGaussianCurvature", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "NumericMachinePrecisionCoordinatesQ"}], " ", 
    ",", " ", 
    RowBox[{"vertexList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", " ", 
        RowBox[{"#", ",", " ", "IntegerQ"}], " ", "]"}], "&"}], ")"}]}]}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"discreteGaussianCurvatureCompiled", "[", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"ToPackedArray", "[", "positions", "]"}], " ", ",", " ", 
     RowBox[{
      RowBox[{"getTriplesCompiled", "[", "m", "]"}], "[", 
      RowBox[{"[", "vertexList", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", "vertexList", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
     "3"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"DiscreteGaussianCurvature", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", " ", 
    
    RowBox[{"vertexList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", " ", 
        RowBox[{"#", ",", " ", "IntegerQ"}], " ", "]"}], "&"}], ")"}]}]}], 
   " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"discreteGaussianCurvatureAnalytic", "[", " ", 
    RowBox[{"positions", " ", ",", " ", 
     RowBox[{
      RowBox[{"getTriplesAnalytic", "[", "m", "]"}], "[", 
      RowBox[{"[", "vertexList", "]"}], "]"}]}], " ", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", "vertexList", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
     "3"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"DiscreteGaussianCurvature", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions_", "?", "numericalListQ"}], ",", " ", 
    RowBox[{"vertexList_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", " ", 
        RowBox[{"#", ",", " ", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"triples", " ", "=", " ", 
       RowBox[{
        RowBox[{"getTriplesCompiled", "[", "m", "]"}], "[", 
        RowBox[{"[", "vertexList", "]"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"discreteGaussianCurvatureCompiled", "[", "]"}], "[", " ", 
        RowBox[{"#", " ", ",", " ", "triples"}], " ", "]"}], "&"}], " ", "/@",
       " ", 
      RowBox[{"ToPackedArray", "[", "positions", "]"}]}]}], "\n", "]"}], " ", 
   "/;", " ", 
   RowBox[{
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", ",", " ", "positions"}], "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", "vertexList", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"positions", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
     "3"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"positions_", "?", "numericalListQ"}], ",", " ", 
     RowBox[{"vertexList_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", " ", 
         RowBox[{"#", ",", " ", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], " ", 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"triples", " ", "=", " ", 
       RowBox[{
        RowBox[{"getTriplesAnalytic", "[", "m", "]"}], "[", 
        RowBox[{"[", "vertexList", "]"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"discreteGaussianCurvatureAnalytic", "[", " ", 
         RowBox[{"#", " ", ",", " ", "triples"}], " ", "]"}], "&"}], " ", "/@",
        " ", "positions"}], "/;", " ", 
      RowBox[{
       RowBox[{"VertexCoordinatesQ", "[", " ", 
        RowBox[{"m", ",", " ", "positions"}], "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Min", "[", "vertexList", "]"}], " ", ">", " ", "0"}], " ", "&&",
        " ", 
       RowBox[{
        RowBox[{"Max", "[", "vertexList", "]"}], " ", "<=", " ", 
        RowBox[{"Length", "[", "positions", "]"}]}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"positions", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "3"}]}]}]}], 
    "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_", ",", " ",
      "vertexList_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinatesQ", "[", " ", 
           RowBox[{"m", ",", " ", "positions"}], " ", "]"}], " ", "]"}], " ", 
         "||", " ", 
         RowBox[{"Not", "[", " ", 
          RowBox[{"VertexCoordinateListQ", "[", " ", 
           RowBox[{"m", ",", " ", "positions"}], " ", "]"}], " ", "]"}]}], 
        ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DiscreteGaussianCurvature", "::", "pos"}], ",", " ", 
          "positions"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"VectorQ", "[", " ", 
           RowBox[{"vertexList", ",", " ", "IntegerQ"}], " ", "]"}], "]"}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"Min", "[", "vertexList", "]"}], " ", "<=", " ", "0"}]}], 
        " ", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"DiscreteGaussianCurvature", "::", "vert"}], ",", " ", 
          "vertexList"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
     "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteGaussianCurvature", "::", "vert"}], " ", "=", " ", 
   "\"\<Vertices `1` are not all valid.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6917]:=",ExpressionUUID->"fbfdb925-2895-4648-a144-dda7cfcadcc1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getTriplesAnalytic", "[", "m_", "]"}], " ", ":=", "  ", 
  RowBox[{"ToPackedArray", "[", 
   RowBox[{
    RowBox[{"MechanismConnectivity", "[", " ", 
     RowBox[{"m", ",", " ", 
      RowBox[{"\"\<vertices\>\"", " ", "->", "\"\<ordered faces\>\""}]}], 
     "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "All", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "1"}], ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"getTriplesCompiled", "[", "m_", "]"}], " ", ":=", "  ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"ToPackedArray", "[", 
    RowBox[{
     RowBox[{"MechanismConnectivity", "[", " ", 
      RowBox[{"m", ",", " ", 
       RowBox[{"\"\<vertices\>\"", " ", "->", "\"\<ordered faces\>\""}]}], 
      "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"All", ",", "All", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "]"}], "]"}], "]"}], "]"}]}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:04 \
In[6927]:=",ExpressionUUID->"405a90fe-1848-4bbb-8388-a6f741bca8a6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"discreteGaussianCurvatureCompiled", "[", "]"}], ":=", 
  RowBox[{
   RowBox[{"discreteGaussianCurvatureCompiled", "[", "]"}], "=", "\n", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pos", ",", "_Real", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"triplets", ",", "_Integer", ",", "3"}], "}"}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", " ", "Pi"}], "-", 
          RowBox[{"Sum", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}], "==",
                "0"}], ",", "\n", "\t\t\t", "0", ",", "\n", "\t\t\t", 
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"x", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"y", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"z", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "3"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"xx", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "1"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "1"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"yy", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "2"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "2"}], "]"}]}]}], ",", "\n", "\t\t\t", 
                  RowBox[{"zz", "=", 
                   RowBox[{
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "2"}], "]"}],
                     ",", "3"}], "]"}], "-", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"pos", ",", 
                    RowBox[{"Compile`GetElement", "[", 
                    RowBox[{"triplets", ",", "j", ",", "i", ",", "1"}], "]"}],
                     ",", "3"}], "]"}]}]}]}], "\n", "\t\t\t", "}"}], ",", 
                "\n", "\t\t\t", 
                RowBox[{"ArcTan", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"x", " ", "xx"}], "+", 
                   RowBox[{"y", " ", "yy"}], "+", 
                   RowBox[{"z", " ", "zz"}]}], ",", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "y"}], "-", 
                    RowBox[{"x", " ", "yy"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"xx", " ", "z"}], "-", 
                    RowBox[{"x", " ", "zz"}]}], ")"}], "^", "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"yy", " ", "z"}], "-", 
                    RowBox[{"y", " ", "zz"}]}], ")"}], "^", "2"}]}], "]"}]}], 
                 "]"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "]"}], ",", 
            "\n", "\t\t", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"Compile`GetElement", "[", 
                RowBox[{"triplets", ",", "j"}], "]"}], "]"}]}], "}"}]}], 
           RowBox[{"(*", " ", "Sum", " ", "*)"}], "\n", "\t", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "triplets", "]"}]}], "}"}]}], "]"}]}], " ", 
      
      RowBox[{"(*", " ", "Table", " ", "*)"}], "\n", "\t", "]"}], ",", "\n", 
     "\t", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", "\n", "\t", 
     RowBox[{"CompilationTarget", "->", "$MechanismCompilationTarget"}]}], 
    "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6929]:=",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"discreteGaussianCurvatureAnalytic", "[", " ", 
   RowBox[{"pos_", ",", " ", "triples_"}], "]"}], ":=", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"expandExpression", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"2", " ", "Pi"}], "-", 
        RowBox[{"Total", "[", 
         RowBox[{"PlaneAngle", "[", 
          RowBox[{"pos", ",", "#"}], "]"}], "]"}]}], ")"}]}], ")"}], "&"}], 
   " ", "/@", " ", "triples"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6930]:=",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global geometry functions", "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],

Cell[CellGroupData[{

Cell["FindGeometricTransform[], AlignMechanism[]", "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_Origami", ",", " ", "r___"}], " ", "]"}], " ",
   "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FindGeometricTransform", "[", 
    RowBox[{"m1_Origami", ",", " ", "m2_Origami", ",", " ", "r___"}], "]"}], 
   " ", "^:=", " ", 
   RowBox[{"FindGeometricTransform", "[", " ", 
    RowBox[{
     RowBox[{"m1", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
     RowBox[{"m2", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"pts_", ",", " ", "m_Linkage", ",", " ", "r___"}], " ", "]"}], " ",
   "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{"pts", ",", " ", 
    RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"m1_Linkage", ",", " ", "m2_Linkage", ",", " ", "r___"}], "]"}], 
  " ", "^:=", " ", 
  RowBox[{"FindGeometricTransform", "[", " ", 
   RowBox[{
    RowBox[{"m1", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
    RowBox[{"m2", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6931]:=",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "AlignMechanism", "]"}], "=", 
    RowBox[{"Options", "[", "FindGeometricTransform", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"AlignMechanism", "[", " ", 
   RowBox[{"from_", ",", " ", "to_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"fromPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "from", " ", "]"}]}], ",", " ", 
      RowBox[{"toPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "to", " ", "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"transform", " ", "=", " ", 
         RowBox[{"alignTransform", "[", " ", 
          RowBox[{"fromPos", ",", " ", "toPos", ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"transform", "[", " ", 
         RowBox[{"toPos", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "/;", " ", 
        RowBox[{"transform", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
      RowBox[{"toPos", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6935]:=",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"convert", " ", "the", " ", "arguments", " ", "appropriately"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"m1_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"m1", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
      "All"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"m1_", "?", "MechanismQ"}], " ", ",", " ", 
       RowBox[{"v", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m1", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "v"}],
       "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Max", "[", "v", "]"}], " ", "\[LessEqual]", " ", 
       RowBox[{"m1", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "v", "]"}], ">", "0"}]}]}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m1_", "?", "MechanismQ"}], ",", " ", "v_"}], " ", "}"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"AlignMechanism", "::", "oob"}], ",", " ", "v"}], "]"}], ";", 
      " ", "$Failed"}], " ", ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"pos_", "?", "NumericCoordinatesQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"pos", ",", "All"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pos_", "?", "NumericCoordinatesQ"}], ",", " ", 
       RowBox[{"v", " ", ":", " ", 
        RowBox[{"{", "__Integer", "}"}]}]}], " ", "}"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pos", ",", "v"}], "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Max", "[", "v", "]"}], " ", "\[LessEqual]", " ", 
       RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Min", "[", "v", "]"}], " ", ">", " ", "0"}]}]}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"pos_", "?", "NumericCoordinatesQ"}], ",", " ", "v_"}], " ", 
      "}"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"AlignMechanism", "::", "oob"}], ",", "v"}], "]"}], ";", " ", 
      "$Failed"}], " ", ")"}]}], "\n", 
   RowBox[{
    RowBox[{"convertToAlign", "[", " ", 
     RowBox[{"{", 
      RowBox[{"pos_", ",", " ", "v_"}], "}"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"AlignMechanism", "::", "num"}], "]"}], ";", " ", "$Failed"}], 
     ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "oob"}], " ", "=", " ", 
     "\"\<Specified vertices `1` are out of bounds of Mechanism.\>\""}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "num"}], " ", "=", " ", 
     "\"\<Vertex positions must be numerical.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:04 \
In[6937]:=",ExpressionUUID->"fc7c8ee8-7208-4bfb-b0d2-9a8e8f5faa83"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "find", " ", "the", " ", "geometric", " ", "transform", " ", "we", " ", 
    "need"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"alignTransform", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positionsFrom_", ",", "vFrom_"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"positionsTo_", ",", "vTo_"}], "}"}], ",", " ", "options_"}], 
     " ", "]"}], " ", ":=", " ", "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{"transformation", " ", "=", " ", 
         RowBox[{"FindGeometricTransform", "[", 
          RowBox[{
           RowBox[{"positionsFrom", "[", 
            RowBox[{"[", "vFrom", "]"}], "]"}], ",", " ", 
           RowBox[{"positionsTo", "[", 
            RowBox[{"[", "vTo", "]"}], "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"options", ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}],
                 ",", " ", 
                RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], 
               " ", "}"}]}], "}"}], "]"}]}], " ", "]"}]}], "\n", "}"}], ",", 
       "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "transformation", "]"}], " ", "===", " ", 
          "FindGeometricTransform"}], ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"AlignMechanism", "::", "gt"}], "]"}], ";", " ", 
          "$Failed"}], ",", " ", 
         RowBox[{"transformation", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}]}], "\n", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "positionsFrom", "]"}], " ", "\[Equal]", " ", 
      RowBox[{"Dimensions", "[", "positionsTo", "]"}]}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"alignTransform", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positionsFrom_", ",", "vFrom_"}], "}"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"positionsTo_", ",", "vTo_"}], "}"}], ",", " ", "options_"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"AlignMechanism", "::", "match"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "gt"}], " ", "=", " ", 
     "\"\<Failed to find geometric transform.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"AlignMechanism", "::", "match"}], " ", "=", " ", 
     "\"\<Vertices are not of the same dimension and number.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6946]:=",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"]
}, Closed]],

Cell[CellGroupData[{

Cell["CongruentMechanismQ[]", "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CongruentMechanismQ", "[", 
    RowBox[{"tolerance_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
        RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], "]"}], "[", " ", 
   RowBox[{"from_", ",", " ", "to_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", "from", " ", "]"}]}], ",", " ", 
      RowBox[{"toPos", " ", "=", " ", 
       RowBox[{"convertToAlign", "[", " ", "to", " ", "]"}]}]}], " ", "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"transform", " ", "=", " ", 
         RowBox[{"alignTransform", "[", " ", 
          RowBox[{"fromPos", ",", " ", "toPos", ",", " ", 
           RowBox[{"{", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
       
       RowBox[{
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"difference", " ", "=", " ", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"transform", "[", " ", 
               RowBox[{"toPos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "-", " ", 
              RowBox[{"fromPos", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], " ", "}"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"difference", " ", ".", " ", "difference"}], " ", "<", " ",
            "tolerance"}]}], "\n", "\t\t", "]"}], " ", "/;", " ", 
        RowBox[{"transform", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"fromPos", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
      RowBox[{"toPos", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6950]:=",ExpressionUUID->"a8f653e6-0073-4e26-88b3-b7e9ea5fa4e3"]
}, Closed]],

Cell[CellGroupData[{

Cell["BoundingRegion[]", "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"BoundingRegion", "[", 
   RowBox[{"o_Linkage", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"BoundingRegion", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", "r"}], 
   " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6951]:=",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionNearest[]", "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionNearest", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", 
   " ", 
   RowBox[{"RegionNearest", "[", " ", 
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionNearest", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionNearest", "[", " ", 
   RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6953]:=",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionMember[]", "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RegionMember", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", " ", 
   RowBox[{"RegionMember", "[", " ", 
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "pt_"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "pt"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMember", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", " ", 
  
  RowBox[{"RegionMember", "[", " ", 
   RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6957]:=",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionBounds[]", "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "type___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionBounds", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "type"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6961]:=",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomPoint[]", "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "reg___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RandomPoint", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "reg"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6963]:=",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionCentroid[]", "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_Linkage", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionCentroid", "[", " ", "f_Origami", " ", "]"}], " ", "^:=", 
  " ", 
  RowBox[{"RegionCentroid", "[", " ", 
   RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6965]:=",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],

Cell[CellGroupData[{

Cell["RegionDistance[], SignedRegionDistance[]", "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"RegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6967]:=",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_Linkage", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{"f_Origami", ",", " ", "p___"}], " ", "]"}], " ", "^:=", " ", 
  RowBox[{"SignedRegionDistance", "[", " ", 
   RowBox[{
    RowBox[{"f", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "p"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6969]:=",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]],

Cell[CellGroupData[{

Cell["tierEdges[] - experimental", "Subsubsection",ExpressionUUID->"629e0869-a792-448b-b759-8452461b16c9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"tierEdges", "::", "usage"}], "=", 
    "\"\<tierEdges[m] partitions the edges of a 2D Mechanism into tiers so \
that no two edges sharing a vertex are on the same tier.\>\""}], ";"}], 
  "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6971]:=",ExpressionUUID->"77d06f1b-f7ab-4500-a658-4079097e7227"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"selectEdgeTiers", "[", " ", 
    RowBox[{"{", 
     RowBox[{"edgeList_", ",", " ", "other_"}], "}"}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"pass", " ", "=", 
       RowBox[{"Sort", "/@", 
        RowBox[{"(", 
         RowBox[{"List", "@@@", 
          RowBox[{"FindIndependentEdgeSet", "[", 
           RowBox[{"UndirectedEdge", "@@@", "edgeList"}], "]"}]}], ")"}]}]}], 
      "\n", "}"}], ",", "\[IndentingNewLine]", "\t", 
     RowBox[{"{", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{"Sort", " ", "/@", " ", "edgeList"}], ",", " ", 
         RowBox[{"Alternatives", "@@", "pass"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "pass", "}"}], ",", "other"}], "]"}]}], 
      "\[IndentingNewLine]", "\t", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"MechanismEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Reverse", "[", 
       RowBox[{
        RowBox[{"NestWhile", "[", 
         RowBox[{"selectEdgeTiers", ",", 
          RowBox[{"{", 
           RowBox[{"edges", ",", 
            RowBox[{"{", "}"}]}], "}"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"First", "[", "#", "]"}], "]"}], ">", "0"}], "&"}]}], 
         "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    
    RowBox[{
     RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
     "2"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"tierEdges", "::", "embdim"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tierEdges", "::", "embdim"}], "=", 
   "\"\<Mechanism embedding dimension must be 2.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6972]:=",ExpressionUUID->"63542191-1f62-4e2b-9a55-5238b3bb62ea"]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Other computations", "Section",ExpressionUUID->"70cb6267-297f-49ae-8390-84069dce1312"],

Cell[CellGroupData[{

Cell["ZeroLengthEdgeQ[]", "Subsection",ExpressionUUID->"af54ddfa-5e79-4f77-9528-e963cd27f19c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ZeroLengthEdgeQ", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", " ", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "16"}], ")"}]}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"zeroLengthEdgeQinternal", "[", 
    RowBox[{"m", ",", " ", "pos", ",", " ", "precision"}], "]"}], " ", "/;", 
   " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ZeroLengthEdgeQ", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "16"}], ")"}]}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"zeroLengthEdgeQinternal", "[", 
    RowBox[{"m", ",", " ", 
     RowBox[{"MechanismPositions", "[", "m", "]"}], ",", " ", "precision"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"zeroLengthEdgeQinternal", "[", " ", 
   RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", "precision_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"lengths", " ", "=", " ", 
      RowBox[{"DisplacementLengthSquared", "[", 
       RowBox[{"positions", ",", " ", 
        RowBox[{"MechanismEdges", "[", "m", "]"}]}], " ", "]"}]}], " ", "}"}],
     ",", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"lengths", ",", " ", "NumericQ"}], "]"}], " ", ",", " ", "\n", 
      "\t\t", 
      RowBox[{"AnyTrue", "[", " ", 
       RowBox[{"lengths", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", "#", "]"}], " ", "<=", " ", "precision"}], 
         "&"}]}], " ", "]"}], ",", "\n", "\t\t", 
      RowBox[{"AnyTrue", "[", " ", 
       RowBox[{
        RowBox[{"Simplify", "[", " ", "lengths", " ", "]"}], ",", " ", 
        RowBox[{
         RowBox[{"#", "===", "0"}], " ", "&"}]}], " ", "]"}]}], "\n", "\t", 
     "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6976]:=",ExpressionUUID->"872c887b-ebb1-4f0f-9e59-c680e94e32e2"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCellTest[]", "Subsection",ExpressionUUID->"eb28c2ea-925e-4fd4-8037-bec773c38b21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellTest", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "rest__"}], "]"}], " ", ":=",
    " ", 
   RowBox[{
    RowBox[{"MechanismCellTest", "[", "rest", "]"}], "[", "m", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellTest", "[", 
     RowBox[{
     "cells_List", ",", " ", "geometricComputation_", " ", ",", " ", 
      "test_"}], "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"result", " ", "=", " ", 
       RowBox[{"geometricComputation", "[", 
        RowBox[{"m", ",", " ", "cells"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"ListQ", "[", "result", "]"}], ",", " ", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{"cells", " ", ",", " ", 
         RowBox[{"TrueQ", " ", "/@", " ", 
          RowBox[{"test", " ", "/@", " ", "result"}]}]}], " ", "]"}], ",", 
       " ", 
       RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellTest", "[", " ", 
    RowBox[{
     RowBox[{"cellSelector", " ", ":", " ", 
      RowBox[{"Except", "[", "_List", "]"}]}], " ", ",", " ", 
     "geometricComputation_", " ", ",", " ", "test_"}], "]"}], "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"cells", " ", "=", " ", 
      RowBox[{"cellSelector", "[", "m", "]"}]}], " ", "}"}], ",", "\n", "\t", 
    
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"result", " ", "=", " ", 
        RowBox[{"geometricComputation", "[", 
         RowBox[{"m", ",", " ", "cells"}], "]"}]}], "}"}], ",", "\n", "\t\t", 
      
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"ListQ", "[", "result", "]"}], ",", " ", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{"cells", " ", ",", " ", 
          RowBox[{"TrueQ", " ", "/@", " ", 
           RowBox[{"test", " ", "/@", " ", "result"}]}]}], " ", "]"}], ",", 
        " ", 
        RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6979]:=",ExpressionUUID->"008b0748-f442-46ea-8f18-68502af166e9"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Geometric expression parser", "Section",ExpressionUUID->"031833b0-36bf-4aa3-bd22-f4302ed56c53"],

Cell[CellGroupData[{

Cell["MechanismGeometricExpression[]", "Subsection",ExpressionUUID->"073fe901-13b8-4b85-a9a4-b39c522c9bb3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"this", " ", "is", " ", "a", " ", "private", " ", "function"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$parsableExpressions", " ", "=", " ", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "these", " ", "evaluate", " ", "to", " ", "arbitrary", " ", 
        "positions", " ", "or", " ", "whatever", " ", "positions", " ", 
        "provided"}], "*)"}], "\n", "\t", 
      RowBox[{
      "_FaceArea", ",", " ", "\n", "\t", "_DisplacementVector", ",", " ", 
       "\n", "\t", "_DisplacementLength", " ", ",", " ", "\n", "\t", 
       "_DisplacementLengthSquared", ",", " ", "\n", "\t", 
       "_TorsionalFoldAngle", ",", " ", "\n", "\t", "_PlaneAngle", ",", " ", 
       "\n", "\t", "_TurningAngle", ",", " ", "\n", "\t", "_NormalVector", 
       ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "these", " ", "evaluate", " ", "to", " ", "the", " ", "positions", 
         " ", "associated", " ", "with", " ", "the", " ", "mechanism"}], 
        "*)"}], "\n", "\t", 
       RowBox[{
        RowBox[{"FaceArea", "[", "0", "]"}], "[", "_", "]"}], ",", " ", "\n", 
       "\t", 
       RowBox[{
        RowBox[{"DisplacementVector", "[", "0", "]"}], "[", "_", "]"}], ",", 
       " ", "\n", "\t", 
       RowBox[{
        RowBox[{"DisplacementLength", "[", "0", "]"}], "[", "_", "]"}], " ", 
       ",", " ", "\n", "\t", 
       RowBox[{
        RowBox[{"DisplacementLengthSquared", "[", "0", "]"}], "[", "_", "]"}],
        ",", " ", "\n", "\t", 
       RowBox[{
        RowBox[{"TorsionalFoldAngle", "[", "0", "]"}], "[", "_", "]"}], ",", 
       " ", "\n", "\t", 
       RowBox[{
        RowBox[{"PlaneAngle", "[", "0", "]"}], "[", "_", "]"}], ",", " ", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"TurningAngle", "[", "0", "]"}], "[", "_", "]"}], ",", " ", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"NormalVector", "[", "0", "]"}], "[", "_", "]"}]}], "\n", 
      "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"extractParsableExpressions", "[", " ", "expr_List", " ", "]"}], 
    " ", ":=", "  ", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], " ", "/@", 
     " ", 
     RowBox[{"GatherBy", "[", " ", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", " ", 
        RowBox[{"Cases", "[", " ", 
         RowBox[{"expr", ",", " ", 
          RowBox[{"Alternatives", "@@", "$parsableExpressions"}], " ", ",", 
          " ", "Infinity"}], "]"}], "]"}], ",", " ", "Head"}], " ", "]"}]}]}],
    "\n", 
   RowBox[{
    RowBox[{"extractParsableExpressions", "[", " ", "expr_", " ", "]"}], " ", 
    ":=", "  ", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
       RowBox[{"#", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "&"}], " ", "/@", 
     " ", 
     RowBox[{"GatherBy", "[", " ", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", " ", 
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"{", "expr", "}"}], ",", " ", 
          RowBox[{"Alternatives", "@@", "$parsableExpressions"}], " ", ",", 
          " ", "Infinity"}], "]"}], "]"}], ",", " ", "Head"}], " ", "]"}]}]}],
    "\n", "\n", 
   RowBox[{
    RowBox[{"computeGeometricQuantities", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", " ", ",", 
      " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"head", " ", ":", " ", 
         RowBox[{"TorsionalFoldAngle", "|", "DiscreteGaussianCurvature"}]}], 
        ")"}], "[", "indices_", "]"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"head", "/@", "indices"}], ")"}], " ", "->", " ", 
      RowBox[{"head", "[", 
       RowBox[{"m", ",", " ", "arbitraryPositions", ",", " ", "indices"}], 
       "]"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"computeGeometricQuantities", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", " ", ",", 
      " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"head", " ", ":", " ", 
          RowBox[{"TorsionalFoldAngle", "|", "DiscreteGaussianCurvature"}]}], 
         ")"}], "[", "0", "]"}], "[", "indices_", "]"}]}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"head", "[", "0", "]"}], "/@", "indices"}], ")"}], " ", "->", 
      " ", 
      RowBox[{"head", "[", 
       RowBox[{"m", ",", " ", "positions", ",", " ", "indices"}], "]"}]}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"computeGeometricQuantities", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"head_", "[", "indices_", "]"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"head", "/@", "indices"}], ")"}], " ", "->", " ", 
      RowBox[{"head", "[", 
       RowBox[{"arbitraryPositions", ",", " ", "indices"}], "]"}]}], "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"computeGeometricQuantities", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{
       RowBox[{"head_", "[", "0", "]"}], "[", "indices_", "]"}]}], " ", "]"}],
     " ", ":=", " ", 
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"head", "[", "0", "]"}], "/@", "indices"}], ")"}], " ", "->", 
      " ", 
      RowBox[{"head", "[", 
       RowBox[{"positions", ",", " ", "indices"}], "]"}]}], "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"MechanismGeometricExpression", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "expression_"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"parsableExpressions", " ", "=", " ", 
         RowBox[{"extractParsableExpressions", "[", "expression", "]"}]}], 
        ",", "\n", "\t", 
        RowBox[{"arbitraryPositions", " ", "=", " ", 
         RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"positionRules", " ", "=", " ", 
         RowBox[{"Dispatch", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
              RowBox[{"VertexPosition", " ", "->", " ", 
               RowBox[{"VertexPosition", "[", "0", "]"}]}]}], "]"}], " ", "->",
             " ", 
            RowBox[{"Flatten", "[", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}], 
           "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"expression", " ", "/.", " ", 
        RowBox[{"Dispatch", "@", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"computeGeometricQuantities", "[", " ", 
             RowBox[{
             "m", ",", " ", "positions", " ", ",", " ", "arbitraryPositions", 
              ",", " ", "#"}], "]"}], " ", "&"}], " ", "/@", " ", 
           "parsableExpressions"}], "]"}]}]}], " ", "/.", " ", 
       "positionRules"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismGeometricExpression", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_", " ", ",", 
      " ", "expression_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"parsableExpressions", " ", "=", " ", 
          RowBox[{"extractParsableExpressions", "[", "expression", "]"}]}], 
         ",", "\n", "\t", 
         RowBox[{"mechanismPositions", " ", "=", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
         "\t", 
         RowBox[{"positionRules", " ", "=", " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
               RowBox[{"VertexPosition", " ", "->", " ", 
                RowBox[{"VertexPosition", "[", "0", "]"}]}]}], "]"}], " ", "->",
              " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}], 
            "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"expression", " ", "/.", " ", 
          RowBox[{"Dispatch", "@", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"computeGeometricQuantities", "[", " ", 
               RowBox[{
               "m", ",", " ", "mechanismPositions", " ", ",", " ", 
                "positions", ",", " ", "#"}], "]"}], " ", "&"}], " ", "/@", 
             " ", "parsableExpressions"}], "]"}]}]}], " ", "/.", " ", 
         RowBox[{"Dispatch", "[", " ", 
          RowBox[{"PositionRules", "[", "positions", "]"}], " ", "]"}]}], " ",
         "/.", " ", "positionRules"}]}], "\n", "]"}], " ", "/;", " ", 
     RowBox[{"VertexCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "positions"}], "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6982]:=",ExpressionUUID->"d16aa780-c2da-4a0c-8d77-00283bb87712"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["input/output", "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],

Cell[CellGroupData[{

Cell["SaveToFOLD[], LoadFromFOLD[]", "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],

Cell["\<\
Save the Mechanism using the FOLD specification \
(https://github.com/edemaine/TorsionalFold/blob/master/doc/spec.md)\
\>", "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"incrementVertices", "[", "d_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "+", "1"}], "&"}], "/@", "d"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"decrementVertices", "[", "d_List", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "-", "1"}], "&"}], "/@", "d"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"SaveToFOLD", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "filename_String"}], 
   " ", "]"}], ":=", "\n", 
  RowBox[{"Export", "[", 
   RowBox[{"filename", ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
      "\"\<file_spec\>\"", " ", "\[Rule]", " ", "$MechanismsVersion"}], ",", 
      "\n", "\t", 
      RowBox[{
      "\"\<file_creator\>\"", " ", "\[Rule]", " ", "\"\<Mechanisms\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<file_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<singleModel\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_classes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\"\<creasePattern\>\"", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_attributes\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Switch", "[", " ", 
          RowBox[{
           RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], ",", " ", 
           "2", ",", " ", "\"\<2D\>\"", ",", " ", "3", ",", " ", "\"\<3D\>\"",
            ",", "_", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "m", "]"}], "===", 
            RowBox[{"Origami", " ", ">", " ", "0"}]}], ",", " ", 
           "\"\<manifold\>\"", ",", " ", "Nothing"}], " ", "]"}], ",", "\n", 
         "\t\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"MechanismOrientedQ", "[", " ", "m", " ", "]"}], ",", " ", 
           "\"\<orientable\>\"", ",", " ", "\"\<nonOrientable\>\""}], " ", 
          "]"}]}], "\n", "\t", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<frame_unit\>\"", " ", "\[Rule]", " ", "\"\<unit\>\""}], 
      ",", "\n", "\t", 
      RowBox[{"\"\<vertices_coords\>\"", " ", "\[Rule]", " ", 
       RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<edges_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}], ",", "\n", "\t", 
      RowBox[{"\"\<Faces_vertices\>\"", " ", "\[Rule]", " ", 
       RowBox[{"decrementVertices", " ", "/@", " ", 
        RowBox[{"MechanismConnectivity", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{
          "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<vertices\>\""}]}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\"\<JSON\>\""}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6991]:=",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "LoadFromFOLD", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"\"\<Face\>\"", "->", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Face", "[", "#", "]"}], "&"}], ")"}]}], "}"}], ",", " ", 
      RowBox[{"Options", "[", "Origami", "]"}]}], " ", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"LoadFromFOLD", "[", 
   RowBox[{"filename_String", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"inputData", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", "\"\<JSON\>\""}], "]"}]}], ",", "\n", "\t", 
      "coords", ",", "edges", ",", "Faces"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"inputData", " ", "===", " ", "$Failed"}], ",", "\n", "\t\t", 
      "$Failed", ",", "\n", "\n", "\t\t", 
      RowBox[{
       RowBox[{"coords", "=", 
        RowBox[{"\"\<vertices_coords\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"edges", "=", 
        RowBox[{"\"\<edges_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\t\t", 
       RowBox[{"Faces", "=", 
        RowBox[{"\"\<Faces_vertices\>\"", " ", "/.", " ", "inputData"}]}], 
       ";", "\n", "\n", "\t\t", 
       RowBox[{"Origami", "[", " ", 
        RowBox[{"coords", ",", " ", 
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"OptionValue", "[", "\"\<Face\>\"", "]"}], " ", "/@", " ", 
           
           RowBox[{"incrementVertices", " ", "/@", " ", "Faces"}]}], "]"}], 
         ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "Origami", "]"}]}], "]"}]}], " ", 
        "]"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6994]:=",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6996]:=",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mechanisms`rigidity: rigidity and Linkage functions", "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6998]:=",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomCellNetwork", "::", "usage"}], "=", 
   "\"\<RandomCellNetwork[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] \
returns a random network of \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \",FontSlant->\"Italic\"]\)cells based on a Voronoi tesselation \
of \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) points and contained in a \
periodic region Rectangle[{0,0},{1,1}].\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "::", "usage"}], "=", 
    "\"\<RandomTriangulatedNetwork[\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\
\)] returns a random triangulated network based on a Delaunay triangulation \
of \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) vertices contained in a \
periodic region Rectangle[{0,0},{1,1}].\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Henneberg", "::", "usage"}], "=", 
    "\"\<Henneberg[1][{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"\
], \"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),...}, \!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\) \
\[RightArrow] \!\(\*StyleBox[\"position\",FontSlant->\"Italic\"]\)] is a \
generalized Henneberg operation of type 1 that creates a new vertex at \
\!\(\*StyleBox[\"position\",FontSlant->\"Italic\"]\) and attaches it to \
existing vertices {\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),...}.\nA proper Henneberg type-1 move in 2D attaches to two vertices \
only.\n\nHenneberg[2][{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"\
], \"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\)},\
\!\(\*StyleBox[\"label\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"position\",FontSlant->\"Italic\"]\)] is a Henneberg \
operation of type 2 that subdivides an edge \
{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"1\"]\),\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \
\"2\"]\),}, places a new vertex at \
\!\(\*StyleBox[\"position\",FontSlant->\"Italic\"]\), and connects it to \
vertex \!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\"Italic\"], \"3\"]\).\n\
Henneberg[\!\(\*StyleBox[\"t\",FontSlant->\"Italic\"]\)][\!\(\*StyleBox[\"\
position\",FontSlant->\"Italic\"]\)] is a random Henneberg operation of type \
\!\(\*StyleBox[\"t\",FontSlant->\"Italic\"]\), placing the new vertex at \!\(\
\*StyleBox[\"position\",FontSlant->\"Italic\"]\).\n\nIn two dimensions, \
Henneberg moves takes a 0 degree of freedom mechanism to another 0 degree of \
freedom mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BlockFaces", "::", "usage"}], "=", 
   "\"\<BlockFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"f\"\
,FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[SubscriptBox[\"f\", \
\"2\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\) ], \
BlockFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[StyleBox[\"f\"\
,FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[SubscriptBox[\"f\", \
\"2\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"thickness\",FontSlant->\"Italic\"]\)] rigidifies a list of \
faces \!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[\
StyleBox[\"f\",FontSlant->\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[SubscriptBox[\"f\", \
\"2\"],FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"...\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\)  by adding edges and vertices. \
The block size is specified by \
\!\(\*StyleBox[\"thickness\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\".\",\
FontSlant->\"Plain\"]\)\n\
BlockFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)], \
BlockFaces[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"thickness\",FontSlant->\"Italic\"]\)] rigidies all the \
nontriangular faces of a mechanism by adding edges and vertices.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[6999]:=",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellData", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCellData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns the equilibrium data for all cells in the form { \
\!\(\*StyleBox[\"cellType\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], <| \!\(\*SubscriptBox[StyleBox[\"dataType\",FontSlant->\"Italic\"], \"1\"]\
\) -> \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \"1\"]\), \
... |> }.\nMechanismCellData[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\) ] returns the equilibrium \
data for all cells matching \!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\
\) in the form { \!\(\*StyleBox[\"cellType\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], <| \!\(\*SubscriptBox[StyleBox[\"dataType\",FontSlant->\"Italic\"], \"1\"]\
\) -> \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \"1\"]\), \
... |> }.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellRawData", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCellRawData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] \
returns the raw data (as specified) for all cells in the form { \
\!\(\*StyleBox[\"cellType\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], <| \!\(\*SubscriptBox[StyleBox[\"dataType\",FontSlant->\"Italic\"], \"1\"]\
\) -> \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \"1\"]\), \
... |> }.\n\
MechanismCellRawData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\)] returns the raw data for \
all cells matching \!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\) in the \
form { \!\(\*StyleBox[\"cellType\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], <| \!\(\*SubscriptBox[StyleBox[\"dataType\",FontSlant->\"Italic\"], \"1\"]\
\) -> \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \"1\"]\), \
... |> }.\n\
MechanismCellRawData[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\) , \
\!\(\*StyleBox[\"dataType\",FontSlant->\"Italic\"]\) \[RightArrow] \
\!\(\*StyleBox[\"data\",FontSlant->\"Italic\"]\)] returns the specified raw \
data for cells matching \!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\) \
and specific data.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellDataValue", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCellDataValue[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\),\
 \!\(\*StyleBox[\"pattern\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"dataType\",FontSlant->\"Italic\"]\)] returns only the \
specified equilibrium data for cells matching a pattern in the form { \
\!\(\*StyleBox[\"cellType\",FontSlant->\"Italic\"]\)[ \
{\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"1\"]\), \
\!\(\*SubscriptBox[StyleBox[\"cell\",FontSlant->\"Italic\"], \"2\"]\), ...} \
], <| \!\(\*SubscriptBox[StyleBox[\"dataType\",FontSlant->\"Italic\"], \"1\"]\
\) -> \!\(\*SubscriptBox[StyleBox[\"data\",FontSlant->\"Italic\"], \"1\"]\), \
... |> }.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstrainedCells", "::", "usage"}], "=", 
   "\"\<MechanismConstrainedCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\
\)] returns a list of cells with infinite stiffness.\n\
MechanismConstrainedCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) , {\!\
\(\*StyleBox[\"head\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"indices\",FontSlant->\"Italic\"]\)}] returns a list of cells \
matching the specification with infinite stiffness.\n\
MechanismConstrainedCells[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \!\(\
\*StyleBox[\"patt\",FontSlant->\"Italic\"]\)] returns a list of cells \
matching a pattern and having infinite stiffness.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7003]:=",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomDisplacements", "::", "usage"}], "=", 
    "\"\<RandomDisplacements[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] returns n random displacements \
of mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) respecting linear \
constraints.\nRandomDisplacements[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] returns only one set of \
random displacements.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomPositions", "::", "usage"}], "=", 
    "\"\<RandomPositions[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] returns \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) positions that have been \
randomly displaced in mechanism \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) \
while respecting linear constraints.\n\
RandomPositions[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\)] returns only \
one set of random positions.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Distribution", "::", "usage"}], "=", 
   "\"\<Distribution is an option in the Mechanisms package for \
RandomDisplacements and RandomPositions to specify a distribution for \
perturbing vertices.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7007]:=",ExpressionUUID->"a68366c6-336f-4346-b15c-2c22b179ab9e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Constraints", "::", "usage"}], "=", 
   "\"\<Constraints is an option in the Mechanisms package to specify \
additional mechanism constraints.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EliminationRules", "::", "usage"}], "=", 
   "\"\<EliminationRules is an option in the Mechanisms package to specify a \
set of replacement rules for vertex displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AddedEnergy", "::", "usage"}], "=", 
   "\"\<AddedEnergy is an option in the Mechanisms package for additional \
terms added to an energy.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstraintOutput", "::", "usage"}], "=", 
   "\"\<ConstraintOutput is an option for MechanismConstraintEquations and \
related functions to determine that can take the value VertexPosition or \
VertexDisplacement.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"StepSize", "::", "usage"}], "=", 
   "\"\<StepSize is an option for MechanismIsometricTrajectory[] to set the \
step size used to traverse the configuration space.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OutputVariables", "::", "usage"}], "=", 
   "\"\<OutputVariables is an option for MechanismInfinitesimalMotions to \
specify names for the output variables.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InitialPositions", "::", "usage"}], "=", 
   "\"\<InitialPositions is an option in the mechanisms package to specify \
initial positions.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexMass", "::", "usage"}], "=", 
   "\"\<VertexMass is an option in the Mechanisms package to add mass to the \
vertices of a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"VertexDrag", "::", "usage"}], "=", 
   "\"\<VertexDrag is an option in the mechanisms package to add drag to the \
vertices of a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"StoppingCriteria", "::", "usage"}], "=", 
   "\"\<StoppingCriteria is an option for MechanismIsometricTrajectory[]. It \
can be either None or a function that takes the current vertex positions and \
the tangent direction and returns True if the calculation should \
contimue.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SetParameters", "::", "usage"}], "=", 
   "\"\<SetParameters is an option for MechanismEnergy[]. It should be a list \
of replacement rules specifying a numerical value for a set of parameters in \
the energy.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7010]:=",ExpressionUUID->"6df18a0e-6370-480c-a4c0-79be3746c9f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FixMechanism", "::", "usage"}], "=", 
    "\"\<FixMechanism[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
replaces cell data with its equilibrium value.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Deformed", "::", "usage"}], "=", 
   "\"\<Deformed[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\) ] represents a \
mechanism whose vertices have been deformed to \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\) without changing cell \
data.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7021]:=",ExpressionUUID->"5d5039a9-a8aa-4a43-8ed2-26c9dd67a7ff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstraintMap", "::", "usage"}], "=", 
    "\"\<MechanismConstraintMap[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] returns the constraint map \
for a mechanism in terms of VertexPosition.\nMechanismConstraintMap[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) ] returns the constraint map \
for a mechanism up to order \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) in \
terms of VertexDisplacement.\nMechanismConstraintMap[ \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), Infinity ] returns the \
constraint map for a mechanism up to order Infinity in terms of \
VertexDisplacement.\n\nWhen mechanism has a \
Deformed[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)] wrapper, the \
constraint map is evaluated at \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\).\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismLinearConstraints", "::", "usage"}], "=", 
    "\"\<MechanismLinearConstraints[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"\
]\)] returns solutions to all the linear constraints provided in a mechanism.\
\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<MechanismEnergy[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) ] \
returns an energy expression for a mechanism.\n\nWhen mechanism has a \
Deformed[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)] wrapper, the energy is \
evaluated at positions.\n\nSee $DefaultMechanismStiffnesses to determine how \
MechanismEnergy[] sets the default stiffnesses when the stiffness is \
Infinity.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<CompiledMechanismEnergy[ \!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\
\) ] compiles an energy and gradient for a Mechanism.\n\nUndefined symbols in \
the energy must be set using ReplaceAll[], /.\nOptions:\n  \
\\\"AddToEnergy\\\" -> energy allows additional terms, written as a function \
of VertexPosition[], to be added to the energy and compiled.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergyQ", "::", "usage"}], "=", "\n", 
    "\"\<CompiledMechanismEnergyQ[\!\(\*StyleBox[\"energy\",FontSlant->\"\
Italic\"]\)] returns True if and only if \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\) is a \
CompiledMechanismEnergy[] object.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "::", "usage"}], "=", 
   "\"\<$DefaultMechanismStiffnesses[\!\(\*StyleBox[\"cell\",FontSlant->\"\
Italic\"]\)] returns the default stiffness in case the constraint is rigid.\n\
Use $DefaultMechanismStiffnesses[\\\"Constraints\\\"] to find the stiffness \
of added constraints.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7023]:=",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReduceLinearConstraints", "::", "usage"}], "=", 
   "\"\<A Boolean option in the Mechanisms package that specifies whether \
linear constraints should be automatically solved.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7029]:=",ExpressionUUID->"e7c746c1-2315-4231-80ed-758ab0a53e10"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EuclideanMotionConstraints", "::", "usage"}], "=", 
   "\"\<EuclideanMotionConstraints[\!\(\*StyleBox[\"v\",FontSlant->\"Italic\"]\
\)], EuclideanMotionConstraints[{\!\(\*SubscriptBox[StyleBox[\"v\",FontSlant->\
\"Italic\"], \
\"1\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*SubscriptBox[\
StyleBox[\"v\",FontSlant->\"Italic\"], \"2\"]\),...}] represents constraints \
pinning the Euclidean motions of a mechanism by fixing the listed vertices.\n\
EuclideanMotionConstraints[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"indices\",FontSlant->\"Italic\"]\) ] returns constraints \
associated with fixing the vertex or the list of vertices in \
\!\(\*StyleBox[\"indices\",FontSlant->\"Italic\"]\).\nThe number of specified \
vertices must be less than or equal to the embedding dimension of the \
mechanism.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7030]:=",ExpressionUUID->"629a732b-cf53-4bce-bf8f-e269f14240c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstraintMatrix", "::", "usage"}], "=", 
    "\"\<MechanismConstraintMatrix[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\
\)] returns the constraint matrix for the first-order constraints.\nWhen \
mechanism has a Deformed[\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\)] wrapper, the \
constraint matrix is evaluated at positions.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismAugmentedConstraintMatrix", "::", "usage"}], "=", 
    "\"\<Experimental!\nMechanismAugmentedConstraintMatrix[\!\(\*StyleBox[\"m\
\",FontSlant->\"Italic\"]\), \!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\)] \
returns an augmented constraint matrix for mechanism \
\!\(\*StyleBox[\"m\",FontSlant->\"Italic\"]\) with periodic data \
\!\(\*StyleBox[\"pi\",FontSlant->\"Italic\"]\).\nThe augmented constraint \
matrix has 3 additional degrees of freedoms in 2D and 6 additional degrees of \
freedom in 3D corresponding to deformations of the lattice vectors.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismZeroModes", "::", "usage"}], "=", 
    "\"\<MechanismZeroModes[m] returns a list of numerical zero modes (linear \
isometries) associated with the constraints of Mechanism m.\nWhen mechanism \
has a Deformed[m, positions] wrapper, the zero modes are evaluated at \
positions.\n\nIt takes the options of MechanismConstraintMatrix[] and \
Eigensystem. Option Tolerance can be used to set a numerical value to \
correspond to 0.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismSelfStresses", "::", "usage"}], "=", 
    "\"\<MechanismSelfStresses[m] returns a list of numerical self-stresses \
() modes associated with the constraints of Mechanism m.\nWhen mechanism has \
a Deformed[m, positions] wrapper, the self stresses are evaluated at \
positions.\n\nIt takes the options of MechanismConstraintMatrix[] and \
Eigensystem. Option Tolerance can be used to set a numerical value to \
correspond to 0.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismInfinitesimalMotions", "::", "usage"}], "=", "\n", 
    "\"\<MechanismInfinitesimalMotions[m] returns a list of two elements: an \
Infinitesimal linear motion and, if necessary, a list of quadratic \
constraints they must satisfy.\n\nUse option OutputVariables to control the \
form of the output.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismStressMatrix", "::", "usage"}], "=", "\n", 
   "\"\<MechanismStressMatrix[ m, vec ] returns a stress matrix associated \
with the stress vector vec. The (i,j) component of the stress matrix is the \
negative of the corresponding stress vector component (and zero otherwise) \
and diagonal components are chosen so that rows and columns sum to zero.\n\n\
(see Connelly on generic global rigidity)\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7031]:=",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConstraintModulus", "::", "usage"}], "=", 
   "\"\<ConstraintModulus is an option for MechanismEnergy to specify the \
modulus used to enforce nonlinear constraints.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7037]:=",ExpressionUUID->"605b6d8c-9ed0-4469-b11f-f25fc5895f2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismHamiltonianFlow", "::", "usage"}], "=", 
   "\"\<MechanismHamiltonianFlow[ mechanism ] creates a Hamiltonian flow \
problem.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismGradientFlow", "::", "usage"}], "=", 
    "\"\<MechanismGradientFlow[ mechanism ] creates a gradient flow \
problem.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismNDSolve", "::", "usage"}], "=", 
    "\"\<MechanismNDSolve[ flow , initialConditions, {time, start time, end \
time} ] solves a flow problem from initial conditions.\nMechanismNDSolve[ \
flow , initialConditions, {time, start time, end time, stepsize} ] solves a \
flow problem from initial conditions and returns a list of positions.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismItoProcess", "::", "usage"}], "=", 
   "\"\<MechanismItoProcess[ flow, noise, initial conditions, {time, start \
time, end time} ] returns a list of positions subject to velocity \
noise.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7038]:=",ExpressionUUID->"6720fc8e-f64b-40fd-9cd4-0b342dca3c4c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergy", "::", "usage"}], "=", "\n", 
    "\"\<MinimizeMechanismEnergy[\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"mechanism\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \",FontSlant->\"Italic\"]\)], MinimizeMechanismEnergy[ \!\
\(\*StyleBox[\(m\*StyleBox[\"echanism\",FontSlant->\"Italic\"]\)]\), \
\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\) ] minimizes the energy of \
a Mechanism, returning {\!\(\*StyleBox[\"minimum\",FontSlant->\"Italic\"]\)\!\
\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"mininal\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"vertex\",FontSlant->\"Italic\"]\)\
\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"positions\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\nMinimizeMechanismEnergy[], \
MinimizeMechanismEnergy[ energy ] can be applied to a mechanism to produce a \
new mechanism with positions at a local energy minimum.\n\nThe optional \
argument \!\(\*StyleBox[\"energy\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)can be either an expression or a compiled \
Mechanism energy.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MetropolisEnergy", "::", "usage"}], "=", 
   "\"\<MetropolisEnergy[m] creates a compiled energy to use in \
MechanismMetropolis[].\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMetropolis", "::", "usage"}], "=", 
   "\"\<MechanismMetropolis[ energy , initial position , inverse temperature \
, {m, n} ] takes a metropolis energy and executes m steps using the \
Metropolis algorithm, throwing away positions, then n steps recording \
positions.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7042]:=",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismIsometricTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<MechanismIsometricTrajectory[\!\(\*StyleBox[\"Mechanism\",FontSlant->\
\"Italic\"]\), \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] creates a trajectory using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) steps through the configuration \
space of a Mechanism starting in the\ndisplacement direction \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<MechanismFindMinimalTrajectory[\!\(\*StyleBox[\"Mechanism\",\
FontSlant->\"Italic\"]\), \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] attempts to find a valid \
trajectory from \!\(\*StyleBox[\"start\",FontSlant->\"Italic\"]\) to \
\!\(\*StyleBox[\"end\",FontSlant->\"Italic\"]\) configurations using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) intermediate steps.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenericGloballyRigidQ", "::", "usage"}], "=", "\n", 
   "\"\<GenericGloballyRigidQ[m] returns True if it can be determined that \
the system is generically globally rigid according to Connelly's criteria \
based on the stress matrix.\nIf it returns True, the specific Mechanism may \
still be non-rigid.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:05 \
In[7045]:=",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PrestressStability", "::", "usage"}], "=", 
   "\"\<PrestressStability[m] returns {t, most unstable self stress} where t \
is the smallest stress matrix eigenvalue, so t < 0 if the mechanism is \
prestress stable.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PrestressStableQ", "::", "usage"}], "=", 
   "\"\<PrestressStableQ[m] attempts to determine if a mechanism is prestress \
stable.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7048]:=",ExpressionUUID->"444b2f4a-dc84-44ba-af1b-fea03b008251"]
}, Open  ]],

Cell[CellGroupData[{

Cell["cell rigidity and energy definitions", "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:06 \
In[7050]:=",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Certain", " ", "cell", " ", "types", " ", "can", " ", "have", " ", 
    "specially", " ", "named", " ", "things"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"dataParsingRules", "[", " ", 
    RowBox[{"Spring", " ", ",", " ", "\"\<Strain\>\""}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Dispatch", "[", 
    RowBox[{"{", 
     RowBox[{"\"\<LinearStrain\>\"", " ", "->", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#1", "-", "#2"}], ")"}], "/", "#2"}], " ", "&"}], ")"}]}], 
     "}"}], "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7053]:=",ExpressionUUID->"4ae0ac49-4287-4043-9ab2-23121abff931"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "combinations", " ", "of", " ", "data", " ", "that", " ", "count", " ", 
    "as", " ", "\"\<constraints\>\""}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"$constrainedCellData", " ", "=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Stiffness\>\"", ",", " ", "\"\<TorsionalStiffness\>\"", ",", 
          " ", "\"\<PinningStiffness\>\"", ",", " ", "\"\<FaceStiffness\>\"", 
          ",", "\"\<YoungsModulus\>\"", ",", " ", "\"\<AngleStiffness\>\""}], 
         "}"}], "->", "Infinity"}], "]"}], "\n", "\t", "}"}], "]"}]}], 
   ";"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7054]:=",ExpressionUUID->"23cd23a7-9d77-47e0-95aa-dd921e7ea19d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "how", " ", "to", " ", "interpret", " ", "Automatic", " ", "for", " ", 
    "different", " ", "kinds", " ", "of", " ", "cells", "\n", "\n", 
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"mechanism", " ", ",", " ", "positions", " ", ",", " ", 
      RowBox[{"cell", "[", "indices", "]"}], " ", ",", " ", "data"}], " ", 
     "]"}], " ", "returns", " ", "the", " ", "values", " ", "that", " ", 
    "Automatic", " ", "represents", " ", "in", " ", "cells", " ", "of", " ", 
    "a", " ", "particular", " ", "data", " ", 
    RowBox[{"type", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"RigidBar", "[", "indices_", "]"}], " ", ",", " ", 
      "\"\<EquilibriumLength\>\""}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"DisplacementLength", "[", 
     RowBox[{"positions", " ", ",", " ", "indices"}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
      RowBox[{"Spring", "[", "indices_", "]"}], " ", ",", " ", 
      "\"\<EquilibriumLength\>\""}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"DisplacementLength", "[", 
     RowBox[{"positions", " ", ",", " ", "indices"}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
      RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", 
      "\"\<Angle\>\""}], " ", "]"}], " ", ":=", "  ", 
    RowBox[{"TorsionalFoldAngle", "[", 
     RowBox[{"m", ",", " ", "positions", ",", " ", "indices"}], " ", "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", 
      RowBox[{"AngleJoint", "[", "indices_", "]"}], ",", " ", 
      "\"\<Angle\>\""}], " ", "]"}], " ", ":=", "  ", 
    RowBox[{"TurningAngle", "[", 
     RowBox[{"m", ",", " ", "positions", ",", " ", "indices"}], " ", "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", 
      "\"\<ConstraintFunction\>\""}], "]"}], " ", ":=", " ", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#1", "-", "#2"}], " ", "&"}], ")"}], ",", " ", 
      RowBox[{"Length", "[", "indices", "]"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"StraightJoint", "[", " ", "indices_", " ", "]"}], " ", ",", 
      " ", "\"\<Distance\>\""}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"DisplacementLength", "[", 
      RowBox[{"positions", ",", " ", 
       RowBox[{"indices", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "]"}], "/", 
     RowBox[{"DisplacementLength", "[", 
      RowBox[{"positions", ",", " ", 
       RowBox[{"indices", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "]"}]}], "]"}]}]}], "\n", 
   "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t", 
   RowBox[{"(*", 
    RowBox[{
    "how", " ", "far", " ", "along", " ", "the", " ", "distance", " ", 
     "between", " ", "1", " ", "and", " ", "3", " ", "is", " ", "vertex", " ",
      "2"}], "*)"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7055]:=",ExpressionUUID->"e3ca056a-2047-4f83-ac78-61703de77008"],

Cell[CellGroupData[{

Cell["cellConstraints[]", "Subsection",ExpressionUUID->"cf5b3ee8-ffae-4f09-a130-12c1ee2bed91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"cellConstraints", "[", 
      RowBox[{"mechanism", " ", ",", " ", "positions", " ", ",", " ", 
       RowBox[{"arbitrary", " ", "positions"}], ",", " ", 
       RowBox[{
        RowBox[{"cell", "[", "indices", "]"}], " ", "->", " ", "data"}]}], 
      " ", "]"}], "\n", "\t", "returns", " ", "the", " ", "constraints", " ", 
     "associated", " ", "with", " ", "a", " ", "particular", " ", "cell", " ",
      "evaluated", " ", "at", " ", 
     RowBox[{"positions", ".", "\n", "\n", "\t", 
      RowBox[{"cell", "[", "indices", "]"}]}]}], " ", "->", " ", 
    RowBox[{"data", " ", "is", " ", "the", " ", "output", " ", "of", " ", 
     RowBox[{"cellData", "[", "]"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"RigidBar", "[", "indices_", "]"}], ",", " ", "data_"}], 
       "]"}]}], " ", "]"}], ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"DisplacementLengthSquared", "[", " ", 
      RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], " ", 
     "-", " ", 
     RowBox[{
      RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", "2"}]}]}],
    "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"ElasticTriangle", "[", "indices_", "]"}], ",", " ", 
        "data_"}], "]"}]}], " ", "]"}], ":=", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"DeleteDuplicatesBy", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"indices", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}], ",", "1", ",", "1"}], "]"}], 
            ",", "2"}], "]"}], ",", "Sort"}], " ", "]"}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{
       RowBox[{"DisplacementLengthSquared", "[", " ", 
        RowBox[{"arbitraryPositions", ",", " ", "edges"}], " ", "]"}], " ", 
       "-", " ", 
       RowBox[{"DisplacementLengthSquared", "[", " ", 
        RowBox[{"positions", ",", " ", "edges"}], " ", "]"}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"Face", "[", "indices_", "]"}], ",", " ", "data_"}], "]"}]}], 
     " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"partitionedIndices", " ", "=", " ", 
        RowBox[{"Select", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", " ", "3", ",", "1", ",", "1"}], "]"}], "&"}], 
           " ", "/@", " ", "indices"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "3"}], "&"}]}], " ", 
         "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"faceStiffnessFunction", "[", 
         RowBox[{"NormalVector", "[", " ", 
          RowBox[{"arbitraryPositions", " ", ",", " ", "#"}], " ", "]"}], 
         "]"}], "&"}], " ", "/@", " ", "partitionedIndices"}]}], "\n", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"faceStiffnessFunction", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y__"}], "}"}], "]"}], ":=", " ", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Dot", "[", 
         RowBox[{"x", " ", ",", " ", "#"}], "]"}], " ", "-", " ", "1"}], " ", 
       "&"}], " ", ",", " ", 
      RowBox[{"{", "y", "}"}]}], "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"Spring", "[", "indices_", "]"}], ",", " ", "data_"}], 
       "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"#1", "[", 
        RowBox[{"#2", ",", "#3"}], "]"}], "&"}], ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<Strain\>\"", "]"}], ",", " ", 
        RowBox[{"DisplacementLength", "[", " ", 
         RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], ",",
         " ", 
        RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}], " ", 
       "}"}]}], " ", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"AngleJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
       "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"TurningAngle", "[", 
      RowBox[{"arbitraryPositions", ",", " ", "indices"}], "]"}], "-", 
     RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", " ", ",", " ", "arbitraryPositions_", ",", 
      " ", 
      RowBox[{"Rule", "[", " ", 
       RowBox[{
        RowBox[{"StraightJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
       " ", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"displacements", " ", "=", " ", 
         RowBox[{
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", "]"}], "]"}], " ",
           "-", " ", 
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"start", " ", "=", " ", 
         RowBox[{"arbitraryPositions", "[", 
          RowBox[{"[", " ", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"me", " ", "=", " ", 
         RowBox[{"arbitraryPositions", "[", 
          RowBox[{"[", " ", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}], "]"}]}]}], 
       "\n", "\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{"me", " ", "-", " ", "start", " ", "-", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<Distance\>\"", "]"}], " ", 
        "displacements"}]}]}], " ", 
     RowBox[{"(*", 
      RowBox[{
      "put", " ", "vertex", " ", "`me`", " ", "a", " ", "fraction", " ", "of",
        " ", "the", " ", "way", " ", "between", " ", "the", " ", "two", " ", 
       "end", " ", "points"}], "*)"}], "\n", "\t", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", "data_"}], 
       " ", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"TorsionalFoldAngle", "[", " ", 
      RowBox[{"m", ",", " ", "arbitraryPositions", ",", " ", "indices"}], " ",
       "]"}], " ", "-", " ", 
     RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
      
      RowBox[{"Rule", "[", 
       RowBox[{
        RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
       " ", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"MapThread", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"#1", "[", 
        RowBox[{"#2", ",", "#3"}], "]"}], "&"}], ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
        RowBox[{"VertexPosition", "[", " ", 
         RowBox[{"indices", ",", " ", 
          RowBox[{"All", "[", " ", 
           RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
           "]"}]}], " ", "]"}], ",", " ", 
        RowBox[{"positions", "[", 
         RowBox[{"[", " ", "indices", " ", "]"}], "]"}]}], " ", "}"}]}], " ", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"cellConstraints", "[", " ", "___", " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", "}"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7061]:=",ExpressionUUID->"81559538-23e4-418c-af09-923e0c0549d5"]
}, Closed]],

Cell[CellGroupData[{

Cell["$DefaultMechanismStiffnesses[], cellEnergy[]", "Subsection",ExpressionUUID->"dd6a3406-e103-4d67-ba5d-46745a2aac0c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "\"\<Methods\>\"", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "RigidBar", ",", " ", "Spring", ",", " ", "TorsionalFold", ",", " ", 
     "FreeJoint", ",", " ", "Face", ",", " ", "AngleJoint"}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "RigidBar", "]"}], "=", "1"}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "Spring", "]"}], "=", "1"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "ElasticTriangle", "]"}], " ",
    "=", " ", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "Face", "]"}], " ", "=", " ", 
   "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "PinnedJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "AngleJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "4"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "[", "StraightJoint", "]"}], "=", 
   RowBox[{"10", "^", 
    RowBox[{"(", 
     RowBox[{"-", "1"}], ")"}]}]}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7071]:=",ExpressionUUID->"c875f7af-404b-4ffe-b7cb-18873a8f2129"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismEnergy", "::", "EdgeLength"}], "=", 
    "\"\<Warning: Edges `1` with length smaller than `2` have had their \
strains clipped.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"RigidBar", "[", "indices_", "]"}], ",", "data_"}], "]"}]}], 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "this", " ", "puts", " ", "a", " ", "lower", " ", "bound", " ", "on", 
        " ", "the", " ", "smallest", " ", "length", " ", "we", " ", "use", 
        " ", "to", " ", "divide", " ", "the", " ", "strain", " ", "by"}], 
       "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"smallestLengths", " ", "=", " ", 
        RowBox[{"Clip", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", 
           "2"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
             "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", 
              "]"}], "^", "2"}], ",", " ", "Infinity"}], "}"}]}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "this", " ", "is", " ", "to", " ", "put", " ", "out", " ", "a", " ", 
         "warning", " ", "in", " ", "case", " ", "some", " ", "are", " ", 
         RowBox[{"short", "."}]}], "*)"}], "\n", "\t", 
       RowBox[{"shortEdges", "=", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{"indices", " ", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#", " ", "<", " ", 
              RowBox[{
              "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", 
               "]"}]}], ")"}], "&"}], " ", "/@", " ", 
           RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}]}], 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "shortEdges", "]"}], ">", "0"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"MechanismEnergy", "::", "EdgeLength"}], ",", " ", 
          "shortEdges", ",", " ", 
          RowBox[{
          "$DefaultMechanismStiffnesses", "[", "\"\<SmallestStiffness\>\"", 
           "]"}]}], " ", "]"}]}], " ", "]"}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", "\n", "\t\t", 
       RowBox[{"stiffness", " ", "*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"l", "^", "2"}], " ", "-", " ", 
              RowBox[{"l0", "^", "2"}]}], ")"}], "/", 
            RowBox[{"l0", "^", "2"}]}], ")"}], "^", "2"}], "/", "8"}], " ", 
        "when", " ", "equilibrium", " ", "length", " ", "l0", " ", "is", " ", 
        "longer", " ", "than", " ", "shortest", " ", "length", "\n", "\t\t", 
        "\n", "\t\t", "this", " ", "has", " ", "the", " ", "property", " ", 
        "that", " ", "subdivided", " ", "edges", " ", "have", " ", "the", " ",
         "same", " ", "energy", " ", "as", " ", "their", " ", "original", " ",
         "edge", " ", "length"}], "\n", "\t", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<Stiffness\>\"", "]"}], " ", "/.", " ", 
         RowBox[{"Infinity", " ", "\[Rule]", " ", 
          RowBox[{"$DefaultMechanismStiffnesses", "[", "RigidBar", "]"}]}]}], 
        " ", ")"}], " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", " ", "\n", "\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"DisplacementLengthSquared", "[", 
              RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}],
              " ", "-", " ", 
             RowBox[{
              RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}], "^", 
              "2"}]}], ")"}], "/", "smallestLengths"}], "\n", "\t", ")"}], 
         "^", "2"}], "/", "8"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"Spring", "[", "indices_", "]"}], ",", "data_"}], "]"}]}], 
    "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<Stiffness\>\"", "]"}], " ", "/.", " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{"$DefaultMechanismStiffnesses", "[", "Spring", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"#2", ",", "#3"}], "]"}], "^", "2"}], "&"}], ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<Strain\>\"", "]"}], ",", " ", 
          RowBox[{"DisplacementLength", "[", 
           RowBox[{"arbitraryPositions", ",", " ", "indices"}], " ", "]"}], 
          ",", " ", 
          RowBox[{"data", "[", "\"\<EquilibriumLength\>\"", "]"}]}], " ", 
         "}"}]}], " ", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"TorsionalFold", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<TorsionalStiffness\>\"", "]"}], " ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", "indices"}], " ",
            "]"}], " ", "-", " ", 
          RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cellEnergy", "[", 
   RowBox[{"m_", ",", "positions_", ",", "arbitraryPositions_", ",", " ", 
    RowBox[{"Rule", "[", 
     RowBox[{
      RowBox[{"Face", "[", "indices_", "]"}], ",", "data_"}], "]"}]}], "]"}], 
  ":=", 
  RowBox[{"0", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"arbitraryPositions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "<", " ", "3"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"Face", "[", "indices_", "]"}], ",", " ", "data_"}], "]"}]}], 
    "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"partitionedIndices", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"#", ",", " ", "3", ",", "1", ",", "1"}], "]"}], "&"}], 
         " ", "/@", " ", "indices"}]}], ",", "\n", "\t", 
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<FaceStiffness\>\"", "]"}], " ", "/.", " ", 
         
         RowBox[{"Infinity", " ", "->", " ", 
          RowBox[{"$DefaultMechanismStiffness", "[", "Face", "]"}]}]}]}], ",",
        "\n", "\t", "selector"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"selector", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"#", " ", ">", " ", "0"}], "&"}], " ", "/@", " ", 
        "stiffness"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
       "selects", " ", "faces", " ", "that", " ", "have", " ", "a", " ", 
        "stiffness", " ", "that", " ", 
        RowBox[{"isn", "'"}], "t", " ", "0"}], "*)"}], "\n", "\t", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", " ", 
          RowBox[{"faceEnergyFunction", "[", 
           RowBox[{"NormalVector", "[", 
            RowBox[{"arbitraryPositions", ",", " ", "#2"}], "]"}], "]"}]}], 
         "&"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Pick", "[", 
           RowBox[{"stiffness", ",", " ", "selector"}], "]"}], ",", " ", 
          RowBox[{"Pick", "[", 
           RowBox[{"partitionedIndices", ",", " ", "selector"}], "]"}]}], 
         "}"}]}], "]"}]}]}], "\n", "]"}]}], " "}], "\n", 
 RowBox[{
  RowBox[{"faceEnergyFunction", "[", 
   RowBox[{"stiffness_", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y__"}], "}"}]}], "]"}], ":=", " ", 
  RowBox[{"0", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"{", "y", "}"}], "]"}], "<=", " ", "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"faceEnergyFunction", "[", 
    RowBox[{"stiffness_", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y__"}], "}"}]}], "]"}], ":=", " ", 
   RowBox[{"Total", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{"x", " ", ",", " ", "#"}], "]"}], " ", "-", " ", "1"}], 
         ")"}], "^", "2"}], " ", "&"}], " ", ",", " ", 
      RowBox[{"{", "y", "}"}]}], "]"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"ElasticTriangle", "[", "indices_", "]"}], ",", " ", "data_"}],
       "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"stiffness", " ", "=", " ", 
        RowBox[{
         RowBox[{"data", "[", "\"\<YoungsModulus\>\"", "]"}], " ", "/.", " ", 
         
         RowBox[{"Infinity", " ", "\[Rule]", " ", 
          RowBox[{
          "$DefaultMechanismStiffnesses", "[", "ElasticTriangle", "]"}]}]}]}],
        ",", "\n", "\t", 
       RowBox[{"poissonratio", " ", "=", " ", 
        RowBox[{"data", "[", "\"\<PoissonRatio\>\"", "]"}]}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"MapThread", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"elasticFaceEnergy", "[", " ", 
         RowBox[{"#1", ",", " ", "#2", ",", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", " ", "#3", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", "#3", " ", "]"}], "]"}]}], " ", "]"}], "&"}], 
       ",", "\n", "\t\t", 
       RowBox[{"{", 
        RowBox[{"stiffness", ",", " ", "poissonratio", ",", " ", "indices"}], 
        "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"AngleJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<AngleStiffness\>\"", "]"}], " ", "/.", " ", 
        
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "AngleJoint", "]"}]}]}]}], "\n",
       "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"TurningAngle", "[", 
           RowBox[{"m", ",", "arbitraryPositions", ",", " ", "indices"}], " ",
            "]"}], " ", "-", " ", 
          RowBox[{"data", "[", "\"\<Angle\>\"", "]"}]}], ")"}], "^", "2"}], 
       "/", "2"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"StraightJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<AngleStiffness\>\"", "]"}], " ", "/.", " ", 
        
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "StraightJoint", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"displacements", " ", "=", " ", 
          RowBox[{
           RowBox[{"arbitraryPositions", "[", 
            RowBox[{"[", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", "]"}], "]"}], 
           " ", "-", " ", 
           RowBox[{"arbitraryPositions", "[", 
            RowBox[{"[", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}]}], ",",
          "\n", "\t\t", 
         RowBox[{"start", " ", "=", " ", 
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"me", " ", "=", " ", 
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "]"}], "]"}]}]}], 
        "\n", "\t", "}"}], ",", "\n", "\t\t", 
       RowBox[{"stiffness", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"start", " ", "+", " ", 
            RowBox[{
             RowBox[{"data", "[", "\"\<Distance\>\"", "]"}], " ", 
             "displacements"}], " ", "-", " ", "me"}], " ", 
           RowBox[{"(*", 
            RowBox[{
            "put", " ", "vertex", " ", "`me`", " ", "a", " ", "fraction", " ",
              "of", " ", "the", " ", "way", " ", "between", " ", "the", " ", 
             "two", " ", "end", " ", "points"}], "*)"}], ")"}], "^", "2"}], 
         "/", "2"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"cellEnergy", "[", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "arbitraryPositions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"PinnedJoint", "[", "indices_", "]"}], ",", " ", "data_"}], 
      "]"}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{
        RowBox[{"data", "[", "\"\<PinningStiffness\>\"", "]"}], " ", "/.", 
        " ", 
        RowBox[{"Infinity", " ", "\[Rule]", " ", 
         RowBox[{
         "$DefaultMechanismStiffnesses", "[", "TorsionalFold", "]"}]}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"stiffness", " ", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#1", "[", 
            RowBox[{"#2", ",", "#3"}], "]"}], "^", "2"}], "/", "2"}], "&"}], 
        " ", ",", " ", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"data", "[", "\"\<ConstraintFunction\>\"", "]"}], ",", " ", 
          
          RowBox[{"arbitraryPositions", "[", 
           RowBox[{"[", " ", "indices", " ", "]"}], "]"}], ",", " ", 
          RowBox[{"positions", "[", 
           RowBox[{"[", " ", "indices", " ", "]"}], "]"}]}], " ", "}"}]}], 
       " ", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"cellEnergy", "[", 
   RowBox[{"m_", ",", "_", ",", "_", ",", "_"}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "0", "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7080]:=",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"elasticFaceEnergy", "[", 
   RowBox[{"Y_", ",", "\[Nu]_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1_", ",", "y1_", ",", "z1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x2_", ",", "y2_", ",", "z2_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x3_", ",", "y3_", ",", "z3_"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X1_", ",", "Y1_", ",", "Z1_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"X2_", ",", "Y2_", ",", "Z2_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"X3_", ",", "Y3_", ",", "Z3_"}], "}"}]}], "}"}]}], "]"}], " ", 
  ":=", " ", "\n", 
  RowBox[{
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{"1", "+", "\[Nu]"}], ")"}]}]], "Y", " ", 
    RowBox[{"(", 
     RowBox[{
      FractionBox[
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "-", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]]}], ")"}], 
        "2"], 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "+", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 RowBox[{"x2", " ", "x3"}], "-", 
                 RowBox[{"x1", " ", 
                  RowBox[{"(", 
                   RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], "-", 
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["X1", "2"], "+", 
                 RowBox[{"X2", " ", "X3"}], "-", 
                 RowBox[{"X1", " ", 
                  RowBox[{"(", 
                   RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}]}], ")"}], 
        "2"], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "-", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}], ")"}], 
         " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}], ")"}]}], 
        ")"}]}], "+", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], " ", 
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], ")"}], 
           "/", 
           RowBox[{"(", 
            SqrtBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]], ")"}]}],
           "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["X1", "2"], "+", 
               RowBox[{"X2", " ", "X3"}], "-", 
               RowBox[{"X1", " ", 
                RowBox[{"(", 
                 RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], " ", 
             SqrtBox[
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}], ")"}], 
           "/", 
           RowBox[{"(", 
            SqrtBox[
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]], 
            ")"}]}]}], ")"}], "2"], "/", 
       RowBox[{"(", 
        RowBox[{"4", " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           FractionBox[
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               RowBox[{"x2", " ", "x3"}], "-", 
               RowBox[{"x1", " ", 
                RowBox[{"(", 
                 RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}], ")"}], 
         " ", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}], ")"}]}], 
        ")"}]}]}], ")"}]}], "+", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{"2", " ", "\[Nu]"}]}], ")"}], " ", 
      RowBox[{"(", 
       RowBox[{"1", "+", "\[Nu]"}], ")"}]}]], "Y", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]], "-", 
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "X1"}], "+", "X2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Y1"}], "+", "Y2"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "Z1"}], "+", "Z2"}], ")"}], "2"]}]]}], 
         SqrtBox[
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "x1"}], "+", "x2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "y1"}], "+", "y2"}], ")"}], "2"], "+", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "z1"}], "+", "z2"}], ")"}], "2"]}]]]}], "-", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 RowBox[{"x2", " ", "x3"}], "-", 
                 RowBox[{"x1", " ", 
                  RowBox[{"(", 
                   RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], "-", 
          RowBox[{
           SqrtBox[
            RowBox[{"1", "-", 
             FractionBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["X1", "2"], "+", 
                 RowBox[{"X2", " ", "X3"}], "-", 
                 RowBox[{"X1", " ", 
                  RowBox[{"(", 
                   RowBox[{"X2", "+", "X3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}]}]}], ")"}], "2"], 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y2"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z2"}], ")"}], "2"]}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"X1", "-", "X3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Y1", "-", "Y3"}], ")"}], "2"], "+", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"Z1", "-", "Z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
           SqrtBox[
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "X1"}], "+", "X3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Y1"}], "+", "Y3"}], ")"}], "2"], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Z1"}], "+", "Z3"}], ")"}], "2"]}]]}]}], ")"}], 
        "/", 
        RowBox[{"(", 
         RowBox[{
          SqrtBox[
           RowBox[{"1", "-", 
            FractionBox[
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox["x1", "2"], "+", 
                RowBox[{"x2", " ", "x3"}], "-", 
                RowBox[{"x1", " ", 
                 RowBox[{"(", 
                  RowBox[{"x2", "+", "x3"}], ")"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}]}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}]}]}], ")"}], "2"], 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y2"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z2"}], ")"}], "2"]}], ")"}], " ", 
              RowBox[{"(", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x1", "-", "x3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"y1", "-", "y3"}], ")"}], "2"], "+", 
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"z1", "-", "z3"}], ")"}], "2"]}], ")"}]}]]}]], " ", 
          
          SqrtBox[
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "x1"}], "+", "x3"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "y1"}], "+", "y3"}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "z1"}], "+", "z3"}], ")"}], "2"]}]]}], ")"}]}]}], 
      ")"}], "2"], " ", "\[Nu]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7093]:=",ExpressionUUID->"2df2e8ac-6715-419b-b5cd-63a7ffa6face"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["private rigidity functions", "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],

Cell[CellGroupData[{

Cell["numericExpressionQ[]", "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
   "does", " ", "an", " ", "expression", " ", "evaluate", " ", "to", " ", "a",
     " ", "real", " ", "number", " ", "if", " ", "the", " ", "vertex", " ", 
    "positions", " ", "or", " ", "displacements", " ", "are", " ", 
    RowBox[{"set", "?"}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"numericExpressionQ", "[", 
    RowBox[{"positions_", ",", " ", "expression_"}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reducedExpression", " ", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], "[", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"expression", " ", "/.", " ", 
            RowBox[{"Dispatch", "@", 
             RowBox[{"PositionRules", "[", " ", 
              RowBox[{"N", "[", "positions", "]"}], " ", "]"}]}]}], " ", "/.",
            " ", 
           RowBox[{
            RowBox[{"VertexDisplacement", "[", 
             RowBox[{"_", ",", "_"}], "]"}], "\[Rule]", "0.001"}]}], "}"}], 
         " ", "]"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"NumericQ", "[", "reducedExpression", "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{"Im", "[", "reducedExpression", "]"}], "]"}], "\[Equal]", 
       "0"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7094]:=",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],

Cell[CellGroupData[{

Cell["constraintVector[], reduceConstraintToOrder[]", "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"constraintVector", "[", " ", 
      RowBox[{
       RowBox[{"arbitrary", " ", "positions"}], ",", " ", "constraints"}], 
      " ", "]"}], " ", "takes", " ", "arbitrary", " ", "constraints"}], ",", 
    " ", 
    RowBox[{
    "written", " ", "as", " ", "equations", " ", "or", " ", "in", " ", "some",
      " ", "other", " ", "form"}], ",", "\n", 
    RowBox[{"parses", " ", "them"}], ",", " ", 
    RowBox[{
    "and", " ", "returns", " ", "a", " ", "standard", " ", "vector", " ", 
     "map", " ", "from", " ", "positions", " ", "to", " ", "a", " ", 
     RowBox[{"\"\<constraint space\>\"", "."}]}]}], "\n", "*)"}], "\n", "\n", 
  
  RowBox[{
   RowBox[{
    RowBox[{"equationToExpressionParser", "[", "positions_", "]"}], " ", ":=",
     " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"None", " ", "->", " ", "Nothing"}], ",", "\[IndentingNewLine]",
       "\t", 
      RowBox[{"a_And", ":>", 
       RowBox[{"List", "@@", "a"}]}], ",", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Equal", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], ":>", 
       RowBox[{"a", "-", "b"}]}], ",", "\[IndentingNewLine]", "\t", 
      RowBox[{
       RowBox[{"Equal", "[", 
        RowBox[{"a_", ",", "b__"}], "]"}], ":>", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"a", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"{", "b", "}"}], "]"}]}], "]"}], "-", 
        RowBox[{"{", "b", "}"}]}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"a_", "?", "PeriodicIdentificationDataQ"}], " ", ":>", " ", 
       RowBox[{"a", "[", "\"\<Constraints\>\"", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"EuclideanMotionConstraints", "[", "a_", "]"}], " ", ":>", " ", 
       RowBox[{"EuclideanMotionConstraints", "[", 
        RowBox[{"positions", ",", "a"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"PeriodicIdentification", "[", " ", "a_", " ", "]"}], " ", ":>",
        " ", 
       RowBox[{
        RowBox[{"PeriodicIdentification", "[", 
         RowBox[{"positions", ",", "a"}], "]"}], "[", "\"\<Constraints\>\"", 
        "]"}]}]}], "\n", "}"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"get", " ", "a", " ", "set", " ", "of", " ", "user"}], "-", 
     RowBox[{
     "specified", " ", "constraints", " ", "into", " ", "the", " ", "form", 
      " ", "of", " ", "a", " ", "vector", " ", "equal", " ", "to", " ", 
      "zero", " ", "when", " ", "constraints", " ", "are", " ", 
      "satisfied"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"constraintVector", "[", 
     RowBox[{"positions_", ",", " ", "None"}], "]"}], ":=", 
    RowBox[{"{", "}"}]}], "\n", 
   RowBox[{
    RowBox[{"constraintVector", "[", 
     RowBox[{"positions_", ",", " ", "constraints_"}], "]"}], ":=", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"equations", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"{", "constraints", "}"}], " ", "//.", " ", 
           RowBox[{"equationToExpressionParser", "[", "positions", "]"}]}], 
          "]"}]}], ",", "\n", 
        RowBox[{"dimensions", "=", 
         RowBox[{"Dimensions", "[", "positions", "]"}]}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"equations", " ", "/.", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{"DisplacementRules", "[", " ", 
         RowBox[{
          RowBox[{"VertexPosition", "[", " ", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
            RowBox[{"All", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], " ", "]"}], " ", "-", 
          " ", "positions"}], "]"}], "]"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7095]:=",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", " ", 
     RowBox[{
      RowBox[{"actual", " ", "positions"}], ",", " ", "constraintMap", ",", 
      " ", "order"}], " ", "]"}], " ", "changes", " ", "the", " ", "order", 
    " ", "of", " ", "the", " ", "constraint", " ", "map", " ", "produced", 
    " ", "by", " ", 
    RowBox[{
     RowBox[{"constraintVector", "[", "]"}], "."}]}], "\n", "*)"}], "\n", 
  "\n", 
  RowBox[{"(*", 
   RowBox[{
   "express", " ", "the", " ", "constraints", " ", "to", " ", "be", " ", 
    "valid", " ", "at", " ", "a", " ", "certain", " ", "order"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"actualpositions_", ",", "constraintVector_", ",", 
      RowBox[{"order_Integer", "?", "Positive"}]}], "]"}], ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"dimensions", "=", 
         RowBox[{"Dimensions", "[", "actualpositions", "]"}]}], ",", "\n", 
        "expandedExpression", ",", "x"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"expandedExpression", " ", "=", " ", 
        RowBox[{"constraintVector", " ", "/.", " ", 
         RowBox[{"Dispatch", "[", " ", 
          RowBox[{"PositionRules", "[", " ", 
           RowBox[{"actualpositions", " ", "+", " ", 
            RowBox[{"x", " ", 
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{
               RowBox[{"Range", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
               RowBox[{"All", "[", 
                RowBox[{"dimensions", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}]}], "]"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Total", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"expandedExpression", ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "#"}], "}"}]}], "]"}], "/", 
            RowBox[{"Factorial", "[", "#", "]"}]}], "&"}], " ", "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "order"}], "]"}]}], " ", "/.", " ", 
         RowBox[{"x", "\[Rule]", "0"}]}], "]"}]}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{
     "actualpositions_", ",", " ", "constraintVector_", ",", " ", 
      "Infinity"}], "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"dimensions", "=", 
        RowBox[{"Dimensions", "[", "actualpositions", "]"}]}], "\n", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"constraintVector", " ", "/.", " ", 
       RowBox[{"Dispatch", "[", " ", 
        RowBox[{"PositionRules", "[", " ", 
         RowBox[{"actualpositions", " ", "+", " ", 
          RowBox[{"VertexDisplacement", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
            RowBox[{"All", "[", 
             RowBox[{"dimensions", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"reduceConstraintToOrder", "[", 
     RowBox[{"actualpositions_", ",", "constraintVector_", ",", "_"}], "]"}], 
    " ", ":=", " ", 
    RowBox[{"constraintVector", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"PositionRules", "[", " ", "actualpositions", " ", "]"}], 
      "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7098]:=",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],

Cell[CellGroupData[{

Cell["solveLinearEquations[], processConstraintEquations[]", "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"solveLinearEquations", "[", 
     RowBox[{
      RowBox[{"constraint", " ", "map"}], " ", ",", " ", "variables"}], " ", 
     "]"}], " ", "solves", " ", "the", " ", "linear", " ", "constraints", " ",
     "from", " ", "constraint", " ", "map", " ", 
    RowBox[{"explicitly", "."}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Fastest", " ", "way", " ", "to", " ", "pull", " ", "out", " ", 
    "equations", " ", "that", " ", "are", " ", "definitely", " ", "linear", 
    " ", "and", " ", "can", " ", "be", " ", "solved", " ", "explicitly"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"linearEquationQ", "[", 
     RowBox[{"eq_", ",", "var_"}], "]"}], ":=", 
    RowBox[{"VectorQ", "[", 
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{"eq", ",", 
        RowBox[{"{", "var", "}"}]}], "]"}], ",", "NumericQ"}], "]"}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"given", " ", "a", " ", "set", " ", "constraints"}], ",", " ", 
     RowBox[{
     "select", " ", "out", " ", "the", " ", "linear", " ", "ones", " ", "and",
       " ", "solve", " ", 
      RowBox[{"them", "."}]}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"solveLinearEquations", "[", 
     RowBox[{"constraintVec_", ",", " ", "var_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "soln", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Quiet", "[", " ", 
        RowBox[{"soln", " ", "=", " ", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Select", "[", " ", 
             RowBox[{"constraintVec", ",", " ", 
              RowBox[{
               RowBox[{"linearEquationQ", "[", 
                RowBox[{"#", ",", " ", "var"}], "]"}], "&"}]}], " ", "]"}], 
            " ", "\[Equal]", " ", "0"}], ",", " ", "var"}], " ", "]"}]}], " ",
         "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "soln", "]"}], " ", "=!=", " ", "Solve"}], ",",
          " ", 
         RowBox[{"soln", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"{", "}"}]}], " ", "]"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7101]:=",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"processConstraintEquations", "[", " ", 
       RowBox[{
        RowBox[{"arbitrary", " ", "positions"}], ",", " ", 
        RowBox[{"constraint", " ", "map"}]}], " ", "]"}], " ", "decomposes", 
      " ", "a", " ", "constraint", " ", "vector", " ", "in", " ", "these", 
      " ", 
      RowBox[{"parts", ":", "\n", "\t\t", "\"\<additional variables\>\""}]}], 
     " ", "->", " ", 
     RowBox[{
     "a", " ", "list", " ", "of", " ", "additional", " ", "variables", " ", 
      "that", " ", 
      RowBox[{"aren", "'"}], "t", " ", "specified", " ", "that", " ", "might",
       " ", "muck", " ", "things", " ", "up", " ", "for", " ", "some", " ", 
      "functions"}]}], ",", "\n", "\t\t", 
    RowBox[{"\"\<linear solutions\>\"", " ", "->", " ", 
     RowBox[{"{", " ", 
      RowBox[{
      "rules", " ", "that", " ", "solve", " ", "any", " ", "simple", " ", 
       "linear", " ", "constraints"}], " ", "}"}]}], ",", "\n", "\t\t", 
    RowBox[{"\"\<constrained positions\>\"", " ", "->", " ", 
     RowBox[{
     "positions", " ", "that", " ", "satisfy", " ", "the", " ", "linear", " ",
       "constraints"}]}], ",", "\n", "\t\t", 
    RowBox[{"\"\<nonlinear constraints\>\"", " ", "->", " ", 
     RowBox[{
     "any", " ", "nonlinear", " ", "constraints", " ", "that", " ", "remain", 
      " ", "after", " ", "removing", " ", "linear", " ", "constraints"}]}], 
    ",", "\n", "\t\t", 
    RowBox[{"\"\<inequalities\>\"", " ", "->", " ", 
     RowBox[{
     "any", " ", "inequalities", " ", "that", " ", "are", " ", "left", " ", 
      "over", " ", "after", " ", "removing", " ", "linear", " ", 
      "constraints"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"processConstraintEquations", "[", 
     RowBox[{"arbitraryPositions_", ",", " ", "constraintEq_"}], "]"}], " ", ":=",
     " ", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"constraints", " ", "=", " ", 
         RowBox[{"constraintVector", "[", " ", 
          RowBox[{"arbitraryPositions", ",", " ", "constraintEq"}], " ", 
          "]"}]}], ",", "\n", "\t", 
        RowBox[{"vars", " ", "=", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"Array", "[", " ", 
           RowBox[{"VertexPosition", ",", " ", 
            RowBox[{"Dimensions", "[", "arbitraryPositions", "]"}]}], " ", 
           "]"}]}]}], ",", "\n", "\t", "equalityConstraints", ",", "\n", "\t",
         "linearEquationSelector", ",", "\n", "\t", "solvedLinearConstraints",
         ",", " ", "processedSolvedLinearConstraints", ",", "\n", "\t", 
        "constrainedPositions", ",", "\n", "\t", "inequalities", ",", " ", 
        "inequalitySelector"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"inequalitySelector", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], ",", 
            RowBox[{
            "Less", "|", "Greater", "|", "LessEqual", "|", "GreaterEqual", 
             "|", "Inequality"}]}], "]"}], "&"}], " ", "/@", " ", 
         "constraints"}]}], ";", "\n", "\t", 
       RowBox[{"inequalities", " ", "=", " ", 
        RowBox[{"Pick", "[", 
         RowBox[{"constraints", " ", ",", " ", "inequalitySelector"}], " ", 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"equalityConstraints", " ", "=", " ", 
        RowBox[{"Pick", "[", 
         RowBox[{
         "constraints", ",", " ", "inequalitySelector", ",", " ", "False"}], 
         " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "find", " ", "and", " ", "solve", " ", "the", " ", "linear", " ", 
         "equations"}], "*)"}], "\n", "\t", 
       RowBox[{"linearEquationSelector", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"linearEquationQ", "[", 
           RowBox[{"#", ",", " ", "vars"}], "]"}], "&"}], " ", "/@", " ", 
         "equalityConstraints"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"solvedLinearConstraints", " ", "=", " ", 
        RowBox[{"Quiet", "[", " ", "\n", "\t\t", 
         RowBox[{"Solve", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Pick", "[", " ", 
             RowBox[{
             "equalityConstraints", ",", " ", "linearEquationSelector"}], " ",
              "]"}], " ", "\[Equal]", " ", "0"}], ",", " ", "vars"}], " ", 
          "]"}], "\n", "\t", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "solvedLinearConstraints", "]"}], " ", "==", 
          " ", "0"}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MechanismLinearConstraints", "::", "const"}], ",", "  ", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Pick", "[", " ", 
              RowBox[{
              "equalityConstraints", ",", " ", "linearEquationSelector"}], 
              " ", "]"}], "==", "0"}], "]"}]}], " ", "]"}]}], "]"}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "solvedLinearConstraints", "]"}], " ", "===", 
           " ", "Solve"}], " ", "||", " ", 
          RowBox[{
           RowBox[{"Length", "[", "solvedLinearConstraints", "]"}], "==", 
           "0"}]}], ",", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "no", " ", "solutions", " ", "exist", " ", "or", " ", "could", " ", 
           "be", " ", "found"}], "*)"}], "\n", "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"\"\<additional variables\>\"", " ", "->", " ", 
            RowBox[{"Sort", " ", "@", " ", 
             RowBox[{"DeleteDuplicates", " ", "@", " ", 
              RowBox[{"DeleteCases", "[", " ", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"equalityConstraints", ",", " ", 
                  RowBox[{"_Symbol", "|", 
                   RowBox[{"_Symbol", "[", "_", "]"}]}], ",", " ", 
                  "Infinity"}], "]"}], ",", " ", 
                RowBox[{"_VertexPosition", "|", "_VertexDisplacement"}]}], 
               " ", "]"}]}]}]}], ",", "\n", "\t\t\t", 
           RowBox[{"\"\<linear solutions\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", " ", "\n", "\t\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"(", 
             RowBox[{"constrainedPositions", " ", "=", " ", 
              RowBox[{"Array", "[", 
               RowBox[{"VertexPosition", ",", " ", 
                RowBox[{"Dimensions", "[", "arbitraryPositions", "]"}]}], " ",
                "]"}]}], ")"}]}], ",", "\n", "\t\t\t", 
           RowBox[{"\"\<variables\>\"", " ", "->", " ", 
            RowBox[{"Flatten", "[", " ", "constrainedPositions", " ", "]"}]}],
            ",", "\n", "\t\t\t", 
           RowBox[{"\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Pick", "[", " ", 
             RowBox[{"equalityConstraints", " ", ",", " ", 
              RowBox[{"Not", " ", "/@", " ", 
               RowBox[{
               "PossibleZeroQ", " ", "/@", " ", "equalityConstraints"}]}]}], 
             " ", "]"}]}], ",", "\n", "\t\t\t", 
           RowBox[{"\"\<inequalities\>\"", " ", "->", " ", "inequalities"}]}],
           "\n", "\t\t", "]"}], ",", "\n", "\t", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"some", " ", "solutions", " ", "were", " ", "found"}], 
          "*)"}], "\n", "\t\t", 
         RowBox[{"Association", "[", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{
           "make", " ", "note", " ", "of", " ", "any", " ", "variables", " ", 
            "that", " ", "are", " ", "not", " ", "position", " ", "or", " ", 
            "displacement", " ", "variables"}], "*)"}], "\n", "\t\t", 
          RowBox[{
           RowBox[{"\"\<additional variables\>\"", " ", "->", " ", 
            RowBox[{"Sort", " ", "@", " ", 
             RowBox[{"DeleteDuplicates", " ", "@", " ", 
              RowBox[{"DeleteCases", "[", " ", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{"equalityConstraints", ",", " ", 
                  RowBox[{"_Symbol", "|", 
                   RowBox[{"_Symbol", "[", "_", "]"}]}], ",", " ", 
                  "Infinity"}], "]"}], ",", " ", 
                RowBox[{"_VertexPosition", "|", "_VertexDisplacement"}]}], 
               " ", "]"}]}]}]}], ",", "\n", "\t\t", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "rules", " ", "that", " ", "solve", " ", "the", " ", "linear", 
             " ", "constraints"}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<linear solutions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"First", "[", "solvedLinearConstraints", "]"}]}], ",", 
           "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "positions", " ", "with", " ", "linear", " ", "solutions", " ", 
             "applied"}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<constrained positions\>\"", " ", "\[Rule]", " ", 
            RowBox[{"(", " ", 
             RowBox[{"constrainedPositions", " ", "=", " ", 
              RowBox[{
               RowBox[{"Array", "[", 
                RowBox[{"VertexPosition", ",", " ", 
                 RowBox[{"Dimensions", "[", "arbitraryPositions", "]"}]}], 
                "]"}], " ", "/.", " ", 
               RowBox[{"Dispatch", "[", 
                RowBox[{"First", "[", "solvedLinearConstraints", "]"}], 
                "]"}]}]}], " ", ")"}]}], ",", "\n", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{
            "any", " ", "unfixed", " ", "vertex", " ", "position", " ", 
             "variables"}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<variables\>\"", " ", "->", " ", 
            RowBox[{"DeleteDuplicates", "[", " ", 
             RowBox[{"Cases", "[", " ", 
              RowBox[{
              "constrainedPositions", " ", ",", " ", "_VertexPosition", " ", 
               ",", " ", "Infinity"}], "]"}], " ", "]"}]}], ",", "\n", "\n", 
           "\t\t", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"remaining", " ", "nontrivial"}], ",", " ", 
             RowBox[{
             "nonlinear", " ", "constraints", " ", "with", " ", "linear", " ",
               "solutions", " ", "applied"}]}], "*)"}], "\n", "\t\t", 
           RowBox[{"\"\<nonlinear constraints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"Select", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"Pick", "[", " ", 
                RowBox[{
                "equalityConstraints", " ", ",", " ", 
                 "linearEquationSelector", ",", " ", "False"}], " ", "]"}], 
               " ", "/.", " ", 
               RowBox[{"First", "[", "solvedLinearConstraints", "]"}]}], " ", 
              ",", " ", 
              RowBox[{
               RowBox[{"Not", "[", 
                RowBox[{"PossibleZeroQ", "[", "#", "]"}], "]"}], "&"}]}], " ",
              "]"}]}], ",", "\n", "\t\t", "\n", "\t\t", 
           RowBox[{
            RowBox[{"\"\<inequalities\>\"", " ", "->", " ", "inequalities"}], 
            " ", "/.", " ", 
            RowBox[{"First", "[", "solvedLinearConstraints", "]"}]}]}], "\n", 
          "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismLinearConstraints", "::", "const"}], "=", 
     "\"\<Linear constraints `1` cannot be solved.\>\""}], ";"}]}]}]], "Code",\

 CellLabel->
  "1/2/24 10:12:06 \
In[7103]:=",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"]
}, Closed]],

Cell[CellGroupData[{

Cell["cellData[]", "Subsection",ExpressionUUID->"77f46617-66e3-461f-ace6-d24f48398263"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"fill", " ", "in", " ", "the", " ", "defaults"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"automaticCellData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", ",", " ", "_", ",", " ", "_"}], 
     "]"}], " ", ":=", " ", "None"}], "\n", 
   RowBox[{
    RowBox[{"dataParsingRules", "[", " ", 
     RowBox[{"_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", "}"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7105]:=",ExpressionUUID->"5527ee5a-7e2e-4a8b-87d2-57419740046d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"cellData", "[", 
     RowBox[{"m", " ", ",", " ", "positions", ",", " ", 
      RowBox[{"cell", " ", "specification"}], ",", " ", 
      RowBox[{"data", " ", "selector"}]}], "]"}], "\n", "\n", "returns", " ", 
    "a", " ", "list", " ", "of", " ", "mechanism", " ", "cells", " ", "that", 
    " ", "match", " ", "a", " ", "certain", " ", "cell", " ", "specification",
     " ", "and", " ", "whose", " ", "data", " ", "matches", " ", "the", " ", 
    "pattern", " ", "in", " ", "data", " ", 
    RowBox[{"selector", ".", "\n", "Any"}], " ", "Automatic", " ", "entries", 
    " ", "are", " ", "replaced", " ", "with", " ", "their", " ", "actual", 
    " ", "values", " ", "based", " ", "on", " ", "the", " ", "positions", " ", 
    RowBox[{"provided", ".", "\n", "\n", "e", ".", "g", ".", " ", 
     RowBox[{"cellData", "[", 
      RowBox[{"m", ",", " ", "positions", ",", " ", "_RigidBar", ",", " ", 
       RowBox[{"\"\<Stiffness\>\"", "->", "Infinity"}]}], "]"}]}], " ", 
    "will", " ", "return", " ", "only", " ", "RigidBar", " ", "cells", " ", 
    "with", " ", "infinite", " ", 
    RowBox[{"stiffness", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"cellData", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "cellSpec_", " ", ",", " ", 
     RowBox[{"data_", " ", ":", " ", "None"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"cells", " ", "=", " ", 
        RowBox[{"Mechanisms`Private`mechanismCellList", "[", 
         RowBox[{
         "\"\<Unthreaded\>\"", ",", " ", "m", ",", " ", "cellSpec", ",", " ", 
          "data", ",", " ", "_"}], "]"}]}], ",", "\n", "\t", "activeCells", 
       ",", " ", "inactiveCells"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "cells", "]"}], " ", "=!=", " ", "List"}], ",", 
       "\n", "\t\t", 
       RowBox[{"{", "}"}], ",", "\n", "\t", "\n", "\t\t", 
       RowBox[{
        RowBox[{"activeCells", " ", "=", " ", 
         RowBox[{"Cases", "[", 
          RowBox[{"cells", ",", "_Rule"}], "]"}]}], ";", "\n", "\t\t", 
        RowBox[{"inactiveCells", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"cells", ",", "_Rule"}], "]"}]}], ";", "\n", "\t", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"replaceAutomaticEntries", "[", 
           RowBox[{"m", ",", " ", "positions", ",", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "&"}], " ", "/@", " ", 
         "activeCells"}]}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7107]:=",ExpressionUUID->"f5b720ce-52ab-4a80-8600-f3d0c95aa648"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{"replaceAutomaticEntries", "[", "  ", 
    RowBox[{
    "mechanism", " ", ",", " ", "positions", ",", " ", "cell", " ", ",", " ", 
     "dataRules"}], " ", "]"}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"replaceAutomaticEntries", "[", " ", 
     RowBox[{
     "m_", ",", " ", "positions_", ",", " ", "cell_", " ", ",", " ", 
      "dataRules_"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"cell", " ", "->", " ", 
     RowBox[{"Association", " ", "@@", " ", 
      RowBox[{"(", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"replaceAutomaticEntriesWithinData", "[", " ", 
           RowBox[{
           "m", ",", " ", "positions", ",", " ", "cell", " ", ",", " ", "#"}],
            " ", "]"}], "&"}], " ", ",", " ", "dataRules"}], " ", "]"}], 
       ")"}]}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"replaceAutomaticEntriesWithinData", "[", " ", 
     RowBox[{"m_", ",", " ", "positions_", ",", " ", 
      RowBox[{"head_", "[", "indices_", "]"}], " ", ",", " ", 
      RowBox[{"dataType_", " ", "->", " ", "entries_"}]}], " ", "]"}], " ", ":=",
     " ", "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"automaticCells", ",", " ", "newData", ",", " ", 
        RowBox[{"newEntries", " ", "=", " ", 
         RowBox[{"entries", " ", "/.", " ", 
          RowBox[{"dataParsingRules", "[", 
           RowBox[{"head", " ", ",", " ", "dataType"}], "]"}]}]}]}], " ", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"automaticCells", " ", "=", " ", 
        RowBox[{"Position", "[", " ", 
         RowBox[{"newEntries", ",", " ", "Automatic", " ", ",", " ", "1"}], 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"newData", " ", "=", " ", 
        RowBox[{"automaticCellData", "[", " ", 
         RowBox[{"m", ",", " ", "positions", " ", ",", 
          RowBox[{"head", "[", " ", 
           RowBox[{"Extract", "[", 
            RowBox[{"indices", ",", " ", "automaticCells"}], "]"}], " ", 
           "]"}], " ", ",", " ", "dataType"}], " ", "]"}]}], ";", "\n", "\t", 
       "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"ListQ", "[", "newData", "]"}], " ", ",", " ", 
         RowBox[{"dataType", " ", "->", " ", 
          RowBox[{"ReplacePart", "[", " ", 
           RowBox[{"newEntries", " ", ",", " ", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"Flatten", "[", "automaticCells", "]"}], " ", "->", " ",
               "newData"}], " ", "]"}]}], " ", "]"}]}], " ", ",", " ", 
         RowBox[{"dataType", " ", "->", " ", "newEntries"}]}], " ", "]"}]}]}],
      "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7108]:=",ExpressionUUID->"8680d826-b964-4c9b-9b43-e06c0619f39c"]
}, Closed]],

Cell[CellGroupData[{

Cell["constraintEquations[]", "Subsection",ExpressionUUID->"70f3d70c-5d2e-460e-a603-69c4f0006862"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"constraintEquations", "[", " ", 
     RowBox[{"m", ",", " ", "positions", ",", " ", "pattern", ",", " ", 
      RowBox[{"additional", " ", "constraints"}]}], "]"}], " ", "\n", "\t", 
    "computes", " ", "a", " ", "set", " ", "of", " ", "constraint", " ", 
    "equations", " ", 
    RowBox[{"(", 
     RowBox[{
     "based", " ", "on", " ", "mechanism", " ", "m", " ", "with", " ", 
      "vertices", " ", "at", " ", "position"}], ")"}], " ", "for", " ", "any",
     "\n", "\t", "constrained", " ", "cells", " ", "that", " ", "match", " ", 
    
    RowBox[{"pattern", ".", " ", "It"}], " ", "removes", " ", "cells", " ", 
    "that", " ", "are", " ", 
    RowBox[{"elastic", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"constraintEquations", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "positions_", " ", ",", " ", "pattern_", " ", ",", 
     " ", "constraints_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "get", " ", "cell", " ", "data", " ", "based", " ", "on", " ", "the", 
        " ", "mechanism"}], "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"cellData", "[", 
         RowBox[{
         "m", ",", " ", "positions", ",", " ", "pattern", ",", " ", 
          "$constrainedCellData"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"arbitraryPositions", " ", "=", " ", 
        RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", "\n", "\t", 
       RowBox[{"addedConstraints", " ", "=", " ", 
        RowBox[{"OptionValue", "[", 
         RowBox[{"m", ",", " ", "Constraints"}], "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
     "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", " ", 
      RowBox[{
       RowBox[{"PlaceVertices", "[", 
        RowBox[{"m", ",", " ", "positions"}], "]"}], " ", ",", "\n", "\t\t", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"cellConstraints", "[", 
             RowBox[{
             "m", " ", ",", "  ", "positions", ",", " ", "arbitraryPositions",
               " ", ",", " ", "#"}], "]"}], "&"}], " ", "/@", " ", "data"}], 
          ",", "\n", "\t\t\t", 
          RowBox[{"(*", 
           RowBox[{
           "add", " ", "in", " ", "additional", " ", "specified", " ", 
            "constraints"}], "*)"}], "\n", "\t\t\t", 
          RowBox[{"constraintVector", "[", " ", 
           RowBox[{"positions", ",", " ", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"addedConstraints", ",", " ", "constraints"}], "}"}], 
             "]"}]}], " ", "]"}]}], "\n", "\t\t", "}"}], "]"}]}], "\n", "\t", 
      "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7110]:=",ExpressionUUID->"305f9a8d-4023-4f8f-b5b0-0f442b82bc09"]
}, Closed]],

Cell[CellGroupData[{

Cell["standardVariableNames[]", "Subsection",ExpressionUUID->"270d75fd-0d5f-4e6a-9691-665d4b2a30bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "returns", " ", "a", " ", "set", " ", "of", " ", "unique", " ", "standard",
     " ", "variable", " ", "names", " ", "for", " ", "functions", " ", "that",
     " ", "need", " ", "them"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"standardVariableNames", "[", " ", "m_", " ", "]"}], " ", ":=", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "c", ",", " ", 
       RowBox[{"beginning", " ", "=", " ", 
        RowBox[{"Unique", "[", "\"\<m\>\"", "]"}]}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"VertexPosition", "[", 
          RowBox[{"n_", ",", "c_"}], "]"}], " ", ":>", " ", 
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"ToString", "[", "beginning", "]"}], " ", "<>", " ", 
           "\"\<$\>\"", " ", "<>", " ", "c", " ", "<>", " ", 
           RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}]}], ",", "\n", "\t", 
       
       RowBox[{
        RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"VertexPosition", "[", 
          RowBox[{"n_", ",", "c_"}], "]"}], " ", ":>", " ", 
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"ToString", "[", "beginning", "]"}], " ", "<>", " ", 
           "\"\<$p\>\"", " ", "<>", " ", "c", " ", "<>", " ", 
           RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}]}]}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7111]:=",ExpressionUUID->"76b0ea52-787c-421a-b810-34b1cd656b62"]
}, Closed]],

Cell[CellGroupData[{

Cell["renameVertexVariables[]", "Subsection",ExpressionUUID->"4188b88c-e41a-43eb-b5cf-0ce93e9cdf86"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"renameVertexVariables", "[", "]"}], "\n", "\n", "use", " ", 
    "the", " ", "list", " ", "of", " ", "variables", " ", "in", " ", 
    "variableName", " ", "to", " ", "rename", " ", 
    RowBox[{"VertexPosition", "'"}], "s", " ", "in", " ", "expression"}], 
   "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"renameVertexVariables", "[", " ", 
     RowBox[{
      RowBox[{"variableName_", "?", "MatrixQ"}], " ", ",", " ", 
      "expression_"}], "]"}], " ", ":=", " ", "\n", "\t", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v", ",", "n", ",", "c"}], "}"}], ",", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"expression", " ", "/.", " ", 
          RowBox[{
           RowBox[{"VertexPosition", "[", 
            RowBox[{"n_", ",", "c_"}], "]"}], " ", ":>", " ", 
           RowBox[{"v", "[", 
            RowBox[{"n", ",", "c"}], "]"}]}]}], " ", "/.", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<x\>\"", "->", "1"}], ",", 
           RowBox[{"\"\<y\>\"", "->", "2"}], ",", 
           RowBox[{"\"\<z\>\"", "->", "3"}]}], "}"}]}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"n_", ",", "c_"}], "]"}], " ", ":>", " ", 
         RowBox[{"variableName", "[", 
          RowBox[{"[", 
           RowBox[{"n", ",", " ", "c"}], " ", "]"}], "]"}]}]}]}], "\n", "\t", 
      "]"}], " ", "/;", " ", 
     RowBox[{"largestVertexPositionQ", "[", " ", 
      RowBox[{"expression", " ", ",", "  ", 
       RowBox[{"Dimensions", "[", "variableName", "]"}]}], " ", "]"}]}]}], 
   "\n", 
   RowBox[{
    RowBox[{"renameVertexVariables", "[", " ", 
     RowBox[{"variableName_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", 
    " ", "$Failed"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7112]:=",ExpressionUUID->"e91ab3d8-33a6-4196-9baf-e7ed0fb667d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"largestVertexPosition", "[", " ", "expression_", " ", "]"}], " ", ":=",
   " ", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"positionVariables", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{
       "expression", ",", " ", "_VertexPosition", ",", " ", "Infinity"}], 
       "]"}]}], "}"}], ",", "\n", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Max", "[", " ", 
       RowBox[{"positionVariables", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", "\n", "\t", 
      RowBox[{"Max", "[", " ", 
       RowBox[{
        RowBox[{"positionVariables", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", "/.", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<x\>\"", "->", "1"}], ",", " ", 
          RowBox[{"\"\<y\>\"", "->", "2"}], ",", " ", 
          RowBox[{"\"\<z\>\"", "->", "3"}]}], "}"}]}], " ", "]"}]}], "\n", 
     "}"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7114]:=",ExpressionUUID->"f729c132-b358-4c22-abb6-4c2eee22ef69"],

Cell[BoxData[
 RowBox[{
  RowBox[{"largestVertexPositionQ", "[", " ", 
   RowBox[{"expression_", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"numberVertices_", ",", " ", "dimension_"}], "}"}]}], "]"}], " ",
   ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"d", "=", 
      RowBox[{"largestVertexPosition", "[", "expression", "]"}]}], "}"}], ",",
     "\n", "\t\t", 
    RowBox[{"TrueQ", "[", " ", 
     RowBox[{"And", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "<=", " ", "numberVertices"}], 
       ",", " ", 
       RowBox[{
        RowBox[{"d", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", "<=", " ", "dimension"}]}], 
      "]"}], " ", "]"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7115]:=",ExpressionUUID->"25d7c633-ae40-4117-a403-95976b182b10"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["modifying and creating linkages", "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],

Cell[CellGroupData[{

Cell["RandomCellNetwork[]", "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "RandomCellNetwork", "]"}], " ", "=", " ", 
     RowBox[{"DeleteDuplicatesBy", "[", " ", 
      RowBox[{
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Line", " ", "->", " ", "Spring"}], " ", ",", " ", 
           RowBox[{"Polygon", " ", "->", " ", "None"}]}], " ", "}"}], ",", 
         "\n", "\t\t", 
         RowBox[{"Options", "[", "ToLinkage", "]"}]}], " ", "]"}], ",", " ", 
       "\n", "\t", "First"}], " ", "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", " ", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"RandomCellNetwork", "[", " ", 
     RowBox[{"numPoints", ",", " ", "2", ",", " ", "opt"}], " ", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", "2", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "randomPoints", " ", ",", " ", "expandedCells", " ", ",", " ", 
        "regionTesters", ",", " ", "cells", " ", ",", " ", "i", ",", " ", "j",
         ",", "\n", "\t", 
        RowBox[{"actualOptions", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"Line", "->", 
              RowBox[{"OptionValue", "[", "Line", "]"}]}], ",", "\n", "\t\t", 
             
             RowBox[{"Polygon", "->", 
              RowBox[{"OptionValue", "[", "Polygon", "]"}]}]}], "\n", "\t", 
            "}"}], ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"randomPoints", " ", "=", " ", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"expandedCells", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"VoronoiMesh", "[", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"randomPoints", " ", "+", " ", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "j"}], "}"}], ",", " ", "numPoints"}], 
                 "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "2"}], 
            "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t", "2"}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"ToLinkage", "[", " ", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"expandedCells", ",", 
           RowBox[{
            RowBox[{"Or", " ", "@@", " ", 
             RowBox[{"RegionMember", "[", 
              RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
          "]"}], " ", ",", " ", "actualOptions"}], " ", "]"}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", "3", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "randomPoints", " ", ",", " ", "expandedCells", " ", ",", " ", 
        "regionTesters", ",", " ", "cells", " ", ",", " ", "i", ",", " ", "j",
         ",", " ", "k", ",", "\n", "\t", 
        RowBox[{"actualOptions", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"Line", "->", 
              RowBox[{"OptionValue", "[", "Line", "]"}]}], ",", "\n", "\t\t", 
             
             RowBox[{"Polygon", "->", 
              RowBox[{"OptionValue", "[", "Polygon", "]"}]}]}], "\n", "\t", 
            "}"}], ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"randomPoints", " ", "=", " ", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"numPoints", ",", "3"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"expandedCells", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"VoronoiMesh", "[", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"randomPoints", " ", "+", " ", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", 
                  "numPoints"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "3"}], 
            "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t", "3"}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"regionTesters", " ", "=", " ", 
        RowBox[{"RegionMember", " ", "/@", " ", "expandedCells"}]}], ";", 
       "\n", "\t", 
       RowBox[{"ToLinkage", "[", " ", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"expandedCells", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Or", "@@", 
               RowBox[{"(", 
                RowBox[{"#", "/@", "randomPoints"}], ")"}]}], "&"}], ")"}], 
            " ", "/@", " ", "regionTesters"}]}], "]"}], " ", ",", " ", 
         "actualOptions"}], " ", "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"_Integer", "?", "Positive"}], "]"}]}], ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomCellNetwork", "::", "num"}], ",", " ", "numPoints"}], 
      "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"_Integer", "?", "Positive"}], "]"}]}], ",", " ", "_", ",", 
      " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomCellNetwork", "::", "num"}], ",", " ", "numPoints"}], 
      "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"RandomCellNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"d", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"2", "|", "3"}], "]"}]}], " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomCellNetwork", "::", "dim"}], ",", " ", "d"}], "]"}]}]}],
    "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomCellNetwork", "::", "dim"}], "=", 
     "\"\<Dimension `1` should be either 2 or 3.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomCellNetwork", "::", "num"}], "=", 
     "\"\<Number of points `1` should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7116]:=",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomTriangulatedNetwork[]", "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Build", " ", "a", " ", "periodic", " ", "Voronoi", " ", "mesh", " ", "by",
     " ", "tiling", " ", "the", " ", "vertices", " ", "and", " ", 
    "extracting", " ", "only", " ", "the", " ", "cells", " ", "associated", 
    " ", "with", " ", "the", " ", "original", " ", 
    RowBox[{"vertices", "."}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "RandomTriangulatedNetwork", "]"}], ":=", 
     RowBox[{"DeleteDuplicatesBy", "[", " ", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Line", " ", "->", " ", "Spring"}], " ", ",", " ", 
           RowBox[{"Polygon", " ", "->", " ", "None"}]}], " ", "}"}], ",", 
         " ", 
         RowBox[{"Options", "[", "ToLinkage", "]"}]}], " ", "]"}], ",", " ", 
       "First"}], " ", "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", " ", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"RandomTriangulatedNetwork", "[", " ", 
     RowBox[{"numPoints", ",", " ", "2", ",", " ", "opt"}], " ", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", "2", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "randomPoints", " ", ",", " ", "expandedCells", " ", ",", " ", 
        "regionTesters", ",", " ", "cells", " ", ",", " ", "i", ",", " ", "j",
         ",", "\n", "\t", 
        RowBox[{"actualOptions", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"Line", "->", 
              RowBox[{"OptionValue", "[", "Line", "]"}]}], ",", "\n", "\t\t", 
             
             RowBox[{"Polygon", "->", 
              RowBox[{"OptionValue", "[", "Polygon", "]"}]}]}], "\n", "\t", 
            "}"}], ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"randomPoints", " ", "=", " ", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"numPoints", ",", "2"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"expandedCells", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"DelaunayMesh", "[", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"randomPoints", " ", "+", " ", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "j"}], "}"}], ",", " ", "numPoints"}], 
                 "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "2"}], 
            "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t", "2"}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"ToLinkage", "[", " ", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"expandedCells", ",", 
           RowBox[{
            RowBox[{"Or", " ", "@@", " ", 
             RowBox[{"RegionMember", "[", 
              RowBox[{"#", ",", " ", "randomPoints"}], "]"}]}], "&"}]}], 
          "]"}], " ", ",", " ", "actualOptions"}], " ", "]"}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints_Integer", "?", "Positive"}], ",", " ", "3", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "randomPoints", " ", ",", " ", "expandedCells", " ", ",", " ", 
        "regionTesters", ",", " ", "cells", " ", ",", " ", "i", ",", " ", "j",
         ",", " ", "k", ",", "\n", "\t", 
        RowBox[{"actualOptions", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t", 
            RowBox[{
             RowBox[{"Line", "->", 
              RowBox[{"OptionValue", "[", "Line", "]"}]}], ",", "\n", "\t\t", 
             
             RowBox[{"Polygon", "->", 
              RowBox[{"OptionValue", "[", "Polygon", "]"}]}]}], "\n", "\t", 
            "}"}], ",", " ", 
           RowBox[{"{", "opt", "}"}]}], " ", "]"}]}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"randomPoints", " ", "=", " ", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", "2"}], ",", 
            RowBox[{"1", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"numPoints", ",", "3"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"expandedCells", " ", "=", " ", 
        RowBox[{"MeshPrimitives", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"DelaunayMesh", "[", "\n", "\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"randomPoints", " ", "+", " ", 
                RowBox[{"ConstantArray", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", 
                  "numPoints"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "3"}], 
            "]"}], "\n", "\t\t", "]"}], ",", "\n", "\t", "3"}], "]"}]}], ";", 
       "\n", "\n", "\t", 
       RowBox[{"regionTesters", " ", "=", " ", 
        RowBox[{"RegionMember", " ", "/@", " ", "expandedCells"}]}], ";", 
       "\n", "\t", 
       RowBox[{"ToLinkage", "[", " ", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"expandedCells", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Or", "@@", 
               RowBox[{"(", 
                RowBox[{"#", "/@", "randomPoints"}], ")"}]}], "&"}], ")"}], 
            " ", "/@", " ", "regionTesters"}]}], "]"}], " ", ",", " ", 
         "actualOptions"}], " ", "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"_Integer", "?", "Positive"}], "]"}]}], ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomTriangulatedNetwork", "::", "num"}], ",", " ", 
       "numPoints"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{
      RowBox[{"numPoints", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"_Integer", "?", "Positive"}], "]"}]}], ",", " ", "_", ",", 
      " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomTriangulatedNetwork", "::", "num"}], ",", " ", 
       "numPoints"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"RandomTriangulatedNetwork", "[", 
     RowBox[{"numPoints_", ",", " ", 
      RowBox[{"d", " ", ":", " ", 
       RowBox[{"Except", "[", 
        RowBox[{"2", "|", "3"}], "]"}]}], " ", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], ":=", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomTriangulatedNetwork", "::", "dim"}], ",", " ", "d"}], 
      "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomTriangulatedNetwork", "::", "dim"}], "=", 
     "\"\<Dimension `1` should be either 2 or 3.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomTriangulatedNetwork", "::", "num"}], "=", 
     "\"\<Number of points `1` should be a positive integer.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7125]:=",ExpressionUUID->"83555aa8-c0b7-4026-bbef-e23322bf20d9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Henneberg", "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"In", " ", "d", " ", "dimensions"}], ",", " ", 
    RowBox[{
    "a", " ", "type", " ", "1", " ", "Henneberg", " ", "move", " ", "adds", 
     " ", "a", " ", "free", " ", "vertex", " ", "and", " ", "joins", " ", 
     "it", " ", "to", " ", "d", " ", "other", " ", 
     RowBox[{"vertices", "."}]}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "1", "]"}], "[", 
      RowBox[{
       RowBox[{"n_", "?", "VectorQ"}], ",", " ", 
       RowBox[{"label_", " ", "\[Rule]", " ", 
        RowBox[{"pos_", "?", "VectorQ"}]}]}], "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"AddCells", "[", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"FreeJoint", "[", 
         RowBox[{"label", " ", "\[Rule]", " ", 
          RowBox[{"PadRight", "[", 
           RowBox[{"pos", ",", " ", 
            RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], "]"}]}],
          " ", "]"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"RigidBar", "[", 
           RowBox[{"{", 
            RowBox[{"#", ",", "label"}], "}"}], "]"}], "&"}], " ", "/@", " ", 
         "n"}]}], " ", "}"}], " ", "]"}], "[", "m", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "1", "]"}], "[", 
      RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"vertices", " ", "=", " ", 
        RowBox[{"RandomSample", "[", " ", 
         RowBox[{
          RowBox[{"Range", "[", " ", 
           RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "]"}], ",", 
          " ", "2"}], " ", "]"}]}], " ", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Henneberg", "[", "1", "]"}], "[", 
        RowBox[{"vertices", ",", " ", 
         RowBox[{
          RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
        "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7134]:=",ExpressionUUID->"91d3ea7e-b367-4d8f-a2e1-b86f413fad70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "A", " ", "type", " ", "2", " ", "Henneberg", " ", "move", " ", 
     "subdivides", " ", "an", " ", "edge"}], ",", " ", 
    RowBox[{"adds", " ", "a", " ", "vertex"}], ",", " ", 
    RowBox[{
    "and", " ", "joins", " ", "the", " ", "new", " ", "vertex", " ", "to", 
     " ", "the", " ", "subdivided", " ", "edge", " ", "and", " ", "two", " ", 
     "other", " ", 
     RowBox[{"vertices", "."}]}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "2", "]"}], "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1_", ",", " ", "n2_", ",", "n3_"}], "}"}], ",", " ", 
       RowBox[{"label_", " ", "\[Rule]", " ", "pos_"}]}], "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"PlaceVertices", "[", 
      RowBox[{"label", " ", "\[Rule]", " ", "pos"}], "]"}], " ", "@", " ", 
     RowBox[{
      RowBox[{"AddCells", "[", 
       RowBox[{"{", 
        RowBox[{"RigidBar", "[", 
         RowBox[{"{", 
          RowBox[{"label", ",", " ", "n3"}], "}"}], "]"}], "}"}], "]"}], " ", 
      "@", " ", 
      RowBox[{
       RowBox[{"SubdivideCells", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], ",", " ", "label"}], " ", "]"}], 
       "[", " ", "m", " ", "]"}]}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "2", "]"}], "[", 
      RowBox[{"pos_", "?", "VectorQ"}], "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"edge", " ", "=", " ", 
        RowBox[{"RandomChoice", "[", " ", 
         RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "]"}]}], " ", "}"}], 
      ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Henneberg", "[", "2", "]"}], "[", 
        RowBox[{
         RowBox[{"Flatten", "[", " ", 
          RowBox[{"{", " ", 
           RowBox[{"edge", ",", " ", 
            RowBox[{"RandomChoice", "[", " ", 
             RowBox[{"Complement", "[", " ", 
              RowBox[{
               RowBox[{"Range", "[", " ", 
                RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "]"}], 
               ",", " ", "edge"}], "]"}], " ", "]"}]}], " ", "}"}], " ", 
          "]"}], ",", " ", 
         RowBox[{
          RowBox[{"Unique", "[", "]"}], " ", "\[Rule]", " ", "pos"}]}], " ", 
        "]"}], "[", "m", "]"}]}], "\n", "\t", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Henneberg", "[", 
      RowBox[{"d", ":", 
       RowBox[{"1", "|", "2"}]}], "]"}], "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "x__"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Henneberg", "[", "d", "]"}], "[", "x", "]"}], "[", "m", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7136]:=",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]],

Cell[CellGroupData[{

Cell["BlockFaces[] ", "Subsection",ExpressionUUID->"4ad8f35c-0c6e-432e-92bd-045a2058c437"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "take", " ", "any", " ", "nontriangular", " ", "face", " ", "and", " ", 
    "add", " ", "two", " ", "vertices", " ", "on", " ", "either", " ", "side",
     " ", "and", " ", "connect", " ", "it", " ", "up", " ", "to", " ", 
    "prevent", " ", "the", " ", "face", " ", "from", " ", 
    RowBox[{"bending", "."}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"faceToBlock", "[", " ", 
     RowBox[{
     "thickness_", ",", " ", "label_", ",", " ", "centroid_", " ", ",", " ", 
      "normal_", " ", ",", " ", "indices_"}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"FreeJoint", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"label", "[", "1", "]"}], " ", "\[Rule]", " ", 
         RowBox[{"(", 
          RowBox[{"centroid", " ", "+", " ", 
           RowBox[{"thickness", " ", "normal"}]}], ")"}]}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Shape\>\"", "\[Rule]", "None"}], ",", 
          "\"\<BlockJoint\>\""}], "}"}]}], "]"}], ",", "\n", "\t", 
      RowBox[{"FreeJoint", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"label", "[", "2", "]"}], " ", "\[Rule]", " ", 
         RowBox[{"(", 
          RowBox[{"centroid", " ", "-", " ", 
           RowBox[{"thickness", " ", "normal"}]}], ")"}]}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<Shape\>\"", "\[Rule]", "None"}], ",", 
          "\"\<BlockJoint\>\""}], "}"}]}], "]"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"RigidBar", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", " ", 
            RowBox[{"label", "[", "1", "]"}]}], "}"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<Shape\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
            "\"\<BlockEdge\>\""}], "}"}]}], " ", "]"}], "&"}], " ", "/@", " ",
        "indices"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"RigidBar", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"#", ",", " ", 
            RowBox[{"label", "[", "2", "]"}]}], "}"}], " ", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<Shape\>\"", " ", "\[Rule]", " ", "None"}], ",", " ", 
            "\"\<BlockEdge\>\""}], "}"}]}], " ", "]"}], "&"}], " ", "/@", " ",
        "indices"}]}], "\n", "}"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"BlockFaces", "[", 
      RowBox[{"thickness", " ", ":", " ", 
       RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
       RowBox[{"1", "/", "10"}]}], "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"faces", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"MechanismFaces", "[", "m", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], ">", "3"}], "&"}]}], "]"}]}], 
       " ", "}"}], ",", " ", 
      RowBox[{
       RowBox[{"BlockFaces", "[", " ", 
        RowBox[{"faces", ",", " ", "thickness"}], " ", "]"}], "[", "m", 
       "]"}]}], " ", "]"}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"BlockFaces", "[", " ", 
      RowBox[{"faces_List", " ", ",", " ", 
       RowBox[{"thickness", " ", ":", " ", 
        RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
        RowBox[{"1", "/", "10"}]}]}], " ", "]"}], "[", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"normals", " ", "=", " ", 
         RowBox[{"NormalVector", "[", " ", 
          RowBox[{"m", " ", ",", " ", "faces", " ", ",", " ", 
           RowBox[{"\"\<Normalize\>\"", " ", "\[Rule]", " ", "False"}]}], 
          "]"}]}], ",", "\n", "\t", 
        RowBox[{"centroids", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "#"}], "]"}], "]"}], "]"}], "&"}], " ", "/@", 
          " ", "faces"}]}], ",", "\n", "\t", 
        RowBox[{"labels", " ", "=", " ", 
         RowBox[{
          RowBox[{"Unique", "[", "]"}], " ", "/@", " ", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "faces", "]"}], "]"}]}]}]}], "\n", "}"}], 
      ",", "\n", "\t", 
      RowBox[{
       RowBox[{"AddCells", "[", " ", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"faceToBlock", "[", " ", 
            RowBox[{
            "thickness", ",", " ", "#1", ",", " ", "#2", ",", " ", "#3", ",", 
             " ", "#4"}], " ", "]"}], "&"}], ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{
           "labels", ",", " ", "centroids", ",", " ", "normals", ",", " ", 
            "faces"}], " ", "}"}]}], " ", "]"}], " ", "]"}], "[", "m", 
       "]"}]}], "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"BlockFaces", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "other___"}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{
     RowBox[{"BlockFaces", "[", " ", "other", " ", "]"}], "[", "m", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7139]:=",ExpressionUUID->"aac3bd51-98d4-4ee4-9066-cb36ede9eb5c"]
}, Closed]],

Cell[CellGroupData[{

Cell["FixMechanism[]", "Subsection",ExpressionUUID->"4f2fe652-6abb-453b-b838-248454e19ddc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"changecelldata", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{
      RowBox[{"head_", "[", " ", "indices_", " ", "]"}], " ", "->", " ", 
      "data_"}]}], " ", "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ChangeCellData", "[", " ", 
        RowBox[{
         RowBox[{"head", "[", " ", "indices", " ", "]"}], ",", " ", "#2"}], 
        "]"}], "@", " ", "#1"}], " ", "&"}], ",", " ", "m", ",", " ", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{"Normal", "@", "data"}], ",", " ", 
       RowBox[{
        RowBox[{"\"\<Shape\>\"", "|", "\"\<Style\>\"", "|", "\"\<Label\>\""}],
         " ", "->", " ", "_"}]}], "]"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FixMechanism", "]"}], " ", "=", " ", 
   RowBox[{"{", " ", 
    RowBox[{"CellPattern", " ", "->", " ", "_"}], " ", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"FixMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
  "\t", 
  RowBox[{"Fold", "[", " ", 
   RowBox[{"changecelldata", " ", ",", " ", "m", ",", " ", 
    RowBox[{"cellData", "[", " ", 
     RowBox[{"m", ",", " ", 
      RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", "  ", 
      RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], " ", "]"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7143]:=",ExpressionUUID->"cba8d015-daea-49ac-9ec0-775db2cc139c"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomDisplacements[], RandomPositions[]", "Subsection",ExpressionUUID->"562e24b5-698b-4ad4-9b73-950bc1b6db48"],

Cell[BoxData[
 RowBox[{
  RowBox[{"randomDisplacements", "[", " ", 
   RowBox[{
   "mask_", " ", ",", " ", "distribution_", " ", ",", " ", "precision_", " ", 
    ",", " ", "numberOfDisplacements_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", "\n", "\t", 
     RowBox[{"randomNumbers", " ", "=", " ", 
      RowBox[{"RandomVariate", "[", " ", 
       RowBox[{"distribution", ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"{", "numberOfDisplacements", "}"}], ",", " ", 
          RowBox[{"Dimensions", "[", "mask", "]"}]}], "]"}], ",", " ", 
        RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", "precision"}]}], " ",
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"MapThread", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"NumericQ", "[", "#1", "]"}], ",", " ", "#1", ",", " ", 
          "#2"}], "]"}], "&"}], " ", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{"mask", ",", " ", "numberOfDisplacements"}], " ", "]"}], 
         ",", " ", "randomNumbers"}], "}"}], ",", " ", "3"}], " ", "]"}], " ",
      "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "randomNumbers", "]"}], " ", "=!=", " ", 
      "RandomVariate"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7146]:=",ExpressionUUID->"82fa6c99-71bd-4c31-82c9-b303fa5e86a5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RandomDisplacements", "]"}], " ", "=", " ", 
    RowBox[{"{", " ", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], " ", ",", " ", "\n", 
      "\t", 
      RowBox[{"Distribution", " ", "->", " ", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], " ", ",", " ", "\n", "\t", 
      RowBox[{"ReduceLinearConstraints", " ", "->", " ", "True"}], ",", " ", 
      "\n", "\t", 
      RowBox[{"WorkingPrecision", " ", "->", " ", "MachinePrecision"}]}], 
     "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"number", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "1"}], ",", "  ", 
     
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"linearConstraints", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], ",", 
          " ", 
          RowBox[{"MechanismLinearConstraints", "[", " ", 
           RowBox[{"m", " ", ",", " ", 
            RowBox[{"Constraints", " ", "->", " ", 
             RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], " ", "]"}],
           " ", ",", " ", 
          RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"randomDisplacements", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
               "linearConstraints"}], ")"}], " ", "-", " ", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], " ", ",",
             "\n", "\t\t", 
            RowBox[{"OptionValue", "[", "Distribution", "]"}], ",", "\n", 
            "\t\t", 
            RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", "\n", 
            "\t\t", "number"}], "\n", "\t ", "]"}]}], "}"}], ",", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"ToPackedArray", "[", " ", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{"number", " ", "==", " ", "1"}], ",", " ", 
            RowBox[{"res", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "res"}], " ", 
           "]"}], " ", "]"}], "  ", "/;", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
           "randomDisplacements"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Head", "[", "linearConstraints", "]"}], " ", "===", " ", 
           "List"}]}]}]}], " ", "\n", "\t ", "]"}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"randomdisplacementArgumentsQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "number", " ", ",", " ", 
      RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], " ", ",", " ", 
      RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}]}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randomdisplacementArgumentsQ", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "number_", " ", ",", " ", "workingprecision_", " ", 
     ",", " ", "reduce_"}], "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"Which", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"IntegerQ", "[", "number", "]"}], "]"}], " ", "||", " ", 
      RowBox[{"number", " ", "<", " ", "0"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomDisplacements", "::", "n"}], ",", " ", "number"}], 
       "]"}], ";", " ", "False"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"workingprecision", " ", "=!=", " ", "MachinePrecision"}], " ", 
      "&&", " ", 
      RowBox[{"Not", "[", " ", 
       RowBox[{"TrueQ", "[", 
        RowBox[{"workingprecision", " ", ">", " ", "0"}], " ", "]"}], "]"}]}],
      ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomDisplacements", "::", "prec"}], ",", " ", 
        "workingprecision"}], "]"}], ";", " ", "False"}], ",", "\n", "\t\t", 
     RowBox[{"Not", "[", 
      RowBox[{"BooleanQ", "[", "reduce", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"RandomDisplacements", "::", "red"}], "]"}], ";", " ", 
      "False"}], ",", "\n", "\t\t", "True", ",", " ", "True"}], "\n", "\t", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "red"}], " ", "=", " ", 
   "\"\<ReduceLinearConstraints must be a Boolean.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "n"}], " ", "=", " ", 
   "\"\<Number of random displacements `1` must be a positive integer.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomDisplacements", "::", "prec"}], " ", "=", " ", 
   "\"\<Working precision `1` should be a positive number of digits of \
precision.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7147]:=",ExpressionUUID->"5bc9cf62-dbb7-40de-b85d-e8dcf9d380df"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RandomPositions", "]"}], " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], " ", ",", " ", 
      RowBox[{"Distribution", " ", "->", " ", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], " ", ",", " ", 
      RowBox[{"ReduceLinearConstraints", " ", "->", " ", "True"}], ",", " ", 
      RowBox[{"WorkingPrecision", " ", "->", " ", "MachinePrecision"}]}], 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"number", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "1"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"linearConstraints", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], ",", 
          " ", 
          RowBox[{"MechanismLinearConstraints", "[", " ", 
           RowBox[{"m", " ", ",", " ", 
            RowBox[{"Constraints", " ", "->", " ", 
             RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], " ", "]"}],
           " ", ",", " ", 
          RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", " ", "=", "  ", 
          RowBox[{"randomDisplacements", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
               "linearConstraints"}], ")"}], " ", "-", " ", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], " ", ",",
             "\n", "\t\t", 
            RowBox[{"OptionValue", "[", "Distribution", "]"}], ",", "\n", 
            "\t\t", 
            RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ",", "\n", 
            "\t\t", "number"}], "\n", "\t ", "]"}]}], " ", "}"}], ",", " ", 
        "\n", "\t ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"ToPackedArray", "[", "\n", "\t\t\t", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{"number", " ", "==", " ", "1"}], ",", " ", 
            RowBox[{
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", "+", 
             " ", 
             RowBox[{"res", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], " ", ",", " ", 
            RowBox[{
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ",
                "number"}], "]"}], " ", "+", " ", "res"}]}], " ", "]"}], "\n",
           "\t\t", "]"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
           "randomDisplacements"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Head", "[", "linearConstraints", "]"}], " ", "===", " ", 
           "List"}]}]}]}], "\t ", "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{"randompositionArgumentsQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "number", " ", ",", " ", 
      RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], " ", ",", " ", 
      RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}]}], 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"randompositionArgumentsQ", "[", " ", 
    RowBox[{
    "m_", " ", ",", "  ", "number_", " ", ",", " ", "workingprecision_", " ", 
     ",", " ", "reduce_"}], "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"Which", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Not", "[", 
       RowBox[{"IntegerQ", "[", "number", "]"}], "]"}], " ", "||", " ", 
      RowBox[{"number", " ", "<", " ", "0"}]}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomPositions", "::", "n"}], ",", " ", "number"}], "]"}], 
      ";", " ", "False"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"workingprecision", " ", "=!=", " ", "MachinePrecision"}], " ", 
      "&&", " ", 
      RowBox[{"Not", "[", " ", 
       RowBox[{"TrueQ", "[", 
        RowBox[{"workingprecision", " ", ">", " ", "0"}], " ", "]"}], "]"}]}],
      ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomPositions", "::", "prec"}], ",", " ", 
        "workingprecision"}], "]"}], ";", " ", "False"}], ",", "\n", "\t\t", 
     RowBox[{"Not", "[", 
      RowBox[{"BooleanQ", "[", "reduce", "]"}], "]"}], ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"RandomPositions", "::", "red"}], "]"}], ";", " ", "False"}], 
     ",", "\n", "\t\t", "True", ",", " ", "True"}], "\n", "\t", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "red"}], " ", "=", " ", 
   "\"\<ReduceLinearConstraints must be a Boolean.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "n"}], " ", "=", " ", 
   "\"\<Number of random positions `1` must be a positive integer.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomPositions", "::", "prec"}], " ", "=", " ", 
   "\"\<Working precision `1` should be a positive number of digits of \
precision.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7153]:=",ExpressionUUID->"acc0980c-b0c5-44c5-97cf-81db4889f1a2"],

Cell[CellGroupData[{

Cell["shared functions", "Subsubsection",ExpressionUUID->"210b555e-5c19-4358-9e47-26ced9aa372d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"randomDisplacementsInternal", "[", " ", 
    RowBox[{
    "positions_", ",", " ", "distribution_", ",", " ", "precision_", ",", " ", 
     RowBox[{"{", "}"}], ",", " ", "numDisplacements_"}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
        "numberOfVertices", ",", " ", "dim", ",", " ", "randomNumbers"}], 
        "\n", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=",
          " ", 
         RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
        RowBox[{"Check", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"RandomVariate", "[", " ", 
           RowBox[{"distribution", ",", " ", 
            RowBox[{"{", 
             RowBox[{
             "numDisplacements", ",", " ", "numberOfVertices", ",", "dim"}], 
             "}"}], ",", " ", 
            RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", "precision"}]}], 
           " ", "]"}], ",", "\n", "\n", "\t\t", "$Failed"}], "\n", "\t", 
         "]"}]}]}], "\n", "]"}], "\n", "\n", 
     RowBox[{"randomDisplacementsInternal", "[", " ", 
      RowBox[{
      "positions_", ",", " ", "distribution_", ",", " ", "precision_", ",", 
       " ", "rules_", ",", " ", "numDisplacements_"}], " ", "]"}]}], " ", ":=",
     "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
       "numberOfVertices", ",", " ", "dim", ",", " ", "displacements", ",", 
        " ", "arbitraryDisplacements"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"numberOfVertices", ",", " ", "dim"}], " ", "}"}], " ", "=", 
        " ", 
        RowBox[{"Dimensions", "[", "positions", "]"}]}], ";", "\n", "\t", 
       RowBox[{"displacements", " ", "=", " ", 
        RowBox[{
         RowBox[{"Array", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"VertexDisplacement", "[", 
             RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"numberOfVertices", ",", "dim"}], "}"}]}], "]"}], " ", "//.",
          " ", "rules"}]}], ";", "\n", "\t", 
       RowBox[{"arbitraryDisplacements", " ", "=", " ", 
        RowBox[{"Cases", "[", " ", 
         RowBox[{
          RowBox[{"Flatten", "[", "displacements", "]"}], ",", " ", 
          "_VertexDisplacement"}], "]"}]}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"Check", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Array", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"displacements", " ", "/.", " ", 
              RowBox[{"Dispatch", "@", 
               RowBox[{"Thread", "[", 
                RowBox[{"arbitraryDisplacements", "->", 
                 RowBox[{"RandomVariate", "[", "\n", "\t\t\t", 
                  RowBox[{"distribution", ",", "\n", "\t\t\t", 
                   RowBox[{"Length", "[", "arbitraryDisplacements", "]"}], 
                   ",", "\n", "\t\t\t", 
                   RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], 
                  "\n", "\t\t", "]"}]}], "]"}]}]}], " ", "&"}], ")"}], ",", 
           " ", "numDisplacements"}], " ", "]"}], ",", "\n", "\n", "\t\t", 
         "$Failed"}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]}], "*)"}]], "Code",\

 CellLabel->
  "1/2/24 10:12:06 \
In[7159]:=",ExpressionUUID->"67c278b9-eef7-4b05-ae0e-8903de6803e2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RandomDisplacements", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Distribution", " ", "->", " ", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"WorkingPrecision", " ", "->", " ", "MachinePrecision"}], ",", 
      "\n", "\t", 
      RowBox[{"ConstraintRules", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";", "\n", "\n", 
   RowBox[{
    RowBox[{"Options", "[", "RandomPositions", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Distribution", " ", "->", " ", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         RowBox[{"1", "/", "10"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"WorkingPrecision", " ", "->", " ", "MachinePrecision"}], ",", 
      "\n", "\t", 
      RowBox[{"ConstraintRules", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}], "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:06 \
In[7160]:=",ExpressionUUID->"de5d12de-88f2-4f66-aca7-2a9462b01290"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"processRules", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"{", "}"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", "}"}]}], "\n", 
   RowBox[{
    RowBox[{"processRules", "[", " ", 
     RowBox[{"RandomDisplacements", ",", " ", "r_"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"parseDisplacementRules", "[", 
     RowBox[{"r", ",", 
      RowBox[{"Message", "[", 
       RowBox[{"RandomDisplacements", "::", "rules"}], "]"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"processRules", "[", " ", 
     RowBox[{"RandomPositions", ",", " ", "r_"}], " ", "]"}], " ", ":=", " ", 
    
    RowBox[{"parseDisplacementRules", "[", 
     RowBox[{"r", ",", 
      RowBox[{"Message", "[", 
       RowBox[{"RandomPositions", "::", "rules"}], "]"}]}], "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"precisionQ", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"p_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}]}], " ", "]"}], " ", ":=", 
    " ", "p"}], "\n", 
   RowBox[{
    RowBox[{"precisionQ", "[", " ", 
     RowBox[{"RandomDisplacements", ",", " ", "p_"}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomDisplacements", "::", "precision"}], ",", " ", "p"}], 
       "]"}], ";", " ", "$Failed"}], ")"}]}], "\n", 
   RowBox[{
    RowBox[{"precisionQ", "[", " ", 
     RowBox[{"RandomPositions", ",", " ", "p_"}], " ", "]"}], " ", ":=", " ", 
    
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RandomPositions", "::", "precision"}], ",", " ", "p"}], 
       "]"}], ";", " ", "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"processNumber", "[", " ", 
     RowBox[{"_", ",", " ", 
      RowBox[{"n_Integer", "?", "Positive"}]}], " ", "]"}], " ", ":=", " ", 
    "n"}], "\n", 
   RowBox[{
    RowBox[{"processNumber", "[", " ", 
     RowBox[{"RandomDisplacements", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"RandomDisplacements", "::", "num"}], "]"}], ";", " ", 
      "$Failed"}], ")"}]}], "\n", 
   RowBox[{
    RowBox[{"processNumber", "[", " ", 
     RowBox[{"RandomPositions", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"RandomPositions", "::", "num"}], "]"}], ";", " ", "$Failed"}],
      ")"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomDisplacements", "::", "rules"}], "=", 
     "\"\<List of rules must be of the form {VertexDisplacements[_,_]->_, ..}\
\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomDisplacements", "::", "precision"}], "=", 
     "\"\<Working precision should be a real, positive number.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomDisplacements", "::", "num"}], "=", 
     "\"\<Number of displacements must be a positive integer.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomDisplacements", "::", "pos"}], "=", 
     "\"\<First argument should be positions or a mechanism.\>\""}], ";"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomPositions", "::", "rules"}], "=", 
     "\"\<List of rules must be of the form {VertexDisplacements[_,_]->_, ..}\
\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomPositions", "::", "precision"}], "=", 
     "\"\<Working precision should be a real, positive number.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomPositions", "::", "num"}], "=", 
     "\"\<Number of displacements must be a positive integer.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomPositions", "::", "pos"}], "=", 
     "\"\<First argument should be positions or a mechanism.\>\""}], ";"}]}], 
  "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7161]:=",ExpressionUUID->"bb76698f-934f-49ed-accd-f896b4d70a0c"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"displacementParsingRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Rule", "[", 
        RowBox[{
         RowBox[{"x", " ", ":", " ", 
          RowBox[{"{", "__VertexDisplacement", "}"}]}], " ", ",", " ", 
         RowBox[{"y", " ", ":", " ", 
          RowBox[{"Except", "[", "_List", "]"}]}]}], "]"}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Rule", "[", 
         RowBox[{
          RowBox[{"x", " ", ":", " ", 
           RowBox[{"{", "__VertexDisplacement", "}"}]}], " ", ",", " ", 
          "y_List"}], "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Length", "[", "x", "]"}], "==", 
         RowBox[{"Length", "[", "y", "]"}]}]}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Rule", "[", " ", 
         RowBox[{
          RowBox[{"x_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"MatrixQ", "[", 
              RowBox[{"#", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", "#", "]"}], "===", 
                 "VertexDisplacement"}], "&"}]}], "]"}], "&"}], ")"}]}], ",", 
          " ", "y_List"}], " ", "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Length", "[", "x", "]"}], "==", 
         RowBox[{"Length", "[", "y", "]"}]}]}], " ", ":>", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Rule", "[", " ", 
        RowBox[{
         RowBox[{"x_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"MatrixQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], "===", 
                "VertexDisplacement"}], "&"}]}], "]"}], "&"}], ")"}]}], ",", 
         " ", 
         RowBox[{"y", " ", ":", " ", 
          RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}], " ", ":>", 
       " ", 
       RowBox[{"Thread", "[", 
        RowBox[{"x", "->", "y"}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"pi_PeriodicIdentificationData", " ", ":>", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"pi", "[", "\"\<DisplacementRules\>\"", "]"}], " ", "/.", 
         " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"pi", "[", "\"\<labels\>\"", "]"}], "->", "1"}], "]"}]}], 
        ")"}]}]}], "\n", "}"}]}], ";", "\n", "\n", 
   RowBox[{
    RowBox[{"parseDisplacementRules", "[", " ", 
     RowBox[{"x_", " ", ",", " ", "err_"}], "]"}], " ", ":=", " ", "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{
         RowBox[{"processedRules", "=", 
          RowBox[{"Flatten", "[", " ", 
           RowBox[{
            RowBox[{"{", "x", "}"}], " ", "//.", " ", 
            "displacementParsingRules"}], " ", "]"}]}], ",", " ", "badQ"}], 
        "\n", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"badQ", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", " ", 
          RowBox[{"processedRules", ",", " ", 
           RowBox[{
            RowBox[{"VertexDisplacement", "[", 
             RowBox[{"_Integer", ",", "_String"}], "]"}], " ", "->", " ", 
            RowBox[{"Except", "[", "_List", "]"}]}]}], " ", "]"}]}], ";", 
        "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "badQ", "]"}], " ", ">", " ", "0"}], ",", 
          " ", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Evaluate", "[", "err", "]"}], ";", " ", 
           RowBox[{"{", "}"}]}], " ", ",", " ", "\n", "\t\t", 
          "processedRules"}], "\n", "\t", "]"}]}]}], "\n", "]"}], "\n", 
     RowBox[{
      RowBox[{"SetAttributes", "[", 
       RowBox[{"parseDisplacementRules", ",", "HoldRest"}], "]"}], 
      ";"}]}]}]}], "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7162]:=",ExpressionUUID->"81c418b1-c286-46bf-a115-a2aebac829b4"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomDisplacements[]", "Subsubsection",ExpressionUUID->"04e4ccfe-f5d0-4c69-876b-7beec801cf2e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"RandomDisplacements", "[", " ", 
    RowBox[{"m_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", "=", 
         RowBox[{"RandomDisplacements", "[", 
          RowBox[{"m", ",", "1", ",", " ", "opt"}], "]"}]}], "}"}], ",", "\n",
        "\t", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
         "RandomDisplacements"}]}]}], "\n", "]"}], "\n", "\n", 
     RowBox[{"RandomDisplacements", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
       RowBox[{"num", " ", ":", " ", 
        RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
       RowBox[{"opt", " ", ":", " ", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}]}], " ", ":=", 
    " ", "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"precision", " ", "=", " ", 
           RowBox[{"precisionQ", "[", " ", 
            RowBox[{"RandomDisplacements", ",", " ", 
             RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
            "]"}]}], ",", "\n", "\t", 
          RowBox[{"rules", " ", "=", " ", 
           RowBox[{"processRules", "[", " ", 
            RowBox[{"RandomDisplacements", ",", " ", 
             RowBox[{"OptionValue", "[", "ConstraintRules", "]"}]}], " ", 
            "]"}]}], ",", "\n", "\t", 
          RowBox[{"distribution", " ", "=", " ", 
           RowBox[{"OptionValue", "[", "Distribution", "]"}]}], ",", "\n", 
          "\t", 
          RowBox[{"number", " ", "=", " ", 
           RowBox[{"processNumber", "[", 
            RowBox[{"RandomDisplacements", ",", " ", "num"}], "]"}]}]}], "\n",
          "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"res", "=", 
             RowBox[{"randomDisplacementsInternal", "[", " ", 
              RowBox[{
               RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ",
                "distribution", ",", " ", "precision", ",", " ", "rules", ",",
                " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
           RowBox[{"res", " ", "/;", " ", 
            RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
          "]"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
          RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}], 
      "\n", "\n", 
      RowBox[{"RandomDisplacements", "[", " ", 
       RowBox[{
        RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
        RowBox[{"num", " ", ":", " ", 
         RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
        RowBox[{"opt", " ", ":", " ", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}]}], " ", ":=", 
     " ", "\n", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"precision", " ", "=", " ", 
           RowBox[{"precisionQ", "[", " ", 
            RowBox[{"RandomDisplacements", ",", " ", 
             RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
            "]"}]}], ",", "\n", "\t", 
          RowBox[{"rules", " ", "=", " ", 
           RowBox[{"processRules", "[", " ", 
            RowBox[{"RandomDisplacements", ",", " ", 
             RowBox[{"OptionValue", "[", "ConstraintRules", "]"}]}], " ", 
            "]"}]}], ",", "\n", "\t", 
          RowBox[{"distribution", " ", "=", " ", 
           RowBox[{"OptionValue", "[", "Distribution", "]"}]}], ",", "\n", 
          "\t", 
          RowBox[{"number", " ", "=", " ", 
           RowBox[{"processNumber", "[", 
            RowBox[{"RandomDisplacements", ",", " ", "num"}], "]"}]}]}], "\n",
          "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"res", "=", 
             RowBox[{"randomDisplacementsInternal", "[", " ", 
              RowBox[{
              "pos", ",", " ", "distribution", ",", " ", "precision", ",", 
               " ", "rules", ",", " ", "number"}], " ", "]"}]}], "}"}], ",", 
           "\n", "\t\t", 
           RowBox[{"res", " ", "/;", " ", 
            RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", 
          "]"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
          RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}], 
      "\n", "\n", 
      RowBox[{
       RowBox[{"RandomDisplacements", "[", " ", 
        RowBox[{"a_", ",", " ", "___"}], "]"}], " ", ":=", " ", 
       RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"RandomDisplacements", "::", "pos"}], "]"}]}]}]}]}]}]}], 
  "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7163]:=",ExpressionUUID->"57513859-4f53-4eda-9590-ffdd220c0920"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomPositions[]", "Subsubsection",ExpressionUUID->"82434295-c65e-4c3d-9009-b10aad58af20"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"RandomPositions", "[", " ", 
      RowBox[{"m_", " ", ",", " ", 
       RowBox[{"opt", " ", ":", " ", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
     
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", "=", 
         RowBox[{"RandomPositions", "[", 
          RowBox[{"m", ",", "1", ",", "opt"}], "]"}]}], "}"}], ",", " ", 
       RowBox[{
        RowBox[{"res", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
         "RandomPositions"}]}]}], "]"}]}], "\n", "\n", 
    RowBox[{"RandomPositions", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"num", " ", ":", " ", 
       RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}]}], " ", ":=", " ",
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"precision", " ", "=", " ", 
          RowBox[{"precisionQ", "[", " ", 
           RowBox[{"RandomPositions", ",", " ", 
            RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
           "]"}]}], ",", "\n", "\t", 
         RowBox[{"rules", " ", "=", " ", 
          RowBox[{"processRules", "[", " ", 
           RowBox[{"RandomPositions", ",", " ", 
            RowBox[{"OptionValue", "[", "ConstraintRules", "]"}]}], " ", 
           "]"}]}], ",", "\n", "\t", 
         RowBox[{"distribution", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "Distribution", "]"}]}], ",", "\n", 
         "\t", 
         RowBox[{"number", " ", "=", " ", 
          RowBox[{"processNumber", "[", 
           RowBox[{"RandomPositions", ",", " ", "num"}], "]"}]}]}], "\n", 
        "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"res", "=", 
            RowBox[{"randomDisplacementsInternal", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
              "distribution", ",", " ", "precision", ",", " ", "rules", ",", 
              " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
               "number"}], "]"}], "+", "res"}], ")"}], " ", "/;", " ", 
           RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}],
         " ", "/;", " ", 
        RowBox[{
         RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
         RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}], 
     "\n", "\n", 
     RowBox[{"RandomPositions", "[", " ", 
      RowBox[{
       RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
       RowBox[{"num", " ", ":", " ", 
        RowBox[{"Except", "[", "_Rule", "]"}]}], " ", ",", " ", 
       RowBox[{"opt", " ", ":", " ", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}]}], " ", ":=", 
    " ", "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"precision", " ", "=", " ", 
          RowBox[{"precisionQ", "[", 
           RowBox[{"RandomPositions", ",", " ", 
            RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], " ", 
           "]"}]}], ",", "\n", "\t", 
         RowBox[{"rules", " ", "=", " ", 
          RowBox[{"processRules", "[", 
           RowBox[{"RandomPositions", ",", " ", 
            RowBox[{"OptionValue", "[", "ConstraintRules", "]"}]}], " ", 
           "]"}]}], ",", "\n", "\t", 
         RowBox[{"distribution", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "Distribution", "]"}]}], ",", "\n", 
         "\t", 
         RowBox[{"number", " ", "=", " ", 
          RowBox[{"processNumber", "[", 
           RowBox[{"RandomPositions", ",", " ", "num"}], "]"}]}]}], "\n", 
        "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"res", "=", 
            RowBox[{"randomDisplacementsInternal", "[", " ", 
             RowBox[{
             "pos", ",", " ", "distribution", ",", " ", "precision", ",", " ",
               "rules", ",", " ", "number"}], " ", "]"}]}], "}"}], ",", "\n", 
          "\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"ConstantArray", "[", 
              RowBox[{"pos", ",", "number"}], "]"}], "+", "res"}], ")"}], " ",
            "/;", " ", 
           RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}],
         " ", "/;", " ", 
        RowBox[{
         RowBox[{"precision", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
         RowBox[{"number", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}], 
     "\n", "\n", 
     RowBox[{
      RowBox[{"RandomPositions", "[", " ", 
       RowBox[{"a_", ",", " ", "___"}], "]"}], " ", ":=", " ", 
      RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"RandomPositions", "::", "pos"}], "]"}]}]}]}]}]}], 
  "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7164]:=",ExpressionUUID->"cf271863-19b8-49cc-b7de-25a0d2ac9be2"]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["determining constraints in mechanisms", "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],

Cell[CellGroupData[{

Cell["\<\
MechanismCellRawData[], MechanismCellData[], MechanismCellDataValue[]\
\>", "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellRawData", "[", "anything__", "]"}], "[", " ", 
    RowBox[{"m_", "?", "MechanismQ"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"MechanismCellRawData", "[", 
    RowBox[{"m", ",", " ", "anything"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellRawData", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", "1", "]"}], "]"}], " ", "->", " ", 
     RowBox[{"Association", "@@", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}]}], "&"}], "/@", 
   RowBox[{"Cases", "[", 
    RowBox[{
     RowBox[{"Mechanisms`Private`mechanismCellList", "[", 
      RowBox[{
      "\"\<Unthreaded\>\"", ",", " ", "m", ",", " ", "cellSpec", ",", " ", 
       "None", ",", " ", "_"}], "]"}], ",", "_Rule"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellRawData", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"cellSpec_", " ", ":", " ", "_"}], " ", ",", " ", "dataSpec_"}], 
    " ", "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", "->", " ", 
      RowBox[{"Association", "@@", 
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}], "&"}], "/@", 
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{"Mechanisms`Private`mechanismCellList", "[", 
       RowBox[{
       "\"\<Unthreaded\>\"", ",", " ", "m", ",", " ", "cellSpec", ",", " ", 
        "dataSpec", ",", " ", "_"}], "]"}], ",", "_Rule"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellRawData", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "_"}], "]"}], ",", 
    " ", "anything__"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"MechanismCellRawData", "[", " ", 
   RowBox[{"m", ",", " ", "anything"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7165]:=",ExpressionUUID->"728e38a5-cecd-4b7b-a1f4-b4c8094cc050"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCellData", "[", " ", "anything___", " ", "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"MechanismCellData", "[", 
    RowBox[{"m", ",", " ", "anything"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellData", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"cellData", "[", 
   RowBox[{"m", ",", " ", 
    RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
    "cellSpec"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellData", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
     RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"cellData", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
      "cellSpec"}], "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellData", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
    "___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", " ", 
    RowBox[{
     RowBox[{"MechanismCellData", "::", "pos"}], " ", ",", " ", "pos"}], " ", 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCellData", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:07 \
In[7169]:=",ExpressionUUID->"adb8d8ad-2a69-432e-9101-5ef289672aa6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismCellDataValue", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "cellSpec_", " ", ",", " ", 
    "data_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d", "=", 
      RowBox[{"cellData", "[", 
       RowBox[{"m", ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        "cellSpec"}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "[", "data", "]"}]}], "}"}], "&"}], 
     " ", "/@", " ", "d"}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismCellDataValue", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
    "cellSpec_", " ", ",", " ", "data_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"d", "=", 
       RowBox[{"cellData", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         "cellSpec"}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "[", "data", "]"}]}], "}"}], "&"}],
       " ", "/@", " ", "d"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "pos"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7174]:=",ExpressionUUID->"b4def607-cc7e-4abd-a4da-eb7e19c6a326"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConstrainedCells[]", "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MechanismConstrainedCells", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"out", "=", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"cellData", "[", 
         RowBox[{"m", " ", ",", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
          "cellSpec", " ", ",", " ", "$constrainedCellData"}], "]"}], ",", 
        " ", "$Failed"}], "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"out", " ", "/;", " ", 
     RowBox[{"out", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstrainedCells", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_"}], " ", "]"}],
      " ", ",", " ", 
     RowBox[{"cellSpec_", " ", ":", " ", "_"}]}], " ", "]"}], " ", ":=", " ", 
   
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"out", " ", "=", 
        RowBox[{"Check", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"cellData", "[", 
           RowBox[{"m", " ", ",", " ", 
            RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
            "cellSpec", " ", ",", " ", "$constrainedCellData"}], "]"}], ",", 
          "\n", "\t\t", "$Failed"}], "\n", "\t\t", "]"}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"out", " ", "/;", " ", 
       RowBox[{"out", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], "/;", 
    " ", 
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "pos"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstrainedCells", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
    "___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismConstrainedCells", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstrainedCells", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:07 \
In[7176]:=",ExpressionUUID->"216009e6-27cf-4f6b-9566-2fc20f53096e"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismLinearConstraints[]", "Subsection",ExpressionUUID->"0d7198e4-d557-4a45-9d92-3660b3703b66"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismLinearConstraints", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "->", " ", "_"}]}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismLinearConstraints", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", "\n", 
  "\t", 
  RowBox[{
   RowBox[{"processConstraintEquations", "[", " ", 
    RowBox[{
     RowBox[{"VertexPosition", "[", "m", "]"}], " ", ",", " ", 
     RowBox[{"constraintEquations", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", "]"}]}], " ", 
    "]"}], "[", "\"\<linear solutions\>\"", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismLinearConstraints", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_"}], " ", "]"}],
      ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{
     RowBox[{"processConstraintEquations", "[", " ", 
      RowBox[{
       RowBox[{"VertexPosition", "[", "m", "]"}], " ", ",", " ", 
       RowBox[{"constraintEquations", "[", 
        RowBox[{"m", ",", " ", "pos", ",", " ", 
         RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", "]"}]}], 
      " ", "]"}], "[", "\"\<linear solutions\>\"", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "pos"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismLinearConstraints", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
    "___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismLinearConstraints", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismLinearConstraints", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:07 \
In[7180]:=",ExpressionUUID->"81434a9a-c9a7-4c73-b3d8-bebc20d4c50b"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConstraintMap[]", "Subsection",ExpressionUUID->"9123b123-d97f-4e49-ac8b-fc63cba8477b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismConstraintMap", "]"}], " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", "\n", "\t", 
      RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", "\n", "\t", 
      RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}]}], "\n", 
     "}"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "version", " ", "with", " ", "arbitrary", " ", "vertex", " ", 
    "positions"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"order", " ", ":", " ", 
      RowBox[{"Except", "[", 
       RowBox[{"_Rule", "|", "_List"}], "]"}], " ", ":", " ", 
      "\"\<nothing\>\""}], " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"internalConstraintMap", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", "order", ",", 
          " ", 
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], ",", 
          " ", 
          RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", "]"}]}], 
       " ", "}"}], ",", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "internalConstraintMap"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"orderQ", "[", " ", "order", "]"}], " ", "&&", " ", 
     RowBox[{"reduceLinearConstraintsQ", "[", " ", 
      RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], " ", 
      "]"}]}]}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "compute", " ", "the", " ", "strains", " ", "with", " ", "given", " ", 
    "vertex", " ", "positions"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ", 
      "]"}], " ", ",", " ", 
     RowBox[{"order", " ", ":", " ", 
      RowBox[{"Except", "[", 
       RowBox[{"_Rule", "|", "_List"}], "]"}], " ", ":", " ", 
      "\"\<nothing\>\""}], " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"internalConstraintMap", "[", 
         RowBox[{"m", ",", " ", "positions", ",", " ", "order", ",", " ", 
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], ",", 
          " ", 
          RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", "]"}]}], 
       " ", "}"}], ",", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "internalConstraintMap"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"VertexCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "positions"}], "]"}], " ", "&&", " ", 
     RowBox[{"orderQ", "[", " ", "order", "]"}], " ", "&&", " ", 
     RowBox[{"reduceLinearConstraintsQ", "[", " ", 
      RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], " ", 
      "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], 
      "]"}], " ", ",", " ", 
     RowBox[{"order", " ", ":", " ", 
      RowBox[{"Except", "[", 
       RowBox[{"_Rule", "|", "_List"}], "]"}]}], " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", "\n",
    "\t", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismConstraintMap", "::", "pos"}], ",", " ", 
      "positions"}], "]"}]}]}], "\n", "\t", "\n", 
  RowBox[{"(*", 
   RowBox[{"reduce", " ", "constraints"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"reduceLinearConstraintsQ", "[", " ", 
   RowBox[{"x_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"reduceLinearConstraintsQ", "[", " ", "x_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismConstraintMap", "::", "red"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"order", " ", "requested"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"orderQ", "[", 
   RowBox[{"Infinity", "|", 
    RowBox[{"_Integer", "?", "Positive"}], "|", "\"\<nothing\>\""}], "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orderQ", "[", " ", 
    RowBox[{"order", " ", ":", " ", 
     RowBox[{"Except", "[", "_Rule", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismConstraintMap", "::", "order"}], ",", " ", "order"}],
       "]"}], ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "::", "pos"}], "=", 
   "\"\<Positions `1` cannot correspond to the mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "::", "red"}], "=", 
   "\"\<Option ReduceLinearConstraints should be Boolean.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMap", "::", "order"}], "=", 
   "\"\<Order `1` must be a positive integer or Infinity.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7185]:=",ExpressionUUID->"3aeddf4b-e73a-4f83-9c9a-0acaa25aa414"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
   "positions", " ", "are", " ", "the", " ", "positions", " ", "of", " ", 
    "the", " ", "actual", " ", "mechanism", "\n", "\t", "order", " ", "is", 
    " ", "a", " ", "positve", " ", "integer", " ", "indicated", " ", "the", 
    " ", "order", " ", "we", " ", "should", " ", "expand", " ", "to", "\n", 
    "\t", "reduceLinearConstraints", " ", "is", " ", "a", " ", "Boolean", " ",
     "to", " ", "decide", " ", "if", " ", "we", " ", "should", " ", "remove", 
    " ", "linear", " ", "constraints", " ", "from", " ", "the", " ", 
    "constraints", " ", 
    RowBox[{"(", 
     RowBox[{
     "since", " ", "they", " ", "are", " ", "often", " ", "solved", " ", 
      "explicitly"}], ")"}], "\n", "\t", "cellPattern", " ", "is", " ", "a", 
    " ", "cell", " ", "selection", " ", "pattern", "\n", "\t", "constraints", 
    " ", "are", " ", "additional", " ", "constraints", " ", "we", " ", 
    "might", " ", "add", " ", "that", " ", 
    RowBox[{"aren", "'"}], "t", " ", "represented", " ", "by", " ", "cells"}],
    "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"internalConstraintMap", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "positions_", " ", ",", " ", "order_", " ", ",", " ",
      "reduceLinearConstraints_", " ", ",", " ", "cellPattern_", " ", ",", 
     " ", "constraints_"}], "  ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", "\n", "\t", 
      RowBox[{"eq", " ", "=", " ", 
       RowBox[{"constraintEquations", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         "cellPattern", ",", " ", "constraints"}], "]"}]}], " ", 
      RowBox[{"(*", 
       RowBox[{
       "get", " ", "the", " ", "constraint", " ", "equations", " ", "based", 
        " ", "on", " ", "mechanism", " ", "positions"}], "*)"}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"reduceConstraintToOrder", "[", " ", 
       RowBox[{"positions", ",", " ", 
        RowBox[{"(*", 
         RowBox[{
         "expand", " ", "constraints", " ", "around", " ", "provided", " ", 
          "positions"}], "*)"}], "\n", "\t\t", 
        RowBox[{"If", "[", " ", 
         RowBox[{"reduceLinearConstraints", " ", ",", " ", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"processConstraintEquations", "[", " ", 
            RowBox[{
             RowBox[{"VertexPosition", "[", "m", "]"}], " ", ",", " ", "eq"}],
             " ", "]"}], "[", "\"\<nonlinear constraints\>\"", "]"}], ",", 
          "\n", "\t\t\t", "eq"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
        "order"}], " ", "]"}], " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "eq", "]"}], " ", "===", " ", "List"}]}]}], "\n", 
    "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7196]:=",ExpressionUUID->"044fa456-bd69-4a55-a416-3e922b52f622"]
}, Closed]],

Cell[CellGroupData[{

Cell["EuclideanMotionConstraints[]", "Subsection",ExpressionUUID->"ed21ee08-f6e8-4397-9e7c-264e4a262262"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"EuclideanMotionConstraints", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "data_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"out", "=", 
      RowBox[{"euclideanConstraintsInternal", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", "data", "}"}], " ", "/.", " ", 
          RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}], "]"}]}], " ", "]"}]}], 
     "}"}], ",", " ", 
    RowBox[{"out", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "out", "]"}], "===", "List"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"EuclideanMotionConstraints", "[", " ", 
   RowBox[{
    RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", "data_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"out", "=", 
      RowBox[{"euclideanConstraintsInternal", "[", 
       RowBox[{"pos", ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "data", "}"}], "]"}]}], " ", "]"}]}], "}"}], ",", " ", 
    RowBox[{"out", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "out", "]"}], "===", "List"}]}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7197]:=",ExpressionUUID->"b67c74e3-2586-4ac2-a9ce-decf0b51c797"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"euclideanConstraintsInternal", "[", " ", 
    RowBox[{
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"numberedEdge", " ", ":", " ", 
      RowBox[{"{", "_Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"VertexDisplacement", "[", " ", 
     RowBox[{
      RowBox[{"numberedEdge", "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
      RowBox[{"All", "[", "2", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "2"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Max", "[", "numberedEdge", "]"}], " ", "<=", " ", 
      RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "numberedEdge", "]"}], " ", ">", " ", "0"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"euclideanConstraintsInternal", "[", " ", 
   RowBox[{
    RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", "  ", 
    RowBox[{"numberedEdge", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"_Integer", ",", "_Integer"}], "}"}]}]}], " ", "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{"(*", 
      RowBox[{"fix", " ", "a", " ", "vertex"}], "*)"}], "\n", "\t\t", 
     RowBox[{
      RowBox[{"VertexDisplacement", "[", " ", 
       RowBox[{
        RowBox[{"numberedEdge", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"All", "[", "2", "]"}]}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"(*", 
       RowBox[{
       "fix", " ", "the", " ", "orientation", " ", "of", " ", "the", " ", 
        "edge"}], "*)"}], "\n", "\t\t", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], " ", ".", " ", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], " ", ")"}]}], 
        ")"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
           RowBox[{"All", "[", "2", "]"}]}], " ", "]"}], " ", "-", " ", 
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"All", "[", "2", "]"}]}], " ", "]"}]}], ")"}]}]}], "\n", 
     "\t", "}"}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "2"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", "numberedEdge", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "numberedEdge", "]"}], " ", ">", " ", 
     "0"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7199]:=",ExpressionUUID->"a386d309-e03b-4d47-b830-33403a112ab3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"euclideanConstraintsInternal", "[", " ", 
    RowBox[{
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"numberedEdge", " ", ":", " ", 
      RowBox[{"{", "_Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"VertexDisplacement", "[", " ", 
     RowBox[{
      RowBox[{"numberedEdge", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
      RowBox[{"All", "[", "3", "]"}]}], "]"}], "  ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "3"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Max", "[", "numberedEdge", "]"}], " ", "<=", " ", 
      RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "numberedEdge", "]"}], " ", ">", " ", "0"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"euclideanConstraintsInternal", "[", " ", 
    RowBox[{
     RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"numberedEdge", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"_Integer", ",", "_Integer"}], "}"}]}]}], " ", "]"}], " ", ":=",
    " ", "\n", "\t", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{"(*", 
       RowBox[{"fix", " ", "a", " ", "vertex"}], "*)"}], "\n", "\t\t", 
      RowBox[{
       RowBox[{"VertexDisplacement", "[", " ", 
        RowBox[{
         RowBox[{"numberedEdge", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{"All", "[", "3", "]"}]}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{
        "fix", " ", "the", " ", "orientation", " ", "of", " ", "the", " ", 
         "edge"}], "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"NullSpace", "[", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "}"}], " ", 
         "]"}], " ", ".", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"VertexDisplacement", "[", " ", 
           RowBox[{
            RowBox[{"numberedEdge", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
            RowBox[{"All", "[", "3", "]"}]}], " ", "]"}], " ", "-", " ", 
          RowBox[{"VertexDisplacement", "[", " ", 
           RowBox[{
            RowBox[{"numberedEdge", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
            RowBox[{"All", "[", "3", "]"}]}], " ", "]"}]}], ")"}]}]}], "\n", 
      "\t", "}"}], "]"}], "  ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "3"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Max", "[", "numberedEdge", "]"}], " ", "<=", " ", 
      RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Min", "[", "numberedEdge", "]"}], " ", ">", " ", "0"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"euclideanConstraintsInternal", "[", " ", 
   RowBox[{
    RowBox[{"pos_", "?", "VertexCoordinatesQ"}], ",", " ", 
    RowBox[{"numberedEdge", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"_Integer", ",", "_Integer", ",", "_Integer"}], "}"}]}]}], " ", 
   "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{"(*", 
      RowBox[{"fix", " ", "a", " ", "vertex"}], "*)"}], "\n", "\t\t", 
     RowBox[{
      RowBox[{"VertexDisplacement", "[", " ", 
       RowBox[{
        RowBox[{"numberedEdge", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"All", "[", "3", "]"}]}], "]"}], ",", "\n", "\t\t", 
      RowBox[{"(*", 
       RowBox[{
       "fix", " ", "the", " ", "orientation", " ", "of", " ", "the", " ", 
        "edge"}], "*)"}], "\n", "\t\t", 
      RowBox[{
       RowBox[{"NullSpace", "[", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"pos", "[", 
           RowBox[{"[", 
            RowBox[{"numberedEdge", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
          RowBox[{"pos", "[", 
           RowBox[{"[", 
            RowBox[{"numberedEdge", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "}"}], " ", 
        "]"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
           RowBox[{"All", "[", "3", "]"}]}], " ", "]"}], " ", "-", " ", 
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"All", "[", "3", "]"}]}], " ", "]"}]}], ")"}]}], ",", "\n",
       "\t\t\t", 
      RowBox[{
       RowBox[{"NullSpace", "[", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
           RowBox[{"pos", "[", 
            RowBox[{"[", 
             RowBox[{"numberedEdge", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}]}], "}"}], " ", 
        "]"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", 
           RowBox[{"All", "[", "3", "]"}]}], " ", "]"}], " ", "-", " ", 
         RowBox[{"VertexDisplacement", "[", " ", 
          RowBox[{
           RowBox[{"numberedEdge", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"All", "[", "3", "]"}]}], " ", "]"}]}], ")"}]}]}], "\n", 
     "\t", "}"}], "]"}], "  ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"pos", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", "3"}], " ", "&&",
     " ", 
    RowBox[{
     RowBox[{"Max", "[", "numberedEdge", "]"}], " ", "<=", " ", 
     RowBox[{"Length", "[", "pos", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", "numberedEdge", "]"}], " ", ">", " ", 
     "0"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7201]:=",ExpressionUUID->"481efb83-3a28-4515-b5a4-6701d24a7c85"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"euclideanConstraintsInternal", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "VertexCoordinatesQ"}], ",", " ", 
     RowBox[{"edge", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Max", "[", "edge", "]"}], " ", ">", " ", 
         RowBox[{"Length", "[", "m", "]"}]}], " ", "||", " ", 
        RowBox[{
         RowBox[{"Min", "[", "edge", "]"}], " ", "<=", " ", "0"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"EuclideanMotionConstraints", "::", "c"}], ",", " ", 
         "edge"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "edge", "]"}], ">", 
        RowBox[{"Length", "[", 
         RowBox[{"m", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"EuclideanMotionConstraints", "::", "e"}], ",", " ", 
         RowBox[{"Length", "[", 
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], " ", "]"}]}], " ", "]"}], 
     ";", "\n", "\t", "$Failed"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"euclideanConstraintsInternal", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "VertexCoordinatesQ"}], " ", ",", " ", "edge_"}], " ",
     "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"EuclideanMotionConstraints", "::", "i"}], ",", " ", "edge"}], 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EuclideanMotionConstraints", "::", "e"}], " ", "=", " ", 
   "\"\<Mechanism of embedding dimension `1` cannot have more than `1` \
vertices specified.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EuclideanMotionConstraints", "::", "c"}], " ", "=", " ", 
   "\"\<One of the vertices of `1` is out of bounds.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EuclideanMotionConstraints", "::", "i"}], " ", "=", " ", 
   "\"\<The vertices of `1` are not all valid.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7204]:=",ExpressionUUID->"e6687d59-c765-432d-9362-dbdcd54ffaf7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Energies", "Section",ExpressionUUID->"6dc83a59-8f2a-4e98-973b-854d49e98ccd"],

Cell[CellGroupData[{

Cell["\<\
minimizeEnergy[], minimizableEnergyQ[], nonNumericVariablesInEnergy[]\
\>", "Subsection",ExpressionUUID->"7f59fc39-026d-4264-9e18-16bd44df04b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "check", " ", "that", " ", "this", " ", "energy", " ", "is", " ", 
    "properly", " ", "numeric"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"minimizableEnergyQ", "[", " ", 
     RowBox[{
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}], " ", ",", " ", 
      "positions_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"VectorQ", "[", " ", 
      RowBox[{
       RowBox[{"energy", "[", "\"\<data\>\"", "]"}], ",", " ", "NumericQ"}], 
      " ", "]"}], " ", "&&", " ", 
     RowBox[{"Quiet", "[", 
      RowBox[{"TrueQ", "[", " ", 
       RowBox[{"energy", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", "positions", "]"}], ",", 
         RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}], " ", "]"}], 
      " ", "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"minimizableEnergyQ", "[", " ", 
     RowBox[{"energy_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", 
    " ", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"N", "[", " ", 
         RowBox[{"energy", " ", "/.", " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}], " ", 
         "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Im", "[", 
         RowBox[{"Chop", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
        "0"}], " ", "&&", " ", 
       RowBox[{"NumericQ", "[", "number", "]"}], " ", "&&", " ", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"Im", "[", "number", "]"}], "]"}], " ", "\[Equal]", " ", 
        "0"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7209]:=",ExpressionUUID->"c753b2a6-b910-4cb3-a41d-139c3d31553f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"return", " ", "a", " ", "list", " ", "of", " ", "non"}], "-", 
    RowBox[{"numeric", " ", "variables"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"nonNumericVariablesInEnergy", "[", " ", 
     RowBox[{
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}], " ", ",", " ", 
      "positions_"}], "  ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"energy", "[", "\"\<data\>\"", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"NumericQ", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{"nonNumericVariablesInEnergy", "[", " ", 
     RowBox[{"energy_", " ", ",", " ", "positions_"}], "  ", "]"}], " ", ":=",
     " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"number", " ", "=", " ", 
        RowBox[{"N", "[", " ", 
         RowBox[{"energy", " ", "/.", " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}], " ", 
         "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"Variables", "[", "number", "]"}]}], "\n", "]"}]}]}]}]], "Code",\

 CellLabel->
  "1/2/24 10:12:07 \
In[7211]:=",ExpressionUUID->"3dcff0a2-80fd-44a1-bd89-bd430e8f846c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{"minimizeEnergy", "[", "\n", "\t\t", 
     RowBox[{"energy", " ", ",", " ", "\n", "\t\t", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"flattened", " ", "vertex", " ", "positions"}], " ", ",", " ", 
        RowBox[{"positions", " ", "we", " ", "minimize", " ", "over"}]}], " ",
        "}"}], ",", " ", "\n", "\t\t", 
      RowBox[{"initial", " ", "positions", " ", "of", " ", "mechanism"}], " ",
       ",", " ", "\n", "\t\t", 
      RowBox[{"options", " ", "for", " ", 
       RowBox[{"FindMinimum", "[", "]"}]}]}], "\n", "\t", "]"}], "\n", "\t", 
    "\n", "\t", "returns", "\n", "\t", "\n", "\t\t", 
    RowBox[{"{", " ", 
     RowBox[{"energy", " ", ",", " ", 
      RowBox[{"flattened", " ", "positions"}]}], "}"}], "\n", "\t", "\n", 
    "\t", "or", "\n", "\t", "\n", "\t\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<error\>\"", "[", "energy", "]"}], ",", " ", 
      RowBox[{"flattened", " ", "positions"}]}], "}"}], " ", "if", " ", "an", 
    " ", "error", " ", "flag", " ", "is", " ", "thrown"}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"minimizeEnergy", "[", " ", 
     RowBox[{
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}], " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"variables_", " ", ",", " ", "namedVariables_"}], "}"}], " ", 
      ",", " ", "positions_", " ", ",", " ", "options_"}], "]"}], " ", ":=", 
    "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"result", " ", ",", " ", 
        RowBox[{"data", " ", "=", " ", 
         RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], " ", ",", " ", 
        RowBox[{"initialNamedVariables", " ", "=", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", "positions", "]"}], " ", ",", " ", 
           "variables", " ", ",", " ", "_VertexPosition"}], "]"}]}]}], "}"}], 
      ",", "\n", "\t", 
      RowBox[{"Check", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"result", " ", "=", " ", 
          RowBox[{"FindMinimum", " ", "@@", " ", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"energy", "[", "\"\<energy\>\"", "]"}], "[", 
              RowBox[{"variables", ",", " ", "data"}], "]"}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"Sequence", " ", "@@", " ", 
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{
                "namedVariables", " ", ",", " ", "initialNamedVariables"}], 
                "}"}], "]"}]}], ",", "\n", "\t\t\t", 
             RowBox[{"Gradient", " ", ":>", " ", 
              RowBox[{
               RowBox[{"energy", "[", "\"\<gradient\>\"", "]"}], "[", 
               RowBox[{"variables", ",", " ", "data"}], "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"Sequence", " ", "@@", " ", "options"}]}], "\n", "\t\t", 
            "}"}]}]}], ";", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"variables", " ", "/.", " ", 
            RowBox[{"Dispatch", "[", 
             RowBox[{"result", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}], "\n", 
        "\t\t", ",", "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"\"\<error\>\"", " ", "@", " ", 
           RowBox[{"result", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], " ", ",", " ", 
          RowBox[{"variables", " ", "/.", " ", 
           RowBox[{"Dispatch", "[", 
            RowBox[{"result", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], " ", "}"}]}], "\n", 
       "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"minimizeEnergy", "[", " ", 
     RowBox[{"energy_", " ", ",", " ", 
      RowBox[{"{", 
       RowBox[{"variables_", " ", ",", " ", "namedVariables_"}], "}"}], " ", 
      ",", " ", "positions_", " ", ",", " ", "options_"}], " ", "]"}], " ", ":=",
     "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"result", " ", ",", " ", 
        RowBox[{"initialNamedVariables", " ", "=", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"Flatten", "[", "positions", "]"}], " ", ",", " ", 
           "variables", " ", ",", " ", "_VertexPosition"}], "]"}]}]}], "}"}], 
      ",", "\n", "\t", 
      RowBox[{"Check", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"result", " ", "=", " ", 
          RowBox[{"FindMinimum", " ", "@@", " ", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{"energy", ",", "\n", "\t\t\t", 
             RowBox[{"Sequence", " ", "@@", " ", 
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{"namedVariables", ",", " ", "initialNamedVariables"}],
                 "}"}], "]"}]}], ",", "\n", "\t\t\t", "options"}], "\n", 
            "\t\t", "}"}]}]}], ";", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"variables", " ", "/.", " ", 
            RowBox[{"Dispatch", "[", 
             RowBox[{"result", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}]}], "\n", 
        "\t\t", ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<error\>\"", " ", "@", " ", 
           RowBox[{"result", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], " ", ",", " ", 
          RowBox[{"variables", " ", "/.", " ", 
           RowBox[{"Dispatch", "[", 
            RowBox[{"result", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], " ", "}"}]}], "\n", 
       "\t", "]"}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7213]:=",ExpressionUUID->"a01b605f-3682-40f9-a3cf-ed565cef7a4f"]
}, Closed]],

Cell[CellGroupData[{

Cell["mobileVariables[]", "Subsection",ExpressionUUID->"5b0b49f0-51e8-493f-92c0-cd02217061a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{"mobileVariables", "[", " ", 
     RowBox[{"mechanism", " ", ",", " ", 
      RowBox[{"constraint", " ", "equations"}], ",", " ", "positions"}], " ", 
     "]"}], " ", "returns", "\n", "\t", "\n", "\t\t", 
    RowBox[{"{", " ", "\n", "\t\t", 
     RowBox[{
      RowBox[{
      "flattened", " ", "list", " ", "of", " ", "all", " ", "vertex", " ", 
       "positions", " ", "satisfying", " ", "linear", " ", "constraints"}], 
      " ", ",", " ", "\n", "\t\t", 
      RowBox[{"only", " ", "minimizable", " ", "variables"}]}], "\n", "\t\t", 
     "}"}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"mobileVariables", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "constraints_"}], " ", "]"}], " ", ":=", " ",
    "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"processConstraintEquations", "[", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", 
            "constraints"}], " ", "]"}], "[", "\"\<constrained positions\>\"",
           "]"}], "]"}]}], ",", "\n", "\t", "namedVariableSelector"}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"namedVariableSelector", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", " ", 
          RowBox[{"#", ",", " ", "_VertexPosition"}], "]"}], " ", "&"}], " ", 
        "/@", " ", "variables"}]}], ";", "\n", "\t", 
      RowBox[{"{", " ", 
       RowBox[{"variables", " ", ",", " ", 
        RowBox[{"Pick", "[", 
         RowBox[{"variables", " ", ",", " ", "namedVariableSelector"}], 
         "]"}]}], " ", "}"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7215]:=",ExpressionUUID->"7e6d6bb8-169f-41e0-8b1a-013b6e5152b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["evaluateEnergy[]", "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", " ", 
     RowBox[{
      RowBox[{"(", "m", ")"}], ",", " ", 
      RowBox[{"(", "positions", ")"}], ",", " ", "energy"}], " ", "]"}], " ", 
    "evaluates", " ", "the", " ", "energy", " ", 
    RowBox[{"(", 
     RowBox[{"or", " ", "compiled", " ", "energy"}], ")"}], " ", "in", " ", 
    "a", " ", "number", " ", "of", " ", "different", " ", 
    RowBox[{"ways", "."}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"energy", ":", " ", 
       RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
     "\n", "\t", 
    RowBox[{"energy", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"energy", ":", " ", 
       RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
     "\n", "\t", 
    RowBox[{"energy", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
        "positions"}], "]"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"energy", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "[", 
     RowBox[{
      RowBox[{"Flatten", "[", "positions", "]"}], ",", 
      RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"energy", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "[", 
     RowBox[{"positions", ",", 
      RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n", "\t", 
   "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"energy", ":", " ", 
       RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
     "\n", "\t", 
    RowBox[{"energy", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"PositionRules", "[", "positions", "]"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"energy", ":", " ", 
       RowBox[{"Except", "[", "_CompiledMechanismEnergy", "]"}]}]}], "]"}], ":=",
     "\n", "\t", 
    RowBox[{"energy", " ", "/.", " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "\[Rule]", 
        "positions"}], "]"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"energy", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "[", 
     RowBox[{
      RowBox[{"Flatten", "[", "positions", "]"}], ",", 
      RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"evaluateEnergy", "[", 
     RowBox[{
      RowBox[{"positions_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"energy_", "?", "CompiledMechanismEnergyQ"}]}], "]"}], ":=", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"energy", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "[", 
     RowBox[{"positions", ",", 
      RowBox[{"energy", "[", "\"\<data\>\"", "]"}]}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7216]:=",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismEnergy[]", "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
    "$DefaultMechanismStiffnesses", "[", "\"\<SmallestLength\>\"", "]"}], "=", 
    RowBox[{"10", "^", 
     RowBox[{"(", 
      RowBox[{"-", "6"}], ")"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$DefaultMechanismStiffnesses", "::", "err"}], "=", 
   "\"\<`1` does not have a default stiffness.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$DefaultMechanismStiffnesses", "[", "s_", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"$DefaultMechanismStiffnesses", "::", "err"}], ",", "s"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7224]:=",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismEnergy", "]"}], " ", "=", " ", "\n", 
    "\t", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"SetParameters", " ", "->", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}], " ", ",", " ", 
      RowBox[{"ConstraintModulus", " ", "->", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}]}]}], ",", " ", 
      RowBox[{"ReduceLinearConstraints", " ", "->", " ", "True"}]}], " ", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismEnergy", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", "=", 
      RowBox[{"mechanismEnergyInternal", "[", " ", 
       RowBox[{"m", " ", ",", " ", 
        RowBox[{"VertexPosition", "[", "m", "]"}], " ", ",", " ", 
        RowBox[{"OptionValue", "[", "Constraints", "]"}], " ", ",", " ", 
        RowBox[{"OptionValue", "[", "ConstraintModulus", "]"}], " ", ",", " ", 
        RowBox[{"OptionValue", "[", "CellPattern", "]"}], " ", ",", " ", 
        RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], " ", 
        ",", " ", 
        RowBox[{"OptionValue", "[", "SetParameters", "]"}]}], " ", "]"}]}], 
     "}"}], ",", "\n", "\t\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "mechanismEnergyInternal"}]}]}], "\n", "\t", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_"}], "]"}], " ",
      ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", "=", 
        RowBox[{"mechanismEnergyInternal", "[", " ", 
         RowBox[{"m", " ", ",", " ", "pos", " ", ",", " ", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", "  ", 
          RowBox[{"OptionValue", "[", "ConstraintModulus", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "CellPattern", "]"}], " ", ",", " ", 
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], ",", 
          " ", 
          RowBox[{"OptionValue", "[", "SetParameters", "]"}]}], " ", "]"}]}], 
       " ", "}"}], ",", "\n", "\t\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "mechanismEnergyInternal"}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", " ", 
     RowBox[{"m", " ", ",", " ", "pos"}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "::", "pos"}], "=", 
   "\"\<Positions `1` cannot correspond to mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "pos_"}], " ", "]"}],
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismEnergy", "::", "pos"}], ",", " ", "pos"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "::", "param"}], "=", 
   "\"\<Option SetParameters -> `1` should be a list of replacement \
rules.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7227]:=",ExpressionUUID->"680aac2e-d58b-40c8-b7d4-ea52edea8b7d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismEnergyInternal", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", ",", " ", "inputConstraints_", ",", " ", 
     RowBox[{"constraintScale_", "?", "NumericQ"}], ",", "  ", "pattern_", 
     " ", ",", " ", "reduceLinearConstraints_", ",", " ", "setparams_"}], " ",
     "]"}], " ", ":=", " ", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"constraints", " ", "=", " ", 
        RowBox[{
        "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", " ", 
         
         RowBox[{
          RowBox[{"PlaceVertices", "[", 
           RowBox[{"m", ",", "positions"}], "]"}], ",", " ", 
          "inputConstraints"}], " ", "]"}]}], "}"}], ",", "\n", 
      RowBox[{"With", "[", "\n", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"components", " ", "=", " ", 
           RowBox[{"cellData", "[", 
            RowBox[{"m", ",", " ", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
             "pattern"}], "]"}]}], ",", "\n", "\t", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "process", " ", "only", " ", "the", " ", "added", " ", 
             "constraints", " ", "here"}], ";", " ", 
            RowBox[{
            "linear", " ", "constraints", " ", "here", " ", "will", " ", "be",
              " ", "eliminated", " ", "automatically"}]}], "*)"}], "\n", "\t", 
          RowBox[{"constraintData", " ", "=", " ", 
           RowBox[{"processConstraintEquations", "[", 
            RowBox[{
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", ",", 
             " ", "constraints"}], "]"}]}], ",", "\n", "\t", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"if", " ", "requested"}], ",", " ", 
            RowBox[{
            "solve", " ", "all", " ", "the", " ", "linear", " ", 
             "constraints", " ", "here", " ", "including", " ", "those", " ", 
             "from", " ", "cells"}]}], "*)"}], "\n", "\t", 
          RowBox[{"linearConstraints", " ", "=", " ", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", "reduceLinearConstraints", "]"}], ",", " ",
              "\n", "\t\t", 
             RowBox[{"MechanismLinearConstraints", "[", " ", 
              RowBox[{"m", ",", " ", 
               RowBox[{"Constraints", " ", "->", " ", "constraints"}]}], " ", 
              "]"}], ",", "\n", "\t\t", 
             RowBox[{"{", "}"}]}], "]"}]}], ",", "\n", "\t", 
          RowBox[{"arbitraryPositions", " ", "=", " ", 
           RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", "\n", "\t", 
          RowBox[{"params", " ", "=", " ", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"MatchQ", "[", 
              RowBox[{"setparams", ",", " ", 
               RowBox[{"{", "___Rule", "}"}]}], "]"}], " ", ",", " ", 
             "setparams", ",", " ", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{
                RowBox[{"MechanismEnergy", "::", "param"}], ",", " ", 
                "setparams"}], "]"}], ";", " ", 
              RowBox[{"{", "}"}]}]}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", " ", "@", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "\n", "\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"cellEnergy", "[", 
                 RowBox[{"m", ",", " ", 
                  RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
                  " ", "positions", ",", " ", "#"}], "]"}], "&"}], " ", "/@", 
               " ", "components"}], ",", "\n", "\t\t", 
              RowBox[{"constraintScale", " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                  "constraintData", "[", "\"\<nonlinear constraints\>\"", 
                   "]"}], " ", ".", " ", 
                  RowBox[{
                  "constraintData", "[", "\"\<nonlinear constraints\>\"", 
                   "]"}]}], ")"}], "/", "2"}]}]}], "\n", "\t", "}"}], "]"}]}],
           " ", "/.", " ", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{"TrueQ", "[", " ", "reduceLinearConstraints", "]"}], ",", 
            " ", "linearConstraints", ",", " ", 
            RowBox[{
            "constraintData", "[", "\"\<linear solutions\>\"", "]"}]}], " ", 
           "]"}]}], " ", "/.", " ", "params"}]}], "\n", "]"}]}], "]"}], " ", "/;",
     " ", 
    RowBox[{"Which", "[", "\n", "\t\t\t", 
     RowBox[{
      RowBox[{"constraintScale", " ", "<", " ", "0"}], ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MechanismEnergy", "::", "scale"}], ",", " ", 
         "constraintScale"}], "]"}], ";", " ", "False"}], ",", " ", "\n", 
      "\t\t\t", 
      RowBox[{"Not", "[", 
       RowBox[{"BooleanQ", "[", "reduceLinearConstraints", "]"}], "]"}], ",", 
      " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismEnergy", "::", "red"}], "]"}], ";", " ", "False"}], 
      ",", "\n", "\t\t\t", "True", ",", " ", "True"}], "\n", "\t", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "::", "scale"}], "=", 
   "\"\<Constraint modulus `1` should be a non-negative number.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismEnergy", "::", "red"}], "=", 
   "\"\<Option ReduceLinearConstraints must be Boolean.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7233]:=",ExpressionUUID->"64b80402-9692-43c6-ade1-c477b2b2a0a8"]
}, Closed]],

Cell[CellGroupData[{

Cell["CompiledMechanismEnergy[] data structure", "Subsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<variables\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", "\n", 
  RowBox[{"StringJoin", "[", "\n", "\t", 
   RowBox[{"\"\<CompiledMechanismEnergy[\>\"", ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "variables", "]"}], "<", "10"}], ",", "\n", 
      "\t\t", 
      RowBox[{"ToString", "[", "variables", "]"}], ",", "\n", "\t\t", 
      RowBox[{"\"\<{\>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{
         RowBox[{"First", "[", "variables", "]"}], "<>", "\"\<...\>\"", "<>", 
         
         RowBox[{"Last", "[", "variables", "]"}], "<>", "\"\<}\>\""}], 
        "]"}]}]}], "\n", "\t", "]"}], ",", "\n", "\t", "\"\<]\>\""}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7236]:=",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
      RowBox[{"variables_", "?", "VectorQ"}], ",", "energy_CompiledFunction", 
      ",", "gradient_CompiledFunction"}], "]"}], "[", "\"\<data\>\"", "]"}], ":=",
    "variables"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CompiledMechanismEnergy", "[", 
     RowBox[{
     "variables_List", ",", "energy_CompiledFunction", ",", 
      "gradient_CompiledFunction"}], "]"}], "[", "\"\<energy\>\"", "]"}], "[", 
   RowBox[{
    RowBox[{"pos_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", "data_"}],
    "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"energy", "[", 
   RowBox[{"pos", ",", "data"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CompiledMechanismEnergy", "[", 
      RowBox[{
      "variables_List", ",", "energy_CompiledFunction", ",", 
       "gradient_CompiledFunction"}], "]"}], "[", "\"\<gradient\>\"", "]"}], 
    "[", 
    RowBox[{
     RowBox[{"pos_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
     "data_"}], "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"gradient", "[", 
    RowBox[{"pos", ",", "data"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_List", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "[", 
   RowBox[{"v_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{"CompiledMechanismEnergy", "[", 
   RowBox[{"v", ",", "energy", ",", "gradient"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7238]:=",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
CompiledMechanismEnergyQ[], compiledNumericalMechanismEnergyQ[]\
\>", "Subsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CompiledMechanismEnergyQ", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", "variables", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergyQ", "[", "_", "]"}], ":=", "False"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", 
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
    "variables_", ",", "energy_CompiledFunction", ",", 
     "gradient_CompiledFunction"}], "]"}], "]"}], ":=", 
  RowBox[{"VectorQ", "[", 
   RowBox[{"variables", ",", "NumericQ"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"compiledNumericalMechanismEnergyQ", "[", "_", "]"}], ":=", 
  "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7242]:=",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],

Cell[CellGroupData[{

Cell["CompiledMechanismEnergy[]", "Subsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "CompiledMechanismEnergy", "]"}], " ", ":=", " ", 
  RowBox[{"Join", "[", "\n", "\t", 
   RowBox[{"(*", 
    RowBox[{
    "this", " ", "is", " ", "going", " ", "to", " ", "be", " ", "set", " ", 
     "to", " ", "False", " ", "permanently", " ", "for", " ", "this", " ", 
     "function", " ", "just", " ", "in", " ", "case"}], "*)"}], "\n", "\t", 
   RowBox[{
    RowBox[{"FilterRules", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
      RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", "]"}], 
    ",", "\n", "\t", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"AddedEnergy", "\[Rule]", "0"}], ",", "\n", "\t", 
      RowBox[{"CompilationTarget", " ", "->", " ", "Automatic"}]}], "\n", 
     "\t", "}"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7246]:=",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"compiledmechanismEnergyInternal", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{
         "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
          RowBox[{"m", ",", 
           RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], "]"}], ",", 
         "\n", "\t\t\t\t\t\t", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}], ",", 
         "\n", "\t\t\t\t\t\t", 
         RowBox[{"OptionValue", "[", "CompilationTarget", "]"}]}], " ", "\n", 
        "\t\t\t\t\t", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "::", "pos"}], "=", 
   "\"\<Provided positions `1` do not correspond to Mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"CompiledMechanismEnergy", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_", " ", ",", " ", 
    "___"}], " ", "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"CompiledMechanismEnergy", "::", "pos"}], ",", " ", "pos"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "::", "comp"}], " ", "=", " ", 
   "\"\<CompilationTarget `1` is not a string or Automatic. Using \
Automatic.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7247]:=",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"compiledmechanismEnergyInternal", "[", 
    RowBox[{
    "m_", ",", " ", "additionalEnergy_", " ", ",", " ", "energyOptions_", ",",
      " ", "compilationTarget_"}], "]"}], ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"symbols", ",", " ", "uniqueSymbols", ",", "\n", "\t", 
       RowBox[{"arbitraryPositions", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", "\n", 
       "\t", 
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"MechanismEnergy", "[", " ", 
          RowBox[{"m", " ", ",", " ", "\n", "\t\t\t\t\t", 
           RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], " ", 
           ",", " ", 
           RowBox[{"Sequence", " ", "@@", " ", "energyOptions"}]}], "\n", 
          "\t\t\t", "]"}], " ", "+", " ", 
         RowBox[{
         "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
          RowBox[{"m", ",", " ", "additionalEnergy"}], "]"}]}]}], ",", "\n", 
       "\t", "modifiedEnergy", ",", "\n", "\n", "\t", 
       RowBox[{"compilationTargetActual", " ", "=", " ", 
        RowBox[{"Which", "[", " ", "\n", "\t\t", 
         RowBox[{
          RowBox[{"compilationTarget", " ", "===", " ", "Automatic"}], ",", 
          " ", "$MechanismCompilationTarget", ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Head", "[", "compilationTarget", "]"}], " ", "===", " ", 
           "String"}], " ", ",", " ", "compilationTarget", ",", "\n", "\t\t", 
          "True", ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"CompiledMechanismEnergy", "::", "comp"}], ",", " ", 
             "compilationTarget"}], "]"}], ";", "\n", "\t\t\t", 
           "$MechanismCompilationTarget"}]}], "\n", "\t\t", "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "energy", "]"}], " ", "===", " ", 
        "MechanismEnergy"}], ",", " ", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"if", " ", "you", " ", "are", " ", "here"}], ",", " ", 
         RowBox[{
         "somehow", " ", "the", " ", "mechanism", " ", "energy", " ", 
          RowBox[{"failed", ".", "\n", "\t\t", "It"}], " ", "may", " ", "not",
           " ", "always", " ", "return", " ", "an", " ", "error", " ", "so", 
          " ", "make", " ", "sure", " ", "this", " ", "function", " ", 
          "returns", " ", 
          RowBox[{"one", "."}]}]}], "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"CompiledMechanismEnergy", "::", "en"}], "]"}], ";", "\n", 
        "\t\t", "$Failed"}], ",", "\n", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{
        "get", " ", "all", " ", "symbols", " ", "we", " ", "need", " ", "to", 
         " ", "declare", " ", "that", " ", "are", " ", "not", " ", 
         "positions"}], "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"symbols", " ", "=", " ", 
         RowBox[{"DeleteDuplicates", "[", " ", 
          RowBox[{"DeleteCases", "[", "  ", 
           RowBox[{
            RowBox[{"Select", "[", " ", 
             RowBox[{
              RowBox[{"Cases", "[", " ", 
               RowBox[{"energy", ",", " ", 
                RowBox[{"_Symbol", "|", 
                 RowBox[{"_Symbol", "[", "_", "]"}]}], ",", " ", "Infinity"}],
                "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Not", "[", 
                RowBox[{"NumericQ", "[", "#", "]"}], "]"}], "&"}]}], " ", 
             "]"}], ",", " ", "_VertexPosition"}], " ", "]"}], " ", "]"}]}], 
        ";", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "give", " ", "them", " ", "all", " ", "unique", " ", "names"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"uniqueSymbols", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Unique", "[", "]"}], "&"}], " ", "/@", " ", "symbols"}]}],
         ";", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "rewrite", " ", "the", " ", "energy", " ", "in", " ", "terms", " ", 
          "of", " ", "the", " ", "new", " ", "symbols"}], "*)"}], "\n", 
        "\t\t", 
        RowBox[{"modifiedEnergy", " ", "=", " ", 
         RowBox[{"energy", " ", "/.", " ", 
          RowBox[{"Dispatch", "[", 
           RowBox[{"Thread", "[", " ", 
            RowBox[{"symbols", " ", "->", " ", "uniqueSymbols"}], "]"}], 
           "]"}]}]}], ";", "\n", "\n", "\t\t", 
        RowBox[{"Check", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"CompiledMechanismEnergy", "[", "\n", "\t\t\t\t", 
           RowBox[{"symbols", ",", "\n", "\t\t\t\t", 
            RowBox[{"compileExpression", "[", " ", 
             RowBox[{
             "modifiedEnergy", ",", " ", "arbitraryPositions", ",", " ", 
              "uniqueSymbols", ",", " ", "compilationTargetActual"}], "]"}], 
            ",", "\n", "\t\t\t\t", 
            RowBox[{"compileExpression", "[", " ", 
             RowBox[{
              RowBox[{"D", "[", " ", 
               RowBox[{"modifiedEnergy", ",", " ", 
                RowBox[{"{", "arbitraryPositions", "}"}]}], " ", "]"}], ",", 
              " ", "arbitraryPositions", ",", " ", "uniqueSymbols", ",", " ", 
              "compilationTargetActual"}], "]"}]}], "\n", "\t\t\t", "]"}], 
          ",", "\n", "\t\t\t", "$Failed"}], "\n", "\t\t", "]"}]}]}], "\n", 
      "\t", "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CompiledMechanismEnergy", "::", "en"}], "=", 
   "\"\<Unable to find an expression for the mechanism energy.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7251]:=",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"compileExpression", "[", 
   RowBox[{
   "expression_", ",", " ", "variables_", " ", ",", " ", "symbols_", ",", " ",
     "compiler_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
     "body", ",", "\n", "injector", ",", "c", ",", "\n", "dataInjector", ",", 
      "data"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{"rules", " ", "to", " ", "replace", " ", 
      RowBox[{"VertexPosition", "[", " ", 
       RowBox[{"n", " ", ",", " ", "c"}], " ", "]"}], " ", "with", " ", 
      RowBox[{"c", "[", 
       RowBox[{"[", " ", "m", " ", "]"}], "]"}], " ", "where", " ", "m", " ", 
      "is", " ", "associated", " ", "with", " ", "the", " ", "relevant", " ", 
      "variable"}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"injector", " ", "=", " ", 
      RowBox[{"Dispatch", " ", "@", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{"variables", " ", "->", " ", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"c", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "variables"}], "]"}]}], " ", ")"}]}], " ", 
        "]"}]}]}], ";", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "rules", " ", "to", " ", "replace", " ", "data", " ", "with", " ", "an",
        " ", "element", " ", "of", " ", "corresponding", " ", "data", " ", 
       "matrix"}], "  ", "*)"}], "\n", "\t", 
     RowBox[{"dataInjector", " ", "=", " ", 
      RowBox[{"Dispatch", " ", "@", " ", 
       RowBox[{"Thread", "[", " ", 
        RowBox[{"symbols", " ", "->", " ", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Hold", "[", 
             RowBox[{"data", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "@", "symbols"}], "]"}]}], " ", ")"}]}], " ", 
        "]"}]}]}], ";", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "rewrite", " ", "the", " ", "body", " ", "of", " ", "the", " ", 
       "energy", " ", "using", " ", "the", " ", "rules"}], "*)"}], "\n", "\t", 
     RowBox[{"body", "=", 
      RowBox[{
       RowBox[{"expression", " ", "/.", " ", "injector"}], " ", "/.", " ", 
       "dataInjector"}]}], " ", ";", "\n", "\n", "\t", 
     RowBox[{"ReleaseHold", "[", 
      RowBox[{
       RowBox[{"Hold", "[", "Compile", "]"}], "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c", ",", "_Real", ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"data", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", 
        "\n", "\t\t", "body", ",", "\n", "\t\t", 
        RowBox[{"RuntimeOptions", " ", "->", " ", 
         RowBox[{"{", " ", 
          RowBox[{"\"\<Speed\>\"", ",", " ", 
           RowBox[{
           "\"\<EvaluateSymbolically\>\"", " ", "->", " ", "False"}]}], " ", 
          "}"}]}], ",", "\n", "\t\t", 
        RowBox[{"CompilationTarget", " ", "->", " ", "compiler"}], ",", "\n", 
        "\t\t", 
        RowBox[{"Parallelization", " ", "\[Rule]", " ", "True"}]}], "\n", 
       "\t", "]"}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7253]:=",ExpressionUUID->"3d48ee61-3e79-48c8-af84-09f3702fc2ea"]
}, Closed]],

Cell[CellGroupData[{

Cell["MinimizeMechanismEnergy[]", "Subsection",ExpressionUUID->"0955fd1d-b186-4700-ba07-6ea578777560"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MinimizeMechanismEnergy", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"initial", " ", "positions", " ", "for", " ", "the", " ", 
        RowBox[{"minimization", "."}]}], "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"InitialPositions", " ", "->", " ", "Automatic"}], ",", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{
        "should", " ", "we", " ", "include", " ", "\"\<error\>\"", " ", 
         "head", " ", "around", " ", "the", " ", "energy", " ", "of", " ", 
         "a", " ", "minimization", " ", "that", " ", "produced", " ", 
         RowBox[{"errors", "?"}]}], "*)"}], "\n", "\t", 
       RowBox[{"\"\<IncludeError\>\"", " ", "->", " ", "False"}]}], "\n", 
      "\t", "}"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{"this", " ", 
       RowBox[{"isn", "'"}], "t", " ", "adjustable", " ", "in", " ", "this", 
       " ", "function"}], "*)"}], "\n", "\t", 
     RowBox[{"FilterRules", "[", " ", 
      RowBox[{
       RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
       RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", "]"}], 
     ",", " ", "\n", "\t", 
     RowBox[{"Options", "[", "FindMinimum", "]"}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"MinimizeMechanismEnergy", ",", "HoldRest"}], "]"}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "badinitial"}], "=", 
   "\"\<Initial conditions are not well-formed numeric positions matching the \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "data"}], "=", 
   "\"\<Data `1` is not numerical. Use Replace to substitute numerical \
values.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], "=", 
   "\"\<Energy is not numerical at initial condition. Non-numeric variables \
are `1`\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7254]:=",ExpressionUUID->"fed80f7a-0219-4694-a02d-6cde06ffe917"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"energy", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], "[", 
   RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"MinimizeMechanismEnergy", "[", " ", 
       RowBox[{"m", ",", " ", "energy", ",", " ", "opt"}], " ", "]"}]}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], "===", "List"}], " ", ",", " ", 
      RowBox[{"PlaceVertices", "[", 
       RowBox[{"res", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", ",", " ", "m"}], "]"}]}], 
   "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergy", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"minimizeMechanismEnergyInternal", "[", " ", 
        RowBox[{"m", ",", " ", "Automatic", ",", " ", "Automatic", ",", " ", 
         RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
     "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], "===", "List"}], " ", ",", " ", 
       RowBox[{"PlaceVertices", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"res", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", ",", " ", "m"}], 
      "]"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MinimizeMechanismEnergy", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"energy", " ", ":", " ", 
     RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], ",",
     " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"minimizeMechanismEnergyInternal", "[", " ", 
       RowBox[{"m", ",", " ", "energy", ",", " ", 
        RowBox[{"OptionValue", "[", "InitialPositions", "]"}], ",", " ", 
        RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
    "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_"}], "]"}], 
     ",", " ", 
     RowBox[{"energy", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"minimizeMechanismEnergyInternal", "[", " ", 
         RowBox[{"m", ",", " ", "energy", ",", " ", "positions", ",", " ", 
          RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}], " ", "/;",
     " ", 
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "positions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MinimizeMechanismEnergy", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_"}], "]"}], 
     ",", " ", 
     RowBox[{"energy", " ", ":", " ", 
      RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", "Automatic"}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", "\t", 
   
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MinimizeMechanismEnergy", "::", "pos"}], ",", " ", 
      "positions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MinimizeMechanismEnergy", "::", "pos"}], "=", 
    "\"\<Deformed positions `1` are not numeric positions corresponding to \
mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"minimizeMechanismEnergyInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "energyExpression_", ",", " ", "initial_", ",", " ", 
    "opt_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{"minimizeMechanismEnergyComputeEnergy", "[", 
        RowBox[{"m", ",", " ", "energyExpression", ",", " ", "opt"}], " ", 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"minimizeMechanismEnergyInitialPositions", "[", 
        RowBox[{"m", ",", " ", "initial"}], " ", "]"}]}], ",", "\n", "\t", 
      "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"energy", " ", "=!=", " ", "$Failed"}], " ", "&&", " ", 
       RowBox[{"initialPositions", " ", "=!=", " ", "$Failed"}]}], ",", "\n", 
      "\t\t", 
      RowBox[{"(*", 
       RowBox[{
       "do", " ", "the", " ", "minimization", " ", "and", " ", "format", " ", 
        "the", " ", "results", " ", "for", " ", "output"}], "*)"}], "\n", 
      "\t\t", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"Map", "[", " ", 
         RowBox[{"minimizeMechanismEnergyOutputFormat", ",", " ", 
          RowBox[{"minimizeFindMinimum", "[", " ", 
           RowBox[{
           "m", ",", " ", "energy", ",", " ", "initialPositions", ",", " ", 
            "opt"}], " ", "]"}]}], " ", "]"}]}], ";", "\n", "\n", "\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", " ", 
           RowBox[{"Dimensions", "[", "initial", "]"}], " ", "]"}], " ", 
          "\[Equal]", " ", "3"}], ",", " ", "\n", "\t\t\t", 
         RowBox[{"Merge", "[", 
          RowBox[{"res", ",", "Identity"}], "]"}], ",", " ", "\n", "\t\t\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"TrueQ", "[", 
            RowBox[{"OptionValue", "[", "\"\<IncludeError\>\"", "]"}], "]"}], 
           ",", " ", 
           RowBox[{"First", "[", "res", "]"}], ",", " ", 
           RowBox[{
            RowBox[{"Values", "[", 
             RowBox[{"First", "[", "res", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}]}], "\n", "\t\t", 
        "]"}]}], ",", "\n", "\t\t", "$Failed"}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:07 \
In[7259]:=",ExpressionUUID->"d10bd735-0609-4734-b483-4b53e1dfbcf9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{"parse", " ", "the", " ", "initial", " ", "positions"}], "\n", 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"minimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "}"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", 
    " ", 
    RowBox[{
     RowBox[{"{", "initialPositions", "}"}], " ", "/;", " ", 
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "initialPositions"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"initialPositions_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ArrayQ", "[", 
          RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"initialPositions", " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "initialPositions", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}], " ", "\[Equal]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], ",", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}]}]}]}], 
   "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyInitialPositions", "[", " ", 
     RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MinimizeMechanismEnergy", "::", "badinitial"}], "]"}], ";", 
      " ", "$Failed"}], ")"}]}], "\n", "\n", 
   RowBox[{"(*", "\n", "\t", 
    RowBox[{"parse", " ", "the", " ", "energy", " ", "we", " ", "want"}], 
    "\n", "*)"}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic", ",", " ", "options_"}], " ", "]"}], 
    " ", ":=", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"en", "=", 
        RowBox[{"MechanismEnergy", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "options", "}"}], ",", " ", 
            RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}]}], " ", 
         "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"minimizableEnergyQ", "[", 
         RowBox[{"en", ",", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",", 
        " ", "\n", "\t\t", "en", ",", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], ",", " ", 
           RowBox[{"nonNumericVariablesInEnergy", "[", 
            RowBox[{"en", ",", " ", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}]}], 
          " ", "]"}], ";", " ", "$Failed"}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"energy_", "?", "compiledNumericalMechanismEnergyQ"}], ",", " ",
       "options_"}], " ", "]"}], " ", ":=", " ", "\n", "\t", 
    RowBox[{"If", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{
        RowBox[{"energy", "[", "\"\<data\>\"", "]"}], ",", " ", "NumericQ"}], 
       "]"}], ",", "\n", "\t\t", "energy", ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], ",", " ", 
         RowBox[{"Select", "[", " ", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<data\>\"", "]"}], " ", ",", " ", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Not", "[", 
               RowBox[{"NumericQ", "[", "#", "]"}], "]"}], "&"}], ")"}]}]}], 
          " ", "]"}]}], "]"}], ";", " ", "$Failed"}]}], "\n", "\t", "]"}]}], 
   "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyComputeEnergy", "[", " ", 
     RowBox[{"m_", ",", " ", "analyticEnergy_", ",", " ", "options_"}], " ", 
     "]"}], " ", ":=", " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"en", " ", "=", " ", 
        RowBox[{
        "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
         RowBox[{"m", ",", "analyticEnergy"}], "]"}]}], "\n", "\t", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"If", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"minimizableEnergyQ", "[", 
         RowBox[{"en", ",", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",", 
        "\n", "\t\t", "en", ",", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MinimizeMechanismEnergy", "::", "energy"}], ",", " ", 
           RowBox[{"nonNumericVariablesInEnergy", "[", 
            RowBox[{"en", ",", " ", 
             RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}]}], 
          " ", "]"}], ";", " ", "$Failed"}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{"(*", "\n", "\t", "output", "\n", "*)"}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyOutputFormat", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<error\>\"", "[", "energy_", "]"}], ",", " ", 
       "positions_"}], "}"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"<|", " ", 
     RowBox[{
      RowBox[{"\"\<Error\>\"", "->", "True"}], ",", " ", 
      RowBox[{"\"\<Energy\>\"", "->", "energy"}], ",", " ", 
      RowBox[{"\"\<VertexCoordinates\>\"", "->", 
       RowBox[{"ToPackedArray", "[", 
        RowBox[{"N", "[", 
         RowBox[{"positions", ",", 
          RowBox[{"Precision", "[", "positions", "]"}]}], "]"}], "]"}]}]}], 
     " ", "|>"}]}], "\n", 
   RowBox[{
    RowBox[{"minimizeMechanismEnergyOutputFormat", "[", " ", 
     RowBox[{"{", 
      RowBox[{"energy_", ",", " ", "positions_"}], "}"}], " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"<|", " ", 
     RowBox[{
      RowBox[{"\"\<Error\>\"", "->", "False"}], ",", " ", 
      RowBox[{"\"\<Energy\>\"", "->", "energy"}], ",", " ", 
      RowBox[{"\"\<VertexCoordinates\>\"", "->", 
       RowBox[{"ToPackedArray", "[", 
        RowBox[{"N", "[", 
         RowBox[{"positions", ",", 
          RowBox[{"Precision", "[", "positions", "]"}]}], "]"}], "]"}]}]}], 
     " ", "|>"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7266]:=",ExpressionUUID->"ce7d3d73-9a5e-4531-a957-f2dc9a718060"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
   "actually", " ", "do", " ", "the", " ", "minimization", " ", "over", " ", 
    "all", " ", "the", " ", "initial", " ", "positions"}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"minimizeFindMinimum", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "energy_", " ", ",", " ", "initialPositions_", " ", 
     ",", " ", "options_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "process", " ", "the", " ", "constraints", " ", "based", " ", "on", 
        " ", "internal", " ", "vertex", " ", "coordinates"}], "*)"}], "\n", 
      "\t", 
      RowBox[{
      "constraints", ",", "\n", "\t", "constraintData", " ", ",", "\n", "\n", 
       "\t", 
       RowBox[{"(*", 
        RowBox[{"get", " ", "the", " ", "data", " ", "provided"}], "*)"}], 
       "\n", "\t", 
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{"compiledNumericalMechanismEnergyQ", "[", "energy", "]"}], 
          ",", " ", 
          RowBox[{"energy", "[", "\"\<data\>\"", "]"}], ",", " ", 
          RowBox[{"{", "}"}]}], " ", "]"}]}], ",", "\n", "\n", "\t", 
       RowBox[{"(*", "variables", "*)"}], "\n", "\t", "constrainedPositions", 
       ",", " ", "selector", ",", " ", "components", ",", "\n", "\t", 
       "variables", ",", " ", "initialMinimizationRules", ",", "\n", "\n", 
       "\t", 
       RowBox[{"minimizationOptions", " ", "=", " ", 
        RowBox[{"FilterRules", "[", " ", 
         RowBox[{
          RowBox[{"FilterRules", "[", 
           RowBox[{"options", ",", " ", 
            RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}], ",", " ", 
          RowBox[{"Except", "[", "Gradient", "]"}]}], " ", "]"}]}], ",", "\n",
        "\t", "\n", "\t", "minimizationResults", ",", " ", "tmp"}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "get", " ", "the", " ", "constrained", " ", "positions", " ", "for", 
       " ", "each", " ", "initial", " ", "position", " ", "we", " ", "want", 
       " ", "to", " ", "consider"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"constraints", " ", "=", " ", 
       RowBox[{"MechanismConstraintMap", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"Sequence", " ", "@@", " ", 
          RowBox[{"FilterRules", "[", " ", 
           RowBox[{"options", " ", ",", " ", 
            RowBox[{"Options", "[", "MechanismConstraintMap", "]"}]}], " ", 
           "]"}]}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"constraintData", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"processConstraintEquations", "[", " ", 
          RowBox[{
           RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", 
           "constraints"}], " ", "]"}], "&"}], " ", "/@", " ", 
        "initialPositions"}]}], " ", ";", "\n", "\t", 
      RowBox[{"constrainedPositions", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"N", "[", 
          RowBox[{"Flatten", "[", " ", 
           RowBox[{"#", "[", "\"\<constrained positions\>\"", "]"}], " ", 
           "]"}], "]"}], " ", "&"}], " ", "/@", " ", "constraintData"}]}], 
      " ", ";", "\n", "\n", "\t", 
      RowBox[{"(*", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{
        "what", " ", "variables", " ", "are", " ", "we", " ", "actually", " ",
          "minimizing", " ", 
         RowBox[{"over", "?", "\n", "\t\t", "\n", "\t\t", "note"}], " ", 
         "that", " ", "the", " ", "variables", " ", "we", " ", "will", " ", 
         "minimize", " ", "over", " ", "should", " ", "always", " ", "be", 
         " ", 
         RowBox[{"VertexPositions", ".", " ", "Therefore"}]}], ",", " ", 
        RowBox[{
        "to", " ", "identify", " ", "which", " ", "ones", " ", "we", " ", 
         "can", " ", "minimize", " ", "over"}], ",", " ", 
        RowBox[{
        "we", "\n", "\t\t", "just", " ", "need", " ", "to", " ", "identify", 
         " ", "the", " ", "constrained", " ", "positions", " ", "that", " ", 
         "have", " ", "the", " ", "form", " ", "of", " ", "a", " ", "pure", 
         " ", 
         RowBox[{
          RowBox[{"VertexPosition", "[", "]"}], "."}]}]}], "\n", "\t", "*)"}],
       "\n", "\t", 
      RowBox[{"selector", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"#", ",", " ", 
           RowBox[{"VertexPosition", "[", 
            RowBox[{"_", ",", "_"}], "]"}]}], " ", "]"}], "&"}], " ", "/@", 
        " ", 
        RowBox[{"constrainedPositions", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\n", "\t", 
      RowBox[{"variables", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", " ", 
        RowBox[{"Pick", "[", " ", 
         RowBox[{
          RowBox[{"constrainedPositions", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "selector"}], " ", 
         "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"initialMinimizationRules", " ", "=", " ", 
       RowBox[{"Thread", " ", "/@", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], ",", " ", 
            RowBox[{"Length", "[", "initialPositions", "]"}]}], " ", "]"}], 
          " ", "->", "  ", 
          RowBox[{"(", 
           RowBox[{"Flatten", " ", "/@", " ", "initialPositions"}], ")"}]}], 
         "]"}]}]}], ";", "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "do", " ", "one", " ", "minimization", " ", "for", " ", "each", " ", 
        "initial", " ", "condition", " ", "specified"}], "*)"}], "\n", "\t", 
      RowBox[{"minimizationResults", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"compiledNumericalMechanismEnergyQ", "[", "energy", "]"}], 
         ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"components", " ", "=", " ", 
           RowBox[{"Pick", "[", " ", 
            RowBox[{
             RowBox[{"Range", "[", " ", 
              RowBox[{"Length", "[", "selector", "]"}], " ", "]"}], " ", ",", 
             " ", "selector"}], " ", "]"}]}], ";", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{"compiled", " ", "energy"}], "*)"}], "\n", "\t\t", 
          RowBox[{"MapThread", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"Check", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"tmp", " ", "=", " ", 
                RowBox[{"FindMinimum", " ", "@@", " ", 
                 RowBox[{"{", "  ", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"energy", "[", "\"\<energy\>\"", "]"}], "[", 
                    RowBox[{"#1", " ", ",", " ", "data"}], "]"}], " ", ",", 
                   " ", "\n", "\t\t\t\t\t", 
                   RowBox[{"Sequence", " ", "@@", " ", "#2"}], " ", ",", "  ",
                    "\n", "\t\t\t\t\t", 
                   RowBox[{"Gradient", " ", ":>", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"energy", "[", "\"\<gradient\>\"", "]"}], "[", 
                    RowBox[{"#1", " ", ",", " ", "data"}], "]"}], "[", 
                    RowBox[{"[", "components", "]"}], "]"}]}], ",", " ", "\n",
                    "\t\t\t\t\t", 
                   RowBox[{
                   "Sequence", " ", "@@", " ", "minimizationOptions"}]}], " ",
                   "}"}]}]}], ",", "\n", "\t\t\t\t", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "if", " ", "the", " ", "minimization", " ", "reports", " ", 
                  "an", " ", "error"}], ",", " ", 
                 RowBox[{"just", " ", "flag", " ", "it", " ", "here"}]}], 
                "*)"}], "\n", "\t\t\t\t", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\"\<error\>\"", " ", "@", " ", 
                  RowBox[{"tmp", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                 RowBox[{"tmp", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}]}], "\n", 
              "\t\t\t", "]"}], " ", "&"}], ",", "\n", "\t\t\t", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{"constrainedPositions", ",", "\n", "\t\t\t", 
              RowBox[{"Transpose", " ", "/@", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", " ", 
                 RowBox[{
                  RowBox[{"ConstantArray", "[", 
                   RowBox[{"variables", ",", 
                    RowBox[{
                    "Length", "[", "initialMinimizationRules", "]"}]}], "]"}],
                   ",", " ", 
                  RowBox[{
                  "variables", " ", "/.", " ", "initialMinimizationRules"}]}],
                  "}"}], "]"}]}]}], "\n", "\t\t\t", "}"}]}], "\n", "\t\t", 
           "]"}]}], ",", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"analytical", " ", "energy"}], "*)"}], "\n", "\t\t", 
         RowBox[{"MapThread", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"Check", "[", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"tmp", " ", "=", " ", 
               RowBox[{"FindMinimum", " ", "@@", " ", 
                RowBox[{"{", "  ", 
                 RowBox[{
                  RowBox[{"energy", " ", "/.", " ", "#1"}], ",", " ", 
                  RowBox[{"Sequence", " ", "@@", " ", "#2"}], " ", ",", "  ", 
                  
                  RowBox[{
                  "Sequence", " ", "@@", " ", "minimizationOptions"}]}], " ", 
                 "}"}]}]}], " ", ",", "\n", "\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                "if", " ", "the", " ", "minimization", " ", "reports", " ", 
                 "an", " ", "error"}], ",", " ", 
                RowBox[{"just", " ", "flag", " ", "it", " ", "here"}]}], 
               "*)"}], "\n", "\t\t\t\t", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\"\<error\>\"", " ", "@", " ", 
                 RowBox[{"tmp", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
                RowBox[{"tmp", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", "}"}]}], "\n", 
             "\t\t\t", "]"}], " ", "&"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"constraintData", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", " ", "\"\<linear solutions\>\""}], "]"}], 
              "]"}], ",", "\n", "\t\t\t", 
             RowBox[{"Transpose", " ", "/@", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", " ", 
                RowBox[{
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"variables", ",", 
                   RowBox[{"Length", "[", "initialMinimizationRules", "]"}]}],
                   "]"}], ",", " ", 
                 RowBox[{
                 "variables", " ", "/.", " ", "initialMinimizationRules"}]}], 
                " ", "}"}], "]"}]}]}], "\t\t\t", "\n", "\t\t\t", "}"}]}], 
          "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\n", "\n", 
      "\t", 
      RowBox[{"(*", 
       RowBox[{
       "output", " ", "the", " ", "results", " ", "as", " ", "a", " ", "list",
         " ", 
        RowBox[{"{", " ", 
         RowBox[{"energy", ",", " ", "positons"}], "}"}], " ", "instead", " ",
         "of", " ", "rules"}], "*)"}], "\n", "\t", 
      RowBox[{"MapThread", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"#1", "[", "\"\<constrained positions\>\"", "]"}], " ", "/.",
             " ", 
            RowBox[{"#2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "}"}], " ", "&"}], " ", 
        ",", "\n", "\t\t", 
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{"constraintData", ",", "\n", "\t\t", "minimizationResults"}],
          "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}]}], "\n", 
    "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7275]:=",ExpressionUUID->"e3681a21-aff1-47fa-a43c-f721a4c7e091"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["local rigidity", "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],

Cell[CellGroupData[{

Cell["rigidityMatrix[]", "Subsection",ExpressionUUID->"82564513-5073-4b17-bfca-e5d1a9ae9db6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"rigidityMatrix", "[", " ", 
     RowBox[{"m", ",", " ", 
      RowBox[{"extra", " ", "constraints"}], " ", ",", " ", 
      RowBox[{"cell", " ", "pattern"}], ",", " ", "reduce"}], "]"}], " ", 
    "returns", " ", "the", " ", "rigidity", " ", "matrix", " ", "for", " ", 
    "a", " ", "mechanism", "\n", "with", " ", "vertices", " ", "at", " ", 
    "given", " ", 
    RowBox[{"positions", ".", "\n", "\n", "extra"}], " ", "constraints", " ", 
    "allows", " ", "additional", " ", "constraints", " ", "to", " ", "be", 
    " ", 
    RowBox[{"imposed", ".", "\n", "cell"}], " ", "pattern", " ", "only", " ", 
    "includes", " ", "certain", " ", "cells", " ", "that", " ", "match", " ", 
    "a", " ", 
    RowBox[{"pattern", ".", "\n", "reduce"}], " ", "is", " ", "a", " ", 
    RowBox[{"Boolean", ".", " ", "True"}], " ", "if", " ", "we", " ", 
    "should", " ", "solve", " ", "linear", " ", "constraints", " ", "and", 
    " ", "remove", " ", "solved", " ", "constraints", " ", "from", " ", "the",
     " ", 
    RowBox[{"matrix", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"rigidityMatrix", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", " ", ",", " ", "extraConstraints_", " ", 
     ",", " ", "cellPattern_", " ", ",", " ", "reduce_"}], "]"}], " ", ":=", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"names", " ", "=", " ", 
        RowBox[{
         RowBox[{"standardVariableNames", "[", "m", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", "equations", ",", " ", 
       "constraints"}], "}"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "get", " ", "constraint", " ", "equations", " ", "using", " ", 
       "arbitrary", " ", "vertex", " ", "positions"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"equations", " ", "=", " ", 
       RowBox[{"constraintEquations", "[", " ", 
        RowBox[{
        "m", " ", ",", " ", "names", " ", ",", " ", "cellPattern", ",", " ", 
         "extraConstraints"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"constraints", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"TrueQ", "[", "reduce", "]"}], ",", "\n", "\t\t", 
         RowBox[{"With", "[", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tmp", " ", "=", " ", 
             RowBox[{"processConstraintEquations", "[", " ", 
              RowBox[{
               RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", 
               "equations"}], " ", "]"}]}], "}"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"tmp", "[", "\"\<variables\>\"", "]"}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"tmp", "[", "\"\<nonlinear constraints\>\"", "]"}]}], 
            "\n", "\t\t\t", "}"}]}], " ", "\n", "\t\t", "]"}], ",", "\n", 
         "\t\t", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], ",", " ", 
           "equations"}], "}"}]}], "\n", "\t", "]"}]}], " ", ";", "\n", "\t", 
      "\n", "\t", 
      RowBox[{"CoefficientArrays", "[", " ", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{
        "reduce", " ", "constraints", " ", "to", " ", "first", " ", "order", 
         " ", "and", " ", "restore", " ", "names", " ", "of", " ", "vertex", 
         " ", "positions"}], "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"reduceConstraintToOrder", "[", 
          RowBox[{"names", " ", ",", " ", 
           RowBox[{"constraints", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", "1"}], "]"}], " ", "/.",
          " ", 
         RowBox[{"Dispatch", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "names", "]"}], " ", "->", " ", 
            RowBox[{"Flatten", "[", "positions", "]"}]}], "]"}], "]"}]}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"constraints", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "/.", " ", 
         RowBox[{"VertexPosition", " ", "->", " ", "VertexDisplacement"}]}]}],
        "\n", "\t", "]"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7276]:=",ExpressionUUID->"46ab40c5-6588-471d-aecc-eb27817cc926"]
}, Closed]],

Cell[CellGroupData[{

Cell["stressedQ[]", "Subsection",ExpressionUUID->"7d27c4fa-8a9a-4c02-b26b-2c60a0524bb5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"stressedQ", "[", " ", 
   RowBox[{"arrays_List", " ", ",", " ", "tol_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Max", " ", "@", " ", 
      RowBox[{"Abs", " ", "@", " ", 
       RowBox[{"N", " ", "@", " ", 
        RowBox[{"Normal", " ", "@", " ", 
         RowBox[{"arrays", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}]}]}], ")"}], " ", ">=", " ", 
    "tol"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "arrays", "]"}], " ", ">=", " ", "1"}], " ", "&&",
     " ", 
    RowBox[{"VectorQ", "[", " ", 
     RowBox[{
      RowBox[{"arrays", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "NumericQ"}], " ", 
     "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"stressedQ", "[", " ", 
   RowBox[{"arrays_List", ",", " ", "tol_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<analytic\>\"", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "arrays", "]"}], " ", ">=", " ", "1"}]}]}], "\n", 
 RowBox[{
  RowBox[{"stressedQ", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  "$Failed"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7277]:=",ExpressionUUID->"6492dec8-04b5-49d8-9b6a-cf1b6c357cb1"]
}, Closed]],

Cell[CellGroupData[{

Cell["selfStresses[], zeroModes[]", "Subsection",ExpressionUUID->"1d244cab-2ef7-4343-a085-dae22554ee81"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"selfStresses", "[", 
      RowBox[{
       RowBox[{"constraint", " ", "matrix"}], ",", " ", "tolerance"}], "]"}], 
     "\n", "\n", "returns", " ", "the", " ", "left", " ", "null", " ", 
     "space", " ", "of", " ", "a", " ", "constraint", " ", "matrix", " ", 
     "given", " ", "some", " ", 
     RowBox[{"tolerance", ".", " ", "If"}], " ", "the", " ", "matrix", " ", 
     "is", " ", "numerical"}], ",", " ", "\n", "\t", 
    RowBox[{
    "it", " ", "uses", " ", "the", " ", "eigenvalues", " ", "of", " ", "C", 
     " ", 
     RowBox[{"C", "^", "T"}], " ", "smaller", " ", "than", " ", 
     RowBox[{"tolerance", ".", " ", "otherwise"}], " ", "it", " ", "uses", 
     " ", "the", " ", "function", " ", 
     RowBox[{"NullSpace", "[", "]"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"selfStresses", "[", " ", 
     RowBox[{"mat_", " ", ",", " ", "tol_"}], "]"}], " ", ":=", " ", "\n", 
    RowBox[{
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"es", " ", "=", " ", 
         RowBox[{"Quiet", " ", "@", " ", 
          RowBox[{"Eigensystem", "[", " ", 
           RowBox[{"mat", " ", ".", " ", 
            RowBox[{"Transpose", "[", "mat", "]"}]}], " ", "]"}]}]}], "}"}], 
       ",", "\n", "\t", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"es", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", "<=", " ", "tol"}], "&"}], ")"}], " ", "/@", 
          " ", 
          RowBox[{"es", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}], "\n", "]"}], " ",
      "/;", " ", 
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"mat", " ", ",", " ", "MachineRealQ"}], " ", "]"}]}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"selfStresses", "[", " ", 
      RowBox[{"mat_", " ", ",", " ", "tol_"}], "]"}], " ", ":=", " ", "\n", 
     RowBox[{
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"es", " ", "=", " ", 
          RowBox[{"Quiet", " ", "@", " ", 
           RowBox[{"Simplify", " ", "@", " ", 
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{"mat", " ", ".", " ", 
              RowBox[{"Transpose", "[", "mat", "]"}]}], " ", "]"}]}]}]}], 
         "}"}], ",", "\n", "\t", 
        RowBox[{"Orthogonalize", " ", "@", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"es", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", " ", "<=", " ", "tol"}], "&"}], ")"}], " ", "/@", 
            " ", 
            RowBox[{"es", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", "]"}], 
      " ", "/;", " ", 
      RowBox[{"MatrixQ", "[", " ", 
       RowBox[{"mat", " ", ",", " ", "NumericQ"}], " ", "]"}]}]}], "*)"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"selfStresses", "[", " ", 
     RowBox[{"mat_", " ", ",", " ", "tol_"}], "]"}], " ", ":=", " ", 
    RowBox[{"NullSpace", "[", " ", 
     RowBox[{
      RowBox[{"Transpose", "[", "mat", "]"}], ",", " ", 
      RowBox[{"Tolerance", " ", "->", " ", "tol"}]}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7280]:=",ExpressionUUID->"0d37b454-bdbe-4fea-9939-e62ffc2de93d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"zeroModes", "[", 
      RowBox[{
       RowBox[{"constraint", " ", "matrix"}], ",", " ", "tolerance"}], "]"}], 
     "\n", "\n", "returns", " ", "the", " ", "right", " ", "null", " ", 
     "space", " ", "of", " ", "a", " ", "constraint", " ", "matrix", " ", 
     "given", " ", "some", " ", 
     RowBox[{"tolerance", ".", " ", "If"}], " ", "the", " ", "matrix", " ", 
     "is", " ", "numerical"}], ",", "\n", "\t", 
    RowBox[{"it", " ", "uses", " ", "the", " ", "eigenvalues", " ", "of", " ", 
     RowBox[{"C", "^", "T"}], " ", "C", " ", "smaller", " ", "thance", " ", 
     RowBox[{"Tolerance", ".", " ", "otherwise"}], " ", "it", " ", "uses", 
     " ", "the", " ", "function", " ", 
     RowBox[{"NullSpace", "[", "]"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"zeroModes", "[", " ", 
     RowBox[{"mat_", " ", ",", " ", "tol_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"es", " ", "=", " ", 
         RowBox[{"Quiet", " ", "@", " ", 
          RowBox[{"Eigensystem", "[", " ", 
           RowBox[{
            RowBox[{"Transpose", "[", "mat", "]"}], " ", ".", " ", "mat"}], 
           " ", "]"}]}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"es", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", "<=", " ", "tol"}], "&"}], ")"}], " ", "/@", 
          " ", 
          RowBox[{"es", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}], "\n", "]"}], " ",
      "/;", " ", 
     RowBox[{"MatrixQ", "[", " ", 
      RowBox[{"mat", " ", ",", " ", "MachineRealQ"}], " ", "]"}]}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"zeroModes", "[", " ", 
      RowBox[{"mat_", " ", ",", " ", "tol_"}], " ", "]"}], " ", ":=", "\n", 
     RowBox[{
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"es", " ", "=", " ", 
          RowBox[{"Quiet", " ", "@", " ", 
           RowBox[{"Simplify", " ", "@", " ", 
            RowBox[{"Eigensystem", "[", " ", 
             RowBox[{
              RowBox[{"Transpose", "[", "mat", "]"}], " ", ".", " ", "mat"}], 
             " ", "]"}]}]}]}], "}"}], ",", "\n", "\t", 
        RowBox[{"Orthogonalize", " ", "@", " ", 
         RowBox[{"Pick", "[", " ", 
          RowBox[{
           RowBox[{"es", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", " ", "<=", " ", "tol"}], "&"}], ")"}], " ", "/@", 
            " ", 
            RowBox[{"es", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}]}], "\n", "]"}], 
      " ", "/;", " ", 
      RowBox[{"MatrixQ", "[", " ", 
       RowBox[{"mat", " ", ",", " ", "NumericQ"}], " ", "]"}]}]}], "*)"}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"zeroModes", "[", " ", 
     RowBox[{"mat_", ",", " ", "tol_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"NullSpace", "[", " ", 
     RowBox[{"mat", " ", ",", " ", 
      RowBox[{"Tolerance", " ", "->", " ", "tol"}]}], "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7282]:=",ExpressionUUID->"04145058-5082-47fe-80c7-d92256293738"]
}, Closed]],

Cell[CellGroupData[{

Cell["linearMotions[]", "Subsection",ExpressionUUID->"a15d9be0-e8de-477e-9c87-2af567086d49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{"linearMotions", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"constraint", " ", "matrix"}]}], "]"}], " ", "finds", " ", 
    "the", " ", "right", " ", "null", " ", "space", " ", "of", " ", "the", 
    " ", "constraint", " ", "matrix", " ", "provided", " ", "and", "\n", "\t",
     "collects", " ", "results", " ", "into", " ", "a", " ", "displacement", 
    " ", "vector", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dx", ",", " ", "dy", ",", "dz"}], "}"}], ",", " ", "..."}], 
     "}"}], " ", "or", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dx", ",", "dy"}], "}"}], ",", " ", "..."}], " ", "}"}], "\n", 
    "\t", "\n", "\t", "this", " ", "is", " ", "really", " ", "just", " ", "a",
     " ", "wrapper", " ", "for", " ", 
    RowBox[{"zeroModes", "."}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"linearMotions", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "rigidityMatrix_", " ", ",", " ", "tol_"}], 
    " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], ",", " ", 
       RowBox[{"lin", " ", "=", " ", 
        RowBox[{"zeroModes", "[", 
         RowBox[{"rigidityMatrix", ",", " ", "tol"}], "]"}]}]}], "}"}], ",", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "lin", "]"}], ">", "0"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Partition", "[", " ", 
         RowBox[{
          RowBox[{"Orthogonalize", "[", "lin", "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"1", ",", "dim"}], "}"}]}], " ", "]"}], "[", 
        RowBox[{"[", " ", 
         RowBox[{"All", ",", " ", "All", ",", " ", "1"}], " ", "]"}], "]"}], 
       ",", "\n", "\t\t", 
       RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7284]:=",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismConstraintMatrix[]", "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", "\n", "\t", 
      RowBox[{"CellPattern", " ", "->", " ", "_"}], " ", ",", " ", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "Tolerance", " ", "for", " ", "deciding", " ", "if", " ", "a", " ", 
        "mechanism", " ", "is", " ", "stressed"}], "*)"}], "\n", "\t", 
      RowBox[{"Tolerance", " ", "->", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "6"}], ")"}]}]}], " ", ",", " ", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "eliminate", " ", "any", " ", "constraints", " ", "that", " ", "are", 
        " ", "linear", " ", "by", " ", "solving", " ", "for", " ", "them", 
        " ", "directly"}], "*)"}], "\n", "\t", 
      RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}]}], "\n", 
     "}"}]}], ";"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"argument", " ", "checkers"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"reduceQ", "[", 
   RowBox[{"_", "?", "BooleanQ"}], "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"reduceQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismConstraintMatrix", "::", "red"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"smallestStressQ", "[", " ", 
   RowBox[{"_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", " ", ">=", " ", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"smallestStressQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismConstraintMatrix", "::", "st"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{"error", " ", "messages"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "red"}], "=", 
   "\"\<Option ReduceLinearConstraints should be Boolean.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "stressed"}], "=", 
   "\"\<Warning: Mechanism is stressed. Constraint matrix may not be \
useful.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "arbitrarystress"}], "=", 
   "\"\<Assuming mechanism is not stressed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "nomat"}], "=", 
   "\"\<Failed to find constrained cells.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "::", "st"}], "=", 
   "\"\<Option Tolerance, which sets threshold for stress to be zero, must be \
a number greater than or equal to 0.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismConstraintMatrix", "::", "pos"}], "=", 
    "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"MechanismConstraintMatrix", "[", " ", 
        RowBox[{
         RowBox[{"Deformed", "[", " ", 
          RowBox[{"m", ",", " ", 
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",",
          " ", "opt"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "MechanismConstraintMatrix"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismConstraintMatrix", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "actualPositions_"}],
       " ", "]"}], ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"arrays", " ", "=", " ", 
         RowBox[{"rigidityMatrix", "[", 
          RowBox[{"m", " ", ",", " ", "actualPositions", ",", " ", 
           RowBox[{"OptionValue", "[", "Constraints", "]"}], " ", ",", " ", 
           RowBox[{"OptionValue", "[", "CellPattern", "]"}], " ", ",", " ", 
           RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}]}], 
          " ", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"smallestStress", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}]}]}], "\n", "\t\t", 
       "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Switch", "[", " ", 
        RowBox[{
         RowBox[{"stressedQ", "[", 
          RowBox[{"arrays", " ", ",", " ", "smallestStress"}], "]"}], ",", 
         "\n", "\t\t\t", "True", ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismConstraintMatrix", "::", "stressed"}], "]"}], 
          ";", " ", 
          RowBox[{"arrays", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "\n", "\t\t\t", "False", 
         ",", " ", 
         RowBox[{"arrays", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "\n", "\t\t\t", 
         "\"\<analytic\>\"", ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismConstraintMatrix", "::", "arbitrarystress"}], 
           "]"}], ";", " ", 
          RowBox[{"arrays", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "\n", "\t\t\t", "$Failed", 
         ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismConstraintMatrix", "::", "nomat"}], "]"}], ";", 
          " ", 
          RowBox[{"{", 
           RowBox[{"{", "}"}], "}"}]}]}], "\n", "\t\t", "]"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"smallestStressQ", "[", " ", "smallestStress", " ", "]"}], 
        " ", "&&", " ", 
        RowBox[{"reduceQ", "[", " ", 
         RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}], " ", 
         "]"}]}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "actualPositions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismConstraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "pos_"}], "]"}], ",", " ", 
    "___"}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", " ", 
    RowBox[{
     RowBox[{"MechanismConstraintMatrix", "::", "pos"}], " ", ",", " ", 
     "pos"}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7285]:=",ExpressionUUID->"ccd1ebc1-8990-4e63-876f-5cefd2cc3814"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismZeroModes[], MechanismSelfStresses[]", "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],

Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"Implementation", " ", 
    RowBox[{"notes", ":", "\n", "  ", 
     RowBox[{
     "For", " ", "machine", " ", "size", " ", "numerical", " ", 
      "positions"}]}]}], ",", " ", 
   RowBox[{
   "zero", " ", "modes", " ", "and", " ", "self", " ", "stresses", " ", 
    "have", " ", "eigenvalues", " ", "smaller", " ", "than", " ", "option", 
    " ", 
    RowBox[{"Tolerance", "."}]}]}], "\n", "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7299]:=",ExpressionUUID->"03b9d93c-0ac2-41eb-862d-d2fd3b407a4a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismZeroModes", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", " ", 
      RowBox[{"Tolerance", "\[Rule]", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "10"}], ")"}]}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "::", "stressed"}], "=", 
   "\"\<Warning: Mechanism is stressed. Constraint matrix may not be \
useful.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "::", "nomat"}], "=", 
   "\"\<Failed to find constrained cells.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "::", "st"}], "=", 
   "\"\<Option Tolerance, which sets threshold for stress to be zero, must be \
a number greater than or equal to 0.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismZeroModes", "::", "pos"}], "=", 
    "\"\<Positions of dimensions `1` do not seem to conform to \
mechanism.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"zmtolQ", "[", " ", 
   RowBox[{"_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", " ", ">=", " ", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"zmtolQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismZeroModes", "::", "st"}], "]"}], ";", " ", "False"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"zmposQ", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"True", " ", "/;", " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"zmposQ", "[", " ", 
    RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismZeroModes", "::", "pos"}], ",", " ", 
       RowBox[{"Dimensions", "[", "pos", "]"}]}], "]"}], ";", " ", "False"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", " ", 
       RowBox[{"MechanismZeroModes", "[", " ", 
        RowBox[{
         RowBox[{"Deformed", "[", " ", 
          RowBox[{"m", " ", ",", " ", 
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",",
          "opt"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "MechanismZeroModes"}]}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "actualPositions_"}], " ",
       "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "rm", "}"}], ",", 
      RowBox[{"With", "[", "\n", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"tolerance", " ", "=", " ", 
           RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], ",", "\n", "\t", 
          
          RowBox[{"dim", " ", "=", " ", 
           RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}]}], "\n", 
         "}"}], ",", 
        RowBox[{
         RowBox[{"(", "\n", "\t", 
          RowBox[{
           RowBox[{"rm", " ", "=", " ", 
            RowBox[{"rigidityMatrix", "[", 
             RowBox[{"m", ",", " ", "actualPositions", ",", " ", 
              RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
              "False"}], " ", "]"}]}], ";", "\n", "\t", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "dim"}], "]"}], "&"}], " ", ",", " ", 
             RowBox[{"Switch", "[", " ", 
              RowBox[{
               RowBox[{"stressedQ", "[", 
                RowBox[{"rm", ",", " ", "tolerance"}], "]"}], ",", "\n", 
               "\t\t", "True", ",", " ", 
               RowBox[{
                RowBox[{"Message", "[", 
                 RowBox[{"MechanismZeroModes", "::", "stressed"}], "]"}], ";",
                 " ", 
                RowBox[{"zeroModes", "[", " ", 
                 RowBox[{
                  RowBox[{"rm", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", "tolerance"}], 
                 " ", "]"}]}], ",", "\n", "\t\t", "False", ",", " ", 
               RowBox[{"zeroModes", "[", " ", 
                RowBox[{
                 RowBox[{"rm", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", " ", "tolerance"}], 
                " ", "]"}], ",", "\n", "\t\t", "$Failed", ",", " ", 
               RowBox[{
                RowBox[{"Message", "[", 
                 RowBox[{"MechanismZeroModes", "::", "nomat"}], "]"}], ";", 
                " ", 
                RowBox[{"IdentityMatrix", "[", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Flatten", " ", "@", " ", "actualPositions"}], 
                  "]"}], "]"}]}]}], "\n", "\t", "]"}]}], " ", "]"}]}], " ", 
          ")"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{"zmtolQ", "[", " ", "tolerance", " ", "]"}], " ", "&&", " ", 
          RowBox[{"zmposQ", "[", " ", 
           RowBox[{"m", " ", ",", " ", "actualPositions"}], " ", "]"}]}]}]}], 
       "\n", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", " ", ",", " ", "actualPositions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "actualPositions_"}], " ",
       "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", "\t", 
   
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismZeroModes", "::", "pos"}], ",", " ", 
      "actualPositions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismZeroModes", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:08 \
In[7300]:=",ExpressionUUID->"2158514b-9987-47f1-82de-22388e0a407b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismSelfStresses", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
      RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", " ", 
      RowBox[{"Tolerance", "\[Rule]", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "10"}], ")"}]}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "stressed"}], "=", 
   "\"\<Warning: Mechanism is stressed. Constraint matrix may not be \
useful.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "nomat"}], "=", 
   "\"\<Failed to find constrained cells.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "st"}], "=", 
   "\"\<Option Tolerance, which sets threshold for stress to be zero, must be \
a number greater than or equal to 0.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "pos"}], "=", 
   "\"\<Positions of dimensions `1` do not seem to conform to \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismSelfStresses", "::", "num"}], "=", 
    "\"\<For non-numerical positions, MechanismSelfStresses[] may not always \
return all values.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"sstolQ", "[", " ", 
   RowBox[{"_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
       RowBox[{"#", " ", ">=", " ", "0"}]}], " ", "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sstolQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismSelfStresses", "::", "st"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ssposQ", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"MatrixQ", "[", " ", 
         RowBox[{"pos", ",", " ", "NumericQ"}], "]"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"MechanismSelfStresses", "::", "num"}], "]"}]}], "]"}], ";", 
     " ", "True"}], ")"}], " ", "/;", " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ssposQ", "[", " ", 
    RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismSelfStresses", "::", "pos"}], ",", " ", 
       RowBox[{"Dimensions", "[", "pos", "]"}]}], "]"}], ";", " ", "False"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", " ", 
       RowBox[{"MechanismSelfStresses", "[", " ", 
        RowBox[{
         RowBox[{"Deformed", "[", " ", 
          RowBox[{"m", " ", ",", " ", 
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",",
          "opt"}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "MechanismSelfStresses"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "actualPositions_"}], 
      "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "rm", "}"}], ",", 
      RowBox[{"With", "[", "\n", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{"tolerance", " ", "=", " ", 
          RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "\n", "}"}], ",", 
        
        RowBox[{
         RowBox[{"(", "\n", "\t", 
          RowBox[{
           RowBox[{"rm", " ", "=", " ", 
            RowBox[{"rigidityMatrix", "[", 
             RowBox[{"m", ",", " ", "actualPositions", ",", " ", 
              RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
              "False"}], " ", "]"}]}], ";", "\n", "\t", 
           RowBox[{"Switch", "[", " ", 
            RowBox[{
             RowBox[{"stressedQ", "[", 
              RowBox[{"rm", ",", " ", "tolerance"}], "]"}], ",", "\n", "\t\t",
              "True", ",", " ", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{"MechanismSelfStresses", "::", "stressed"}], "]"}], 
              ";", " ", 
              RowBox[{"selfStresses", "[", " ", 
               RowBox[{
                RowBox[{"rm", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", " ", "tolerance"}], " ",
                "]"}]}], ",", "\n", "\t\t", "False", ",", " ", 
             RowBox[{"selfStresses", "[", " ", 
              RowBox[{
               RowBox[{"rm", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", " ", "tolerance"}], " ", 
              "]"}], ",", "\n", "\t\t", "$Failed", ",", " ", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{"MechanismSelfStresses", "::", "nomat"}], "]"}], ";", 
              " ", 
              RowBox[{"IdentityMatrix", "[", 
               RowBox[{"Length", "[", 
                RowBox[{"Flatten", " ", "@", " ", "actualPositions"}], "]"}], 
               "]"}]}]}], "\n", "\t", "]"}]}], " ", ")"}], "/;", " ", 
         RowBox[{
          RowBox[{"sstolQ", "[", " ", "tolerance", " ", "]"}], " ", "&&", " ", 
          RowBox[{"ssposQ", "[", " ", 
           RowBox[{"m", " ", ",", " ", "actualPositions"}], " ", "]"}]}]}]}], 
       "\n", "]"}]}], "]"}], " ", "/;", " ", 
    RowBox[{"VertexCoordinatesQ", "[", 
     RowBox[{"m", ",", " ", "actualPositions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "actualPositions_"}], " ",
       "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", "\t", 
   
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismSelfStresses", "::", "pos"}], ",", " ", 
      "actualPositions"}], "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismSelfStresses", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not correspond to mechanism.\>\""}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:08 \
In[7313]:=",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismInfinitesimalMotions[]", "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismInfinitesimalMotions", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
     RowBox[{"OutputVariables", "\[Rule]", "Automatic"}], ",", " ", 
     RowBox[{"Tolerance", " ", "->", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "12"}], ")"}]}]}]}], " ", "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7327]:=",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"actualPositions", "=", 
       RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Module", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", "=", 
          RowBox[{"mechanismInfinitesimalMotionsInternal", "[", 
           RowBox[{"m", ",", "actualPositions", ",", 
            RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", 
            RowBox[{"OptionValue", "[", "OutputVariables", "]"}], ",", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], " ", "]"}]}], 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"res", " ", "/;", " ", 
         RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "\t ", "]"}], " ", "/;",
       " ", 
      RowBox[{
       RowBox[{"NumericQ", "[", " ", 
        RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}], " ", "&&",
        " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", ">=", " ", 
        "0"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "actualPositions_"}], 
      "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"Module", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", "=", 
        RowBox[{"mechanismInfinitesimalMotionsInternal", "[", 
         RowBox[{"m", ",", "actualPositions", ",", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", 
          RowBox[{"OptionValue", "[", "OutputVariables", "]"}], ",", 
          RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], " ", "]"}]}], 
       "}"}], ",", "\n", "\t\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{"res", "=!=", "$Failed"}]}]}], "\n", "\t ", "]"}], " ", "/;", 
    " ", 
    RowBox[{
     RowBox[{"NumericQ", "[", " ", 
      RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}], " ", "&&", 
     " ", 
     RowBox[{
      RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", ">=", " ", "0"}], 
     " ", "&&", " ", 
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", " ", "actualPositions"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "failed"}], "=", 
   "\"\<Failed to find an appropriate solution. Check the constraints.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "pos"}], "=", 
   "\"\<Positions `1` are not numeric or do not match those of \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", "  ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{
          RowBox[{"NumericQ", "[", " ", 
           RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}], " ", "&&",
           " ", 
          RowBox[{
           RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", ">=", " ", 
           "0"}]}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"MechanismInfinitesimalMotions", "::", "tol"}], "]"}]}], 
       "]"}], ";", "\n", "\t\t", "False"}], "\n", "\t", ")"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismInfinitesimalMotions", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "positions_"}], "]"}], ",",
     "  ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"(", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismInfinitesimalMotions", "::", "pos"}], ",", " ", 
       "positions"}], "]"}], ";", "\n", "\t\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"NumericQ", "[", " ", 
          RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}], " ", "&&",
          " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", ">=", " ", 
          "0"}]}], "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"MechanismInfinitesimalMotions", "::", "tol"}], "]"}]}], " ", 
      "]"}], ";", "\n", "\t\t", "False"}], "\n", "\t", ")"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7328]:=",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "var"}], "=", 
   "\"\<Variables listed are not of the form VertexDisplacement[n,c].\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "sing"}], "=", 
   "\"\<Jacobian matrix is singular. Recovering using generic \
variables.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "jac"}], "=", 
   "\"\<Jacobian matrix may not be invertible. Choosing different \
displacements may give better results.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "lin"}], "=", 
   "\"\<Found `1` linear motions so `1` displacements are needed.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "tol"}], "=", 
   "\"\<Option Tolerance must be a non-negative number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismInfinitesimalMotions", "::", "const"}], "=", 
   "\"\<Failed to obtain proper constraints: `1`.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7334]:=",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismInfinitesimalMotionsInternal", "[", 
   RowBox[{
   "m_", ",", "positions_", ",", "inputConstraints_", ",", "v_", ",", 
    "tolerance_"}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"matrix", ",", "dependencies", ",", "solution"}], "}"}], ",", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"variables", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}]}], ",", "\n", 
        "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{
         "collect", " ", "all", " ", "the", " ", "constraints", " ", "valid", 
          " ", "to", " ", "2", "nd", " ", "order", " ", "in", " ", "the", " ",
           "displacements"}], " ", "*)"}], "\n", "\t", 
        RowBox[{"equations", " ", "=", " ", 
         RowBox[{"internalConstraintMap", "[", 
          RowBox[{
          "m", ",", " ", "positions", " ", ",", " ", "2", ",", " ", "False", 
           ",", " ", "_", ",", " ", "inputConstraints"}], "]"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"zeroth", " ", "order"}], ",", " ", 
            RowBox[{"first", " ", "order"}], ",", " ", 
            RowBox[{"2", "nd", " ", "order"}]}], "}"}], "\n", "\t\t", "If", 
          " ", "zeroth", " ", "order", " ", "vector", " ", "is", " ", "non"}],
          "-", "zero"}], ",", " ", 
        RowBox[{"the", " ", "system", " ", "has", " ", "some", " ", 
         RowBox[{"stresses", ".", "\n", "\t\t", "first"}], " ", "order", " ", 
         "matrix", " ", "gives", " ", "dependencies", " ", "and", " ", "zero",
          " ", 
         RowBox[{"modes", "."}]}]}], "\n", "\t", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"Quiet", "[", 
        RowBox[{"matrix", "=", 
         RowBox[{"CoefficientArrays", "[", 
          RowBox[{"equations", ",", "variables", ",", " ", 
           RowBox[{"\"\<Symmetric\>\"", "\[Rule]", "True"}]}], "]"}]}], "]"}],
        ";", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "matrix", "]"}], " ", "===", " ", 
          "CoefficientArrays"}], ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"MechanismInfinitesimalMotions", "::", "const"}], ",", 
            "equations"}], "]"}], ";", " ", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", "\n", "\t",
        "\n", "\t", 
       RowBox[{"(*", "\n", "\t", 
        RowBox[{
         RowBox[{
         "Find", " ", "dependencies", " ", "among", " ", "the", " ", "linear",
           " ", 
          RowBox[{"equations", ".", "\n", "\t", "When"}], " ", "the", " ", 
          "constraints", " ", "arise", " ", "only", " ", "from", " ", "edge", 
          " ", "stretching"}], ",", " ", 
         RowBox[{
          RowBox[{
          "these", " ", "dependences", " ", "are", " ", "the", " ", "self"}], 
          "-", 
          RowBox[{
           RowBox[{"stresses", ".", "\n", "\t", "\n", "\t", "If"}], " ", 
           "the", " ", "self", " ", "stresses", " ", "happen", " ", "to", " ",
            "be", " ", "numeric"}]}], ",", " ", 
         RowBox[{"go", " ", "ahead", " ", "and", " ", "normalize", " ", 
          RowBox[{"them", ".", "\n", "\t", "Otherwise"}], " ", "throw", " ", 
          "in", " ", "a", " ", "quick", " ", 
          RowBox[{"Simplify", "[", "]"}], " ", "and", " ", "leave", " ", "as",
           " ", 
          RowBox[{"is", "."}]}]}], "\n", "\t", "*)"}], "\n", "\t", 
       RowBox[{"dependencies", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MatrixQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], ",", " ", 
             RowBox[{"Orthogonalize", "[", "#", "]"}], ",", " ", 
             RowBox[{"Simplify", "[", "#", "]"}]}], " ", "]"}], "&"}], ")"}], 
         " ", "@", " ", 
         RowBox[{"selfStresses", "[", " ", 
          RowBox[{
           RowBox[{"matrix", "[", 
            RowBox[{"[", "2", "]"}], "]"}], " ", ",", " ", "tolerance"}], " ",
           "]"}]}]}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "linear", " ", "displacements", " ", "that", " ", "are", 
         " ", "allowed"}], "*)"}], "\n", "\t", 
       RowBox[{"solution", " ", "=", " ", 
        RowBox[{"linearMotionsToDisplacementRules", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"linearMotions", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"matrix", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", " ", "tolerance"}], "]"}], 
          ",", "v"}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Which", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"solution", "===", "$Failed"}], ",", " ", "$Failed", ",", 
         "\n", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Length", "[", "solution", "]"}], ">", "0"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"Expand", "[", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "analytical", " ", "processing", " ", "that", " ", "I", " ", 
             "prefer"}], ",", " ", 
            RowBox[{
            "but", " ", "should", " ", "not", " ", "take", " ", "a", " ", 
             "long", " ", "time", " ", "to", " ", "perform"}]}], "*)"}], "\n",
           "\t\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"Not", "@", 
                  RowBox[{"PossibleZeroQ", "[", 
                   RowBox[{"N", "@", "#"}], "]"}]}], "&"}]}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "[", "\n", 
           "\t\t\t\t\t", 
           RowBox[{
            RowBox[{"{", "\n", "\t\t\t\t\t", 
             RowBox[{
              RowBox[{"VertexDisplacement", "[", "m", "]"}], ",", "\n", 
              "\t\t\t\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "dependencies", "]"}], ">", "0"}], 
                ",", " ", 
                RowBox[{"dependencies", " ", ".", " ", "equations"}], ",", 
                RowBox[{"{", "}"}]}], "]"}], ",", "\n", "\t\t\t\t\t", 
              "dependencies"}], "\n", "\t\t\t\t\t", "}"}], " ", "/.", " ", 
            RowBox[{"Dispatch", "[", "solution", "]"}]}], "\n", "\t\t\t\t", 
           "]"}], "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "no", " ", "solution", " ", "but", " ", "no", " ", "errors", " ", 
           "either"}], "*)"}], "\n", "\t\t", "True", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismInfinitesimalMotions", "::", "failed"}], "]"}], 
          ";", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", 
              RowBox[{"Dimensions", "[", 
               RowBox[{"MechanismPositions", "[", "m", "]"}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"{", "}"}], ",", " ", "dependencies"}], "}"}]}]}], "\n", 
        "\t", "]"}]}]}], "\n", "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7340]:=",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_"}], "]"}], 
   ":=", 
   RowBox[{
    RowBox[{"{", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "inputDisplacements_List"}], 
    "]"}], ":=", "\n", 
   RowBox[{"With", "[", "\n", 
    RowBox[{"(*", 
     RowBox[{"preprocess", " ", "arguments"}], "*)"}], "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"displacements", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "inputDisplacements", "}"}], "]"}]}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"Module", "[", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "x", ",", "y", ",", "c", ",", "rules", ",", "jacobianMatrix", ",", 
          "inverseJacobian", ",", "displacementIndices"}], "}"}], ",", "\n", 
        "\t", 
        RowBox[{
         RowBox[{"displacementIndices", "=", 
          RowBox[{
           RowBox[{"displacements", "/.", 
            RowBox[{
             RowBox[{"VertexDisplacement", "[", 
              RowBox[{"x_", ",", "y_"}], "]"}], "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<x\>\"", "\[Rule]", "1"}], ",", 
             RowBox[{"\"\<y\>\"", "\[Rule]", "2"}], ",", 
             RowBox[{"\"\<z\>\"", "\[Rule]", "3"}]}], "}"}]}]}], ";", "\n", 
         "\t", 
         RowBox[{"jacobianMatrix", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"linearMotions", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"Sequence", "@@", "#"}]}], "]"}], "]"}], "&"}], "/@", 
           "displacementIndices"}]}], ";", "\n", "\t", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "if", " ", "inverting", " ", "the", " ", "jacobian", " ", "fails", 
            " ", "entirely"}], ",", " ", 
           RowBox[{
            RowBox[{"we", "'"}], "ll", " ", "need", " ", "to", " ", "deal", 
            " ", "with", " ", 
            RowBox[{"that", "."}]}]}], "*)"}], "\n", "\t", 
         RowBox[{"inverseJacobian", "=", 
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"Inverse", "[", "jacobianMatrix", "]"}], ",", "\n", 
            "\t\t", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"MechanismInfinitesimalMotions", "::", "sing"}], "]"}], 
             ";", "\n", "\t\t", 
             RowBox[{"Return", "[", 
              RowBox[{"linearMotionsToDisplacementRules", "[", 
               RowBox[{"m", ",", "linearMotions", ",", "Automatic"}], "]"}], 
              "]"}]}], ",", "\n", "\t\t", 
            RowBox[{"Inverse", "::", "sing"}]}], "\n", "\t", "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{
          "warn", " ", "that", " ", "the", " ", "jacobian", " ", "matrix", 
           " ", "is", " ", "almost", " ", "singular"}], "*)"}], "\n", "\t", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"Det", "[", "jacobianMatrix", "]"}], "]"}], "<", 
            RowBox[{"10", "^", 
             RowBox[{"(", 
              RowBox[{"-", "16"}], ")"}]}]}], ",", 
           RowBox[{"Message", "[", 
            RowBox[{"MechanismInfinitesimalMotions", "::", "jac"}], "]"}]}], 
          "]"}], ";", "\n", "\n", "\t", 
         RowBox[{"rules", "=", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Array", "[", 
             RowBox[{"c", ",", 
              RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], "->", 
            RowBox[{"inverseJacobian", " ", ".", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", "displacements", "}"}], "]"}]}]}], "]"}]}], ";", 
         "\n", "\t", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Array", "[", 
               RowBox[{"c", ",", 
                RowBox[{"Length", "[", "jacobianMatrix", "]"}]}], "]"}], " ", 
              ".", " ", "linearMotions"}], "/.", "rules"}], "]"}]}], 
          "]"}]}]}], "\n", "\n", "]"}], "/;", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "linearMotions", "]"}], "\[Equal]", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "&&", 
       RowBox[{"MatchQ", "[", 
        RowBox[{"displacements", ",", 
         RowBox[{"{", "__VertexDisplacement", "}"}]}], "]"}]}]}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "Automatic"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", "=", 
        RowBox[{"Unique", "[", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Array", "[", 
           RowBox[{"v", ",", 
            RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
          " ", "linearMotions"}], "]"}]}], "]"}]}], "\n", "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"linearMotionsToDisplacementRules", "[", 
    RowBox[{"m_", ",", "linearMotions_", ",", "c_Symbol"}], "]"}], ":=", "\n",
    "\t", 
   RowBox[{
    RowBox[{"Thread", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"VertexDisplacement", "[", "m", "]"}], "]"}], "\[Rule]", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], " ", ".", 
        " ", "linearMotions"}], "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], ">", "0"}]}]}], "\n", 
  "\t"}], "\n", 
 RowBox[{
  RowBox[{"linearMotionsToDisplacementRules", "[", 
   RowBox[{"m_", ",", "linearMotions_", ",", "displacements_"}], "]"}], ":=", 
  
  RowBox[{"Which", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Not", "[", 
     RowBox[{"MatchQ", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "displacements", "}"}], "]"}], ",", 
       RowBox[{"{", "__VertexDisplacement", "}"}]}], "]"}], "]"}], ",", "\n", 
    "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismInfinitesimalMotions", "::", "var"}], "]"}], ";", 
     "\n", "\t\t", "$Failed"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Length", "[", "linearMotions", "]"}], "\[NotEqual]", 
     RowBox[{"Length", "[", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "displacements", "}"}], "]"}], "]"}]}], ",", "\n", "\t\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismInfinitesimalMotions", "::", "lin"}], ",", 
       RowBox[{"Length", "[", "linearMotions", "]"}]}], "]"}], ";", "\n", 
     "\t\t", "$Failed"}], ",", "\n", "\t", "True", ",", "\n", "\t\t", 
    "$Failed"}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7341]:=",ExpressionUUID->"00e1398a-2b47-4b4f-8216-0f79a9e44e57"]
}, Closed]],

Cell[CellGroupData[{

Cell["PrestressStability[], PrestressStableQ[]", "Subsection",ExpressionUUID->"2410889c-f7e8-408e-9508-0a340dada935"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{
    "This", " ", "algorithm", " ", "for", " ", "prestress", " ", "stabiltiy", 
     " ", "comes", " ", "from", "\n", "\t\t", "Holmes"}], "\[Hyphen]", 
    "Cerfon", ",", " ", "Theran", ",", " ", 
    RowBox[{"and", " ", 
     RowBox[{
     "Gortler", ".", "\n", "\t\t", 
      "\"\<Almost\[Hyphen]Rigidity of Frameworks.\>\""}], "\n", "\t\t", 
     "Communications", " ", "on", " ", "Pure", " ", "and", " ", "Applied", 
     " ", "Mathematics", " ", "74"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"no", ".", " ", "10"}], " ", 
      RowBox[{"(", "2021", ")"}]}], ":", " ", 
     RowBox[{
      RowBox[{"2185", "-", 
       RowBox[{
       "2247.", "\n", "\n", "\t", "The", " ", "function", " ", "returns", 
        "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{"t", " ", ",", " ", "ss"}], " ", "}"}], "\n", "\t", "where", 
        " ", "t"}]}], " ", "<", " ", 
      RowBox[{
      "0", " ", "implies", " ", "the", " ", "system", " ", "is", " ", 
       "prestress", " ", "stable", " ", "and", " ", "ss", " ", "is", " ", 
       "the", " ", "resulting", " ", "self", " ", 
       RowBox[{"stress", "."}]}]}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "PrestressStability", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
       RowBox[{"Tolerance", "->", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "10"}], ")"}]}]}]}], " ", "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"PrestressStability", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
    
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"internalPrestressStability", "[", 
         RowBox[{
          RowBox[{"N", "[", "m", "]"}], ",", " ", 
          RowBox[{"N", "[", 
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}], ",", 
          " ", 
          RowBox[{"{", "opt", "}"}]}], "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
        "internalPrestressStability"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"PrestressStability", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "_"}], "]"}], ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{"PrestressStability", "::", "pos"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PrestressStability", "::", "pos"}], " ", "=", " ", 
     "\"\<Function does not support Deformed[] as it does not entirely make \
sense if a mechanism is stressed.\>\""}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"internalPrestressStability", "[", 
     RowBox[{"m_", " ", ",", " ", "positions_", " ", ",", " ", "opt_"}], 
     "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
        "v", ",", " ", "linear", ",", " ", "quadratic", ",", " ", 
         "dependencies", ",", " ", "variables", ",", " ", "eigenvals", ",", 
         " ", "initialSign", ",", " ", "quadraticForms", ",", " ", 
         "solution"}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"linear", ",", " ", "quadratic", ",", " ", "dependencies"}],
           "}"}], " ", "=", " ", 
         RowBox[{"MechanismInfinitesimalMotions", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"OutputVariables", "->", "v"}], ",", " ", "opt"}], 
             "}"}], "]"}]}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"variables", " ", "=", " ", 
         RowBox[{"Variables", "[", "linear", "]"}]}], ";", "\n", "\n", "\t", 
        RowBox[{"Which", "[", "\n", "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "dependencies", "]"}], "==", "0"}], ",", 
          "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"{", "}"}]}], "}"}], ",", "\n", "\n", "\t", "True", ",", 
          "\n", "\t\t", 
          RowBox[{
           RowBox[{"quadraticForms", " ", "=", " ", 
            RowBox[{"With", "[", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"tmpQuadraticForms", " ", "=", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"CoefficientArrays", "[", 
                    RowBox[{"#", ",", " ", "variables", ",", " ", 
                    RowBox[{"Symmetric", "->", "True"}]}], "]"}], "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "&"}], " ", "/@", " ", 
                 "quadratic"}]}], "}"}], ",", "\n", "\t\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "tmpQuadraticForms", "]"}], "==", 
                 "0"}], ",", "\n", "\t\t\t\t", 
                RowBox[{"{", "}"}], ",", "\n", "\t\t\t", "\n", "\t\t\t\t", 
                RowBox[{"(*", 
                 RowBox[{
                 "get", " ", "the", " ", "eigenvalues", " ", "of", " ", "the",
                   " ", "first", " ", "quadratic", " ", "form"}], "*)"}], 
                "\n", "\t\t\t\t", 
                RowBox[{
                 RowBox[{"eigenvals", " ", "=", " ", 
                  RowBox[{"Chop", " ", "@", " ", 
                   RowBox[{"Eigenvalues", "[", " ", 
                    RowBox[{"tmpQuadraticForms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "]"}]}]}], ";", "\n",
                  "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"Sign", "[", 
                   RowBox[{"Total", "[", 
                    RowBox[{"Sign", "[", "eigenvals", "]"}], "]"}], "]"}], 
                  " ", "tmpQuadraticForms"}]}]}], "\n", "\t\t\t", "]"}]}], 
             "\n", "\t\t", "]"}]}], ";", "\n", "\n", "\t\t", 
           RowBox[{"solution", " ", "=", " ", 
            RowBox[{"SemidefiniteOptimization", "[", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"ConstantArray", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", "quadraticForms", "]"}], "-", 
                   "1"}]}], "]"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], ",", "\n", "\t\t\t", 
              RowBox[{"Join", "[", 
               RowBox[{"quadraticForms", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"IdentityMatrix", "[", " ", 
                  RowBox[{"Length", "[", "variables", "]"}], " ", "]"}], 
                 "}"}]}], " ", "]"}]}], "\n", "\t\t", "]"}]}], ";", "\n", 
           "\t", "\n", "\t\t", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Last", "[", "solution", "]"}], ",", " ", 
             RowBox[{
              RowBox[{"Normalize", "[", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "1", "}"}], ",", 
                 RowBox[{"Drop", "[", 
                  RowBox[{"solution", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "]"}], "]"}], " ", ".", " ",
               "dependencies"}]}], " ", "}"}]}]}], "\n", "\t", "]"}]}]}], 
      "\n", "]"}], " ", "/;", " ", 
     RowBox[{"VertexCoordinatesQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"internalPrestressStability", "[", 
     RowBox[{"m_", ",", " ", "positions_", " ", ",", " ", "_"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"PrestressStability", "::", "pos"}], ",", " ", "positions"}], 
      "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PrestressStability", "::", "pos"}], " ", "=", " ", 
     "\"\<The positions `1` do not correspond to the mechanism.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7346]:=",ExpressionUUID->"ae220ecb-0d83-45ec-9a76-c37a3fe68a2d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "PrestressStableQ", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Constraints", "\[Rule]", "None"}], ",", " ", 
      RowBox[{"Tolerance", " ", "->", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "10"}], ")"}]}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PrestressStableQ", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"internalPrestressStableQ", "[", " ", 
        RowBox[{
         RowBox[{"N", "[", "m", "]"}], " ", ",", " ", 
         RowBox[{"N", "[", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}], " ", 
         ",", " ", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", ",", " ", 
         RowBox[{"{", "opt", "}"}]}], "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{
       RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
       "internalPrestressStableQ"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PrestressStableQ", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "_"}], "]"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"PrestressStableQ", "::", "pos"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PrestressStableQ", "::", "pos"}], " ", "=", " ", 
    "\"\<Function does not support Deformed[] as it does not entirely make \
sense if a mechanism is stressed.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"internalPrestressStableQ", "[", 
   RowBox[{
   "m_", " ", ",", " ", "positions_", " ", ",", " ", "tolerance_", ",", " ", 
    "opt_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "v", ",", " ", "linear", ",", " ", "quadratic", ",", " ", 
       "dependencies", ",", " ", "variables", ",", " ", "eigenvals", ",", " ",
        "initialSign", ",", " ", "quadraticForms", ",", " ", "solution"}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"linear", ",", " ", "quadratic", ",", " ", "dependencies"}], 
        "}"}], " ", "=", " ", 
       RowBox[{"MechanismInfinitesimalMotions", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"OutputVariables", "->", "v"}], ",", " ", "opt"}], "}"}], 
          "]"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"variables", " ", "=", " ", 
       RowBox[{"Variables", "[", "linear", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"Which", "[", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "dependencies", "]"}], "==", "0"}], ",", " ", 
        "False", ",", "\n", "\t", 
        RowBox[{
         RowBox[{"Length", "[", "dependencies", "]"}], "==", "1"}], ",", " ", 
        "True", ",", "\n", "\t", 
        RowBox[{
         RowBox[{"Length", "[", "variables", "]"}], " ", "==", " ", "1"}], 
        ",", " ", "True", ",", "\n", "\n", "\t", "True", ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"quadraticForms", " ", "=", " ", 
          RowBox[{"With", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tmpQuadraticForms", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"CoefficientArrays", "[", 
                  RowBox[{"#", ",", " ", "variables", ",", " ", 
                   RowBox[{"Symmetric", "->", "True"}]}], "]"}], "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "&"}], " ", "/@", " ", 
               "quadratic"}]}], "}"}], ",", "\n", "\t\t\t", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "tmpQuadraticForms", "]"}], "==", "0"}],
               ",", "\n", "\t\t\t\t", 
              RowBox[{"{", "}"}], ",", "\n", "\t\t\t", "\n", "\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{
               "get", " ", "the", " ", "eigenvalues", " ", "of", " ", "the", 
                " ", "first", " ", "quadratic", " ", "form"}], "*)"}], "\n", 
              "\t\t\t\t", 
              RowBox[{
               RowBox[{"eigenvals", " ", "=", " ", 
                RowBox[{"Chop", "[", " ", 
                 RowBox[{
                  RowBox[{"Eigenvalues", "[", " ", 
                   RowBox[{"tmpQuadraticForms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], ",", " ", 
                  "tolerance"}], " ", "]"}]}], ";", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{"Sign", "[", 
                 RowBox[{"Total", "[", 
                  RowBox[{"Sign", "[", "eigenvals", "]"}], "]"}], "]"}], " ", 
                "tmpQuadraticForms"}]}]}], "\n", "\t\t\t", "]"}]}], "\n", 
           "\t\t", "]"}]}], ";", "\n", "\n", "\t\t", 
         RowBox[{"solution", " ", "=", " ", 
          RowBox[{"SemidefiniteOptimization", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "quadraticForms", "]"}], "-", "1"}]}],
                "]"}], ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"Join", "[", 
             RowBox[{"quadraticForms", ",", " ", 
              RowBox[{"{", 
               RowBox[{"IdentityMatrix", "[", " ", 
                RowBox[{"Length", "[", "variables", "]"}], " ", "]"}], 
               "}"}]}], " ", "]"}]}], "\n", "\t\t", "]"}]}], ";", "\n", "\t", 
         "\n", "\t\t", 
         RowBox[{
          RowBox[{"Last", "[", "solution", "]"}], " ", "<", " ", "0"}]}]}], 
       "\n", "\t", "]"}]}]}], "\n", "]"}], "  ", "/;", " ", 
   RowBox[{"VertexCoordinatesQ", "[", 
    RowBox[{"m", ",", "positions"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7353]:=",ExpressionUUID->"9aa8bbab-3f0a-4ad1-816c-2398d9416fa1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismAugmentedConstraintMatrix[]", "Subsection",ExpressionUUID->"ad21117c-44e4-446d-8ebc-675dcaedf199"],

Cell["\<\
Bugs: specified constraints must be in the form of an equation (apparently).\
\>", "Text",ExpressionUUID->"9e39eab6-78a5-47c9-8d4a-3e1e48178ab7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismAugmentedConstraintMatrix", "]"}], " ", 
    "=", " ", 
    RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismAugmentedConstraintMatrix", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"pi_", "?", "PeriodicIdentificationDataQ"}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"augmentedConstraintMatrixInternal", "[", " ", 
       RowBox[{"m", " ", ",", " ", "pi", ",", " ", 
        RowBox[{"{", "opt", "}"}]}], " ", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"MatrixQ", "[", " ", "res", " ", "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7358]:=",ExpressionUUID->"6dac9b4f-30a2-4a84-a0c4-510db4fe60c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"augmentedConstraintMatrixInternal", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "pi_", " ", ",", " ", "options_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"constraints", " ", "=", " ", 
       RowBox[{
        RowBox[{"pi", "[", 
         RowBox[{"\"\<LatticeVectors\>\"", " ", "->", " ", 
          RowBox[{"designArbitraryBasis", "[", 
           RowBox[{"pi", ",", "\"\<a\>\""}], "]"}]}], "]"}], "[", 
        "\"\<Constraints\>\"", "]"}]}], ",", "\n", "\t", "constraintEq", ",", 
      " ", "variables"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"constraintEq", " ", "=", " ", 
      RowBox[{"MechanismConstraintMap", "[", 
       RowBox[{"m", ",", " ", "1", ",", " ", 
        RowBox[{"Normal", "@", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Constraints", " ", "->", " ", "constraints"}], "}"}], 
             ",", "options"}], "}"}], ",", "Flatten"}], "]"}]}]}], " ", 
       "]"}]}], ";", "\n", "\t", 
     RowBox[{"variables", " ", "=", " ", 
      RowBox[{"Flatten", "[", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"VertexDisplacement", "[", "m", "]"}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\"\<a\>\"", ",", " ", 
           RowBox[{"numberOfLatticeElements", "[", " ", 
            RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], " ", 
            "]"}]}], " ", "]"}]}], " ", "}"}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{
      RowBox[{"CoefficientArrays", "[", " ", 
       RowBox[{"constraintEq", " ", ",", " ", "variables"}], " ", "]"}], "[", 
      
      RowBox[{"[", "2", "]"}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7360]:=",ExpressionUUID->"48032c11-b473-4e3c-8376-40462be1cec4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"numberOfLatticeElements", "[", "2", "]"}], " ", "=", " ", "3"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"numberOfLatticeElements", "[", "3", "]"}], " ", "=", " ", "6"}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"designArbitraryBasis", "[", " ", 
   RowBox[{"pi_", " ", ",", " ", "name_"}], " ", "]"}], " ", ":=", " ", "\n", 
  
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", 
       RowBox[{"pi", "[", " ", "\"\<EmbeddingDimension\>\"", " ", "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"basis", " ", "=", " ", 
       RowBox[{"pi", "[", " ", "\"\<LatticeVectors\>\"", " ", "]"}]}]}], "\n",
      "}"}], ",", "\n", "\t", 
    RowBox[{"Switch", "[", 
     RowBox[{"d", ",", "\n", "\t\t", "2", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "1", "]"}], ",", " ", "0"}], "}"}]}], " ", 
        ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "2", "]"}], ",", " ", 
           RowBox[{"name", "[", "3", "]"}]}], "}"}]}]}], " ", "}"}], ",", 
      "\n", "\t\t", "3", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "1", "]"}], ",", " ", "0", ",", " ", "0"}], 
          "}"}]}], " ", ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "2", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "2", "]"}], ",", " ", 
           RowBox[{"name", "[", "3", "]"}], ",", " ", "0"}], "}"}]}], " ", 
        ",", " ", 
        RowBox[{
         RowBox[{"basis", "[", 
          RowBox[{"[", "3", "]"}], "]"}], " ", "+", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"name", "[", "4", "]"}], ",", " ", 
           RowBox[{"name", "[", "5", "]"}], ",", " ", 
           RowBox[{"name", "[", "6", "]"}]}], " ", "}"}]}]}], "}"}], ",", 
      "\n", "\t\t", "_", " ", ",", " ", "$Failed"}], "\n", "\t", "]"}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7361]:=",ExpressionUUID->"76236e65-adae-458b-9b18-cad6148ca08d"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismStressMatrix[]", "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"MechanismStressMatrix", "[", " ", 
     RowBox[{"m", ",", " ", "vec"}], " ", "]"}], " ", "returns", " ", "a", 
    " ", "stress", " ", "matrix", " ", "associated", " ", "with", " ", "the", 
    " ", "stress", " ", "vector", " ", 
    RowBox[{"vec", ".", " ", "The"}], " ", 
    RowBox[{"(", 
     RowBox[{"i", ",", "j"}], ")"}], " ", "component", " ", "of", " ", "the", 
    " ", "stress", " ", "matrix", " ", "is", " ", "the", " ", "negative", " ",
     "of", " ", "the", " ", "corresponding", "\n", "stress", " ", "vector", 
    " ", "component", " ", 
    RowBox[{"(", 
     RowBox[{"and", " ", "zero", " ", "otherwise"}], ")"}], " ", "and", " ", 
    "diagonal", " ", "components", " ", "are", " ", "chosen", " ", "so", " ", 
    "that", " ", "rows", " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", "Columns"}], " ", "should", " ", "also", 
    " ", "sum", " ", "to", " ", 
    RowBox[{"zero", ".", "\n", "\n", 
     RowBox[{"(", 
      RowBox[{
      "see", " ", "Connelly", " ", "on", " ", "generic", " ", "global", " ", 
       "rigidity"}], ")"}]}]}], "\n", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"MechanismStressMatrix", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "stressVector_"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
        "offDiagonalComponents", ",", " ", "diagonalComponents", ",", " ", 
         RowBox[{"edges", " ", "=", " ", 
          RowBox[{"MechanismConnectivity", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{
            "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
           "]"}]}]}], " ", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"offDiagonalComponents", " ", "=", " ", "\n", "\t", 
         RowBox[{
          RowBox[{"(", "\n", "\t\t", 
           RowBox[{"(*", "symmetrize", "*)"}], "\n", "\t\t", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", " ", "+", " ", 
              RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], " ", ")"}], 
           "\n", "\t", ")"}], " ", "@", " ", 
          RowBox[{"SparseArray", "[", " ", "\n", "\t\t", 
           RowBox[{
            RowBox[{"Thread", "[", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<edges\>\"", "]"}], " ", "\[Rule]", " ", 
              RowBox[{"-", "stressVector"}]}], " ", "]"}], ",", "\n", "\t\t", 
            
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], ",", " ", 
              RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "}"}]}], 
           "\n", "\t", "]"}]}]}], ";", "\n", "\t", 
        RowBox[{"diagonalComponents", " ", "=", " ", 
         RowBox[{"SparseArray", "[", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", "#"}], "}"}], "&"}], " ", "/@", " ", 
               RowBox[{"Range", "[", " ", 
                RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "]"}]}], 
              ")"}], " ", "\[Rule]", " ", 
             RowBox[{"(", 
              RowBox[{"-", " ", 
               RowBox[{"Total", " ", "/@", " ", 
                RowBox[{"Map", "[", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"offDiagonalComponents", "[", 
                    RowBox[{"[", " ", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "]"}], 
                   "&"}], ",", " ", 
                  RowBox[{"MechanismConnectivity", "[", 
                   RowBox[{"m", ",", " ", 
                    RowBox[{
                    "\"\<vertices\>\"", " ", "\[Rule]", " ", 
                    "\"\<edges\>\""}]}], "]"}], " ", ",", " ", 
                  RowBox[{"{", "2", "}"}]}], " ", "]"}]}]}], ")"}]}], " ", 
            "]"}], ",", "\n", "\t\t", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], ",", " ", 
             RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "}"}]}], 
          "\n", "\t", "]"}]}], ";", "\n", "\t", "\n", "\t", 
        RowBox[{
        "offDiagonalComponents", " ", "+", " ", "diagonalComponents"}]}]}], 
      "\n", "]"}], " ", "/;", " ", 
     RowBox[{"MechanismStressMatrixArgumentsQ", "[", " ", 
      RowBox[{"m", ",", " ", "stressVector"}], " ", "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismStressMatrix", "::", "svec"}], "=", 
     "\"\<Stress vector is not a vector.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismStressMatrix", "::", "len"}], "=", 
     "\"\<Stress vector length is not the same as the number of edges.\>\""}],
     ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismStressMatrixArgumentsQ", "[", " ", 
     RowBox[{"m_", ",", " ", "stressVector_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"Which", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Not", " ", "@", " ", 
       RowBox[{"VectorQ", "[", " ", "stressVector", " ", "]"}]}], " ", ",", 
      "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismStressMatrix", "::", "svec"}], "]"}], ";", " ", 
       "False"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"m", "[", "\"\<edges\>\"", "]"}], "]"}], " ", "\[NotEqual]", 
       " ", 
       RowBox[{"Length", "[", "stressVector", "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"MechanismStressMatrix", "::", "len"}], "]"}], ";", " ", 
       "False"}], ",", "\n", "\t", "True", ",", " ", "True"}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7364]:=",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simulating with flows and dynamics", "Section",ExpressionUUID->"76fced54-013e-4515-8b08-2183586114d5"],

Cell[CellGroupData[{

Cell["hamiltonianFlowQ[], gradientFlowQ[]", "Subsection",ExpressionUUID->"7b4d3594-a2cd-4090-b2a1-9d90f5514d19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hamiltonianFlowQ", "[", " ", "d_Association", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"And", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"KeyExistsQ", "[", 
      RowBox[{"d", ",", " ", "\"\<equations\>\""}], "]"}], " ", ",", "\n", 
     "\t", 
     RowBox[{"KeyExistsQ", "[", 
      RowBox[{"d", ",", " ", "\"\<variables\>\""}], "]"}], " ", ",", "\n", 
     "\t", 
     RowBox[{"KeyExistsQ", "[", 
      RowBox[{"d", ",", " ", "\"\<positions\>\""}], "]"}], " ", ",", "\n", 
     "\t", 
     RowBox[{"KeyExistsQ", "[", 
      RowBox[{"d", ",", " ", "\"\<momenta\>\""}], " ", "]"}]}], "\n", "\t", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"gradientFlowQ", "[", " ", "d_Association", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"And", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"KeyExistsQ", "[", 
     RowBox[{"d", ",", " ", "\"\<equations\>\""}], "]"}], " ", ",", "\n", 
    "\t", 
    RowBox[{"KeyExistsQ", "[", 
     RowBox[{"d", ",", " ", "\"\<variables\>\""}], "]"}], " ", ",", "\n", 
    "\t", 
    RowBox[{"KeyExistsQ", "[", 
     RowBox[{"d", ",", " ", "\"\<positions\>\""}], "]"}], " ", ",", "\n", 
    "\t", 
    RowBox[{"Not", "[", 
     RowBox[{"KeyExistsQ", "[", 
      RowBox[{"d", " ", ",", " ", "\"\<momenta\>\""}], "]"}], "]"}]}], "\n", 
   "\t", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7368]:=",ExpressionUUID->"504d03c0-fe86-4ca9-8744-0f67ab5a9e4c"]
}, Closed]],

Cell[CellGroupData[{

Cell["initialConditions[]", "Subsection",ExpressionUUID->"7871a4b4-9a3d-4b82-802a-b8b58c954324"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"initialConditions", "[", " ", 
    RowBox[{"flow_", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"initialPositions_", ",", " ", "initialMomenta_"}], "}"}]}], 
    " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"pos", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"flow", "[", "\"\<positions\>\"", "]"}], "]"}], " ", "->",
              " ", 
             RowBox[{"Flatten", "[", "initialPositions", "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{"0", " ", "->", " ", "_"}]}], " ", "]"}]}], ",", "\n", 
        "\t\t", 
        RowBox[{"mom", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"flow", "[", "\"\<momenta\>\"", "]"}], "]"}], " ", "->",
              " ", 
             RowBox[{"Flatten", "[", "initialMomenta", "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{"0", " ", "->", " ", "_"}]}], " ", "]"}]}]}], "\n", "\t", 
       "}"}], ",", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"flow", "[", "\"\<variables\>\"", "]"}], " ", "/.", " ", 
       RowBox[{"Join", "[", " ", 
        RowBox[{"pos", ",", " ", "mom"}], " ", "]"}]}]}], "\n", "\t", "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"KeyExistsQ", "[", " ", 
      RowBox[{"flow", ",", " ", "\"\<momenta\>\""}], " ", "]"}], " ", "&&", 
     " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", " ", "initialPositions", " ", "]"}], " ", "==",
       " ", 
      RowBox[{"Dimensions", "[", " ", "initialMomenta", " ", "]"}], " ", "==",
       " ", 
      RowBox[{"Dimensions", "[", " ", 
       RowBox[{"flow", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"initialConditions", "[", " ", 
    RowBox[{"flow_", " ", ",", " ", "initialPositions_"}], " ", "]"}], " ", ":=",
    "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"pos", " ", "=", " ", 
        RowBox[{"DeleteCases", "[", " ", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"flow", "[", "\"\<positions\>\"", "]"}], "]"}], " ", "->",
             " ", 
            RowBox[{"Flatten", "[", "initialPositions", "]"}]}], "]"}], ",", 
          " ", 
          RowBox[{"0", " ", "->", " ", "_"}]}], " ", "]"}]}], "\n", "\t", 
       "}"}], ",", " ", "\n", "\t", 
      RowBox[{
       RowBox[{"flow", "[", "\"\<variables\>\"", "]"}], " ", "/.", " ", 
       "pos"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{"KeyExistsQ", "[", 
       RowBox[{"flow", ",", " ", "\"\<momenta\>\""}], "]"}], "]"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", " ", "initialPositions", " ", "]"}], " ", "==",
       " ", 
      RowBox[{"Dimensions", "[", " ", 
       RowBox[{"flow", "[", "\"\<positions\>\"", "]"}], " ", "]"}]}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"initialConditions", "[", " ", 
   RowBox[{"flow_", " ", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  "$Failed"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7370]:=",ExpressionUUID->"1f0b9228-4044-4ca1-8bf0-2c099e24aedf"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismHamiltonianFlow[]", "Subsection",ExpressionUUID->"6a71ee25-39e3-4d5e-b01a-4e093e7840ef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismHamiltonianFlow", "]"}], "=", "\n", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"VertexMass", "\[Rule]", "1"}], ",", "\n", "\t", 
        RowBox[{"VertexDrag", "->", "0"}], ",", "\n", "\t", 
        RowBox[{"AddedEnergy", "\[Rule]", "0"}]}], " ", 
       RowBox[{"(*", 
        RowBox[{
        "additional", " ", "terms", " ", "to", " ", "add", " ", "to", " ", 
         "the", " ", "energy"}], "*)"}], "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"FilterRules", "[", " ", 
       RowBox[{
        RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
        RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", 
       "]"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"vertexMassQ", "[", " ", 
   RowBox[{
    RowBox[{"mass_", "?", "NumericQ"}], " ", ",", " ", "vertexNumber_"}], " ",
    "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"TrueQ", "[", 
     RowBox[{"mass", " ", ">", " ", "0"}], "]"}], ",", " ", "True", ",", " ", 
    
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "mass"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexMassQ", "[", " ", 
   RowBox[{
    RowBox[{"mass_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], "&"}]}], "]"}], "&"}], ")"}]}], " ", 
    ",", " ", "vertexNumber_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"TrueQ", "[", 
     RowBox[{
      RowBox[{"Length", "[", "mass", "]"}], " ", "==", " ", "vertexNumber"}], 
     "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "mass"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexMassQ", "[", " ", 
    RowBox[{"_", " ", ",", " ", "vertexNumber_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "mass"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"vertexDragQ", "[", " ", 
   RowBox[{
    RowBox[{"drag_", "?", "NumericQ"}], ",", " ", "vertexNumber_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"TrueQ", "[", " ", 
     RowBox[{"drag", " ", ">=", " ", "0"}], "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "drag"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"vertexDragQ", "[", " ", 
   RowBox[{
    RowBox[{"drag_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">=", "0"}]}], "&"}]}], "]"}], "&"}], ")"}]}], " ", 
    ",", " ", "vertexNumber_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"TrueQ", "[", 
     RowBox[{
      RowBox[{"Length", "[", "drag", "]"}], " ", "==", " ", "vertexNumber"}], 
     "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "drag"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"vertexDragQ", "[", " ", 
    RowBox[{"_", " ", ",", " ", "vertexNumber_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismHamiltonianFlow", "::", "drag"}], " ", ",", " ", 
       "vertexNumber"}], "]"}], ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismHamiltonianFlow", "::", "mass"}], "=", 
   "\"\<Mass should be a positive number of a list of masses of length \
`1`\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismHamiltonianFlow", "::", "drag"}], "=", 
    "\"\<Drag should be a non-negative number of a list of drags of length \
`1`\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismHamiltonianFlow", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", "  ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"masses", " ", "=", " ", 
       RowBox[{"N", " ", "@", " ", 
        RowBox[{"OptionValue", "[", "VertexMass", "]"}]}]}], ",", "\n", "\t", 
      
      RowBox[{"drag", " ", "=", " ", 
       RowBox[{"N", " ", "@", " ", 
        RowBox[{"OptionValue", "[", "VertexDrag", "]"}]}]}]}], "\n", "}"}], 
    ",", "\n", "\t", 
    RowBox[{
     RowBox[{"hamiltonianFlow", "[", " ", 
      RowBox[{
      "m", " ", ",", " ", "masses", " ", ",", " ", "drag", " ", ",", " ", 
       RowBox[{
       "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], "]"}], ",", " ", 
       
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", 
         RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}]}], " ", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"vertexMassQ", "[", " ", 
       RowBox[{"masses", ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}], " ", "&&", 
      " ", 
      RowBox[{"vertexDragQ", "[", " ", 
       RowBox[{"drag", ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "]"}]}]}]}], 
   "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7373]:=",ExpressionUUID->"c3a549fb-eb9d-4550-b4a2-9c76c1102045"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{"hamiltonianFlowVector", "[", 
    RowBox[{"mechanism", ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vertex", " ", "variables"}], ",", " ", 
       RowBox[{
        RowBox[{"momentum", "/", "velocity"}], " ", "variables"}]}], "}"}], 
     ",", " ", "masses", ",", " ", 
     RowBox[{"options", " ", "for", " ", 
      RowBox[{"MechanismEnergy", "[", "]"}], " ", "\n", "\n", "Note", " ", 
      "that", " ", "we", " ", "have", " ", "allowed", " ", "the", " ", 
      "possibility", " ", "of", " ", "drag"}], ",", " ", 
     RowBox[{"for", " ", 
      RowBox[{"which", ":", "\n", "\t", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"p", ",", "t"}], "]"}], " ", "==", " ", 
        RowBox[{
         RowBox[{"-", " ", 
          RowBox[{
           RowBox[{"V", "'"}], "[", "x", "]"}]}], " ", "-", " ", 
         RowBox[{"\[Gamma]", " ", "p", "\n", "\t", 
          RowBox[{"D", "[", 
           RowBox[{"x", ",", "t"}], "]"}]}]}], " ", "==", " ", 
        RowBox[{
         RowBox[{"p", "/", "m"}], "\n", "\n", "This", " ", "gives", " ", 
         "the", " ", "ODE", " ", 
         RowBox[{"D", "[", 
          RowBox[{"x", ",", 
           RowBox[{"{", 
            RowBox[{"t", ",", "2"}], "}"}]}], "]"}]}], " ", "==", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"V", "'"}], "[", "x", "]"}]}], "/", "m"}], " ", "-", " ", 
         
         RowBox[{"\[Gamma]", " ", 
          RowBox[{"p", "/", "m"}]}]}], " ", "==", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"V", "'"}], "[", "x", "]"}]}], "/", "m"}], " ", "-", " ", 
         
         RowBox[{"\[Gamma]", " ", 
          RowBox[{"D", "[", 
           RowBox[{"x", ",", "t"}], "]"}]}]}]}]}]}]}], "\n"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"hamiltonianFlow", "[", " ", 
    RowBox[{
    "m_", ",", " ", "mass_", ",", " ", "drag_", " ", ",", " ", "addedEnergy_",
      " ", ",", " ", "opt_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"unfixedVertices", " ", "=", " ", 
        RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", "\n", "\t", 
       RowBox[{"linearRules", " ", "=", " ", 
        RowBox[{"Dispatch", " ", "@", " ", 
         RowBox[{"MechanismLinearConstraints", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"FilterRules", "[", 
            RowBox[{"opt", ",", 
             RowBox[{"Options", "[", "MechanismLinearConstraints", "]"}]}], 
            "]"}]}], "]"}]}]}], ",", " ", "\n", "\t", 
       RowBox[{"energy", " ", "=", " ", 
        RowBox[{
         RowBox[{"MechanismEnergy", "[", " ", 
          RowBox[{
           RowBox[{"N", "[", "m", "]"}], ",", " ", "opt"}], "]"}], " ", "+", 
         " ", 
         RowBox[{"N", "[", "addedEnergy", "]"}]}]}], ",", "\n", "\t", 
       "gradient", ",", " ", "momentum", ",", "\n", "\t", "v", ",", "p"}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v", ",", "p"}], "}"}], " ", "=", " ", 
       RowBox[{"standardVariableNames", "[", "m", "]"}]}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"which", " ", "vertices", " ", "are", " ", 
        RowBox[{"fixed", "?"}]}], "*)"}], "\n", "\t", 
      RowBox[{"unfixedVertices", " ", "=", " ", 
       RowBox[{"Cases", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"unfixedVertices", " ", "/.", " ", "linearRules"}], "]"}], 
         ",", " ", "_VertexPosition"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"gradient", " ", "=", " ", 
       RowBox[{
        RowBox[{"-", " ", 
         RowBox[{"renameVertexVariables", "[", " ", 
          RowBox[{"v", " ", ",", " ", 
           RowBox[{"D", "[", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"energy", " ", "/.", " ", "linearRules"}], ")"}], " ", 
             ",", 
             RowBox[{"{", "unfixedVertices", "}"}]}], "]"}]}], " ", "]"}]}], 
        " ", "-", " ", 
        RowBox[{"renameVertexVariables", "[", " ", 
         RowBox[{"p", ",", " ", "unfixedVertices"}], "]"}]}]}], ";", "\n", 
      "\t", 
      RowBox[{"momentum", " ", "=", " ", 
       RowBox[{
        RowBox[{"renameVertexVariables", "[", " ", 
         RowBox[{"p", " ", ",", " ", "unfixedVertices"}], "]"}], "/", 
        "mass"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
      RowBox[{"Association", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"\"\<positions\>\"", " ", "->", " ", 
         RowBox[{"renameVertexVariables", "[", " ", 
          RowBox[{"v", " ", ",", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
            "linearRules"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"\"\<momenta\>\"", " ", "->", " ", 
         RowBox[{"renameVertexVariables", "[", " ", 
          RowBox[{"p", " ", ",", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
            "linearRules"}]}], " ", "]"}]}], ",", " ", "\n", "\t\t", 
        RowBox[{"\"\<variables\>\"", " ", "->", " ", 
         RowBox[{"Join", "[", " ", 
          RowBox[{
           RowBox[{"renameVertexVariables", "[", " ", 
            RowBox[{"v", " ", ",", " ", "unfixedVertices"}], " ", "]"}], ",", 
           " ", 
           RowBox[{"renameVertexVariables", "[", " ", 
            RowBox[{"p", " ", ",", " ", "unfixedVertices"}], " ", "]"}]}], 
          " ", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"\"\<equations\>\"", " ", "->", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"momentum", ",", "gradient"}], "}"}], "]"}]}]}], "\n", 
       "\t", "]"}]}]}], "\n", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7383]:=",ExpressionUUID->"a413753e-7157-4c11-97c3-9d53eba60052"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismGradientFlow[]", "Subsection",ExpressionUUID->"f5094168-5605-4865-8166-98df93726d0f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismGradientFlow", "]"}], " ", "=", "\n", 
    "\t", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"AddedEnergy", "\[Rule]", "0"}], " ", 
       RowBox[{"(*", 
        RowBox[{
        "additional", " ", "terms", " ", "to", " ", "add", " ", "to", " ", 
         "the", " ", "energy"}], "*)"}], "\n", "\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{"FilterRules", "[", " ", 
       RowBox[{
        RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
        RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", 
       "]"}]}], "\n", "\t", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismGradientFlow", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{"gradientFlow", "[", " ", 
   RowBox[{"m", " ", ",", " ", 
    RowBox[{"Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
     RowBox[{"m", ",", 
      RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], "]"}], " ", ",", 
    " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7384]:=",ExpressionUUID->"a5245adf-945d-4536-b3d5-e446fc1aab0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"gradientFlow", "[", " ", 
   RowBox[{"m_", ",", " ", "addedEnergy_", " ", ",", " ", "opt_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"unfixedVertices", " ", "=", " ", 
       RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", "\n", "\t", 
      RowBox[{"linearRules", " ", "=", " ", 
       RowBox[{"Dispatch", " ", "@", " ", 
        RowBox[{"MechanismLinearConstraints", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{"opt", ",", 
            RowBox[{"Options", "[", "MechanismLinearConstraints", "]"}]}], 
           "]"}]}], "]"}]}]}], ",", " ", "\n", "\t", 
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismEnergy", "[", " ", 
         RowBox[{
          RowBox[{"N", "[", "m", "]"}], ",", " ", "opt"}], "]"}], " ", "+", 
        " ", 
        RowBox[{"N", "[", "addedEnergy", "]"}]}]}], ",", "\n", "\t", 
      "gradient", ",", " ", "momentum", ",", "\n", "\t", "v", ",", "p"}], 
     "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"v", ",", "p"}], "}"}], " ", "=", " ", 
      RowBox[{"standardVariableNames", "[", "m", "]"}]}], ";", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{"which", " ", "vertices", " ", "are", " ", "fixed"}], "*)"}], 
     "\n", "\t", 
     RowBox[{"unfixedVertices", " ", "=", " ", 
      RowBox[{"Cases", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"unfixedVertices", " ", "/.", " ", "linearRules"}], "]"}], 
        ",", " ", "_VertexPosition"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"gradient", " ", "=", " ", 
      RowBox[{"-", " ", 
       RowBox[{"renameVertexVariables", "[", " ", 
        RowBox[{"v", " ", ",", " ", 
         RowBox[{"D", "[", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"energy", " ", "/.", " ", "linearRules"}], ")"}], " ", 
           ",", 
           RowBox[{"{", "unfixedVertices", "}"}]}], "]"}]}], " ", "]"}]}]}], 
     ";", "\n", "\[IndentingNewLine]", "\t", 
     RowBox[{"Association", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"\"\<positions\>\"", " ", "->", " ", 
        RowBox[{"renameVertexVariables", "[", " ", 
         RowBox[{"v", " ", ",", " ", 
          RowBox[{
           RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
           "linearRules"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"\"\<variables\>\"", " ", "->", " ", 
        RowBox[{"Join", "[", " ", 
         RowBox[{"renameVertexVariables", "[", " ", 
          RowBox[{"v", " ", ",", " ", "unfixedVertices"}], " ", "]"}], " ", 
         "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"\"\<equations\>\"", " ", "->", " ", 
        RowBox[{"Flatten", "[", "gradient", "]"}]}]}], "\n", "\t", "]"}]}]}], 
   "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7386]:=",ExpressionUUID->"8782f53d-2777-4b26-9deb-d90a391b9d1f"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismNDSolve[]", "Subsection",ExpressionUUID->"47b8cdf4-769b-4346-b108-c4beb2d9a4b0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismNDSolve", "[", " ", 
    RowBox[{"d_", " ", ",", " ", "initialC_", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"t_", ",", " ", "tstart_", ",", " ", "tend_"}], "}"}]}], " ", 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"Module", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "t", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"d", "[", "\"\<variables\>\"", "]"}]}], ")"}]}], ",", "\n",
         "\t\t", 
        RowBox[{"velocities", " ", "=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "'"}], "[", "t", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"d", "[", "\"\<variables\>\"", "]"}]}], ")"}]}], ",", "\n",
         "\t\t", 
        RowBox[{"initial", " ", "=", " ", 
         RowBox[{"initialConditions", "[", " ", 
          RowBox[{"d", ",", " ", "initialC"}], " ", "]"}]}]}], "\n", "\t", 
       "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"NDSolve", "[", " ", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"Join", "[", "\n", "\t\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{"actual", " ", "equations"}], "*)"}], "\n", 
              "\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Thread", "[", 
                RowBox[{"velocities", " ", "==", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"d", "[", "\"\<equations\>\"", "]"}], " ", "/.", 
                   " ", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", 
                    " ", "positions"}], "]"}]}], ")"}]}], "]"}], ",", "\n", 
               "\t\t\t\t\t", 
               RowBox[{"(*", 
                RowBox[{"initial", " ", "conditions"}], "*)"}], "\n", 
               "\t\t\t\t\t", 
               RowBox[{"Thread", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"positions", " ", "/.", " ", 
                   RowBox[{"t", "->", "tstart"}]}], ")"}], " ", "==", " ", 
                 "initial"}], "]"}]}], "\n", "\t\t\t\t", "]"}], ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"d", "[", "\"\<variables\>\"", "]"}], ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"{", 
              RowBox[{"t", ",", " ", "tstart", ",", " ", "tend"}], "}"}]}], 
            "\n", "\t\t\t", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", "/.", " ", 
            RowBox[{"First", "[", "res", "]"}]}], ")"}], " ", "/;", " ", 
          RowBox[{"ListQ", "[", "res", "]"}]}]}], "\n", "\t\t", "]"}], " ", "/;",
        " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"initial", " ", "===", " ", "$Failed"}], ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"MechanismNDSolve", "::", "init"}], ",", " ", 
            "initialConditions"}], "]"}], ";", " ", "False"}], ",", " ", 
         "True"}], "]"}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"hamiltonianFlowQ", "[", "d", "]"}], " ", "||", " ", 
     RowBox[{"gradientFlowQ", "[", "d", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismNDSolve", "[", " ", 
    RowBox[{"d_", " ", ",", " ", "initialC_", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{
      "t_", ",", " ", "tstart_", ",", " ", "tend_", ",", " ", "stepsize_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"Module", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "t", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"d", "[", "\"\<variables\>\"", "]"}]}], ")"}]}], ",", "\n",
         "\t\t", 
        RowBox[{"velocities", " ", "=", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"#", "'"}], "[", "t", "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"d", "[", "\"\<variables\>\"", "]"}]}], ")"}]}], ",", "\n",
         "\t\t", 
        RowBox[{"initial", " ", "=", " ", 
         RowBox[{"initialConditions", "[", " ", 
          RowBox[{"d", ",", " ", "initialC"}], " ", "]"}]}], ",", "\n", 
        "\t\t", 
        RowBox[{"range", " ", "=", " ", 
         RowBox[{"List", " ", "/@", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{"t", " ", "->", " ", 
            RowBox[{"Range", "[", " ", 
             RowBox[{"tstart", ",", " ", "tend", ",", " ", "stepsize"}], " ", 
             "]"}]}], "]"}]}]}]}], "\n", "\t", "}"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"NDSolve", "[", "\n", "\t\t\t\t\t", 
            RowBox[{
             RowBox[{"Join", "[", "\n", "\t\t\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{"actual", " ", "equations"}], "*)"}], "\n", 
              "\t\t\t\t\t\t", 
              RowBox[{
               RowBox[{"Thread", "[", 
                RowBox[{"velocities", " ", "==", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"d", "[", "\"\<equations\>\"", "]"}], " ", "/.", 
                   " ", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", 
                    " ", "positions"}], "]"}]}], ")"}]}], "]"}], ",", "\n", 
               "\t\t\t\t\t\t", 
               RowBox[{"(*", 
                RowBox[{"initial", " ", "conditions"}], "*)"}], "\n", 
               "\t\t\t\t\t\t", 
               RowBox[{"Thread", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"positions", " ", "/.", " ", 
                   RowBox[{"t", "->", "tstart"}]}], ")"}], " ", "==", " ", 
                 "initial"}], "]"}]}], "\n", "\t\t\t\t\t", "]"}], ",", "\n", 
             "\t\t\t\t\t", 
             RowBox[{"d", "[", "\"\<variables\>\"", "]"}], ",", "\n", 
             "\t\t\t\t\t", 
             RowBox[{"{", 
              RowBox[{"t", ",", " ", "tstart", ",", " ", "tend"}], "}"}]}], 
            "\n", "\t\t\t\t", "]"}]}], "\n", "\t\t", "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", "/.", " ", 
              RowBox[{"Thread", "[", " ", 
               RowBox[{
                RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", " ", 
                
                RowBox[{"(", 
                 RowBox[{"positions", " ", "/.", " ", 
                  RowBox[{"First", "[", "res", "]"}]}], ")"}]}], " ", "]"}]}],
              ")"}], " ", "/.", " ", "range"}], ")"}], " ", "/;", " ", 
          RowBox[{"ListQ", "[", "res", "]"}]}]}], "\n", "\n", "\t\t", "]"}], 
       " ", "/;", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"initial", " ", "===", " ", "$Failed"}], ",", " ", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"MechanismNDSolve", "::", "init"}], ",", " ", 
            "initialConditions"}], "]"}], ";", " ", "False"}], ",", " ", 
         "True"}], "]"}]}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"hamiltonianFlowQ", "[", "d", "]"}], " ", "||", " ", 
     RowBox[{"gradientFlowQ", "[", "d", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismNDSolve", "::", "init"}], "=", " ", 
   "\"\<Could not resolve initial conditions `1` for this flow.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7387]:=",ExpressionUUID->"51ced9f3-17f5-4521-a84c-2fc54990ec3a"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismItoProcess[]", "Subsection",ExpressionUUID->"75c1debb-7b3b-4975-8b14-8b6391e4e9f8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismItoProcess", "[", " ", 
    RowBox[{
     RowBox[{"d_", "?", "hamiltonianFlowQ"}], " ", ",", " ", "noise_", " ", 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"initialPositions_", "?", "VertexCoordinatesQ"}], ",", " ", 
       RowBox[{"initialMomenta_", "?", "VertexCoordinatesQ"}]}], "}"}], " ", 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{
      "t_", ",", " ", "tstart_", ",", " ", "tend_", ",", " ", "stepsize_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"noiseVector", " ", "=", " ", 
        RowBox[{"Join", "[", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", " ", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"d", "[", "\"\<variables\>\"", "]"}], "]"}], "/", 
             "2"}]}], "]"}], ",", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"noise", ",", " ", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"d", "[", "\"\<variables\>\"", "]"}], "]"}], "/", 
             "2"}]}], "]"}]}], " ", "]"}]}], "}"}], ",", "\t\t", "\n", "\t\t", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"process", " ", "=", " ", 
          RowBox[{"ItoProcess", "[", "\n", "\t\t\t\t\t\t\t", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"d", "[", "\"\<equations\>\"", "]"}], ",", " ", 
              "noiseVector"}], "}"}], ",", " ", "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"d", "[", "\"\<variables\>\"", "]"}], ",", 
              RowBox[{"initialConditions", "[", 
               RowBox[{"d", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"initialPositions", ",", " ", "initialMomenta"}], 
                 "}"}]}], "]"}]}], "}"}], ",", " ", "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{"t", ",", " ", "tstart"}], "}"}]}], "\n", "\t\t\t", 
           "]"}]}], "}"}], ",", "\n", "\t\t\t", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"res", " ", "=", " ", 
            RowBox[{"RandomFunction", "[", " ", 
             RowBox[{"process", " ", ",", " ", 
              RowBox[{"{", 
               RowBox[{"tstart", ",", " ", "tend", ",", " ", "stepsize"}], 
               "}"}]}], "]"}]}], "}"}], ",", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", "/.", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{
                  RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", 
                  " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
               RowBox[{
                RowBox[{"res", "[", "\"\<Paths\>\"", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}]}], ")"}]}],
             " ", ")"}], " ", "/;", " ", 
           RowBox[{
            RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
            "RandomFunction"}]}]}], "\n", "\t\t", "]"}]}], "]"}]}], "\n", 
     "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", 
      RowBox[{"d", "[", "\"\<positions\>\"", "]"}], "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "initialPositions", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "initialMomenta", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismItoProcess", "[", " ", 
    RowBox[{
     RowBox[{"d_", "?", "gradientFlowQ"}], " ", ",", " ", "noise_", " ", ",", 
     " ", 
     RowBox[{"initialPositions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
     
     RowBox[{"{", 
      RowBox[{
      "t_", ",", " ", "tstart_", ",", " ", "tend_", ",", " ", "stepsize_"}], 
      "}"}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"noiseVector", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"noise", ",", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"d", "[", "\"\<variables\>\"", "]"}], "]"}]}], " ", 
         "]"}]}], "}"}], ",", "\t\t", "\n", "\t\t", 
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"process", " ", "=", " ", 
          RowBox[{"ItoProcess", "[", "\n", "\t\t\t\t\t\t\t", 
           RowBox[{
            RowBox[{"{", " ", 
             RowBox[{
              RowBox[{"d", "[", "\"\<equations\>\"", "]"}], ",", " ", 
              "noiseVector"}], "}"}], ",", " ", "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"d", "[", "\"\<variables\>\"", "]"}], ",", 
              RowBox[{"initialConditions", "[", 
               RowBox[{"d", ",", " ", "initialPositions"}], "]"}]}], "}"}], 
            ",", " ", "\n", "\t\t\t\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{"t", ",", " ", "tstart"}], "}"}]}], "\n", "\t\t\t", 
           "]"}]}], "}"}], ",", "\n", "\t\t\t", 
        RowBox[{"With", "[", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"res", " ", "=", " ", 
            RowBox[{"RandomFunction", "[", " ", 
             RowBox[{"process", " ", ",", " ", 
              RowBox[{"{", 
               RowBox[{"tstart", ",", " ", "tend", ",", " ", "stepsize"}], 
               "}"}]}], "]"}]}], "}"}], ",", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", "/.", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{
                  RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", 
                  " ", "#"}], " ", "]"}], "&"}], " ", "/@", " ", 
               RowBox[{
                RowBox[{"res", "[", "\"\<Paths\>\"", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}]}], ")"}]}],
             " ", ")"}], " ", "/;", " ", 
           RowBox[{
            RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
            "RandomFunction"}]}]}], "\n", "\t\t", "]"}]}], "]"}]}], "\n", 
     "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", 
      RowBox[{"d", "[", "\"\<positions\>\"", "]"}], "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "initialPositions", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismItoProcess", "[", " ", 
    RowBox[{"d_", ",", " ", "_", ",", " ", "initial_", ",", " ", "_"}], "]"}],
    " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismItoProcess", "::", "init"}], ",", " ", "initial"}], 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismItoProcess", "::", "init"}], "=", " ", 
   "\"\<Could not resolve initial conditions `1` for this flow.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7390]:=",ExpressionUUID->"2235d9f8-fa36-4da3-a523-d5f3eb4b06ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["MetropolisEnergy[]", "Subsection",ExpressionUUID->"bc938ce6-3992-448f-acc2-17a2ed40c182"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MetropolisEnergy", "]"}], " ", "=", " ", 
    RowBox[{"FilterRules", "[", " ", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismEnergy", "]"}], ",", " ", 
      RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", "]"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MetropolisEnergy", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "energy", ",", " ", "linearRules", ",", " ", "v", ",", "\n", "\t", 
       "unfixedVertices", ",", " ", "variables", ",", "\n", "\t", 
       "compiledEnergy"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"v", " ", "=", " ", 
       RowBox[{"standardVariableNames", "[", "m", "]"}]}], ";", "\n", "\t", 
      RowBox[{"linearRules", " ", "=", " ", 
       RowBox[{"MechanismLinearConstraints", "[", " ", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MechanismLinearConstraints", "]"}]}], " ",
           "]"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"unfixedVertices", " ", "=", " ", 
       RowBox[{"Cases", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
           "linearRules"}], "]"}], ",", " ", "_VertexPosition"}], " ", 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"variables", " ", "=", " ", 
       RowBox[{"renameVertexVariables", "[", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", "unfixedVertices"}], 
        " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{"renameVertexVariables", "[", " ", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"MechanismEnergy", "[", " ", 
           RowBox[{"m", " ", ",", " ", "opt"}], " ", "]"}], " ", "/.", " ", 
          "linearRules"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"compiledEnergy", " ", "=", " ", 
       RowBox[{"Compile", " ", "@@", " ", 
        RowBox[{"{", " ", 
         RowBox[{"variables", " ", ",", " ", "energy", " ", ",", " ", 
          RowBox[{
          "CompilationTarget", " ", "->", " ", 
           "$MechanismCompilationTarget"}]}], "}"}]}]}], ";", "\n", "\n", 
      "\t", 
      RowBox[{"Association", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"\"\<positions\>\"", " ", "->", " ", 
         RowBox[{"renameVertexVariables", "[", " ", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"[", "1", "]"}], "]"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
            "linearRules"}]}], " ", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"\"\<variables\>\"", " ", "->", " ", "variables"}], ",", "\n",
         "\t\t", 
        RowBox[{"\"\<energy\>\"", " ", "->", " ", "energy"}], ",", "\n", 
        "\t\t", 
        RowBox[{
        "\"\<compiled energy\>\"", " ", "->", " ", "compiledEnergy"}]}], "\n",
        "\t", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"metropolisEnergyQ", "[", " ", "d_Association", "]"}], " ", ":=", 
  " ", 
  RowBox[{"And", "[", " ", 
   RowBox[{
    RowBox[{"KeyExistsQ", "[", " ", 
     RowBox[{"d", ",", " ", "\"\<positions\>\""}], "]"}], " ", ",", " ", 
    RowBox[{"KeyExistsQ", "[", " ", 
     RowBox[{"d", ",", " ", "\"\<energy\>\""}], "]"}], " ", ",", " ", 
    RowBox[{"KeyExistsQ", "[", " ", 
     RowBox[{"d", ",", " ", "\"\<compiled energy\>\""}], "]"}]}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:08 \
In[7394]:=",ExpressionUUID->"dad8f07f-6e82-4d90-82ad-f6ac6a36ef22"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismMetropolis[] ", "Subsection",ExpressionUUID->"f5df93a4-f5be-4c26-9015-e6d6a994d7d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", " ", "MechanismMetropolis", " ", "]"}], " ", ":=",
     " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"WorkingPrecision", " ", "->", " ", "MachinePrecision"}], " ", 
      ",", " ", "\n", "\t", 
      RowBox[{"Distribution", " ", "->", " ", 
       RowBox[{"NormalDistribution", "[", 
        RowBox[{"0", ",", 
         RowBox[{"1", "/", "10"}]}], "]"}]}]}], "\n", "\t", "}"}]}], " ", 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismMetropolis", "[", " ", 
   RowBox[{
    RowBox[{"d_", "?", "metropolisEnergyQ"}], " ", ",", " ", 
    RowBox[{"positions_", "?", "VertexCoordinatesQ"}], " ", ",", " ", 
    RowBox[{"inverseTemperature_", "?", "inverseTemperatureQ"}], " ", ",", 
    " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"initialSteps_", "?", "stepNumberQ"}], ",", " ", 
      RowBox[{"steps_", "?", "stepNumberQ"}]}], "}"}], " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
      "oldEnergy", ",", " ", "newEnergy", ",", "\n", "\t", "random", ",", 
       "\n", "\t", 
       RowBox[{"compiledEnergy", " ", "=", " ", 
        RowBox[{"d", "[", "\"\<compiled energy\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"initialState", " ", "=", " ", 
        RowBox[{
         RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "/.", " ", 
         RowBox[{"DeleteCases", "[", " ", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"d", "[", "\"\<positions\>\"", "]"}], "]"}], " ", "->", 
             " ", 
             RowBox[{"Flatten", "[", " ", "positions", " ", "]"}]}], "]"}], 
           ",", " ", 
           RowBox[{"0", " ", "->", " ", "_"}]}], " ", "]"}]}]}], ",", "\n", 
       "\t", "stateAfterSkipping", ",", "\n", "\t", "output"}], "\n", "}"}], 
     ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "initialize", " ", "the", " ", "first", " ", "set", " ", "of", " ", 
       "random", " ", "displacements"}], "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"random", " ", "=", " ", 
       RowBox[{"RandomVariate", "[", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "Distribution", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"initialSteps", " ", "-", " ", "1"}], ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"d", "[", "\"\<variables\>\"", "]"}], "]"}]}], "}"}], ",",
          " ", 
         RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}]}], " ", 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"if", " ", "all", " ", "worked"}], ",", " ", 
        RowBox[{
        "run", " ", "the", " ", "metropolis", " ", "algorithm", " ", "a", " ",
          "bunch", " ", "of", " ", "times", " ", "and", " ", "just", " ", 
         "remember", " ", "the", " ", "last", " ", "value"}]}], "*)"}], "\n", 
      "\t", 
      RowBox[{"stateAfterSkipping", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "random", "]"}], " ", "=!=", " ", 
          "RandomVariate"}], ",", "\n", "\t\t", 
         RowBox[{"Fold", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", " ", 
               RowBox[{"e", " ", "=", " ", 
                RowBox[{"compiledEnergy", " ", "@@", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "#2"}], ")"}]}]}], 
               "}"}], ",", " ", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"RandomReal", "[", "]"}], " ", "<", " ", 
                 RowBox[{"Exp", "[", " ", 
                  RowBox[{"N", "[", 
                   RowBox[{"inverseTemperature", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", "e"}], 
                    ")"}]}], "]"}], "]"}]}], " ", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"e", " ", ",", " ", 
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "#2"}]}], "}"}], ",",
                 " ", "#1"}], " ", "]"}]}], " ", "]"}], " ", "&"}], ",", "\n",
            "\t\t\t", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"compiledEnergy", " ", "@@", " ", "initialState"}], " ", 
             ",", " ", "initialState"}], " ", "}"}], " ", ",", "\n", "\t\t\t",
            "random"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"compiledEnergy", " ", "@@", " ", "initialState"}], " ", 
           ",", " ", "initialState"}], " ", "}"}]}], "\n", "\t", "]"}]}], ";",
       "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "initialize", " ", "the", " ", "second", " ", "set", " ", "of", " ", 
        "random", " ", "displacements"}], "*)"}], "\n", "\t", 
      RowBox[{"random", " ", "=", " ", 
       RowBox[{"RandomVariate", "[", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "Distribution", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"steps", " ", "-", " ", "1"}], ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"d", "[", "\"\<variables\>\"", "]"}], "]"}]}], "}"}], ",",
          " ", 
         RowBox[{"WorkingPrecision", " ", "\[Rule]", " ", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}]}], " ", 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"if", " ", "all", " ", "worked"}], ",", " ", 
        RowBox[{
        "run", " ", "the", " ", "metropolis", " ", "algorithm", " ", "a", " ",
          "bunch", " ", "of", " ", "times", " ", "and", " ", "remember", " ", 
         "all", " ", "positions"}]}], "*)"}], "\n", "\t", 
      RowBox[{"output", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "[", "random", "]"}], " ", "=!=", " ", 
          "RandomVariate"}], ",", "\n", "\t\t", 
         RowBox[{"FoldList", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", " ", 
               RowBox[{"e", " ", "=", " ", 
                RowBox[{"compiledEnergy", " ", "@@", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "#2"}], ")"}]}]}], 
               "}"}], ",", " ", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"RandomReal", "[", "]"}], " ", "<", " ", 
                 RowBox[{"Exp", "[", " ", 
                  RowBox[{"N", "[", 
                   RowBox[{"inverseTemperature", " ", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], " ", "-", " ", "e"}], 
                    ")"}]}], "]"}], "]"}]}], " ", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"e", ",", 
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "#2"}]}], "}"}], ",",
                 " ", "#1"}], " ", "]"}]}], " ", "]"}], " ", "&"}], ",", "\n",
            "\t\t\t", "stateAfterSkipping", " ", ",", "\n", "\t\t\t", 
           "random"}], "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
         "stateAfterSkipping"}], "\n", "\t", "]"}]}], ";", "\n", "\t", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", "/.", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"d", "[", "\"\<variables\>\"", "]"}], " ", "->", " ", 
            "#"}], "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"output", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ")"}]}]}]}], "\n", "\n",
     "]"}], " ", "/;", " ", 
   RowBox[{"metropolispositionsQ", "[", " ", 
    RowBox[{
     RowBox[{"d", "[", "\"\<positions\>\"", "]"}], " ", ",", " ", 
     "positions"}], " ", "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7397]:=",ExpressionUUID->"d0f608b6-ee63-40b5-9713-1b92c874632a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"inverseTemperatureQ", "[", " ", 
   RowBox[{"t_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"TrueQ", "[", 
       RowBox[{"Positive", "[", "#", "]"}], "]"}], " ", "&"}], ")"}]}], " ", 
   "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"inverseTemperatureQ", "[", " ", "t_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"MechanismMetropolis", "::", "t"}], ",", " ", "t"}], "]"}], ";",
     " ", "False"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"metropolispositionsQ", "[", " ", 
   RowBox[{"pos1_", ",", " ", "pos2_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Which", "[", " ", "\n", "\t", 
   RowBox[{
    RowBox[{"Not", "[", 
     RowBox[{"NumericCoordinatesQ", "[", " ", "pos2", " ", "]"}], "]"}], ",", 
    " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismMetropolis", "::", "npos"}], ",", " ", "pos2"}], 
      "]"}], ";", " ", "False"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], " ", "!=", " ", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismMetropolis", "::", "pos"}], ",", " ", "pos2"}], 
      "]"}], ";", " ", "False"}], ",", " ", "\n", "\t", "True", ",", " ", 
    "True"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"stepNumberQ", "[", " ", 
   RowBox[{"s_Integer", "?", "Positive"}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepNumberQ", "[", " ", "s_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismMetropolis", "::", "steps"}], ",", " ", "s"}], "]"}],
      ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMetropolis", "::", "t"}], " ", "=", " ", 
   "\"\<Inverse temperature `1` should be a positive numeric value.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMetropolis", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` does not agree with mechanism energy.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMetropolis", "::", "npos"}], " ", "=", " ", 
   "\"\<Positions `1` are not numeric.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismMetropolis", "::", "steps"}], "=", " ", 
   "\"\<Number of steps `1` should be a positive integer.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7399]:=",ExpressionUUID->"70578e48-6ec1-4121-8b09-a14bce417e85"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Constrained walks", "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],

Cell[CellGroupData[{

Cell["mechanismConstraintMatrixFunction[]", "Subsection",ExpressionUUID->"5e57b61a-d219-4934-a890-cd59956902d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{
     "mechanismConstraintMatrixFunction", "[", " ", "mechanism", " ", "]"}], 
     "\n", "\n", "returns", " ", "a", " ", "compiled", " ", "function", " ", 
     "that", " ", "can", " ", "take", " ", "numerical", " ", "positions", " ",
      "and", " ", "return", " ", "the", " ", "constraint", " ", 
     RowBox[{"matrix", ".", " ", "This"}], " ", "is", " ", "used", " ", "to", 
     " ", "speed", " ", "up", "\n", "\t", "other", " ", "functions", " ", 
     "that", " ", "do", " ", "this", " ", "repeatedly"}], ",", " ", 
    RowBox[{"like", " ", 
     RowBox[{
      RowBox[{"MechanismIsometricTrajectory", "[", "]"}], "."}]}]}], "\n", 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "mechanismConstraintMatrixFunction", "]"}], "=", 
     
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", " ", 
       RowBox[{"CellPattern", " ", "\[Rule]", " ", "_"}], ",", " ", 
       RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], " ", ",",
        " ", 
       RowBox[{"\"\<options\>\"", " ", "->", " ", 
        RowBox[{"{", "}"}]}]}], " ", "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"mechanismConstraintMatrixFunction", "[", " ", 
     RowBox[{"m_", " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
       "constraintMatrix", ",", " ", "arrays", ",", " ", "vars", " ", ",", 
        " ", "\n", "\t", 
        RowBox[{"symb", " ", "=", " ", 
         RowBox[{"Array", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Unique", "[", "\"\<x\>\"", "]"}], "&"}], ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], "]"}]}], 
          "]"}]}], ",", " ", "map", ",", " ", "\n", "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"VertexPosition", "[", "m", "]"}]}], ",", " ", "f", ",", " ", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{"Unique", "[", "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"arrays", " ", "=", " ", 
        RowBox[{"rigidityMatrix", "[", 
         RowBox[{"m", ",", " ", "positions", ",", " ", 
          RowBox[{"OptionValue", "[", "Constraints", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "CellPattern", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "ReduceLinearConstraints", "]"}]}], " ",
          "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"we", "'"}], "re", " ", "not", " ", "going", " ", "to", " ", 
         "report", " ", "errors"}], "*)"}], "\n", "\t", 
       RowBox[{"constraintMatrix", " ", "=", " ", 
        RowBox[{"Switch", "[", " ", 
         RowBox[{
          RowBox[{"stressedQ", "[", 
           RowBox[{"arrays", ",", " ", "1"}], "]"}], ",", "\n", "\t\t", 
          "$Failed", ",", " ", 
          RowBox[{"{", 
           RowBox[{"{", "}"}], "}"}], ",", "\n", "\t\t", "_", ",", " ", 
          RowBox[{"arrays", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "\n", "\t", "]"}]}], ";", "\n", 
       "\t", 
       RowBox[{"map", "=", 
        RowBox[{"Dispatch", "@", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", "positions", "]"}], "\[Rule]", "symb"}], 
          "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Compile", " ", "@@", " ", 
        RowBox[{"{", " ", 
         RowBox[{"symb", ",", " ", 
          RowBox[{
           RowBox[{"Normal", "@", "constraintMatrix"}], " ", "/.", " ", 
           "map"}], ",", " ", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"OptionValue", "[", "\"\<options\>\"", "]"}], "]"}], 
             " ", "==", " ", "0"}], " ", ",", " ", "Nothing", " ", ",", " ", 
            RowBox[{"OptionValue", "[", "\"\<options\>\"", "]"}]}], " ", 
           "]"}]}], " ", "}"}]}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7408]:=",ExpressionUUID->"b8f6c0e1-9575-4565-94e8-3146faa40eae"]
}, Closed]],

Cell[CellGroupData[{

Cell["constrainedTrajectoryStep[]", "Subsection",ExpressionUUID->"a8deb9f2-79d7-49c8-be55-9a0c3aec7157"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", "\t", 
   RowBox[{
    RowBox[{
    "take", " ", "a", " ", "step", " ", "in", " ", "a", " ", "constrained", 
     " ", "trajectory", " ", 
     RowBox[{"problem", ".", "\n", "\t", "If"}], " ", "the", " ", "provided", 
     " ", "energy", " ", "is", " ", "outside", " ", "the", " ", "tolerance", 
     " ", "specified"}], ",", " ", 
    RowBox[{"it", " ", "will", " ", "optimize", " ", "the", " ", 
     RowBox[{"energy", ".", "\n", "\t", "\n", "\t", 
      RowBox[{"constrainedTrajectoryStep", "[", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "method", " ", ",", " ", "stepsize", " ", ",", " ", "tolerance"}], 
         "}"}], " ", ",", " ", "m", " ", ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"current", " ", "position"}], " ", ",", " ", 
          RowBox[{"last", " ", "direction"}]}], "}"}], ",", "\n", "\t\t", 
        RowBox[{"step", " ", "number"}], " ", ",", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"constraint", " ", "matrix"}], " ", ",", " ", 
           RowBox[{"options", " ", "for", " ", 
            RowBox[{"NullSpace", "[", "]"}]}]}], " ", "}"}], "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"energy", " ", "to", " ", "minimize", " ", "over"}], " ", 
           ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "flattened", " ", "vertex", " ", "positions", " ", "satisfying", 
              " ", "any", " ", "constraints"}], ",", " ", 
             RowBox[{
             "named", " ", "variables", " ", "to", " ", "minimize", " ", 
              "over"}]}], "}"}], ",", " ", 
           RowBox[{"options", " ", "for", " ", "minimization"}]}], " ", 
          "}"}]}]}], "\n", "\t", "]"}]}], "\n", "\t", "\n", "\t", "Returns", 
     " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"new", " ", "positions"}], " ", ",", " ", 
       RowBox[{
       "direction", " ", "we", " ", "just", " ", "stepped", " ", "in"}]}], 
      "}"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"constrainedTrajectoryStep", "[", " ", 
     RowBox[{"_", ",", "_", ",", 
      RowBox[{"{", 
       RowBox[{"$Failed", ",", " ", "_"}], "}"}], ",", "_", ",", "_"}], "]"}],
     ":=", 
    RowBox[{"{", 
     RowBox[{"$Failed", ",", " ", "$Failed"}], "}"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{"standard", " ", "Euler", " ", "integration", " ", 
     RowBox[{"method", ".", " ", "Never"}], " ", 
     RowBox[{"minimize", "."}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"constrainedTrajectoryStep", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Euler\>\"", ",", " ", "stepsize_", ",", "tolerance_"}], 
       "}"}], ",", " ", "m_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", " ", "n_", 
      ",", " ", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
      " ", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
       "constraintEnergy_", ",", " ", "constraintData_", ",", " ", 
        "minimizationOptions_"}], "}"}]}], "\n", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"newDirection", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", 
         RowBox[{
         "positions", ",", " ", "lastDirection", ",", " ", "constraintMat", 
          ",", " ", "nullspaceOptions"}], " ", "]"}]}], "\n", "}"}], ",", 
      "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"computeTrialPosition", "[", " ", 
         RowBox[{
         "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", 
          " ", "n"}], " ", "]"}], ",", "\n", "\t\t", "newDirection"}], "\n", 
       "\t", "}"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "RungeKutta", " ", "with", " ", "minimization", " ", "if", " ", 
     "needed"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"constrainedTrajectoryStep", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\"\<RungeKutta\>\"", ",", " ", "stepsize_", ",", "tolerance_"}], 
       "}"}], ",", "m_", ",", 
      RowBox[{"{", 
       RowBox[{"positions_", ",", "lastDirection_"}], "}"}], ",", " ", "n_", 
      ",", " ", 
      RowBox[{"{", 
       RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
      " ", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
       "constraintEnergy_", ",", " ", "constraintData_", ",", " ", 
        "minimizationOptions_"}], "}"}]}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "k1", ",", " ", "k2", ",", " ", "k3", ",", " ", "k4", ",", " ", "k5", 
        ",", " ", "trialPosition"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"k1", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", " ", 
         RowBox[{
         "positions", " ", ",", " ", "lastDirection", ",", " ", 
          "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"k2", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", " ", 
         RowBox[{
          RowBox[{"positions", " ", "+", " ", 
           RowBox[{"stepsize", " ", 
            RowBox[{"k1", "/", "2"}]}]}], ",", " ", "lastDirection", ",", " ",
           "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";",
        "\n", "\t", 
       RowBox[{"k3", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", " ", 
         RowBox[{
          RowBox[{"positions", " ", "+", " ", 
           RowBox[{"stepsize", " ", 
            RowBox[{"k2", "/", "2"}]}]}], ",", " ", "lastDirection", ",", " ",
           "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ";",
        "\n", "\t", 
       RowBox[{"k4", " ", "=", " ", 
        RowBox[{"projectTrialDirection", "[", " ", 
         RowBox[{
          RowBox[{"positions", " ", "+", " ", 
           RowBox[{"stepsize", " ", "k3"}]}], ",", " ", "lastDirection", ",", 
          " ", "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"k5", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"k1", "+", 
           RowBox[{"2", " ", "k2"}], " ", "+", " ", 
           RowBox[{"2", " ", "k3"}], "+", "k4"}], ")"}], "/", "6"}]}], ";", 
       "\n", "\t", 
       RowBox[{"trialPosition", " ", "=", " ", 
        RowBox[{"positions", " ", "+", " ", 
         RowBox[{"stepsize", " ", "k5"}]}]}], ";", "\n", "\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"evaluateEnergy", "[", 
             RowBox[{
             "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy"}], 
             "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
           RowBox[{"correctTrialPosition", "[", 
            RowBox[{
            "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",",
              " ", "constraintData", ",", " ", "minimizationOptions"}], "]"}],
            ",", "\n", "\t\t\t", "trialPosition"}], "\n", "\t\t", "]"}], ",", 
         "\n", "\t\t", 
         RowBox[{"k5", "/", 
          RowBox[{"Norm", "[", 
           RowBox[{"Flatten", "[", "k5", "]"}], "]"}]}]}], "\n", "\t", 
        "}"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Euler", " ", "step", " ", "with", " ", "minimization", " ", "when", " ", 
     "necessary"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"constrainedTrajectoryStep", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\"\<Minimization\>\"", ",", " ", "stepsize_", ",", " ", 
        "tolerance_"}], "}"}], " ", ",", " ", "m_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"positions_", ",", " ", "lastDirection_"}], "}"}], ",", " ", 
      "n_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
      " ", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
       "constraintEnergy_", ",", " ", "constraintData_", ",", " ", 
        "minimizationOptions_"}], "}"}]}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"newDirection", " ", "=", " ", 
         RowBox[{"projectTrialDirection", "[", " ", 
          RowBox[{
          "positions", ",", " ", "lastDirection", ",", " ", "constraintMat", 
           ",", " ", "nullspaceOptions"}], " ", "]"}]}], ",", "\n", "\t", 
        "trialPosition"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"trialPosition", " ", "=", " ", 
        RowBox[{"computeTrialPosition", "[", " ", 
         RowBox[{
         "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", 
          " ", "n"}], " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"evaluateEnergy", "[", 
             RowBox[{
             "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy"}], 
             "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
           RowBox[{"correctTrialPosition", "[", 
            RowBox[{
            "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",",
              " ", "constraintData", ",", " ", "minimizationOptions"}], "]"}],
            ",", "\n", "\t\t\t", "trialPosition"}], "\n", "\t\t", "]"}], ",", 
         "\n", "\t\t", "newDirection"}], "\n", "\t", "}"}]}]}], "\n", "]"}]}],
    "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "take", " ", "a", " ", "random", " ", "walk", " ", "step", " ", "in", " ",
      "an", " ", "allowed", " ", "direction"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"constrainedTrajectoryStep", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\"\<RandomWalk\>\"", ",", " ", "stepsize_", ",", " ", "tolerance_"}], 
       "}"}], " ", ",", " ", "m_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"positions_", ",", " ", "lastDirection_"}], "}"}], ",", " ", 
      "n_", ",", " ", 
      RowBox[{"{", 
       RowBox[{"constraintMat_", ",", " ", "nullspaceOptions_"}], "}"}], ",", 
      " ", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
       "constraintEnergy_", ",", " ", "constraintData_", ",", " ", 
        "minimizationOptions_"}], "}"}]}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"newDirection", " ", "=", " ", 
         RowBox[{"projectTrialDirection", "[", " ", 
          RowBox[{"positions", ",", " ", 
           RowBox[{"RandomDisplacements", "[", "m", "]"}], ",", " ", 
           "constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}]}], ",",
         "\n", "\t", "trialPosition"}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"trialPosition", " ", "=", " ", 
        RowBox[{"computeTrialPosition", "[", " ", 
         RowBox[{
         "positions", ",", " ", "newDirection", ",", " ", "stepsize", ",", 
          " ", "n"}], " ", "]"}]}], ";", "\n", "\t", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"evaluateEnergy", "[", 
             RowBox[{
             "m", ",", " ", "newDirection", ",", " ", "constraintEnergy"}], 
             "]"}], " ", ">", " ", "tolerance"}], ",", "\n", "\t\t\t", 
           RowBox[{"correctTrialPosition", "[", 
            RowBox[{
            "m", ",", " ", "trialPosition", ",", " ", "constraintEnergy", ",",
              " ", "constraintData", ",", " ", "minimizationOptions"}], "]"}],
            ",", "\n", "\t\t\t", "trialPosition"}], "\n", "\t\t", "]"}], ",", 
         "\n", "\t\t", "newDirection"}], "\n", "\t", "}"}]}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7410]:=",ExpressionUUID->"d4e68e5a-9602-4a4a-b440-17bbf19734d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"given", " ", "a", " ", "trial", " ", "position"}], ",", " ", 
    RowBox[{
    "performa", " ", "minimization", " ", "to", " ", "get", " ", "back", " ", 
     "to", " ", "the", " ", "constraint", " ", "surface", "\n", "\n", "you", 
     " ", "can", " ", "pass", " ", "this", " ", "either", " ", "a", " ", 
     "CompiledMechanismEnergy", " ", "or", " ", "an", " ", "analytic", " ", 
     "expression", " ", "in", " ", "terms", " ", "of", " ", 
     RowBox[{"VertexPosition", "[", "]"}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{"correctTrialPosition", "[", " ", 
    RowBox[{
    "m_", ",", " ", "trialPosition_", " ", ",", " ", "constraintEnergy_", ",",
      " ", "constraintData_", " ", ",", " ", "minimizationOptions_"}], " ", 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"minimizeEnergy", "[", 
     RowBox[{
     "constraintEnergy", ",", " ", "constraintData", ",", " ", 
      "trialPosition", ",", " ", "minimizationOptions"}], "]"}], "[", 
    RowBox[{"[", "2", "]"}], "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7415]:=",ExpressionUUID->"8119cb81-db64-41f8-a390-99290d243836"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "returns", " ", "a", " ", "normalized", " ", "displacement", " ", 
    "tangent", " ", "to", " ", "the", " ", "configuration", " ", "space", " ",
     "and", " ", "as", " ", "close", " ", "to", " ", "trialDirection", " ", 
    "as", " ", "possible"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"projectTrialDirection", "[", " ", 
     RowBox[{
     "positions_", " ", ",", " ", "trialDirection_", ",", " ", 
      "constraintMat_", " ", ",", " ", "nullspaceOptions_"}], " ", "]"}], " ",
     ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{"nullspaceBasis", " ", "=", " ", 
        RowBox[{"Orthogonalize", "[", " ", 
         RowBox[{"NullSpace", "[", 
          RowBox[{"constraintMat", ",", " ", "nullspaceOptions"}], " ", "]"}],
          " ", "]"}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "nullspaceBasis", "]"}], " ", ">", " ", "0"}],
         ",", "\n", "\t\t", 
        RowBox[{"ArrayReshape", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Normalize", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", "nullspaceBasis", "]"}], " ", ".", " ", 
            "nullspaceBasis", " ", ".", " ", 
            RowBox[{"Flatten", "[", "trialDirection", "]"}]}], "]"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{"Dimensions", "[", "positions", "]"}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"Mechanism", "::", "dirns"}], " ", ",", " ", "positions"}],
           "]"}], ";", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Dimensions", "[", "positions", "]"}]}], " ", "]"}]}]}], 
       "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Mechanism", "::", "dirns"}], "=", 
     "\"\<Cannot identify tangent space at `1`.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Mechanism", "::", "stepsize"}], " ", "=", " ", 
     "\"\<Stepsize should be a function of positions or a positive real \
number.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7416]:=",ExpressionUUID->"d0c74681-d7be-4943-bdb3-e78c2132a41c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "find", " ", "a", " ", "new", " ", "set", " ", "of", " ", "positions", " ",
     "from", " ", "a", " ", "trial", " ", "step"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"computeTrialPosition", "[", " ", 
     RowBox[{"positions_", " ", ",", " ", "trialStep_", " ", ",", " ", 
      RowBox[{"stepsize_", "?", "NumericQ"}], ",", " ", "n_"}], " ", "]"}], 
    " ", ":=", " ", "\n", "\t\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"stepsize", " ", "\[GreaterEqual]", " ", "0"}], ",", "\n", 
      "\t\t\t", 
      RowBox[{"positions", " ", "+", " ", 
       RowBox[{"stepsize", " ", "trialStep"}]}], ",", "\n", "\n", "\t\t\t", 
      RowBox[{
       RowBox[{"Message", "[", " ", 
        RowBox[{"MechanismIsometricTrajectory", "::", "stepsize"}], " ", 
        "]"}], ";", "\n", "\t\t\t", "$Failed"}]}], "\n", "\t\t", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{"computeTrialPosition", "[", " ", 
     RowBox[{
     "positions_", " ", ",", " ", "trialStep_", " ", ",", " ", "stepsize_", 
      ",", " ", "n_"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"actualSize", " ", "=", " ", 
        RowBox[{"stepsize", "[", 
         RowBox[{"positions", ",", "n"}], "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", " ", "actualSize", " ", "]"}], " ", "&&", 
         " ", 
         RowBox[{"actualSize", " ", "\[GreaterEqual]", " ", "0"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"positions", " ", "+", " ", 
         RowBox[{"actualSize", " ", "trialStep"}]}], ",", "\n", "\n", "\t\t", 
        
        RowBox[{
         RowBox[{"Message", "[", " ", 
          RowBox[{"Mechanism", "::", "stepsize"}], " ", "]"}], ";", "\n", 
         "\t\t", "$Failed"}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7419]:=",ExpressionUUID->"486130dd-c91f-4635-9d83-1f3bd0aa6d73"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismIsometricTrajectory[]", "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", " ", "MechanismIsometricTrajectory", " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
     "any", " ", "constraints", " ", "added", " ", "by", " ", "the", " ", 
      "user"}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "positions", " ", "from", " ", "which", " ", "to", " ", "start", " ", 
       "the", " ", "walk"}], "*)"}], "\n", "\t", 
     RowBox[{"InitialPositions", " ", "->", " ", "Automatic"}], ",", "\n", 
     "\t", 
     RowBox[{"Method", " ", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{"\"\<Minimization\>\"", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "4"}]}]}], "}"}]}], ",", "\n", "\t", 
     RowBox[{"Tolerance", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "8"}], ")"}]}]}], ",", "\n", "\t", 
     RowBox[{"StepSize", " ", "\[Rule]", " ", "0.1"}], ",", "\n", "\t", 
     RowBox[{"StoppingCriteria", " ", "->", " ", "None"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7421]:=",ExpressionUUID->"0667504c-8c02-4916-b24b-3bb7bdc2cf26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "direction_", ",", " ", 
     RowBox[{"steps_", "?", "stepsQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "InitialPositions", "]"}], " ", "===", 
          " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "InitialPositions", "]"}]}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"mechanismIsometricTrajectoryInternal", "[", 
           RowBox[{"m", ",", " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "positions", " ", "and", " ", "direction"}], 
             "*)"}], "\n", "\t\t\t", "initialPositions", ",", " ", 
            "direction", ",", " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "data", " ", "to", " ", "decide", " ", "on", " ", "how", " ", 
              "to", " ", "choose", " ", "step", " ", "size"}], "*)"}], "\n", 
            "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"steps", ",", " ", 
              RowBox[{"OptionValue", "[", "StepSize", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "Tolerance", "]"}], ",", " ", 
              RowBox[{"stoppingcriteriaQ", "[", 
               RowBox[{
                RowBox[{"MechanismPositions", "[", "m", "]"}], ",", 
                "direction", ",", 
                RowBox[{"OptionValue", "[", "StoppingCriteria", "]"}]}], 
               "]"}]}], "}"}], ",", " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "what", " ", "method", " ", "to", " ", "use", " ", "to", " ", 
              "take", " ", "a", " ", "step"}], "*)"}], "\n", "\t\t\t", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"mobileVariables", "[", " ", 
             RowBox[{"m", ",", " ", 
              RowBox[{"MechanismConstraintMap", "[", 
               RowBox[{"m", ",", " ", 
                RowBox[{"Constraints", " ", "->", " ", 
                 RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", ",",
                 " ", 
                RowBox[{
                "ReduceLinearConstraints", " ", "->", " ", "False"}]}], 
               "]"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"{", "opt", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"ToPackedArray", "[", 
          RowBox[{"N", "[", "res", "]"}], "]"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
          "mechanismIsometricTrajectoryInternal"}]}]}], "\n", "\t", "]"}], 
      " ", "/;", " ", 
      RowBox[{"And", "[", " ", 
       RowBox[{
        RowBox[{"positionsQ", "[", 
         RowBox[{"m", ",", " ", "initialPositions"}], "]"}], " ", ",", " ", 
        RowBox[{"displacementsQ", "[", 
         RowBox[{"m", ",", " ", "direction"}], "]"}], " ", ",", " ", 
        RowBox[{"toleranceQ", "[", " ", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}]}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"stepsQ", "[", " ", 
   RowBox[{"steps_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stepsQ", "[", " ", "steps_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismIsometricTrajectory", "::", "steps"}], "]"}], ";", 
     " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"toleranceQ", "[", " ", 
   RowBox[{"tol_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", "\[GreaterEqual]", "0"}]}], "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"toleranceQ", "[", " ", "tol_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismIsometricTrajectory", "::", "tol"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"positionsQ", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismIsometricTrajectory", "::", "pos"}], ",", 
       "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementsQ", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismIsometricTrajectory", "::", "disp"}], ",", 
        "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"stoppingcriteriaQ", "[", " ", 
   RowBox[{"pos_", ",", " ", "dir_", " ", ",", " ", "None"}], "]"}], " ", ":=",
   " ", "None"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stoppingcriteriaQ", "[", " ", 
    RowBox[{"pos_", ",", " ", "dir_", " ", ",", " ", "stopfunc_"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"BooleanQ", "[", 
      RowBox[{"stopfunc", "[", 
       RowBox[{"pos", ",", "dir"}], "]"}], "]"}], ",", " ", "stopfunc", ",", 
     " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MechanismIsometricTrajectory", "::", "sc2"}], "]"}], ";", " ",
       "stopfunc"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "steps"}], "=", 
   "\"\<Number of steps is not a positive integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance should be a positive real number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "stepsize"}], " ", "=", " ", 
   "\"\<Stepsize should be a function of positions or a positive real number.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "pos"}], " ", "=", " ", 
   "\"\<Initial positions `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "disp"}], " ", "=", " ", 
   "\"\<Initial displacements `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "sc"}], " ", "=", " ", 
   "\"\<Option StoppingCriteria is not a function or the keyword None.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismIsometricTrajectory", "::", "sc2"}], " ", "=", " ", 
   "\"\<Function provided to StoppingCriteria does not return True or \
False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7422]:=",ExpressionUUID->"c18d8317-ae43-4b7f-9da1-c3475f665d7f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismIsometricTrajectoryInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "\n", "\t", "initialPositions_", ",", " ", "direction_", 
    ",", " ", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{
     "steps_", ",", " ", "stepsize_", ",", " ", "tolerance_", ",", 
      "stoppingcriteria_"}], "}"}], ",", " ", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"method_", " ", ",", " ", "methodSpec___"}], "}"}], " ", ",", 
    " ", "\n", "\t", "constraintData_", ",", "\n", "\t", "options_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"minimizationOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", " ", 
        RowBox[{
         RowBox[{"{", "methodSpec", "}"}], ",", " ", 
         RowBox[{"Options", "[", "FindMinimum", "]"}]}], " ", "]"}]}], ",", 
      "\n", "\t", 
      RowBox[{"nullspaceOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", " ", 
        RowBox[{
         RowBox[{"{", "methodSpec", "}"}], ",", " ", 
         RowBox[{"Options", "[", "NullSpace", "]"}]}], " ", "]"}]}], ",", 
      "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"normalize", " ", "the", " ", "initial", " ", "direction"}], 
       "*)"}], "\n", "\t", 
      RowBox[{"normalizedDirection", " ", "=", " ", 
       RowBox[{"direction", "/", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", "direction", "]"}], " ", ".", " ", 
          RowBox[{"Flatten", "[", "direction", "]"}]}], " ", "]"}]}]}], ",", 
      "\n", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "function", " ", "to", " ", "determine", " ", "local", " ", 
        "constraints"}], "*)"}], "\n", "\t", 
      RowBox[{"constraintMatrixFunc", " ", "=", " ", 
       RowBox[{"mechanismConstraintMatrixFunction", "[", " ", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"options", ",", " ", 
           RowBox[{
           "Options", "[", "mechanismConstraintMatrixFunction", "]"}]}], " ", 
          "]"}]}], "]"}]}], ",", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{"function", " ", "to", " ", "minimize"}], "*)"}], "\n", "\t", 
      RowBox[{"energyFunc", " ", "=", " ", 
       RowBox[{"MechanismEnergy", "[", 
        RowBox[{"m", " ", ",", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{"options", ",", " ", 
           RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], " ", "]"}]}], 
        " ", "]"}]}], ",", "\n", "\t", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"initialPositions", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", "dim"}], "]"}], "&"}], "/@", " ", 
     RowBox[{"Which", "[", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"constraintMatrixFunc", " ", "===", " ", "$Failed"}], ",", " ", 
       RowBox[{"{", "}"}], ",", "\n", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "no", " ", "stopping", " ", "criteria", " ", "selected", " ", "means",
          " ", "we", " ", "go", " ", "until", " ", "we", " ", "run", " ", 
         "out", " ", "of", " ", "steps"}], "*)"}], "\n", "\t", 
       RowBox[{"stoppingcriteria", " ", "===", " ", "None"}], ",", "\n", 
       "\t\t", 
       RowBox[{"DeleteCases", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"FoldList", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"constrainedTrajectoryStep", "[", " ", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "method", ",", " ", "stepsize", ",", " ", "tolerance"}], 
                "}"}], ",", " ", "m", ",", " ", "\n", "\t\t\t\t\t", "#1", ",",
                " ", "#2", ",", " ", "\n", "\t\t\t\t\t", 
               RowBox[{"{", " ", 
                RowBox[{
                 RowBox[{"Quiet", "[", 
                  RowBox[{"constraintMatrixFunc", " ", "@@", " ", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], " ", ",", 
                 " ", "nullspaceOptions"}], " ", "}"}], ",", " ", "\n", 
               "\t\t\t\t\t", 
               RowBox[{"{", 
                RowBox[{
                "energyFunc", " ", ",", " ", "constraintData", ",", " ", 
                 "minimizationOptions"}], "}"}]}], " ", "\n", "\t\t\t\t", 
              "]"}], " ", "&"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "@", "initialPositions"}], ",", 
              "normalizedDirection"}], "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Range", "[", "steps", "]"}]}], "\n", "\t\t\t", "]"}], 
          "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
         "$Failed"}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "the", " ", "stepping", " ", "criteria", " ", "is", " ", "a", " ", 
         "function"}], "*)"}], "\n", "\t", 
       RowBox[{
        RowBox[{"Head", "[", "stoppingcriteria", "]"}], " ", "===", " ", 
        "Function"}], ",", "\n", "\t\t", 
       RowBox[{"DeleteCases", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"FoldWhileList", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{"constrainedTrajectoryStep", "[", " ", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "method", ",", " ", "stepsize", ",", " ", "tolerance"}], 
                "}"}], ",", " ", "m", ",", "\n", "\t\t\t\t ", "#1", ",", " ", 
               "#2", ",", " ", "\n", "\t\t\t\t ", 
               RowBox[{"{", " ", 
                RowBox[{
                 RowBox[{"Quiet", "[", 
                  RowBox[{"constraintMatrixFunc", " ", "@@", " ", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], " ", ",", 
                 " ", "nullspaceOptions"}], " ", "}"}], ",", " ", "\n", 
               "\t\t\t\t ", 
               RowBox[{"{", 
                RowBox[{
                "energyFunc", " ", ",", " ", "constraintData", ",", " ", 
                 "minimizationOptions"}], "}"}]}], " ", "]"}], " ", "&"}], 
            ",", "\n", "\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "@", "initialPositions"}], ",", 
              "normalizedDirection"}], "}"}], ",", "\n", "\t\t\t\t", 
            RowBox[{"Range", "[", "steps", "]"}], ",", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"stoppingcriteria", "[", " ", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}], "&"}]}], "\n", 
           "\t\t\t", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
         "$Failed"}], "\n", "\t\t", "]"}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "same", " ", "as", " ", "no", " ", "stopping", " ", "criteria", " ", 
          "but", " ", "with", " ", "an", " ", "error", " ", "message"}], ";", 
         " ", 
         RowBox[{
         "repeating", " ", "this", " ", "is", " ", "kind", " ", "of", " ", 
          "a", " ", "silly", " ", "kludge", " ", "but", " ", 
          RowBox[{"what", "'"}], "s", " ", "the", " ", 
          RowBox[{"harm", "?"}]}]}], "*)"}], "\n", "\t", "True", ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismIsometricTrajectory", "::", "sc"}], "]"}], ";", 
        "\n", "\t\t", 
        RowBox[{"DeleteCases", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"FoldList", "[", "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"constrainedTrajectoryStep", "[", " ", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "method", ",", " ", "stepsize", ",", " ", "tolerance"}], 
                 "}"}], ",", " ", "m", ",", " ", "\n", "\t\t\t\t", "#1", ",", 
                " ", "#2", ",", " ", "\n", "\t\t\t\t", 
                RowBox[{"{", " ", 
                 RowBox[{
                  RowBox[{"Quiet", "[", 
                   RowBox[{"constraintMatrixFunc", " ", "@@", " ", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], " ", ",", 
                  " ", "nullspaceOptions"}], " ", "}"}], ",", " ", "\n", 
                "\t\t\t\t", 
                RowBox[{"{", 
                 RowBox[{
                 "energyFunc", " ", ",", " ", "constraintData", ",", " ", 
                  "minimizationOptions"}], "}"}]}], " ", "]"}], " ", "&"}], 
             ",", "\n", "\t\t\t\t", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Flatten", "@", "initialPositions"}], ",", 
               "normalizedDirection"}], "}"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"Range", "[", "steps", "]"}]}], "\n", "\t\t\t", "]"}], 
           "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
          "$Failed"}], "\n", "\t\t", "]"}]}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7438]:=",ExpressionUUID->"f0a82410-c535-47a8-948b-b21f94c95228"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismFindMinimalTrajectory[]", "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismFindMinimalTrajectory", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"AddedEnergy", "->", "0"}], ",", "\n", "\t", 
     RowBox[{"Constraints", "\[Rule]", "None"}], ",", "\n", "\t", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
        RowBox[{"MaxIterations", "\[Rule]", 
         RowBox[{"10", "^", "5"}]}], ",", " ", 
        RowBox[{"\"\<Stiffness\>\"", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}]}], "}"}]}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7439]:=",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "[", "\"\<Methods\>\"", "]"}], 
    "=", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"\"\<ElasticBand\>\"", ",", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<Stiffness\>\"", "\[Rule]", 
           RowBox[{"10", "^", 
            RowBox[{"(", 
             RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
         "\"\<Options[FindMinimum]\>\""}], "]"}]}], "}"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "start_", ",", " ", "end_", 
     ",", " ", "steps_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"method", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}]}], ",", 
       " ", "res"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"Switch", "[", 
        RowBox[{
         RowBox[{"First", "[", "method", "]"}], ",", "\n", "\t\t", 
         "\"\<ElasticBand\>\"", ",", "\n", "\t\t\t", 
         RowBox[{"MechanismFindMinimalTrajectoryElasticBand", "[", 
          RowBox[{
          "m", ",", " ", "start", ",", " ", "end", ",", " ", "steps", ",", 
           " ", 
           RowBox[{
            RowBox[{"MechanismEnergy", "[", 
             RowBox[{"m", ",", " ", 
              RowBox[{"Constraints", "->", 
               RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], "]"}], 
            "+", 
            RowBox[{
            "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
             RowBox[{"m", ",", 
              RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], "]"}]}], 
           ",", " ", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"Rest", "[", "method", "]"}]}]}], " ", "]"}], ",", "\n", 
         "\t\t", "_", ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismFindMinimalTrajectory", "::", "meth"}], "]"}], 
          ";", "\n", "\t\t\t", "$Failed"}]}], "\n", "\t", "]"}]}], ";", "\n", 
      "\t", "\n", "\t", 
      RowBox[{"res", " ", "/;", " ", 
       RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "method"}], "=", 
   "\"\<`1` is not a recognized method. Only \\\"ElasticBand\\\" is currently \
recognized.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7440]:=",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstiff"}], "=", 
   "\"\<Stiffness in \\\"ElasticBand\\\" method must be a positive numerical \
value.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstart"}], "=", 
   "\"\<Start positions are not numeric coordinates corresponding to \
Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismFindMinimalTrajectory", "::", "ebend"}], "=", 
   "\"\<End positions are not numeric coordinates corresponding to Mechanism.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismFindMinimalTrajectory", "::", "steps"}], "=", 
    "\"\<Number of steps should be a positive integer.\>\""}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "MechanismFindMinimalTrajectoryElasticBand", "]"}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
    "Options", "[", "MechanismFindMinimalTrajectoryElasticBand", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Stiffness\>\"", "\[Rule]", 
        RowBox[{"10", "^", 
         RowBox[{"(", 
          RowBox[{"-", "4"}], ")"}]}]}], "}"}], ",", 
      RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismFindMinimalTrajectoryElasticBand", "[", 
   RowBox[{
   "m_", ",", " ", "startPositions_", ",", "endPositions_", ",", " ", 
    "steps_", ",", " ", "energy_", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"stiffness", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Stiffness\>\"", "]"}]}], ",", "\n", 
      RowBox[{"fixedVertices", " ", "=", " ", 
       RowBox[{"solveLinearEquations", "[", 
        RowBox[{
         RowBox[{"MechanismConstraintMap", "[", 
          RowBox[{"m", ",", "startPositions"}], "]"}], ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], " ", "]"}]}], 
      ",", " ", "\n", "variable", ",", " ", "internalVariables", ",", " ", 
      "partialEnergy", ",", " ", "newVariables", ",", " ", "potentialEnergy", 
      ",", " ", "initialConditions", ",", "\n", 
      RowBox[{"minimizationOptions", " ", "=", " ", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"{", "opt", "}"}], ",", 
         RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}]}], ",", " ", 
      "solution"}], "\n", "}"}], ",", "\n", "\n", "\t", 
    RowBox[{
     RowBox[{"Which", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"NumericQ", "[", "stiffness", "]"}], " ", "&&", " ", 
         RowBox[{"stiffness", " ", ">", " ", "0"}]}], " ", "]"}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstiff"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"NumericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "startPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebstart"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", " ", "@", " ", 
        RowBox[{"NumericCoordinatesQ", "[", 
         RowBox[{"m", ",", " ", "endPositions"}], "]"}]}], ",", "\n", 
       "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "ebend"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"Not", "[", " ", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "steps", "]"}], " ", "&&", " ", 
         RowBox[{"steps", ">", "0"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"MechanismFindMinimalTrajectory", "::", "steps"}], "]"}], 
        ";", " ", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\n", "\t", "]"}], ";", 
     "\n", "\n", "\t", 
     RowBox[{"internalVariables", "=", " ", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"PositionRules", "[", "startPositions", "]"}], "}"}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", " ", "\[Rule]", " ", "#2"}], "&"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", "#"}], 
               "}"}], ",", " ", "2"}], "]"}], ",", "2"}], "]"}], "&"}], " ", "/@",
          " ", 
         RowBox[{"Array", "[", 
          RowBox[{"variable", ",", " ", 
           RowBox[{"{", 
            RowBox[{"steps", ",", " ", 
             RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], 
             RowBox[{"(*", 
              RowBox[{"MeshCellCount", "[", 
               RowBox[{"m", ",", "0"}], "]"}], "*)"}], ",", 
             RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
            "}"}]}], "]"}]}], ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"PositionRules", "[", "endPositions", "]"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"newVariables", " ", "=", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
         "fixedVertices"}], "]"}], " ", "/.", " ", "internalVariables"}]}], 
     ";", "\n", "\n", "\t", 
     RowBox[{"partialEnergy", " ", "=", " ", 
      RowBox[{"energy", " ", "/.", " ", "fixedVertices"}]}], ";", "\n", "\n", 
     "\t", 
     RowBox[{"potentialEnergy", " ", "=", " ", 
      RowBox[{"Total", " ", "@", " ", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"{", "\n", "\t", 
         RowBox[{"(*", 
          RowBox[{"local", " ", "equations"}], "*)"}], "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"partialEnergy", " ", "/.", " ", "#"}], " ", "&"}], 
            ")"}], " ", "/@", " ", "internalVariables"}], ",", "\n", "\n", 
          "\t", 
          RowBox[{"(*", 
           RowBox[{"elastic", " ", "band", " ", "equations"}], "*)"}], "\n", 
          "\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"stiffness", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], " ", ".", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "&"}], ")"}], 
           " ", "/@", " ", 
           RowBox[{"Partition", "[", 
            RowBox[{"newVariables", ",", " ", "2", ",", " ", "1"}], "]"}]}]}],
          "\n", "\t", "}"}]}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"initialConditions", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Transpose", " ", "@", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Flatten", "[", " ", 
            RowBox[{"Drop", "[", " ", 
             RowBox[{
              RowBox[{"Rest", " ", "@", " ", "newVariables"}], ",", " ", 
              RowBox[{"-", "1"}]}], "]"}], " ", "]"}], ",", " ", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"startPositions", " ", "+", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"endPositions", " ", "-", " ", "startPositions"}], 
                  ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"steps", "+", "1"}], ")"}]}], " ", "#"}]}], "&"}], 
             " ", "/@", " ", 
             RowBox[{"Range", "[", "steps", "]"}]}], " ", "]"}]}], "}"}]}], 
        ",", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"_", "?", "NumericQ"}], ",", " ", "_"}], "}"}]}], "\n", 
       "\t", "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"solution", " ", "=", " ", 
      RowBox[{"FindMinimum", " ", "@@", " ", 
       RowBox[{"{", 
        RowBox[{
        "potentialEnergy", ",", " ", "initialConditions", ",", " ", 
         "minimizationOptions"}], " ", "}"}]}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "solution", "]"}], " ", "=!=", " ", 
        "FindMinimum"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", ",", 
           RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], "]"}], 
         "&"}], " ", "/@", " ", 
        RowBox[{"(", 
         RowBox[{"newVariables", " ", "/.", " ", 
          RowBox[{"solution", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}], ",", " ", "$Failed"}], 
      "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7443]:=",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["global rigidity", "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],

Cell[CellGroupData[{

Cell["GenericGloballyRigidQ[]", "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GenericGloballyRigidQ", "[", 
    RowBox[{"m_", "?", "MechanismQ"}], "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dim", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], ",", " ", 
       RowBox[{"num", " ", "=", " ", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}], "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ContainsAny", "[", 
         RowBox[{
          RowBox[{"MechanismCellTypes", "[", "m", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"PinnedJoint", ",", " ", "RigidBar", ",", " ", "Spring"}], 
           "}"}]}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"GenericGloballyRigidQ", "::", "more"}], "]"}]}], "]"}], ";",
       "\n", "\t", 
      RowBox[{"Or", " ", "@@", " ", 
       RowBox[{"(", "\n", "\t\t", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"MatrixRank", "[", 
             RowBox[{
              RowBox[{"MechanismStressMatrix", "[", 
               RowBox[{"m", ",", " ", "#"}], "]"}], ",", " ", 
              RowBox[{"Tolerance", " ", "\[Rule]", " ", 
               RowBox[{"OptionValue", "[", "Tolerance", "]"}]}]}], " ", "]"}],
             " ", "\[Equal]", " ", 
            RowBox[{"num", " ", "-", " ", "dim", " ", "-", " ", "1"}]}], 
           ")"}], "&"}], " ", "/@", " ", 
         RowBox[{"MechanismSelfStresses", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"CellPattern", "->", "_RigidBar"}]}], "]"}]}], "\n", "\t", 
        ")"}]}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenericGloballyRigidQ", "::", "more"}], "=", 
   "\"\<Mechanism containts more than joints, bars, and springs.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7450]:=",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7452]:=",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mechanisms`Origami: functions for Origami", "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`Origami`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7454]:=",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"KawasakiQ", "::", "usage"}], "=", "\n", 
   "\"\<KawasakiQ[\!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\)] \
returns True if it can be determined that the Origami satisfies Kawasaki's \
theorem at each vertex.\nUse option ZeroTest to modify how the function tests \
for zero. Use option WorkingPrecision to set a number of digits for the test.\
\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7455]:=",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EquilibriumFoldAngles", "::", "usage"}], "=", "\n", 
    "\"\<EquilibriumFoldAngles[m] returns an association containing a list of \
TorsionalFolds, their corresponding target angles, and their actual angles.\>\
\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PossibleFoldsQ", "::", "usage"}], "=", 
   "\"\<PossibleFoldsQ[ m, {{e11, e12}, {e21, e22}, ...}] returns True if the \
edges are possible folds.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7456]:=",ExpressionUUID->"01f2dfa2-986a-4b95-b411-c600af854f43"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "::", "usage"}], "=", "\n", 
   "\"\<TorsionalFoldMatrix[m] returns the TorsionalFold matrix mapping \
linear vertex displacements to linear TorsionalFold angle changes.\>\""}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7458]:=",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "::", "usage"}], "=", 
   "\"\<ElasticizeOrigami[ o ] attempts to create an elastic model of an \
Origami structure.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7459]:=",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "::", "usage"}], "=", "\n", 
   "\"\<RandomOrigami[ \!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) ] \
returns random Origami with n internal vertices.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7460]:=",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "usage"}], "=", "\n", 
   "\"\<FlatOrigamiQ[ \!\(\*StyleBox[\"Origami\",FontSlant->\"Italic\"]\) ] \
returns True if the Origami Mechanism is flat.\nUse option ZeroTest to \
specify how to test for zero. Use option WorkingPrecision to choose the \
precision.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7461]:=",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"KreslingOrigami", "::", "usage"}], "=", "\n", 
   "\"\<KreslingOrigami[{\!\(\*StyleBox[\"#\",FontSlant->\"Italic\"]\)\!\(\*\
StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"azimuthal\",FontSlant->\"Italic\"]\
\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"cells\",FontSlant->\"Italic\"]\), \
#\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"of\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\" \",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"rings\",FontSlant->\
\"Italic\"]\)(, \
\!\(\*StyleBox[\"twist\",FontSlant->\"Italic\"]\))},\!\(\*StyleBox[\"overall\"\
,FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"scale\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"height\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"ratio\",FontSlant->\"Italic\"]\)] \
creates a Kresling TorsionalFold pattern of a particular radius, height, and \
integer twist if specified.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7462]:=",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MVAssignment", "::", "usage"}], " ", "=", " ", 
    "\"\<MVAssignment[ o (, positions), tolerance_ (, assignmentFunction)] \
returns a list of rules assigning a value to mountain or valley \
TorsionalFolds up to the value of tolerance.\nThe function assignmentFunction \
should take one of the values {-1,0,1} for valley, flat, or mountain \
TorsionalFolds respectively.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "usage"}], " ", "=", " ", 
   "\"\<FlattenOrigami[m, tolerance] attempts to flatten an Origami \
structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7463]:=",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "::", "usage"}], "=", 
   "\"\<SameFoldAnglesQ[ Origami, (TorsionalFolds,) (precision) ] is a \
function that compares the positions of two Origami structures and returns \
True if they have the same TorsionalFold angles.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "::", "usage"}], "=", 
   "\"\<SameMVAnglesQ[ Origami, (TorsionalFolds,) (precision) ] is a function \
that compares the positions of two Origami structures and returns True if \
they have the same mountain-valley assignments.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7465]:=",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionQ", "::", "usage"}], " ", "=", " ", 
   "\"\<ButterflyDecompositionQ[ Origami ] returns True if Origami can be \
decomposed into pairs of \\\"butterfly\\\" Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecomposition", "::", "usage"}], " ", "=", " ", 
   "\"\<ButterflyDecomposition[ Origami ] returns a list of \\\"butterfly\\\" \
Face pairs and a non-butterfly-decomposible kernel after removing butterfly \
Faces. You can apply MechanismDeleteDanglingVertices[] to extract the \
underlying Origami structure.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7467]:=",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DeconstructedOrigami", "::", "usage"}], "=", 
    "\"\<DeconstructedOrigami[ Origami ] returns a list of vertices for \
polygons corresponding to the individual Faces.\nOption \\\"edgeWeights\\\" \
allows the assignment of positive weights that allow some edges to have \
widths.\nOption \\\"defaultWeight\\\" is the default weight on all \
edges.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtrudedPolygon", "::", "usage"}], "=", 
   "\"\<ExtrudedPolygon[coords, extrusion vector, (translation vector)] takes \
a Polygon and creates a 3D version.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7469]:=",ExpressionUUID->"83f8a726-efe7-4110-956b-bca1ea384930"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "::", "usage"}], "=", 
   "\"\<MVColor[ Origami, data, styleFunction] attempts to color data \
according to styles specified by styleFunction.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7471]:=",ExpressionUUID->"b96f0aa2-0ec5-4585-8f0e-6182e0b65a44"]
}, Closed]],

Cell[CellGroupData[{

Cell["global", "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:09 \
In[7472]:=",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Closed]],

Cell[CellGroupData[{

Cell["new Origami structures", "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],

Cell[CellGroupData[{

Cell["KreslingOrigami[]", "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "KreslingOrigami", "]"}], "=", 
   RowBox[{"Options", "[", "Origami", "]"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7476]:=",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles", ",", "numHeight", ",", "twist"}], "}"}], ",", 
    "1", ",", "1", ",", "opt"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"KreslingOrigami", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numTriangles_Integer", ",", "numHeight_Integer", ",", 
      RowBox[{"twist_Integer", ":", "0"}]}], "}"}], ",", 
    RowBox[{"radius_", "?", "NumericQ"}], ",", 
    RowBox[{"heightScale_", "?", "NumericQ"}], ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "i", "}"}], ",", "\n", 
     RowBox[{"With", "[", "\n", 
      RowBox[{
       RowBox[{"{", "\n", 
        RowBox[{"height", "=", 
         RowBox[{"heightScale", " ", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Cos", "[", 
               RowBox[{"Pi", "/", "numTriangles"}], "]"}], "-", 
              RowBox[{"Cos", "[", 
               RowBox[{"2", " ", 
                RowBox[{"Pi", "/", "numTriangles"}]}], "]"}]}], ")"}]}], 
           "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
       RowBox[{"Origami", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"radius", " ", 
          RowBox[{"Join", "@@", 
           RowBox[{"Table", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{"Sin", "[", 
                  RowBox[{
                   RowBox[{"2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "numTriangles"}]}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], ")"}], " ", 
                    RowBox[{
                    RowBox[{"Pi", "/", "numTriangles"}], "/", "2"}]}]}], 
                  "]"}], ",", "\n", "\t\t\t", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], " ", "height"}]}], "\n", 
                "\t\t\t", "}"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"numHeight", "+", "1"}]}], "}"}]}], "]"}]}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}], ",", 
                    "numTriangles", ",", 
                    RowBox[{
                    RowBox[{"i", " ", "numTriangles"}], "+", "1"}]}], "]"}], 
                  ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", 
                "\t\t\t", "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}], ",", "\n", 
             "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Face", "[", "\n", "\t\t\t\t", 
                RowBox[{"{", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{"#", "+", 
                   RowBox[{"i", " ", "numTriangles"}]}], ",", "\n", 
                  "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}], ",", "\n", "\t\t\t\t", 
                  RowBox[{"Mod", "[", 
                   RowBox[{
                    RowBox[{"#", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], " ", "numTriangles"}], 
                    "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", "i"}]}], ")"}], "/", 
                    "2"}], "-", "1", "+", "twist"}], ",", "numTriangles", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", "1"}], ")"}], "numTriangles"}], "+", 
                    "1"}]}], "]"}]}], "\n", "\t\t\t\t", "}"}], "\n", "\t\t\t",
                 "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", "numTriangles", "]"}]}]}], "\n", "\t\t", 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"numHeight", "-", "1"}]}], "}"}]}], "]"}], ",", "\n", 
         "\t\t", "opt"}], "\n", "\t", "]"}]}], "\n", "]"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"numTriangles", ">=", "2"}], "&&", 
    RowBox[{"numHeight", ">=", "1"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7477]:=",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"]
}, Closed]],

Cell[CellGroupData[{

Cell["RandomOrigami[]", "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RandomOrigami", "]"}], "=", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "Origami", "]"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"Precision", "\[Rule]", "Automatic"}], ",", "\n", "\t", 
       RowBox[{"MaxIterations", "->", "20"}], ",", "\n", "\t", 
       RowBox[{"\"\<MinimumFolds\>\"", "->", "4"}], ",", "\n", "\t", 
       RowBox[{"\"\<BoundaryPoints\>\"", "->", 
        RowBox[{"CirclePoints", "[", "4", "]"}]}]}], "\n", "\t", "}"}]}], 
    "\n", "]"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:09 \
In[7479]:=",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
        RowBox[{"ctr", " ", "=", " ", "1"}], ",", "\n", 
        RowBox[{"firstMesh", " ", "=", " ", 
         RowBox[{"randomMesh", "[", " ", 
          RowBox[{"numberOfVertices", ",", " ", 
           RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}]}], " ",
           "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"(", "\n", "\t", 
        RowBox[{
         RowBox[{"meshTry", " ", "=", " ", 
          RowBox[{"ToOrigami", "[", " ", 
           RowBox[{"firstMesh", " ", ",", " ", 
            RowBox[{"Precision", " ", "\[Rule]", " ", 
             RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", "]"}]}],
          ";", "\n", "\n", "\t", 
         RowBox[{"While", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", " ", "@", " ", 
             RowBox[{"validRandomOrigamiQ", "[", " ", 
              RowBox[{"numberOfVertices", ",", " ", "meshTry", ",", " ", 
               RowBox[{"OptionValue", "[", "\"\<MinimumFolds\>\"", "]"}], ",",
                " ", 
               RowBox[{"Length", "[", 
                RowBox[{"OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}], 
                "]"}]}], " ", "]"}]}], " ", "&&", " ", 
            RowBox[{"ctr", " ", "\[LessEqual]", " ", 
             RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}]}], ",", 
           "\n", "\t\t", 
           RowBox[{
            RowBox[{"meshTry", " ", "=", " ", 
             RowBox[{"ToOrigami", "[", " ", 
              RowBox[{
               RowBox[{"randomMesh", "[", " ", 
                RowBox[{"numberOfVertices", ",", " ", 
                 RowBox[{"OptionValue", "[", "Precision", "]"}], ",", " ", 
                 RowBox[{
                 "OptionValue", "[", "\"\<BoundaryPoints\>\"", "]"}]}], " ", 
                "]"}], ",", " ", 
               RowBox[{"Precision", " ", "\[Rule]", " ", 
                RowBox[{"OptionValue", "[", "Precision", "]"}]}]}], " ", 
              "]"}]}], ";", " ", 
            RowBox[{"ctr", "++"}]}]}], "\n", "\t", "]"}], ";", "\n", "\n", 
         "\t", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{"ctr", " ", ">", " ", 
            RowBox[{"OptionValue", "[", "MaxIterations", "]"}]}], ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RandomOrigami", "::", "max"}], ",", " ", 
             RowBox[{"ctr", " ", "-", " ", "1"}]}], "]"}]}], " ", "]"}], ";", 
         "\n", "\n", "\t", 
         RowBox[{"Origami", "[", " ", 
          RowBox[{"meshTry", ",", " ", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "Origami", "]"}]}], "]"}]}], " ", 
          "]"}]}], "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{"MeshRegionQ", "[", "firstMesh", "]"}]}]}], "\n", "\n", "]"}], 
    " ", "/;", " ", 
    RowBox[{
     RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "\"\<MinimumFolds\>\"", " ", "]"}], 
      " ", "]"}], " ", "&&", " ", 
     RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", 
      RowBox[{"OptionValue", "[", " ", "MaxIterations", " ", "]"}], " ", 
      "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RandomOrigami", "::", "max"}], "=", 
    "\"\<Maximum number of iterations reached at `1` without finding a \
suitable random Origami.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"validRandomOrigamiQ", "[", " ", 
    RowBox[{"numberOfVertices_", ",", " ", 
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "minimumFolds_", ",", " ", 
     "boundarySize_"}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"AllTrue", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"Drop", "[", " ", 
        RowBox[{
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{
           "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], 
          "]"}], ",", " ", "boundarySize"}], "]"}]}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"#", " ", "\[GreaterEqual]", " ", "minimumFolds"}], " ", 
       "&"}]}], "\n", "\t", "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], "-", "boundarySize"}], 
     " ", "\[Equal]", " ", "numberOfVertices"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "::", "mTorsionalFold"}], "=", 
   "\"\<Minimum number of TorsionalFolds, `1`,  must be a position integer.\>\
\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigamiMinFoldsQ", "[", " ", "f_", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"RandomOrigami", "::", "mTorsionalFold"}], ",", " ", "f"}], 
      "]"}], ";", " ", "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomOrigami", "::", "miter"}], "=", 
   "\"\<Maximum number of iterations, `1`, must be a position integer.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", 
   RowBox[{"_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{"RandomOrigamiMaxIterationsQ", "[", " ", "f_", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"RandomOrigami", "::", "miter"}], ",", " ", "f"}], "]"}], ";", 
    " ", "False"}], ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7480]:=",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "get", " ", "a", " ", "Delaunay", " ", "triangulation", " ", "from", " ", 
    "a", " ", "set", " ", "of", " ", "random", " ", "points"}], " ", "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"randomMesh", "[", 
     RowBox[{
      RowBox[{"numberOfVertices_Integer", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
            RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], "|", "Automatic", "|", 
        "MachinePrecision"}]}], ",", " ", 
      RowBox[{"boundary_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=",
     "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "points", "}"}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"points", "=", 
         RowBox[{"Join", "[", "\n", "\t\t", 
          RowBox[{"boundary", ",", "\n", "\t\t", 
           RowBox[{"Select", "[", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"RandomVariate", "[", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{"UniformDistribution", "[", 
                RowBox[{"RegionBounds", "[", 
                 RowBox[{"Polygon", "[", "boundary", "]"}], "]"}], "]"}], ",",
                "\n", "\t\t\t\t", "numberOfVertices", ",", "\n", "\t\t\t\t", 
               RowBox[{"WorkingPrecision", "->", "precision"}]}], "\n", 
              "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
             RowBox[{"RegionMember", "[", 
              RowBox[{"Polygon", "[", "boundary", "]"}], "]"}]}], "\n", 
            "\t\t", "]"}]}], "\n", "\t", "]"}]}], ";", "\n", "\t", 
        RowBox[{"DelaunayMesh", "[", "points", "]"}]}]}], "\n", "]"}], " ", "/;",
      " ", 
     RowBox[{
      RowBox[{"Last", "[", " ", 
       RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], " ", "]"}], 
      " ", "\[Equal]", " ", "2"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "vnum"}], "=", 
     "\"\<Number of vertices `1` should be a positive integer.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "prec"}], "=", 
     "\"\<Option Precision must be a positive number.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RandomOrigami", "::", "bound"}], "=", 
     "\"\<Boundary points should be a list of vertices in 2D.\>\""}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{"randomMesh", "[", " ", 
     RowBox[{
     "numberOfVertices_", ",", " ", "precision_", ",", " ", "boundary_"}], 
     " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"IntegerQ", "[", "numberOfVertices", "]"}], " ", "&&", " ", 
           RowBox[{"numberOfVertices", " ", "\[GreaterEqual]", " ", "1"}]}], 
          " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"RandomOrigami", "::", "vnum"}], ",", " ", 
           "numberOfVertices"}], " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Not", "[", " ", 
           RowBox[{
            RowBox[{"NumericQ", "[", " ", "precision", " ", "]"}], " ", "&&", 
            " ", 
            RowBox[{"precision", " ", ">", " ", "0"}]}], " ", "]"}], " ", "&&",
           " ", 
          RowBox[{"Not", "[", " ", 
           RowBox[{"precision", " ", "===", " ", "Automatic"}], " ", "]"}]}], 
         ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{
           RowBox[{"RandomOrigami", "::", "prec"}], ",", " ", "precision"}], 
          " ", "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "[", " ", 
          RowBox[{
           RowBox[{"MatrixQ", "[", " ", 
            RowBox[{"boundary", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"Last", "[", 
             RowBox[{"Dimensions", "[", " ", "boundary", " ", "]"}], "]"}], 
            " ", "\[Equal]", " ", "2"}]}], " ", "]"}], ",", " ", 
         RowBox[{"Message", "[", " ", 
          RowBox[{"RandomOrigami", "::", "bound"}], " ", "]"}]}], " ", "]"}], 
       ";", "\n", "\t", "False"}], "\n", ")"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7489]:=",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["ElasticizeOrigami[]", "Subsection",ExpressionUUID->"998277f7-e77f-481f-8d03-2b6fa89387fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"bars", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", " ", "_RigidBar"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"Faces", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_Face"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"TorsionalFolds", " ", "=", " ", 
        RowBox[{"MechanismCellData", "[", 
         RowBox[{"m", ",", "_TorsionalFold"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"possibleFolds", " ", "=", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}], ",", "\n", "\t", 
       "skippedFolds"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"AddCells", "[", " ", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteCells", "[", " ", "\n", "\t\t\t", 
          RowBox[{"Join", "[", " ", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "bars", "]"}], ">", "0"}], ",", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"bars", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], " ", ",", " ", 
              
              RowBox[{"{", "}"}]}], "]"}], " ", ",", " ", "\n", "\t\t\t\t", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "Faces", "]"}], ">", "0"}], ",", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"Faces", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "]"}], ",", " ", 
              
              RowBox[{"{", "}"}]}], " ", "]"}]}], "\n", "\t\t\t", "]"}], " ", 
          "\n", "\t\t", "]"}], " ", "@", " ", "m"}], ",", "\n", "\n", "\t\t", 
        
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "Faces", "]"}], ">", "0"}], ",", " ", 
            RowBox[{"ElasticTriangle", " ", "/@", " ", 
             RowBox[{"Faces", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], " ", ",", 
            " ", 
            RowBox[{"{", "}"}]}], " ", "]"}], ",", "\n", "\t\t", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "TorsionalFolds", "]"}], ">", "0"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"skippedFolds", " ", "=", " ", 
              RowBox[{"Complement", "[", " ", 
               RowBox[{
                RowBox[{"Sort", "/@", "possibleFolds"}], ",", " ", 
                RowBox[{"Sort", "/@", 
                 RowBox[{"TorsionalFolds", "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}]}], 
               "]"}]}], ";", "\n", "\t\t\t", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "skippedFolds", "]"}], ">", "0"}], ",",
                " ", 
               RowBox[{"TorsionalFold", "[", " ", 
                RowBox[{"skippedFolds", " ", ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "0"}], 
                  "}"}]}], "]"}], ",", " ", 
               RowBox[{"{", "}"}]}], " ", "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"TorsionalFold", "[", 
             RowBox[{"possibleFolds", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<TorsionalStiffness\>\"", " ", "\[Rule]", " ", "0"}], 
               "}"}]}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t\t", "}"}]}],
        "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{"FacesWorkQ", "[", " ", "Faces", " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"FacesWorkQ", "[", " ", 
   RowBox[{"{", "}"}], " ", "]"}], " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{"FacesWorkQ", "[", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Face", "[", " ", "indices_", " ", "]"}], " ", "\[Rule]", " ", 
     "data_"}], " ", "}"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"AllTrue", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"MatrixQ", "[", "indices", "]"}], ",", " ", 
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"Dimensions", "[", "indices", "]"}], "]"}], " ", "\[Equal]", 
       " ", "3"}]}], "}"}], ",", " ", "TrueQ"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FacesWorkQ", "[", " ", "_", " ", "]"}], " ", ":=", " ", "False"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"ElasticizeOrigami", "::", "Faces"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ElasticizeOrigami", "::", "Faces"}], "=", 
   "\"\<Faces must be triangles to elasticize this Origami.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7494]:=",ExpressionUUID->"6d9f25cf-a57b-4e21-b29e-24805f43aeb2"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Origami queries", "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],

Cell[CellGroupData[{

Cell["PossibleFoldsQ[]", "Subsection",ExpressionUUID->"6eafb23e-22a5-464e-ae73-da7c35369135"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PossibleFoldsQ", "[", " ", 
    RowBox[{"m_Origami", " ", ",", " ", "foldList_List"}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"Sort", " ", "/@", " ", 
         RowBox[{"(", 
          RowBox[{"foldList", " ", "/.", " ", 
           RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}], ")"}]}]}], ",", "\n", 
       "\t", 
       RowBox[{"allFolds", " ", "=", " ", 
        RowBox[{"Sort", " ", "/@", " ", 
         RowBox[{"InteriorEdges", "[", "m", "]"}]}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"MemberQ", "[", " ", 
        RowBox[{"allFolds", " ", ",", " ", "#"}], " ", "]"}], " ", "&"}], " ",
       "/@", " ", "edges"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PossibleFoldsQ", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "foldList_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"PossibleFoldsQ", "::", "edges"}], ",", " ", "foldList"}], 
    "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PossibleFoldsQ", "::", "edges"}], " ", "=", " ", 
   "\"\<Second argument `1` must be a list of potential folds.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7500]:=",ExpressionUUID->"c7262850-b7bc-45dd-8311-e1e1990b38fb"]
}, Closed]],

Cell[CellGroupData[{

Cell["EquilibriumFoldAngles[]", "Subsection",ExpressionUUID->"6f76eeb7-891c-4cae-a5ac-4d64373ec68b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EquilibriumFoldAngles", "[", " ", "m_Origami", " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"targetFoldAnglesInternal", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}]}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{
      RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
      "targetFoldAnglesInternal"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7503]:=",ExpressionUUID->"6dabfa4d-8d28-41e4-86c9-de88b0ff3516"],

Cell[BoxData[
 RowBox[{
  RowBox[{"targetFoldAnglesInternal", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"data", "=", 
      RowBox[{"MechanismCellData", "[", " ", 
       RowBox[{"m", ",", " ", "_TorsionalFold"}], "]"}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "data", "]"}], ">", "0"}], ",", "\n", "\t\t", 
      RowBox[{"Association", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"\"\<TorsionalFolds\>\"", " ", "\[Rule]", " ", 
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", "\n", 
        "\t\t\t", 
        RowBox[{"\"\<target\>\"", " ", "\[Rule]", " ", 
         RowBox[{
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], "[", "\"\<Angle\>\"", 
          "]"}]}], ",", "\n", "\t\t\t", 
        RowBox[{"\"\<actual\>\"", " ", "\[Rule]", " ", 
         RowBox[{"TorsionalFoldAngle", "[", 
          RowBox[{"m", ",", " ", "positions", ",", " ", 
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], 
       "\n", "\t\t", "]"}], ",", "\n", "\t\t", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<TorsionalFolds\>\"", "\[Rule]", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"\"\<target\>\"", "\[Rule]", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"\"\<actual\>\"", "\[Rule]", 
         RowBox[{"{", "}"}]}]}], "]"}]}], "\n", "\t", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7504]:=",ExpressionUUID->"6ff73ef6-3c3e-43bd-9c10-d8759f822417"]
}, Closed]],

Cell[CellGroupData[{

Cell["FlatOrigamiQ[]", "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FlatOrigamiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "Automatic"}], ",", "\n", "\t", 
     RowBox[{"Precision", "->", "Infinity"}]}], "\n", "}"}]}], ";"}]], "Code",\

 CellLabel->
  "1/2/24 10:12:10 \
In[7505]:=",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "precision"}], "=", 
   "\"\<Precision is not a positive real number or Infinity.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlatOrigamiQ", "::", "zerotest"}], "=", 
   "\"\<ZeroTest function must return True or False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7506]:=",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  RowBox[{"Precision", "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"precision_", "?", "NumericQ"}]}], "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Min", "[", 
    RowBox[{
     RowBox[{"Precision", "[", "m", "]"}], ",", "precision"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"precision", ">", "0"}]}]}], "\n", 
 RowBox[{
  RowBox[{"computePrecision", "[", 
   RowBox[{"m_", ",", "_"}], "]"}], " ", ":=", " ", "$Failed"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7508]:=",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", "Infinity"}], "]"}], " ", ":=", " ", 
  "PossibleZeroQ"}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"Automatic", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "[", "#", "]"}], "<=", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "precision"}], "+", "1"}], ")"}]}]}], "&"}], 
   ")"}]}], "\n", 
 RowBox[{
  RowBox[{"computeZeroTestFunction", "[", 
   RowBox[{"f_", ",", "_"}], "]"}], " ", ":=", " ", "f"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7511]:=",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FlatOrigamiQ", "[", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"actualPrecision", " ", "=", " ", 
       RowBox[{"computePrecision", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "Precision", "]"}]}], "]"}]}], ",", " ", 
      "zerotestFunction", ",", " ", "res"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"zerotestFunction", "=", 
      RowBox[{"computeZeroTestFunction", "[", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], ",", " ", 
        "actualPrecision"}], "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "=", 
      RowBox[{"flatOrigamiInternalQ", "[", 
       RowBox[{"m", ",", "actualPrecision", ",", "zerotestFunction"}], 
       "]"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", "/;", 
      RowBox[{"Which", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "res", "]"}], "=!=", "flatOrigamiInternalQ"}], 
        ",", "\n", "\t\t\t", "True", ",", "\n", "\t\t", 
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", 
          RowBox[{"zerotestFunction", "[", "0", "]"}], "]"}], "]"}], ",", 
        "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"FlatOrigamiQ", "::", "zerotest"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", 
        RowBox[{"actualPrecision", "===", "$Failed"}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"FlatOrigamiQ", "::", "precision"}], "]"}], ";", " ", 
         "False"}], ",", "\n", "\t\t", "True", ",", "False"}], "\n", "\t", 
       "]"}]}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7514]:=",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flatOrigamiInternalQ", "[", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"precision", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "NumericQ"}], " ", "|", " ", "Infinity"}]}], ",", " ", 
    RowBox[{"zerotestFunction_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"BooleanQ", "[", 
        RowBox[{"#", "[", "0", "]"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  "\n", "\t", 
  RowBox[{"AllTrue", "[", 
   RowBox[{
    RowBox[{"DiscreteGaussianCurvature", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"N", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        "precision"}], "]"}], " ", ",", " ", 
      RowBox[{"InteriorVertices", "[", "m", "]"}]}], " ", "]"}], ",", " ", 
    "zerotestFunction"}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7515]:=",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],

Cell[CellGroupData[{

Cell["KawasakiQ[]", "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "KawasakiQ", "]"}], "=", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"ZeroTest", "->", "PossibleZeroQ"}], ",", "\n", "\t", 
     RowBox[{"WorkingPrecision", "->", "Infinity"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7516]:=",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KawasakiQ", "[", 
   RowBox[{"m_Origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"faceList", " ", "=", " ", 
        RowBox[{
         RowBox[{"MechanismConnectivity", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"\"\<vertices\>\"", " ", "->", " ", "\"\<faces\>\""}]}], 
          "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"InteriorVertices", "[", "m", "]"}], "]"}], "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"mNum", "=", 
        RowBox[{"N", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], "]"}]}]}], 
      "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"FlatOrigamiQ", "[", 
        RowBox[{"m", ",", "opt"}], "]"}], ",", "\n", "\t\t", 
       RowBox[{"And", " ", "@@", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"OptionValue", "[", "ZeroTest", "]"}], " ", "/@", " ", 
          RowBox[{"kawasakiAlternatingSum", "[", 
           RowBox[{"mNum", ",", " ", "faceList"}], "]"}]}], ")"}]}], ",", 
       "\n", "\t\t", "False"}], "\n", "\t", "]"}]}], "\n", "]"}], "/;", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", "\n", "\t", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], ")"}], "&&", "\n", "\t", 
     RowBox[{"BooleanQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], 
      "]"}]}], "\n", ")"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7517]:=",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],

Cell[BoxData[
 RowBox[{
  RowBox[{"kawasakiAlternatingSum", "[", 
   RowBox[{"m_", ",", " ", "faceList_"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"faces", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"RotateRight", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], " ", "/@", " ", 
       "faceList"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OddQ", "[", 
         RowBox[{"Length", "[", "#", "]"}], "]"}], ",", "\n", "\t\t", "1", 
        ",", "\n", "\t\t", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"-", "1"}], ")"}], "^", "#"}], " ", "&"}], "/@", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "#", "]"}], "]"}]}], "]"}], " ", ".", " ", 
          RowBox[{"PlaneAngle", "[", 
           RowBox[{"m", ",", "#"}], "]"}]}], "]"}]}], "\n", "\t", "]"}], 
      "&"}], " ", "/@", " ", "faces"}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7518]:=",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"KawasakiQ", "::", "workingprecision"}], "=", 
   "\"\<Working precesion must be a real value larger than 0.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"KawasakiQ", "::", "zerotest"}], "=", 
    "\"\<Zero test does not return True or False.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"KawasakiQ", "[", 
   RowBox[{"m_Origami", ",", 
    RowBox[{"opt", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Which", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"NumericQ", "[", 
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], "&&", 
         
         RowBox[{
          RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], ">", "0"}]}],
         ")"}], "||", 
       RowBox[{
        RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "===", 
        "Infinity"}]}], "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"KawasakiQ", "::", "workingprecision"}], "]"}], ";", "\n", 
      "\t\t", "False"}], ",", "\n", "\t", 
     RowBox[{"Not", "[", 
      RowBox[{"BooleanQ", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ZeroTest", "]"}], "[", "0", "]"}], "]"}],
       "]"}], ",", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"KawasakiQ", "::", "zerotest"}], "]"}], ";", "\n", "\t\t", 
      "False"}], ",", "\n", "\t", "True", ",", "False"}], "\n", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7519]:=",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],

Cell[CellGroupData[{

Cell["SameFoldAnglesQ[]", "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"TorsionalFolds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"TorsionalFoldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
         "]"}]}], ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"TorsionalFoldAngle", "[", " ", 
         RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", " ", 
       RowBox[{"(", 
        RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", " ", 
      RowBox[{"precision", "^", "2"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SameFoldAnglesQ", "[", 
     RowBox[{"m_Origami", ",", " ", 
      RowBox[{"TorsionalFolds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SameFoldAnglesQ", "[", 
     RowBox[{"m_Origami", ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
     RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"TorsionalFolds", " ", "=", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"{", "\n", "\t", 
         RowBox[{
          RowBox[{"angles1", " ", "=", " ", 
           RowBox[{"TorsionalFoldAngle", "[", " ", 
            RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
            "]"}]}], ",", "\n", "\t", 
          RowBox[{"angles2", " ", "=", " ", 
           RowBox[{"TorsionalFoldAngle", "[", " ", 
            RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
            "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}], " ", ".", 
          " ", 
          RowBox[{"(", 
           RowBox[{"angles1", " ", "-", " ", "angles2"}], ")"}]}], " ", "<", 
         " ", 
         RowBox[{"precision", "^", "2"}]}]}], "\n", "\t", "]"}]}], "\n", 
     "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
      RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], ",", 
        RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
       "}"}]}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameFoldAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7522]:=",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],

Cell[CellGroupData[{

Cell["SameMVAnglesQ[]", "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"TorsionalFolds_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
      "0.1"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angles1", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
       RowBox[{"angles2", " ", "=", " ", 
        RowBox[{"Sign", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
             ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"TorsionalFoldAngle", "[", " ", 
           RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ", 
           "]"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"And", " ", "@@", " ", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
        RowBox[{"{", 
         RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", "]"}],
    " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], 
       RowBox[{"(*", 
        RowBox[{"MeshCellCount", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<MeshRegion\>\"", "]"}], ",", "0"}], "]"}], 
        "*)"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SameMVAnglesQ", "[", 
     RowBox[{"m_Origami", ",", " ", 
      RowBox[{"TorsionalFolds_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"MatrixQ", "[", 
          RowBox[{"#", ",", "Integer"}], "]"}], "&"}], ")"}]}], ",", " ", 
      RowBox[{"precision", " ", ":", " ", 
       RowBox[{"_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
           RowBox[{"#", ">", "0"}]}], " ", "&"}], ")"}]}], " ", ":", " ", 
       "0.1"}]}], "]"}], "[", 
    RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     " ", "]"}], "[", 
   RowBox[{
    RowBox[{"pos1_", "?", "MatrixQ"}], ",", " ", 
    RowBox[{"pos2_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"TorsionalFolds", " ", "=", " ", 
       RowBox[{"InteriorEdges", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"angles1", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"TorsionalFoldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos1", ",", " ", "TorsionalFolds"}], " ",
              "]"}]}], " ", "]"}]}], ",", "\n", "\t", 
         RowBox[{"angles2", " ", "=", " ", 
          RowBox[{"Sign", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Abs", "[", "#", "]"}], "<", "precision"}], ",", "0", 
               ",", "#"}], "]"}], "&"}], " ", "/@", " ", 
            RowBox[{"TorsionalFoldAngle", "[", " ", 
             RowBox[{"m", ",", " ", "pos2", ",", " ", "TorsionalFolds"}], " ",
              "]"}]}], " ", "]"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{"And", " ", "@@", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", "\[Equal]", "#2"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"angles1", ",", "angles2"}], "}"}]}], "]"}]}]}], "\n", 
      "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"Dimensions", "[", "pos2", "]"}]}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "pos1", "]"}], "\[Equal]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], 
       RowBox[{"(*", 
        RowBox[{"MeshCellCount", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<MeshRegion\>\"", "]"}], ",", "0"}], "]"}], 
        "*)"}], ",", 
       RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}]}], 
      "}"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SameMVAnglesQ", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"precision", " ", ":", " ", 
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], " ", ":", " ", "0.1"}]}],
     "]"}], "[", 
   RowBox[{"_", ",", "_"}], "]"}], " ", ":=", " ", "False"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7526]:=",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Origami data", "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],

Cell[CellGroupData[{

Cell["TorsionalFoldMatrix[]", "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", "m_Origami", "]"}], ":=", 
  RowBox[{"torsionalFoldMatrixInternal", "[", 
   RowBox[{"m", ",", 
    RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
    RowBox[{"InteriorEdges", "[", "m", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "[", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"edges_", "?", "MatrixQ"}]}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"actualEdges", " ", "=", " ", 
        RowBox[{"edges", " ", "/.", " ", 
         RowBox[{"m", "[", "\"\<labels\>\"", "]"}]}]}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"torsionalFoldMatrixInternal", "[", 
       RowBox[{"m", ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
        "actualEdges"}], "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"And", " ", "@@", " ", 
     RowBox[{"PossibleFoldsQ", "[", 
      RowBox[{"m", ",", " ", "edges"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"TorsionalFoldMatrix", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "___"}], "]"}], " ", ":=", 
  " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "edges_"}], " ", "]"}], " ",
    ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"TorsionalFoldMatrix", "::", "indices"}], ",", " ", "edges"}], 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TorsionalFoldMatrix", "::", "notorig"}], "=", 
   "\"\<Mechanism is not Origami.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TorsionalFoldMatrix", "::", "indices"}], "=", 
    "\"\<Indices provided `1` do not correspond to a list of edges.\>\""}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"torsionalFoldMatrixInternal", "[", 
   RowBox[{"m_", ",", "positions_", ",", 
    RowBox[{"indices_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"MatrixQ", "[", 
        RowBox[{"#", ",", "IntegerQ"}], "]"}], "&"}], ")"}]}]}], "]"}], ":=", 
  " ", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"displacements", "=", 
      RowBox[{"VertexDisplacement", "[", "m", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{
       RowBox[{"TorsionalFoldAngle", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"positions", "+", "displacements"}], ",", " ", "indices"}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Flatten", "[", "displacements", "]"}], "}"}]}], "]"}], " ", "/.",
      " ", 
     RowBox[{"Dispatch", "[", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "displacements", "]"}], "->", "0"}], "]"}], 
      "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7530]:=",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"]
}, Closed]],

Cell[CellGroupData[{

Cell["AngularFoldMatrix[] - commented out", "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"AngularFoldMatrix", "[", 
      RowBox[{"m_Origami", ",", "vertex_Integer"}], "]"}], ":=", 
     RowBox[{"AngularFoldMatrix", "[", 
      RowBox[{
       RowBox[{"Deformed", "[", 
        RowBox[{"m", ",", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",", 
       "vertex"}], "]"}]}], "\n", 
    RowBox[{"AngularFoldMatrix", "[", 
     RowBox[{
      RowBox[{"Deformed", "[", 
       RowBox[{"m_Origami", ",", 
        RowBox[{"positions_", "?", "MatrixQ"}]}], "]"}], ",", 
      "vertex_Integer"}], "]"}]}], ":=", 
   RowBox[{
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"vertices", "=", 
         RowBox[{"MechanismVertices", "[", 
          RowBox[{"m", ",", "vertex"}], "]"}]}], ",", "TorsionalFoldLengths", 
        ",", "angles", ",", "heights"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"TorsionalFoldLengths", "=", 
        RowBox[{"DisplacementLength", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", "vertices"}]}],
          "]"}]}], ";", "\n", "\t", 
       RowBox[{"heights", "=", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"VertexDisplacement", "[", 
           RowBox[{"vertices", ",", "\"\<z\>\""}], "]"}], "->", 
          RowBox[{"TorsionalFoldLengths", " ", 
           RowBox[{"Array", "[", 
            RowBox[{"angles", ",", 
             RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"Last", "@", 
        RowBox[{"CoefficientArrays", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{
              RowBox[{"TorsionalFoldMatrixInternal", "[", 
               RowBox[{"m", ",", "positions", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#", ",", "vertex"}], "}"}], "&"}], "/@", 
                 "vertices"}]}], "]"}], " ", ".", " ", 
              RowBox[{"Flatten", "[", 
               RowBox[{"VertexDisplacement", "[", 
                RowBox[{"m", ",", 
                 RowBox[{"All", "[", "3", "]"}]}], "]"}], "]"}]}]}], "/.", 
            "heights"}], "/.", 
           RowBox[{
            RowBox[{"VertexDisplacement", "[", 
             RowBox[{"_", ",", "_"}], "]"}], "->", "0"}]}], ",", "\n", "\t\t", 
          RowBox[{"Array", "[", 
           RowBox[{"angles", ",", 
            RowBox[{"Length", "[", "vertices", "]"}]}], "]"}]}], "\n", "\t", 
         "]"}]}]}]}], "\n", "]"}], "/;", 
    RowBox[{"MemberQ", "[", 
     RowBox[{
      RowBox[{"InteriorVertices", "[", "m", "]"}], ",", "vertex"}], "]"}]}]}],
   "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7537]:=",ExpressionUUID->"7eb36550-2677-423f-a8d8-d0ab46ad3de9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"AngularFoldMatrix", "::", "notintv"}], "=", 
      "\"\<Vertex should be an interior vertex.\>\""}], ";"}], "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"AngularFoldMatrix", "::", "orig"}], "=", 
      "\"\<Mechanism is not Origami.\>\""}], ";"}], "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"AngularFoldMatrix", "::", "pos"}], "=", 
      "\"\<Positions do not correspond to the Mechanism provided.\>\""}], 
     ";"}], "\n", "\n", 
    RowBox[{
     RowBox[{"AngularFoldMatrix", "[", 
      RowBox[{"m_Origami", ",", "_"}], "]"}], ":=", 
     RowBox[{"\"\<nothing\>\"", "/;", 
      RowBox[{"Message", "[", 
       RowBox[{"AngularFoldMatrix", "::", "notintv"}], "]"}]}]}], "\n", 
    RowBox[{"AngularFoldMatrix", "[", 
     RowBox[{
      RowBox[{"Deformed", "[", 
       RowBox[{"m_", ",", "positions_"}], "]"}], ",", "v_"}], "]"}]}], ":=", 
   RowBox[{"\"\<nothing\>\"", "/;", 
    RowBox[{"Which", "[", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", "m", "]"}], "=!=", "Origami"}], ",", 
      RowBox[{"Message", "[", 
       RowBox[{"AngularFoldMatrix", "::", "orig"}], "]"}], ",", "\n", "\t", 
      RowBox[{"Not", "[", 
       RowBox[{"VertexCoordinatesQ", "[", 
        RowBox[{"m", ",", "positions"}], "]"}], "]"}], ",", 
      RowBox[{"Message", "[", 
       RowBox[{"AngularFoldMatrix", "::", "pos"}], "]"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"IntegerQ", "[", "v", "]"}], "]"}], "||", 
       RowBox[{"Not", "[", 
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"InteriorVertices", "[", "m", "]"}], ",", "v"}], "]"}], 
        "]"}]}], ",", 
      RowBox[{"Message", "[", 
       RowBox[{"AngularFoldMatrix", "::", "notintv"}], "]"}], ",", "\n", "\t",
       "True", ",", "False"}], "\n", "]"}]}]}], "*)"}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7538]:=",ExpressionUUID->"2e4e6074-c2e2-466f-9f4f-f2e1bbdc18b0"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics and geometry", "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],

Cell[CellGroupData[{

Cell["ButterflyDecomposition[], ButterflyDecomposableQ[]", "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecomposition", "[", " ", "o_Origami", " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"results", " ", "=", " ", 
        RowBox[{"FixedPointList", "[", " ", 
         RowBox[{"ButterflyDecompositionStep", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", "o"}], "}"}]}], " ", "]"}]}], ",", " ", 
       "remainingOrigami"}], " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"remainingOrigami", " ", "=", " ", 
       RowBox[{
        RowBox[{"Last", "[", "results", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"Drop", "[", " ", 
         RowBox[{
          RowBox[{"Drop", "[", " ", 
           RowBox[{
            RowBox[{"results", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", 
            RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], ",", " ", 
        "remainingOrigami"}], " ", "}"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStep", "[", " ", 
   RowBox[{"{", 
    RowBox[{"Facepair_", ",", " ", "o_Origami"}], "}"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"BoundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "Faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismConnectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "Faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         "\n", "\t\t", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"butterfly", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
           RowBox[{"DeleteCells", "[", 
            RowBox[{"o", ",", " ", 
             RowBox[{"Alternatives", "@@", 
              RowBox[{"(", " ", 
               RowBox[{"Face", " ", "/@", " ", 
                RowBox[{"butterfly", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", ")"}]}]}], " ", 
            "]"}]}], "  ", "}"}]}], ",", "\n", "\n", "\t\t", 
        RowBox[{"{", 
         RowBox[{"Facepair", ",", " ", "o"}], "}"}]}], "\n", "\t", "]"}]}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionStep", "[", " ", 
    RowBox[{"{", 
     RowBox[{"Facepair_", ",", "o_Origami"}], "}"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"{", 
    RowBox[{"Facepair", ",", "o"}], "}"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "this", " ", "version", " ", "shows", " ", "little", " ", "speed", " ", 
    "improvements", " ", "over", " ", "solving", " ", "everything", " ", 
    "explicitly"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ButterflyDecompositionQ", "[", " ", "o_Origami", " ", "]"}], " ", 
   ":=", " ", 
   RowBox[{"FixedPoint", "[", " ", 
    RowBox[{"ButterflyDecompositionStepQ", ",", " ", "o"}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", 
   RowBox[{"f_", "?", "BooleanQ"}], " ", "]"}], " ", ":=", " ", "f"}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", "o_Origami", " ", "]"}], 
  " ", ":=", " ", 
  RowBox[{
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"boundary", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"BoundaryVertices", "[", "o", "]"}], "]"}]}], ",", " ", 
       "Faces", ",", " ", "possibleButterflies", ",", " ", "butterfly"}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"Faces", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismConnectivity", "[", " ", 
         RowBox[{"o", ",", " ", 
          RowBox[{
          "\"\<vertices\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], "]"}],
         "[", 
        RowBox[{"[", " ", "boundary", " ", "]"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"possibleButterflies", " ", "=", " ", 
       RowBox[{"Select", "[", " ", 
        RowBox[{
         RowBox[{"Transpose", "[", " ", 
          RowBox[{"{", 
           RowBox[{"boundary", ",", " ", "Faces"}], "}"}], " ", "]"}], ",", 
         " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}], " ", "\[Equal]", " ", 
           "2"}], " ", "&"}]}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "possibleButterflies", "]"}], ">", "0"}], ",",
         "\n", "\t\t", 
        RowBox[{
         RowBox[{"butterfly", " ", "=", " ", 
          RowBox[{"RandomChoice", "[", "possibleButterflies", "]"}]}], ";", 
         " ", "\n", "\t\t", 
         RowBox[{"DeleteVertices", "[", 
          RowBox[{"o", ",", " ", 
           RowBox[{"{", 
            RowBox[{"butterfly", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "}"}]}], "]"}]}], ",", "\n", 
        "\n", "\t\t", "False"}], "\n", "\t", "]"}]}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"o", "[", "\"\<faces\>\"", "]"}], "]"}], "\[GreaterEqual]", 
    "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{"ButterflyDecompositionStepQ", "[", " ", "o_Origami", " ", "]"}], 
  " ", ":=", " ", "True"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7539]:=",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],

Cell[CellGroupData[{

Cell["FlattenOrigami[]", "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unTorsionalFoldOrigami", "[", " ", "m_Origami", " ", "]"}], " ", ":=",
   " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"TorsionalFolds", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Property", "[", " ", 
          RowBox[{
           RowBox[{"TorsionalFold", "[", "#", "]"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], "}"}]}], " ",
           "]"}], "&"}], " ", "/@", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}]}], ",", "\n", "\t", 
      "selfflatteningOrigami", ",", " ", "res"}], "\n", "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{"selfflatteningOrigami", " ", "=", " ", 
      RowBox[{
       RowBox[{"AddCells", "[", " ", "TorsionalFolds", " ", "]"}], " ", "@", 
       " ", 
       RowBox[{
        RowBox[{"DeleteCells", "[", " ", "_PinnedJoint", " ", "]"}], " ", "@",
         " ", 
        RowBox[{
         RowBox[{"DeleteCells", "[", " ", "_TorsionalFold", " ", "]"}], " ", 
         "@", " ", "m"}]}]}]}], ";", "\n", "\n", "\t", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"MinimizeMechanismEnergy", "[", " ", 
       RowBox[{"selfflatteningOrigami", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "6"}]}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "res", "]"}], "===", "Association"}], ",", " ", 
       "res", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Error\>\"", " ", "->", " ", "False"}], ",", " ", 
         RowBox[{"\"\<Energy\>\"", " ", "->", " ", "Infinity"}], ",", " ", 
         RowBox[{"\"\<VertexCoordinates\>\"", "->", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}]}], "}"}]}], 
      " ", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7546]:=",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chooseBoundaryFace", "[", " ", "m_Origami", " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"First", " ", "@", " ", 
   RowBox[{"SelectFirst", "[", " ", 
    RowBox[{
     RowBox[{"MechanismConnectivity", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"\"\<edges\>\"", " ", "\[Rule]", " ", "\"\<faces\>\""}]}], " ",
       "]"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "1"}], " ", "&"}]}], 
    " ", "]"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7547]:=",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rotateFaceToXYPlane", "[", " ", 
    RowBox[{"positions_", ",", " ", 
     RowBox[{"Face", " ", ":", " ", 
      RowBox[{"{", "__Integer", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"initialPoints", " ", "=", " ", 
        RowBox[{"positions", "[", 
         RowBox[{"[", " ", 
          RowBox[{"Face", "[", 
           RowBox[{"[", 
            RowBox[{"1", ";;", "3"}], "]"}], "]"}], " ", "]"}], "]"}]}], ",", 
       " ", "lengths", ",", " ", "angle", ",", " ", "newPointLocations", ",", 
       " ", "residual", ",", " ", "transform"}], " ", "}"}], ",", " ", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"lengths", " ", "=", " ", 
       RowBox[{"DisplacementLength", "[", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", 
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "}"}]}], " ", "]"}]}], 
      ";", "\n", "\t", 
      RowBox[{"angle", " ", "=", " ", 
       RowBox[{"First", " ", "@", " ", 
        RowBox[{"PlaneAngle", "[", " ", 
         RowBox[{"positions", ",", " ", 
          RowBox[{"{", 
           RowBox[{"Face", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "3"}], "]"}], "]"}], "}"}]}], " ", "]"}]}]}], 
      ";", "\t", "\n", "\t", 
      RowBox[{"newPointLocations", " ", "=", " ", 
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"lengths", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "0"}], "}"}], ",", 
         "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"lengths", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Cos", "[", " ", "angle", " ", "]"}], ",", " ", 
            RowBox[{"Sin", "[", " ", "angle", " ", "]"}], ",", " ", "0"}], 
           " ", "}"}]}]}], "\n", "\t", "}"}]}], ";", "\n", "\t", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"residual", ",", " ", "transform"}], " ", "}"}], " ", "=", 
       " ", 
       RowBox[{"FindGeometricTransform", "[", " ", 
        RowBox[{"newPointLocations", ",", "initialPoints", ",", " ", 
         RowBox[{
         "TransformationClass", " ", "\[Rule]", " ", "\"\<Rigid\>\""}], ",", 
         " ", 
         RowBox[{"Method", " ", "\[Rule]", " ", "\"\<Linear\>\""}]}], " ", 
        "]"}]}], ";", "\n", "\n", "\t", "transform"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "Face"}], "=", 
   "\"\<Unable to identify Faces.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"rotateFaceToXYPlane", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"FlattenOrigami", "::", "Face"}], "]"}], ";", " ", "Identity"}], 
   ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7548]:=",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "FlattenOrigami", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "MeshRegion", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "[", " ", 
    RowBox[{"m_Origami", " ", ",", " ", 
     RowBox[{"tol_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "#", "]"}], " ", "&&", " ", 
         RowBox[{"#", ">", "0"}]}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
   "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "unTorsionalFoldedEnergy", ",", " ", "unTorsionalFoldedPositions", ",", 
       " ", "transform", ",", " ", "xyPositions", ",", " ", "newOrigami"}], 
      " ", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"FlatOrigamiQ", "[", 
          RowBox[{"m", ",", " ", 
           RowBox[{"Precision", " ", "\[Rule]", " ", "tol"}]}], " ", "]"}], 
         "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"FlattenOrigami", "::", "flat"}], "]"}]}], " ", "]"}], ";", 
      "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
        "unTorsionalFoldedEnergy", ",", " ", "unTorsionalFoldedPositions"}], 
        " ", "}"}], " ", "=", " ", 
       RowBox[{"unTorsionalFoldOrigami", "[", "m", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", ".", " ", "#"}], " ", "&"}], ")"}], " ", "@", 
          " ", 
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", " ", "unTorsionalFoldedPositions", ",", " ", 
            RowBox[{"InteriorEdges", "[", "m", "]"}]}], "]"}]}], " ", ">", 
         " ", 
         RowBox[{"10", "^", 
          RowBox[{"(", 
           RowBox[{"-", "4"}], ")"}]}]}], ",", " ", 
        RowBox[{"Message", "[", " ", 
         RowBox[{"FlattenOrigami", "::", "notflt"}], " ", "]"}]}], " ", "]"}],
       ";", "\n", "\n", "\t", 
      RowBox[{"transform", " ", "=", " ", 
       RowBox[{"rotateFaceToXYPlane", "[", " ", 
        RowBox[{"unTorsionalFoldedPositions", ",", " ", 
         RowBox[{"chooseBoundaryFace", "[", "m", "]"}]}], " ", "]"}]}], ";", 
      "\n", "\t", 
      RowBox[{"xyPositions", " ", "=", " ", 
       RowBox[{"PadRight", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "transform", "[", " ", "unTorsionalFoldedPositions", " ", "]"}], 
          "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", 
            RowBox[{"1", ";;", "2"}]}], "]"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "unTorsionalFoldedPositions", "]"}], ",", 
           " ", "3"}], " ", "}"}]}], " ", "]"}]}], ";", "\n", "\t\t\t", "\n", 
      "\t", 
      RowBox[{"Mechanisms`Private`addMeshRegion", "[", " ", 
       RowBox[{
        RowBox[{"Origami", "[", " ", 
         RowBox[{"xyPositions", ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"m", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], " ", "]"}], ",", " ", 
        "Automatic", ",", " ", "opt"}], " ", "]"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "notflt"}], "=", 
   "\"\<Origami flat energy may be too large to get good results.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "flat"}], "=", 
   "\"\<Gaussian curvature of vertices is not flat to desired tolerance \
`1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FlattenOrigami", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance `1` should be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FlattenOrigami", "::", "tol2"}], " ", "=", " ", 
    "\"\<Second argument should be a tolerance.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"FlattenOrigami", "[", " ", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"FlattenOrigami", "::", "tol2"}], " ", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"FlattenOrigami", "[", " ", 
   RowBox[{"m_Origami", ",", " ", "tol_", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"FlattenOrigami", "::", "tol"}], ",", " ", "tol"}], " ", 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7551]:=",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],

Cell[CellGroupData[{

Cell["MVAssignment[]", "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"MVAssignment", "[", " ", 
   RowBox[{"m_Origami", " ", ",", " ", 
    RowBox[{"tol", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}]}], ",", " ", 
    RowBox[{"color_", " ", ":", " ", "Automatic"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"MVAssignment", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}], ",", " ",
     "tol", ",", " ", "color"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MVAssignment", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{"m_Origami", ",", " ", "positions_"}], " ", "]"}], " ", ",", 
     " ", 
     RowBox[{"tol", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}]}], ",", " ", 
     RowBox[{"color_", " ", ":", " ", "Automatic"}]}], " ", "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"pos", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"positions", " ", "===", " ", "Automatic"}], ",", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
          "positions"}], "]"}]}], ",", " ", "\n", "\t", 
       RowBox[{"colorFunction", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"color", " ", "===", " ", "Automatic"}], ",", " ", 
          "MVdefaultColor", ",", " ", "color"}], " ", "]"}]}], ",", " ", "\n",
        "\t", 
       RowBox[{"edges", " ", "=", " ", 
        RowBox[{"InteriorEdges", "[", "m", "]"}]}]}], "\n", "}"}], ",", "\n", 
     "\t", 
     RowBox[{
      RowBox[{"With", "[", " ", 
       RowBox[{
        RowBox[{"{", " ", 
         RowBox[{"angles", " ", "=", " ", 
          RowBox[{"TorsionalFoldAngle", "[", 
           RowBox[{"m", ",", " ", "pos", ",", " ", "edges"}], "]"}]}], " ", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{"MapThread", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#1", " ", "\[Rule]", " ", 
             RowBox[{"colorFunction", "[", " ", 
              RowBox[{"assignMVForFold", "[", " ", 
               RowBox[{"#2", ",", " ", "tol"}], " ", "]"}], " ", "]"}]}], " ",
             ")"}], " ", "&"}], " ", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"edges", ",", " ", "angles"}], " ", "}"}]}], " ", "]"}]}], 
       "\n", "\t", "]"}], " ", "/;", " ", 
      RowBox[{"NumericCoordinatesQ", "[", 
       RowBox[{"m", ",", " ", "pos"}], "]"}]}]}], "\n", "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{"1", " ", "/;", " ", 
   RowBox[{"angle", " ", ">", " ", 
    RowBox[{"Abs", "[", "tol", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"assignMVForFold", "[", 
   RowBox[{"angle_", ",", " ", "tol_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"-", "1"}], " ", "/;", " ", 
   RowBox[{"angle", " ", "<", " ", 
    RowBox[{"-", 
     RowBox[{"Abs", "[", "tol", "]"}]}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"assignMVForFold", "[", 
    RowBox[{"_", ",", "_"}], "]"}], ":=", "0"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "1", "]"}], " ", ":=", " ", "Red"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", 
   RowBox[{"-", "1"}], "]"}], " ", ":=", " ", "Blue"}], "\n", 
 RowBox[{
  RowBox[{"MVdefaultColor", "[", "0", "]"}], " ", ":=", " ", 
  "Black"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7559]:=",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],

Cell[CellGroupData[{

Cell["MVColor[]", "Subsection",ExpressionUUID->"db3d8342-8d8e-4752-845f-f3b764a796fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MVColor", "]"}], " ", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"\"\<Mountain\>\"", " ", "->", " ", "Red"}], ",", " ", 
      RowBox[{"\"\<Valley\>\"", " ", "->", " ", "Blue"}], ",", " ", 
      RowBox[{"\"\<Hinge\>\"", " ", "->", " ", "Black"}], " ", ",", " ", 
      RowBox[{"Precision", " ", "->", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "8"}], ")"}]}]}]}], "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MVColor", "[", " ", 
   RowBox[{"m_Origami", ",", " ", 
    RowBox[{"s", " ", ":", " ", "_String", " ", ":", " ", "\"\<target\>\""}], 
    " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"MVColor", "[", " ", 
    RowBox[{"s", ",", " ", "opt"}], "]"}], "[", "m", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MVColor", "[", " ", 
     RowBox[{
      RowBox[{
      "s", " ", ":", " ", "_String", " ", ":", " ", "\"\<target\>\""}], " ", 
      ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], "[", "m_Origami",
     "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", "\n", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"EquilibriumFoldAngles", "[", "m", "]"}]}], ",", " ", 
       "styles", ",", " ", "\n", 
       RowBox[{"colorFunction", " ", "=", " ", 
        RowBox[{"mvDefaultColorFunction", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Mountain\>\"", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Valley\>\"", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Hinge\>\"", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "Precision", "]"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"(", "\n", "\t", 
       RowBox[{
        RowBox[{"styles", " ", "=", " ", 
         RowBox[{"colorFunction", " ", "/@", " ", 
          RowBox[{"N", "[", 
           RowBox[{"data", "[", "s", "]"}], "]"}]}]}], ";", "\n", "\t", 
        RowBox[{"ChangeCellData", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"TorsionalFold", "[", 
           RowBox[{"data", "[", "\"\<TorsionalFolds\>\"", "]"}], "]"}], ",", 
          RowBox[{"\"\<Style\>\"", " ", "\[Rule]", " ", "styles"}]}], "]"}]}],
        "\n", "\t", ")"}], " ", "/;", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"MemberQ", "[", " ", 
         RowBox[{
          RowBox[{"Keys", "[", "data", "]"}], ",", " ", "s"}], "]"}], ",", 
        " ", "True", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"MVColor", "::", "s"}], ",", "s", ",", 
           RowBox[{"Keys", "[", "data", "]"}]}], "]"}], ";", " ", "False"}]}],
        "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mvDefaultColorFunction", "[", " ", 
    RowBox[{
    "mountainColor_", ",", " ", "valleyColor_", ",", " ", "hingeColor_", " ", 
     ",", " ", "precision_"}], "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"mc", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "mountainColor", "]"}], "===", "List"}], ",", 
          " ", 
          RowBox[{"Directive", "@@", "mountainColor"}], ",", " ", 
          "mountainColor"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"vc", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "valleyColor", "]"}], "===", "List"}], ",", 
          " ", 
          RowBox[{"Directive", "@@", "valleyColor"}], ",", " ", 
          "valleyColor"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"hc", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "hingeColor", "]"}], "===", "List"}], ",", 
          " ", 
          RowBox[{"Directive", "@@", "hingeColor"}], ",", " ", "hingeColor"}],
          "]"}]}], ",", "\n", "\t", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"NumericQ", "[", "precision", "]"}], " ", "&&", " ", 
           RowBox[{"precision", " ", ">=", " ", "0"}]}], ",", " ", 
          "precision", " ", ",", " ", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"MVColor", "::", "p"}], ",", " ", "precision"}], "]"}], 
           ";", " ", "0"}]}], " ", "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", "x", "}"}], ",", 
       RowBox[{"Which", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"NumericQ", "[", "x", "]"}], "]"}], ",", " ", "hc", ",", 
         "\n", "\t\t", 
         RowBox[{"x", " ", ">", " ", "p"}], ",", " ", "mc", ",", "\n", "\t\t", 
         RowBox[{"x", " ", "<", " ", 
          RowBox[{"-", "p"}]}], ",", " ", "vc", ",", "\n", "\t\t", "True", 
         ",", " ", "hc"}], " ", "\n", "\t", "]"}]}], "]"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "::", "s"}], "=", 
   "\"\<`1` is not a valid string of type `2`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MVColor", "::", "p"}], "=", 
   "\"\<Precision `1` should be a positive number.\>\""}], ";"}]}], "Code",Exp\
ressionUUID->"63f61e01-74fc-40c9-934b-7d2c34da1f73"]
}, Open  ]],

Cell[CellGroupData[{

Cell["SurfaceArea[], RegionMeasure[], RegionMoment[]", "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SurfaceArea", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"SurfaceArea", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMeasure", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMeasure", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RegionMoment", "[", 
   RowBox[{"o_Origami", ",", " ", "r___"}], "]"}], " ", "^:=", " ", 
  RowBox[{"RegionMoment", "[", " ", 
   RowBox[{
    RowBox[{"o", "[", "\"\<MeshRegion\>\"", "]"}], ",", " ", "r"}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7573]:=",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],

Cell[CellGroupData[{

Cell["DeconstructedOrigami[]", "Subsection",ExpressionUUID->"e536bc67-8dac-439c-9b64-663526d4bf1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "DeconstructedOrigami", "]"}], "=", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<edgeWeights\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", "\n", "\t", 
      RowBox[{"\"\<defaultWeight\>\"", " ", "\[Rule]", " ", "0"}]}], "\n", 
     "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "[", " ", 
    RowBox[{"m_Origami", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", "\t", 
   
   RowBox[{"DeconstructedOrigami", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", 
      RowBox[{"m", ",", " ", 
       RowBox[{"MechanismPositions", "[", "m", "]"}]}], "]"}], ",", " ", 
     "opt"}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{"m_Origami", ",", " ", "coords_"}], "]"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"Faces", " ", "=", " ", 
         RowBox[{"MechanismFaces", "[", "m", "]"}]}], ",", " ", "\n", "\t", 
        RowBox[{"widths", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MechanismConnectivity", "[", 
            RowBox[{"m", ",", 
             RowBox[{
             "\"\<faces\>\"", " ", "\[Rule]", " ", "\"\<edges\>\""}]}], "]"}],
            " ", "/.", " ", 
           RowBox[{"OptionValue", "[", "\"\<edgeWeights\>\"", "]"}]}], " ", "/.",
           " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"_Integer", ",", "_Integer"}], "}"}], " ", "\[Rule]", " ", 
           RowBox[{"OptionValue", "[", "\"\<defaultWeight\>\"", "]"}]}]}]}]}],
        "\n", "}"}], ",", "\n", "\t", 
      RowBox[{"MapThread", "[", " ", 
       RowBox[{"shrinkPolygon", " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"coords", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}], " ", "/@", " ", "Faces"}],
           ",", "widths"}], "}"}]}], " ", "]"}]}], "\n", "]"}], " ", "/;", 
    " ", 
    RowBox[{"DeconstructedOrigamiQ", "[", 
     RowBox[{"m", " ", ",", " ", "coords", ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<edgeWeights\>\"", "]"}], ",", " ", 
      RowBox[{"OptionValue", "[", "\"\<defaultWeight\>\"", "]"}]}], " ", 
     "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigamiQ", "[", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{"m_", ",", " ", "positions_"}], "]"}], ",", " ", "rules_", ",", 
     " ", "default_"}], " ", "]"}], ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VertexCoordinatesQ", "[", 
       RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "pos"}], "]"}], ";", " ", 
       "False"}]}], "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "default", "]"}], "&&", 
       RowBox[{"default", " ", "\[GreaterEqual]", " ", "0"}]}], ",", " ", 
      "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "defaultweight"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", " ", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MatchQ", "[", " ", 
       RowBox[{"rules", ",", " ", 
        RowBox[{"{", "___Rule", "}"}]}], " ", "]"}], ",", " ", "True", ",", 
      " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weightRules"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"VectorQ", "[", " ", 
       RowBox[{
        RowBox[{"rules", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "2"}], "]"}], "]"}], " ", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
          RowBox[{"#", "\[GreaterEqual]", "0"}]}], "&"}]}], " ", "]"}], ",", 
      " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weightrules"}], "]"}], ";", 
       " ", "False"}]}], " ", "]"}], " ", "&&", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"MatchQ", "[", " ", 
       RowBox[{
        RowBox[{"rules", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], " ", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"_Integer", ",", "_Integer"}], "}"}], "..."}], "}"}]}], 
       " ", "]"}], ",", " ", "True", ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"DeconstructedOrigami", "::", "weights"}], "]"}], ";", " ", 
       "False"}]}], " ", "]"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "pos"}], "=", 
   "\"\<The positions do not correspond to the Mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "weights"}], "=", 
   "\"\<The weights must be positive numbers.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "defaultweight"}], "=", 
   "\"\<The default weight must be a positive number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "edges"}], "=", 
   "\"\<The left hand side of the rules must be well-formed edges.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeconstructedOrigami", "::", "weightrules"}], "=", 
   "\"\<Option \\\"edgeWeights\\\" must be a list of rules of the form edge \
-> positive weight.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7576]:=",ExpressionUUID->"a2cd35af-dbac-415c-ae7f-35b450b3699e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shrinkPolygon", "[", " ", 
    RowBox[{"pts_", ",", " ", "widths_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"pts", " ", "+", " ", 
    RowBox[{"Total", " ", "@", " ", 
     RowBox[{"MapIndexed", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"shrinkPolygonSide", "[", " ", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#1"}], " ", "]"}], 
        "&"}], ",", " ", "widths"}], " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"shrinkPolygonSide", "[", " ", 
   RowBox[{"pts_", ",", " ", "v1_", ",", " ", "width_"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "pts", "]"}]}], ",", " ", "v2", ",", " ", 
      "future", ",", " ", "past", ",", " ", "futureEdge", ",", " ", "edge", 
      ",", " ", "pastEdge"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"v2", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"future", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v2", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"past", " ", "=", " ", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "-", "1"}], ",", "n", ",", "1"}], "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{"edge", "=", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"futureEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "future", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"pastEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "past", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{"RotateRight", "[", 
      RowBox[{
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"width", "*", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"pastEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"pastEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"futureEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"futureEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"n", "-", "2"}]}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
       RowBox[{"v1", "-", "1"}]}], "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7585]:=",ExpressionUUID->"26dfeae0-7a2f-41aa-bacf-11526f181415"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7587]:=",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanisms`graphics", "Chapter",ExpressionUUID->"4e117d75-efd0-4fbb-9ab5-54303adb6974"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`graphics`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7589]:=",ExpressionUUID->"e14f7419-89e3-4783-9198-ab1d0a95c1b9"],

Cell[CellGroupData[{

Cell["usage", "Section",ExpressionUUID->"6034899b-68aa-4037-b918-fc414503a490"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AngleMarker", "::", "usage"}], "=", 
   "\"\<AngleMarker[m, {v1,v2,v3}, (radius) ] creates an arc around an angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AngleText", "::", "usage"}], "=", 
    "\"\<angleTest[m, {v1,v2,v3}, (distance) ] adds a text label to the angle \
spanning (v1,v2) to (v3,v2).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "usage"}], " ", "=", " ", 
   "\"\<MechanismPrimitives[ m, (positions) ] returns a list of Mechanism \
primitives.\>\""}], " ", ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ToGraphicsComplex", "::", "usage"}], " ", "=", " ", 
   "\"\<ToGraphicsComplex[ m, (positions) ] returns a GraphicsComplex object \
identical to MechanismPrimitives[].\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:10 \
In[7590]:=",ExpressionUUID->"2cf6321a-3523-4f5a-99bf-84c1ba3196fa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "usage"}], "=", 
   "\"\<PinnedJointShape[] is a triangular pinned joint in 2D.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "::", "usage"}], "=", 
   "\"\<SpringShape[] represents a Spring shape function with a particular \
thickness and number of jags.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "usage"}], "=", 
   "\"\<FreeJointShape[] represents a joint shape distinguishing pinned \
joints from free joints.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RigidBarShape", "::", "usage"}], "=", 
   "\"\<RigidBarShape[] represents the shape of a RigidBar\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FreeJointShape", "::", "usage"}], "=", 
   "\"\<FreeJointShape[] represents the shape of a free joint.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JointShape", "::", "usage"}], "=", 
   "\"\<JointShape[] represents the shape of a joint that is either free or \
pinned.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceShape", "::", "usage"}], "=", "\"\<FaceShape[]\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7594]:=",ExpressionUUID->"3cf79f62-832f-451c-8e21-d75c262e0170"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PlotMechanism", "::", "usage"}], "=", "\n", 
    "\"\<PlotMechanism[ Mechanism, positions ] plots a Mechanism using \
positions.\nPlotMechanism[Mechanism, {positions 1, positions 2,...}] creates \
a list of plotted Mechanisms with uniform size.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicPlotMechanism", "::", "usage"}], "=", 
   "\"\<PeriodicPlotMechanism[m], PeriodicPlotMechanism[m, positions] plots a \
periodic mechanism.\nPeriodicPlotMechanism[{m,pi}], PeriodicPlotMechanism[{m, \
pi}, positions] plots a periodic mechanism with periodic identification data \
pi.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7601]:=",ExpressionUUID->"fec2b29f-ac6a-4f61-b198-9ada7c9935e9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"StressStyle", "::", "usage"}], "=", 
   "\"\<StressStyle is an option for PlotMechanism to provide a style for \
plotting stresses.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementStyle", "::", "usage"}], "=", 
   "\"\<DisplacementStyle is an option for PlotMechanism to provide a style \
for plotting displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplacementScale", "::", "usage"}], "=", 
   "\"\<DisplacementScale is an option for PlotMechanism to provide an \
overall scale for displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DisplayDimension", "::", "usage"}], "=", 
   "\"\<DisplayDimension is an option for PlotMechanism to choose the \
dimension in which a mechanism should be displayed.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Displacements", "::", "usage"}], "=", 
   "\"\<Displacements is an option for PlotMechanism to display a vertex \
displacement overlaid with a mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Stresses", "::", "usage"}], "=", 
   "\"\<Stresses is an option for PlotMechanism to display stresses overlaid \
with a mechanism.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7603]:=",ExpressionUUID->"000feeec-bb30-48a8-8e9a-889f6914e183"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "::", "usage"}], "=", 
   "\"\<OrigamiTexture[ s ] returns a texture having the name s. Use \
$OrigamiTextures to see possible textures.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$OrigamiTextures", "::", "usage"}], "=", 
   "\"\<$OrigamiTextures returns a list of textures you can use in \
OrigamiTexture[] to texture the faces of origami.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7609]:=",ExpressionUUID->"e7452ff7-4a1b-486f-843f-361c8ea558a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "$MechanismThemes", " ", "=", " ", 
   "\"\<List of recognized graphics themes.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7611]:=",ExpressionUUID->"cf1d931e-3134-4092-81f5-c5441756f7b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "usage"}], "=", 
   "\"\<PlotConfigurationSpaceCurve[m, {p, d}, proj] draws a curve in the \
configuration space of a mechanism starting from p and in the direction d (or \
closest possible direction).\nproj must be a function taking a set of vertex \
positions to a 2D or 3D coordinates.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7612]:=",ExpressionUUID->"d9c3b9f4-d516-4b54-ab90-6bc37fc2e6dc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["global", "Section",ExpressionUUID->"0f8e42dc-5f2f-405a-b230-3b1f2fd2dc43"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`Origami`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:11 \
In[7613]:=",ExpressionUUID->"3298ad3f-9fe1-4719-b9e0-a54361a0a019"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$MechanismThemes", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Standard\>\"", " ", ",", " ", "\"\<Minimal\>\"", ",", " ", 
     "\"\<Thick\>\""}], "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7618]:=",ExpressionUUID->"52e422c9-ab38-4c95-acda-731019ee951e"],

Cell[CellGroupData[{

Cell["graphicsOrder[]", "Subsection",ExpressionUUID->"9c9358fe-ae55-4130-8e30-bd7fea587b1f"],

Cell["graphicsOrder[ cell head ] := # specifying order of plotting", "Text",ExpressionUUID->"f8b993bd-1846-4c7c-abe4-19c8590cef53"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", "AngleJoint", " ", "]"}], " ", ":=", " ",
   "3"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"PinnedJoint", "|", "FreeJoint", "|", "Point"}], " ", "]"}], ":=", 
  "2"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"RigidBar", "|", "Spring", "|", "Line", "|", "TorsionalFold"}], 
   " ", "]"}], ":=", "1"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOrder", "[", " ", 
   RowBox[{"Face", "|", "ElasticTriangle", "|", "Polygon"}], " ", "]"}], ":=",
   "0"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7619]:=",ExpressionUUID->"fd6b7c7f-e354-4bf8-8608-5101a71ab970"]
}, Closed]],

Cell[CellGroupData[{

Cell["defaultGraphicsPrimitive[], defaultGraphicsStyle[]", "Subsection",ExpressionUUID->"7e843407-88e6-42e6-a7fb-0d90b64f932d"],

Cell["\<\
Format for adding or modifying default primitives:

defaultGraphicsPrimitive[ primitive, Mechanism head, {coordinate dimension , \
requested embedding dimension}, theme ]
defaultGraphicsStyle[ primitive, Mechanism head, {coordinate dimension , \
requested embedding dimension}, theme ]\
\>", "Text",ExpressionUUID->"3c8f0d77-a834-4ff0-a98b-0ccc57bb7626"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "defaultGraphicsPrimitive", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", "defaultGraphicsStyle", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7623]:=",ExpressionUUID->"ee8b7113-b14d-4213-ad7b-659d235ebec6"],

Cell[CellGroupData[{

Cell["\[OpenCurlyDoubleQuote]Standard\[CloseCurlyDoubleQuote]", \
"Subsubsection",ExpressionUUID->"a1cb8e66-7329-4ded-baa9-cd3ec7b3c5c2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Line"}], " ", ",", " ", "Linkage", " ", ",", 
    " ", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2"}], "}"}], ",", " ", "\"\<Standard\>\""}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"RigidBarShape", "[", 
   RowBox[{"\"\<Width\>\"", " ", "->", " ", "0.05"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Line"}], " ", ",", " ", "Linkage", " ", ",", 
    " ", "_", ",", " ", "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"RigidBarShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"FreeJoint", " ", ",", " ", "Linkage", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2"}], "}"}], ",", " ", "\"\<Standard\>\""}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"FreeJointShape", "[", 
   RowBox[{"\"\<Diameter\>\"", " ", "->", " ", "0.05"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "FreeJoint", " ", ",", " ", "Linkage", " ", ",", " ", "_", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"FreeJointShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"PinnedJoint", " ", ",", " ", "Linkage", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2"}], "}"}], ",", " ", "\"\<Standard\>\""}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"PinnedJointShape", "[", 
   RowBox[{"\"\<Diameter\>\"", " ", "->", " ", "0.05"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "PinnedJoint", " ", ",", " ", "Linkage", " ", ",", " ", "_", " ", ",", 
    " ", "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"PinnedJointShape", "[", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7625]:=",ExpressionUUID->"027b3b50-2a56-414b-88df-99e274bbffdc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Line"}], " ", ",", " ", "Origami", " ", ",", 
    " ", "_", " ", ",", " ", "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "FreeJoint", " ", ",", " ", "Origami", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "PinnedJoint", " ", ",", " ", "Origami", " ", ",", " ", "_", " ", ",", 
    " ", "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "TorsionalFold", ",", " ", "Origami", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7631]:=",ExpressionUUID->"b995dbde-19fd-43a7-8c9c-83b25c9bdef5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "TorsionalFold", ",", " ", "Origami", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7635]:=",ExpressionUUID->"5dcd21f4-b835-4d4f-97af-91a02a3405bb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "Face", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"FaceShape", "[", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "ElasticTriangle", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<Thickness\>\"", "\[Rule]", "0.01"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "Polygon", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Polygon", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
   "Spring", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"SpringShape", "[", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7636]:=",ExpressionUUID->"7a12fd09-3023-4a6a-9142-c665dc720269"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"RigidBar", " ", ",", " ", "_", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2"}], "}"}], " ", ",", " ", "\"\<Standard\>\""}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"0.25", ",", "0.45", ",", "0.95"}], "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "RigidBar", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "FreeJoint", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"0.25", ",", "0.45", ",", "0.95"}], "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "PinnedJoint", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "Black", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "Face", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"GrayLevel", "[", "0.85", "]"}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "ElasticTriangle", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", 
   RowBox[{"RGBColor", "[", 
    RowBox[{"{", 
     RowBox[{"0.85", ",", "0.85", ",", "0.95"}], "}"}], "]"}], 
   "}"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "Spring", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", 
    "\"\<Standard\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7640]:=",ExpressionUUID->"d8bca12e-1c2f-46ca-bf1e-9fc6225c2a9b"]
}, Closed]],

Cell[CellGroupData[{

Cell["\[OpenCurlyDoubleQuote]Thick\[CloseCurlyDoubleQuote]", "Subsubsection",ExpressionUUID->"47b141fa-f895-4edc-9dc0-60d87ba3481f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
   "RigidBar", " ", ",", " ", "Linkage", ",", " ", "_", ",", " ", 
    "\"\<Thick\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"RigidBarShape", "[", 
   RowBox[{"\"\<Width\>\"", " ", "->", " ", "0.05"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], " ", ",", " ", 
    "Linkage", ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "3"}], "}"}], " ", ",", " ", "\"\<Thick\>\""}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<Thickness\>\"", "\[Rule]", "0.01"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", 
    RowBox[{
     RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], ",", " ", "Linkage", 
     ",", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", "3"}], "}"}], " ", ",", " ", 
     RowBox[{"\"\<Thick\>\"", "[", "thickness_", "]"}]}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"FaceShape", "[", 
    RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "thickness"}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "cell_", " ", ",", " ", "Linkage", " ", ",", " ", "d_", " ", ",", " ", 
    RowBox[{"\"\<Thick\>\"", " ", "|", " ", 
     RowBox[{"\"\<Thick\>\"", "[", "_", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"defaultGraphicsStyle", "[", 
   RowBox[{
   "cell", ",", " ", "Linkage", ",", " ", "d", ",", " ", "\"\<Standard\>\""}],
    " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7647]:=",ExpressionUUID->"9434bbe0-567d-4375-ac91-93e25ffa83ea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], ",", " ", "Origami", 
    ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "3"}], "}"}], " ", ",", " ", "\"\<Thick\>\""}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<Thickness\>\"", "\[Rule]", "0.01"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{
    RowBox[{"Face", " ", "|", " ", "ElasticTriangle"}], ",", " ", "Origami", 
    ",", " ", 
    RowBox[{"{", 
     RowBox[{"_", ",", "3"}], "}"}], " ", ",", " ", 
    RowBox[{"\"\<Thick\>\"", "[", "thickness_", "]"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"FaceShape", "[", 
   RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "thickness"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", " ", 
    RowBox[{"_", " ", ",", " ", "Origami", ",", " ", 
     RowBox[{"{", 
      RowBox[{"_", ",", "3"}], "}"}], ",", " ", 
     RowBox[{"\"\<Thick\>\"", "|", 
      RowBox[{"\"\<Thick\>\"", "[", "_", "]"}]}]}], " ", "]"}], " ", ":=", 
   " ", "None"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"cell_", " ", ",", " ", "Origami", ",", " ", 
    RowBox[{"{", 
     RowBox[{"d_", ",", "3"}], "}"}], ",", " ", 
    RowBox[{"\"\<Thick\>\"", "|", 
     RowBox[{"\"\<Thick\>\"", "[", "_", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"cell", ",", " ", "Origami", ",", " ", 
    RowBox[{"{", 
     RowBox[{"d", ",", "3"}], "}"}], ",", " ", "\"\<Standard\>\""}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7651]:=",ExpressionUUID->"6e3767b1-9e21-4dff-8f4e-b1b419c1b1b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", " ", 
    RowBox[{"cell_", " ", ",", " ", "Origami", " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"d_", ",", "2"}], "}"}], " ", ",", " ", 
     RowBox[{"\"\<Thick\>\"", " ", "|", " ", 
      RowBox[{"\"\<Thick\>\"", "[", "_", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"defaultGraphicsPrimitive", "[", 
    RowBox[{"cell", ",", " ", "Origami", ",", " ", 
     RowBox[{"{", 
      RowBox[{"d", ",", "2"}], "}"}], ",", " ", "\"\<Standard\>\""}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"cell_", " ", ",", " ", "Origami", " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"d_", ",", "2"}], "}"}], " ", ",", " ", 
    RowBox[{"\"\<Thick\>\"", " ", "|", " ", 
     RowBox[{"\"\<Thick\>\"", "[", "_", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"defaultGraphicsStyle", "[", 
   RowBox[{"cell", ",", " ", "Origami", ",", " ", 
    RowBox[{"{", 
     RowBox[{"d", ",", "2"}], "}"}], ",", " ", "\"\<Standard\>\""}], " ", 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7655]:=",ExpressionUUID->"dd5e9980-69bd-441c-8690-2ae9fd6577c5"]
}, Closed]],

Cell[CellGroupData[{

Cell["\[OpenCurlyDoubleQuote]Minimal\[CloseCurlyDoubleQuote]", "Subsubsection",ExpressionUUID->"471a8712-097f-4fd1-9518-c829ff43a184"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Spring", "|", "Line"}], ",", " ", "_", ",", " ",
     "_", " ", ",", " ", "\"\<Minimal\>\""}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", "|", "PinnedJoint", "|", "Point"}], ",", " ", "_", 
    ",", " ", "_", " ", ",", " ", "\"\<Minimal\>\""}], " ", "]"}], " ", ":=", 
  " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", " ", 
    RowBox[{
     RowBox[{"Face", "|", "ElasticTriangle", "|", "Polygon"}], ",", " ", "_", 
     ",", " ", "_", " ", ",", " ", "\"\<Minimal\>\""}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Polygon", "[", "#", "]"}], "&"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{
   "cell_", " ", ",", " ", "type_", " ", ",", " ", "dim_", " ", ",", " ", 
    "\"\<Minimal\>\""}], "]"}], " ", ":=", " ", 
  RowBox[{"defaultGraphicsStyle", "[", 
   RowBox[{
   "cell", ",", " ", "type", ",", " ", "dim", ",", " ", "\"\<Standard\>\""}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7657]:=",ExpressionUUID->"9f080a33-4031-4746-8c35-5a48091cda2e"]
}, Closed]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
some functions for extracting graphics information from Mechanisms\
\>", "Section",ExpressionUUID->"264055aa-257e-4658-8e88-c7a82054dd0f"],

Cell[CellGroupData[{

Cell["positionDimension[]", "Subsection",ExpressionUUID->"7263b898-abdd-4b74-bf48-8401d5363cb9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dimension", "[", " ", 
   RowBox[{"position_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"Length", "[", 
   RowBox[{"position", "[", 
    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"dimension", "[", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Max", "[", 
    RowBox[{"Length", " ", "/@", " ", 
     RowBox[{"positions", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"sameVertexNumberQ", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"position_", "?", "MatrixQ"}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}], " ", "\[Equal]", " ", 
   RowBox[{"Length", "[", "position", "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"sameVertexNumberQ", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "}"}], ",", " ", 
    RowBox[{"AllTrue", "[", 
     RowBox[{
      RowBox[{"Length", " ", "/@", " ", "positions"}], " ", ",", " ", 
      RowBox[{
       RowBox[{"#", "\[Equal]", "n"}], "&"}]}], " ", "]"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"sameVertexNumberQ", "[", " ", 
    RowBox[{"m_", ",", " ", "Automatic"}], " ", "]"}], " ", ":=", " ", 
   "True"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"flatEnoughQ", "[", " ", 
   RowBox[{"position_", "?", "MatrixQ"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"Chop", "[", " ", 
    RowBox[{"Max", "[", " ", 
     RowBox[{"Abs", "[", " ", 
      RowBox[{"position", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "3"}], "]"}], "]"}], " ", "]"}], " ", "]"}], " ", 
    "]"}], " ", "\[Equal]", " ", "0"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"flatEnoughQ", "[", " ", 
    RowBox[{"positions", ":", " ", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"Chop", "[", " ", 
     RowBox[{"Max", "[", " ", 
      RowBox[{"Abs", "[", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"positions", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "All", ",", "3"}], "]"}], "]"}], "]"}], " ", 
       "]"}], " ", "]"}], " ", "]"}], " ", "\[Equal]", " ", "0"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"recastDimension", "[", " ", 
   RowBox[{
    RowBox[{"position_", "?", "MatrixQ"}], " ", ",", " ", "dim_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"position", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Length", "[", "position", "]"}], ",", "dim"}], "}"}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"recastDimension", "[", " ", 
   RowBox[{
    RowBox[{"position", ":", 
     RowBox[{"{", 
      RowBox[{"__", "?", "MatrixQ"}], "}"}]}], " ", ",", " ", "dim_"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"PadRight", "[", 
   RowBox[{"position", ",", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Length", "[", "position", "]"}], ",", 
      RowBox[{"Length", "[", 
       RowBox[{"position", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "dim"}], "}"}]}], 
   "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7661]:=",ExpressionUUID->"987031ba-a53c-4f11-a7e4-bcab36c04d09"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "put", " ", "the", " ", "dimensions", " ", "of", " ", "the", " ", 
    "coordinates", " ", "in", " ", "the", " ", "requested", " ", 
    "dimension"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"positionDimension", "[", " ", 
     RowBox[{"m_", ",", " ", "Automatic", ",", " ", "dim_"}], " ", "]"}], ":=",
     "\n", "\t", 
    RowBox[{"Switch", "[", " ", 
     RowBox[{"dim", ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
          "3"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", 
          "2"}]}], ",", "\n", "\t\t\t\t", 
        RowBox[{"recastDimension", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", "2"}], 
         "]"}], ",", "\n", "\t\t\t\t", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "\n", 
       "\t\t\t", "]"}], ",", "\n", "\t\t", "2", ",", " ", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "\[Equal]", 
          "3"}], " ", "&&", " ", 
         RowBox[{"Not", "@", 
          RowBox[{"flatEnoughQ", "[", 
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}]}], 
        ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"Mechanism", "::", "notflat"}], "]"}], ";", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], ",", "\n", 
        "\t\t\t", 
        RowBox[{"recastDimension", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", "2"}], 
         "]"}]}], "\n", "\t\t\t", "]"}], ",", "\n", "\t\t", "3", ",", " ", 
      RowBox[{"recastDimension", "[", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", "3"}], 
       "]"}], ",", "\n", "\t\t", "_", ",", " ", "$Failed"}], "\n", "\t", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"positionDimension", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"positions", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", "VertexCoordinatesQ"}], "|", 
        RowBox[{"{", 
         RowBox[{"__", "?", "VertexCoordinatesQ"}], "}"}]}]}], ",", " ", 
      "dim_"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{
     RowBox[{"Switch", "[", " ", 
      RowBox[{"dim", ",", "\n", "\t\t", "Automatic", ",", "\n", "\t\t\t", 
       RowBox[{"recastDimension", "[", " ", 
        RowBox[{"positions", ",", " ", 
         RowBox[{"dimension", "[", "positions", "]"}]}], " ", "]"}], ",", 
       "\n", "\t\t", "2", ",", "\n", "\t\t\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"dimension", "[", "positions", "]"}], " ", "\[Equal]", " ",
            "3"}], " ", "&&", " ", 
          RowBox[{"Not", "@", 
           RowBox[{"flatEnoughQ", "[", "positions", "]"}]}]}], ",", "\n", 
         "\t\t\t\t", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"Mechanism", "::", "notflat"}], "]"}], ";", "\n", 
          "\t\t\t\t", 
          RowBox[{"recastDimension", "[", " ", 
           RowBox[{"positions", ",", " ", "3"}], "]"}]}], ",", "\n", 
         "\t\t\t\t", 
         RowBox[{"recastDimension", "[", " ", 
          RowBox[{"positions", ",", " ", "2"}], "]"}]}], "\n", "\t\t\t", 
        "]"}], ",", "\n", "\t\t", "3", ",", " ", 
       RowBox[{"recastDimension", "[", " ", 
        RowBox[{"positions", ",", " ", "3"}], "]"}], ",", "\n", "\t\t", "_", 
       ",", " ", "$Failed"}], "\n", "\t", "]"}], " ", "/;", " ", 
     RowBox[{"sameVertexNumberQ", "[", " ", 
      RowBox[{"m", ",", " ", "positions"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"positionDimension", "[", " ", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"positions", " ", ":", " ", 
       RowBox[{
        RowBox[{"_", "?", "VertexCoordinatesQ"}], "|", 
        RowBox[{"{", 
         RowBox[{"__", "?", "VertexCoordinatesQ"}], "}"}]}]}], ",", " ", 
      "dim_"}], " ", "]"}], ":=", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"Mechanism", "::", "vn"}], ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], " ", "]"}], ";", 
      " ", "$Failed"}], ")"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7670]:=",ExpressionUUID->"4df19566-3b22-4178-9883-43f4afe6f65f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "notflat"}], " ", "=", " ", 
   "\"\<Cannot project a fully 3D Mechanism into 2D.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Mechanism", "::", "vn"}], " ", "=", " ", 
   "\"\<Number of vertices `1` does not agree with number of vertex \
positions.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7673]:=",ExpressionUUID->"de3fa5c5-4fe7-44c1-9fce-7504364314cd"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismPrimitives[]", "Subsection",ExpressionUUID->"180e9407-b203-4d4a-b001-0e9302edeaaf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"RigidBar", "|", "Spring", "|", "Line"}], ",", " ", "_", ",", " ",
     "_", " ", ",", " ", "None"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Line", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", " ", 
   RowBox[{
    RowBox[{"FreeJoint", "|", "PinnedJoint", "|", "Point"}], ",", " ", "_", 
    ",", " ", "_", " ", ",", " ", "None"}], "]"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Point", "[", "#", "]"}], "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"defaultGraphicsPrimitive", "[", " ", 
    RowBox[{
     RowBox[{"Face", "|", "ElasticTriangle", "|", "Polygon"}], ",", " ", "_", 
     ",", " ", "_", " ", ",", " ", "None"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Polygon", "[", "#", "]"}], "&"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsPrimitive", "[", 
   RowBox[{"_", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", "_"}], 
   " ", "]"}], " ", ":=", " ", "None"}], "\n", 
 RowBox[{
  RowBox[{"defaultGraphicsStyle", "[", " ", 
   RowBox[{"_", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", "_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7675]:=",ExpressionUUID->"ba5b6647-f0b2-4b99-b15f-99f62fcaeb60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"translating", " ", "different", " ", "themes"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"themesQ", "[", 
     RowBox[{"m_", ",", " ", "Automatic"}], "]"}], " ", ":=", " ", 
    "\"\<Standard\>\""}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"themesQ", "[", 
      RowBox[{"m_", ",", "theme_"}], " ", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Length", "[", "theme", "]"}], "\[Equal]", "0"}]}], " ", ":=", 
    " ", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"MemberQ", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"$MechanismThemes", ",", "None"}], "}"}], "]"}], ",", " ", 
         "theme"}], " ", "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MechanismPrimitives", "::", "theme"}], ",", " ", "theme"}], 
        "]"}], ";", " ", "\"\<Standard\>\""}], " ", ",", " ", "theme"}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"themesQ", "[", 
     RowBox[{"m_", ",", " ", "theme_"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{"Not", "@", 
       RowBox[{"MemberQ", "[", "  ", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"$MechanismThemes", ",", "None"}], "}"}], "]"}], ",", " ", 
         
         RowBox[{"Head", "[", "theme", "]"}]}], " ", "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MechanismPrimitives", "::", "theme"}], ",", " ", "theme"}], 
        "]"}], ";", " ", "\"\<Standard\>\""}], " ", ",", " ", "theme"}], 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismPrimitives", "::", "theme"}], "=", 
     "\"\<`1` is not a valid theme. Use $MechanismThemes to see what is \
possible.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7680]:=",ExpressionUUID->"585395bf-edd0-4922-be90-cf3dd9378903"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"graphicsOrder", "[", " ", "_", " ", "]"}], ":=", "4"}], "\n", 
  "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"sortComponentsForGraphics", "[", "]"}], " ", "sorts", " ", "a", 
    " ", "list", " ", "of", " ", "components", " ", "in", " ", "dimensional", 
    " ", 
    RowBox[{"order", "."}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"sortComponentsForGraphics", "[", " ", "components_", " ", "]"}], 
  " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"SortBy", "[", 
    RowBox[{
     RowBox[{"DeleteCases", "[", "\n", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"graphicsOrder", "[", 
            RowBox[{"Head", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], " ", ",", " ", 
           "#"}], " ", "}"}], "&"}], " ", "/@", " ", "components"}], ",", 
       "\n", "\t\t", 
       RowBox[{"{", 
        RowBox[{"4", ",", "_"}], "}"}]}], "\n", "\t", "]"}], ",", "First"}], 
    "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7684]:=",ExpressionUUID->"511a5fd5-e74f-4419-bf75-8c444440d319"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismPrimitives", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"PlotTheme", "\[Rule]", "Automatic"}], "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pos", "=", 
      RowBox[{"positionDimension", "[", 
       RowBox[{"m", ",", " ", "Automatic", ",", " ", "dimension"}], "]"}]}], 
     "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"mechanismPrimitivesInternal", "[", " ", 
      RowBox[{"m", ",", " ", "pos", ",", " ", 
       RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", ",", " ", 
       RowBox[{"themesQ", "[", 
        RowBox[{"m", ",", 
         RowBox[{"OptionValue", "[", "PlotTheme", "]"}]}], "]"}]}], " ", 
      "]"}], " ", "/;", " ", 
     RowBox[{"pos", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
       RowBox[{"positions_", "?", "NumericCoordinatesQ"}]}], "]"}], ",", " ", 
     
     RowBox[{"dimension", " ", ":", " ", 
      RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}],
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"pos", "=", 
       RowBox[{"positionDimension", "[", 
        RowBox[{"m", ",", " ", "positions", ",", " ", "dimension"}], "]"}]}], 
      "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"mechanismPrimitivesInternal", "[", " ", 
       RowBox[{"m", ",", " ", "pos", ",", " ", "positions", ",", " ", 
        RowBox[{"themesQ", "[", 
         RowBox[{"m", ",", 
          RowBox[{"OptionValue", "[", "PlotTheme", "]"}]}], "]"}]}], " ", 
       "]"}], " ", "/;", " ", 
      RowBox[{"pos", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "NumericCoordinatesQ"}]}], "]"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"MechanismPrimitives", "::", "coord"}], ",", " ", 
     RowBox[{"Length", "[", "positions", "]"}], ",", " ", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"MechanismPrimitives", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "NumericCoordinatesQ"}]}], "]"}], ",", " ", 
    "dimension_", " ", ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{"MechanismPrimitives", "::", "dim"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "[", " ", 
    RowBox[{
     RowBox[{"Deformed", "[", " ", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
       RowBox[{"positions_", "?", "VertexCoordinatesQ"}]}], "]"}], ",", " ", 
     RowBox[{"dimension", " ", ":", " ", 
      RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}],
      " ", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"Message", "[", 
     RowBox[{"MechanismPrimitives", "::", "num"}], "]"}]}]}], "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "coord"}], " ", "=", " ", 
   "\"\<Number of vertices in second argument, `1`, does not match number of \
vertices in Mechanism, `2`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "dim"}], " ", "=", " ", 
   "\"\<Number of dimensions requested is not 2, 3, or Automatic.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismPrimitives", "::", "num"}], " ", "=", " ", 
   "\"\<Vertices should be numeric.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7686]:=",ExpressionUUID->"475af5c7-e1c8-4503-81f4-44acaf834316"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPrimitivesInternal", "[", " ", 
    RowBox[{
    "m_", ",", " ", "positions_", " ", ",", " ", "actualPositions_", ",", " ",
      "theme_"}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Transpose", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"mechanismPrimitivesFromComponent", "[", " ", 
       RowBox[{
       "m", ",", " ", "positions", ",", " ", "#", " ", ",", " ", "theme"}], 
       "]"}], "&"}], " ", "/@", " ", 
     RowBox[{"sortComponentsForGraphics", "[", " ", 
      RowBox[{"MechanismCellData", "[", " ", 
       RowBox[{
        RowBox[{"PlaceVertices", "[", 
         RowBox[{"m", ",", "actualPositions"}], "]"}], ",", " ", "_"}], " ", 
       "]"}], " ", "]"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"mechanismPrimitivesFromComponent", "[", " ", 
    RowBox[{"m_", ",", " ", "positions_", ",", " ", 
     RowBox[{"Rule", "[", 
      RowBox[{
       RowBox[{"head_", "[", " ", "indices_", " ", "]"}], ",", " ", 
       "display_"}], " ", "]"}], " ", ",", " ", "theme_"}], "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"coordinates", " ", "=", " ", 
        RowBox[{"ToPackedArray", "[", 
         RowBox[{"N", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"positions", "[", 
             RowBox[{"[", " ", "#", " ", "]"}], "]"}], " ", "&"}], " ", "/@", 
           " ", "indices"}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"dimensionData", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}], ",", " ", 
          RowBox[{"Length", "[", "indices", "]"}]}], "]"}]}], ",", "\n", "\n",
        "\t", 
       RowBox[{"componentData", " ", "=", " ", 
        RowBox[{"If", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "display", "]"}], ">", "3"}], ",", " ", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Drop", "[", 
            RowBox[{
             RowBox[{"Values", "[", "display", "]"}], ",", 
             RowBox[{"-", "3"}]}], "]"}], "]"}], ",", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", "}"}], ",", 
            RowBox[{"Length", "[", "indices", "]"}]}], "]"}]}], " ", "]"}]}], 
       ",", "\n", "\t", 
       RowBox[{"componentDataType", "=", 
        RowBox[{"ConstantArray", "[", " ", 
         RowBox[{
          RowBox[{"Drop", "[", 
           RowBox[{
            RowBox[{"Keys", "[", "display", "]"}], ",", 
            RowBox[{"-", "3"}]}], "]"}], ",", " ", 
          RowBox[{"Length", "[", "indices", "]"}]}], "]"}]}], ",", "\n", "\n",
        "\t", 
       RowBox[{"style", " ", "=", " ", 
        RowBox[{"Mechanisms`Private`combineDataList", "[", " ", 
         RowBox[{
          RowBox[{"defaultGraphicsStyle", "[", 
           RowBox[{"head", ",", " ", 
            RowBox[{"Head", "[", "m", "]"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"positions", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
              RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], "}"}], 
            ",", " ", "theme"}], "]"}], " ", ",", " ", 
          RowBox[{"display", "[", "\"\<Style\>\"", "]"}]}], "]"}]}], ",", 
       "\n", "\t", 
       RowBox[{"labels", " ", "=", " ", 
        RowBox[{"display", "[", "\"\<Label\>\"", "]"}]}], ",", "\n", "\t", 
       RowBox[{"shapeFunction", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"display", "[", "\"\<Shape\>\"", "]"}], " ", "/.", " ", 
          RowBox[{"{", 
           RowBox[{"Automatic", " ", "\[Rule]", " ", 
            RowBox[{"defaultGraphicsPrimitive", "[", 
             RowBox[{"head", ",", " ", 
              RowBox[{"Head", "[", "m", "]"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"positions", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], 
               "}"}], ",", "theme"}], "]"}]}], "}"}]}], " ", "/.", " ", 
         RowBox[{"{", " ", 
          RowBox[{"None", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], " ", "}"}]}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"MapThread", "[", 
        RowBox[{"applyFunction", " ", ",", "\n", "\t\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
           "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
            " ", 
            RowBox[{"m", ",", " ", 
             RowBox[{"N", "[", "positions", "]"}], ",", " ", "style"}], "]"}],
            " ", ",", "\n", "\t\t\t", 
           RowBox[{
           "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
            " ", 
            RowBox[{"m", ",", " ", 
             RowBox[{"N", "[", "positions", "]"}], ",", " ", 
             "shapeFunction"}], "]"}], " ", ",", "\n", "\t\t\t", 
           "coordinates", ",", " ", "\n", "\t\t\t", "dimensionData", ",", 
           "\n", "\t\t\t", "componentDataType", ",", "\n", "\t\t\t", 
           "componentData", ",", "\n", "\t\t\t", 
           RowBox[{"head", " ", "/@", " ", "indices"}]}], "\n", "\t\t\t", 
          "}"}]}], "\n", "\t\t", "]"}], ",", "\n", "\n", "\t\t", 
       RowBox[{"Flatten", " ", "@", " ", 
        RowBox[{"MapThread", "[", 
         RowBox[{"applyLabel", ",", "\n", "\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"If", "[", " ", 
             RowBox[{
              RowBox[{"MatrixQ", "[", "coordinates", "]"}], ",", " ", 
              "coordinates", ",", " ", 
              RowBox[{"Mean", " ", "/@", " ", "coordinates"}]}], " ", "]"}], 
            ",", "\n", "\t\t\t", "indices", ",", "\n", "\t\t\t", "labels"}], 
           "\n", "\t\t\t", "}"}]}], "\n", "\t\t", "]"}]}]}], "\n", "\t", 
      "}"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"$textOffset", " ", "=", " ", "0.05"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", "None"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "label_", ",", " ", "\"\<Index\>\""}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"Text", "[", 
   RowBox[{"label", ",", " ", 
    RowBox[{"coordinates", " ", "+", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"$textOffset", ",", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}]}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"applyLabel", "[", " ", 
   RowBox[{"coordinates_", ",", " ", "_", ",", " ", "lab_"}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{
   RowBox[{"Text", "[", " ", 
    RowBox[{"lab", ",", " ", 
     RowBox[{"coordinates", " ", "+", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"$textOffset", ",", 
        RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}]}], " ", "]"}], 
   " ", "/;", " ", 
   RowBox[{
    RowBox[{"Head", "[", "lab", "]"}], " ", "=!=", " ", "Text"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"applyLabel", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "_", ",", " ", 
     RowBox[{"Text", "[", 
      RowBox[{"lab_", ",", " ", "coord_", ",", " ", "other___"}], "]"}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{"Text", "[", " ", 
    RowBox[{"lab", ",", " ", 
     RowBox[{"coord", " ", "+", " ", "coordinates"}], ",", " ", "other"}], 
    " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"applyFunction", "[", " ", 
   RowBox[{
   "style_", " ", ",", " ", "None", ",", " ", "coordinates_", ",", " ", 
    "dimensionData_", ",", " ", "componentDataType_", ",", " ", 
    "componentData_", ",", " ", "primitive_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"applyFunction", "[", " ", 
   RowBox[{
   "style_", " ", ",", " ", "shapeFunction_", ",", " ", "coordinates_", ",", 
    "  ", "dimensionData_", ",", " ", "componentDataType_", ",", " ", 
    "componentData_", " ", ",", " ", "primitive_"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"rules", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{"componentDataType", " ", "->", " ", "componentData"}], 
       "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"Flatten", "[", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"style", " ", "/.", " ", "rules"}], ",", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"shapeFunction", " ", "/.", "rules"}], ")"}], "[", 
        RowBox[{
        "coordinates", ",", " ", "primitive", ",", " ", "dimensionData", ",", 
         " ", "componentData", ",", " ", "componentDataType"}], "]"}]}], 
      "}"}], " ", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7695]:=",ExpressionUUID->"36d192d4-81bd-4706-ab71-98a7e1bbfd1e"]
}, Closed]],

Cell[CellGroupData[{

Cell["ToGraphicsComplex[]", "Subsection",ExpressionUUID->"999e6f09-3bf2-414c-b3fc-0ebce2164f6e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ToGraphicsComplex", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Options", "[", "GraphicsComplex", "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"PlotTheme", "\[Rule]", "Automatic"}], "}"}]}], "]"}]}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{"ToGraphicsComplex", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{"res", "=", 
      RowBox[{"ToGraphicsComplexInternal", "[", " ", 
       RowBox[{"m", ",", " ", 
        RowBox[{"positionDimension", "[", 
         RowBox[{"m", ",", " ", "Automatic", ",", " ", "dimension"}], "]"}], 
        ",", " ", 
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", "\n", "\t",
         "dimension", ",", " ", 
        RowBox[{"OptionValue", "[", "PlotTheme", "]"}], ",", " ", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opt", "}"}], ",", 
          RowBox[{"Options", "[", "GraphicsComplex", "]"}]}], "]"}]}], " ", 
       "]"}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ToGraphicsComplex", "[", " ", 
   RowBox[{
    RowBox[{"Deformed", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
      RowBox[{"positions_", "?", "VertexCoordinatesQ"}]}], " ", "]"}], ",", 
    " ", 
    RowBox[{"dimension", " ", ":", " ", 
     RowBox[{"2", "|", "3", "|", "Automatic"}], " ", ":", " ", "Automatic"}], 
    ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"ToGraphicsComplexInternal", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"positionDimension", "[", 
          RowBox[{"m", ",", " ", "positions", ",", " ", "dimension"}], "]"}], 
         ",", " ", "positions", ",", " ", "\n", "\t", "dimension", ",", " ", 
         RowBox[{"OptionValue", "[", "PlotTheme", "]"}], ",", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "GraphicsComplex", "]"}]}], "]"}]}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", " ", "]"}], " ", 
   "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", "positions", "]"}], " ", "\[Equal]", " ", 
    RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7704]:=",ExpressionUUID->"4527b9b8-c59b-40fe-ac46-8b880e1d29af"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"canonicalizePrimitiveRules", " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"p", " ", ":", " ", 
        RowBox[{"_Polyhedron", "|", "_Parallelepiped", "|", "_Cuboid"}]}], 
       " ", "\[RuleDelayed]", " ", 
       RowBox[{"CanonicalizePolyhedron", "[", "p", "]"}]}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"p", " ", ":", " ", "_Polygon"}], " ", "\[RuleDelayed]", " ", 
       RowBox[{"CanonicalizePolygon", "[", "p", "]"}]}]}], "\n", "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"extractVertexCoordinates", "[", "primitives_", "]"}], " ", ":=", 
  " ", "\n", 
  RowBox[{"DeleteDuplicates", "[", "\n", "\t", 
   RowBox[{
    RowBox[{"Flatten", "[", " ", 
     RowBox[{
      RowBox[{"Cases", "[", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", "primitives", "]"}], " ", ",", 
        RowBox[{
         RowBox[{"_", "?", "RegionQ"}], "|", "_Text"}]}], "]"}], " ", "/.", 
      " ", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"p_Polygon", " ", "\[RuleDelayed]", " ", 
         RowBox[{"(", 
          RowBox[{"Point", " ", "/@", " ", 
           RowBox[{"PolygonCoordinates", "[", "p", "]"}]}], ")"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"p_Polyhedron", " ", "\[RuleDelayed]", " ", 
         RowBox[{"(", 
          RowBox[{"Point", " ", "/@", " ", 
           RowBox[{"PolyhedronCoordinates", "[", "p", "]"}]}], ")"}]}], ",", 
        "\n", "\t\t", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"p_", " ", "/;", " ", 
           RowBox[{"RegionQ", "[", "p", "]"}]}], ")"}], " ", "\[RuleDelayed]",
          " ", 
         RowBox[{"If", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"Dimensions", "[", " ", 
              RowBox[{"p", "[", 
               RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "]"}], " ", 
            "\[Equal]", " ", "1"}], ",", " ", 
           RowBox[{"Point", "[", 
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", ",", " ", 
           RowBox[{"Point", "/@", 
            RowBox[{"p", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], " ", "]"}]}], ",", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"_", ",", "p_", ",", "___"}], "]"}], " ", "\[RuleDelayed]", 
         " ", 
         RowBox[{"Point", "[", "p", "]"}]}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"_", ",", "x_", ",", "y_", ",", "___"}], "]"}], " ", 
         "\[RuleDelayed]", " ", 
         RowBox[{"Point", "[", 
          RowBox[{"x", "+", "y"}], "]"}]}]}], "\n", "\t", "}"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "1"}], "]"}], "]"}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7707]:=",ExpressionUUID->"f4924735-3c86-45f4-9002-8e27c84aebac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToGraphicsComplexInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "positions_", ",", " ", "actualPositions_", ",", " ", 
    "dimension_", ",", " ", "theme_", ",", " ", "options_"}], " ", "]"}], " ",
   ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "prims", ",", " ", "modifiedPrimitives", ",", " ", "coordinates", ",", 
      " ", "coordinateRules", ",", " ", "x"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"prims", " ", "=", " ", 
      RowBox[{
       RowBox[{"mechanismPrimitivesInternal", "[", 
        RowBox[{
        "m", " ", ",", " ", "positions", ",", " ", "actualPositions", " ", 
         ",", " ", 
         RowBox[{"themesQ", "[", 
          RowBox[{"m", ",", "theme"}], "]"}]}], " ", "]"}], " ", "/.", " ", 
       "canonicalizePrimitiveRules"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "prims", "]"}], " ", "===", " ", 
        "MechanismPrimitives"}], ",", "\n", "\t\t", "$Failed", ",", "\n", 
       "\n", "\t\t", 
       RowBox[{
        RowBox[{"coordinates", "=", 
         RowBox[{"extractVertexCoordinates", "[", "prims", "]"}]}], ";", "\n",
         "\t\t", 
        RowBox[{"coordinateRules", " ", "=", " ", 
         RowBox[{"Dispatch", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{"coordinates", " ", "\[Rule]", " ", 
            RowBox[{"Range", "[", 
             RowBox[{"Length", "[", "coordinates", "]"}], "]"}]}], "]"}], 
          "]"}]}], ";", "\n", "\n", "\t\t", 
        RowBox[{"modifiedPrimitives", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"prims", " ", "/.", " ", 
            RowBox[{"{", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"Polygon", "[", 
                RowBox[{"x_", ",", "y_"}], "]"}], " ", "\[RuleDelayed]", " ", 
               
               RowBox[{"Polygon", "[", " ", 
                RowBox[{"x", "[", 
                 RowBox[{"[", "y", "]"}], "]"}], "  ", "]"}]}], ",", "\n", 
              "\t\t\t", 
              RowBox[{
               RowBox[{"Polyhedron", "[", 
                RowBox[{"x_", ",", "y_"}], "]"}], " ", "\[RuleDelayed]", " ", 
               
               RowBox[{"Polyhedron", "[", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"x", "[", 
                   RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "y"}], " ", 
                "]"}]}]}], "\n", "\t\t", "}"}]}], " ", "/.", " ", 
           "coordinateRules"}], " ", "/.", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"CanonicalizePolyhedron", "[", 
              RowBox[{"Polyhedron", "[", "x_", "]"}], "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Polyhedron", "[", "x", "]"}]}], ",", 
            RowBox[{
             RowBox[{"CanonicalizePolygon", "[", 
              RowBox[{"Polygon", "[", "x_", "]"}], "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Polygon", "[", "x", "]"}]}]}], "}"}]}]}], ";", "\n", 
        "\n", "\t\t", 
        RowBox[{"GraphicsComplex", "[", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{
         "coordinates", ",", "\n", "\t\t\t", "modifiedPrimitives", ",", "\n", 
          "\t\t\t", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", " ", 
            RowBox[{"options", ",", 
             RowBox[{
             "VertexTextureCoordinates", " ", "\[Rule]", " ", 
              "coordinates"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", 
         "\t\t", "]"}]}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7709]:=",ExpressionUUID->"e79c1415-df48-46af-8022-f0d3c2db1b85"]
}, Closed]],

Cell[CellGroupData[{

Cell["OrigamiTexture[], $OrigamiTextures", "Subsection",ExpressionUUID->"9b4913e6-0b4a-4a08-b7bd-200f6bcf7b03"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$OrigamiTextures", "=", " ", 
    RowBox[{"{", " ", 
     RowBox[{
     "\"\<WhitePaper\>\"", ",", " ", "\"\<GrayPaper\>\"", ",", " ", 
      "\"\<WrinkledPaper\>\""}], " ", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"$dataDirectory", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "@", 
          RowBox[{"PacletFind", "[", "\"\<Mechanisms\>\"", "]"}]}], ")"}], 
        "[", "\"\<Location\>\"", "]"}], ",", "\"\<Resources\>\"", ",", 
       "\"\<Textures\>\""}], "}"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", ":=", 
  " ", 
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<WrinkledPaper\>\"", "]"}], " ", "=", 
   " ", 
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<crinkled-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "\"\<WhitePaper\>\"", "]"}], " ", ":=", " ", 
  
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<WhitePaper\>\"", "]"}], " ", "=", " ", 
   
   RowBox[{"Texture", " ", "@", " ", 
    RowBox[{"Normal", "[", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{"$dataDirectory", ",", "\"\<white-paper.jpg\>\""}], "}"}], 
       "]"}], "]"}], "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "[", "\"\<GrayPaper\>\"", "]"}], " ", ":=", " ", 
   
   RowBox[{
    RowBox[{"OrigamiTexture", "[", "\"\<GrayPaper\>\"", "]"}], " ", "=", " ", 
    
    RowBox[{"Texture", " ", "@", " ", 
     RowBox[{"Normal", "[", 
      RowBox[{"Import", "[", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"$dataDirectory", ",", "\"\<blue-paper.jpeg\>\""}], "}"}], 
        "]"}], "]"}], "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OrigamiTexture", "::", "bad"}], "=", 
   "\"\<Unrecognized texture `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"OrigamiTexture", "[", "s_", "]"}], " ", ":=", " ", 
  RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
   RowBox[{"Message", "[", 
    RowBox[{
     RowBox[{"OrigamiTexture", "::", "bad"}], ",", " ", "s"}], 
    "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7710]:=",ExpressionUUID->"d1ae3a0e-0030-4f1a-8eb0-962b8b6b9f9a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["graphics elements", "Section",ExpressionUUID->"efa38391-2c04-4250-a9ce-7f700dc2e797"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"coordinate2D", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "?", "NumericQ"}], ",", " ", 
     RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinate3D", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_", "?", "NumericQ"}], ",", 
     RowBox[{"_", "?", "NumericQ"}], ",", 
     RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"meshAccessQ", "=", 
   RowBox[{"_Integer", "|", 
    RowBox[{"{", "__Integer", "}"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"plotAccessQ", "=", 
   RowBox[{"_Line", "|", "_Point", "|", "_Polygon"}]}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7717]:=",ExpressionUUID->"c7b53360-ca73-4d43-a302-859f8055c0aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"coordinate2DQ", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "#", "]"}], "==", "2"}]}], "&"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"coordinate3DQ", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorQ", "[", 
      RowBox[{"#", ",", "NumericQ"}], "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "#", "]"}], "==", "3"}]}], "&"}]}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:11 \
In[7721]:=",ExpressionUUID->"5f25bd59-6819-41cd-a8e4-4edaba4dea77"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"edgeCellPattern", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"(", 
     RowBox[{"Blank", " ", "/@", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "Line", "}"}], ",", "Mechanisms`Private`edgeCells"}], 
       "]"}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"vertexCellPattern", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"(", 
     RowBox[{"Blank", " ", "/@", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "Point", "}"}], ",", "Mechanisms`Private`vertexCells"}], 
       "]"}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"faceCellPattern", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"(", 
     RowBox[{"Blank", " ", "/@", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "Polygon", "}"}], ",", "Mechanisms`Private`faceCells"}], 
       "]"}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"angleCellPattern", " ", "=", " ", 
   RowBox[{"Alternatives", "@@", 
    RowBox[{"(", 
     RowBox[{"Blank", " ", "/@", " ", "Mechanisms`Private`angleCells"}], 
     ")"}]}]}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7723]:=",ExpressionUUID->"438a5c06-e32f-439f-a52a-4993a1443a04"],

Cell["These functions all take the following arguments:", "Text",ExpressionUUID->"4f6e93c9-f4a8-4076-a796-3780d86b8886"],

Cell["\<\
\tshapefunction[ options ][ {v1, v2, ...}, cell, embedding dimension , data ]\
\
\>", "Text",ExpressionUUID->"a322905f-0464-465c-87bf-a882cd23fbe7"],

Cell["\<\
where {v1, v2, ...} are the list of vertex locations. The embedding dimension \
is the original embedding dimension whereas the vertices will be in whatever \
dimension the user wants to plot in.\
\>", "Text",ExpressionUUID->"56aae6d3-a747-446b-94f6-f08a5da92e0a"],

Cell[CellGroupData[{

Cell["RigidBarShape[]", "Subsection",ExpressionUUID->"30beb824-411a-4da9-84d9-c2ad57b065a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RigidBarShape", "]"}], " ", "=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Width\>\"", " ", "\[Rule]", " ", "0.01"}], ",", "\n", "\t", 
     
     RowBox[{"\"\<MiddleWidth\>\"", " ", "->", " ", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "->", " ", "0.025"}], ",", "\n", "\t", 
     
     RowBox[{"\"\<EndOffset\>\"", " ", "->", " ", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<HeightOffset\>\"", " ", "->", " ", "0"}]}], "\t", "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7727]:=",ExpressionUUID->"00471e94-dc32-4777-a8a8-0f8d241e12c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "any", " ", "embedding", " ", "dimension", " ", "and", " ", "2", "D", " ", 
    "display", " ", "dimension"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "[", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x_", "?", "coordinate2DQ"}], ",", " ", 
        RowBox[{"y_", "?", "coordinate2DQ"}]}], "}"}], " ", ",", " ", 
      "edgeCellPattern", " ", ",", " ", 
      RowBox[{"2", "|", "3"}], " ", ",", " ", "___"}], " ", "]"}], " ", ":=", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"length", " ", "=", " ", 
         RowBox[{"Norm", "[", 
          RowBox[{"y", "-", "x"}], "]"}]}], ",", " ", 
        RowBox[{"dir", " ", "=", " ", 
         RowBox[{"Normalize", "[", 
          RowBox[{"y", "-", "x"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"middleWidth", " ", "=", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<MiddleWidth\>\"", "]"}], " ", "+", 
          " ", 
          RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}]}], ",", "\n", 
        "\t", 
        RowBox[{"endWidth", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"endOffset", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<EndOffset\>\"", "]"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"EdgeForm", "[", "None", "]"}], ",", "\n", "\t\t", 
         RowBox[{"polygonShape", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], ",", " ", "length", ",", " ", 
           "dir", ",", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}], " ", ".", " ",
             "dir"}], " ", ",", " ", "endOffset", ",", " ", "endWidth", " ", 
           ",", " ", "middleWidth"}], " ", "]"}], " ", ",", "\n", "\t\t", 
         RowBox[{"Disk", "[", 
          RowBox[{"x", ",", " ", 
           RowBox[{"endWidth", "/", "2"}]}], "]"}], ",", "\n", "\t\t", 
         RowBox[{"Disk", "[", 
          RowBox[{"y", ",", " ", 
           RowBox[{"endWidth", "/", "2"}]}], "]"}]}], "\n", "\t", "}"}], " ", 
       "/;", "\n", "\t\t", 
       RowBox[{"And", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"AllTrue", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "middleWidth", ",", " ", "endWidth", ",", " ", "endOffset"}], 
            "}"}], ",", " ", "NumericQ"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"0", " ", "<=", " ", "endOffset", " ", "<=", " ", 
           RowBox[{"length", "/", "2"}]}], " ", "&&", " ", 
          RowBox[{"endWidth", " ", ">=", " ", "0"}], " ", "&&", " ", 
          RowBox[{"middleWidth", " ", ">=", " ", "0"}]}]}], "\n", "\t\t", 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "2", "D", " ", "embedding", " ", "dimension", " ", "and", " ", "3", "D", 
     " ", "display", " ", "dimension"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "[", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x_", "?", "coordinate3DQ"}], ",", " ", 
        RowBox[{"y_", "?", "coordinate3DQ"}]}], "}"}], ",", " ", 
      "edgeCellPattern", " ", ",", " ", "2", " ", ",", "  ", "___"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"length", " ", "=", " ", 
         RowBox[{"Norm", "[", 
          RowBox[{"y", "-", "x"}], "]"}]}], ",", " ", 
        RowBox[{"dir", " ", "=", " ", 
         RowBox[{"Normalize", "[", 
          RowBox[{"y", "-", "x"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"middleWidth", " ", "=", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<MiddleWidth\>\"", "]"}], " ", "+", 
          " ", 
          RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}]}], ",", "\n", 
        "\t", 
        RowBox[{"endWidth", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"endOffset", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<EndOffset\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"heightOffset", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<HeightOffset\>\"", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"thickness", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{
         RowBox[{"EdgeForm", "[", "None", "]"}], ",", "\n", "\t", 
         RowBox[{
          RowBox[{"ExtrudedPolygon", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"heightOffset", "-", 
              RowBox[{"thickness", "/", "2"}]}], " ", ",", " ", 
             RowBox[{
              RowBox[{"thickness", "/", "2"}], " ", "+", " ", 
              "heightOffset"}]}], "}"}], "]"}], " ", "@@", " ", 
          RowBox[{"polygonShape", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}], ",", " ", "length", ",", " ", 
            "dir", ",", " ", 
            RowBox[{"Cross", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "01"}], "}"}], ",", "dir"}], "]"}],
             " ", ",", " ", "endOffset", ",", " ", "endWidth", " ", ",", " ", 
            "middleWidth"}], " ", "]"}]}]}], "\n", "\t", "}"}], " ", "/;", 
       "\n", "\t\t", 
       RowBox[{"And", "[", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"AllTrue", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "middleWidth", ",", " ", "endWidth", ",", " ", "endOffset", ",", 
             "heightOffset", ",", " ", "thickness"}], "}"}], ",", " ", 
           "NumericQ"}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"0", " ", "<=", " ", "endOffset", " ", "<=", " ", 
           RowBox[{"length", "/", "2"}]}], " ", "&&", " ", 
          RowBox[{"endWidth", " ", ">=", " ", "0"}], " ", "&&", " ", 
          RowBox[{"middleWidth", " ", ">=", " ", "0"}], " ", "&&", " ", 
          RowBox[{"thickness", " ", ">=", " ", "0"}]}]}], "\n", "\t\t", 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "3", "D", " ", "embedding", " ", "dimension", " ", "and", " ", "3", "D", 
     " ", "display", " ", "dimension"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "[", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x_", "?", "coordinate3DQ"}], ",", " ", 
        RowBox[{"y_", "?", "coordinate3DQ"}]}], "}"}], ",", " ", 
      "edgeCellPattern", " ", ",", " ", "3", " ", ",", "  ", "___"}], " ", 
     "]"}], " ", ":=", "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"radius", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"middleWidth", " ", "=", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<MiddleWidth\>\"", "]"}], " ", "+", 
          " ", 
          RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}]}]}]}], "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<MiddleWidth\>\"", "]"}], "==", 
          "0"}], ",", "\n", "\t\t", 
         RowBox[{"Tube", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}], ",", " ", "radius"}], "]"}], ",", 
         "\n", "\t\t", 
         RowBox[{"Tube", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"x", "+", "y"}], ")"}], "/", "2"}], ",", "y"}], "}"}], 
           ",", " ", 
           RowBox[{"{", 
            RowBox[{"radius", ",", "middleWidth", ",", " ", "radius"}], 
            "}"}]}], "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"NumericQ", "[", "radius", "]"}], " ", "&&", " ", 
        RowBox[{"radius", " ", ">=", " ", "0"}], " ", "&&", " ", 
        RowBox[{"middleWidth", " ", ">=", " ", "0"}]}]}]}], "\n", "]"}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "[", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", 
     RowBox[{
     "coord_", ",", " ", "pattern_", ",", " ", "dim_", " ", ",", " ", "___"}],
      "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"MatchQ", "[", " ", 
           RowBox[{"pattern", " ", ",", " ", "edgeCellPattern"}], "]"}], " ", 
          "&&", " ", 
          RowBox[{"Not", "@", 
           RowBox[{"MatrixQ", "[", "coord", "]"}]}]}], ",", " ", 
         RowBox[{"(*", 
          RowBox[{
          "coordinates", " ", "are", " ", "improperly", " ", "formed"}], 
          "*)"}], 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RigidBarShape", "::", "coord"}], ",", " ", "coord", ",", 
           " ", "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MatchQ", "[", " ", 
           RowBox[{"pattern", " ", ",", " ", "edgeCellPattern"}], "]"}]}], 
         ",", " ", 
         RowBox[{"(*", 
          RowBox[{"not", " ", "at", " ", "edge", " ", "cell"}], "*)"}], " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RigidBarShape", "::", "cell"}], ",", " ", "pattern"}], 
          "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"dim", " ", "!=", " ", "2"}], " ", "&&", " ", 
          RowBox[{"dim", " ", "!=", " ", "3"}]}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RigidBarShape", "::", "dim"}], ",", " ", "pattern", ",", 
           " ", "dim"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], 
      "\n", ")"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "::", "coord"}], "=", 
     "\"\<Coordinates `1` for cell `2` are valid 2D or 3D coordinates.\>\""}],
     ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "::", "cell"}], "=", 
     "\"\<Cell `2` is not a valid edge cell.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RigidBarShape", "::", "dim"}], "=", 
     "\"\<Cell `1` cannot be displayed in `2` dimensions.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7728]:=",ExpressionUUID->"68063071-c7cf-4e07-bd84-87af0c161f63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"polygonShape", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], ",", " ", "length_", ",", " ", 
     "direction_", ",", " ", "normal_", ",", " ", "endOffset_", ",", " ", 
     "endWidth_", " ", ",", " ", "middleWidth_"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"Polygon", "[", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"x", " ", "+", " ", 
        RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "-", " ", 
        RowBox[{"endWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
       RowBox[{"x", " ", "+", " ", 
        RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "+", " ", 
        RowBox[{"endWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "+", "y"}], ")"}], "/", "2"}], " ", "+", " ", 
        RowBox[{"middleWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
       RowBox[{"y", " ", "-", " ", 
        RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "+", " ", 
        RowBox[{"endWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
       RowBox[{"y", " ", "-", " ", 
        RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "-", " ", 
        RowBox[{"endWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "+", "y"}], ")"}], "/", "2"}], " ", "-", " ", 
        RowBox[{"middleWidth", " ", 
         RowBox[{"normal", "/", "2"}]}]}]}], "\n", "\t", "}"}], "]"}], " ", "/;",
     " ", 
    RowBox[{"middleWidth", " ", "!=", " ", "endWidth"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"polygonShape", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_"}], "}"}], ",", " ", "length_", ",", " ", 
    "direction_", ",", " ", "normal_", ",", " ", "endOffset_", ",", " ", 
    "endWidth_", " ", ",", " ", "middleWidth_"}], " ", "]"}], " ", ":=", "\n",
   "\t", 
  RowBox[{
   RowBox[{"Polygon", "[", "\n", "\t", 
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"x", " ", "+", " ", 
       RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "-", " ", 
       RowBox[{"endWidth", " ", 
        RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
      RowBox[{"x", " ", "+", " ", 
       RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "+", " ", 
       RowBox[{"endWidth", " ", 
        RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
      RowBox[{"y", " ", "-", " ", 
       RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "+", " ", 
       RowBox[{"endWidth", " ", 
        RowBox[{"normal", "/", "2"}]}]}], ",", "\n", "\t\t", 
      RowBox[{"y", " ", "-", " ", 
       RowBox[{"endOffset", " ", "*", " ", "direction"}], " ", "-", " ", 
       RowBox[{"endWidth", " ", 
        RowBox[{"normal", "/", "2"}]}]}]}], "\n", "\t", "}"}], "]"}], " ", "/;",
    " ", 
   RowBox[{"middleWidth", " ", "==", " ", "endWidth"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7735]:=",ExpressionUUID->"1ad828d7-ef66-4ba2-98e5-8dd1af748c1d"]
}, Closed]],

Cell[CellGroupData[{

Cell["FreeJointShape[]", "Subsection",ExpressionUUID->"df9a98e6-583c-4e1c-9c5e-9329e90e0833"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FreeJointShape", "]"}], " ", "=", " ", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.04"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.027"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<HeightOffset\>\"", " ", "->", " ", "0"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7737]:=",ExpressionUUID->"3198f40c-a3af-4947-b0c8-cbc49f1ca5e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"any", " ", "embedding", " ", "dimension"}], ",", " ", 
    RowBox[{"plotted", " ", "in", " ", "2", "D"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "[", " ", 
      RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", 
     RowBox[{
      RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", 
      "vertexCellPattern", " ", ",", " ", 
      RowBox[{"2", "|", "3"}], " ", ",", " ", "___"}], "]"}], ":=", "\n", 
    "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"circleRadius", " ", "=", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
       "}"}], ",", " ", 
      RowBox[{
       RowBox[{"Disk", "[", 
        RowBox[{"x", ",", " ", "circleRadius"}], "]"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"NumericQ", "[", "circleRadius", "]"}], " ", "&&", " ", 
        RowBox[{"circleRadius", " ", ">=", " ", "0"}]}]}]}], "]"}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"embedded", " ", "in", " ", "2", "D"}], ",", " ", 
     RowBox[{"plotted", " ", "in", " ", "3", "D"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "[", " ", 
      RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", 
     RowBox[{
      RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
      "vertexCellPattern", ",", " ", "2", ",", " ", "___"}], "]"}], ":=", 
    "\n", "\t", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"circleRadius", " ", "=", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}],
         " ", ",", " ", 
        RowBox[{"thickness", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], ",", 
        RowBox[{"off", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<HeightOffset\>\"", "]"}]}]}], "}"}],
       ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"EdgeForm", "[", "None", "]"}], ",", 
         RowBox[{"Cylinder", "[", 
          RowBox[{
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"x", " ", "-", " ", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{
                 RowBox[{"thickness", "/", "2"}], "-", "off"}]}], "}"}]}], 
             ",", " ", 
             RowBox[{"x", " ", "+", " ", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{
                 RowBox[{"thickness", "/", "2"}], "+", "off"}]}], "}"}]}]}], 
            " ", "}"}], ",", " ", "circleRadius"}], "]"}]}], "}"}], " ", "/;",
        " ", "\n", "\t\t\t", 
       RowBox[{"And", "[", "\n", "\t\t\t\t", 
        RowBox[{
         RowBox[{"AllTrue", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"thickness", ",", " ", "off", ",", " ", "circleRadius"}], 
            "}"}], ",", " ", "NumericQ"}], "]"}], ",", "\n", "\t\t\t\t", 
         RowBox[{"thickness", " ", ">=", " ", "0"}], ",", " ", 
         RowBox[{"circleRadius", " ", ">=", " ", "0"}]}], "\n", "\t\t\t", 
        "]"}]}]}], "\[IndentingNewLine]", "\t", "]"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"embedded", " ", "in", " ", "3", "D"}], ",", " ", 
     RowBox[{"plotted", " ", "in", " ", "3", "D"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "[", " ", 
      RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
     RowBox[{
      RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
      "vertexCellPattern", ",", " ", "3", ",", " ", "___"}], "]"}], " ", ":=",
     "\n", "\t", 
    RowBox[{"With", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"sphereRadius", " ", "=", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
       "}"}], ",", " ", 
      RowBox[{
       RowBox[{"Sphere", "[", " ", 
        RowBox[{"x", ",", " ", "sphereRadius"}], "]"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"NumericQ", "[", "sphereRadius", "]"}], " ", "&&", " ", 
        RowBox[{"sphereRadius", " ", ">=", " ", "0"}]}]}]}], "]"}]}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "[", " ", 
      RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
     RowBox[{
     "coord_", " ", ",", " ", "pattern_", " ", ",", " ", "dim_", ",", " ", 
      "___"}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"(", "\n", "\t", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"VectorQ", "[", "coord", "]"}]}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FreeJointShape", "::", "coord"}], ",", " ", "coord", ",", 
           " ", "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"pattern", ",", " ", "vertexCellPattern"}], "]"}], " ", "&&",
           " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"dim", " ", "<", "2"}], " ", "||", " ", 
            RowBox[{"dim", " ", "<", "3"}]}], ")"}]}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FreeJointShape", "::", "dim"}], ",", " ", "dim", ",", " ",
            "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MatchQ", "[", 
           RowBox[{"pattern", ",", " ", "vertexCellPattern"}], "]"}]}], ",", 
         " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"FreeJointShape", "::", "cell"}], ",", " ", "pattern"}], 
          "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], 
   "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "::", "coord"}], " ", "=", " ", 
     "\"\<Coordinate `1` is not a single 2D or 3D position for cell \
`2`.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "::", "dim"}], " ", "=", " ", 
     "\"\<Display dimension `2` is not a single 2D or 3D position for cell \
`2`.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeJointShape", "::", "cell"}], " ", "=", " ", 
     "\"\<Cell `2` is not a valid vertex cell.\>\""}], ";"}], "\n", "\n", 
   RowBox[{"(*", "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"FreeJointShape", "[", " ", 
       RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
      RowBox[{
       RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", "_Point", ",", 
       " ", "0", ",", " ", "___"}], " ", "]"}], " ", ":=", "\n", "\t", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sphereRadius", " ", "=", " ", 
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}],
         "}"}], ",", " ", 
       RowBox[{
        RowBox[{"Sphere", "[", " ", 
         RowBox[{"x", ",", " ", "sphereRadius"}], "]"}], " ", "/;", " ", 
        RowBox[{
         RowBox[{"NumericQ", "[", "sphereRadius", "]"}], " ", "&&", " ", 
         RowBox[{"sphereRadius", " ", ">=", " ", "0"}]}]}]}], "]"}]}], "\n", 
    "*)"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7738]:=",ExpressionUUID->"cdcda5f5-532c-463b-899d-7293e5112f81"]
}, Closed]],

Cell[CellGroupData[{

Cell["PinnedJointShape[]", "Subsection",ExpressionUUID->"530308ab-a7d1-4a5c-86d3-f3a59af21d94"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PinnedJointShape", "]"}], " ", "=", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.05"}], ",", "\n", 
     "\t", 
     RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", "\t", 
     RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.027"}]}], "\n", 
    "}"}]}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7745]:=",ExpressionUUID->"3a0274b7-99dd-44b8-a623-57f7847ae21b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"pt", " ", ":", " ", "coordinate2D"}], ",", " ", 
    "vertexCellPattern", ",", " ", 
    RowBox[{"2", "|", "3"}], ",", " ", "___"}], "]"}], ":=", "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"circleRadius", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "5"}]}], 
      ",", " ", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"pt", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
      RowBox[{"y", " ", "=", " ", 
       RowBox[{"pt", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", 
      RowBox[{"angle", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Angle\>\"", "]"}]}], ",", " ", 
      RowBox[{"size", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"mat", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Cos", "[", "angle", "]"}], ",", 
              RowBox[{"-", 
               RowBox[{"Sin", "[", "angle", "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Sin", "[", "angle", "]"}], ",", 
              RowBox[{"Cos", "[", "angle", "]"}]}], "}"}]}], "}"}]}], ",", 
         "\n", "\t\t", 
         RowBox[{"translation1", " ", "=", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}], ",", "4"}], "]"}]}], ",", " ", 
         RowBox[{"translation2", " ", "=", " ", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}], ",", "2"}], "]"}]}]}], "\n", 
        "\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"{", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"Circle", "[", " ", 
          RowBox[{"pt", " ", ",", " ", "circleRadius"}], "]"}], ",", "\n", 
         "\t\t\t", 
         RowBox[{"Line", "[", 
          RowBox[{"translation1", " ", "+", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"0", "-", "circleRadius"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "-", "size"}], ",", 
                RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "+", "size"}], ",", 
                RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"0", "-", "circleRadius"}]}], "}"}]}], "}"}], " ", 
            ".", " ", "mat"}]}], "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"Line", "[", 
          RowBox[{"translation2", " ", "+", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "-", 
                 RowBox[{"2", " ", "size"}]}], ",", 
                RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "+", 
                 RowBox[{"2", " ", "size"}]}], ",", " ", 
                RowBox[{"0", "-", "circleRadius", "-", "size"}]}], "}"}]}], 
             "}"}], " ", ".", " ", "mat"}]}], "]"}]}], "\n", "\t\t", "}"}]}], 
      "\n", "\t", "]"}], " ", "/;", "\n", "\t\t", 
     RowBox[{"And", "[", "\n", "\t\t\t", 
      RowBox[{
       RowBox[{"AllTrue", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"circleRadius", ",", " ", "angle", ",", " ", "size"}], 
          "}"}], ",", " ", "NumericQ"}], "]"}], ",", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"circleRadius", " ", ">=", " ", "0"}], " ", "&&", " ", 
        RowBox[{"size", " ", ">=", " ", "0"}]}]}], "\n", "\t\t", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7746]:=",ExpressionUUID->"a0387762-529b-4db0-94ff-175060d25b6c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PinnedJointShape", "[", 
     RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     "vertexCellPattern", ",", " ", "2", ",", " ", "___"}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"circleRadius", " ", "=", " ", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], " ", "+", " ",
          "0.02"}]}], " ", ",", " ", 
       RowBox[{"thickness", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}]}], "}"}], 
     ",", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"EdgeForm", "[", "None", "]"}], ",", "\n", "\t", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", " ", "-", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"thickness", "/", "2"}]}], "}"}]}], ",", 
            RowBox[{"x", "+", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"thickness", "/", "2"}]}], "}"}]}]}], "}"}], ",", " ", 
          
          RowBox[{"circleRadius", "/", "2"}]}], "]"}], ",", "\n", "\t", 
        RowBox[{"Cylinder", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", " ", "-", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"2", " ", "thickness"}]}], "}"}]}], ",", 
            RowBox[{"x", " ", "-", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"thickness", "/", "2"}]}], "}"}]}]}], " ", "}"}], ",", 
          " ", 
          RowBox[{"circleRadius", "/", "4"}]}], "]"}]}], "\n", "\t", "}"}], 
      " ", "/;", "\n", "\t\t", 
      RowBox[{"And", "[", "\n", "\t\t\t", 
       RowBox[{
        RowBox[{"AllTrue", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"circleRadius", ",", " ", "thickness"}], "}"}], ",", " ", 
          "NumericQ"}], "]"}], ",", "\n", "\t\t\t", 
        RowBox[{
         RowBox[{"circleRadius", " ", ">=", " ", "0"}], " ", "&&", " ", 
         RowBox[{"thickness", " ", ">=", " ", "0"}]}]}], "\t\t", "\n", "\t\t",
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PinnedJointShape", "[", 
     RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
    RowBox[{
     RowBox[{"pt", " ", ":", " ", "coordinate3D"}], ",", " ", 
     "vertexCellPattern", ",", " ", "3", " ", ",", " ", "___"}], " ", "]"}], ":=",
    " ", 
   RowBox[{"Sphere", "[", 
    RowBox[{"pt", ",", 
     RowBox[{
      RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
    "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"PinnedJointShape", "[", 
      RowBox[{"OptionsPattern", "[", "]"}], "]"}], "[", 
     RowBox[{
      RowBox[{"pt", " ", ":", " ", "coordinate3D"}], ",", " ", "_Point", " ", 
      ",", " ", "___"}], " ", "]"}], ":=", " ", 
    RowBox[{"Sphere", "[", 
     RowBox[{"pt", ",", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Diameter\>\"", "]"}], "/", "2"}]}], 
     "]"}]}], "*)"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PinnedJointShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
    "coord_", " ", ",", " ", "pattern_", " ", ",", " ", "dim_", ",", " ", 
     "___"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"VectorQ", "[", "coord", "]"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PinnedJointShape", "::", "coord"}], ",", " ", "coord", ",",
           " ", "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", 
          RowBox[{"pattern", ",", " ", "vertexCellPattern"}], "]"}], " ", "&&",
          " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"dim", " ", "<", "2"}], " ", "||", " ", 
           RowBox[{"dim", " ", "<", "3"}]}], ")"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PinnedJointShape", "::", "dim"}], ",", " ", "dim", ",", 
          " ", "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MatchQ", "[", 
          RowBox[{"pattern", ",", " ", "vertexCellPattern"}], "]"}]}], ",", 
        " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"PinnedJointShape", "::", "cell"}], ",", " ", "pattern"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "coord"}], " ", "=", " ", 
   "\"\<Coordinate `1` is not a single 2D or 3D position for cell `2`.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "dim"}], " ", "=", " ", 
   "\"\<Display dimension `2` is not a single 2D or 3D position for cell `2`.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PinnedJointShape", "::", "cell"}], " ", "=", " ", 
   "\"\<Cell `2` is not a valid vertex cell.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7747]:=",ExpressionUUID->"7d80a007-6464-43b3-9ff2-00f8fc73da18"]
}, Closed]],

Cell[CellGroupData[{

Cell["JointShape[]", "Subsection",ExpressionUUID->"616abae0-499a-42ac-9be1-54c477240393"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "JointShape", "]"}], " ", "=", "\n", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<Diameter\>\"", " ", "\[Rule]", " ", "0.01"}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<Angle\>\"", " ", "\[Rule]", " ", "0"}], ",", "\n", "\t", 
      RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0.026"}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<HeightOffset\>\"", " ", "->", " ", "0"}]}], "\n", "}"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", 
    RowBox[{"b", " ", ":", " ", 
     RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], ",", " ", "d_", " ", ",", 
    " ", 
    RowBox[{"a", " ", ":", " ", 
     RowBox[{"{", 
      RowBox[{"Infinity", ",", " ", "___"}], "}"}]}], ",", " ", 
    RowBox[{"rest", " ", ":", " ", "___"}]}], " ", "]"}], " ", ":=", " ", 
  "\n", "\t", 
  RowBox[{
   RowBox[{"PinnedJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "PinnedJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "b", ",", "d", ",", " ", "a", ",", " ", "rest"}], 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"JointShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"b", " ", ":", " ", 
      RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], ",", " ", "d_", " ", ",",
      " ", 
     RowBox[{"a", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"Infinity", ",", " ", "___"}], "}"}]}], ",", " ", 
     RowBox[{"rest", " ", ":", " ", "___"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"PinnedJointShape", "[", " ", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "PinnedJointShape", "]"}]}], "]"}], " ", "]"}],
     "[", 
    RowBox[{"x", ",", "b", ",", "d", ",", " ", "a", ",", " ", "rest"}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", 
    RowBox[{"b", " ", ":", " ", 
     RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], ",", " ", 
    RowBox[{"rest", " ", ":", " ", "___"}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "FreeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", " ", "b", ",", " ", "rest"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"JointShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
     RowBox[{"b", " ", ":", " ", 
      RowBox[{"_FreeJoint", "|", "_PinnedJoint"}]}], ",", " ", 
     RowBox[{"rest", " ", ":", " ", "___"}]}], " ", "]"}], " ", ":=", "\n", 
   "\t", 
   RowBox[{
    RowBox[{"FreeJointShape", "[", " ", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "opt", "}"}], ",", 
       RowBox[{"Options", "[", "FreeJointShape", "]"}]}], "]"}], " ", "]"}], 
    "[", 
    RowBox[{"x", ",", "b", ",", " ", "rest"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate2D"}], ",", " ", "b_Point", ",", 
    " ", "rest___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "FreeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "b", ",", "rest"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JointShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", "b_Point", ",", 
    " ", "rest___"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"FreeJointShape", "[", " ", 
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "opt", "}"}], ",", 
      RowBox[{"Options", "[", "FreeJointShape", "]"}]}], "]"}], " ", "]"}], 
   "[", 
   RowBox[{"x", ",", "b", ",", "rest"}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7753]:=",ExpressionUUID->"f42eb97c-a4fa-4783-8190-ace6cf11e7a8"]
}, Closed]],

Cell[CellGroupData[{

Cell["SpringShape[]", "Subsection",ExpressionUUID->"21ae16eb-fe33-4b07-a637-3a56dfc61929"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "SpringShape", "]"}], " ", "=", "\n", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"\"\<Width\>\"", " ", "\[Rule]", " ", "0.1"}], ",", "\n", "\t", 
      
      RowBox[{"\"\<Number\>\"", " ", "\[Rule]", " ", "5"}], ",", "\n", "\t", 
      RowBox[{"\"\<Resolution\>\"", " ", "\[Rule]", " ", "30"}], ",", "\n", 
      "\t", 
      RowBox[{"\"\<Absolute\>\"", "->", "False"}]}], "\n", "}"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "[", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", " ", 
   RowBox[{"coord_", " ", ",", " ", 
    RowBox[{"patt", " ", ":", " ", "edgeCellPattern"}], ",", " ", 
    RowBox[{"dim", " ", ":", " ", 
     RowBox[{"2", "|", "3"}]}]}], " ", "]"}], " ", ":=", " ", 
  RowBox[{
   RowBox[{"SpringShape", "[", " ", "opt", " ", "]"}], "[", 
   RowBox[{"coord", ",", " ", "patt", ",", " ", "dim", ",", " ", 
    RowBox[{"{", 
     RowBox[{"1", ",", "1"}], "}"}]}], " ", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7760]:=",ExpressionUUID->"0523084d-4d4b-4a9e-8f47-5ce789825232"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rot2D", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1", ",", "x2"}], "}"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x1", ",", "x2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "x2"}], ",", "x1"}], "}"}]}], "}"}], "/", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"x1", "^", "2"}], "+", 
         RowBox[{"x2", "^", "2"}]}], "]"}]}]}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"x_", "?", "coordinate2DQ"}], ",", " ", 
      RowBox[{"y_", "?", "coordinate2DQ"}]}], " ", "}"}], ",", " ", 
    "edgeCellPattern", " ", ",", " ", 
    RowBox[{"2", "|", "3"}], " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"l_", ",", "___"}], "}"}], ",", " ", "___"}], " ", "]"}], ":=", 
  "\n", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", "\n", 
     RowBox[{
      RowBox[{"length", " ", "=", " ", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"y", "-", "x"}], ")"}], " ", ".", " ", 
         RowBox[{"(", 
          RowBox[{"y", "-", "x"}], ")"}]}], "]"}]}], ",", "\n", 
      RowBox[{"width", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}], "/", "2"}], "*", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"TrueQ", "[", 
           RowBox[{"OptionValue", "[", "\"\<Absolute\>\"", "]"}], "]"}], ",", 
          "1", ",", "l"}], "]"}]}]}], ",", " ", "\n", 
      RowBox[{"period", " ", "=", " ", 
       RowBox[{"2", " ", 
        RowBox[{"OptionValue", "[", "\"\<Number\>\"", "]"}]}]}], ",", " ", 
      "\n", 
      RowBox[{"nPoints", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"l", "+", "0.1"}], ")"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<Resolution\>\"", "]"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<Number\>\"", "]"}]}], "]"}]}]}], 
     "\n", "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{
         RowBox[{"delta", " ", "=", " ", 
          RowBox[{"N", "[", 
           RowBox[{"length", "/", "nPoints"}], "]"}]}], ",", " ", 
         RowBox[{"rotMat", " ", "=", " ", 
          RowBox[{"rot2D", " ", "@@", " ", 
           RowBox[{"(", 
            RowBox[{"y", "-", "x"}], ")"}]}]}]}], "}"}], ",", "\n", "\t", 
       RowBox[{"{", "\n", "\t", 
        RowBox[{"BezierCurve", "[", "\n", "\t\t", 
         RowBox[{"N", "@", 
          RowBox[{"Join", "[", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"ConstantArray", "[", 
              RowBox[{"x", ",", 
               RowBox[{"nPoints", "-", "3"}]}], "]"}], "+", "\n", 
             "\t\t\t\t\t", 
             RowBox[{
              RowBox[{"N", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", "\n", "\t\t\t\t\t", 
                  RowBox[{
                   RowBox[{"#", " ", "+", " ", 
                    RowBox[{"width", " ", 
                    RowBox[{"Cos", "[", " ", 
                    RowBox[{"period", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], " ", "]"}]}]}], ",", "\n",
                    "\t\t\t\t\t", 
                   RowBox[{"width", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{"period", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], " ", "]"}]}]}], "\n", 
                  "\t\t\t\t\t", "}"}], "&"}], " ", "/@", " ", 
                RowBox[{"Range", "[", 
                 RowBox[{
                  RowBox[{"2", " ", "delta"}], ",", " ", 
                  RowBox[{"length", " ", "-", " ", 
                   RowBox[{"2", " ", "delta"}]}], ",", " ", "delta"}], 
                 "]"}]}], "\n", "\t\t\t\t", "]"}], " ", ".", " ", 
              "rotMat"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"{", "y", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
         "]"}], "\n", "\t", "}"}]}], "\n", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"NumericQ", "[", "width", "]"}], " ", "&&", " ", 
      RowBox[{"width", ">=", "0"}], " ", "&&", " ", 
      RowBox[{"IntegerQ", "[", "period", "]"}], " ", "&&", " ", 
      RowBox[{"period", ">", "0"}], " ", "&&", " ", 
      RowBox[{"IntegerQ", "[", "nPoints", "]"}], " ", "&&", " ", 
      RowBox[{"nPoints", ">", "0"}]}]}]}], "\n", "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7762]:=",ExpressionUUID->"deeff8cc-8a0f-4967-8ab0-c5317f85b6a6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"rot3D", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1", ",", "x2", ",", "x3"}], "}"}], ",", "\n", "\t", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          FractionBox[
           RowBox[{
            SuperscriptBox["x2", "2"], "+", 
            FractionBox[
             RowBox[{
              SuperscriptBox["x1", "2"], " ", "x3"}], 
             SqrtBox[
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               SuperscriptBox["x2", "2"], "+", 
               SuperscriptBox["x3", "2"]}]]]}], 
           RowBox[{
            SuperscriptBox["x1", "2"], "+", 
            SuperscriptBox["x2", "2"]}]], ",", 
          FractionBox[
           RowBox[{"x1", " ", "x2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "1"}], "+", 
              FractionBox["x3", 
               SqrtBox[
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 SuperscriptBox["x2", "2"], "+", 
                 SuperscriptBox["x3", "2"]}]]]}], ")"}]}], 
           RowBox[{
            SuperscriptBox["x1", "2"], "+", 
            SuperscriptBox["x2", "2"]}]], ",", 
          FractionBox["x1", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["x1", "2"], "+", 
             SuperscriptBox["x2", "2"], "+", 
             SuperscriptBox["x3", "2"]}]]]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          FractionBox[
           RowBox[{"x1", " ", "x2", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "1"}], "+", 
              FractionBox["x3", 
               SqrtBox[
                RowBox[{
                 SuperscriptBox["x1", "2"], "+", 
                 SuperscriptBox["x2", "2"], "+", 
                 SuperscriptBox["x3", "2"]}]]]}], ")"}]}], 
           RowBox[{
            SuperscriptBox["x1", "2"], "+", 
            SuperscriptBox["x2", "2"]}]], ",", 
          FractionBox[
           RowBox[{
            SuperscriptBox["x1", "2"], "+", 
            FractionBox[
             RowBox[{
              SuperscriptBox["x2", "2"], " ", "x3"}], 
             SqrtBox[
              RowBox[{
               SuperscriptBox["x1", "2"], "+", 
               SuperscriptBox["x2", "2"], "+", 
               SuperscriptBox["x3", "2"]}]]]}], 
           RowBox[{
            SuperscriptBox["x1", "2"], "+", 
            SuperscriptBox["x2", "2"]}]], ",", 
          FractionBox["x2", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["x1", "2"], "+", 
             SuperscriptBox["x2", "2"], "+", 
             SuperscriptBox["x3", "2"]}]]]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           FractionBox["x1", 
            SqrtBox[
             RowBox[{
              SuperscriptBox["x1", "2"], "+", 
              SuperscriptBox["x2", "2"], "+", 
              SuperscriptBox["x3", "2"]}]]]}], ",", 
          RowBox[{"-", 
           FractionBox["x2", 
            SqrtBox[
             RowBox[{
              SuperscriptBox["x1", "2"], "+", 
              SuperscriptBox["x2", "2"], "+", 
              SuperscriptBox["x3", "2"]}]]]}], ",", 
          FractionBox["x3", 
           SqrtBox[
            RowBox[{
             SuperscriptBox["x1", "2"], "+", 
             SuperscriptBox["x2", "2"], "+", 
             SuperscriptBox["x3", "2"]}]]]}], "}"}]}], "}"}]}], "\n", "]"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "[", " ", 
    RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", " ", ":", " ", "coordinate3D"}], ",", " ", 
      RowBox[{"y", " ", ":", " ", "coordinate3D"}]}], "}"}], ",", " ", 
    "edgeCellPattern", " ", ",", " ", 
    RowBox[{"2", "|", "3"}], " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"l_", ",", "___"}], "}"}], ",", "___"}], " ", "]"}], " ", ":=", 
  "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", 
     RowBox[{
      RowBox[{"rotMat", " ", "=", " ", 
       RowBox[{"rot3D", " ", "@@", " ", 
        RowBox[{"(", 
         RowBox[{"x", "-", "y"}], ")"}]}]}], ",", "\n", 
      RowBox[{"length", "=", 
       RowBox[{"Norm", "[", " ", 
        RowBox[{"y", "-", "x"}], " ", "]"}]}], ",", " ", "\n", 
      RowBox[{"numPoints", " ", "=", " ", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"l", "+", "0.1"}], ")"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<Resolution\>\"", "]"}], "*", 
         RowBox[{"OptionValue", "[", "\"\<Number\>\"", "]"}]}], "]"}]}], ",", 
      " ", "\n", 
      RowBox[{"number", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Number\>\"", "]"}]}], ",", "\n", 
      RowBox[{"thickness", " ", "=", " ", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Width\>\"", "]"}], "*", 
        RowBox[{"l", "/", "2"}]}]}]}], "\n", "}"}], ",", " ", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"delta", " ", "=", " ", 
         RowBox[{"N", "[", 
          RowBox[{"length", "/", "numPoints"}], "]"}]}], " ", "}"}], ",", 
       "\n", "\t", 
       RowBox[{"{", "\n", "\t", 
        RowBox[{"BezierCurve", "[", "\n", "\t\t", 
         RowBox[{"N", "@", 
          RowBox[{"Join", "[", "\n", "\t\t", 
           RowBox[{
            RowBox[{"{", "x", "}"}], ",", "\n", "\t\t", 
            RowBox[{
             RowBox[{"ConstantArray", "[", 
              RowBox[{"x", ",", 
               RowBox[{"numPoints", "-", "3"}]}], "]"}], " ", "+", " ", 
             RowBox[{
              RowBox[{"N", "[", "\n", "\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", " ", 
                  RowBox[{
                   RowBox[{"thickness", " ", 
                    RowBox[{"Cos", "[", 
                    RowBox[{"number", " ", "2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], "]"}]}], ",", 
                   RowBox[{"thickness", " ", 
                    RowBox[{"Sin", "[", 
                    RowBox[{"number", " ", "2", " ", "Pi", " ", 
                    RowBox[{"#", "/", "length"}]}], "]"}]}], ",", " ", "#"}], 
                  " ", "}"}], "&"}], " ", "/@", " ", 
                RowBox[{"Range", "[", 
                 RowBox[{
                  RowBox[{"2", " ", "delta"}], ",", 
                  RowBox[{"length", "-", 
                   RowBox[{"2", " ", "delta"}]}], ",", "delta"}], "]"}]}], 
               "\n", "\t\t", "]"}], " ", ".", " ", "rotMat"}]}], ",", "\n", 
            "\t\t", 
            RowBox[{"{", "y", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
         "]"}], "\n", "\t", "}"}]}], "\n", "]"}], "/;", " ", 
     RowBox[{
      RowBox[{"NumericQ", "[", "thickness", "]"}], " ", "&&", " ", 
      RowBox[{"thickness", ">=", "0"}], " ", "&&", " ", 
      RowBox[{"IntegerQ", "[", "number", "]"}], " ", "&&", " ", 
      RowBox[{"number", ">", "0"}], " ", "&&", " ", 
      RowBox[{"IntegerQ", "[", "numPoints", "]"}], " ", "&&", " ", 
      RowBox[{"numPoints", ">", "0"}]}]}]}], "\n", "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7764]:=",ExpressionUUID->"b0a2f514-7a30-4fc7-9f56-23c511b2ec1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SpringShape", "[", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], " ", "]"}], "[", 
    RowBox[{
    "coord_", ",", " ", "pattern_", ",", " ", "dim_", " ", ",", " ", "___"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"MatchQ", "[", " ", 
          RowBox[{"pattern", " ", ",", " ", "edgeCellPattern"}], "]"}], " ", "&&",
          " ", 
         RowBox[{"Not", "@", 
          RowBox[{"MatrixQ", "[", "coord", "]"}]}]}], ",", " ", 
        RowBox[{"(*", 
         RowBox[{
         "coordinates", " ", "are", " ", "improperly", " ", "formed"}], 
         "*)"}], 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"SpringShape", "::", "coord"}], ",", " ", "coord", ",", " ",
           "pattern"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"Not", "@", 
         RowBox[{"MatchQ", "[", " ", 
          RowBox[{"pattern", " ", ",", " ", "edgeCellPattern"}], "]"}]}], ",",
         " ", 
        RowBox[{"(*", 
         RowBox[{"not", " ", "at", " ", "edge", " ", "cell"}], "*)"}], " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"SpringShape", "::", "cell"}], ",", " ", "pattern"}], 
         "]"}]}], " ", "]"}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"dim", " ", "!=", " ", "2"}], " ", "&&", " ", 
         RowBox[{"dim", " ", "!=", " ", "3"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"SpringShape", "::", "dim"}], ",", " ", "pattern", ",", " ",
           "dim"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "False"}], "\n", 
     ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "::", "coord"}], "=", 
   "\"\<Coordinates `1` for cell `2` are valid 2D or 3D coordinates.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "::", "cell"}], "=", 
   "\"\<Cell `2` is not a valid edge cell.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SpringShape", "::", "dim"}], "=", 
   "\"\<Cell `1` cannot be displayed in `2` dimensions.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7766]:=",ExpressionUUID->"c0937410-8977-4d4f-a839-ccb5f4389bde"]
}, Closed]],

Cell[CellGroupData[{

Cell["FaceShape[]", "Subsection",ExpressionUUID->"a7a35632-47d0-4342-be07-daf07f198317"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FaceShape", "]"}], " ", "=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"\"\<Thickness\>\"", " ", "\[Rule]", " ", "0"}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7770]:=",ExpressionUUID->"e55e08fa-9d58-42bc-abfc-669219f4ba55"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"coordinate2D", ".."}], "}"}]}], ",", " ", "___"}], "]"}], " ",
    ":=", " ", 
   RowBox[{"Polygon", "[", " ", 
    RowBox[{"x", " ", ",", " ", 
     RowBox[{"VertexTextureCoordinates", " ", "->", " ", "x"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"coordinate3D", ".."}], "}"}]}], ",", " ", 
     RowBox[{"_Face", "|", "_ElasticTriangle"}], ",", " ", 
     RowBox[{"2", "|", "3"}], ",", " ", "___"}], " ", "]"}], " ", ":=", " ", 
   "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], " ", 
       "\[Equal]", " ", "0"}], ",", "\n", "\t\t", 
      RowBox[{"Polygon", "[", " ", 
       RowBox[{"x", " ", ",", " ", 
        RowBox[{"VertexTextureCoordinates", " ", "->", " ", "x"}]}], "]"}], 
      ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"ExtrudedPolygon", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], "}"}], 
        "]"}], "[", "x", "]"}]}], "\n", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"NumericQ", "[", 
      RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], "]"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], ">=", 
      "0"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", " ", 
    RowBox[{
     RowBox[{"x", " ", ":", " ", 
      RowBox[{"{", 
       RowBox[{"coordinate3D", ".."}], "}"}]}], ",", "  ", "_Polygon", ",", 
     " ", "___"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"Polygon", "[", " ", 
    RowBox[{"x", " ", ",", " ", 
     RowBox[{"VertexTextureCoordinates", " ", "->", " ", "x"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FaceShape", "[", " ", 
     RowBox[{"OptionsPattern", "[", "]"}], " ", "]"}], "[", "___", "]"}], " ",
    ":=", " ", 
   RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{
          RowBox[{"NumericQ", "[", 
           RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], "]"}], " ",
           "&&", " ", 
          RowBox[{"TrueQ", "[", 
           RowBox[{
            RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}], ">=", " ",
             "0"}], "]"}]}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FaceShape", "::", "thick"}], ",", " ", 
          RowBox[{"OptionValue", "[", "\"\<Thickness\>\"", "]"}]}], "]"}]}], 
       "]"}], ";", "\n", "\t", "False"}], "\n", ")"}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FaceShape", "::", "thick"}], "=", 
   "\"\<Thickness `1` should be a non-negative real number.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7771]:=",ExpressionUUID->"7befbc49-c359-459d-b8be-4c03a3cd4cbc"]
}, Closed]],

Cell[CellGroupData[{

Cell["AngleMarker[], AngleText[]", "Subsection",ExpressionUUID->"a4787621-3d48-4ae3-bf4b-6c35d714056b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleText", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"label_", " ", ":", " ", "\"\<\>\""}], ",", 
    RowBox[{"distance", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", "0"}]}], "]"}], ":=", 
  RowBox[{"With", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"angleLocation", "=", 
       RowBox[{
        RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"v2", ",", 
          RowBox[{"1", ";;", 
           RowBox[{"MechanismDisplayDimension", "[", "m", "]"}]}]}], "]"}], 
        "]"}]}], ",", "\n", "\t", 
      RowBox[{"vectors", "=", 
       RowBox[{"-", 
        RowBox[{
         RowBox[{"DisplacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v3", ",", "v2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v1", ",", "v2"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", 
            RowBox[{"MechanismDisplayDimension", "[", "m", "]"}]}]}], "]"}], 
         "]"}]}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"Text", "[", 
     RowBox[{"label", ",", 
      RowBox[{"angleLocation", " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"distance", "+", "0.12"}], ")"}], " ", 
        RowBox[{"Mean", "[", "vectors", "]"}]}]}]}], "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7776]:=",ExpressionUUID->"321114ce-c1c2-4259-8f91-54d2a33d7886"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
         " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
       "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"v2", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{
         RowBox[{"DisplacementVector", "[", 
          RowBox[{
           RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"v2", ",", "v1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}]}], "\n", "}"}], ",", 
     "\n", "\t", 
     RowBox[{"Circle", "[", 
      RowBox[{"angleLocation", ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Abs", "[", "radius", "]"}], " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", ".", " ", 
            RowBox[{"vectors", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}], ",", "\n", 
       "\t\t", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "<", 
             RowBox[{"Pi", "+", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"2", "Pi"}]}], "}"}], "+", "#"}], ",", "#"}], "]"}], 
          "&"}], ")"}], "[", 
        RowBox[{"ArcTan", "@@@", "vectors"}], "]"}]}], "\n", "\t", "]"}]}], 
    "\n", "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", "2"}], 
    " ", "&&", " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], 
    RowBox[{"(*", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{
       RowBox[{"m", "[", "\"\<MeshRegion\>\"", "]"}], ",", "0"}], "]"}], 
     "*)"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7777]:=",ExpressionUUID->"521bc9c5-de42-41dd-9770-013f3407e73d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Code", " ", "borrowed", " ", "from", " ", 
     RowBox[{"https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"mathematica", ".", "stackexchange", ".", "com"}], "/", 
        "questions"}], "/", "10957"}], "/", "an"}], "-", "efficient", "-", 
     "circular", "-", "arc", "-", "primitive", "-", "for", "-", 
     "graphics3d"}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "splineCircle2", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"splineCircle", "[", 
     RowBox[{"m_List", ",", " ", "r_", ",", " ", 
      RowBox[{"angles_List", ":", " ", 
       RowBox[{"{", 
        RowBox[{"0.", ",", " ", 
         RowBox[{"2.", " ", "\[Pi]"}]}], "}"}]}]}], "]"}], " ", ":=", " ", 
    "\n", " ", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "seg", ",", " ", "\[Phi]", ",", " ", "start", ",", " ", "end", ",", 
         " ", "pts", ",", " ", "w", ",", " ", "k", ",", " ", "pihalf"}], 
        "}"}], ",", "\n", "   ", 
       RowBox[{
        RowBox[{"pihalf", " ", "=", " ", 
         RowBox[{"0.5", " ", "\[Pi]"}]}], ";", "\n", "   ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"start", ",", " ", "end"}], "}"}], " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", "angles", "]"}], ",", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"end", " ", "<=", " ", "start"}], ",", " ", 
          RowBox[{"end", " ", "+=", " ", 
           RowBox[{"2.", " ", "\[Pi]"}]}]}], "]"}], ";", "\n", "   ", 
        RowBox[{"seg", " ", "=", " ", 
         RowBox[{"Quotient", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"\[Phi]", " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"N", "[", 
            RowBox[{"end", " ", "-", " ", "start"}], "]"}], ",", " ", 
           "pihalf"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"seg", " ", "==", " ", "4"}], ",", " ", 
          RowBox[{
           RowBox[{"seg", " ", "=", " ", "3"}], ";", " ", 
           RowBox[{"\[Phi]", " ", "=", " ", "pihalf"}]}]}], "]"}], ";", "\n", 
        "   ", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "     ", 
           RowBox[{
            RowBox[{"cseg", " ", "=", " ", 
             RowBox[{"Cos", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", " ", 
            RowBox[{"sseg", " ", "=", " ", 
             RowBox[{"Sin", "[", 
              RowBox[{"pihalf", " ", "seg"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"c\[Phi]", " ", "=", " ", 
             RowBox[{"Cos", "[", "\[Phi]", "]"}]}], ",", " ", 
            RowBox[{"s\[Phi]", " ", "=", " ", 
             RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", " ", "\n", "     ", 
            RowBox[{"t\[Phi]", " ", "=", " ", 
             RowBox[{"Tan", "[", 
              RowBox[{"0.5", " ", "\[Phi]"}], "]"}]}], ",", "\n", "     ", 
            RowBox[{"rcs", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Cos", "[", "start", "]"}]}]}], ",", " ", 
            RowBox[{"rss", " ", "=", " ", 
             RowBox[{"r", " ", 
              RowBox[{"Sin", "[", "start", "]"}]}]}]}], "\n", "     ", "}"}], 
          ",", "\n", "    ", 
          RowBox[{"pts", " ", "=", " ", 
           RowBox[{
            RowBox[{"Join", "[", "\n", "       ", 
             RowBox[{
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"1.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "1."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", "0."}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1."}], ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0.", ",", " ", 
                    RowBox[{"-", "1."}]}], "}"}]}], "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], 
              ",", "\n", "       ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"cseg", " ", "-", " ", 
                   RowBox[{"sseg", " ", "t\[Phi]"}]}], ",", " ", 
                  RowBox[{"sseg", " ", "+", " ", 
                   RowBox[{"cseg", " ", "t\[Phi]"}]}]}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cseg", " ", "c\[Phi]"}], " ", "-", " ", 
                   RowBox[{"sseg", " ", "s\[Phi]"}]}], ",", " ", 
                  RowBox[{
                   RowBox[{"c\[Phi]", " ", "sseg"}], " ", "+", " ", 
                   RowBox[{"cseg", " ", "s\[Phi]"}]}]}], "}"}]}], "}"}]}], 
             "\n", "       ", "]"}], ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"rcs", ",", " ", "rss"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "rss"}], ",", " ", "rcs"}], "}"}]}], "}"}]}]}]}],
          "\n", "    ", "]"}], ";", "\n", "   ", 
        RowBox[{"pts", " ", "=", " ", 
         RowBox[{
          RowBox[{"ConstantArray", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"Length", "[", "pts", "]"}]}], "]"}], " ", "+", " ", "\n",
           "     ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], ",", 
            " ", "\n", "      ", "pts", ",", " ", "\n", "      ", 
            RowBox[{"Join", "[", 
             RowBox[{"pts", ",", " ", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{
                RowBox[{"{", "0.", "}"}], ",", " ", 
                RowBox[{"Length", "[", "pts", "]"}]}], "]"}], ",", " ", "2"}],
              "]"}]}], "\n", "     ", "]"}]}]}], ";", "\n", "   ", 
        RowBox[{"w", " ", "=", " ", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"c", " ", "=", " ", 
             RowBox[{"1.", "/", 
              RowBox[{"Sqrt", "[", "2.", "]"}]}]}], "}"}], ",", " ", "\n", 
           "     ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{"Take", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "1.", ",", " ", "c", ",", " ", "1.", ",", " ", "c", ",", " ", 
                 "1.", ",", " ", "c", ",", " ", "1."}], "}"}], ",", " ", 
               RowBox[{
                RowBox[{"2", " ", "seg"}], " ", "+", " ", "1"}]}], "]"}], ",",
              " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", 
                RowBox[{"0.5", " ", "\[Phi]"}], "]"}], ",", " ", "1."}], 
              "}"}]}], "]"}]}], "\n", "     ", "]"}]}], ";", "\n", "   ", 
        RowBox[{"k", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Riffle", "[", 
              RowBox[{"#", ",", " ", "#"}], "]"}], " ", "&"}], "@", 
            RowBox[{"Range", "[", 
             RowBox[{"seg", " ", "+", " ", "1"}], "]"}]}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"seg", " ", "+", " ", "1"}], "}"}]}], "]"}]}], ";", "\n", 
        "   ", 
        RowBox[{"BSplineCurve", "[", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"SplineDegree", " ", "->", " ", "2"}], ",", " ", 
          RowBox[{"SplineKnots", " ", "->", " ", "k"}], ",", " ", 
          RowBox[{"SplineWeights", " ", "->", " ", "w"}]}], "]"}]}]}], "\n", 
      "   ", "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "2"}], " ", "||", 
      " ", 
      RowBox[{
       RowBox[{"Length", "[", "m", "]"}], " ", "==", " ", "3"}]}]}]}], "\n", 
   " ", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "circleFromPoints", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"arc", " ", "->", " ", "False"}], "}"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"circleFromPoints", "[", 
     RowBox[{
      RowBox[{"m", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{"q1_", ",", " ", "q2_", ",", " ", "q3_"}], "}"}]}], ",", " ", 
      
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", "\n", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "c", ",", " ", "r", ",", " ", "\[Phi]1", ",", " ", "\[Phi]2", ",", 
         " ", "p1", ",", " ", "p2", ",", " ", "p3", ",", " ", "h", ",", " ", 
         "\n", "        ", 
         RowBox[{"rot", " ", "=", " ", 
          RowBox[{
           RowBox[{"Quiet", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}], ",", " ", 
                RowBox[{"Cross", "[", 
                 RowBox[{
                  RowBox[{"#1", " ", "-", " ", "#2"}], ",", " ", 
                  RowBox[{"#3", " ", "-", " ", "#2"}]}], "]"}]}], "}"}], 
              "]"}], ",", 
             RowBox[{"RotationMatrix", "::", "spln"}]}], "]"}], " ", 
           "&"}]}]}], "}"}], ",", "\n", "  ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "}"}], ".", 
          RowBox[{"rot", "[", 
           RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}]}]}], ";", 
        "\n", "  ", 
        RowBox[{"h", " ", "=", " ", 
         RowBox[{"p1", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], " ", "=", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", " ", 
            RowBox[{";;", " ", "2"}]}], "]"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"c", ",", " ", "r"}], "}"}], " ", "=", " ", 
         RowBox[{"List", " ", "@@", " ", 
          RowBox[{"Circumsphere", "[", 
           RowBox[{"{", 
            RowBox[{"p1", ",", " ", "p2", ",", " ", "p3"}], "}"}], "]"}]}]}], 
        ";", "\n", "  ", 
        RowBox[{"\[Phi]1", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p3", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"\[Phi]2", " ", "=", " ", 
         RowBox[{"ArcTan", " ", "@@", " ", 
          RowBox[{"(", 
           RowBox[{"p1", " ", "-", " ", "c"}], ")"}]}]}], ";", "\n", "  ", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Append", "[", 
          RowBox[{"c", ",", " ", "h"}], "]"}]}], ";", "\n", "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"OptionValue", "[", "arc", "]"}], " ", "//", " ", 
           "TrueQ"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r", ",", " ", 
              RowBox[{"{", 
               RowBox[{"\[Phi]1", ",", " ", "\[Phi]2"}], "}"}]}], "]"}], ",", 
            " ", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "\n", "    ", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", "p", "}"}], ",", " ", 
                RowBox[{
                 RowBox[{"rot", "[", 
                  RowBox[{"q1", ",", " ", "q2", ",", " ", "q3"}], "]"}], ".", 
                 "p"}]}], "]"}], " ", "/@", " ", "#"}], " ", "&"}], ",", " ", 
            
            RowBox[{"splineCircle", "[", 
             RowBox[{"c", ",", " ", "r"}], "]"}], ",", " ", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "\n", "  ", "]"}]}]}], "\n", 
      "]"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"MatrixQ", "[", 
       RowBox[{"m", ",", " ", "NumericQ"}], "]"}], " ", "&&", " ", 
      RowBox[{
       RowBox[{"Dimensions", "[", "m", "]"}], " ", "==", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", " ", "3"}], "}"}]}]}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7778]:=",ExpressionUUID->"8a094d13-8b63-400b-b159-c54a5fd2ee60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     " ", 
    RowBox[{"radius", " ", ":", " ", 
     RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", 
     RowBox[{"1", "/", "10"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"angleLocation", "=", 
        RowBox[{
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "project", " ", "the", " ", "vectors", " ", "making", " ", "this", 
          " ", "angle", " ", "to", " ", "the", " ", "xy"}], "-", "plane"}], 
        "*)"}], "\n", "\t", 
       RowBox[{"vectors", "=", 
        RowBox[{"DisplacementVector", "[", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"v2", ",", "v1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v2", ",", "v3"}], "}"}]}], "}"}]}], "]"}]}]}], "\n", 
      "}"}], ",", "\n", "\t", 
     RowBox[{"circleFromPoints", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"vectors", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"vectors", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/", 
            RowBox[{"Sqrt", "[", "2", "]"}]}]}]}], ",", 
         RowBox[{"angleLocation", "+", 
          RowBox[{"radius", " ", 
           RowBox[{"vectors", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], ",", 
       RowBox[{"arc", " ", "\[Rule]", "True"}]}], "]"}]}], "\n", "]"}], " ", "/;",
    " ", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismDisplayDimension", "[", "m", "]"}], "\[Equal]", "3"}], 
    " ", "&&", " ", 
    RowBox[{
     RowBox[{"Max", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], "\[LessEqual]", 
     RowBox[{"m", "[", "\"\<VertexCount\>\"", "]"}]}], 
    RowBox[{"(*", 
     RowBox[{"MeshCellCount", "[", 
      RowBox[{
       RowBox[{"m", "[", "\"\<MeshRegion\>\"", "]"}], ",", "0"}], "]"}], 
     "*)"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{"Min", "[", 
      RowBox[{"{", 
       RowBox[{"v1", ",", "v2", ",", "v3"}], "}"}], "]"}], ">", 
     "0"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7782]:=",ExpressionUUID->"bd7f0e33-5f80-428a-989f-41e32909c8eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AngleMarker", "::", "bounds"}], "=", 
   "\"\<Vertices are out of bounds.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}]}], 
   "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_"}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}], "\n", 
 RowBox[{
  RowBox[{"AngleMarker", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"v1_Integer", ",", "v2_Integer", ",", "v3_Integer"}], "}"}], ",",
     "_", ",", 
    RowBox[{"_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"\"\<nothing\>\"", "/;", 
   RowBox[{"Message", "[", 
    RowBox[{"AngleMarker", "::", "bounds"}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7783]:=",ExpressionUUID->"6430d36e-973c-44ca-a619-b4932b524083"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PlotMechanism[]", "Section",ExpressionUUID->"39bcb497-250e-4ccc-b5cc-cc185dc1e82d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PlotMechanism", "]"}], " ", "=", " ", 
   RowBox[{"Join", "[", "\n", "\t", 
    RowBox[{
     RowBox[{"Options", "[", "Graphics3D", "]"}], ",", "\n", "\t", 
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
       RowBox[{"PlotTheme", " ", "\[Rule]", " ", "Automatic"}], ",", "\n", 
       "\t\t", 
       RowBox[{"Displacements", " ", "\[Rule]", " ", "None"}], ",", "\n", 
       "\t\t", 
       RowBox[{"Stresses", " ", "\[Rule]", " ", "None"}], ",", "\n", "\n", 
       "\t\t", 
       RowBox[{"StressStyle", " ", "\[Rule]", " ", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RGBColor", "[", 
              RowBox[{"{", 
               RowBox[{"#2", ",", "0", ",", "0"}], "}"}], "]"}], " ", ",", 
             " ", 
             RowBox[{"AbsoluteThickness", "[", 
              RowBox[{"1", "+", 
               RowBox[{"3", "*", "#2"}]}], "]"}], " ", ",", " ", 
             RowBox[{"Line", "[", "#", "]"}]}], "}"}], "&"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RGBColor", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"-", "#2"}]}], "}"}], "]"}], " ", ",", " ", 
             RowBox[{"AbsoluteThickness", "[", 
              RowBox[{"1", "+", 
               RowBox[{"3", "*", 
                RowBox[{"(", 
                 RowBox[{"-", "#2"}], ")"}]}]}], "]"}], " ", ",", 
             RowBox[{"Line", "[", "#", "]"}]}], "}"}], "&"}]}], "\n", "\t\t", 
         "}"}]}], ",", "\n", "\n", "\t\t", 
       RowBox[{"DisplacementStyle", " ", "\[Rule]", " ", 
        RowBox[{"{", "Black", "}"}]}], ",", "\n", "\t\t", 
       RowBox[{"DisplacementScale", " ", "\[Rule]", " ", "0.25"}], ",", "\n", 
       "\n", "\t\t", 
       RowBox[{"DisplayDimension", " ", "\[Rule]", " ", "Automatic"}], ",", 
       "\n", "\t\t", 
       RowBox[{"Prolog", "\[Rule]", 
        RowBox[{"{", "}"}]}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7787]:=",ExpressionUUID->"47c05290-a89e-4761-b409-233504c8abb9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", " ", "=", " ", 
       RowBox[{"plotMechanismInternal", "[", " ", 
        RowBox[{"m", ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], " ", ",", " ", 
         
         RowBox[{"OptionValue", "[", "DisplayDimension", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "Prolog", "]"}], ",", " ", 
         RowBox[{"{", "opt", "}"}], ",", "\n", "\t\t\t\t\t\t\t\t\t\t", 
         RowBox[{"OptionValue", "[", "Stresses", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "StressStyle", "]"}], ",", "\n", 
         "\t\t\t\t\t\t\t\t\t\t", 
         RowBox[{"OptionValue", "[", "Displacements", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "DisplacementStyle", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "DisplacementScale", "]"}]}], "\n", 
        "\t\t\t\t\t\t\t\t", "]"}]}], "}"}], ",", "\n", "\t", 
     RowBox[{"res", " ", "/;", " ", 
      RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlotMechanism", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"positions", " ", ":", " ", 
     RowBox[{
      RowBox[{"_", "?", "NumericCoordinatesQ"}], "|", 
      RowBox[{"{", 
       RowBox[{"__", "?", "NumericCoordinatesQ"}], "}"}]}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", " ", "=", " ", 
      RowBox[{"plotMechanismInternal", "[", " ", 
       RowBox[{"m", ",", " ", "positions", " ", ",", " ", 
        RowBox[{"OptionValue", "[", "DisplayDimension", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "Prolog", "]"}], ",", " ", 
        RowBox[{"{", "opt", "}"}], ",", "\n", "\t\t\t\t\t\t\t\t\t\t", 
        RowBox[{"OptionValue", "[", "Stresses", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "StressStyle", "]"}], ",", "\n", 
        "\t\t\t\t\t\t\t\t\t\t", 
        RowBox[{"OptionValue", "[", "Displacements", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "DisplacementStyle", "]"}], ",", " ", 
        RowBox[{"OptionValue", "[", "DisplacementScale", "]"}]}], "\n", 
       "\t\t\t\t\t\t\t\t", "]"}]}], "}"}], ",", "\n", "\t", 
    RowBox[{"res", " ", "/;", " ", 
     RowBox[{"res", " ", "=!=", " ", "$Failed"}]}]}], "\n", "]"}]}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:12 \
In[7788]:=",ExpressionUUID->"d0c0ab08-9f98-424a-87df-306817a5ca19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanismInternal", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "positions_", " ", ",", " ", "displayDimension_", 
     " ", ",", " ", "prolog_", " ", ",", " ", "options_", ",", " ", 
     "inputStresses_", " ", ",", " ", "stressStyle_", " ", ",", " ", 
     "inputDisplacements_", " ", ",", " ", "displacementStyle_", " ", ",", 
     " ", "displacementScale_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "expand", " ", "coordinates", " ", "to", " ", "the", " ", "correct", 
         " ", "number", " ", "of", " ", "plots", " ", "we", " ", "are", " ", 
         "going", " ", "to", " ", "make"}], "*)"}], "\n", "\t", 
       RowBox[{
       "coordinates", ",", " ", "stresses", ",", " ", "displacements", ",", 
        "\n", "\t", 
        RowBox[{"primitiveOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "options", "}"}], ",", " ", 
           RowBox[{"Options", "[", "MechanismPrimitives", "]"}]}], " ", 
          "]"}]}], ",", " ", "mechanismGraphics", ",", "\n", "\t", 
        "directive", ",", " ", "displayOptions", ",", "\n", "\t", 
        RowBox[{"edges", " ", "=", " ", 
         RowBox[{"MechanismEdges", "[", "m", "]"}]}], ",", "\n", "\n", "\t", 
        "stressScale", ",", " ", "maximumDisplacement"}], "\n", "\t", "\n", 
       "}"}], ",", "\n", "\t", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"each", " ", "of", " ", "coordinates"}], ",", " ", "stresses",
         ",", " ", 
        RowBox[{
        "and", " ", "displacements", " ", "are", " ", "lists", " ", "of", " ",
          "the", " ", "same", " ", "length"}]}], " ", "*)"}], "\n", "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "coordinates", ",", " ", "stresses", ",", " ", "displacements"}], 
         "}"}], " ", "=", " ", 
        RowBox[{"expandInputs", "[", " ", 
         RowBox[{
          RowBox[{"Length", "[", "edges", "]"}], ",", " ", 
          RowBox[{"positionDimension", "[", 
           RowBox[{"m", ",", " ", "positions", ",", " ", "displayDimension"}],
            "]"}], ",", " ", "inputStresses", ",", " ", 
          "inputDisplacements"}], " ", "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"coordinates", " ", "===", " ", "$Failed"}], " ", ",", "\n", 
         "\t\t", "$Failed", ",", "\n", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{
          "compute", " ", "the", " ", "overall", " ", "stress", " ", "and", 
           " ", "displacement", " ", "scale"}], "*)"}], "\n", "\t\t", 
         RowBox[{
          RowBox[{"stressScale", " ", "=", " ", 
           RowBox[{"getStressScale", "[", "stresses", "]"}]}], ";", "\n", 
          "\t\t", 
          RowBox[{"maximumDisplacement", " ", "=", " ", 
           RowBox[{"getDisplacementScale", "[", "displacements", "]"}]}], ";",
           "\n", "\n", "\t\t", 
          RowBox[{"mechanismGraphics", " ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"MechanismPrimitives", "[", " ", 
              RowBox[{
               RowBox[{"Deformed", "[", 
                RowBox[{"m", ",", " ", "#"}], "]"}], ",", " ", 
               "displayDimension", ",", " ", "primitiveOptions"}], " ", "]"}],
              " ", "&"}], " ", "/@", " ", "coordinates"}]}], ";", "\n", 
          "\t\t", 
          RowBox[{"directive", " ", "=", " ", 
           RowBox[{"graphicsDirective", "[", " ", 
            RowBox[{"m", " ", ",", " ", "mechanismGraphics", " ", ",", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"coordinates", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\n", "\t\t", 
          RowBox[{"displayOptions", " ", "=", " ", 
           RowBox[{"graphicsOptions", "[", " ", 
            RowBox[{
             RowBox[{"{", "options", "}"}], ",", " ", "directive", " ", ",", 
             " ", 
             RowBox[{"boundingRegions", "[", 
              RowBox[{"m", ",", " ", "coordinates"}], "]"}]}], " ", "]"}]}], 
          ";", "\n", "\t\t", "\n", "\t\t", 
          RowBox[{"stresses", " ", "=", " ", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"plotStresses", "[", 
               RowBox[{
               "stressScale", ",", " ", "edges", ",", " ", "#1", ",", " ", 
                "#2", ",", " ", "stressStyle"}], " ", "]"}], "&"}], " ", ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{"coordinates", ",", " ", "stresses"}], "}"}]}], " ", 
            "]"}]}], ";", "\n", "\t\t", 
          RowBox[{"displacements", " ", "=", " ", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"plotDisplacements", "[", " ", 
               RowBox[{
               "maximumDisplacement", ",", " ", "#1", ",", " ", "#2", ",", 
                " ", "displacementScale", " ", ",", " ", 
                "displacementStyle"}], " ", "]"}], "&"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"coordinates", ",", " ", "displacements"}], "}"}]}], 
            " ", "]"}]}], ";", "\n", "\n", "\t\t", 
          RowBox[{
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "coordinates", "]"}], "==", "1"}], " ", 
             ",", " ", "First", ",", " ", 
             RowBox[{"#", "&"}]}], " ", "]"}], " ", "@", " ", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"directive", "[", " ", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "prolog", ",", " ", "#1", ",", " ", "#2", ",", " ", "#3"}], 
                 "}"}], ",", " ", "displayOptions"}], " ", "]"}], "&"}], " ", 
             ",", " ", 
             RowBox[{"{", 
              RowBox[{
              "mechanismGraphics", ",", " ", "stresses", ",", " ", 
               "displacements"}], "}"}]}], " ", "]"}]}]}]}], "\n", "\t", 
        "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"NumericQ", "[", "displacementScale", "]"}], " ", "&&", " ", 
     RowBox[{"displacementScale", " ", ">", " ", "0"}], " ", "&&", " ", 
     RowBox[{"VectorQ", "[", " ", "stressStyle", " ", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "stressStyle", "]"}], " ", "==", " ", 
      "2"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotMechanismInternal", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "positions_", " ", ",", " ", "displayDimension_", 
     " ", ",", " ", "prolog_", " ", ",", " ", "options_", ",", " ", 
     "inputStresses_", " ", ",", " ", "stressStyle_", " ", ",", " ", 
     "inputDisplacements_", " ", ",", " ", "displacementStyle_", " ", ",", 
     " ", "displacementScale_"}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"NumericQ", "[", "displacementScale", "]"}], " ", "&&", " ", 
         
         RowBox[{"displacementScale", " ", ">", " ", "0"}]}], "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"PlotMechanism", "::", "displscale"}], "]"}]}], " ", "]"}], 
     ";", "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"VectorQ", "[", " ", "stressStyle", " ", "]"}], " ", "&&", 
         " ", 
         RowBox[{
          RowBox[{"Length", "[", "stressStyle", "]"}], " ", "==", " ", 
          "2"}]}], "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{"PlotMechanism", "::", "stressstyle"}], "]"}]}], " ", "]"}], 
     ";", "\n", "\t", "$Failed"}], "\n", ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "stressstyle"}], " ", "=", " ", 
   "\"\<Stress style should be of the form { positive stress style, negative \
stress style }.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "displscale"}], "=", 
   "\"\<The displacement scale must be a positive real number.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7790]:=",ExpressionUUID->"1b5a7957-8a30-41e5-96a3-605e100640ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"$Failed", " ", ",", " ", "_", " ", ",", " ", "_"}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"(", "\n", "\t", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"PlotMechanism", "::", "pos"}], "]"}], ";", "\n", "\t", 
     RowBox[{"{", "}"}]}], "\n", ")"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "only", " ", "one", " ", "set", " ", "of", " ", "positions", " ", 
    "given"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"_", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}]}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", " ", 
    RowBox[{
     RowBox[{"{", "coordinates", "}"}], ",", " ", 
     RowBox[{"{", "None", "}"}], ",", " ", 
     RowBox[{"{", "None", "}"}]}], "}"}]}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"one", " ", "position"}], ",", " ", 
    RowBox[{"one", " ", "stress"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"stresses_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}]}], " ", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "coordinates", "}"}], ",", " ", 
      RowBox[{"{", "stresses", "}"}], ",", " ", 
      RowBox[{"{", "None", "}"}]}], "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Length", "[", "stresses", "]"}], " ", "==", " ", 
     "edgeNumber"}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"one", " ", "position"}], ",", " ", 
    RowBox[{"multiple", " ", "stresses"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"stresses_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"ConstantArray", "[", " ", 
       RowBox[{"coordinates", ",", " ", 
        RowBox[{"Length", "[", "stresses", "]"}]}], " ", "]"}], ",", " ", 
      "\n", "\t", "stresses", ",", " ", "\n", "\t", 
      RowBox[{"ConstantArray", "[", " ", 
       RowBox[{"None", ",", " ", 
        RowBox[{"Length", "[", "stresses", "]"}]}], " ", "]"}]}], "\n", "\t", 
     "}"}], " ", "/;", " ", 
    RowBox[{"edgeNumber", " ", "==", " ", 
     RowBox[{"Length", "[", 
      RowBox[{"stresses", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"one", " ", "position"}], ",", " ", 
    RowBox[{"one", " ", "displacement"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"displacements_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
   " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"{", "\n", "\t\t", 
     RowBox[{
      RowBox[{"{", "coordinates", "}"}], ",", "\n", "\t\t", 
      RowBox[{"{", "None", "}"}], ",", "\n", "\t\t", 
      RowBox[{"{", "displacements", "}"}]}], "\n", "\t", "}"}], " ", "/;", 
    " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "displacements", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "coordinates", "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"one", " ", "position"}], ",", " ", 
    RowBox[{"several", " ", "displacements"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"displacements_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", 
         RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
    " ", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"ConstantArray", "[", " ", 
       RowBox[{"coordinates", " ", ",", " ", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "]"}], ",", "\n", 
      "\t", 
      RowBox[{"ConstantArray", "[", " ", 
       RowBox[{"None", " ", ",", " ", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "]"}], ",", "\n", 
      "\t", "displacements"}], "\n", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"ArrayDepth", "[", "displacements", "]"}], "==", "3"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"Dimensions", "[", " ", 
       RowBox[{"displacements", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", 
      RowBox[{"Dimensions", "[", "coordinates", "]"}]}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"one", " ", "positions"}], ",", " ", 
    RowBox[{"multiple", " ", "stresses", " ", "and", " ", 
     RowBox[{"displacements", " ", "--"}], " ", "these", " ", "should", " ", 
     "match"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
     RowBox[{"stresses_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", ",", " ", 
     RowBox[{"displacements_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"{", "coordinates", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "stresses", "}"}], ",", "\n", "\t", 
      RowBox[{"{", "displacements", "}"}]}], "\n", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "displacements", "]"}], " ", "==", " ", 
      RowBox[{"Dimensions", "[", "coordinates", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "stresses", "]"}], " ", "==", " ", 
      "edgeNumber"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "multiple", " ", "positions", " ", "but", " ", "no", " ", "stresses", " ", 
    "or", " ", "displacements"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", " ", 
         RowBox[{"#", ",", " ", "_", ",", " ", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"coordinates", ",", "\n", "\t", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", ",", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}], ",", "\n", "\t", 
     
     RowBox[{"ConstantArray", "[", 
      RowBox[{"None", ",", 
       RowBox[{"Length", "[", "coordinates", "]"}]}], "]"}]}], "\n", "}"}]}], 
  "\n", 
  RowBox[{"(*", 
   RowBox[{
   "multiple", " ", "positions", " ", "and", " ", "multiple", " ", 
    "stresses"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", " ", 
         RowBox[{"#", ",", " ", "_", ",", " ", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"stresses_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"coordinates", ",", "\n", "\t", "stresses", ",", "\n", "\t", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"None", ",", 
        RowBox[{"Length", "[", "stresses", "]"}]}], "]"}]}], "\n", "}"}], " ",
     "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", " ", 
       RowBox[{"stresses", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", 
      "edgeNumber"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "stresses", "]"}], " ", "==", " ", 
      RowBox[{"Length", "[", "coordinates", "]"}]}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "multiple", " ", "positions", " ", "and", " ", "multiple", " ", 
    "displacements"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", " ", 
         RowBox[{"#", ",", " ", "_", ",", " ", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"None", "|", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"displacements_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", 
         RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
    " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{"coordinates", ",", "\n", "\t", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"None", ",", 
        RowBox[{"Length", "[", "displacements", "]"}]}], "]"}], ",", "\n", 
      "\t", "displacements"}], "\n", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"Dimensions", "[", "displacements", "]"}], " ", "==", " ", 
     RowBox[{"Dimensions", "[", "coordinates", "]"}]}]}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"multiple", " ", "positions"}], ",", " ", 
    RowBox[{"stresses", " ", "and", " ", "displacements"}]}], "*)"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"expandInputs", "[", " ", 
    RowBox[{"edgeNumber_", " ", ",", " ", 
     RowBox[{"coordinates_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", " ", 
         RowBox[{"#", ",", " ", "_", ",", " ", "NumericQ"}], "]"}], "&"}], 
       ")"}]}], ",", " ", 
     RowBox[{"stresses_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"MatrixQ", "[", 
         RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", " ", 
     RowBox[{"displacements_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ArrayQ", "[", 
         RowBox[{"#", ",", "_", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], 
    " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
     "coordinates", ",", "\n", "\t", "stresses", ",", "\n", "\t", 
      "displacements"}], "\n", "}"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "displacements", "]"}], " ", "==", " ", 
      RowBox[{"Dimensions", "[", "coordinates", "]"}]}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", " ", 
       RowBox[{"stresses", "[", 
        RowBox[{"[", "1", "]"}], "]"}], " ", "]"}], " ", "==", " ", 
      "edgeNumber"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{"Length", "[", "stresses", "]"}], " ", "==", " ", 
      RowBox[{"Length", "[", "displacements", "]"}]}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"expandInputs", "[", " ", 
   RowBox[{
   "edgeNumber_", ",", " ", "coordinates_", " ", ",", " ", "stresses_", ",", 
    " ", "displacements_"}], "]"}], " ", ":=", " ", 
  RowBox[{"(", "\n", "\t", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "is", " ", "everything", " ", "numerical", " ", "if", " ", "well"}], "-",
      "formed"}], "*)"}], "\n", "\t", 
   RowBox[{
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", 
         RowBox[{"coordinates", ",", " ", "NumericQ"}], "]"}], "]"}]}], " ", 
      ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "npos"}], ",", " ", "coordinates"}], 
       "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"ArrayQ", "[", 
         RowBox[{"coordinates", ",", "_", ",", "NumericQ"}], "]"}], "]"}]}], 
      ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "npos"}], ",", " ", "coordinates"}], 
       "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"VectorQ", "[", "stresses", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"VectorQ", "[", 
         RowBox[{"stresses", ",", "NumericQ"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numstress"}], ",", " ", "stresses"}], 
       "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "stresses", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", 
         RowBox[{"stresses", ",", "NumericQ"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numstress"}], ",", " ", "stresses"}], 
       "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", 
         RowBox[{"displacements", ",", "NumericQ"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdisp"}], ",", " ", 
        "displacements"}], "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"ArrayQ", "[", 
         RowBox[{"displacements", ",", "NumericQ"}], "]"}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdisp"}], ",", " ", 
        "displacements"}], "]"}]}], "]"}], ";", "\n", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{"are", " ", "displacements", " ", "the", " ", "right", " ", 
      RowBox[{"size", "?"}]}], "*)"}], "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"MatrixQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", "displacements", "]"}], "==", 
         RowBox[{"Dimensions", "[", "coordinates", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdispl"}], ",", " ", 
        RowBox[{"Dimensions", "[", "coordinates", "]"}]}], "]"}]}], "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"ArrayQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", "displacements", "]"}], "==", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"coordinates", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdispl"}], ",", " ", 
        RowBox[{"Dimensions", "[", "coordinates", "]"}]}], "]"}]}], "]"}], 
    ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"ArrayQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Dimensions", "[", 
          RowBox[{"displacements", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"coordinates", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdispl"}], ",", " ", 
        RowBox[{"Dimensions", "[", 
         RowBox[{"coordinates", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", "\n", 
    "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{"are", " ", "stresses", " ", "the", " ", "right", " ", 
      RowBox[{"size", "?"}]}], "*)"}], "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"VectorQ", "[", "stresses", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"edgeNumber", " ", "==", " ", 
         RowBox[{"Length", "[", "stresses", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "stressmatch"}], ",", " ", 
        "edgeNumber"}], "]"}]}], "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"MatrixQ", "[", "stresses", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"edgeNumber", " ", "==", " ", 
         RowBox[{"Length", "[", 
          RowBox[{"stresses", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "stressmatch"}], ",", " ", 
        "edgeNumber"}], "]"}]}], "]"}], ";", "\n", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"same", " ", "number", " ", "of", " ", "coordinates"}], ",", 
      " ", "stresses", ",", " ", 
      RowBox[{"and", " ", 
       RowBox[{"displacements", "?"}]}]}], "*)"}], "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"MatrixQ", "[", "stresses", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Length", "[", "coordinates", "]"}], " ", "==", " ", 
         RowBox[{"Length", "[", "stresses", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numinst"}], "]"}]}], " ", "]"}], ";", 
    "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"ArrayQ", "[", "coordinates", "]"}], " ", "&&", " ", 
       RowBox[{"ArrayQ", "[", "displacements", "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"Length", "[", "coordinates", "]"}], " ", "==", " ", 
         RowBox[{"Length", "[", "displacements", "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "numinstdisp"}], "]"}]}], " ", "]"}], 
    ";", "\n", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
     "not", " ", "well", " ", "formed", " ", "displacements", " ", "or", " ", 
      "stresses"}], "*)"}], "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", "displacements", "]"}], "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"ArrayQ", "[", "displacements", "]"}], "]"}], " ", "&&", " ", 
       
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"displacements", "===", "None"}], "|", 
         RowBox[{"{", "}"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "numdispl"}], ",", " ", 
        RowBox[{"Dimensions", "[", "coordinates", "]"}]}], "]"}]}], " ", 
     "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"VectorQ", "[", "stresses", "]"}], "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{
         RowBox[{"MatrixQ", "[", "stresses", "]"}], " ", "&&", " ", 
         RowBox[{"Not", "[", 
          RowBox[{
           RowBox[{"stresses", "===", "None"}], "|", 
           RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PlotMechanism", "::", "stressmatch"}], ",", " ", 
        "edgeNumber"}], "]"}]}], " ", "]"}], ";", "\n", "\t", 
    RowBox[{"If", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatrixQ", "[", "coordinates", "]"}], "]"}], " ", "&&", " ", 
       RowBox[{"Not", "[", 
        RowBox[{"ArrayQ", "[", "coordinates", "]"}], "]"}]}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{"PlotMechanism", "::", "pos"}], "]"}]}], " ", "]"}], ";", "\n",
     "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"$Failed", ",", "$Failed", ",", "$Failed"}], "}"}]}], "\n", 
   ")"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7794]:=",ExpressionUUID->"63cc1811-f31a-4ae6-b451-e596a6650ac2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "npos"}], " ", "=", " ", 
   "\"\<Coordinates `1` are not numeric.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "pos"}], " ", "=", " ", 
   "\"\<Requested display coordinates are not valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numstress"}], "=", 
   "\"\<Stresses `1` should be a numeric stress or a list of numeric \
stresses.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numdisp"}], "=", 
   "\"\<Displacements `1` must be numerical displacements or a list of \
numerical displacements.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numdispl"}], "=", 
   "\"\<Each displacement should have dimensions `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "stressmatch"}], "=", 
   "\"\<Stresses should agree with the number of edges, `1`.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numinst"}], " ", "=", " ", 
   "\"\<There must be as many stresses as number of mechanism copies to plot.\
\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotMechanism", "::", "numinstdisp"}], " ", "=", " ", 
   "\"\<There must be as many displacements as number of mechanism copies to \
plot.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7806]:=",ExpressionUUID->"c147ed39-8949-4292-be7f-d71a91d02de6"],

Cell[CellGroupData[{

Cell["plotSizes[]", "Subsubsection",ExpressionUUID->"41036322-b489-45d6-a4a8-c4b2fc22031e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "clip", " ", "the", " ", "bounding", " ", "box", " ", "to", " ", "a", " ", 
    "minimum", " ", "size"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"$minsize", "=", "0.25"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"minSize", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x", "-", "$minsize"}], ",", " ", 
       RowBox[{"x", "+", "$minsize"}]}], " ", "}"}], " ", "/;", " ", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"y", "-", "x"}], "]"}], " ", "<", " ", "$minsize"}]}]}], "\n", 
   
   RowBox[{
    RowBox[{"minSize", "[", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_"}], "}"}], "]"}], " ", ":=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "-", "$minsize"}], ",", " ", 
      RowBox[{"y", "+", "$minsize"}]}], "}"}]}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "figure", " ", "out", " ", "plot", " ", "range", " ", "and", " ", 
     "ratios"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"plotSizes", "[", "positions_", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "\n", "}"}],
       ",", "\n", "\t", 
      RowBox[{
       RowBox[{"boundingRegion", " ", "=", " ", "\n", "\t\t", 
        RowBox[{"minSize", " ", "/@", " ", 
         RowBox[{"(", 
          RowBox[{"Transpose", " ", "@", "  ", 
           RowBox[{"CoordinateBoundingBox", "[", "positions", "]"}]}], 
          ")"}]}]}], ";", "\n", "\t", 
       RowBox[{"boundingBoxRatios", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], " ", "&"}], ")"}], " ", "/@", 
         " ", "boundingRegion"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"boundingRegion", ",", " ", "boundingBoxRatios"}], "}"}]}]}], 
     "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7814]:=",ExpressionUUID->"1e65c65e-c390-4436-963f-5839fb0f2d6f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["boundingRegions[], graphicsDirective[], graphicsOptions[]", \
"Subsubsection",ExpressionUUID->"3158cbe2-8da5-435f-9855-4818c97962d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"boundingRegions", "[", " ", 
   RowBox[{"m_", ",", " ", "$Failed"}], "]"}], " ", ":=", " ", 
  "$Failed"}], "\n", 
 RowBox[{
  RowBox[{"boundingRegions", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"graphics", " ", ":", " ", 
     RowBox[{"{", "__GraphicsComplex", "}"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"plotSizes", "[", " ", 
   RowBox[{"Flatten", "[", " ", 
    RowBox[{
     RowBox[{"graphics", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", " ", "1"}], " ", "]"}], 
   " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"boundingRegions", "[", " ", 
    RowBox[{"m_", ",", " ", "pos_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"plotSizes", "[", "pos", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"graphicsDirective", "[", " ", 
   RowBox[{"m_", ",", " ", "$Failed", ",", " ", "dim_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"(", 
   RowBox[{"#", "&"}], ")"}]}], "\n", 
 RowBox[{
  RowBox[{"graphicsDirective", "[", " ", 
   RowBox[{"m_", ",", " ", 
    RowBox[{"graphics", " ", ":", " ", 
     RowBox[{"{", "__GraphicsComplex", "}"}]}], ",", " ", "expectedDim_"}], 
   " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dims", " ", "=", " ", 
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"graphics", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1", ",", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"Which", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{"Not", "[", " ", 
       RowBox[{"Equal", " ", "@@", " ", "dims"}], " ", "]"}], ",", " ", 
      RowBox[{"(", 
       RowBox[{"#", "&"}], ")"}], ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "2"}], ",", " ", 
      "Graphics", ",", "\n", "\t\t", 
      RowBox[{
       RowBox[{"dims", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "3"}], ",", " ", 
      "Graphics3D", ",", "\n", "\t\t", "True", ",", " ", 
      RowBox[{"(", 
       RowBox[{"#", "&"}], ")"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{"graphicsDirective", "[", 
    RowBox[{"m_", ",", " ", "graphics_", ",", " ", "expectedDim_"}], " ", 
    "]"}], " ", ":=", " ", "\n", "\t", 
   RowBox[{"Switch", "[", " ", 
    RowBox[{
    "expectedDim", ",", "\n", "\t\t", "2", ",", " ", "Graphics", ",", " ", 
     "\n", "\t\t", "3", ",", " ", "Graphics3D", ",", "\n", "\t\t", "_", ",", 
     " ", 
     RowBox[{"(", 
      RowBox[{"#", "&"}], ")"}]}], "\n", "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"graphicsOptions", "[", " ", 
   RowBox[{"options_", ",", " ", "directive_", ",", " ", "$Failed"}], " ", 
   "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\n", 
 RowBox[{
  RowBox[{"graphicsOptions", "[", " ", 
   RowBox[{"options_", ",", " ", "directive_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"boundingRegion_", ",", " ", "boundingRatios_"}], "}"}]}], " ", 
   "]"}], " ", ":=", "\n", "\t", 
  RowBox[{"Join", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{"FilterRules", "[", 
     RowBox[{
      RowBox[{"{", "options", "}"}], ",", 
      RowBox[{"Options", "[", "Graphics3D", "]"}]}], "]"}], ",", " ", "\n", 
    "\t\t", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Boxed", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"Lighting", "\[Rule]", "\"\<Neutral\>\""}], ",", 
      RowBox[{"PlotRange", " ", "\[Rule]", " ", "boundingRegion"}], ",", " ", 
      
      RowBox[{"BoxRatios", " ", "\[Rule]", " ", "boundingRatios"}]}], "}"}]}],
    "\n", "\t", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7818]:=",ExpressionUUID->"274ece50-9947-4d40-9f3e-6f0f5cb59add"]
}, Open  ]],

Cell[CellGroupData[{

Cell["getStressScale[], plotStresses[]", "Subsubsection",ExpressionUUID->"6db47837-09f4-490d-be89-995898f5d632"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getStressScale", "[", " ", "stresses_", " ", "]"}], " ", ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"tmp", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{"stresses", ",", " ", "None"}], "]"}]}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{"Max", "[", " ", 
     RowBox[{
      RowBox[{"Max", "[", 
       RowBox[{"tmp", ",", "0"}], "]"}], ",", " ", 
      RowBox[{"Abs", " ", "@", " ", 
       RowBox[{"Min", "[", 
        RowBox[{"tmp", ",", "0"}], "]"}]}]}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7826]:=",ExpressionUUID->"33e99287-32ab-4598-b9f4-43e157e76d49"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotStresses", "[", " ", 
    RowBox[{
    "_", " ", ",", " ", "_", " ", ",", " ", "_", " ", ",", " ", "None", ",", 
     " ", "_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotStresses", "[", " ", 
    RowBox[{
    "stressScale_", ",", " ", "edges_", ",", " ", "coordinates_", ",", " ", 
     "stress_", ",", " ", "stressFunc_Function"}], " ", "]"}], " ", ":=", 
   "\n", "\t", 
   RowBox[{"plotStresses", "[", " ", 
    RowBox[{
    "stressScale", ",", " ", "edges", ",", " ", "coordinates", ",", " ", 
     "stress", ",", " ", 
     RowBox[{"{", 
      RowBox[{"stressFunc", ",", " ", "stressFunc"}], "}"}]}], " ", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"plotStresses", "[", " ", 
   RowBox[{
   "stressScale_", ",", " ", "edges_", ",", " ", "coordinates_", ",", " ", 
    "stress_", ",", " ", 
    RowBox[{"{", 
     RowBox[{"posStress_Function", ",", " ", "negStress_Function"}], "}"}]}], 
   " ", "]"}], " ", ":=", "\n", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"coordinatePairs", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"coordinates", "[", 
          RowBox[{"[", " ", "#", " ", "]"}], "]"}], "&"}], " ", "/@", " ", 
        "edges"}]}], ",", "\n", "\t", 
      RowBox[{"normalizedStresses", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"stressScale", ">", "0"}], ",", " ", 
         RowBox[{"stress", "/", "stressScale"}], ",", " ", "stress"}], " ", 
        "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{"MapThread", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"#2", "<", "0"}], ",", " ", 
         RowBox[{"negStress", "[", " ", 
          RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], ",", " ", 
         RowBox[{"#2", ">", "0"}], ",", " ", 
         RowBox[{"posStress", "[", " ", 
          RowBox[{"#1", ",", " ", "#2"}], " ", "]"}], ",", " ", "True", ",", 
         " ", 
         RowBox[{"{", "}"}]}], " ", "]"}], "&"}], ",", "\n", "\t\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"coordinatePairs", ",", "\n", "\t\t", "normalizedStresses"}], 
       "\n", "\t\t", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7827]:=",ExpressionUUID->"911928c9-1776-49d7-bdc1-00a706563c2f"]
}, Closed]],

Cell[CellGroupData[{

Cell["getDisplacementScale[], plotDisplacements[]", "Subsubsection",ExpressionUUID->"b5eb9bb4-86b7-4453-beb7-26e0f999bb46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getDisplacementScale", "[", "displacements_", "]"}], " ", ":=", 
  " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tmp", " ", "=", " ", 
      RowBox[{"DeleteCases", "[", " ", 
       RowBox[{"displacements", ",", " ", "None"}], " ", "]"}]}], "}"}], ",", 
    "\n", "\t", 
    RowBox[{"Max", "[", " ", 
     RowBox[{"Map", "[", 
      RowBox[{"Norm", " ", ",", " ", "tmp", ",", " ", 
       RowBox[{"{", "2", "}"}]}], " ", "]"}], " ", "]"}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:12 \
In[7830]:=",ExpressionUUID->"44617709-0bba-4f10-8b77-044806d4abf7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacements", "[", " ", 
    RowBox[{
    "_", ",", " ", "_", ",", " ", "None", ",", " ", "_", ",", " ", "_"}], " ",
     "]"}], " ", ":=", " ", 
   RowBox[{"{", "}"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDisplacements", "[", " ", 
    RowBox[{
    "maxDisplacement_", ",", " ", "coordinates_", ",", " ", "displacement_", 
     ",", " ", "displacementScale_", ",", " ", "style_"}], "]"}], " ", ":=", 
   "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"padding", " ", "=", " ", "0.9"}], "}"}], ",", "\n", "\t", 
     RowBox[{"Flatten", " ", "@", " ", 
      RowBox[{"MapThread", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"displacementGraphic", "[", " ", "style", " ", "]"}], ",", 
        "\n", "\t\t", 
        RowBox[{"{", "\n", "\t\t\t", 
         RowBox[{"coordinates", ",", "\n", "\t\t\t", 
          RowBox[{"displacementScale", " ", "*", " ", 
           RowBox[{"displacement", "/", "maxDisplacement"}]}]}], "\n", "\t\t",
          "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementGraphic", "[", " ", "style_", " ", "]"}], "[", " ", 
   RowBox[{"vertexLocation_", ",", " ", "displacement_"}], " ", "]"}], " ", ":=",
   " ", "\n", "\t", 
  RowBox[{"{", "\n", "\t", 
   RowBox[{"style", ",", "\n", "\t", 
    RowBox[{"Arrow", "[", " ", 
     RowBox[{"{", 
      RowBox[{"vertexLocation", ",", " ", 
       RowBox[{"vertexLocation", " ", "+", " ", "displacement"}]}], "}"}], 
     " ", "]"}]}], "\n", "\t", "}"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7831]:=",ExpressionUUID->"55774fc6-ee2b-44c0-b416-d3132ebf9238"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["PeriodicPlotMechanism[]", "Section",ExpressionUUID->"1bb3900a-8860-49fe-a371-094dcdb4300c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "PeriodicPlotMechanism", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Options", "[", "PlotMechanism", "]"}], ",", "\n", "\t", 
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{"\"\<Scale\>\"", " ", "->", " ", 
        RowBox[{"3", "/", "2"}]}], "\n", "\t", "}"}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"scaleQ", "[", " ", "n_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"NumericQ", "[", "n", "]"}], " ", "&&", " ", 
      RowBox[{"1", " ", "<=", " ", "n", " ", "<=", " ", "2"}]}], ",", " ", 
     "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"PeriodicPlotMechanism", "::", "scale"}], ",", " ", "n"}], 
       "]"}], ";", " ", "False"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PeriodicPlotMechanism", "::", "scale"}], "=", 
    "\"\<Option \\\"Scale\\\" must be a number between 1 and 2.\>\""}], ";"}],
   "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicPlotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "PeriodicMechanismQ"}], " ", ",", " ", "rest___"}], 
    "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"PeriodicPlotMechanism", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"m", ",", " ", 
       RowBox[{"PeriodicIdentification", "[", "m", "]"}]}], "}"}], " ", ",", 
     " ", "rest"}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicPlotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
       "pi_PeriodicIdentificationData"}], "}"}], ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"plotsize", " ", "=", " ", 
         RowBox[{"RegionBounds", "[", " ", 
          RowBox[{"RegionResize", "[", " ", 
           RowBox[{
            RowBox[{"BoundingRegion", "[", " ", 
             RowBox[{"MechanismPositions", "[", "m", "]"}], " ", "]"}], " ", 
            ",", " ", 
            RowBox[{"Scaled", "[", 
             RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}], "]"}]}], " ",
            "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"basis", " ", "=", " ", 
         RowBox[{"pi", "[", "\"\<LatticeVectors\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"MechanismPositions", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"opaqueMechanism", " ", "=", " ", 
         RowBox[{
          RowBox[{"ChangeCellData", "[", 
           RowBox[{
            RowBox[{"MechanismCells", "[", "_", "]"}], ",", " ", 
            RowBox[{"\"\<Label\>\"", "->", "None"}]}], "]"}], " ", "@", " ", 
          RowBox[{
           RowBox[{"ChangeCellData", "[", 
            RowBox[{
             RowBox[{"MechanismCells", "[", "_", "]"}], ",", " ", 
             RowBox[{"\"\<Style\>\"", " ", "->", " ", 
              RowBox[{"Opacity", "[", "0.25", "]"}]}]}], "]"}], " ", "@", " ",
            "m"}]}]}], ",", "\n", "\t", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"generateIndices", "[", " ", 
          RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], " ", 
          "]"}]}], ",", "\n", "\t", 
        RowBox[{"scale", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}]}]}], "\n", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"Show", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"PlotMechanism", "[", 
         RowBox[{"m", ",", " ", "opt"}], "]"}], ",", "\n", "\t\t", 
        RowBox[{"PlotMechanism", "[", " ", 
         RowBox[{"opaqueMechanism", ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"translateMechanismPositions", "[", " ", 
             RowBox[{"positions", ",", " ", "basis", ",", " ", "#"}], "]"}], 
            " ", "&"}], " ", "/@", " ", "indices"}]}], "\n", "\t\t", "]"}], 
        ",", "\n", "\t\t", 
        RowBox[{"PlotRange", " ", "->", " ", "plotsize"}]}], "\n", "\t", 
       "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"scaleQ", "[", " ", 
     RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}], " ", "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PeriodicPlotMechanism", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
       "pi_PeriodicIdentificationData"}], "}"}], ",", " ", 
     RowBox[{"pos_", "?", "MatrixQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"plotsize", " ", "=", " ", 
         RowBox[{"RegionBounds", "[", " ", 
          RowBox[{"RegionResize", "[", " ", 
           RowBox[{
            RowBox[{"BoundingRegion", "[", " ", 
             RowBox[{"MechanismPositions", "[", "m", "]"}], " ", "]"}], " ", 
            ",", " ", 
            RowBox[{"Scaled", "[", 
             RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}], "]"}]}], " ",
            "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"basis", " ", "=", " ", 
         RowBox[{"pi", "[", "\"\<LatticeVectors\>\"", "]"}]}], ",", "\n", 
        "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"MechanismPositions", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"opaqueMechanism", " ", "=", " ", 
         RowBox[{
          RowBox[{"ChangeCellData", "[", 
           RowBox[{
            RowBox[{"MechanismCells", "[", "_", "]"}], ",", " ", 
            RowBox[{"\"\<Label\>\"", "->", "None"}]}], "]"}], " ", "@", " ", 
          RowBox[{
           RowBox[{"ChangeCellData", "[", 
            RowBox[{
             RowBox[{"MechanismCells", "[", "_", "]"}], ",", " ", 
             RowBox[{"\"\<Style\>\"", " ", "->", " ", 
              RowBox[{"Opacity", "[", "0.25", "]"}]}]}], "]"}], " ", "@", " ",
            "m"}]}]}], ",", "\n", "\t", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"generateIndices", "[", " ", 
          RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], " ", 
          "]"}]}], ",", "\n", "\t", 
        RowBox[{"scale", " ", "=", " ", 
         RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}]}]}], "\n", "}"}], 
      ",", "\n", "\t", 
      RowBox[{"Show", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"PlotMechanism", "[", 
         RowBox[{"m", ",", " ", "pos", ",", " ", "opt"}], "]"}], ",", "\n", 
        "\t\t", 
        RowBox[{"PlotMechanism", "[", " ", 
         RowBox[{"opaqueMechanism", ",", " ", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"translateMechanismPositions", "[", " ", 
             RowBox[{"pos", ",", " ", "basis", ",", " ", "#"}], "]"}], " ", 
            "&"}], " ", "/@", " ", "indices"}]}], "\n", "\t\t", "]"}], ",", 
        "\n", "\t\t", 
        RowBox[{"PlotRange", "->", " ", "plotsize"}]}], "\n", "\t", "]"}]}], 
     "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"scaleQ", "[", " ", 
      RowBox[{"OptionValue", "[", "\"\<Scale\>\"", "]"}], " ", "]"}], " ", "&&",
      " ", 
     RowBox[{
      RowBox[{"MechanismEmbeddingDimension", "[", "m", "]"}], "==", 
      RowBox[{"Length", "[", 
       RowBox[{"pos", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"generateIndices", "[", " ", "1", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", " ", 
    RowBox[{"DeleteCases", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", "i", "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", " ", 
      RowBox[{"{", "0", "}"}]}], " ", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"generateIndices", "[", " ", "2", " ", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "j"}], "}"}], ",", " ", 
    RowBox[{"DeleteCases", "[", " ", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", "j"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "1"}], "]"}],
       ",", " ", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}]}], " ", "]"}]}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"generateIndices", "[", " ", "3", " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", 
     RowBox[{"DeleteCases", "[", " ", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", "j", ",", "k"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], ",", "1"}], 
        "]"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], " ", "]"}]}], " ", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"translateMechanismPositions", "[", 
   RowBox[{
    RowBox[{"positions_", "?", "MatrixQ"}], " ", ",", " ", "basis_", " ", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"i_", ",", "j_", ",", "k_"}], "}"}]}], "]"}], " ", ":=", " ", 
  "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "i"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", "j"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "3", "]"}], "]"}], " ", "k"}], " ", "+", " ", "#"}], 
      ")"}], " ", "&"}], " ", "/@", " ", "positions"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ">=", "3"}]}]}], "\n", 
 RowBox[{
  RowBox[{"translateMechanismPositions", "[", 
   RowBox[{
    RowBox[{"positions_", "?", "MatrixQ"}], " ", ",", " ", "basis_", " ", ",",
     " ", 
    RowBox[{"{", 
     RowBox[{"i_", ",", "j_"}], "}"}]}], "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "i"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "2", "]"}], "]"}], " ", "j"}], " ", "+", " ", "#"}], 
      ")"}], " ", "&"}], " ", "/@", " ", "positions"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ">=", "2"}]}]}], "\n", 
 RowBox[{
  RowBox[{"translateMechanismPositions", "[", 
   RowBox[{
    RowBox[{"positions_", "?", "MatrixQ"}], " ", ",", " ", "basis_", " ", ",",
     " ", 
    RowBox[{"{", "i_", "}"}]}], "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"basis", "[", 
         RowBox[{"[", "1", "]"}], "]"}], " ", "i"}], " ", "+", " ", "#"}], 
      ")"}], " ", "&"}], " ", "/@", " ", "positions"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"positions", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], ">=", "1"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7834]:=",ExpressionUUID->"1104144b-be66-40d8-bc25-ddae9d9dde62"]
}, Closed]],

Cell[CellGroupData[{

Cell["Experimental code", "Section",ExpressionUUID->"3efe547a-f1ac-4ffb-8444-d2b58598608b"],

Cell[CellGroupData[{

Cell["scalePolygon[]", "Subsection",ExpressionUUID->"030fa22e-305a-45e4-b6b6-74f92db2e39b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"scalePolygon", "[", 
   RowBox[{"coords_", " ", ",", " ", "shrinkBy_"}], " ", "]"}], ":=", "\n", 
  RowBox[{"With", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", "\t", 
     RowBox[{"center", " ", "=", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{
        RowBox[{"Mean", "[", "coords", "]"}], ",", 
        RowBox[{"Length", "[", "coords", "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", "\t", 
    RowBox[{"center", " ", "+", " ", 
     RowBox[{
      RowBox[{"Clip", "[", 
       RowBox[{
        RowBox[{"1", "-", "shrinkBy"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1"}], "}"}]}], "]"}], " ", 
      RowBox[{"(", 
       RowBox[{"coords", "-", "center"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7846]:=",ExpressionUUID->"580bd134-fe46-489b-be75-aa685f0fcd22"]
}, Closed]],

Cell[CellGroupData[{

Cell["ExtrudedPolygon[]", "Subsection",ExpressionUUID->"50641957-a476-4037-b81c-36b8b7785b1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExtrudedPolygon", "[", " ", 
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
       RowBox[{"thickness2_", "?", "NumericQ"}]}], " ", "}"}], " ", "]"}], 
    "[", "coords_", "]"}], " ", ":=", "\n", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{"extrusionVector", " ", "=", " ", 
        RowBox[{"First", " ", "@", " ", 
         RowBox[{"NormalVector", "[", 
          RowBox[{"coords", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"1", ",", "2", ",", "3"}], "}"}], "}"}]}], "]"}]}]}], 
       "}"}], ",", "\n", "\t", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{
          RowBox[{"Face1", " ", "=", " ", 
           RowBox[{"coords", " ", "+", " ", 
            RowBox[{"thickness1", " ", 
             RowBox[{"ConstantArray", "[", " ", 
              RowBox[{"extrusionVector", ",", " ", 
               RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], 
          ",", "\n", "\t\t", 
          RowBox[{"Face2", " ", "=", " ", 
           RowBox[{"coords", " ", "+", " ", 
            RowBox[{"thickness2", " ", 
             RowBox[{"ConstantArray", "[", " ", 
              RowBox[{"extrusionVector", " ", ",", " ", 
               RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
         "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Polyhedron", " ", "@", " ", 
         RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{
           RowBox[{
           "{", "\[IndentingNewLine]", "\t\t\t", "Face1", 
            "\[IndentingNewLine]", "\t\t\t", "}"}], ",", 
           "\[IndentingNewLine]", "\t\t\t", 
           RowBox[{"MapThread", "[", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",",
              " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
               RowBox[{"Partition", "[", 
                RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
              "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
            "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
       "\[IndentingNewLine]", "\t", "]"}]}], " ", "\n", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", "3"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExtrudedPolygon", "[", " ", 
     RowBox[{
      RowBox[{"extrusionVector", " ", ":", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"_", "?", "NumericQ"}], ",", " ", 
         RowBox[{"_", "?", "NumericQ"}], ",", " ", 
         RowBox[{"_", "?", "NumericQ"}]}], "}"}]}], " ", ",", " ", 
      RowBox[{"{", " ", 
       RowBox[{
        RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
        RowBox[{"thickness2_", "?", "NumericQ"}]}], " ", "}"}]}], " ", "]"}], 
    "[", "coords_", "]"}], " ", ":=", "\n", "\t", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Face1", " ", "=", " ", 
         RowBox[{"coords", " ", "+", " ", 
          RowBox[{"thickness1", " ", 
           RowBox[{"ConstantArray", "[", " ", 
            RowBox[{"extrusionVector", ",", " ", 
             RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], ",", 
        "\n", "\t\t", 
        RowBox[{"Face2", " ", "=", " ", 
         RowBox[{"coords", " ", "+", " ", 
          RowBox[{"thickness2", " ", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"extrusionVector", " ", ",", " ", 
             RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
       "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
      RowBox[{"Polyhedron", " ", "@", " ", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
        RowBox[{
         RowBox[{
         "{", "\[IndentingNewLine]", "\t\t\t", "Face1", "\[IndentingNewLine]",
           "\t\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{"MapThread", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{"#1", ",", 
              RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
             RowBox[{"Partition", "[", 
              RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
            "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
         RowBox[{"{", "\n", "\t\t\t", 
          RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
          "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
     "\[IndentingNewLine]", "\t", "]"}], " ", "/;", " ", 
    RowBox[{
     RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", "3"}]}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtrudedPolygon", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"thickness1_", "?", "NumericQ"}], ",", " ", 
      RowBox[{"thickness2_", "?", "NumericQ"}]}], "}"}], "]"}], "[", 
   "coords_", "]"}], " ", ":=", "\n", "\t", 
  RowBox[{
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{"coords2", " ", "=", " ", 
       RowBox[{"PadRight", "[", " ", 
        RowBox[{"coords", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "[", "coords", "]"}], ",", "3"}], "}"}]}], " ", 
        "]"}]}], " ", "}"}], ",", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Face1", " ", "=", " ", 
          RowBox[{"coords2", " ", "+", " ", 
           RowBox[{"thickness1", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], " ", ",", " ", 
              RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}], ",",
          "\n", "\t\t", 
         RowBox[{"Face2", " ", "=", " ", 
          RowBox[{"coords2", " ", "+", " ", 
           RowBox[{"thickness2", " ", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1"}], "}"}], " ", ",", " ", 
              RowBox[{"Length", "[", "coords", "]"}]}], " ", "]"}]}]}]}]}], 
        "\n", "\t\t", "}"}], ",", "\[IndentingNewLine]", "\t\t", 
       RowBox[{"Polyhedron", " ", "@", " ", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{
          RowBox[{
          "{", "\[IndentingNewLine]", "\t\t\t", "Face1", 
           "\[IndentingNewLine]", "\t\t\t", "}"}], ",", "\[IndentingNewLine]",
           "\t\t\t", 
          RowBox[{"MapThread", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"Reverse", "[", "#2", "]"}]}], "]"}], "&"}], " ", ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{"Face1", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
              RowBox[{"Partition", "[", 
               RowBox[{"Face2", ",", "2", ",", "1", ",", "1"}], "]"}]}], 
             "}"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{"Reverse", " ", "@", " ", "Face2"}], "\n", "\t\t\t", 
           "}"}]}], "\[IndentingNewLine]", "\t\t", "]"}]}]}], 
      "\[IndentingNewLine]", "\t", "]"}]}], "]"}], " ", "/;", " ", 
   RowBox[{
    RowBox[{"MatrixQ", "[", "coords", "]"}], " ", "&&", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Dimensions", "[", "coords", "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}], " ", "\[Equal]", " ", 
     "2"}]}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7847]:=",ExpressionUUID->"da7e70de-e1ad-47c1-a2cd-4e867b497a28"]
}, Closed]],

Cell[CellGroupData[{

Cell["shrinkPolygon[]", "Subsection",ExpressionUUID->"5b510d4d-6e9e-491c-94a7-2f5adbe7cbe3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"shrinkPolygon", "[", " ", 
    RowBox[{"pts_", ",", " ", "widths_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"pts", " ", "+", " ", 
    RowBox[{"Total", " ", "@", " ", 
     RowBox[{"MapIndexed", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"shrinkPolygonSide", "[", " ", 
         RowBox[{"pts", ",", " ", 
          RowBox[{"#2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", "#1"}], " ", "]"}], 
        "&"}], ",", " ", "widths"}], " ", "]"}]}]}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"shrinkPolygonSide", "[", " ", 
   RowBox[{"pts_", ",", " ", "v1_", ",", " ", "width_"}], " ", "]"}], " ", ":=",
   "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", "pts", "]"}]}], ",", " ", "v2", ",", " ", 
      "future", ",", " ", "past", ",", " ", "futureEdge", ",", " ", "edge", 
      ",", " ", "pastEdge"}], "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"v2", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"future", "=", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v2", "+", "1"}], ",", " ", "n", ",", " ", "1"}], "]"}]}], 
     ";", " ", 
     RowBox[{"past", " ", "=", " ", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"v1", "-", "1"}], ",", "n", ",", "1"}], "]"}]}], ";", "\n", 
     "\t", 
     RowBox[{"edge", "=", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"futureEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "future", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v2", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     RowBox[{"pastEdge", " ", "=", " ", 
      RowBox[{"Normalize", "[", " ", 
       RowBox[{
        RowBox[{"pts", "[", 
         RowBox[{"[", "past", "]"}], "]"}], " ", "-", " ", 
        RowBox[{"pts", "[", 
         RowBox[{"[", "v1", "]"}], "]"}]}], " ", "]"}]}], ";", "\n", "\t", 
     "\n", "\t", 
     RowBox[{"RotateRight", "[", 
      RowBox[{
       RowBox[{"Join", "[", "\n", "\t\t", 
        RowBox[{
         RowBox[{"width", "*", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"pastEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"pastEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"futureEdge", "/", 
             RowBox[{"Norm", "[", " ", 
              RowBox[{"Cross", "[", " ", 
               RowBox[{"futureEdge", ",", " ", "edge"}], " ", "]"}], " ", 
              "]"}]}]}], "\n", "\t\t", "}"}]}], ",", "\n", "\t\t", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"n", "-", "2"}]}], "]"}]}], "\n", "\t", "]"}], ",", " ", 
       RowBox[{"v1", "-", "1"}]}], "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7850]:=",ExpressionUUID->"ae3899bf-8cac-4133-92d1-6bd45cffea08"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PlotConfigurationSpaceCurve[]", "Section",ExpressionUUID->"ec7a5656-c612-4c9f-8a41-276e60b3e771"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "PlotConfigurationSpaceCurve", "]"}], " ", "=", 
    " ", 
    RowBox[{"Join", "[", "\n", "\t", 
     RowBox[{
      RowBox[{"Options", "[", "MechanismTangentForm", "]"}], ",", "\n", "\t", 
      
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"Oriented", " ", "->", " ", "False"}], ",", "\n", "\t", 
        RowBox[{"MaxSteps", " ", "->", " ", 
         RowBox[{"10", "^", "3"}]}], ",", "\n", "\t", 
        RowBox[{"MinSteps", " ", "->", " ", "3"}], ",", "\n", "\t", 
        RowBox[{"PlotStyle", "->", 
         RowBox[{"{", "}"}]}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"Options", "[", "MechanismIsometricTrajectory", "]"}], ",", 
        RowBox[{"Except", "[", 
         RowBox[{"{", 
          RowBox[{"InitialPositions", ",", "StoppingCriteria"}], "}"}], 
         "]"}]}], "]"}], ",", "\n", "\t", 
      RowBox[{"FilterRules", "[", 
       RowBox[{
        RowBox[{"Options", "[", "ListPointPlot3D", "]"}], ",", 
        RowBox[{"Except", "[", "PlotStyle", "]"}]}], "]"}]}], "\n", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"curvePlot", "[", 
    RowBox[{"pointList_", ",", " ", 
     RowBox[{"tol_", " ", ":", " ", "0.25"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"partitionedLine", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"pointList", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "<", "tol"}], "&"}]}], 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"Line", "/@", "partitionedLine"}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"smoothCurvePlot", "[", 
    RowBox[{"pointList_", ",", " ", 
     RowBox[{"tol_", " ", ":", " ", "0.25"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"partitionedLine", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"N", "@", "pointList"}], ",", "2", ",", "1", ",", "1"}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "-", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "<", "tol"}], "&"}]}],
          "]"}]}], ",", "\[IndentingNewLine]", "\t", 
       RowBox[{"rules", "=", 
        RowBox[{"Dispatch", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"pointList", " ", "->", " ", 
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", "pointList", "]"}], "]"}]}], "]"}], 
         "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"BSplineCurve", "[", 
        RowBox[{"pointList", "[", 
         RowBox[{"[", "#", "]"}], "]"}], "]"}], "&"}], "/@", 
      RowBox[{"ConnectedComponents", "[", 
       RowBox[{"partitionedLine", " ", "/.", " ", "rules"}], "]"}]}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"orientedCurvePlot", "[", 
    RowBox[{"pointList_", ",", " ", 
     RowBox[{"arrowNumber_", " ", ":", " ", "5"}], ",", " ", 
     RowBox[{"tol_", " ", ":", " ", "0.25"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"With", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"partitionedLine", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"pointList", ",", "2", ",", "1", ",", "1"}], "]"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "<", "tol"}], "&"}]}], 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Line", "/@", "partitionedLine"}], ",", " ", 
       RowBox[{"Arrow", "/@", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"partitionedLine", ",", 
           RowBox[{"Floor", "[", 
            RowBox[{
             RowBox[{"Length", "[", "partitionedLine", "]"}], "/", 
             "arrowNumber"}], "]"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"criticalPointMeasure", "[", " ", 
    RowBox[{"expression_", " ", ",", " ", "pos_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Norm", "[", 
    RowBox[{"expression", " ", "/.", " ", 
     RowBox[{"N", "[", 
      RowBox[{"PositionRules", "[", "pos", "]"}], "]"}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"computeSegment", "[", 
    RowBox[{
    "m_", ",", " ", "initialPositions_", " ", ",", " ", "initialDirection_", 
     " ", ",", " ", 
     RowBox[{"{", 
      RowBox[{"minSteps_", ",", " ", "maxSteps_"}], "}"}], ",", " ", 
     "stoppingExpression_", " ", ",", " ", "options_"}], "]"}], " ", ":=", 
   " ", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "vars", ",", " ", "rules", " ", ",", " ", "tangentField", ",", " ", 
       "start", ",", " ", "scale"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"start", " ", "=", " ", 
       RowBox[{"MechanismIsometricTrajectory", "[", 
        RowBox[{
        "m", ",", " ", "initialDirection", ",", " ", "minSteps", ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"InitialPositions", " ", "->", " ", "initialPositions"}], 
            ",", 
            RowBox[{"FilterRules", "[", 
             RowBox[{"options", ",", 
              RowBox[{"Options", "[", "MechanismIsometricTrajectory", "]"}]}],
              "]"}]}], "}"}], "]"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"scale", " ", "=", " ", 
       RowBox[{"criticalPointMeasure", "[", " ", 
        RowBox[{"stoppingExpression", " ", ",", " ", 
         RowBox[{"Last", "[", "start", "]"}]}], "]"}]}], ";", "\n", "\t", 
      "\n", "\t", 
      RowBox[{"Join", "[", "\n", "\t\t", 
       RowBox[{
        RowBox[{"Drop", "[", 
         RowBox[{"start", ",", 
          RowBox[{"-", "1"}]}], "]"}], ",", "\n", "\t\t", 
        RowBox[{"MechanismIsometricTrajectory", "[", 
         RowBox[{"m", ",", " ", "initialDirection", ",", " ", 
          RowBox[{"maxSteps", " ", "-", " ", "minSteps"}], ",", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"InitialPositions", " ", "->", " ", 
              RowBox[{"Last", "[", "start", "]"}]}], ",", " ", "\n", "\t\t\t", 
             RowBox[{"StoppingCriteria", " ", "->", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"criticalPointMeasure", "[", 
                  RowBox[{"stoppingExpression", ",", " ", "#"}], "]"}], ">=", 
                 " ", "scale"}], " ", "&"}], ")"}]}], ",", "\n", "\t\t\t", 
             RowBox[{"FilterRules", "[", 
              RowBox[{"options", ",", 
               RowBox[{
               "Options", "[", "MechanismIsometricTrajectory", "]"}]}], 
              "]"}]}], "}"}], "]"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"plotCurveArguments", "[", " ", 
    RowBox[{
    "m_", " ", ",", " ", "initialPositions_", " ", ",", " ", 
     "initialDirection_", " ", ",", " ", "minSteps_", ",", " ", "maxSteps_", 
     " ", ",", " ", "orientedQ_"}], "]"}], " ", ":=", "\n", "\t", 
   RowBox[{"Check", "[", "\n", "\t\t", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"NumericCoordinatesQ", "[", 
          RowBox[{"m", ",", "initialPositions"}], "]"}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"PlotConfigurationSpaceCurve", "::", "pos"}], "]"}]}], " ", 
       "]"}], ";", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"NumericCoordinatesQ", "[", 
          RowBox[{"m", ",", "initialDirection"}], "]"}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"PlotConfigurationSpaceCurve", "::", "dir"}], "]"}]}], " ", 
       "]"}], ";", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"IntegerQ", "[", "minSteps", "]"}], "]"}], " ", "||", " ", 
         RowBox[{"minSteps", " ", "<", " ", "0"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"PlotConfigurationSpaceCurve", "::", "minsteps"}], "]"}]}], 
       " ", "]"}], ";", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"IntegerQ", "[", "maxSteps", "]"}], "]"}], " ", "||", " ", 
         RowBox[{"maxSteps", " ", "<=", " ", "minSteps"}]}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"PlotConfigurationSpaceCurve", "::", "maxsteps"}], "]"}]}], 
       " ", "]"}], ";", "\n", "\t\t", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"BooleanQ", "[", "orientedQ", "]"}], "]"}], ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{"PlotConfigurationSpaceCurve", "::", "oriented"}], "]"}]}], 
       "]"}], ";", "\n", "\t\t", "True"}], ",", "\n", "\t\t", "False"}], "\n",
     "\t", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"PlotConfigurationSpaceCurve", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"{", 
     RowBox[{"initialPositions_", ",", " ", "initialDirection_"}], " ", "}"}],
     " ", ",", " ", "displayFunction_", " ", ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
  "\t", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t\t", 
      RowBox[{
      "vars", ",", " ", "rules", ",", " ", "tangentField", ",", " ", "curve", 
       ",", " ", "dim", ",", " ", "displayCurve"}], "\n", "\t", "}"}], ",", 
     "\n", "\t", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"vars", ",", " ", "rules", ",", " ", "tangentField"}], "}"}], 
       " ", "=", " ", 
       RowBox[{"MechanismTangentForm", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", 
           RowBox[{"Options", "[", "MechanismTangentForm", "]"}]}], "]"}]}], 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{"curve", " ", "=", " ", 
       RowBox[{"computeSegment", "[", 
        RowBox[{
        "m", ",", " ", "initialPositions", ",", " ", "initialDirection", ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OptionValue", "[", "MinSteps", "]"}], ",", 
           RowBox[{"OptionValue", "[", "MaxSteps", "]"}]}], "}"}], ",", " ", 
         RowBox[{"tangentField", " ", "/.", " ", "rules"}], ",", 
         RowBox[{"{", "opt", "}"}]}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"displayCurve", " ", "=", " ", 
       RowBox[{"displayFunction", " ", "/@", " ", "curve"}]}], ";", "\n", 
      "\t", 
      RowBox[{"dim", " ", "=", " ", 
       RowBox[{"Length", "[", 
        RowBox[{"displayCurve", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\n", "\t", 
      RowBox[{"Switch", "[", 
       RowBox[{"dim", ",", "\n", "\t\t", "2", ",", " ", 
        RowBox[{"Show", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"displayFunction", "[", "initialPositions", "]"}], "}"}],
             " ", ",", " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", 
              RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}], "  ", 
           "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"Graphics", "[", "\n", "\t\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "\n", "\t\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"OptionValue", "[", "PlotStyle", "]"}], " ", "/.", " ", 
               RowBox[{"Automatic", "->", "Nothing"}]}], ",", "\n", 
              "\t\t\t\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"OptionValue", "[", "Oriented", "]"}], ",", " ", "\n",
                 "\t\t\t\t\t\t", 
                RowBox[{"orientedCurve", "[", "displayCurve", "]"}], ",", " ",
                 "\n", "\t\t\t\t\t\t", 
                RowBox[{"curvePlot", "[", "displayCurve", "]"}]}], "\n", 
               "\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t", "}"}], "]"}], "\n", 
           "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"PlotRange", "->", 
           RowBox[{"OptionValue", "[", "PlotRange", "]"}]}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\t\t", "\n", "\t\t", "3", ",", " ", 
        RowBox[{"Show", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"ListPointPlot3D", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"displayFunction", "[", "initialPositions", "]"}], "}"}],
             " ", ",", " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"{", "opt", "}"}], ",", 
              RowBox[{"Options", "[", "ListPointPlot3D", "]"}]}], "]"}]}], 
           " ", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"Graphics3D", "[", "\n", "\t\t\t\t", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", "\n", "\t\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"OptionValue", "[", "PlotStyle", "]"}], " ", "/.", " ", 
               RowBox[{"Automatic", "->", "Nothing"}]}], ",", "\n", 
              "\t\t\t\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"OptionValue", "[", "Oriented", "]"}], ",", " ", "\n",
                 "\t\t\t\t\t\t", 
                RowBox[{"orientedCurve", "[", "displayCurve", "]"}], ",", " ",
                 "\n", "\t\t\t\t\t\t", 
                RowBox[{"curvePlot", "[", "displayCurve", "]"}]}], "\n", 
               "\t\t\t\t\t", "]"}]}], "\n", "\t\t\t\t", "}"}], "]"}], "\n", 
           "\t\t\t", "]"}], ",", "\n", "\t\t\t", 
          RowBox[{"PlotRange", "->", 
           RowBox[{"OptionValue", "[", "PlotRange", "]"}]}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\t\t", "_", ",", "\n", "\t\t", "displayCurve"}], 
       "\n", "\t", "]"}]}]}], "\n", "]"}], " ", "/;", " ", 
   RowBox[{"plotCurveArguments", "[", 
    RowBox[{
    "m", ",", " ", "initialPositions", ",", " ", "initialDirection", ",", " ", 
     RowBox[{"OptionValue", "[", "MinSteps", "]"}], ",", " ", 
     RowBox[{"OptionValue", "[", "MaxSteps", "]"}], ",", " ", 
     RowBox[{"OptionValue", "[", "Oriented", "]"}]}], "]"}]}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7852]:=",ExpressionUUID->"2ae41128-b3d0-40d3-aeae-8440a046ff26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions must be numerical and correspond to the mechanism.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "dir"}], " ", "=", " ", 
   "\"\<Initial direction must be numerical and correspond to the \
mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "minsteps"}], " ", "=", " ", 
   "\"\<Minimum number of steps to take before terminating must be a positive \
integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "maxsteps"}], " ", "=", " ", 
   "\"\<Maximum number of steps to take before terminating must be a positive \
integer larger than the minimum number of steps.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlotConfigurationSpaceCurve", "::", "oriented"}], " ", "=", " ", 
   "\"\<Option Oriented must be Boolean.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7860]:=",ExpressionUUID->"83a6a33b-3028-417b-84a0-885aea5b8a5e"]
}, Closed]],

Cell[CellGroupData[{

Cell["post", "Section",ExpressionUUID->"a1375d4f-d82f-42cf-9eb3-c76f31ebb81e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7865]:=",ExpressionUUID->"0f6f47a1-2047-4f40-a070-b68748d33cb4"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mechanisms`critical", "Chapter",ExpressionUUID->"308511ff-4ec7-4b35-a48d-bfb752d66eba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Mechanisms`critical`\>\"", "]"}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7867]:=",ExpressionUUID->"847fab10-bc1e-4282-8d85-92a8538e4ebf"],

Cell[CellGroupData[{

Cell["Usage", "Section",ExpressionUUID->"9d741069-3129-48df-9c60-53f3a57972ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "usage"}], "=", 
   "\"\<MechanismCriticalConfiguration[ m , {s1, s2, ...} ] attempts to \
return a configuration on the critical surface of a mechanism.\nThe vector \
{s1, s2, ..} should have as many components as the number of edges and {s1, \
s2, ..} and {c s1, c s2, ...} return the same result.\n\nOption \
\\\"FixedEdges\\\" allows you to specify a set of edges that are to have \
fixed length.\>\""}], ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7868]:=",ExpressionUUID->"4f3a870a-9e50-4026-b27a-e8b87a14cf13"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismTangentForm", "::", "usage"}], "=", 
    "\"\<MechanismTangentForm[m] computes either a scalar (for generically 0D \
mechanisms), a vector tangent to the configuration space (for generically 1D \
mechanisms) or an antisymmetric matrix (for 2D).\nOutput is of the form { \
variable list , constraint list , tangent form }.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalSet", "::", "usage"}], "=", 
   "\"\<MechanismCriticalSet[m] attempts to compute the critical \
configuration set of a generically 0D or 1D mechanism.\n\
MechanismCriticalSet[m, constraints ] attempts to compute the cross-section \
of the critical configuration set with constraints.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalSetEquations", "::", "usage"}], "=", 
   "\"\<MechanismCriticalSetEquations[m] returns equations to compute the \
critical configuration set of a generically 0D or 1D mechanism.\n\
MechanismCriticalSet[m, constraints ] compute equations for the cross-section \
of the critical configuration set with constraints.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7869]:=",ExpressionUUID->"bc1ef241-ffd3-45c8-8ecb-42c4eca0bad8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCriticalDeterminant", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCriticalDeterminant[ m ] evaluates det( R R^T ), where R is \
the constraint matrix. When this is zero, the mechanism is at a critical \
point.\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCriticalPoint", "::", "usage"}], " ", "=", " ", 
    "\"\<MechanismCriticalPoint[ m ] attempts to find a critical point for a \
given mechanism.\nMechanismCriticalPoint[ m , v] attempts to find a point \
such that det(R R^T) = v for a given mechanism, where R is the constraint \
matrix.\nReturns { det(R R^T) , positions } for the configuration found.\n\n\
Use option InitialPositions to start search from a given set of positions. \
Use CellPattern to specify a subset of cells to constraint, and use \
Constraints to add additional constraints\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MechanismCriticalTrajectory", "::", "usage"}], "=", "\n", 
    "\"\<MechanismCriticalTrajectory[\!\(\*StyleBox[\"Mechanism\",FontSlant->\
\"Italic\"]\), \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\), \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\)] creates a trajectory using \
\!\(\*StyleBox[\"n\",FontSlant->\"Italic\"]\) steps with Det(R R^T), where R \
is the constraint matrix, constant for a Mechanism starting in the\n\
displacement direction \
\!\(\*StyleBox[\"{\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"{\",FontSlant->\
\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]x1\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"\[CapitalDelta]y1\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\",\",FontSlant->\"\
Italic\"]\)\!\(\*StyleBox[\" \
\",FontSlant->\"Italic\"]\)\!\(\*StyleBox[\"..\",FontSlant->\"Italic\"]\)\!\(\
\*StyleBox[\"}\",FontSlant->\"Italic\"]\).\>\""}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTangentVectors", "::", "usage"}], "=", 
   "\"\<MechanismCriticalTangentVectors[m], MechanismCriticalTangentVectors[ \
Deformed[ m, positions ]] returns vertex displacements tangent to the \
manifold of constant critical value corresponding to the mechanism.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7872]:=",ExpressionUUID->"2ea7c2d5-a9ce-47a1-a13c-edc9d8395651"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`geometry`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`rigidity`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`Origami`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Mechanisms`graphics`\>\"", "]"}], ";"}]}], "Code",\

 CellLabel->
  "1/2/24 10:12:13 \
In[7876]:=",ExpressionUUID->"caba788a-424c-46e0-93f9-edcc6a8ebf3c"]
}, Closed]],

Cell[CellGroupData[{

Cell["critical points", "Section",ExpressionUUID->"41d5a9ce-bd01-4999-88b2-92f83d44e1ed"],

Cell[CellGroupData[{

Cell["criticalPointData[]", "Subsection",ExpressionUUID->"d9558885-b745-435a-91ff-1d45e786c0fd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"criticalPointData", "[", " ", 
   RowBox[{
   "m_", " ", ",", " ", "coords_", " ", ",", " ", "fixedEdges_", " ", ",", 
    " ", "selfstress_Symbol", " ", ",", " ", "constraints_"}], " ", "]"}], 
  " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"linearConstraints", " ", "=", " ", 
       RowBox[{"MechanismLinearConstraints", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"Constraints", " ", "->", " ", "constraints"}]}], "]"}]}], 
      ",", "\n", "\t", 
      RowBox[{"fixedLengthEdgesTMP", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{"fixedEdges", "===", "None"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"MechanismEdges", "[", 
          RowBox[{"m", " ", ",", " ", "fixedEdges"}], "]"}]}], "]"}]}], ",", 
      " ", "fixedLengthEdges", ",", " ", "selfstressSpecifiedEdges", ",", 
      "\n", "\t", "stresses", ",", "\n", "\t", "positions", ",", "\n", "\t", 
      "variables", ",", "\n", "\t", "criticalPotential", ",", " ", 
      "criticalArrays"}], "\n", "}"}], ",", "\n", "\t", 
    RowBox[{
     RowBox[{"fixedLengthEdges", " ", "=", " ", 
      RowBox[{"DeleteMissing", " ", "@", " ", "fixedLengthEdgesTMP"}]}], ";", 
     "\n", "\t", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "fixedLengthEdges", "]"}], " ", "+", " ", 
         RowBox[{"Length", "[", "coords", "]"}]}], " ", "==", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"MechanismEdges", "[", "m", "]"}], "]"}]}], ",", "\n", "\t", 
       "\n", "\t\t", 
       RowBox[{
        RowBox[{"selfstressSpecifiedEdges", " ", "=", " ", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"Length", "[", 
             RowBox[{"MechanismEdges", "[", "m", "]"}], "]"}], "]"}], ",", 
           " ", "fixedLengthEdges"}], "]"}]}], ";", "\n", "\t", "\n", "\t\t", 
        
        RowBox[{"(*", 
         RowBox[{
         "construct", " ", "the", " ", "stress", " ", "coordinates", " ", 
          "with", " ", "variables", " ", "inserted", " ", "where", " ", 
          "specified", " ", "and", " ", "the", " ", "user", " ", "specified", 
          " ", "stresses", " ", "everywhere", " ", "else"}], "*)"}], "\n", 
        "\t\t", 
        RowBox[{"stresses", " ", "=", " ", 
         RowBox[{"Fold", "[", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"#2", "[", "#1", "]"}], "&"}], ",", " ", "coords", " ", 
           ",", " ", 
           RowBox[{"Insert", " ", "@@@", " ", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Map", "[", " ", 
                RowBox[{"selfstress", ",", " ", "fixedLengthEdges"}], "]"}], 
               ",", " ", 
               RowBox[{"Sort", "[", "fixedLengthEdges", "]"}]}], "}"}], 
             "]"}]}]}], " ", "]"}]}], ";", "\n", "\n", "\t\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
          "linearConstraints"}]}], " ", ";", "\n", "\t\t", 
        RowBox[{"variables", " ", "=", " ", 
         RowBox[{"DeleteDuplicates", "[", " ", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "positions", "]"}], ",", " ", 
            "_VertexPosition", ",", " ", "Infinity"}], "]"}], " ", "]"}]}], 
        ";", "\n", "\n", "\t\t", 
        RowBox[{"criticalPotential", " ", "=", " ", 
         RowBox[{"stresses", " ", ".", " ", 
          RowBox[{"DisplacementLengthSquared", "[", 
           RowBox[{"m", " ", ",", " ", "positions", " ", ",", " ", 
            RowBox[{"MechanismEdges", "[", "m", "]"}]}], " ", "]"}]}]}], ";", 
        "\n", "\n", "\t\t", 
        RowBox[{"Association", "[", "\n", "\t\t\t", 
         RowBox[{
          RowBox[{"\"\<positions\>\"", " ", "->", " ", "positions"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{"\"\<variables\>\"", " ", "->", " ", "variables"}], ",", 
          "\n", "\t\t\t", 
          RowBox[{"\"\<potential\>\"", " ", "->", " ", "criticalPotential"}], 
          ",", "\n", "\t\t\t", 
          RowBox[{"\"\<stresses\>\"", " ", "->", " ", "stresses"}], ",", "\n",
           "\t\t\t", 
          RowBox[{"\"\<fixedLength\>\"", " ", "->", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"DisplacementLengthSquared", "[", 
              RowBox[{"m", ",", " ", 
               RowBox[{
                RowBox[{"MechanismEdges", "[", "m", "]"}], "[", 
                RowBox[{"[", "fixedLengthEdges", "]"}], "]"}]}], "]"}], " ", "==",
              " ", 
             RowBox[{"DisplacementLengthSquared", "[", 
              RowBox[{"m", " ", ",", " ", "positions", " ", ",", " ", 
               RowBox[{
                RowBox[{"MechanismEdges", "[", "m", "]"}], "[", 
                RowBox[{"[", "fixedLengthEdges", "]"}], "]"}]}], "]"}]}], " ",
             "]"}]}], ",", "\n", "\t\t", "\n", "\t\t\t", 
          RowBox[{"\"\<badEdges\>\"", " ", "->", " ", 
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"fixedLengthEdgesTMP", ",", "_Missing"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], " ", 
         RowBox[{"(*", 
          RowBox[{"the", " ", "last", " ", "of", " ", "bad", " ", "edges"}], 
          "*)"}], "\n", "\t\t", "]"}]}], ",", "\n", "\t\t", 
       RowBox[{"(*", 
        RowBox[{"not", " ", "enough", " ", "coordinates", " ", "here"}], 
        "*)"}], "\n", "\t\t", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"MechanismCriticalConfiguration", "::", "dim"}], ",", " ", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"MechanismEdges", "[", "m", "]"}], "]"}], " ", "-", " ", 
           RowBox[{"Length", "[", "fixedLengthEdges", "]"}]}]}], "]"}], ";", 
        "\n", "\t\t", "$Failed"}]}], "\n", "\t", "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7882]:=",ExpressionUUID->"12654168-cf0f-434b-a84e-6ffff3ee13c9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["MechanismCriticalConfiguration[]", "Subsection",ExpressionUUID->"b85ef177-5615-4a73-9aac-fbd8f733ebf8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismCriticalConfiguration", "]"}], " ", "=",
     " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"Constraints", " ", "->", " ", "None"}], ",", "\n", "\t", 
      RowBox[{"Method", " ", "->", " ", "Automatic"}], ",", "\n", "\t", 
      RowBox[{"\"\<FixedEdges\>\"", " ", "->", " ", "None"}]}], "\n", "}"}]}],
    ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"coord", " ", ":", " ", 
      RowBox[{"_", "?", "VectorQ"}]}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "s", ",", " ", "criticalPositions", ",", " ", "criticalStresses", ",", 
       " ", "zeroLengthEdges"}], "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"data", " ", "=", " ", 
         RowBox[{"criticalPointData", "[", " ", 
          RowBox[{"m", " ", ",", " ", "coord", " ", ",", " ", 
           RowBox[{"OptionValue", "[", "\"\<FixedEdges\>\"", "]"}], " ", ",", 
           " ", "s", ",", " ", 
           RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", "]"}]}], 
        " ", "}"}], ",", "\n", "\t\t", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{"this", " ", "does", " ", "the", " ", "work"}], "*)"}], 
           "\n", "\t\t", 
           RowBox[{"solutions", " ", "=", " ", 
            RowBox[{"internalCriticalConfiguration", "[", " ", 
             RowBox[{
             "m", ",", " ", "coord", ",", " ", "data", " ", ",", " ", 
              RowBox[{"OptionValue", "[", "Method", "]"}]}], " ", "]"}]}], 
           "\n", "\t\t", "}"}], ",", "\n", "\t\t", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Which", "[", " ", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"solutions", " ", "===", " ", "Indeterminate"}], ",", 
             "\n", "\t\t\t\t", 
             RowBox[{"Association", "[", "\n", "\t\t\t\t\t", 
              RowBox[{
               RowBox[{"\"\<SelfStress\>\"", " ", "->", " ", 
                RowBox[{"data", "[", "\"\<stresses\>\"", "]"}]}], ",", "\n", 
               "\t\t\t\t\t", 
               RowBox[{"\"\<Positions\>\"", " ", "->", " ", "Indeterminate"}],
                ",", "\n", "\t\t\t\t\t", 
               RowBox[{"\"\<Potential\>\"", " ", "->", " ", 
                RowBox[{"data", "[", "\"\<potential\>\"", "]"}]}], ",", "\n", 
               "\t\t\t\t\t", 
               RowBox[{"\"\<Variables\>\"", " ", "->", " ", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}]}]}], "\n", 
              "\t\t\t\t", "]"}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"Length", "[", "solutions", "]"}], " ", "==", " ", 
              "0"}], ",", "\n", "\t\t\t\t", 
             RowBox[{"Association", "[", "\n", "\t\t\t\t\t", 
              RowBox[{
               RowBox[{"\"\<SelfStress\>\"", " ", "->", " ", 
                RowBox[{"{", "}"}]}], ",", "\n", "\t\t\t\t\t", 
               RowBox[{"\"\<Positions\>\"", " ", "->", " ", 
                RowBox[{"{", "}"}]}], ",", "\n", "\t\t\t\t\t", 
               RowBox[{"\"\<Potential\>\"", " ", "->", " ", 
                RowBox[{"data", "[", "\"\<potential\>\"", "]"}]}], ",", "\n", 
               "\t\t\t\t\t", 
               RowBox[{"\"\<Variables\>\"", " ", "->", " ", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}]}]}], "\n", 
              "\t\t\t\t", "]"}], ",", "\n", "\t\t\t", "True", ",", "\n", 
             "\t\t\t\t", 
             RowBox[{"(*", 
              RowBox[{
              "everything", " ", "now", " ", "is", " ", "about", " ", 
               "writing", " ", "out", " ", "the", " ", "information", " ", 
               "and", " ", "provided", " ", "errors", " ", "and", " ", 
               "warnings"}], "*)"}], "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{"criticalPositions", " ", "=", " ", 
               RowBox[{
                RowBox[{"data", "[", "\"\<positions\>\"", "]"}], " ", "/.", 
                " ", "solutions"}]}], ";", "\n", "\t\t\t\t", 
              RowBox[{"criticalStresses", " ", "=", " ", 
               RowBox[{
                RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], " ", "/.", 
                " ", "solutions"}]}], ";", "\n", "\t\t\t\t", 
              RowBox[{"zeroLengthEdges", " ", "=", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"ZeroLengthEdgeQ", "[", 
                  RowBox[{"PlaceVertices", "[", 
                   RowBox[{"m", ",", "#"}], "]"}], "]"}], "&"}], " ", "/@", 
                " ", "criticalPositions"}]}], ";", "\n", "\t", "\n", 
              "\t\t\t\t", 
              RowBox[{"If", "[", " ", 
               RowBox[{
                RowBox[{"Or", " ", "@@", " ", "zeroLengthEdges"}], ",", "\n", 
                "\t\t\t\t\t", 
                RowBox[{"Message", "[", 
                 RowBox[{
                  RowBox[{"MechanismCriticalConfiguration", "::", "zedge"}], 
                  ",", " ", 
                  RowBox[{"Pick", "[", " ", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "zeroLengthEdges", "]"}], "]"}], 
                    ",", " ", "zeroLengthEdges"}], " ", "]"}]}], "]"}]}], 
               "\n", "\t\t\t\t", "]"}], ";", "\n", "\t\t", "\n", "\t\t\t\t", 
              RowBox[{"Association", "[", "\n", "\t\t\t\t\t", 
               RowBox[{
                RowBox[{
                "\"\<SelfStress\>\"", " ", "->", " ", "criticalStresses"}], 
                ",", "\n", "\t\t\t\t\t", 
                RowBox[{
                "\"\<Positions\>\"", " ", "->", " ", "criticalPositions"}], 
                ",", "\n", "\t\t\t\t\t", 
                RowBox[{"\"\<Potential\>\"", " ", "->", " ", 
                 RowBox[{"data", "[", "\"\<potential\>\"", "]"}]}], ",", "\n",
                 "\t\t\t\t\t", 
                RowBox[{"\"\<Variables\>\"", " ", "->", " ", 
                 RowBox[{"data", "[", "\"\<variables\>\"", "]"}]}]}], "\n", 
               "\t\t\t\t", "]"}]}]}], "\n", "\t\t", "]"}], " ", "/;", " ", 
           RowBox[{"solutions", " ", "=!=", " ", "$Failed"}]}]}], "\n", 
         "\t\t", "]"}], " ", "/;", " ", 
        RowBox[{"data", " ", "=!=", " ", "$Failed"}]}]}], "\n", "\t", "]"}]}],
     "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "dim"}], "=", 
   "\"\<The number of coordinates provided must be `1`.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "zedge"}], " ", "=", " ", 
   "\"\<Warning: Some edges have zero length in solutions `1`.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7883]:=",ExpressionUUID->"1a04ee9b-b1ac-4aaf-add3-79f073e10cf8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Automatic", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", 
     RowBox[{
     "m_", ",", "coord_", ",", "data_Association", ",", " ", "Automatic"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"internalCriticalConfiguration", "[", 
      RowBox[{"m", ",", "coord", ",", "data", ",", "\"\<Direct\>\""}], "]"}], 
     " ", "/;", " ", 
     RowBox[{"TrueQ", "[", 
      RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], "]"}]}]}], "\n", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Automatic", " ", "but", " ", "some", " ", "of", " ", "the", " ", "edges",
      " ", "are", " ", "held", " ", "to", " ", "have", " ", "fixed", " ", 
     "length"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", 
     RowBox[{
     "m_", ",", "coord_", ",", "data_Association", ",", " ", "Automatic"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"internalCriticalConfiguration", "[", 
      RowBox[{"m", ",", "coord", ",", "data", ",", "NSolve"}], "]"}], " ", "/;",
      " ", 
     RowBox[{"Not", "[", 
      RowBox[{"TrueQ", "[", 
       RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], "]"}], 
      "]"}]}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7887]:=",ExpressionUUID->"84fbe4b2-491c-4497-8b9f-d63edaab72ad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"possibleDetZeroMatrixQ", "[", " ", 
   RowBox[{
    RowBox[{"mat_", "?", "MatrixQ"}], ",", " ", "tol_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Det", "[", "mat", "]"}], " ", "<", " ", "tol"}], " ", "/;", " ", 
   
   RowBox[{
    RowBox[{"Precision", "[", "mat", "]"}], " ", "===", " ", 
    "MachinePrecision"}]}]}], "\n", 
 RowBox[{
  RowBox[{"possibleDetZeroMatrixQ", "[", " ", 
   RowBox[{
    RowBox[{"mat_", "?", "MatrixQ"}], ",", " ", "tol_"}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"PossibleZeroQ", "[", " ", 
   RowBox[{"Det", "[", "mat", "]"}], " ", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"possibleDetZeroMatrixQ", "[", " ", "__", " ", "]"}], " ", ":=", 
   " ", "False"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
   "we", " ", "can", " ", "solve", " ", "this", " ", "right", " ", "quick"}], 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"internalCriticalConfiguration", "[", " ", 
    RowBox[{
    "m_", ",", " ", "coord_", ",", " ", "data_", ",", " ", "\"\<Direct\>\""}],
     "]"}], " ", ":=", " ", 
   RowBox[{"internalCriticalConfiguration", "[", 
    RowBox[{"m", ",", "coord", ",", "data", ",", 
     RowBox[{"{", "\"\<Direct\>\"", "}"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"internalCriticalConfiguration", "[", " ", 
    RowBox[{
    "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"\"\<Direct\>\"", ",", " ", 
       RowBox[{"opt", " ", ":", " ", "___"}]}], "}"}]}], " ", "]"}], " ", ":=",
    "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"criticalArrays", " ", "=", " ", 
         RowBox[{"CoefficientArrays", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
           RowBox[{"data", "[", "\"\<variables\>\"", "]"}], " ", ",", " ", 
           RowBox[{"Symmetric", " ", "->", " ", "True"}]}], " ", "]"}]}], ",",
         "\n", "\t", "nullspace"}], "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"possibleDetZeroMatrixQ", "[", " ", 
         RowBox[{
          RowBox[{"criticalArrays", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"10", "^", 
           RowBox[{"(", 
            RowBox[{"-", "10"}], ")"}]}]}], " ", "]"}], ",", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{"MechanismCriticalConfiguration", "::", "pseudo"}], "]"}], 
          ";"}], "*)"}], "\n", "\t\t", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"pseudoinverse", " ", "=", " ", 
            RowBox[{"PseudoInverse", "[", 
             RowBox[{"criticalArrays", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", "\n", 
          "\t\t\t", 
          RowBox[{"If", "[", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", " ", ".", " ", "#"}], "&"}], ")"}], "[", 
              RowBox[{
               RowBox[{
                RowBox[{"criticalArrays", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], " ", ".", " ", 
                "pseudoinverse", " ", ".", " ", 
                RowBox[{"criticalArrays", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], " ", "-", " ", 
               RowBox[{"criticalArrays", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "]"}], " ", "<", " ", 
             RowBox[{"10", "^", 
              RowBox[{"(", 
               RowBox[{"-", "10"}], ")"}]}]}], ",", " ", "\n", "\t\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "this", " ", "is", " ", "solvable", " ", "with", " ", "a", " ", 
              "pseudoinverse"}], "*)"}], "\n", "\t\t\t\t", 
            RowBox[{
             RowBox[{"nullspace", " ", "=", " ", 
              RowBox[{"NullSpace", "[", 
               RowBox[{
                RowBox[{"criticalArrays", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], " ", ",", " ", 
                RowBox[{"FilterRules", "[", 
                 RowBox[{
                  RowBox[{"{", "opt", "}"}], ",", 
                  RowBox[{"Options", "[", "NullSpace", "]"}]}], "]"}]}], 
               "]"}]}], ";", "\n", "\t\t\t\t", 
             RowBox[{"{", "\n", "\t\t\t\t", 
              RowBox[{"(*", 
               RowBox[{"the", " ", "critical", " ", "configuration"}], "*)"}],
               "\n", "\t\t\t\t", 
              RowBox[{"Thread", "[", " ", 
               RowBox[{
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], " ", "->", 
                " ", 
                RowBox[{"(", "\n", "\t\t\t\t\t", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", " ", 
                    RowBox[{"pseudoinverse", " ", ".", " ", 
                    RowBox[{"criticalArrays", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "/", "2"}], " ", "+", 
                  " ", 
                  RowBox[{
                   RowBox[{"Array", "[", 
                    RowBox[{"C", ",", 
                    RowBox[{"Length", "[", "nullspace", "]"}]}], "]"}], " ", 
                   ".", " ", "nullspace"}]}], "\n", "\t\t\t\t\t", ")"}]}], 
               "]"}], "\n", "\t\t\t\t", "}"}]}], ",", "\n", "\n", "\t\t\t\t", 
            
            RowBox[{"(*", 
             RowBox[{"this", " ", "is", " ", "not", " ", "solvable"}], "*)"}],
             "\n", "\t\t\t\t", 
            RowBox[{"{", "}"}]}], "\n", "\t\t\t", "]"}]}], "\n", "\t\t", 
         "]"}], ",", "\n", "\t\t", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{"it", " ", "is", " ", "a", " ", "Morse", " ", "function"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"{", " ", 
         RowBox[{"Thread", "[", " ", 
          RowBox[{
           RowBox[{"data", "[", "\"\<variables\>\"", "]"}], " ", "->", " ", 
           RowBox[{
            RowBox[{"-", " ", 
             RowBox[{
              RowBox[{"Inverse", "[", 
               RowBox[{"criticalArrays", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "]"}], " ", ".", " ", 
              RowBox[{"criticalArrays", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "/", "2"}]}], " ", "]"}], 
         " ", "}"}]}], "\n", "\t", "]"}]}], "\n", "]"}], " ", "/;", " ", 
    RowBox[{"TrueQ", "[", 
     RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"internalCriticalConfiguration", "[", " ", 
    RowBox[{
    "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"\"\<Direct\>\"", ",", " ", 
       RowBox[{"opt", " ", ":", " ", "___"}]}], "}"}]}], " ", "]"}], " ", ":=",
    " ", 
   RowBox[{
    RowBox[{"(", "\n", "\t", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"MechanismCriticalConfiguration", "::", "edge"}], "]"}], ";", 
      "\n", "\t", "$Failed"}], "\n", ")"}], " ", "/;", " ", 
    RowBox[{"Not", "[", 
     RowBox[{"TrueQ", "[", 
      RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], "]"}], "]"}]}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "edge"}], " ", "=", " ", 
   "\"\<Method \\\"Direct\\\" not available with fixed length edges.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "pseudo"}], " ", "=", " ", 
   "\"\<Using Pseudoinverse to solve for critical point.\>\""}], 
  ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7889]:=",ExpressionUUID->"991e06fd-8fe9-45ef-b6b0-67713bbf7d0f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"NSolve", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", "NSolve"}], " ", "]"}], " ", ":=", "\n", "\t", 
    RowBox[{"internalCriticalConfiguration", "[", 
     RowBox[{"m", ",", "coord", ",", "data", ",", " ", 
      RowBox[{"{", 
       RowBox[{"NSolve", ",", " ", 
        RowBox[{"WorkingPrecision", " ", "->", " ", "$MachinePrecision"}]}], 
       "}"}]}], "]"}]}], "\n", "\t", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "this", " ", "fixes", " ", "a", " ", "Mathematica", " ", "bug", " ", 
      "introduced", " ", "into", " ", "WorkingPrecision"}], " ", "->", " ", 
     RowBox[{
     "Automatic", " ", "with", " ", "version", " ", "10", " ", "and", " ", 
      "13"}]}], "*)"}], "\n", "\n", 
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{"NSolve", ",", " ", "opt___"}], "}"}]}], " ", "]"}], " ", ":=",
     "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"equations", ",", "\n", "\t", "variables", ",", "\n", "\t", 
        RowBox[{"nsolveOptions", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opt", "}"}], ",", " ", 
             RowBox[{"Options", "[", "NSolve", "]"}]}], " ", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"WorkingPrecision", " ", "->", " ", "$MachinePrecision"}],
             "}"}]}], "]"}]}]}], "\n", "\t\t\t", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "this", " ", "fixes", " ", "a", " ", "Mathematica", " ", "bug", " ", 
          "introduced", " ", "into", " ", "WorkingPrecision"}], " ", "->", 
         " ", 
         RowBox[{
         "Automatic", " ", "with", " ", "version", " ", "10", " ", "and", " ",
           "13"}]}], "*)"}], "\n", "\t ", "}"}], ",", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{"(*", 
           RowBox[{"extremum", " ", "equations"}], "*)"}], "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"D", "[", " ", 
              RowBox[{
               RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], "}"}]}], " ",
               "]"}], " ", "==", " ", "0"}], " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"(*", 
            RowBox[{"length", " ", "constraints"}], "*)"}], "\n", "\t\t", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", " ", 
              RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], " ", "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}], " ", ",", " ", 
             RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}]}], " ", 
            "]"}]}], "\n", "\t", "}"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"data", "[", "\"\<variables\>\"", "]"}], ",", " ", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], ",", 
            RowBox[{"_", "?", "NumericQ"}]}], " ", "]"}]}], "]"}]}], ";", 
       "\t", "\n", "\t", 
       RowBox[{"NSolve", "[", " ", 
        RowBox[{
        "equations", " ", ",", " ", "variables", " ", ",", " ", "Reals", ",", 
         " ", "nsolveOptions"}], "]"}]}]}], "\n", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7897]:=",ExpressionUUID->"8f562e1a-f003-4146-bec8-e14f36883132"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Solve", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", "Solve"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"equations", ",", "\n", "\t", "variables"}], "\n", "\t ", 
       "}"}], ",", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"D", "[", " ", 
              RowBox[{
               RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], "}"}]}], " ",
               "]"}], " ", "==", " ", "0"}], " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", " ", 
              RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], " ", "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}], " ", ",", " ", 
             RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}]}], " ", 
            "]"}]}], "\n", "\t", "}"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"data", "[", "\"\<variables\>\"", "]"}], ",", " ", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], ",", 
            RowBox[{"_", "?", "NumericQ"}]}], " ", "]"}]}], "]"}]}], ";", 
       "\t", "\n", "\t", 
       RowBox[{"Quiet", "[", 
        RowBox[{
         RowBox[{"Solve", "[", " ", 
          RowBox[{"equations", " ", ",", " ", "variables"}], " ", "]"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Solve", "::", "ratnz"}], ",", " ", 
           RowBox[{"Solve", "::", "svars"}]}], "}"}]}], " ", "]"}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{"Solve", ",", " ", "opt___"}], "}"}]}], " ", "]"}], " ", ":=", 
    "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"equations", ",", "\n", "\t", "variables", ",", "\n", "\t", 
        RowBox[{"solveOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "Solve", "]"}]}], " ", "]"}]}]}], "\n", 
       "\t ", "}"}], ",", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"D", "[", " ", 
              RowBox[{
               RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], "}"}]}], " ",
               "]"}], " ", "==", " ", "0"}], " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", " ", 
              RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], " ", "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}], " ", ",", " ", 
             RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}]}], " ", 
            "]"}]}], "\n", "\t", "}"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"data", "[", "\"\<variables\>\"", "]"}], ",", " ", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], ",", 
            RowBox[{"_", "?", "NumericQ"}]}], " ", "]"}]}], "]"}]}], ";", 
       "\t", "\n", "\t", 
       RowBox[{"Quiet", "[", " ", 
        RowBox[{
         RowBox[{"Solve", "[", " ", 
          RowBox[{
          "equations", " ", ",", " ", "variables", " ", ",", " ", 
           "solveOptions"}], "]"}], " ", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Solve", "::", "ratnz"}], ",", " ", 
           RowBox[{"Solve", "::", "svars"}]}], "}"}]}], " ", "]"}]}]}], "\n", 
     "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7899]:=",ExpressionUUID->"7478aac9-e1a2-4e6e-9b73-75856da510d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"FindRoot", " ", "method"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", "FindRoot"}], " ", "]"}], " ", ":=", "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"equations", ",", "\n", "\t", "variables", ",", "\n", "\t", 
        RowBox[{"stresses", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], ",", 
           RowBox[{"_", "?", "NumericQ"}]}], " ", "]"}]}], ",", "\n", "\t", 
        "initialPositions"}], "\n", "\t ", "}"}], ",", "\n", "\n", "\t", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"D", "[", " ", 
              RowBox[{
               RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], "}"}]}], " ",
               "]"}], " ", "==", " ", "0"}], " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", " ", 
              RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], " ", "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}], " ", ",", " ", 
             RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}]}], " ", 
            "]"}]}], "\n", "\t", "}"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"data", "[", "\"\<variables\>\"", "]"}], ",", " ", 
          "stresses"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"initialPositions", " ", "=", " ", 
        RowBox[{
         RowBox[{"variables", " ", "/.", " ", 
          RowBox[{"PositionRules", "[", "m", "]"}]}], " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"stresses", " ", "->", " ", "1."}], "]"}]}]}], ";", "\n", 
       "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"FindRoot", "[", " ", 
         RowBox[{"equations", " ", ",", " ", 
          RowBox[{"Transpose", " ", "@", " ", 
           RowBox[{"{", 
            RowBox[{"variables", " ", ",", " ", "initialPositions"}], " ", 
            "}"}]}]}], " ", "]"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"internalCriticalConfiguration", "[", " ", 
     RowBox[{
     "m_", ",", " ", "coord_", " ", ",", " ", "data_Association", " ", ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{"FindRoot", ",", " ", "opt___"}], "}"}]}], " ", "]"}], " ", ":=",
     "\n", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"equations", ",", "\n", "\t", "variables", ",", "\n", "\t", 
        RowBox[{"stresses", " ", "=", " ", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"data", "[", "\"\<stresses\>\"", "]"}], ",", 
           RowBox[{"_", "?", "NumericQ"}]}], " ", "]"}]}], ",", "\n", "\t", 
        "initialPositions", ",", "\n", "\t", 
        RowBox[{"rootOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opt", "}"}], ",", " ", 
           RowBox[{"Options", "[", "FindRoot", "]"}]}], " ", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"initialGuess", " ", "=", " ", 
         RowBox[{"\"\<InitialStresses\>\"", " ", "/.", " ", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", "opt", "}"}], "]"}]}]}]}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"equations", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"D", "[", " ", 
              RowBox[{
               RowBox[{"data", "[", "\"\<potential\>\"", "]"}], " ", ",", " ", 
               RowBox[{"{", 
                RowBox[{"data", "[", "\"\<variables\>\"", "]"}], "}"}]}], " ",
               "]"}], " ", "==", " ", "0"}], " ", "]"}], ",", "\n", "\t\t", 
           RowBox[{"If", "[", " ", 
            RowBox[{
             RowBox[{"TrueQ", "[", " ", 
              RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}], " ", "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}], " ", ",", " ", 
             RowBox[{"data", "[", "\"\<fixedLength\>\"", "]"}]}], " ", 
            "]"}]}], "\n", "\t", "}"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"variables", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"data", "[", "\"\<variables\>\"", "]"}], ",", " ", 
          "stresses"}], "]"}]}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"initialPositions", " ", "=", " ", 
        RowBox[{"Which", "[", " ", "\n", "\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"VectorQ", "[", " ", 
            RowBox[{"initialGuess", ",", " ", "NumericQ"}], "]"}], " ", "&&", 
           " ", 
           RowBox[{
            RowBox[{"Length", "[", "initialGuess", "]"}], " ", "==", " ", 
            RowBox[{"Length", "[", "stresses", "]"}]}]}], ",", "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"variables", " ", "/.", " ", 
             RowBox[{"PositionRules", "[", "m", "]"}]}], " ", "/.", " ", 
            RowBox[{"Thread", "[", 
             RowBox[{"stresses", " ", "->", " ", "initialGuess"}], " ", 
             "]"}]}], "}"}], ",", "\n", "\t\t", 
          RowBox[{
           RowBox[{"MatrixQ", "[", " ", 
            RowBox[{"initialGuess", ",", " ", "NumericQ"}], " ", "]"}], " ", "&&",
            " ", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"initialGuess", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "==", " ", 
            RowBox[{"Length", "[", "stresses", "]"}]}]}], ",", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"variables", " ", "/.", " ", 
               RowBox[{"PositionRules", "[", "m", "]"}]}], " ", "/.", " ", 
              RowBox[{"Thread", "[", 
               RowBox[{"stresses", " ", "->", " ", "#"}], "]"}]}], " ", "&"}],
             ")"}], " ", "/@", " ", "initialGuess"}], ",", "\n", "\t\t", 
          RowBox[{
          "initialGuess", " ", "===", " ", "\"\<InitialStresses\>\""}], ",", 
          "\n", "\t\t\t", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"variables", " ", "/.", " ", 
             RowBox[{"PositionRules", "[", "m", "]"}]}], " ", "/.", " ", 
            RowBox[{"Thread", "[", 
             RowBox[{"stresses", " ", "->", " ", "1."}], "]"}]}], "}"}], ",", 
          " ", 
          RowBox[{"(*", 
           RowBox[{
           "no", " ", "guess", " ", "for", " ", "stresses", " ", 
            "specified"}], "*)"}], "\n", "\t\t", "True", ",", "\n", "\t\t\t", 
          
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"MechanismCriticalConfiguration", "::", "stress"}], ",", 
             " ", "initialGuess", ",", " ", 
             RowBox[{"Length", "[", "stresses", "]"}]}], " ", "]"}], ";", 
           "\n", "\t\t\t", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"variables", " ", "/.", " ", 
              RowBox[{"PositionRules", "[", "m", "]"}]}], " ", "/.", " ", 
             RowBox[{"Thread", "[", 
              RowBox[{"stresses", " ", "->", " ", "1."}], "]"}]}], "}"}]}]}], 
         " ", 
         RowBox[{"(*", 
          RowBox[{"bad", " ", "guess", " ", "specified"}], "*)"}], "\n", "\t",
          "]"}]}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"FindRoot", "[", " ", 
          RowBox[{"equations", " ", ",", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"Transpose", "[", 
             RowBox[{"{", 
              RowBox[{"variables", " ", ",", " ", "#"}], " ", "}"}], "]"}], 
            "]"}], " ", ",", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"Sequence", " ", "@@", " ", "rootOptions"}], "]"}]}], " ",
           "]"}], "&"}], " ", "/@", " ", "initialPositions"}]}]}], "\n", 
     "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismCriticalConfiguration", "::", "stresses"}], " ", "=", 
     " ", "\"\<Each initial guess for stresses `1` should be a list of \
numerical values with length `2`\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7901]:=",ExpressionUUID->"97276aa8-2f46-4ae0-b316-a396989572ec"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"internalCriticalConfiguration", "[", " ", 
    RowBox[{
    "m_", ",", " ", "coord_", " ", ",", " ", "data_", " ", ",", " ", 
     "method_"}], "]"}], ":=", "\n", "\t", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{"ListQ", "[", "method", "]"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MechanismCriticalConfiguration", "::", "meth"}], ",", " ", 
         RowBox[{"method", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"MechanismCriticalConfiguration", "::", "meth"}], ",", " ", 
         "method"}], "]"}]}], " ", "]"}], ";", "\n", "\t", "$Failed"}], 
    ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalConfiguration", "::", "meth"}], "=", 
   "\"\<Method `1` is not Automatic,\\\"Direct\\\", NSolve, Solve, or \
FindRoot\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7904]:=",ExpressionUUID->"02892aa2-1225-4781-9cbe-9ab010ab7380"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismTangentForm[]", "Subsection",ExpressionUUID->"08eba98c-ea79-4ec8-9684-81a4c1879591"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismTangentForm", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
     RowBox[{"CellPattern", " ", "->", " ", "_"}]}], " ", "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismTangentForm", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"constraints", ",", "\n", "\t", 
       RowBox[{"pinnedVertexLocations", " ", "=", " ", 
        RowBox[{"MechanismLinearConstraints", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"Constraints", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "Constraints", "]"}]}]}], "]"}]}], ",",
        "\n", "\t", "equations", ",", "\n", "\t", "variables", ",", "\n", 
       "\t", "jacobian", ",", " ", "variableLength", ",", " ", "i", ",", 
       "j"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"equations", " ", "=", " ", 
       RowBox[{
        RowBox[{"MechanismConstraintMap", "[", 
         RowBox[{"m", ",", " ", "opt", ",", " ", 
          RowBox[{"ReduceLinearConstraints", "->", "False"}]}], "]"}], " ", "/.",
         " ", 
        RowBox[{"Dispatch", "[", "pinnedVertexLocations", "]"}]}]}], ";", 
      "\n", "\t", 
      RowBox[{
       RowBox[{"(", "\n", "\t\t", 
        RowBox[{"(*", 
         RowBox[{
         "eliminate", " ", "the", " ", "trivial", " ", "constraints", " ", 
          "after", " ", "solving", " ", "the", " ", "linear", " ", 
          "constraints", " ", "explicitly"}], "*)"}], "\n", "\t\t", 
        RowBox[{
         RowBox[{"constraints", " ", "=", " ", 
          RowBox[{"Pick", "[", " ", 
           RowBox[{"equations", " ", ",", " ", 
            RowBox[{"Not", " ", "/@", " ", 
             RowBox[{"PossibleZeroQ", " ", "/@", " ", "equations"}]}]}], " ", 
           "]"}]}], ";", "\n", "\t\t", 
         RowBox[{"(*", 
          RowBox[{"what", " ", "variables", " ", "are", " ", "left"}], "*)"}],
          "\n", "\t\t", 
         RowBox[{"variables", " ", "=", " ", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"VertexPosition", "[", "m", "]"}], "]"}], " ", "/.", 
             " ", "pinnedVertexLocations"}], " ", ",", " ", 
            RowBox[{"VertexPosition", "[", 
             RowBox[{"_", ",", "_"}], "]"}]}], "]"}]}], ";", "\n", "\t\t", 
         RowBox[{"variableLength", " ", "=", " ", 
          RowBox[{"Length", "[", "variables", "]"}]}], ";", "\n", "\t\t", 
         RowBox[{"jacobian", " ", "=", " ", 
          RowBox[{"D", "[", 
           RowBox[{"constraints", ",", 
            RowBox[{"{", "variables", "}"}]}], "]"}]}], ";", "\n", "\t\t", 
         "\n", "\t\t", 
         RowBox[{"{", "\n", "\t\t", 
          RowBox[{
          "variables", ",", "\n", "\t\t", "pinnedVertexLocations", ",", "\n", 
           "\t\t", 
           RowBox[{
            RowBox[{"Switch", "[", " ", 
             RowBox[{
              RowBox[{"variableLength", "-", 
               RowBox[{"Length", "[", "constraints", "]"}]}], ",", "\n", 
              "\t\t\t", "0", ",", " ", 
              RowBox[{"Det", "[", " ", "jacobian", " ", "]"}], ",", "\n", 
              "\t\t\t", "1", ",", " ", 
              RowBox[{"Cross", " ", "@@", " ", "jacobian"}], ",", "\n", 
              "\t\t\t", "2", ",", " ", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Det", " ", "@", " ", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"UnitVector", "[", 
                    RowBox[{"variableLength", ",", "i"}], "]"}], ",", 
                    RowBox[{"UnitVector", "[", 
                    RowBox[{"variableLength", ",", "j"}], "]"}]}], "}"}], ",",
                    " ", "jacobian"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "variableLength"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", "variableLength"}], "}"}]}], 
               "]"}], ",", "\n", "\t\t\t", "_", ",", " ", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{
                 RowBox[{"MechanismTangentForm", "::", "dim"}], ",", " ", 
                 RowBox[{"variableLength", " ", "-", " ", 
                  RowBox[{"Length", "[", "constraints", "]"}]}]}], "]"}], ";",
                " ", 
               RowBox[{"D", "[", 
                RowBox[{"constraints", ",", 
                 RowBox[{"{", "variables", "}"}]}], "]"}]}]}], "\n", "\t\t", 
             "]"}], "/", 
            RowBox[{"Factorial", "[", 
             RowBox[{"Length", "[", "constraints", "]"}], "]"}]}]}], "\n", 
          "\t\t", "}"}]}], "\n", "\n", "\t", ")"}], " ", "/;", " ", 
       RowBox[{
        RowBox[{"Head", "[", "equations", "]"}], " ", "=!=", " ", 
        "MechanismConstraintMap"}]}]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{"catch", " ", "an", " ", "error"}], "*)"}], "\n", "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismTangentForm", "::", "dim"}], " ", "=", " ", 
   "\"\<Current version cannot compute tangent form for dimensions other than \
0 or 1 or 2. Dimension of configuration space is nominally `1`. Returning \
reduced Jacobian instead.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7906]:=",ExpressionUUID->"a2c9e3fe-ed07-4e28-aa97-7135df0ec4fa"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalSet[]", "Subsection",ExpressionUUID->"6d3c4e18-74c4-4bfe-a5d9-f9d2d2904705"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismCriticalSet", "]"}], " ", "=", " ", 
    RowBox[{"{", "\n", "\t", 
     RowBox[{
      RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", "\n", "\t", 
      RowBox[{"Constraints", " ", "->", " ", 
       RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCriticalSet", "[", " ", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
    RowBox[{"extraConstraints", " ", ":", " ", 
     RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", 
     RowBox[{"{", "}"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", "\n", "\t", 
     RowBox[{
     "tf", ",", " ", "vars", ",", "\n", "\t", "pinnedVertexLocations", ",", 
      "\n", "\t", "soln", ",", " ", "positions", ",", " ", 
      "constraintEquations", ",", "\n", "\t", "extraVariables"}], "\n", "}"}],
     ",", "\n", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vars", ",", "pinnedVertexLocations", ",", "tf"}], "}"}], "=", 
      
      RowBox[{"Simplify", "[", 
       RowBox[{"MechanismTangentForm", "[", 
        RowBox[{"m", ",", " ", 
         RowBox[{"Sequence", " ", "@@", " ", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "opt", "}"}], ",", 
            RowBox[{"Options", "[", "MechanismTangentForm", "]"}]}], " ", 
           "]"}]}]}], "]"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{"soln", " ", "=", " ", 
      RowBox[{"Simplify", "[", 
       RowBox[{"Quiet", "[", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{"tf", "==", "0"}], ",", "vars"}], "]"}], ",", 
         RowBox[{"Solve", "::", "svars"}]}], "]"}], "]"}]}], ";", "\n", "\t", 
     
     RowBox[{"positions", " ", "=", " ", 
      RowBox[{
       RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
       "pinnedVertexLocations"}]}], ";", "\n", "\n", "\t", 
     RowBox[{"constraintEquations", " ", "=", " ", 
      RowBox[{"extraConstraints", " ", "/.", " ", "pinnedVertexLocations"}]}],
      ";", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "are", " ", "there", " ", "any", " ", "extra", " ", "variables", " ", 
       RowBox[{"declared", "?"}]}], "*)"}], "\n", "\t", 
     RowBox[{"extraVariables", " ", "=", " ", 
      RowBox[{"toVariables", "[", "constraintEquations", "]"}]}], ";", "\n", 
     "\n", "\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "soln", "]"}], ">", "0"}], ",", "\n", "\t\t", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"fullVariableSet", " ", "=", " ", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"vars", ",", "extraVariables"}], "}"}], "]"}], "]"}]}], 
          " ", "}"}], ",", "\n", "\t\t", 
         RowBox[{"DeleteDuplicates", "[", "\n", "\t\t\t", 
          RowBox[{"Flatten", "[", "\n", "\t\t\t\t", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "for", " ", "each", " ", "entry", " ", "in", " ", "soln"}], 
               ",", " ", 
               RowBox[{
               "try", " ", "to", " ", "solve", " ", "the", " ", "extra", " ", 
                "constraints"}]}], "*)"}], "\n", "\t\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"With", "[", 
                RowBox[{
                 RowBox[{"{", " ", 
                  RowBox[{"constrainedSolution", " ", "=", " ", 
                   RowBox[{"Quiet", "[", 
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Simplify", "[", 
                    RowBox[{"constraintEquations", " ", "/.", " ", "#"}], 
                    "]"}], "==", "0"}], ",", " ", "fullVariableSet"}], "]"}], 
                    ",", 
                    RowBox[{"Solve", "::", "svars"}]}], "]"}]}], "}"}], ",", 
                 "\n", "\t\t\t\t\t\t", 
                 RowBox[{"If", "[", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "constrainedSolution", "]"}], " ", 
                    ">", " ", "0"}], ",", "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{
                    RowBox[{"positions", " ", "/.", " ", "#"}], " ", "/.", 
                    " ", "constrainedSolution"}], ",", " ", "\n", 
                   "\t\t\t\t\t\t\t", 
                   RowBox[{"{", 
                    RowBox[{"{", "}"}], "}"}]}], "\n", "\t\t\t\t\t\t", 
                  "]"}]}], "\n", "\t\t\t\t\t", "]"}], " ", "&"}], ",", "\n", 
              "\t\t\t\t\t", "soln"}], "\n", "\t\t\t", "]"}], ",", "1"}], 
           "]"}], "\n", "\t\t", "]"}]}], "]"}], "\n", "\t\t", ",", "\n", 
       "\t\t", 
       RowBox[{"(*", 
        RowBox[{
        "there", " ", "are", " ", "no", " ", "critical", " ", "points", " ", 
         "at", " ", "all"}], "*)"}], "\n", "\t\t", 
       RowBox[{"{", "}"}]}], "\n", "\t", "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7909]:=",ExpressionUUID->"ee13324e-b132-40ce-9d9b-f6f4c456308a"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalSetEquations[]", "Subsection",ExpressionUUID->"87b8b8e7-9e6b-4d21-a402-0daf3ed773f5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "MechanismCriticalSetEquations", "]"}], " ", "=", 
   " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{
     RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", "\n", "\t", 
     RowBox[{"Constraints", " ", "->", " ", 
      RowBox[{"{", "}"}]}]}], "\n", "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MechanismCriticalSetEquations", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
    RowBox[{"extraConstraints", " ", ":", " ", 
     RowBox[{"Except", "[", "_Rule", "]"}], " ", ":", " ", 
     RowBox[{"{", "}"}]}], ",", " ", 
    RowBox[{"opt", " ", ":", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vars", ",", "pinnedLocations", ",", "tf"}], "}"}], ",", "\n", 
    "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"vars", ",", "pinnedLocations", ",", "tf"}], "}"}], " ", "=", 
      " ", 
      RowBox[{"MechanismTangentForm", "[", 
       RowBox[{"m", ",", "opt"}], "]"}]}], ";", "\n", "\t", 
     RowBox[{
      RowBox[{"Join", "[", " ", 
       RowBox[{"tf", " ", ",", " ", "extraConstraints"}], " ", "]"}], " ", "/.",
       " ", "pinnedLocations"}]}]}], "\n", "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7911]:=",ExpressionUUID->"26a12763-8a31-4ba1-9dd0-6e10bb43f188"]
}, Closed]],

Cell[CellGroupData[{

Cell["toVariables[]", "Subsection",ExpressionUUID->"cbfebfab-1d94-48c1-a447-a10cb79cfefc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toVariables", "[", "expr_", "]"}], " ", ":=", " ", 
  RowBox[{"DeleteDuplicates", "[", 
   RowBox[{"Cases", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"_Symbol", "|", "_VertexPosition"}], ",", "All"}], "]"}], 
   "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7913]:=",ExpressionUUID->"fce85141-c16c-4e16-a434-ecbba466ae94"]
}, Closed]],

Cell[CellGroupData[{

Cell["criticalGradient[], detEval[], gradEval[]", "Subsection",ExpressionUUID->"23201b86-ab05-49ca-a6e6-29d0931630f1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "criticalGradient", "]"}], " ", "=", " ", 
    RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"criticalGradient", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"names", " ", "=", " ", 
        RowBox[{"standardVariableNames", "[", "m", "]"}]}], " ", ",", "\n", 
       "\t", 
       RowBox[{"mat", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", " ", ".", " ", 
            RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], ")"}], "[", 
         RowBox[{"MechanismConstraintMatrix", "[", " ", 
          RowBox[{
           RowBox[{"Deformed", "[", 
            RowBox[{"m", ",", " ", 
             RowBox[{"VertexPosition", "[", "m", "]"}]}], "]"}], " ", ",", 
           " ", 
           RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], ",", 
           " ", "opt"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{"With", "[", " ", 
      RowBox[{
       RowBox[{"{", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"f1", " ", "=", " ", 
          RowBox[{"Compile", " ", "@@", " ", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"names", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"renameVertexVariables", "[", " ", 
              RowBox[{
               RowBox[{"names", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{"Normal", "[", "mat", "]"}]}], " ", "]"}]}], " ", 
            "}"}]}]}], ",", "\n", "\t\t", 
         RowBox[{"f2", " ", "=", " ", 
          RowBox[{"Compile", " ", "@@", " ", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"names", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"renameVertexVariables", "[", " ", 
              RowBox[{
               RowBox[{"names", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"D", "[", 
                  RowBox[{
                   RowBox[{"Normal", "[", "mat", "]"}], ",", "#"}], "]"}], 
                 "&"}], " ", "/@", " ", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}]}], " ", 
              "]"}]}], " ", "}"}]}]}]}], "\n", "\t  ", "}"}], ",", "\n", "\t", 
       RowBox[{"{", 
        RowBox[{"f1", ",", " ", "f2"}], "}"}]}], "\n", "\t", "]"}]}], "\n", 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"detEval", "[", " ", 
    RowBox[{"{", 
     RowBox[{"f1_", ",", "f2_"}], "}"}], "]"}], "[", 
   RowBox[{"z_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", 
  RowBox[{"Det", "[", 
   RowBox[{"f1", " ", "@@", " ", "z"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gradEval", "[", " ", 
     RowBox[{"{", 
      RowBox[{"f1_", ",", "f2_"}], "}"}], "]"}], "[", 
    RowBox[{"z_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Adjugate", "[", " ", 
         RowBox[{"f1", " ", "@@", " ", "z"}], " ", "]"}]}], " ", ",", " ", 
       RowBox[{"y", " ", "=", " ", 
        RowBox[{"f2", " ", "@@", " ", "z"}]}]}], " ", "}"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Tr", "[", " ", 
        RowBox[{"x", " ", ".", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
      "y"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"detEval", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f1_", ",", "f2_"}], "}"}], ",", " ", "Automatic"}], "]"}], "[", 
   RowBox[{"z_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", 
  RowBox[{"Det", "[", 
   RowBox[{"f1", " ", "@@", " ", "z"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gradEval", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f1_", ",", "f2_"}], "}"}], ",", " ", "Automatic"}], "]"}], 
    "[", 
    RowBox[{"z_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"VectorQ", "[", 
        RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
    " ", 
   RowBox[{"With", "[", " ", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"Adjugate", "[", " ", 
         RowBox[{"f1", " ", "@@", " ", "z"}], " ", "]"}]}], " ", ",", " ", 
       RowBox[{"y", " ", "=", " ", 
        RowBox[{"f2", " ", "@@", " ", "z"}]}]}], " ", "}"}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Tr", "[", " ", 
        RowBox[{"x", " ", ".", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
      "y"}]}], " ", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"detEval", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f1_", ",", "f2_"}], "}"}], ",", " ", 
     RowBox[{"n_", "?", "NumericQ"}]}], " ", "]"}], "[", 
   RowBox[{"z_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], "]"}], " ", ":=",
   " ", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Det", "[", " ", 
       RowBox[{"f1", " ", "@@", " ", "z"}], " ", "]"}], " ", "-", " ", "n"}], 
     ")"}], "^", "2"}], "/", "2"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"gradEval", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f1_", ",", "f2_"}], "}"}], ",", " ", 
     RowBox[{"n_", "?", "NumericQ"}]}], " ", "]"}], "[", " ", 
   RowBox[{"z_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"VectorQ", "[", 
       RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], " ", "]"}], " ",
   ":=", " ", 
  RowBox[{"With", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"det", " ", "=", " ", 
      RowBox[{"f1", " ", "@@", " ", "z"}]}], " ", "}"}], ",", " ", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"Adjugate", "[", " ", "det", " ", "]"}]}], " ", ",", " ", 
        RowBox[{"y", " ", "=", " ", 
         RowBox[{"f2", " ", "@@", " ", "z"}]}]}], "}"}], ",", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Det", "[", "det", "]"}], "-", "n"}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Tr", "[", " ", 
           RowBox[{"x", " ", ".", " ", "#"}], "]"}], "&"}], " ", "/@", " ", 
         "y"}], ")"}]}]}], " ", "]"}]}], "]"}]}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7914]:=",ExpressionUUID->"1c27cd34-efe4-422b-a323-0c0f4f801927"]
}, Closed]],

Cell[CellGroupData[{

Cell["criticalSetConstraintFunction[], criticalSetTangents[]", "Subsection",ExpressionUUID->"ca238c93-e657-4f50-aa11-07ebb823fc16"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"criticalSetConstraintFunction", "[", " ", 
    RowBox[{"criticalGradInfo_", " ", ",", " ", "otherConstraints_"}], " ", 
    "]"}], "[", "positions_", "]"}], " ", ":=", " ", "\n", "\t", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{"gradient", " ", "=", " ", 
      RowBox[{"Normalize", " ", "@", " ", 
       RowBox[{
        RowBox[{"gradEval", "[", "criticalGradInfo", "]"}], "[", 
        RowBox[{"Flatten", "[", "positions", "]"}], "]"}]}]}], " ", "}"}], 
    ",", "\n", "\t\t", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", "gradient", "}"}], " ", ",", " ", "otherConstraints"}], 
     " ", "]"}]}], "\n", "\t", "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7922]:=",ExpressionUUID->"c78c3923-2e9b-43e1-a6b6-625b5145a859"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"criticalSetTangents", "[", " ", 
    RowBox[{"criticalGradInfo_", " ", ",", " ", "otherConstraints_"}], " ", 
    "]"}], "[", "positions_", "]"}], " ", ":=", " ", 
  RowBox[{"Chop", " ", "@", " ", 
   RowBox[{"NullSpace", " ", "@", " ", 
    RowBox[{
     RowBox[{"criticalSetConstraintFunction", "[", 
      RowBox[{"criticalGradInfo", " ", ",", " ", "otherConstraints"}], "]"}], 
     "[", "positions", "]"}]}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7923]:=",ExpressionUUID->"48cdaf49-aeab-436d-981c-7ed2d2fc1657"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalTrajectory[]", "Subsection",ExpressionUUID->"69e5ee40-3336-4520-9c33-eefe154a18a9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", " ", "MechanismCriticalTrajectory", " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"{", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
     "any", " ", "constraints", " ", "added", " ", "by", " ", "the", " ", 
      "user"}], "*)"}], "\n", "\t", 
    RowBox[{
     RowBox[{"Constraints", " ", "\[Rule]", " ", "None"}], ",", "\n", "\t", 
     RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
      "positions", " ", "from", " ", "which", " ", "to", " ", "start", " ", 
       "the", " ", "walk"}], "*)"}], "\n", "\t", 
     RowBox[{"InitialPositions", " ", "->", " ", "Automatic"}], ",", "\n", 
     "\t", 
     RowBox[{"Method", " ", "\[Rule]", " ", 
      RowBox[{"{", 
       RowBox[{"\"\<Minimization\>\"", ",", " ", 
        RowBox[{"MaxIterations", " ", "\[Rule]", " ", 
         RowBox[{"10", "^", "4"}]}]}], "}"}]}], ",", "\n", "\t", 
     RowBox[{"Tolerance", " ", "\[Rule]", " ", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "8"}], ")"}]}]}], ",", "\n", "\t", 
     RowBox[{"StepSize", " ", "\[Rule]", " ", "0.1"}]}], "\n", "}"}]}], 
  ";"}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7924]:=",ExpressionUUID->"6e53d729-72e9-46a1-9633-2531053eb74b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", "direction_", ",", " ", 
     RowBox[{"steps_", "?", "stepsQ"}], " ", ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{"initialPositions", " ", "=", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "InitialPositions", "]"}], " ", "===", 
          " ", "Automatic"}], ",", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "InitialPositions", "]"}]}], " ", 
        "]"}]}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\n", "\t\t", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"mechanismCriticalTrajectoryInternal", "[", 
           RowBox[{"m", ",", " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "positions", " ", "and", " ", "direction"}], 
             "*)"}], "\n", "\t\t\t", "initialPositions", ",", " ", 
            "direction", ",", " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "data", " ", "to", " ", "decide", " ", "on", " ", "how", " ", 
              "to", " ", "choose", " ", "step", " ", "size"}], "*)"}], "\n", 
            "\t\t\t", 
            RowBox[{"{", 
             RowBox[{"steps", ",", " ", 
              RowBox[{"OptionValue", "[", "StepSize", "]"}], ",", " ", 
              RowBox[{"OptionValue", "[", "Tolerance", "]"}]}], "}"}], ",", 
            " ", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
             "what", " ", "method", " ", "to", " ", "use", " ", "to", " ", 
              "take", " ", "a", " ", "step"}], "*)"}], "\n", "\t\t\t", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{"OptionValue", "[", "Method", "]"}], "}"}], "]"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"mobileVariables", "[", " ", 
             RowBox[{"m", ",", " ", 
              RowBox[{"MechanismConstraintMap", "[", 
               RowBox[{"m", ",", " ", 
                RowBox[{"Constraints", " ", "->", " ", 
                 RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", ",",
                 " ", 
                RowBox[{"CellPattern", " ", "->", " ", 
                 RowBox[{"OptionValue", "[", "CellPattern", "]"}]}], ",", " ", 
                RowBox[{
                "ReduceLinearConstraints", " ", "->", " ", "False"}]}], 
               "]"}]}], " ", "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"{", "opt", "}"}]}], "\n", "\t\t", "]"}]}], "\n", "\t", 
         "}"}], ",", "\n", "\t\t", 
        RowBox[{
         RowBox[{"ToPackedArray", "[", 
          RowBox[{"N", "[", "res", "]"}], "]"}], " ", "/;", " ", 
         RowBox[{
          RowBox[{"Head", "[", "res", "]"}], " ", "=!=", " ", 
          "mechanismCriticalTrajectoryInternal"}]}]}], "\n", "\t", "]"}], " ",
       "/;", " ", 
      RowBox[{"And", "[", " ", 
       RowBox[{
        RowBox[{"positions2Q", "[", 
         RowBox[{"m", ",", " ", "initialPositions"}], "]"}], " ", ",", " ", 
        RowBox[{"displacements2Q", "[", 
         RowBox[{"m", ",", " ", "direction"}], "]"}], " ", ",", " ", 
        RowBox[{"tolerance2Q", "[", " ", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}], " ", "]"}]}], " ", 
       "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"steps2Q", "[", " ", 
   RowBox[{"steps_Integer", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", ">", "0"}], "&"}], ")"}]}], " ", "]"}], " ", ":=", " ", 
  "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"steps2Q", "[", " ", "steps_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismCriticalTrajectory", "::", "steps"}], "]"}], ";", " ",
      "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"tolerance2Q", "[", " ", 
   RowBox[{"tol_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"NumericQ", "[", "#", "]"}], "&&", 
       RowBox[{"#", "\[GreaterEqual]", "0"}]}], "&"}], ")"}]}], " ", "]"}], 
  " ", ":=", " ", "True"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tolerance2Q", "[", " ", "tol_", " ", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"MechanismCriticalTrajectory", "::", "tol"}], "]"}], ";", " ", 
     "False"}], ")"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"positions2Q", "[", " ", 
   RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
  RowBox[{"If", "[", " ", 
   RowBox[{
    RowBox[{"NumericCoordinatesQ", "[", 
     RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismCriticalTrajectory", "::", "pos"}], ",", 
       "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacements2Q", "[", " ", 
    RowBox[{"m_", " ", ",", " ", "positions_"}], " ", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", " ", 
    RowBox[{
     RowBox[{"NumericCoordinatesQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}], ",", " ", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"MechanismCriticalTrajectory", "::", "disp"}], ",", 
        "positions"}], "]"}], ";", " ", "False"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "steps"}], "=", 
   "\"\<Number of steps is not a positive integer.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "tol"}], " ", "=", " ", 
   "\"\<Tolerance should be a positive real number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "pos"}], " ", "=", " ", 
   "\"\<Initial positions `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "disp"}], " ", "=", " ", 
   "\"\<Initial displacements `1` should be numerical and correspond to \
Mechanism..\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "sc"}], " ", "=", " ", 
   "\"\<Option StoppingCriteria is not a function or the keyword None.\>\""}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalTrajectory", "::", "sc2"}], " ", "=", " ", 
   "\"\<Function provided to StoppingCriteria does not return True or \
False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7925]:=",ExpressionUUID->"51fc3778-6d33-47f5-91c6-00d9696d6fe1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mechanismCriticalTrajectoryInternal", "[", " ", 
   RowBox[{
   "m_", ",", " ", "\n", "\t", "initialPositions_", ",", " ", "direction_", 
    ",", " ", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"steps_", ",", " ", "stepsize_", ",", " ", "tolerance_"}], "}"}],
     ",", " ", "\n", "\t", 
    RowBox[{"{", 
     RowBox[{"method_", " ", ",", " ", "methodSpec___"}], "}"}], " ", ",", 
    " ", "\n", "\t", "constraintData_", ",", "\n", "\t", "options_"}], " ", 
   "]"}], " ", ":=", "\n", 
  RowBox[{"Module", "[", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"detval", ",", " ", "grad"}], "}"}], ",", " ", 
    RowBox[{"With", "[", "\n", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{
        RowBox[{"minimizationOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{
             RowBox[{"{", "methodSpec", "}"}], ",", " ", 
             RowBox[{"Options", "[", "FindMinimum", "]"}]}], " ", "]"}], ",", 
           " ", 
           RowBox[{"Except", "[", "Gradient", "]"}]}], " ", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"nullspaceOptions", " ", "=", " ", 
         RowBox[{"FilterRules", "[", " ", 
          RowBox[{
           RowBox[{"{", "methodSpec", "}"}], ",", " ", 
           RowBox[{"Options", "[", "NullSpace", "]"}]}], " ", "]"}]}], ",", 
        "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{"normalize", " ", "the", " ", "initial", " ", "direction"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"normalizedDirection", " ", "=", " ", 
         RowBox[{"direction", "/", 
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", "direction", "]"}], " ", ".", " ", 
            RowBox[{"Flatten", "[", "direction", "]"}]}], " ", "]"}]}]}], ",",
         "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{
         "function", " ", "to", " ", "determine", " ", "local", " ", 
          "constraints"}], "*)"}], "\n", "\t\t", 
        RowBox[{"constraintMatrixFunc", " ", "=", " ", 
         RowBox[{"mechanismConstraintMatrixFunction", "[", " ", 
          RowBox[{"m", " ", ",", " ", 
           RowBox[{"FilterRules", "[", " ", 
            RowBox[{"options", ",", " ", 
             RowBox[{
             "Options", "[", "mechanismConstraintMatrixFunction", "]"}]}], 
            " ", "]"}]}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"(*", " ", 
         RowBox[{
         "data", " ", "needed", " ", "to", " ", "compute", " ", "the", " ", 
          "energy", " ", "and", " ", "gradient"}], " ", "*)"}], "\n", "\t\t", 
        
        RowBox[{"criticalEnergy", " ", "=", " ", 
         RowBox[{"criticalGradient", "[", "m", "]"}]}], ",", "\n", "\t", 
        RowBox[{"(*", 
         RowBox[{
         "rest", " ", "of", " ", "energy", " ", "to", " ", "minimize"}], 
         "*)"}], "\n", "\t\t", 
        RowBox[{"energy", " ", "=", " ", 
         RowBox[{"MechanismEnergy", "[", 
          RowBox[{"m", " ", ",", " ", 
           RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], ",", 
           " ", "\n", "\t\t\t\t\t\t", 
           RowBox[{"Sequence", " ", "@@", " ", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{"FilterRules", "[", " ", 
               RowBox[{"options", " ", ",", " ", 
                RowBox[{"Options", "[", "MechanismEnergy", "]"}]}], "]"}], 
              ",", " ", 
              RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], 
             "]"}]}]}], " ", "]"}]}], ",", "\n", "\t", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{"VertexPosition", "[", "m", "]"}], "]"}]}], ",", "\n", "\t", 
        RowBox[{"dim", " ", "=", " ", 
         RowBox[{"Length", "[", 
          RowBox[{"initialPositions", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "\n", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"detval", " ", "=", " ", 
        RowBox[{
         RowBox[{"detEval", "[", "criticalEnergy", "]"}], "[", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}]}], 
       ";", "\n", "\t", 
       RowBox[{"grad", " ", "=", " ", 
        RowBox[{"D", "[", " ", 
         RowBox[{"energy", " ", ",", " ", 
          RowBox[{"{", "positions", "}"}]}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"Map", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"#", " ", ",", " ", "dim"}], "]"}], "&"}], ",", "\n", "\n",
          "\t\t", 
         RowBox[{"DeleteCases", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"FoldList", "[", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"constrainedTrajectoryStep", "[", " ", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                  "method", ",", " ", "stepsize", ",", " ", "tolerance"}], 
                  "}"}], ",", " ", "m", ",", " ", "\n", "\t\t\t\t\t", "#1", 
                 ",", " ", "#2", ",", " ", "\n", "\t\t\t\t\t", 
                 RowBox[{"{", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"criticalSetConstraintFunction", "[", 
                    RowBox[{"criticalEnergy", ",", " ", 
                    RowBox[{"constraintMatrixFunc", " ", "@@", " ", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], " ", "]"}], 
                    "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], " ", ",", 
                   " ", "nullspaceOptions"}], " ", "}"}], ",", " ", "\n", 
                 "\t\t\t\t\t", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"detEval", "[", 
                    RowBox[{"criticalEnergy", ",", "detval"}], "]"}], "[", 
                    "positions", "]"}], "+", "energy"}], " ", ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"positions", ",", "positions"}], "}"}], ",", " ", 
                   "\n", "\t\t\t\t\t\t\t", 
                   RowBox[{"Join", "[", " ", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Gradient", " ", ":>", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"gradEval", "[", 
                    RowBox[{"criticalEnergy", ",", "detval"}], "]"}], "[", 
                    "positions", "]"}], " ", "+", " ", "grad"}], ")"}]}], 
                    "}"}], " ", ",", " ", "minimizationOptions"}], "]"}]}], 
                  "\n", "\t\t\t\t\t", "}"}]}], " ", "\n", "\t\t\t\t", "]"}], 
               " ", "&"}], ",", "\n", "\t\t\t\t", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Flatten", "@", "initialPositions"}], ",", 
                "normalizedDirection"}], "}"}], ",", "\n", "\t\t\t\t", 
              RowBox[{"Range", "[", "steps", "]"}]}], "\n", "\t\t\t", "]"}], 
            "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "\n", "\t\t\t", 
           "$Failed"}], "\n", "\t\t", "]"}]}], "\n", "\t", "]"}]}]}], "\n", 
     "]"}]}], "]"}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:13 \
In[7938]:=",ExpressionUUID->"8c748e4a-8e6c-4882-a081-f3d33f7de21f"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalDeterminant[]", "Subsection",ExpressionUUID->"c47a1a6f-189b-42f6-95e9-1d8af71978dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "computes", " ", "the", " ", "determinant", " ", "of", " ", "R", " ", 
     RowBox[{"R", "^", "T"}]}], ",", " ", 
    RowBox[{
    "where", " ", "R", " ", "is", " ", "the", " ", "constraint", " ", 
     RowBox[{"matrix", ".", "\n", "\n", "The"}], " ", "null", " ", "space", 
     " ", "of", " ", "this", " ", "matrix", " ", "gives", " ", "the", " ", 
     "self", " ", "stresses", " ", "and", " ", "so", " ", "its", " ", 
     "determinant", " ", "vanishes", " ", "on", " ", "the", " ", "critical", 
     " ", 
     RowBox[{"surface", "."}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "MechanismCriticalDeterminant", "]"}], " ", "=", 
     " ", 
     RowBox[{"FilterRules", "[", " ", 
      RowBox[{
       RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], ",", " ", 
       RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", 
      "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalDeterminant", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "\n", "\t", 
       RowBox[{"mat", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", " ", ".", " ", 
            RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], ")"}], "[", 
         RowBox[{"MechanismConstraintMatrix", "[", " ", 
          RowBox[{
           RowBox[{"Deformed", "[", 
            RowBox[{"m", ",", " ", 
             RowBox[{"VertexPosition", "[", "m", "]"}]}], "]"}], " ", ",", 
           " ", 
           RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], ",", 
           " ", "opt"}], "]"}], "]"}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
      RowBox[{"Det", "[", 
       RowBox[{
        RowBox[{"Normal", "[", "mat", "]"}], " ", "/.", " ", 
        RowBox[{"PositionRules", "[", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], "]"}]}], 
       "]"}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalDeterminant", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ",
        "]"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{"mat", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", ".", " ", 
             RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], ")"}], "[", 
          RowBox[{"MechanismConstraintMatrix", "[", " ", 
           RowBox[{
            RowBox[{"Deformed", "[", 
             RowBox[{"m", ",", " ", 
              RowBox[{"VertexPosition", "[", "m", "]"}]}], "]"}], " ", ",", 
            " ", 
            RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], ",",
             " ", "opt"}], "]"}], "]"}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{"Det", "[", 
        RowBox[{
         RowBox[{"Normal", "[", "mat", "]"}], " ", "/.", " ", 
         RowBox[{"PositionRules", "[", "positions", "]"}]}], "]"}]}], "\n", 
      "]"}], " ", "/;", " ", 
     RowBox[{"VertexCoordinates", "[", 
      RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalDeterminant", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ",
        "]"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{
     RowBox[{"With", "[", "\n", "\t", 
      RowBox[{
       RowBox[{"{", "\n", "\t", 
        RowBox[{"mat", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", " ", ".", " ", 
             RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], ")"}], "[", 
          RowBox[{"MechanismConstraintMatrix", "[", " ", 
           RowBox[{
            RowBox[{"Deformed", "[", 
             RowBox[{"m", ",", " ", 
              RowBox[{"VertexPosition", "[", "m", "]"}]}], "]"}], " ", ",", 
            " ", 
            RowBox[{"ReduceLinearConstraints", " ", "->", " ", "False"}], ",",
             " ", "opt"}], "]"}], "]"}]}], "\n", "\t", "}"}], ",", "\n", "\t", 
       RowBox[{"Det", " ", "/@", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Normal", "[", "mat", "]"}], " ", "/.", " ", 
          RowBox[{"PositionRules", "[", "positions", "]"}]}], ")"}]}]}], "\n",
       "]"}], " ", "/;", " ", 
     RowBox[{"VertexCoordinateListQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalDeterminant", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ",
        "]"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismCriticalValue", "::", "pos"}], ",", "positions"}], 
      "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismCriticalDeterminant", "::", "pos"}], " ", "=", " ", 
     "\"\<Positions `1` do not conform to mechanism.\>\""}], 
    ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:14 \
In[7939]:=",ExpressionUUID->"b304362a-3584-4dd1-ac0a-bcdf11973baf"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalPoint[]", "Subsection",ExpressionUUID->"39852e63-921f-423b-8183-eeb2b7a02c60"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "MechanismCriticalPoint", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", " ", "\n", "\t", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"InitialPositions", " ", "->", " ", "Automatic"}], " ", ",", 
        " ", 
        RowBox[{"CellPattern", " ", "->", " ", "_"}], ",", " ", 
        RowBox[{"Constraints", " ", "->", " ", "None"}], ",", " ", 
        RowBox[{"AddedEnergy", " ", "->", " ", "0"}]}], "}"}], " ", ",", " ", 
      "\n", "\t", 
      RowBox[{"Options", "[", "FindMinimum", "]"}]}], "\n", "\t", "]"}]}], 
   ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalPoint", "[", " ", 
    RowBox[{
     RowBox[{"m_", "?", "MechanismQ"}], ",", " ", 
     RowBox[{"n", " ", ":", " ", 
      RowBox[{"_", "?", "NumericQ"}], " ", ":", " ", "Automatic"}], ",", " ", 
     
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "\n", "\t", 
      RowBox[{
       RowBox[{"initialPositions", " ", "=", " ", 
        RowBox[{"criticalPointInitial", "[", " ", 
         RowBox[{
          RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}], ",", " ", 
          RowBox[{"OptionValue", "[", "InitialPositions", "]"}]}], " ", 
         "]"}]}], ",", "\n", "\t", "positions", ",", "\n", "\t", 
       RowBox[{"linear", " ", "=", " ", 
        RowBox[{"MechanismLinearConstraints", "[", 
         RowBox[{"m", ",", " ", 
          RowBox[{"Constraints", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "Constraints", "]"}]}], ",", " ", 
          RowBox[{"CellPattern", " ", "->", " ", 
           RowBox[{"OptionValue", "[", "CellPattern", "]"}]}]}], " ", "]"}]}],
        ",", "\n", "\t", 
       RowBox[{"(*", 
        RowBox[{
        "this", " ", "is", " ", "potentially", " ", "inefficient", " ", 
         "because", " ", "we", " ", "are", " ", "basically", " ", "doing", 
         " ", "this", " ", "more", " ", "than", " ", 
         RowBox[{"once", "."}]}], "*)"}], "\n", "\t", "inequalities", ",", 
       "\n", "\n", "\t", "variables", ",", " ", "namedVariables", ",", " ", 
       "mobileVertices", ",", "\n", "\t\t\t", "\n", "\t", "energy", ",", " ", 
       "gradient", ",", "\n", "\t", "\n", "\t", 
       RowBox[{"criticalFunctions", " ", "=", " ", 
        RowBox[{"criticalGradient", "[", " ", "m", " ", "]"}]}], ",", "\n", 
       "\t", "argument", ",", "\n", "\t", "\n", "\t", "solution", ",", " ", 
       "nPositions"}], "\n", "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"inequalities", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"processConstraintEquations", "[", 
            RowBox[{
             RowBox[{"VertexPosition", "[", "m", "]"}], ",", " ", 
             RowBox[{"OptionValue", "[", "Constraints", "]"}]}], "]"}], "[", 
           "\"\<inequalities\>\"", "]"}], " ", "/.", " ", "linear"}], ",", 
         " ", "True"}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Cases", "[", 
           RowBox[{"inequalities", ",", " ", "False"}], "]"}], "]"}], " ", 
         ">", " ", "0"}], ",", " ", "\n", "\t\t", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"MechanismCriticalPoint", "::", "ineq"}], "]"}], ";", "\n", 
         "\t\t", 
         RowBox[{"inequalities", " ", "=", " ", 
          RowBox[{"DeleteCases", "[", " ", 
           RowBox[{"inequalities", " ", ",", " ", "False"}], " ", "]"}]}]}]}],
        "\n", "\t", "]"}], ";", "\n", "\n", "\t", 
      RowBox[{"positions", " ", "=", " ", 
       RowBox[{
        RowBox[{"VertexPosition", "[", "m", "]"}], " ", "/.", " ", 
        "linear"}]}], ";", "\n", "\t", 
      RowBox[{"variables", " ", "=", " ", 
       RowBox[{"Cases", "[", " ", 
        RowBox[{
         RowBox[{"Flatten", "[", "positions", "]"}], ",", " ", 
         "_VertexPosition"}], " ", "]"}]}], ";", "\n", "\t", 
      RowBox[{"namedVariables", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Unique", "[", "]"}], "&"}], " ", "/@", " ", "variables"}]}],
       ";", "\n", "\t", 
      RowBox[{"mobileVertices", " ", "=", " ", 
       RowBox[{"Pick", "[", " ", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", "positions", "]"}], "]"}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"MatchQ", "[", 
            RowBox[{"#", ",", "_VertexPosition"}], "]"}], "&"}], " ", "/@", 
          " ", 
          RowBox[{"Flatten", "[", "positions", "]"}]}]}], "]"}]}], ";", "\n", 
      "\n", "\t", 
      RowBox[{"(*", 
       RowBox[{
       "construct", " ", "the", " ", "additional", " ", "mechanism", " ", 
        "energy", " ", "and", " ", "its", " ", "gradient"}], "*)"}], "\t", 
      "\n", "\t", 
      RowBox[{"energy", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MechanismEnergy", "[", " ", 
           RowBox[{"m", " ", ",", " ", "\n", "\t\t", 
            RowBox[{"Constraints", " ", "->", " ", 
             RowBox[{"OptionValue", "[", "Constraints", "]"}]}], " ", ",", 
            "\n", "\t\t", 
            RowBox[{"CellPattern", " ", "->", " ", 
             RowBox[{"OptionValue", "[", "CellPattern", "]"}]}]}], " ", "]"}],
           " ", "+", " ", 
          RowBox[{
          "Mechanisms`geometry`Private`MechanismGeometricExpression", "[", 
           RowBox[{"m", ",", 
            RowBox[{"OptionValue", "[", "AddedEnergy", "]"}]}], "]"}]}], " ", 
         "/.", " ", 
         RowBox[{"PositionRules", "[", " ", "positions", " ", "]"}]}], " ", "/.",
         " ", 
        RowBox[{"Thread", "[", " ", 
         RowBox[{"variables", " ", "->", " ", "namedVariables"}], " ", 
         "]"}]}]}], ";", "\n", "\t", 
      RowBox[{"gradient", " ", "=", " ", 
       RowBox[{"D", "[", " ", 
        RowBox[{"energy", " ", ",", " ", 
         RowBox[{"{", "namedVariables", "}"}]}], " ", "]"}]}], ";", "\n", 
      "\t", 
      RowBox[{"argument", " ", "=", " ", 
       RowBox[{
        RowBox[{"Flatten", "[", "positions", "]"}], " ", "/.", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"variables", " ", "->", " ", "namedVariables"}], "]"}]}]}], 
      ";", "\n", "\n", "\t", 
      RowBox[{"solution", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "inequalities", "]"}], "==", "0"}], ",", 
         "\n", "\t\t ", 
         RowBox[{"FindMinimum", " ", "@@", " ", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"detEval", "[", 
               RowBox[{"criticalFunctions", ",", " ", "n"}], "]"}], "[", " ", 
              "argument", " ", "]"}], " ", "+", " ", "energy"}], ",", "\n", 
            "\t\t\t", 
            RowBox[{"Transpose", "[", " ", 
             RowBox[{"{", 
              RowBox[{"namedVariables", " ", ",", " ", 
               RowBox[{"variables", " ", "/.", " ", 
                RowBox[{
                "PositionRules", "[", " ", "initialPositions", " ", "]"}]}]}],
               "}"}], "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"Gradient", " ", ":>", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"gradEval", "[", 
                 RowBox[{"criticalFunctions", ",", " ", "n"}], "]"}], "[", 
                " ", "argument", " ", "]"}], "[", 
               RowBox[{"[", " ", "mobileVertices", " ", "]"}], "]"}], " ", 
              "+", " ", "gradient"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"Sequence", " ", "@@", " ", 
             RowBox[{"FilterRules", "[", " ", 
              RowBox[{
               RowBox[{"FilterRules", "[", " ", 
                RowBox[{
                 RowBox[{"{", "opt", "}"}], ",", " ", 
                 RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}], ",", 
               " ", 
               RowBox[{"Except", "[", "Gradient", "]"}]}], " ", "]"}]}]}], 
           "\n", "\t\t", "}"}]}], ",", "\n", "\t\t ", 
         RowBox[{"FindMinimum", " ", "@@", " ", 
          RowBox[{"{", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"detEval", "[", 
                  RowBox[{"criticalFunctions", ",", " ", "n"}], "]"}], "[", 
                 " ", "argument", " ", "]"}], " ", "+", " ", "energy"}], ",", 
               " ", 
               RowBox[{"inequalities", " ", "/.", " ", 
                RowBox[{"Thread", "[", 
                 RowBox[{"variables", " ", "->", " ", "namedVariables"}], 
                 "]"}]}]}], "}"}], "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"Transpose", "[", " ", 
             RowBox[{"{", 
              RowBox[{"namedVariables", " ", ",", " ", 
               RowBox[{"variables", " ", "/.", " ", 
                RowBox[{
                "PositionRules", "[", " ", "initialPositions", " ", "]"}]}]}],
               "}"}], "]"}], ",", "\n", "\t\t\t", 
            RowBox[{"Gradient", " ", ":>", " ", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"gradEval", "[", 
                 RowBox[{"criticalFunctions", ",", " ", "n"}], "]"}], "[", 
                " ", "argument", " ", "]"}], "[", 
               RowBox[{"[", " ", "mobileVertices", " ", "]"}], "]"}], " ", 
              "+", " ", "gradient"}]}], ",", "\n", "\t\t\t", 
            RowBox[{"Sequence", " ", "@@", " ", 
             RowBox[{"FilterRules", "[", " ", 
              RowBox[{
               RowBox[{"FilterRules", "[", " ", 
                RowBox[{
                 RowBox[{"{", "opt", "}"}], ",", " ", 
                 RowBox[{"Options", "[", "FindMinimum", "]"}]}], "]"}], ",", 
               " ", 
               RowBox[{"Except", "[", "Gradient", "]"}]}], " ", "]"}]}]}], 
           "\n", "\t\t", "}"}]}]}], "\t\t", "\n", "\t", "]"}]}], ";", "\n", 
      "\n", "\t", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"ListQ", "[", " ", "solution", " ", "]"}], ",", " ", "\n", 
        "\t\t", 
        RowBox[{
         RowBox[{"nPositions", " ", "=", " ", 
          RowBox[{
           RowBox[{"positions", " ", "/.", " ", 
            RowBox[{"Thread", "[", 
             RowBox[{"variables", " ", "->", " ", "namedVariables"}], "]"}]}],
            " ", "/.", " ", 
           RowBox[{"solution", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], " ", ";", "\n", "\t\t", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"detEval", "[", "criticalFunctions", "]"}], "[", 
            RowBox[{"Flatten", "@", "nPositions"}], "]"}], " ", ",", " ", 
           "nPositions"}], " ", "}"}]}], ",", "\n", "\t\t", "$Failed"}], "\n",
        "\t", "]"}]}]}], "\n", "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"criticalPointInitial", "[", " ", 
   RowBox[{"coordinates_", " ", ",", " ", "Automatic"}], " ", "]"}], " ", ":=",
   " ", "coordinates"}], "\n", 
 RowBox[{
  RowBox[{"criticalPointInitial", "[", " ", 
   RowBox[{"coordinates_", " ", ",", " ", 
    RowBox[{"positions_", "?", "NumericCoordinatesQ"}]}], " ", "]"}], " ", ":=",
   " ", 
  RowBox[{"positions", " ", "/;", " ", 
   RowBox[{
    RowBox[{"Dimensions", "[", " ", "coordinates", " ", "]"}], " ", "==", " ", 
    RowBox[{"Dimensions", "[", " ", "positions", " ", "]"}]}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"criticalPointInitial", "[", " ", 
    RowBox[{"coordinates_", ",", " ", "positions_"}], " ", "]"}], " ", ":=", 
   " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismCriticalPoints", "::", "pos"}], ",", " ", 
       "positions"}], " ", "]"}], ";", " ", "coordinates"}], ")"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalPoint", "::", "pos"}], " ", "=", " ", 
   "\"\<Positions `1` do not match mechanism.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"MechanismCriticalPoint", "::", "ineq"}], " ", "=", " ", 
   "\"\<Some inequalities are strictly False.\>\""}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:14 \
In[7945]:=",ExpressionUUID->"3496056d-8f6d-4d0c-bdb8-123d0cebdd3c"]
}, Closed]],

Cell[CellGroupData[{

Cell["MechanismCriticalTangentVectors[]", "Subsection",ExpressionUUID->"be09ca57-c4d4-4c71-97c6-4c474d6308a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{
    "computes", " ", "the", " ", "tangent", " ", "vectors", " ", "to", " ", 
     "the", " ", "surface", " ", "of", " ", "constant", " ", "determinant", 
     " ", "of", " ", "R", " ", 
     RowBox[{"R", "^", "T"}]}], ",", " ", 
    RowBox[{
    "where", " ", "R", " ", "is", " ", "the", " ", "constraint", " ", 
     RowBox[{"matrix", "."}]}]}], "\n", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "MechanismCriticalTangentVectors", "]"}], " ", 
     "=", " ", 
     RowBox[{"FilterRules", "[", " ", 
      RowBox[{
       RowBox[{"Options", "[", "MechanismConstraintMatrix", "]"}], ",", " ", 
       RowBox[{"Except", "[", "ReduceLinearConstraints", "]"}]}], " ", 
      "]"}]}], " ", ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalTangentVectors", "[", " ", 
     RowBox[{
      RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"criticalFunc", " ", "=", " ", 
        RowBox[{"criticalGradient", "[", "m", "]"}]}], " ", "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{"#", " ", ",", " ", 
          RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], " ", "]"}],
         "&"}], " ", "/@", " ", 
       RowBox[{
        RowBox[{"criticalSetTangents", "[", " ", 
         RowBox[{"criticalFunc", " ", ",", " ", 
          RowBox[{"MechanismConstraintMatrix", "[", " ", 
           RowBox[{"m", " ", ",", " ", 
            RowBox[{"ReduceLinearConstraints", "->", "False"}], ",", " ", 
            "opt"}], "]"}]}], " ", "]"}], "[", 
        RowBox[{"Flatten", " ", "@", " ", 
         RowBox[{"m", "[", "\"\<VertexCoordinates\>\"", "]"}]}], "]"}]}]}], 
     "\n", "]"}]}], "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalTangentVectors", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ",
        "]"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    "\n", 
    RowBox[{
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"criticalFunc", " ", "=", " ", 
         RowBox[{"criticalGradient", "[", "m", "]"}]}], " ", "}"}], ",", "\n",
        "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"#", " ", ",", " ", 
           RowBox[{"m", "[", "\"\<EmbeddingDimension\>\"", "]"}]}], " ", 
          "]"}], "&"}], " ", "/@", " ", 
        RowBox[{
         RowBox[{"criticalSetTangents", "[", " ", "\n", "\t\t\t", 
          RowBox[{"criticalFunc", " ", ",", " ", "\n", "\t\t\t", 
           RowBox[{"MechanismConstraintMatrix", "[", " ", 
            RowBox[{
             RowBox[{"Deformed", "[", 
              RowBox[{"m", ",", "positions"}], "]"}], " ", ",", " ", 
             RowBox[{"ReduceLinearConstraints", "->", "False"}], ",", " ", 
             "opt"}], "]"}]}], " ", "]"}], "[", "\n", "\t\t", 
         RowBox[{"Flatten", " ", "@", " ", "positions"}], "]"}]}]}], "\n", 
      "]"}], " ", "/;", " ", 
     RowBox[{"VertexCoordinatesQ", "[", 
      RowBox[{"m", ",", "positions"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{"MechanismCriticalTangentVectors", "[", " ", 
     RowBox[{
      RowBox[{"Deformed", "[", " ", 
       RowBox[{
        RowBox[{"m_", "?", "MechanismQ"}], " ", ",", " ", "positions_"}], " ",
        "]"}], ",", " ", 
      RowBox[{"opt", " ", ":", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], " ", "]"}], " ", ":=", " ", 
    RowBox[{"\"\<nothing\>\"", " ", "/;", " ", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"MechanismCriticalTangentVectors", "::", "pos"}], ",", 
       "positions"}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"MechanismCriticalTangentVectors", "::", "pos"}], " ", "=", " ", 
     "\"\<Positions `1` do not match mechanism.\>\""}], ";"}]}]}]], "Code",
 CellLabel->
  "1/2/24 10:12:14 \
In[7952]:=",ExpressionUUID->"dccd4b33-5244-4fda-a445-aee7599831e8"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Post", "Section",ExpressionUUID->"e88c3418-d1b6-4d70-940f-caf4d5b07981"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 CellLabel->
  "1/2/24 10:12:14 \
In[7957]:=",ExpressionUUID->"b96c1413-a39a-47bf-a804-4eb56d54d55e"]
}, Open  ]]
}, Closed]]
}, Open  ]]
},
WindowSize->{1111, 768},
WindowMargins->{{Automatic, -59}, {Automatic, 0}},
Magnification->1.,
FrontEndVersion->"13.3 for Mac OS X x86 (64-bit) (July 24, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"d3d5b704-240b-45dc-9724-92278d2cb5eb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 90, 0, 98, "Title",ExpressionUUID->"130b3787-7aa9-48f9-8ced-30b05119f93a"],
Cell[673, 24, 168, 4, 81, "Text",ExpressionUUID->"a287b323-0ec1-4bfc-ac7b-b122cce5f6f7"],
Cell[CellGroupData[{
Cell[866, 32, 100, 0, 45, "Subsubsection",ExpressionUUID->"6d3b1798-1603-4e1f-a3fb-a831a45b5512"],
Cell[969, 34, 222, 5, 35, "Text",ExpressionUUID->"fd552589-5b13-4cba-8060-e04008711b7b"],
Cell[1194, 41, 164, 4, 35, "Text",ExpressionUUID->"5b61e7c9-2ff5-4e08-9046-4fe654d2bc7d"],
Cell[1361, 47, 234, 5, 35, "Text",ExpressionUUID->"47c99494-6580-4a80-9766-1a2595a00f8d"],
Cell[1598, 54, 202, 4, 35, "Text",ExpressionUUID->"5b4fb190-7420-4fe6-b9ee-0710831e0b2a"],
Cell[1803, 60, 192, 4, 35, "Text",ExpressionUUID->"85ea895a-171e-480f-b701-c119aed055d6"],
Cell[1998, 66, 225, 5, 35, "Text",ExpressionUUID->"7a480a6f-f888-43dc-8777-8cbd2eb306f6"],
Cell[2226, 73, 315, 5, 58, "Text",ExpressionUUID->"e4ef7bb6-5622-4ec5-8d97-20b894f9d806"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2578, 83, 109, 0, 45, "Subsubsection",ExpressionUUID->"5effce6f-d2fc-4343-8138-d788d00f2d13"],
Cell[2690, 85, 235, 3, 35, "Text",ExpressionUUID->"7e24a6a5-4355-4ea6-b4d0-8c0c5dce255e"],
Cell[2928, 90, 254, 4, 58, "Text",ExpressionUUID->"3c29e79e-c97c-45d3-a1ea-174eedb8cf96"],
Cell[3185, 96, 165, 3, 35, "Text",ExpressionUUID->"50f80464-0989-4dbe-adb2-45b20020c8a6"],
Cell[3353, 101, 149, 2, 35, "Text",ExpressionUUID->"3e1ff100-05de-4b71-bc6f-3e0fe0f5e7e6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3539, 108, 106, 0, 45, "Subsubsection",ExpressionUUID->"996e8192-dd83-4d95-8bb9-82a6d1e6f792"],
Cell[3648, 110, 189, 3, 35, "Text",ExpressionUUID->"a26cd813-d33b-4e4f-9693-02bd8df2ecc3"],
Cell[3840, 115, 368, 5, 58, "Text",ExpressionUUID->"22721566-57b5-4fb2-ab1a-2082383c99f9"],
Cell[4211, 122, 191, 3, 35, "Text",ExpressionUUID->"88d7e353-9f10-49cf-a722-102c87abfad2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4439, 130, 102, 0, 45, "Subsubsection",ExpressionUUID->"7669e260-6590-4d78-9fd1-a329f9dd1f60"],
Cell[4544, 132, 117, 0, 35, "Text",ExpressionUUID->"de519dea-c6ba-4b6e-b9b8-68b8224f3d40"],
Cell[CellGroupData[{
Cell[4686, 136, 856, 24, 87, "Input",ExpressionUUID->"bdc64312-753d-4eb5-8a7c-c436ed551c43"],
Cell[5545, 162, 22642, 400, 75, "Output",ExpressionUUID->"01974d94-2789-441a-b669-c057da36a718"]
}, Open  ]],
Cell[28202, 565, 256, 4, 35, "Text",ExpressionUUID->"5d4c8443-1f18-4a6f-93cf-acd6c17ec2a0"],
Cell[28461, 571, 104, 0, 35, "Text",ExpressionUUID->"8c0f275a-0a6f-49f8-8b27-df573f355ff7"],
Cell[28568, 573, 189, 4, 44, "Input",ExpressionUUID->"bae0a72b-16f7-4640-9196-dd8e0df27892"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28794, 582, 84, 0, 69, "Chapter",ExpressionUUID->"1007bea5-8919-43d5-b2b7-1d591eacbee8"],
Cell[28881, 584, 268, 7, 66, "Code",ExpressionUUID->"19f747a5-46c1-4c74-9468-5aa2b9f8da15"],
Cell[CellGroupData[{
Cell[29174, 595, 93, 0, 67, "Section",ExpressionUUID->"e8755456-61af-4d01-a4b3-3c63afdd42db"],
Cell[29270, 597, 1966, 52, 333, "Code",ExpressionUUID->"79322a72-1ef5-40c5-8b71-24d04e2c58a5"]
}, Closed]],
Cell[CellGroupData[{
Cell[31273, 654, 79, 0, 53, "Section",ExpressionUUID->"86495105-a446-474d-bbe6-03bd1334054f"],
Cell[31355, 656, 5174, 113, 428, "Code",ExpressionUUID->"6058a131-dea1-48d0-a8b1-9755094b2f70"],
Cell[36532, 771, 301, 8, 66, "Code",ExpressionUUID->"6a2885be-244c-4caa-9110-a2e59332412c"],
Cell[36836, 781, 3143, 58, 222, "Code",ExpressionUUID->"f1ba8c9f-55ca-4f86-a5a2-8ba1395def9e"],
Cell[39982, 841, 7430, 140, 570, "Code",ExpressionUUID->"e4d10adb-f929-4d10-82bc-4b12de09613d"],
Cell[47415, 983, 3482, 63, 333, "Code",ExpressionUUID->"7445fe50-3c2c-4866-8fe2-7eea17dc51c4"],
Cell[50900, 1048, 6399, 100, 561, "Code",ExpressionUUID->"91875964-7201-4edd-b967-73869fbe7944"],
Cell[57302, 1150, 1064, 21, 162, "Code",ExpressionUUID->"256a186e-82a8-4d54-8ce2-d06f99a7462a"],
Cell[58369, 1173, 325, 8, 66, "Code",ExpressionUUID->"22907678-8e63-445b-bf88-1cf1b4802c34"],
Cell[58697, 1183, 11620, 212, 870, "Code",ExpressionUUID->"1541dce7-e5b5-40a8-8bd4-290f6eff1d3f"],
Cell[70320, 1397, 1982, 31, 219, "Code",ExpressionUUID->"ee63bb43-3ce4-4d8a-a461-67e8703ba434"],
Cell[72305, 1430, 970, 17, 124, "Code",ExpressionUUID->"a87484c2-87d5-4419-891d-49b8756ecec4"],
Cell[73278, 1449, 1907, 31, 86, "Code",ExpressionUUID->"186f7969-7d96-47c8-96e9-fa6761c66af2"],
Cell[75188, 1482, 5430, 116, 504, "Code",ExpressionUUID->"b3ce6a72-fd97-4ba7-91fc-018986a4f1ec"]
}, Closed]],
Cell[CellGroupData[{
Cell[80655, 1603, 98, 0, 53, "Section",ExpressionUUID->"cfa1c0f4-94af-49a0-98cd-e435294e26f2"],
Cell[80756, 1605, 193, 5, 66, "Code",ExpressionUUID->"06fc029e-a0bb-4bdb-9997-a62c8c544d33"],
Cell[80952, 1612, 1358, 42, 200, "Code",ExpressionUUID->"dc607867-c94e-46c7-a9ad-2c0f7a10f245"],
Cell[CellGroupData[{
Cell[82335, 1658, 89, 0, 54, "Subsection",ExpressionUUID->"eff07146-d872-4431-837d-c7f0a6ec7629"],
Cell[82427, 1660, 654, 18, 125, "Code",ExpressionUUID->"a5aa8b49-bcf0-48ef-881c-d1ffc63e1b4c"]
}, Closed]],
Cell[CellGroupData[{
Cell[83118, 1683, 130, 0, 38, "Subsection",ExpressionUUID->"5cf74a85-b4c1-4085-b474-db69e3569d24"],
Cell[83251, 1685, 1403, 39, 181, "Code",ExpressionUUID->"70919af2-7965-4a0c-8692-fec7696c86d0"],
Cell[84657, 1726, 2446, 62, 181, "Code",ExpressionUUID->"70585b2e-2fea-45e2-81c4-afc444157acf"],
Cell[87106, 1790, 3801, 110, 314, "Code",ExpressionUUID->"f5ce23c9-dd88-49e3-8ce9-d15ea2f4a0f2"]
}, Closed]],
Cell[CellGroupData[{
Cell[90944, 1905, 125, 0, 38, "Subsection",ExpressionUUID->"d1bfb2ec-05b0-4a63-91f8-fcaf3033211d"],
Cell[91072, 1907, 3623, 93, 485, "Code",ExpressionUUID->"ed571078-958d-4e2f-a397-1d8c061345b0"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[94744, 2006, 111, 0, 53, "Section",ExpressionUUID->"32abf7e8-c1c3-4c59-b203-2f531969c22b"],
Cell[CellGroupData[{
Cell[94880, 2010, 87, 0, 54, "Subsection",ExpressionUUID->"af8d39d2-e6d6-4050-8965-bc05f40569d0"],
Cell[94970, 2012, 507, 14, 66, "Code",ExpressionUUID->"7fbf1a47-bbdd-40af-8183-29e1ca6e4192"]
}, Closed]],
Cell[CellGroupData[{
Cell[95514, 2031, 88, 0, 38, "Subsection",ExpressionUUID->"3140d306-2fe3-4d80-8519-e5c1a3a2179c"],
Cell[95605, 2033, 2529, 65, 371, "Code",ExpressionUUID->"d441c2cb-db4c-4b3c-be58-c401dbbf458e"],
Cell[98137, 2100, 2045, 55, 262, "Code",ExpressionUUID->"c533ba08-40c1-4f85-a5d9-ebd3d51e166d"],
Cell[100185, 2157, 4890, 122, 733, "Code",ExpressionUUID->"3dd53cf3-60d9-466a-835b-f9f10dab12f1"]
}, Closed]],
Cell[CellGroupData[{
Cell[105112, 2284, 90, 0, 38, "Subsection",ExpressionUUID->"ee5265f2-5b85-4a46-a28b-a243bc9ff076"],
Cell[105205, 2286, 2081, 56, 371, "Code",ExpressionUUID->"4875f961-32d2-4913-98ea-6cdd16c6277c"]
}, Closed]],
Cell[CellGroupData[{
Cell[107323, 2347, 154, 2, 38, "Subsection",ExpressionUUID->"df7a1f65-a32e-49cc-8c27-29579d1205e6"],
Cell[107480, 2351, 888, 26, 86, "Code",ExpressionUUID->"f1139107-b69c-4fd4-8921-cbf950ea380f"],
Cell[108371, 2379, 906, 26, 86, "Code",ExpressionUUID->"aedb8fbc-7b63-4e91-8f14-89eba922e5be"],
Cell[109280, 2407, 3416, 89, 466, "Code",ExpressionUUID->"b5a4e93b-03e7-40af-85c4-fe8ffd3be9b9"]
}, Closed]],
Cell[CellGroupData[{
Cell[112733, 2501, 108, 0, 38, "Subsection",ExpressionUUID->"530c0200-8cec-4ba0-ac9d-8bb8ee2048af"],
Cell[112844, 2503, 1140, 30, 129, "Code",ExpressionUUID->"3dcbb299-d60d-4ccd-b0a6-8765b702245a"],
Cell[113987, 2535, 1021, 26, 148, "Code",ExpressionUUID->"102c4a3c-1dcf-48e5-af1a-6ac1cb37098a"]
}, Closed]],
Cell[CellGroupData[{
Cell[115045, 2566, 99, 0, 38, "Subsection",ExpressionUUID->"66a4fa93-b1cb-408a-b53d-07229a966a10"],
Cell[115147, 2568, 1932, 50, 257, "Code",ExpressionUUID->"64d17235-533b-4916-b535-0ebabd865c68"]
}, Closed]],
Cell[CellGroupData[{
Cell[117116, 2623, 100, 0, 38, "Subsection",ExpressionUUID->"31a2a4ca-20a8-4cbc-b01c-74d8e07dc5cb"],
Cell[117219, 2625, 1305, 36, 143, "Code",ExpressionUUID->"0a895eca-c68c-4041-b86b-8579247034b0"]
}, Closed]],
Cell[CellGroupData[{
Cell[118561, 2666, 100, 0, 38, "Subsection",ExpressionUUID->"cc99abc8-e331-4953-92b3-a1c47ba4bc34"],
Cell[118664, 2668, 2557, 70, 178, "Code",ExpressionUUID->"1e0e07f6-211b-4e69-acf1-1a551cb32302"]
}, Closed]],
Cell[CellGroupData[{
Cell[121258, 2743, 88, 0, 38, "Subsection",ExpressionUUID->"9b7efb19-fa3f-458c-b10d-055c4761c19a"],
Cell[121349, 2745, 1546, 41, 162, "Code",ExpressionUUID->"b44baf22-b49e-49eb-8d47-48ae6f6bc8b6"]
}, Closed]],
Cell[CellGroupData[{
Cell[122932, 2791, 105, 0, 38, "Subsection",ExpressionUUID->"eadd1bf6-0132-4bb4-8f59-3c816e0f837e"],
Cell[123040, 2793, 1138, 30, 143, "Code",ExpressionUUID->"a1e8e63b-acfc-4881-bf13-620eb284f367"],
Cell[124181, 2825, 8705, 231, 600, "Code",ExpressionUUID->"eb718079-61c4-4ca0-995a-7b96ba132a18"],
Cell[132889, 3058, 419, 11, 86, "Code",ExpressionUUID->"785bf8c8-60a5-44bd-a384-aea2e2c9eef1"],
Cell[133311, 3071, 6858, 172, 658, "Code",ExpressionUUID->"3e48711c-51f0-4af3-a14f-17eb5878f2bb"],
Cell[140172, 3245, 278, 8, 66, "Code",ExpressionUUID->"18f7d81c-3e4a-4d14-8b8f-8a0d0cf9a5fd"],
Cell[140453, 3255, 1707, 46, 219, "Code",ExpressionUUID->"e760c130-8b29-4ddc-8403-453272bb4643"]
}, Closed]],
Cell[CellGroupData[{
Cell[142197, 3306, 90, 0, 38, "Subsection",ExpressionUUID->"732c18fc-515b-4842-b168-c8f2ecbbfe56"],
Cell[142290, 3308, 5915, 165, 506, "Code",ExpressionUUID->"ec426106-5275-44e5-a09e-d44cc50595d8"]
}, Closed]],
Cell[CellGroupData[{
Cell[148242, 3478, 221, 4, 65, "Subsection",ExpressionUUID->"b47f0046-da3c-4283-8228-29f1a5615f84"],
Cell[148466, 3484, 6688, 172, 580, "Code",ExpressionUUID->"58cae39b-f26e-4c92-93be-35567681d0c7"],
Cell[155157, 3658, 3629, 98, 238, "Code",ExpressionUUID->"a072fd21-0967-4826-aa32-1d9266e08648"]
}, Closed]],
Cell[CellGroupData[{
Cell[158823, 3761, 103, 0, 38, "Subsection",ExpressionUUID->"5de5a8d3-e193-443c-8f31-f2cec7f5741d"],
Cell[158929, 3763, 1328, 34, 295, "Code",ExpressionUUID->"ebd6d1da-3b12-4f71-801c-7e96aa50437e"],
Cell[160260, 3799, 932, 25, 200, "Code",ExpressionUUID->"0b9eb7cd-cd75-419c-b2e5-5ecb30e634b7"]
}, Closed]],
Cell[CellGroupData[{
Cell[161229, 3829, 123, 0, 38, "Subsection",ExpressionUUID->"27f84a4e-e698-437b-94f5-cbe3588f169d"],
Cell[161355, 3831, 7978, 181, 751, "Code",ExpressionUUID->"31a72297-71f7-4b0b-a689-6535b1e08576"],
Cell[169336, 4014, 5627, 146, 599, "Code",ExpressionUUID->"3302b513-e9fe-45e5-b7f9-d675ecefb2c6"],
Cell[174966, 4162, 494, 13, 66, "Code",ExpressionUUID->"2b8c3df9-7cd3-41f4-b20d-28cb2d4c46bc"]
}, Closed]],
Cell[CellGroupData[{
Cell[175497, 4180, 119, 0, 38, "Subsection",ExpressionUUID->"5a94c171-934c-4d12-ad62-4dfa84b8a359"],
Cell[175619, 4182, 843, 24, 86, "Code",ExpressionUUID->"0e91cd52-98a9-4991-bd33-c8a77649afb7"],
Cell[176465, 4208, 876, 25, 86, "Code",ExpressionUUID->"6bcdd31a-8086-490f-9f4e-e4b06ce350fd"]
}, Closed]],
Cell[CellGroupData[{
Cell[177378, 4238, 90, 0, 38, "Subsection",ExpressionUUID->"b05847f7-0cfe-43d6-88c4-014ef3ddb0dd"],
Cell[177471, 4240, 4653, 119, 523, "Code",ExpressionUUID->"3e3005a5-6c98-4e26-bd10-dad515d4dea7"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[182173, 4365, 127, 0, 53, "Section",ExpressionUUID->"65c5c4a8-5b60-4f27-b9e3-a8f1d4521cff"],
Cell[CellGroupData[{
Cell[182325, 4369, 91, 0, 54, "Subsection",ExpressionUUID->"c0a0b487-7f74-48f4-a1f1-dd679b5bc71d"],
Cell[182419, 4371, 2570, 70, 295, "Code",ExpressionUUID->"731da110-bc83-4f8d-b712-4e7c00d0e5ef"]
}, Closed]],
Cell[CellGroupData[{
Cell[185026, 4446, 107, 0, 38, "Subsection",ExpressionUUID->"3a62305e-7798-4811-a242-8c9fc5e4aa41"],
Cell[185136, 4448, 4112, 103, 657, "Code",ExpressionUUID->"bbfddab8-6ea8-4120-8eb4-f3216479642f"]
}, Closed]],
Cell[CellGroupData[{
Cell[189285, 4556, 113, 0, 38, "Subsection",ExpressionUUID->"fbf41453-ce16-449c-a7d8-392e16ddcde9"],
Cell[189401, 4558, 655, 15, 83, "Code",ExpressionUUID->"c5fa8e38-81f1-4e35-952b-a5bead4479e6"]
}, Closed]],
Cell[CellGroupData[{
Cell[190093, 4578, 113, 0, 38, "Subsection",ExpressionUUID->"b98e9445-2688-44f9-90fe-c61b41d2cefa"],
Cell[190209, 4580, 1453, 37, 140, "Code",ExpressionUUID->"bcdc8d0f-6f6b-4412-aed1-a015394185f5"]
}, Closed]],
Cell[CellGroupData[{
Cell[191699, 4622, 94, 0, 38, "Subsection",ExpressionUUID->"f40fca3b-5ac3-45df-9833-1ec262db5844"],
Cell[191796, 4624, 1162, 29, 217, "Code",ExpressionUUID->"89ea601f-aa9b-4950-84c3-22eafdcf6db0"]
}, Closed]],
Cell[CellGroupData[{
Cell[192995, 4658, 112, 0, 38, "Subsection",ExpressionUUID->"50aaa118-7aeb-4322-877d-ed8c6a7663fa"],
Cell[193110, 4660, 3951, 96, 520, "Code",ExpressionUUID->"2fd91df5-6766-4d60-a3c7-53d9a52d7b96"],
Cell[197064, 4758, 3772, 94, 349, "Code",ExpressionUUID->"3ccd1308-4b25-462c-bf14-ca7dea82c5fe"],
Cell[200839, 4854, 2975, 74, 466, "Code",ExpressionUUID->"64b7b531-8b24-4dab-9ace-34e5f065c8da"],
Cell[203817, 4930, 2762, 78, 313, "Code",ExpressionUUID->"c2262ab8-69cd-440e-b350-a060080f50e2"],
Cell[206582, 5010, 818, 22, 159, "Code",ExpressionUUID->"2e1f31ff-6557-4fb9-aaa5-ab2f5e0c76c3"],
Cell[207403, 5034, 2542, 63, 311, "Code",ExpressionUUID->"380d18c6-2716-430c-9643-2330072de554"]
}, Closed]],
Cell[CellGroupData[{
Cell[209982, 5102, 99, 0, 38, "Subsection",ExpressionUUID->"f146e525-42d8-479e-959e-c8fb6ca1c4a2"],
Cell[210084, 5104, 251, 7, 63, "Code",ExpressionUUID->"73ad2a29-7f03-4219-8663-461f9518a7f6"]
}, Closed]],
Cell[CellGroupData[{
Cell[210372, 5116, 88, 0, 38, "Subsection",ExpressionUUID->"6c3ece17-d7ac-4107-85ef-f431e4a44d87"],
Cell[210463, 5118, 4801, 129, 387, "Code",ExpressionUUID->"97c75c77-112c-4a86-9062-c60ce5e5fc97"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[215313, 5253, 133, 0, 53, "Section",ExpressionUUID->"5e1bb1ba-4e01-41e6-bdeb-cab641c995ee"],
Cell[CellGroupData[{
Cell[215471, 5257, 86, 0, 54, "Subsection",ExpressionUUID->"770f6e84-4aa1-4881-9af0-1dcf176096a2"],
Cell[CellGroupData[{
Cell[215582, 5261, 97, 0, 45, "Subsubsection",ExpressionUUID->"27f30170-2c57-446e-aa9f-6b16083c0b48"],
Cell[215682, 5263, 5520, 134, 752, "Code",ExpressionUUID->"77a841d3-eaaf-4cec-a64e-ba0e1f59f1b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[221239, 5402, 95, 0, 37, "Subsubsection",ExpressionUUID->"59b46ba1-859a-4be3-8bfa-6e13247a7eda"],
Cell[221337, 5404, 10208, 258, 905, "Code",ExpressionUUID->"271ee591-97c5-48b0-9a63-744c8a95ef8b"],
Cell[231548, 5664, 3819, 105, 335, "Code",ExpressionUUID->"4679440b-07a1-4d4a-8355-3e7f6838ac20"]
}, Closed]],
Cell[CellGroupData[{
Cell[235404, 5774, 104, 0, 37, "Subsubsection",ExpressionUUID->"152dd0a6-0fef-45c1-91bc-be12896c37ad"],
Cell[235511, 5776, 2234, 57, 219, "Code",ExpressionUUID->"b367c3d5-d8eb-4e11-af07-dd6aca45cd64"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[237794, 5839, 86, 0, 54, "Subsection",ExpressionUUID->"ab454d33-6f2f-4fae-b957-bc3f25e232d1"],
Cell[CellGroupData[{
Cell[237905, 5843, 97, 0, 45, "Subsubsection",ExpressionUUID->"b39e76c2-5207-4bfd-9cc7-a2c36a57ba54"],
Cell[238005, 5845, 5843, 141, 786, "Code",ExpressionUUID->"1c3e576c-c667-475f-89cb-197999bffac7"]
}, Closed]],
Cell[CellGroupData[{
Cell[243885, 5991, 97, 0, 37, "Subsubsection",ExpressionUUID->"cd6d5b6d-fecb-4059-8dc9-13c1b0e93fd2"],
Cell[243985, 5993, 10850, 271, 883, "Code",ExpressionUUID->"e8717162-81c3-408e-ac1b-17b556cd74ba"],
Cell[254838, 6266, 3819, 105, 332, "Code",ExpressionUUID->"b3ba8943-5eec-4b23-b328-7aa163c5a967"]
}, Closed]],
Cell[CellGroupData[{
Cell[258694, 6376, 104, 0, 37, "Subsubsection",ExpressionUUID->"64289b72-f6e2-4889-841a-47f6df4f723a"],
Cell[258801, 6378, 2466, 64, 224, "Code",ExpressionUUID->"7aa32004-142e-4398-b75b-5f4e9b58bc92"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[261316, 6448, 88, 0, 54, "Subsection",ExpressionUUID->"a7008bb2-24cc-448f-8adf-7c2a22dda581"],
Cell[261407, 6450, 1771, 47, 200, "Code",ExpressionUUID->"f5ba25d8-abb2-4a17-9b94-d7776304b74e"],
Cell[263181, 6499, 10552, 277, 1398, "Code",ExpressionUUID->"950dff22-28f0-4fb2-a83f-4d38bd914428"]
}, Closed]],
Cell[CellGroupData[{
Cell[273770, 6781, 88, 0, 38, "Subsection",ExpressionUUID->"d7afa0ea-aedd-4d0b-a732-2a15366b9ce5"],
Cell[273861, 6783, 257, 7, 66, "Code",ExpressionUUID->"a12658c6-fc84-44c7-9c81-b4290ef02c78"],
Cell[274121, 6792, 2347, 63, 352, "Code",ExpressionUUID->"1387a64e-cae7-4ce2-bf6a-8bfc02903e70"]
}, Closed]],
Cell[CellGroupData[{
Cell[276505, 6860, 164, 3, 38, "Subsection",ExpressionUUID->"929a533b-38ca-4691-bbf0-10109000ed9f"],
Cell[276672, 6865, 5337, 153, 219, "Code",ExpressionUUID->"e7d99d5c-47c2-4c13-bb77-affd8f0fda8f"]
}, Closed]],
Cell[CellGroupData[{
Cell[282046, 7023, 163, 2, 38, "Subsection",ExpressionUUID->"ee32cfa3-1677-497c-bcdd-41a18a8855c6"],
Cell[282212, 7027, 320, 9, 66, "Code",ExpressionUUID->"6bde0a51-99b4-44a6-a5ae-56f9a2569da5"],
Cell[282535, 7038, 2641, 70, 238, "Code",ExpressionUUID->"3bfadbe7-2cb3-418f-ba5d-0606262c6e57"],
Cell[285179, 7110, 1539, 41, 181, "Code",ExpressionUUID->"33d2f0a4-2912-403c-aaa6-32ec5c9375e4"],
Cell[286721, 7153, 1592, 43, 167, "Code",ExpressionUUID->"c27dc3fd-0e9b-41f3-aae3-759f9af29b32"],
Cell[288316, 7198, 2252, 62, 205, "Code",ExpressionUUID->"6d279430-6816-4569-9f44-8c93afb4027d"]
}, Closed]],
Cell[CellGroupData[{
Cell[290605, 7265, 151, 2, 38, "Subsection",ExpressionUUID->"16160a14-4294-44e2-8cb4-421f6295e059"],
Cell[290759, 7269, 8597, 235, 637, "Code",ExpressionUUID->"f44a31c2-8b21-40ca-a115-2fd8da00a1b5"]
}, Closed]],
Cell[CellGroupData[{
Cell[299393, 7509, 115, 0, 38, "Subsection",ExpressionUUID->"f3b80113-3224-49a9-9e96-60dda4fcc677"],
Cell[299511, 7511, 3797, 99, 523, "Code",ExpressionUUID->"c4c238e8-8716-42d6-8809-5319a34d7714"],
Cell[303311, 7612, 1544, 35, 219, "Code",ExpressionUUID->"0b41cfbf-4b5f-472d-bbed-762ff7b98655"],
Cell[304858, 7649, 2650, 74, 257, "Code",ExpressionUUID->"85692ee5-03e0-4f88-9eaa-342aec96146f"],
Cell[307511, 7725, 2634, 72, 219, "Code",ExpressionUUID->"43bed0ec-ac12-4481-aa49-5d11d2fe0c94"],
Cell[310148, 7799, 625, 17, 105, "Code",ExpressionUUID->"f1ae76f2-abd7-4a7f-99c5-ba3ccf8d7d64"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[310822, 7822, 108, 0, 67, "Section",ExpressionUUID->"090ed141-5b45-4288-b0a6-e72427c2adbf"],
Cell[CellGroupData[{
Cell[310955, 7826, 112, 0, 54, "Subsection",ExpressionUUID->"5c30eac8-b497-457e-83bc-5feee9c6f26e"],
Cell[311070, 7828, 8050, 204, 715, "Code",ExpressionUUID->"9bc90bd8-31e3-4b35-9c08-abac5f345453"],
Cell[319123, 8034, 1998, 54, 257, "Code",ExpressionUUID->"386eec8d-461d-4db6-b7ab-158590f59a83"],
Cell[321124, 8090, 8494, 216, 715, "Code",ExpressionUUID->"8410b588-8af0-4d7a-8e0e-894e8bbb5f83"],
Cell[329621, 8308, 2074, 55, 238, "Code",ExpressionUUID->"bba4b872-ab1c-4173-ae10-e4f45aa55edb"]
}, Closed]],
Cell[CellGroupData[{
Cell[331732, 8368, 90, 0, 38, "Subsection",ExpressionUUID->"c54c2186-c788-4594-b5ca-b8fb5b869f9a"],
Cell[331825, 8370, 5486, 154, 485, "Code",ExpressionUUID->"57e36eff-830f-423a-9f08-bbc4d2ae6b4f"]
}, Closed]],
Cell[CellGroupData[{
Cell[337348, 8529, 87, 0, 38, "Subsection",ExpressionUUID->"cb7c2df9-dda8-4d22-bcab-38d90211eab7"],
Cell[337438, 8531, 1941, 54, 238, "Code",ExpressionUUID->"09b6a594-cbdf-4cab-a245-d13a757d3bde"]
}, Closed]],
Cell[CellGroupData[{
Cell[339416, 8590, 93, 0, 38, "Subsection",ExpressionUUID->"afbbe164-7b3e-47ea-a2ad-cb64baca94de"],
Cell[339512, 8592, 519, 15, 86, "Code",ExpressionUUID->"e06a8438-b3a3-4482-aaa8-b7c1fbeb97d2"],
Cell[340034, 8609, 1688, 46, 200, "Code",ExpressionUUID->"2efeb8e3-c23f-4d4f-b97f-09303f5f11e9"],
Cell[341725, 8657, 1266, 33, 124, "Code",ExpressionUUID->"0c647acf-3e46-49fa-8987-9662f2a69ea2"],
Cell[342994, 8692, 4069, 109, 373, "Code",ExpressionUUID->"ed67aec2-e93a-4235-bdfc-437b2aa78bc3"],
Cell[347066, 8803, 5066, 115, 734, "Code",ExpressionUUID->"e6ce7f6c-8260-45f8-9a32-3e00b65e1e2a"],
Cell[352135, 8920, 4532, 118, 449, "Code",ExpressionUUID->"ad64f41c-7efa-4de5-96f7-a7293f9b21e8"],
Cell[356670, 9040, 1144, 33, 181, "Code",ExpressionUUID->"779aed46-ffda-4fb2-89d9-2e35f2b4cbdf"]
}, Closed]],
Cell[CellGroupData[{
Cell[357851, 9078, 92, 0, 38, "Subsection",ExpressionUUID->"a36ef963-d8b7-466d-9028-89d0a83d022e"],
Cell[357946, 9080, 5949, 142, 543, "Code",ExpressionUUID->"0d644173-0919-476f-bf16-572cb8c77e51"]
}, Closed]],
Cell[CellGroupData[{
Cell[363932, 9227, 105, 0, 38, "Subsection",ExpressionUUID->"f48760e0-20ae-4bdb-9fec-8e23ae133fad"],
Cell[364040, 9229, 3168, 91, 279, "Code",ExpressionUUID->"0bcdf794-fb09-4103-a92f-306e3f19e655"],
Cell[367211, 9322, 2882, 76, 390, "Code",ExpressionUUID->"abbe108b-1bdd-4ca3-a30c-eb279fb340b4"],
Cell[370096, 9400, 2497, 65, 390, "Code",ExpressionUUID->"5198b681-d64a-4e20-97b8-8e031eacc149"]
}, Closed]],
Cell[CellGroupData[{
Cell[372630, 9470, 87, 0, 38, "Subsection",ExpressionUUID->"ba379b12-e39c-49a0-ba40-463bc3626108"],
Cell[372720, 9472, 2802, 73, 257, "Code",ExpressionUUID->"a23612de-3cf0-403e-b850-8a9c7144e63f"]
}, Closed]],
Cell[CellGroupData[{
Cell[375559, 9550, 93, 0, 38, "Subsection",ExpressionUUID->"b8f26f8a-5bdb-43fa-a08b-35a62aaf9744"],
Cell[375655, 9552, 4320, 110, 391, "Code",ExpressionUUID->"ce93bed6-9de0-443b-9529-d0e43a83867e"],
Cell[379978, 9664, 511, 14, 66, "Code",ExpressionUUID->"a153f66e-388f-4c66-aec7-7137116edbba"]
}, Closed]],
Cell[CellGroupData[{
Cell[380526, 9683, 87, 0, 38, "Subsection",ExpressionUUID->"412267ca-b4cd-4402-8196-31c933c269a3"],
Cell[380616, 9685, 1544, 44, 86, "Code",ExpressionUUID->"065b9a63-e5d1-40c0-a6bb-fb3c2b40fe15"]
}, Closed]],
Cell[CellGroupData[{
Cell[382197, 9734, 92, 0, 38, "Subsection",ExpressionUUID->"3684becb-1fd7-4274-a7c3-48a7bbce7a72"],
Cell[382292, 9736, 5170, 142, 316, "Code",ExpressionUUID->"c3606539-ede2-400e-a3d5-8726cc1277fc"],
Cell[387465, 9880, 3211, 87, 257, "Code",ExpressionUUID->"e9e16aa8-6474-42db-9f13-7de59ad6bf66"]
}, Closed]],
Cell[CellGroupData[{
Cell[390713, 9972, 91, 0, 38, "Subsection",ExpressionUUID->"d0c35cf8-0b87-48ac-a7b6-ac6214c5e506"],
Cell[390807, 9974, 2313, 64, 238, "Code",ExpressionUUID->"ae90439d-a70d-4425-a0a1-5b1950ad9dab"]
}, Closed]],
Cell[CellGroupData[{
Cell[393157, 10043, 97, 0, 38, "Subsection",ExpressionUUID->"b687de83-cd96-4c03-a6c5-674f5c438ade"],
Cell[393257, 10045, 367, 11, 66, "Code",ExpressionUUID->"76ffc6b0-1698-4435-a9f3-a8e4d85ac1ab"],
Cell[393627, 10058, 2535, 69, 314, "Code",ExpressionUUID->"ca5dc61d-eb9d-4c00-9924-201bee91a182"],
Cell[396165, 10129, 2180, 59, 219, "Code",ExpressionUUID->"721a18ca-3636-47ac-8ec2-4481f8e47919"],
Cell[398348, 10190, 384, 9, 66, "Code",ExpressionUUID->"dd25d513-ac16-415e-bbdb-02167d2267b4"],
Cell[398735, 10201, 2443, 61, 295, "Code",ExpressionUUID->"52292cab-859e-4526-ad11-c2375d158cee"],
Cell[401181, 10264, 2759, 69, 276, "Code",ExpressionUUID->"d24fd5c7-bb15-4547-9025-38b6386831cb"],
Cell[403943, 10335, 2848, 70, 276, "Code",ExpressionUUID->"2cf05f30-ea55-4528-b268-4f693ccc6344"]
}, Closed]],
Cell[CellGroupData[{
Cell[406828, 10410, 89, 0, 38, "Subsection",ExpressionUUID->"0fa84328-818f-4aa0-9af0-dd5dc45722ec"],
Cell[406920, 10412, 1324, 36, 124, "Code",ExpressionUUID->"230fde4b-20eb-4071-99aa-5c8ad4bd0f21"]
}, Open  ]],
Cell[CellGroupData[{
Cell[408281, 10453, 108, 0, 54, "Subsection",ExpressionUUID->"43647b8f-478e-4e7c-9742-557e8dc9a078"],
Cell[408392, 10455, 519, 12, 86, "Code",ExpressionUUID->"a3217d07-b263-49db-8e2b-a299c78b318f"],
Cell[408914, 10469, 1023, 27, 86, "Code",ExpressionUUID->"3334406d-4524-4f4f-9a1f-901b483ce449"],
Cell[409940, 10498, 983, 27, 86, "Code",ExpressionUUID->"59f86bc7-1124-49b0-b3e5-f21143d862bd"]
}, Closed]],
Cell[CellGroupData[{
Cell[410960, 10530, 153, 2, 38, "Subsection",ExpressionUUID->"6bc909e8-5f39-4ed2-9697-1d33e51b17b6"],
Cell[411116, 10534, 5633, 149, 448, "Code",ExpressionUUID->"082dac8c-4b17-4565-a601-5accbfae66ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[416786, 10688, 90, 0, 38, "Subsection",ExpressionUUID->"66fa220e-d189-4daf-a3ca-36eca354f7e8"],
Cell[416879, 10690, 16589, 434, 1763, "Code",ExpressionUUID->"0df92725-9797-4f50-9c43-34f116a88527"]
}, Closed]],
Cell[CellGroupData[{
Cell[433505, 11129, 90, 0, 38, "Subsection",ExpressionUUID->"1c9d14aa-e4fa-43c7-a463-0fb0f975c854"],
Cell[433598, 11131, 5333, 155, 428, "Code",ExpressionUUID->"88781786-7762-436e-88e7-32ea57b8a248"]
}, Closed]],
Cell[CellGroupData[{
Cell[438968, 11291, 93, 0, 38, "Subsection",ExpressionUUID->"807f5525-dcf2-4be3-a3d6-f662db4b35c9"],
Cell[439064, 11293, 5650, 150, 504, "Code",ExpressionUUID->"ce76c6e6-607c-4339-bc44-5002db5363e0"],
Cell[444717, 11445, 5195, 137, 466, "Code",ExpressionUUID->"92a81b6a-bfd3-4c11-825d-758e70402d10"]
}, Closed]],
Cell[CellGroupData[{
Cell[449949, 11587, 95, 0, 38, "Subsection",ExpressionUUID->"d8651388-086c-4e91-8a1b-4321d177cd65"],
Cell[450047, 11589, 2221, 59, 257, "Code",ExpressionUUID->"c265f046-0659-4ba0-a446-8dd92026215b"],
Cell[452271, 11650, 4062, 112, 295, "Code",ExpressionUUID->"b0c5ca40-ee5c-4e8e-a2be-e6c19ab5e11f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[456382, 11768, 82, 0, 67, "Section",ExpressionUUID->"73acb900-2b6f-4c81-9ddd-6415f4ff3d58"],
Cell[CellGroupData[{
Cell[456489, 11772, 93, 0, 54, "Subsection",ExpressionUUID->"3ac59116-95e8-4e26-96ea-fdfc9bdac013"],
Cell[456585, 11774, 493, 13, 66, "Code",ExpressionUUID->"2cdb7c84-8edf-4d6d-b6ba-cefa10762bf3"],
Cell[457081, 11789, 14556, 437, 699, "Code",ExpressionUUID->"5daddf1e-5dbd-462f-bb67-77e4dfaeea29"],
Cell[471640, 12228, 2012, 57, 182, "Code",ExpressionUUID->"660a1d53-aaff-4288-91d7-fad1007ea08b"],
Cell[473655, 12287, 2633, 78, 162, "Code",ExpressionUUID->"46eac6bf-1124-44f7-951a-7744acd1dcbe"],
Cell[476291, 12367, 2181, 69, 180, "Code",ExpressionUUID->"1b8cf775-ebf9-4534-b135-d538b6080991"]
}, Closed]],
Cell[CellGroupData[{
Cell[478509, 12441, 98, 0, 38, "Subsection",ExpressionUUID->"e9380c8d-6b64-4bac-93a9-eeb515421900"],
Cell[478610, 12443, 7873, 195, 409, "Code",ExpressionUUID->"375d8e09-4ad7-4120-9adf-da539a653fe3"]
}, Closed]],
Cell[CellGroupData[{
Cell[486520, 12643, 93, 0, 38, "Subsection",ExpressionUUID->"ac7777e2-ccef-4f2a-810d-62265105a2f5"],
Cell[486616, 12645, 460, 12, 66, "Code",ExpressionUUID->"76a01b01-bb3a-4d1e-9253-6c9a7d3a5fd4"],
Cell[487079, 12659, 1135, 30, 87, "Code",ExpressionUUID->"748c0386-08c4-47f5-9e72-f76a24957f12"],
Cell[488217, 12691, 1841, 54, 200, "Code",ExpressionUUID->"09a1ab40-6d32-45d7-9647-f0d23127bc46"],
Cell[490061, 12747, 14201, 369, 372, "Code",ExpressionUUID->"d17e50b0-6ffc-45fe-84f4-16c7f46768e8"],
Cell[504265, 13118, 3083, 89, 269, "Code",ExpressionUUID->"2bcd8429-3ef1-4aa4-a4d7-eff1cb4a1f46"],
Cell[507351, 13209, 5190, 153, 485, "Code",ExpressionUUID->"01ba101d-0c31-4332-b229-6654a8245df8"],
Cell[512544, 13364, 7065, 191, 296, "Code",ExpressionUUID->"269230f6-fb33-44fb-976f-8c41d6738502"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[519658, 13561, 78, 0, 67, "Section",ExpressionUUID->"a96ef353-fd5d-425a-9621-3fe4e067febe"],
Cell[519739, 13563, 252, 8, 102, "Code",ExpressionUUID->"947147f2-f482-4741-a59e-b93ede67b4b9"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[520040, 13577, 124, 0, 69, "Chapter",ExpressionUUID->"95c9d13b-445a-4347-87a7-43f7db6e7a5f"],
Cell[520167, 13579, 214, 6, 66, "Code",ExpressionUUID->"ea0a7c8e-7cd5-49d0-8504-8949ad7ad62c"],
Cell[CellGroupData[{
Cell[520406, 13589, 116, 0, 45, "Subsubsection",ExpressionUUID->"6059f1c6-1fbe-45e0-aea7-add255709cee"],
Cell[520525, 13591, 1480, 39, 200, "Code",ExpressionUUID->"f81e2e99-8a33-43c6-9b07-9a18257ed9eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[522042, 13635, 79, 0, 53, "Section",ExpressionUUID->"648a6476-b797-42cf-8e5a-b9bc1a86e610"],
Cell[522124, 13637, 2047, 35, 124, "Code",ExpressionUUID->"c555d03c-e001-41c3-854c-522f379465be"],
Cell[524174, 13674, 639, 15, 105, "Code",ExpressionUUID->"d786515a-d3bd-4718-b039-f280d0b9f02b"],
Cell[524816, 13691, 5314, 99, 428, "Code",ExpressionUUID->"7b3d57d2-d39e-4905-8b4b-bee6117e5212"],
Cell[530133, 13792, 5557, 111, 564, "Code",ExpressionUUID->"a1e26495-b179-4855-8335-4436fa78fd50"],
Cell[535693, 13905, 5418, 103, 428, "Code",ExpressionUUID->"684246ec-df06-4736-b3a7-7c0cdf468e9b"],
Cell[541114, 14010, 10335, 187, 1042, "Code",ExpressionUUID->"20d4f0d9-5076-4185-aaa7-f1de3061bd9e"]
}, Closed]],
Cell[CellGroupData[{
Cell[551486, 14202, 98, 0, 53, "Section",ExpressionUUID->"6bc0fc48-688d-4ca9-bac5-3a6645a0cdb0"],
Cell[551587, 14204, 293, 8, 105, "Code",ExpressionUUID->"9f392912-8772-4657-8e12-0dfb8191735b"],
Cell[CellGroupData[{
Cell[551905, 14216, 115, 0, 45, "Subsubsection",ExpressionUUID->"993c23a1-4278-4cf3-9ea0-d4f96b7da186"],
Cell[552023, 14218, 548, 16, 26, "Code",ExpressionUUID->"bf84e85d-32d1-4c19-9b38-a35d433a0119"],
Cell[552574, 14236, 2364, 60, 140, "Code",ExpressionUUID->"6ea34ad2-a148-45ae-aa93-a48d3d461e82"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[554987, 14302, 82, 0, 67, "Section",ExpressionUUID->"72e8028f-0cb2-4491-b4a5-832df78eed16"],
Cell[CellGroupData[{
Cell[555094, 14306, 100, 0, 54, "Subsection",ExpressionUUID->"e146d239-1c00-4935-9d62-733890aa073d"],
Cell[CellGroupData[{
Cell[555219, 14310, 92, 0, 45, "Subsubsection",ExpressionUUID->"96f25e17-0c46-43e8-aa86-a343cea151ab"],
Cell[555314, 14312, 337, 8, 127, "Text",ExpressionUUID->"670cccd5-509b-4823-88ac-ff6d4791b777"],
Cell[555654, 14322, 1449, 43, 254, "Code",ExpressionUUID->"fec86841-e1b9-407e-91ed-9bcd2389efbf"],
Cell[557106, 14367, 919, 26, 102, "Code",ExpressionUUID->"b7e701c3-de85-45c2-b52e-9aa223f1ec5f"]
}, Closed]],
Cell[CellGroupData[{
Cell[558062, 14398, 90, 0, 37, "Subsubsection",ExpressionUUID->"dda37c49-20b3-459d-9f34-72d989a2b391"],
Cell[558155, 14400, 895, 28, 86, "Code",ExpressionUUID->"1bd6f123-a777-4f1c-8846-573535afb17e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[559087, 14433, 92, 0, 45, "Subsubsection",ExpressionUUID->"d18ddbd8-a5e7-4d3b-9ec8-10b424233e6d"],
Cell[559182, 14435, 511, 16, 66, "Code",ExpressionUUID->"25764a05-dbcb-4169-9936-584628582a73"]
}, Closed]],
Cell[CellGroupData[{
Cell[559730, 14456, 103, 0, 37, "Subsubsection",ExpressionUUID->"cd0203ed-6145-429b-aebb-26a4b4acf7bb"],
Cell[559836, 14458, 579, 17, 66, "Code",ExpressionUUID->"f895924f-63bb-45d4-83c0-970509bfd0f0"],
Cell[560418, 14477, 675, 17, 86, "Code",ExpressionUUID->"6d2abede-f7b3-4efe-a204-8ff504e5f57a"],
Cell[561096, 14496, 3244, 89, 428, "Code",ExpressionUUID->"29675125-fd21-49ee-a583-93961cfab76f"],
Cell[564343, 14587, 1770, 50, 219, "Code",ExpressionUUID->"1b0c0323-d23f-4df8-93ef-26ae105ee1ce"],
Cell[566116, 14639, 3805, 107, 352, "Code",ExpressionUUID->"27e614a4-c2a8-4940-82ad-70b2babd1e0b"],
Cell[569924, 14748, 1656, 46, 143, "Code",ExpressionUUID->"83a6385c-2f36-459e-ab9c-3f8d635ded07"],
Cell[571583, 14796, 2602, 71, 333, "Code",ExpressionUUID->"585ee08c-5fa7-4a7a-a1a7-81f1a9c49466"],
Cell[574188, 14869, 1005, 29, 181, "Code",ExpressionUUID->"116e6b48-0fa9-4e1e-a4a5-b2b73fb8e94b"],
Cell[575196, 14900, 611, 18, 66, "Code",ExpressionUUID->"84134194-be7e-4a2f-8524-d78dc34bcbf5"],
Cell[575810, 14920, 3382, 89, 333, "Code",ExpressionUUID->"2ce4027e-bc52-4830-bdf4-72f275b86492"],
Cell[579195, 15011, 684, 19, 86, "Code",ExpressionUUID->"396a376e-926c-47c4-bbd5-12e1440db841"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[579928, 15036, 129, 0, 54, "Subsection",ExpressionUUID->"76374e09-15c0-4285-9873-5b1119f9fbac"],
Cell[580060, 15038, 1592, 42, 295, "Code",ExpressionUUID->"c9b1dabe-f4f7-4958-94d5-a03d27395cf8"],
Cell[581655, 15082, 450, 12, 66, "Code",ExpressionUUID->"7d002678-a532-4bcd-912e-4ff0e5ae48d3"],
Cell[582108, 15096, 1366, 35, 276, "Code",ExpressionUUID->"e8c7d67f-6f52-4ba0-8e76-ccc48f493943"]
}, Closed]],
Cell[CellGroupData[{
Cell[583511, 15136, 112, 0, 38, "Subsection",ExpressionUUID->"1c2c98d9-43ff-4040-a5e0-cf72764ae01b"],
Cell[583626, 15138, 990, 25, 181, "Code",ExpressionUUID->"3068d1eb-a6e1-4120-bfef-ce9fb71e3216"],
Cell[584619, 15165, 558, 15, 143, "Code",ExpressionUUID->"bc5f153c-22ea-4998-8d43-5354d3958a35"]
}, Closed]],
Cell[CellGroupData[{
Cell[585214, 15185, 97, 0, 38, "Subsection",ExpressionUUID->"d44581db-3241-4500-8895-4f9310373c63"],
Cell[585314, 15187, 702, 18, 162, "Code",ExpressionUUID->"8ed6dc61-9ce7-4391-adff-956d7a772019"],
Cell[586019, 15207, 2174, 64, 314, "Code",ExpressionUUID->"62bac1ef-cbd7-4818-bad8-b32d8a0b8cfd"]
}, Closed]],
Cell[CellGroupData[{
Cell[588230, 15276, 137, 1, 38, "Subsection",ExpressionUUID->"0cde69d0-d061-4888-b804-bc8f12ee2607"],
Cell[588370, 15279, 1994, 53, 239, "Code",ExpressionUUID->"69971570-a0ce-4443-96f9-ac9ac653df50"],
Cell[590367, 15334, 1785, 47, 220, "Code",ExpressionUUID->"3546c726-a156-4c7c-afab-f6a3f846e262"]
}, Closed]],
Cell[CellGroupData[{
Cell[592189, 15386, 122, 0, 38, "Subsection",ExpressionUUID->"92648dd9-fe4b-4454-a084-c84bea5c6cb4"],
Cell[592314, 15388, 1365, 36, 129, "Code",ExpressionUUID->"1bb5502e-b3ac-4710-8ff9-b19fa098d1c7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[593728, 15430, 108, 0, 67, "Section",ExpressionUUID->"fdebde89-31c1-40e0-a115-f68ade3f301b"],
Cell[CellGroupData[{
Cell[593861, 15434, 194, 3, 54, "Subsection",ExpressionUUID->"6f392222-bf5b-4961-95a1-f64ae3271739"],
Cell[594058, 15439, 1228, 36, 86, "Code",ExpressionUUID->"363014a0-649a-4fa7-9e0b-27134679686f"],
Cell[595289, 15477, 1556, 46, 86, "Code",ExpressionUUID->"972a811f-3d92-4ab4-91eb-dbcdea577d56"],
Cell[596848, 15525, 1300, 38, 86, "Code",ExpressionUUID->"1bd477fd-b514-4438-88a5-1f619ede0e10"],
Cell[598151, 15565, 1440, 41, 219, "Code",ExpressionUUID->"48138634-e03b-42d4-9ae9-f9f5ceaaf2e6"]
}, Closed]],
Cell[CellGroupData[{
Cell[599628, 15611, 105, 0, 38, "Subsection",ExpressionUUID->"702d28ea-9096-4e71-ab44-fc7989355b93"],
Cell[599736, 15613, 1377, 37, 124, "Code",ExpressionUUID->"cc24f4ca-ba03-4371-9cf3-0b9712ccd804"],
Cell[601116, 15652, 972, 25, 143, "Code",ExpressionUUID->"e7080ce3-2904-4c72-bd09-95058f237fa4"]
}, Closed]],
Cell[CellGroupData[{
Cell[602125, 15682, 115, 0, 38, "Subsection",ExpressionUUID->"3f58e51a-22ea-423b-a461-52f70b313601"],
Cell[602243, 15684, 5172, 151, 392, "Code",ExpressionUUID->"962d6ed6-55b6-443c-89ca-3f41ecb08743"],
Cell[607418, 15837, 481, 13, 86, "Code",ExpressionUUID->"90948bbb-01c4-4119-a2a2-6a57e3256c77"]
}, Closed]],
Cell[CellGroupData[{
Cell[607936, 15855, 138, 1, 38, "Subsection",ExpressionUUID->"8f391a10-04f2-4ed7-aea1-145efce6a5b2"],
Cell[608077, 15858, 3862, 101, 447, "Code",ExpressionUUID->"fc8e80b7-f492-45a8-ad2d-80d222d7c4ab"],
Cell[611942, 15961, 1307, 34, 143, "Code",ExpressionUUID->"166d33b4-951a-4278-9c5e-954e8a50f80a"],
Cell[613252, 15997, 3683, 95, 409, "Code",ExpressionUUID->"21b3ac33-1f56-4c92-a764-e44557b03761"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[616984, 16098, 93, 0, 67, "Section",ExpressionUUID->"cd7a54f4-ed66-45bf-89b2-4adff5782071"],
Cell[CellGroupData[{
Cell[617102, 16102, 109, 0, 54, "Subsection",ExpressionUUID->"154f264e-dd31-4eca-93ac-8670cfb8d68e"],
Cell[617214, 16104, 197, 3, 35, "Text",ExpressionUUID->"a799f3b1-f312-459d-9d78-a371ac3b9113"],
Cell[617414, 16109, 5348, 147, 466, "Code",ExpressionUUID->"99f31be3-ca8c-4087-acba-f5c05f25428c"],
Cell[622765, 16258, 1167, 31, 105, "Code",ExpressionUUID->"5b59c8cb-1d68-469c-91aa-231dc671e44d"]
}, Closed]],
Cell[CellGroupData[{
Cell[623969, 16294, 101, 0, 38, "Subsection",ExpressionUUID->"c9ba93b2-3e90-4f1f-8738-1c1dd5419c56"],
Cell[624073, 16296, 9730, 262, 808, "Code",ExpressionUUID->"c07ab8ce-8f01-4969-88e1-29b80e11879f"],
Cell[633806, 16560, 2999, 80, 409, "Code",ExpressionUUID->"436b0aa6-c06f-46bc-8bd2-56fb6ed94cf0"],
Cell[636808, 16642, 5424, 151, 447, "Code",ExpressionUUID->"a72c2ba9-d5b3-424a-bf83-535333d67dc9"],
Cell[642235, 16795, 3509, 81, 428, "Code",ExpressionUUID->"05b7ff90-ba72-4264-910c-7dcce83fa5b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[645781, 16881, 105, 0, 38, "Subsection",ExpressionUUID->"60e056ed-a16c-4841-8b4b-dde35c6dcbd9"],
Cell[645889, 16883, 912, 22, 124, "Code",ExpressionUUID->"df7f77be-d71a-46ab-b616-6e17020c9b7a"],
Cell[646804, 16907, 14283, 382, 846, "Code",ExpressionUUID->"683810b0-7a6a-4a03-b496-f14156897a27"],
Cell[661090, 17291, 911, 22, 148, "Code",ExpressionUUID->"47555025-a91c-47a2-a30c-77ab1984f094"]
}, Closed]],
Cell[CellGroupData[{
Cell[662038, 17318, 106, 0, 38, "Subsection",ExpressionUUID->"9cfdc11c-7ae4-4bc5-9b1d-79dc2c28c20a"],
Cell[662147, 17320, 1833, 46, 368, "Code",ExpressionUUID->"ca2e65ed-8d19-4650-9d7a-afae1df6efcc"]
}, Closed]],
Cell[CellGroupData[{
Cell[664017, 17371, 96, 0, 38, "Subsection",ExpressionUUID->"a08fec2b-4c6d-4ec5-a6c9-19108d52a205"],
Cell[664116, 17373, 1728, 46, 182, "Code",ExpressionUUID->"96b5897b-36e7-417b-89ca-fc4131507b09"],
Cell[665847, 17421, 6481, 179, 618, "Code",ExpressionUUID->"19577cd0-d910-4a98-a933-8ad473cbd9de"]
}, Closed]],
Cell[CellGroupData[{
Cell[672365, 17605, 100, 0, 38, "Subsection",ExpressionUUID->"a2de7482-cba2-4331-aa97-96a42e271549"],
Cell[672468, 17607, 2025, 51, 200, "Code",ExpressionUUID->"4f17c454-da11-4447-8d57-5317848adaf8"],
Cell[674496, 17660, 1148, 29, 219, "Code",ExpressionUUID->"4c61fa27-a355-4c85-b656-e5b798656492"]
}, Closed]],
Cell[CellGroupData[{
Cell[675681, 17694, 113, 0, 38, "Subsection",ExpressionUUID->"3883a17c-57fc-40d6-902d-e6807f25c4af"],
Cell[675797, 17696, 3149, 86, 314, "Code",ExpressionUUID->"14a7875d-dde7-44db-aa64-3235184f522a"],
Cell[678949, 17784, 484, 14, 66, "Code",ExpressionUUID->"cc41f4a2-69fb-4741-90c7-0bc22433466e"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[679482, 17804, 95, 0, 67, "Section",ExpressionUUID->"7efcf6d8-4de1-4a1a-8c78-769edd726844"],
Cell[CellGroupData[{
Cell[679602, 17808, 94, 0, 54, "Subsection",ExpressionUUID->"3c66cada-6862-4146-826a-810ea5e0da10"],
Cell[679699, 17810, 1047, 29, 162, "Code",ExpressionUUID->"600de546-4911-4739-9656-3da05acc43d9"],
Cell[680749, 17841, 1037, 28, 162, "Code",ExpressionUUID->"0839c589-f239-4b21-bcb3-717814c3a2aa"],
Cell[681789, 17871, 1087, 29, 181, "Code",ExpressionUUID->"c366179f-4a1b-49f2-b836-0fac0ea5e9b3"],
Cell[682879, 17902, 632, 19, 105, "Code",ExpressionUUID->"75dc5da3-8ff1-4044-a4e5-e04b8b9ee3b1"]
}, Closed]],
Cell[CellGroupData[{
Cell[683548, 17926, 101, 0, 38, "Subsection",ExpressionUUID->"c6c03fa0-3229-4dd7-afc5-2a195b6c78d6"],
Cell[CellGroupData[{
Cell[683674, 17930, 100, 0, 45, "Subsubsection",ExpressionUUID->"4e2ed6ef-c949-4a3f-abd2-7e4ee843fa95"],
Cell[683777, 17932, 6839, 182, 618, "Code",ExpressionUUID->"80357110-8c3f-40bc-a1fe-6602f279ec95"],
Cell[690619, 18116, 3906, 110, 482, "Code",ExpressionUUID->"e305c076-8708-4e9f-a152-207c474f6af6"]
}, Closed]],
Cell[CellGroupData[{
Cell[694562, 18231, 100, 0, 37, "Subsubsection",ExpressionUUID->"ee4062c6-055d-4d98-aa31-c01db58958d2"],
Cell[694665, 18233, 6991, 187, 618, "Code",ExpressionUUID->"4bd86452-df2c-49a9-85be-4186d23886da"],
Cell[701659, 18422, 2759, 69, 409, "Code",ExpressionUUID->"47d503bb-80a8-46f4-adfd-d8e28cca427f"]
}, Closed]],
Cell[CellGroupData[{
Cell[704455, 18496, 107, 0, 37, "Subsubsection",ExpressionUUID->"6e26983a-185e-44bf-ac51-16107024bc44"],
Cell[704565, 18498, 7247, 191, 615, "Code",ExpressionUUID->"d6b7fefc-3c97-48b6-aa3b-634122a7326d"],
Cell[711815, 18691, 2612, 66, 387, "Code",ExpressionUUID->"b38f48e1-50f8-461b-954a-16c4e8e83427"]
}, Closed]],
Cell[CellGroupData[{
Cell[714464, 18762, 94, 0, 37, "Subsubsection",ExpressionUUID->"53909e4a-e9b3-4b91-ba43-6442595c2658"],
Cell[714561, 18764, 7169, 192, 580, "Code",ExpressionUUID->"e8c265b4-1f39-4bba-b61b-2c552af080cf"],
Cell[721733, 18958, 9789, 222, 729, "Code",ExpressionUUID->"c0d5a99a-fc74-4eed-a096-7b22190d0c1a"],
Cell[731525, 19182, 7206, 176, 691, "Code",ExpressionUUID->"f1f67da6-685b-4863-a6e5-867dca6d7d71"]
}, Closed]],
Cell[CellGroupData[{
Cell[738768, 19363, 94, 0, 37, "Subsubsection",ExpressionUUID->"7f555d7d-65ac-41d9-b354-767dbfdea267"],
Cell[738865, 19365, 10107, 262, 941, "Code",ExpressionUUID->"383dd186-4709-4e0c-bd04-18a0c8d007c9"],
Cell[748975, 19629, 28422, 680, 2594, "Code",ExpressionUUID->"457f1a6d-3d7b-48cc-9239-8e3f57cf5799"]
}, Closed]],
Cell[CellGroupData[{
Cell[777434, 20314, 90, 0, 37, "Subsubsection",ExpressionUUID->"d3174cc3-0acb-46eb-8dda-1333a3ceb442"],
Cell[777527, 20316, 4909, 133, 577, "Code",ExpressionUUID->"6c498104-1432-4619-9ec2-c6d3f6ab4b18"],
Cell[782439, 20451, 1283, 36, 178, "Code",ExpressionUUID->"c0b93664-439a-4955-be5b-f5ec1c3594b4"],
Cell[783725, 20489, 14534, 352, 1508, "Code",ExpressionUUID->"b05096c8-cccb-4a62-8f5e-3eadb3574667"]
}, Closed]],
Cell[CellGroupData[{
Cell[798296, 20846, 92, 0, 37, "Subsubsection",ExpressionUUID->"e1b81da1-dbc7-4247-b5fd-7c771260b4c4"],
Cell[798391, 20848, 7017, 189, 539, "Code",ExpressionUUID->"b2bd5b20-2674-4926-93c2-74dbf8bcfb03"],
Cell[805411, 21039, 9292, 215, 691, "Code",ExpressionUUID->"6969d9a9-f29e-49b1-bd28-24b1e249bfb5"],
Cell[814706, 21256, 3176, 85, 281, "Code",ExpressionUUID->"6e37a092-e53a-4e96-9b44-eafeab8280a0"],
Cell[817885, 21343, 2405, 66, 281, "Code",ExpressionUUID->"eefa33f0-9487-482a-a9f9-75992e7dc134"]
}, Closed]],
Cell[CellGroupData[{
Cell[820327, 21414, 100, 0, 37, "Subsubsection",ExpressionUUID->"43186013-f54c-4925-b767-89869d60a75b"],
Cell[820430, 21416, 14089, 363, 1112, "Code",ExpressionUUID->"d01c233c-d04b-4c31-8a19-cd8a996d4e8f"],
Cell[834522, 21781, 1270, 36, 181, "Code",ExpressionUUID->"9f8e77b2-2246-466f-bbc8-7d10df6911a0"],
Cell[835795, 21819, 18653, 457, 789, "Code",ExpressionUUID->"af3fed59-5075-43ec-8a7e-0533187360f0"]
}, Closed]],
Cell[CellGroupData[{
Cell[854485, 22281, 107, 0, 37, "Subsubsection",ExpressionUUID->"0f8d50f1-afcc-44d1-b384-6e361cf93302"],
Cell[854595, 22283, 8561, 226, 577, "Code",ExpressionUUID->"fbfdb925-2895-4648-a144-dda7cfcadcc1"],
Cell[863159, 22511, 1119, 32, 83, "Code",ExpressionUUID->"405a90fe-1848-4bbb-8388-a6f741bca8a6"],
Cell[864281, 22545, 6940, 149, 463, "Code",ExpressionUUID->"4da8bcf9-f7fc-4baa-a7fe-2d419e79ddc2"],
Cell[871224, 22696, 596, 17, 83, "Code",ExpressionUUID->"856f48e0-31e2-4ceb-a592-f7ee2ce95867"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[871869, 22719, 102, 0, 54, "Subsection",ExpressionUUID->"cb0705f5-6ee7-42ce-bd98-337ea66e1bcf"],
Cell[CellGroupData[{
Cell[871996, 22723, 122, 0, 45, "Subsubsection",ExpressionUUID->"936edf7f-020a-47a7-9d2d-d59ca5691bea"],
Cell[872121, 22725, 1540, 38, 143, "Code",ExpressionUUID->"8d08c533-5aca-4c92-9115-3251c5110c59"],
Cell[873664, 22765, 1596, 43, 200, "Code",ExpressionUUID->"414a48f8-0460-4f16-beb3-5304ae31782f"],
Cell[875263, 22810, 3475, 98, 276, "Code",ExpressionUUID->"fc7c8ee8-7208-4bfb-b0d2-9a8e8f5faa83"],
Cell[878741, 22910, 2866, 76, 276, "Code",ExpressionUUID->"0cd90e14-bdd3-4e77-87ae-322091a59501"]
}, Closed]],
Cell[CellGroupData[{
Cell[881644, 22991, 101, 0, 37, "Subsubsection",ExpressionUUID->"ad1bcf64-cd10-4ca6-b1cc-585d731370c7"],
Cell[881748, 22993, 2052, 53, 197, "Code",ExpressionUUID->"a8f653e6-0073-4e26-88b3-b7e9ea5fa4e3"]
}, Closed]],
Cell[CellGroupData[{
Cell[883837, 23051, 96, 0, 37, "Subsubsection",ExpressionUUID->"8cce2016-734e-42f2-be2b-cbdd076c933d"],
Cell[883936, 23053, 647, 17, 36, "Code",ExpressionUUID->"a044e23e-1cf7-439c-8988-ba19bc69562f"]
}, Closed]],
Cell[CellGroupData[{
Cell[884620, 23075, 95, 0, 37, "Subsubsection",ExpressionUUID->"82b83af1-364d-4441-ac6f-7d4ab9c93140"],
Cell[884718, 23077, 1073, 27, 143, "Code",ExpressionUUID->"24754796-afb7-45a3-8951-4a536a4a06ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[885828, 23109, 94, 0, 37, "Subsubsection",ExpressionUUID->"40634b5d-5042-457b-b993-97b346712759"],
Cell[885925, 23111, 1064, 27, 64, "Code",ExpressionUUID->"7a361400-0ab0-480a-8540-923e7b45dae0"]
}, Closed]],
Cell[CellGroupData[{
Cell[887026, 23143, 94, 0, 37, "Subsubsection",ExpressionUUID->"b14c81ad-57f2-4d31-b5c8-6ba50d536466"],
Cell[887123, 23145, 657, 17, 83, "Code",ExpressionUUID->"b4b8b7fc-0ce5-405c-bfdc-ceda27c196cd"]
}, Closed]],
Cell[CellGroupData[{
Cell[887817, 23167, 93, 0, 37, "Subsubsection",ExpressionUUID->"5aef37b4-8e7e-4e78-8436-4ba089791318"],
Cell[887913, 23169, 649, 17, 36, "Code",ExpressionUUID->"17113e68-20ca-4fc5-b9c9-b00d33e0fb3d"]
}, Closed]],
Cell[CellGroupData[{
Cell[888599, 23191, 96, 0, 37, "Subsubsection",ExpressionUUID->"51d396bd-59b9-41b5-8132-3e59ac3c087f"],
Cell[888698, 23193, 527, 13, 36, "Code",ExpressionUUID->"39a0c5e5-34c0-48f6-8ad7-a3093cefd676"]
}, Closed]],
Cell[CellGroupData[{
Cell[889262, 23211, 120, 0, 37, "Subsubsection",ExpressionUUID->"72d58bed-db3c-4a7d-9208-04f5cef0b41d"],
Cell[889385, 23213, 653, 17, 86, "Code",ExpressionUUID->"ef666df7-d4d4-42ba-a742-668ead4cc0eb"],
Cell[890041, 23232, 677, 17, 86, "Code",ExpressionUUID->"00cc8537-555f-44c2-a479-a17ad44530f5"]
}, Closed]],
Cell[CellGroupData[{
Cell[890755, 23254, 106, 0, 37, "Subsubsection",ExpressionUUID->"629e0869-a792-448b-b759-8452461b16c9"],
Cell[890864, 23256, 371, 10, 66, "Code",ExpressionUUID->"77d06f1b-f7ab-4500-a658-4079097e7227"],
Cell[891238, 23268, 2504, 69, 371, "Code",ExpressionUUID->"63542191-1f62-4e2b-9a55-5238b3bb62ea"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[893803, 23344, 92, 0, 67, "Section",ExpressionUUID->"70cb6267-297f-49ae-8390-84069dce1312"],
Cell[CellGroupData[{
Cell[893920, 23348, 94, 0, 54, "Subsection",ExpressionUUID->"af54ddfa-5e79-4f77-9528-e963cd27f19c"],
Cell[894017, 23350, 2323, 61, 238, "Code",ExpressionUUID->"872c887b-ebb1-4f0f-9e59-c680e94e32e2"]
}, Closed]],
Cell[CellGroupData[{
Cell[896377, 23416, 96, 0, 38, "Subsection",ExpressionUUID->"eb28c2ea-925e-4fd4-8037-bec773c38b21"],
Cell[896476, 23418, 2376, 65, 276, "Code",ExpressionUUID->"008b0748-f442-46ea-8f18-68502af166e9"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[898901, 23489, 101, 0, 67, "Section",ExpressionUUID->"031833b0-36bf-4aa3-bd22-f4302ed56c53"],
Cell[CellGroupData[{
Cell[899027, 23493, 107, 0, 54, "Subsection",ExpressionUUID->"073fe901-13b8-4b85-a9a4-b39c522c9bb3"],
Cell[899137, 23495, 9946, 251, 1000, "Code",ExpressionUUID->"d16aa780-c2da-4a0c-8d77-00283bb87712"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[909132, 23752, 86, 0, 67, "Section",ExpressionUUID->"1057eff9-5f17-4068-acc7-4bffd91fc573"],
Cell[CellGroupData[{
Cell[909243, 23756, 105, 0, 54, "Subsection",ExpressionUUID->"570218bd-49b5-4ca4-b546-bea8c4815be7"],
Cell[909351, 23758, 196, 3, 35, "Text",ExpressionUUID->"7de08b25-a660-4064-8f9f-9c0584610130"],
Cell[909550, 23763, 3097, 72, 428, "Code",ExpressionUUID->"8fc21ec3-bd31-48c7-99a9-e6f2bd594953"],
Cell[912650, 23837, 2119, 56, 371, "Code",ExpressionUUID->"8ac23fb1-7284-4a34-87b9-593e96f3af72"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[914818, 23899, 78, 0, 67, "Section",ExpressionUUID->"6e6b1080-8143-41c2-bf56-a613ed97817c"],
Cell[914899, 23901, 252, 8, 105, "Code",ExpressionUUID->"f4f9e795-777e-433c-97fa-0aa5d3bb0d3a"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[915200, 23915, 125, 0, 58, "Chapter",ExpressionUUID->"b2dba352-41ac-4c41-8cd0-89374938bec7"],
Cell[915328, 23917, 214, 6, 66, "Code",ExpressionUUID->"b82d541f-dac9-4957-9bce-6f05e2b763c2"],
Cell[CellGroupData[{
Cell[915567, 23927, 79, 0, 67, "Section",ExpressionUUID->"73915429-1494-4af5-b0a0-500eb7ba478d"],
Cell[915649, 23929, 4742, 81, 281, "Code",ExpressionUUID->"d062486e-3334-4371-b057-cc402806a5aa"],
Cell[920394, 24012, 4519, 76, 276, "Code",ExpressionUUID->"54d13d81-bc52-43f3-b92b-77ecb238a8aa"],
Cell[924916, 24090, 1410, 30, 181, "Code",ExpressionUUID->"a68366c6-336f-4346-b15c-2c22b179ab9e"],
Cell[926329, 24122, 2618, 62, 257, "Code",ExpressionUUID->"6df18a0e-6370-480c-a4c0-79be3746c9f5"],
Cell[928950, 24186, 713, 17, 105, "Code",ExpressionUUID->"5d5039a9-a8aa-4a43-8ed2-26c9dd67a7ff"],
Cell[929666, 24205, 3147, 65, 561, "Code",ExpressionUUID->"d3d232a2-d2f0-4edd-811a-e6bfe8f464d3"],
Cell[932816, 24272, 348, 8, 66, "Code",ExpressionUUID->"e7c746c1-2315-4231-80ed-758ab0a53e10"],
Cell[933167, 24282, 1009, 18, 105, "Code",ExpressionUUID->"629a732b-cf53-4bce-bf8f-e269f14240c3"],
Cell[934179, 24302, 3100, 60, 542, "Code",ExpressionUUID->"9f3c6bc3-e1f2-404a-b458-b61b234f2a0c"],
Cell[937282, 24364, 338, 8, 66, "Code",ExpressionUUID->"605b6d8c-9ed0-4469-b11f-f25fc5895f2a"],
Cell[937623, 24374, 1186, 29, 181, "Code",ExpressionUUID->"6720fc8e-f64b-40fd-9cd4-0b342dca3c4c"],
Cell[938812, 24405, 2050, 39, 200, "Code",ExpressionUUID->"26ac018e-d3cd-4b8e-8be3-ef6964a705fa"],
Cell[940865, 24446, 2925, 51, 238, "Code",ExpressionUUID->"b5932bf9-eb16-4733-95a2-c0d28cbc74eb"],
Cell[943793, 24499, 573, 14, 86, "Code",ExpressionUUID->"444b2f4a-dc84-44ba-af1b-fea03b008251"]
}, Open  ]],
Cell[CellGroupData[{
Cell[944403, 24518, 110, 0, 67, "Section",ExpressionUUID->"8a9e5486-2df6-4b93-9dc2-b554504ae96d"],
Cell[944516, 24520, 382, 11, 124, "Code",ExpressionUUID->"e1d9d711-2332-45c6-b149-b767382b3d44"],
Cell[944901, 24533, 715, 21, 86, "Code",ExpressionUUID->"4ae0ac49-4287-4043-9ab2-23121abff931"],
Cell[945619, 24556, 820, 21, 124, "Code",ExpressionUUID->"23cd23a7-9d77-47e0-95aa-dd921e7ea19d"],
Cell[946442, 24579, 3677, 83, 257, "Code",ExpressionUUID->"e3ca056a-2047-4f83-ac78-61703de77008"],
Cell[CellGroupData[{
Cell[950144, 24666, 94, 0, 54, "Subsection",ExpressionUUID->"cf5b3ee8-ffae-4f09-a130-12c1ee2bed91"],
Cell[950241, 24668, 9204, 236, 922, "Code",ExpressionUUID->"81559538-23e4-418c-af09-923e0c0549d5"]
}, Closed]],
Cell[CellGroupData[{
Cell[959482, 24909, 121, 0, 38, "Subsection",ExpressionUUID->"dd6a3406-e103-4d67-ba5d-46745a2aac0c"],
Cell[959606, 24911, 1658, 51, 219, "Code",ExpressionUUID->"c875f7af-404b-4ffe-b7cb-18873a8f2129"],
Cell[961267, 24964, 16728, 435, 1701, "Code",ExpressionUUID->"b05402af-776c-4acb-bfe9-c46f1bc36e1e"],
Cell[977998, 25401, 26386, 732, 127, "Code",ExpressionUUID->"2df2e8ac-6715-419b-b5cd-63a7ffa6face"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[1004433, 26139, 100, 0, 53, "Section",ExpressionUUID->"9fbb1e8d-4aff-41c8-a1c6-577a2f9fb10e"],
Cell[CellGroupData[{
Cell[1004558, 26143, 97, 0, 54, "Subsection",ExpressionUUID->"1dfd8d13-1b68-4298-a629-f270fa825602"],
Cell[1004658, 26145, 1557, 39, 178, "Code",ExpressionUUID->"c096df45-35d7-4194-bb7d-c685fc4d292d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1006252, 26189, 122, 0, 38, "Subsection",ExpressionUUID->"ad6ad24c-4f7b-4beb-92a1-ed99eb40f1e7"],
Cell[1006377, 26191, 4032, 99, 490, "Code",ExpressionUUID->"47297589-ee37-43ff-bf7f-7c152204d265"],
Cell[1010412, 26292, 3792, 93, 482, "Code",ExpressionUUID->"11766d39-10ef-4cf6-927c-a440d6c8c708"]
}, Closed]],
Cell[CellGroupData[{
Cell[1014241, 26390, 129, 0, 38, "Subsection",ExpressionUUID->"af2c53f5-a9de-4109-a13f-82f175ddf7f2"],
Cell[1014373, 26392, 2388, 62, 273, "Code",ExpressionUUID->"db6a5df8-19c5-4bab-8ac6-3147ffb02c54"],
Cell[1016764, 26456, 11855, 253, 1283, "Code",ExpressionUUID->"b298e006-af04-4d16-996b-24e3bd33eb73"]
}, Closed]],
Cell[CellGroupData[{
Cell[1028656, 26714, 87, 0, 38, "Subsection",ExpressionUUID->"77f46617-66e3-461f-ace6-d24f48398263"],
Cell[1028746, 26716, 569, 15, 105, "Code",ExpressionUUID->"5527ee5a-7e2e-4a8b-87d2-57419740046d"],
Cell[1029318, 26733, 2945, 63, 466, "Code",ExpressionUUID->"f5b720ce-52ab-4a80-8600-f3d0c95aa648"],
Cell[1032266, 26798, 2850, 66, 295, "Code",ExpressionUUID->"8680d826-b964-4c9b-9b43-e06c0619f39c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1035153, 26869, 98, 0, 38, "Subsection",ExpressionUUID->"70f3d70c-5d2e-460e-a603-69c4f0006862"],
Cell[1035254, 26871, 2987, 70, 428, "Code",ExpressionUUID->"305f9a8d-4023-4f8f-b5b0-0f442b82bc09"]
}, Closed]],
Cell[CellGroupData[{
Cell[1038278, 26946, 100, 0, 38, "Subsection",ExpressionUUID->"270d75fd-0d5f-4e6a-9691-665d4b2a30bd"],
Cell[1038381, 26948, 1723, 42, 197, "Code",ExpressionUUID->"76b0ea52-787c-421a-b810-34b1cd656b62"]
}, Closed]],
Cell[CellGroupData[{
Cell[1040141, 26995, 100, 0, 38, "Subsection",ExpressionUUID->"4188b88c-e41a-43eb-b5cf-0ce93e9cdf86"],
Cell[1040244, 26997, 1965, 50, 235, "Code",ExpressionUUID->"e91ab3d8-33a6-4196-9baf-e7ed0fb667d7"],
Cell[1042212, 27049, 1152, 31, 159, "Code",ExpressionUUID->"f729c132-b358-4c22-abb6-4c2eee22ef69"],
Cell[1043367, 27082, 913, 26, 140, "Code",ExpressionUUID->"25d7c633-ae40-4117-a403-95976b182b10"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1044329, 27114, 105, 0, 67, "Section",ExpressionUUID->"be412990-58f1-4e3c-bc6b-ba37fa0aa38e"],
Cell[CellGroupData[{
Cell[1044459, 27118, 96, 0, 54, "Subsection",ExpressionUUID->"544c5086-1df8-4504-beb9-cdd9287aa475"],
Cell[1044558, 27120, 9091, 227, 942, "Code",ExpressionUUID->"1ff66576-f1b4-46d1-9239-013556c9f5eb"]
}, Closed]],
Cell[CellGroupData[{
Cell[1053686, 27352, 104, 0, 38, "Subsection",ExpressionUUID->"e5fb46ed-8d91-476b-90c1-a5a692e9c7b6"],
Cell[1053793, 27354, 9158, 227, 885, "Code",ExpressionUUID->"83555aa8-c0b7-4026-bbef-e23322bf20d9"]
}, Closed]],
Cell[CellGroupData[{
Cell[1062988, 27586, 86, 0, 38, "Subsection",ExpressionUUID->"1d6849e4-8a93-416b-9629-816a8d713505"],
Cell[1063077, 27588, 2297, 60, 200, "Code",ExpressionUUID->"91d3ea7e-b367-4d8f-a2e1-b86f413fad70"],
Cell[1065377, 27650, 3069, 83, 238, "Code",ExpressionUUID->"83cf1a8f-e72b-4988-9fbc-31a4ee901dc2"]
}, Closed]],
Cell[CellGroupData[{
Cell[1068483, 27738, 90, 0, 38, "Subsection",ExpressionUUID->"4ad8f35c-0c6e-432e-92bd-045a2058c437"],
Cell[1068576, 27740, 5490, 141, 409, "Code",ExpressionUUID->"aac3bd51-98d4-4ee4-9066-cb36ede9eb5c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1074103, 27886, 91, 0, 38, "Subsection",ExpressionUUID->"4f2fe652-6abb-453b-b838-248454e19ddc"],
Cell[1074197, 27888, 1616, 42, 163, "Code",ExpressionUUID->"cba8d015-daea-49ac-9ec0-775db2cc139c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1075850, 27935, 117, 0, 38, "Subsection",ExpressionUUID->"562e24b5-698b-4ad4-9b73-950bc1b6db48"],
Cell[1075970, 27937, 1488, 37, 162, "Code",ExpressionUUID->"82fa6c99-71bd-4c31-82c9-b303fa5e86a5"],
Cell[1077461, 27976, 5475, 133, 642, "Code",ExpressionUUID->"5bc9cf62-dbb7-40de-b85d-e8dcf9d380df"],
Cell[1082939, 28111, 5738, 138, 618, "Code",ExpressionUUID->"acc0980c-b0c5-44c5-97cf-81db4889f1a2"],
Cell[CellGroupData[{
Cell[1088702, 28253, 96, 0, 45, "Subsubsection",ExpressionUUID->"210b555e-5c19-4358-9e47-26ced9aa372d"],
Cell[1088801, 28255, 3616, 86, 634, "Code",ExpressionUUID->"67c278b9-eef7-4b05-ae0e-8903de6803e2"],
Cell[1092420, 28343, 1178, 29, 254, "Code",ExpressionUUID->"de5d12de-88f2-4f66-aca7-2a9462b01290"],
Cell[1093601, 28374, 4144, 118, 444, "Code",ExpressionUUID->"bb76698f-934f-49ed-accd-f896b4d70a0c"],
Cell[1097748, 28494, 4215, 111, 395, "Code",ExpressionUUID->"81c418b1-c286-46bf-a115-a2aebac829b4"]
}, Closed]],
Cell[CellGroupData[{
Cell[1102000, 28610, 101, 0, 37, "Subsubsection",ExpressionUUID->"04e4ccfe-f5d0-4c69-876b-7beec801cf2e"],
Cell[1102104, 28612, 5328, 126, 596, "Code",ExpressionUUID->"57513859-4f53-4eda-9590-ffdd220c0920"]
}, Closed]],
Cell[CellGroupData[{
Cell[1107469, 28743, 97, 0, 37, "Subsubsection",ExpressionUUID->"82434295-c65e-4c3d-9009-b10aad58af20"],
Cell[1107569, 28745, 5563, 137, 558, "Code",ExpressionUUID->"cf271863-19b8-49cc-b7de-25a0d2ac9be2"]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1113193, 28889, 111, 0, 67, "Section",ExpressionUUID->"a179735a-0e92-4be5-8c11-2f14787a7022"],
Cell[CellGroupData[{
Cell[1113329, 28893, 154, 2, 54, "Subsection",ExpressionUUID->"9f7f7300-e093-4608-bdc0-515eb88529f0"],
Cell[1113486, 28897, 2233, 61, 200, "Code",ExpressionUUID->"728e38a5-cecd-4b7b-a1f4-b4c8094cc050"],
Cell[1115722, 28960, 1905, 52, 200, "Code",ExpressionUUID->"adb8d8ad-2a69-432e-9101-5ef289672aa6"],
Cell[1117630, 29014, 1875, 54, 162, "Code",ExpressionUUID->"b4def607-cc7e-4abd-a4da-eb7e19c6a326"]
}, Closed]],
Cell[CellGroupData[{
Cell[1119542, 29073, 104, 0, 38, "Subsection",ExpressionUUID->"cc530052-f836-4fca-b7ce-fe5da13a5e96"],
Cell[1119649, 29075, 2502, 66, 295, "Code",ExpressionUUID->"216009e6-27cf-4f6b-9566-2fc20f53096e"]
}, Closed]],
Cell[CellGroupData[{
Cell[1122188, 29146, 105, 0, 38, "Subsection",ExpressionUUID->"0d7198e4-d557-4a45-9d92-3660b3703b66"],
Cell[1122296, 29148, 2597, 67, 219, "Code",ExpressionUUID->"81434a9a-c9a7-4c73-b3d8-bebc20d4c50b"]
}, Closed]],
Cell[CellGroupData[{
Cell[1124930, 29220, 101, 0, 38, "Subsection",ExpressionUUID->"9123b123-d97f-4e49-ac8b-fc63cba8477b"],
Cell[1125034, 29222, 6004, 154, 660, "Code",ExpressionUUID->"3aeddf4b-e73a-4f83-9c9a-0acaa25aa414"],
Cell[1131041, 29378, 2912, 61, 390, "Code",ExpressionUUID->"044fa456-bd69-4a55-a416-3e922b52f622"]
}, Closed]],
Cell[CellGroupData[{
Cell[1133990, 29444, 105, 0, 38, "Subsection",ExpressionUUID->"ed21ee08-f6e8-4397-9e7c-264e4a262262"],
Cell[1134098, 29446, 1415, 40, 86, "Code",ExpressionUUID->"b67c74e3-2586-4ac2-a9ce-decf0b51c797"],
Cell[1135516, 29488, 3594, 98, 238, "Code",ExpressionUUID->"a386d309-e03b-4d47-b830-33403a112ab3"],
Cell[1139113, 29588, 7112, 188, 409, "Code",ExpressionUUID->"481efb83-3a28-4515-b5a4-6701d24a7c85"],
Cell[1146228, 29778, 2381, 62, 257, "Code",ExpressionUUID->"e6687d59-c765-432d-9362-dbdcd54ffaf7"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1148658, 29846, 82, 0, 67, "Section",ExpressionUUID->"6dc83a59-8f2a-4e98-973b-854d49e98ccd"],
Cell[CellGroupData[{
Cell[1148765, 29850, 154, 2, 54, "Subsection",ExpressionUUID->"7f59fc39-026d-4264-9e18-16bd44df04b1"],
Cell[1148922, 29854, 1837, 49, 200, "Code",ExpressionUUID->"c753b2a6-b910-4cb3-a41d-139c3d31553f"],
Cell[1150762, 29905, 1338, 36, 219, "Code",ExpressionUUID->"3dcff0a2-80fd-44a1-bd89-bd430e8f846c"],
Cell[1152103, 29943, 6007, 140, 884, "Code",ExpressionUUID->"a01b605f-3682-40f9-a3cf-ed565cef7a4f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1158147, 30088, 94, 0, 38, "Subsection",ExpressionUUID->"5b0b49f0-51e8-493f-92c0-cd02217061a7"],
Cell[1158244, 30090, 1914, 47, 349, "Code",ExpressionUUID->"7e6d6bb8-169f-41e0-8b1a-013b6e5152b9"]
}, Closed]],
Cell[CellGroupData[{
Cell[1160195, 30142, 93, 0, 38, "Subsection",ExpressionUUID->"05958150-2753-49a1-bcff-ad04e453151c"],
Cell[1160291, 30144, 4389, 115, 558, "Code",ExpressionUUID->"5e7cf034-611a-4000-a371-7ce6fd7d8af1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1164717, 30264, 94, 0, 38, "Subsection",ExpressionUUID->"534dfc5d-c63b-4c6e-ba63-758d27e8d0e1"],
Cell[1164814, 30266, 755, 22, 124, "Code",ExpressionUUID->"f995f568-5603-423b-b92c-73f086e5526e"],
Cell[1165572, 30290, 3877, 96, 352, "Code",ExpressionUUID->"680aac2e-d58b-40c8-b7d4-ea52edea8b7d"],
Cell[1169452, 30388, 5786, 136, 542, "Code",ExpressionUUID->"64b80402-9692-43c6-ade1-c477b2b2a0a8"]
}, Closed]],
Cell[CellGroupData[{
Cell[1175275, 30529, 117, 0, 38, "Subsection",ExpressionUUID->"043fba01-a9ed-4a37-9182-6e60ca559505"],
Cell[1175395, 30531, 1267, 33, 254, "Code",ExpressionUUID->"066adf50-6828-4aea-a6bb-c6afb7d98a82"],
Cell[1176665, 30566, 1996, 59, 216, "Code",ExpressionUUID->"ce6d6f2c-48d8-4ec7-ade0-2516669648a1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1178698, 30630, 148, 2, 38, "Subsection",ExpressionUUID->"60e19505-c58d-41b9-83e1-93382c6b5f0e"],
Cell[1178849, 30634, 930, 25, 140, "Code",ExpressionUUID->"012050bf-af43-467f-8c4c-ab008faf4d1a"]
}, Closed]],
Cell[CellGroupData[{
Cell[1179816, 30664, 102, 0, 38, "Subsection",ExpressionUUID->"bc228997-732f-4570-80d8-fa2b9bd50f25"],
Cell[1179921, 30666, 958, 22, 200, "Code",ExpressionUUID->"b21c5234-5bbb-457a-92fc-46ee4c5f0e27"],
Cell[1180882, 30690, 1948, 50, 276, "Code",ExpressionUUID->"7b32ddb1-db56-4cb0-9b8d-da5ec6e9a55b"],
Cell[1182833, 30742, 5891, 129, 885, "Code",ExpressionUUID->"a5364f25-eff6-4acb-91ec-f48e03bebed9"],
Cell[1188727, 30873, 3466, 83, 444, "Code",ExpressionUUID->"3d48ee61-3e79-48c8-af84-09f3702fc2ea"]
}, Closed]],
Cell[CellGroupData[{
Cell[1192230, 30961, 102, 0, 38, "Subsection",ExpressionUUID->"0955fd1d-b186-4700-ba07-6ea578777560"],
Cell[1192335, 30963, 2175, 54, 333, "Code",ExpressionUUID->"fed80f7a-0219-4694-a02d-6cde06ffe917"],
Cell[1194513, 31019, 7131, 180, 808, "Code",ExpressionUUID->"d10bd735-0609-4734-b483-4b53e1dfbcf9"],
Cell[1201647, 31201, 6868, 167, 808, "Code",ExpressionUUID->"ce7d3d73-9a5e-4531-a957-f2dc9a718060"],
Cell[1208518, 31370, 12487, 276, 1549, "Code",ExpressionUUID->"e3681a21-aff1-47fa-a43c-f721a4c7e091"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1221054, 31652, 88, 0, 67, "Section",ExpressionUUID->"333eb685-a2c4-4c84-bd5e-8615e1631051"],
Cell[CellGroupData[{
Cell[1221167, 31656, 93, 0, 54, "Subsection",ExpressionUUID->"82564513-5073-4b17-bfca-e5d1a9ae9db6"],
Cell[1221263, 31658, 4409, 99, 596, "Code",ExpressionUUID->"46ab40c5-6588-471d-aecc-eb27817cc926"]
}, Closed]],
Cell[CellGroupData[{
Cell[1225709, 31762, 88, 0, 38, "Subsection",ExpressionUUID->"7d27c4fa-8a9a-4c02-b26b-2c60a0524bb5"],
Cell[1225800, 31764, 1253, 35, 102, "Code",ExpressionUUID->"6492dec8-04b5-49d8-9b6a-cf1b6c357cb1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1227090, 31804, 104, 0, 38, "Subsection",ExpressionUUID->"1d244cab-2ef7-4343-a085-dae22554ee81"],
Cell[1227197, 31806, 3473, 89, 368, "Code",ExpressionUUID->"0d37b454-bdbe-4fea-9939-e62ffc2de93d"],
Cell[1230673, 31897, 3421, 86, 368, "Code",ExpressionUUID->"04145058-5082-47fe-80c7-d92256293738"]
}, Closed]],
Cell[CellGroupData[{
Cell[1234131, 31988, 92, 0, 38, "Subsection",ExpressionUUID->"a15d9be0-e8de-477e-9c87-2af567086d49"],
Cell[1234226, 31990, 2108, 53, 295, "Code",ExpressionUUID->"acfcd0c2-af8a-418c-a3d7-96424de01343"]
}, Closed]],
Cell[CellGroupData[{
Cell[1236371, 32048, 104, 0, 38, "Subsection",ExpressionUUID->"7175c9bb-4b34-456a-961e-4df84c76e52c"],
Cell[1236478, 32050, 7160, 182, 862, "Code",ExpressionUUID->"ccd1ebc1-8990-4e63-876f-5cefd2cc3814"]
}, Closed]],
Cell[CellGroupData[{
Cell[1243675, 32237, 122, 0, 38, "Subsection",ExpressionUUID->"5ea20f50-81a4-427a-bc68-378f73dcb50b"],
Cell[1243800, 32239, 568, 15, 124, "Code",ExpressionUUID->"03b9d93c-0ac2-41eb-862d-d2fd3b407a4a"],
Cell[1244371, 32256, 7087, 184, 694, "Code",ExpressionUUID->"2158514b-9987-47f1-82de-22388e0a407b"],
Cell[1251461, 32442, 7254, 190, 729, "Code",ExpressionUUID->"84c86739-b364-471a-beae-96cff8470e91"]
}, Closed]],
Cell[CellGroupData[{
Cell[1258752, 32637, 108, 0, 38, "Subsection",ExpressionUUID->"4943eeb1-0a06-427a-8438-0fa94c25262d"],
Cell[1258863, 32639, 530, 14, 66, "Code",ExpressionUUID->"b649267b-3eb7-488c-aa47-6711a6ebdcc9"],
Cell[1259396, 32655, 5110, 131, 580, "Code",ExpressionUUID->"83a592c0-4483-4c46-8440-5e3cfc26f34a"],
Cell[1264509, 32788, 1200, 31, 162, "Code",ExpressionUUID->"52dcd2cd-c194-44c3-a973-37f1d0ee3ac9"],
Cell[1265712, 32821, 7877, 183, 960, "Code",ExpressionUUID->"b327d84b-f6fd-4e10-a64a-483813cf0a29"],
Cell[1273592, 33006, 7710, 197, 846, "Code",ExpressionUUID->"00e1398a-2b47-4b4f-8216-0f79a9e44e57"]
}, Closed]],
Cell[CellGroupData[{
Cell[1281339, 33208, 117, 0, 38, "Subsection",ExpressionUUID->"2410889c-f7e8-408e-9508-0a340dada935"],
Cell[1281459, 33210, 8561, 202, 1112, "Code",ExpressionUUID->"ae220ecb-0d83-45ec-9a76-c37a3fe68a2d"],
Cell[1290023, 33414, 6507, 154, 851, "Code",ExpressionUUID->"9aa8bbab-3f0a-4ad1-816c-2398d9416fa1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1296567, 33573, 113, 0, 38, "Subsection",ExpressionUUID->"ad21117c-44e4-446d-8ebc-675dcaedf199"],
Cell[1296683, 33575, 155, 2, 35, "Text",ExpressionUUID->"9e39eab6-78a5-47c9-8d4a-3e1e48178ab7"],
Cell[1296841, 33579, 1057, 27, 159, "Code",ExpressionUUID->"6dac9b4f-30a2-4a84-a0c4-510db4fe60c0"],
Cell[1297901, 33608, 1954, 48, 235, "Code",ExpressionUUID->"48032c11-b473-4e3c-8376-40462be1cec4"],
Cell[1299858, 33658, 2596, 72, 330, "Code",ExpressionUUID->"76236e65-adae-458b-9b18-cad6148ca08d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1302491, 33735, 100, 0, 38, "Subsection",ExpressionUUID->"3fdd0cdc-6a5f-4e8e-92b2-1a97ac4fb176"],
Cell[1302594, 33737, 6174, 142, 748, "Code",ExpressionUUID->"bb3a7d49-4ce8-41fc-b235-752e697856ab"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1308817, 33885, 108, 0, 67, "Section",ExpressionUUID->"76fced54-013e-4515-8b08-2183586114d5"],
Cell[CellGroupData[{
Cell[1308950, 33889, 112, 0, 54, "Subsection",ExpressionUUID->"7b4d3594-a2cd-4090-b2a1-9d90f5514d19"],
Cell[1309065, 33891, 1439, 39, 292, "Code",ExpressionUUID->"504d03c0-fe86-4ca9-8744-0f67ab5a9e4c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1310541, 33935, 96, 0, 38, "Subsection",ExpressionUUID->"7871a4b4-9a3d-4b82-802a-b8b58c954324"],
Cell[1310640, 33937, 3582, 95, 349, "Code",ExpressionUUID->"1f0b9228-4044-4ca1-8bf0-2c099e24aedf"]
}, Closed]],
Cell[CellGroupData[{
Cell[1314259, 34037, 103, 0, 38, "Subsection",ExpressionUUID->"6a71ee25-39e3-4d5e-b01a-4e093e7840ef"],
Cell[1314365, 34039, 6303, 172, 596, "Code",ExpressionUUID->"c3a549fb-eb9d-4550-b4a2-9c76c1102045"],
Cell[1320671, 34213, 5993, 143, 634, "Code",ExpressionUUID->"a413753e-7157-4c11-97c3-9d53eba60052"]
}, Closed]],
Cell[CellGroupData[{
Cell[1326701, 34361, 100, 0, 38, "Subsection",ExpressionUUID->"f5094168-5605-4865-8166-98df93726d0f"],
Cell[1326804, 34363, 1511, 39, 235, "Code",ExpressionUUID->"a5245adf-945d-4536-b3d5-e446fc1aab0b"],
Cell[1328318, 34404, 3032, 71, 425, "Code",ExpressionUUID->"8782f53d-2777-4b26-9deb-d90a391b9d1f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1331387, 34480, 95, 0, 38, "Subsection",ExpressionUUID->"47b8cdf4-769b-4346-b108-c4beb2d9a4b0"],
Cell[1331485, 34482, 8380, 201, 976, "Code",ExpressionUUID->"51ced9f3-17f5-4521-a84c-2fc54990ec3a"]
}, Closed]],
Cell[CellGroupData[{
Cell[1339902, 34688, 98, 0, 38, "Subsection",ExpressionUUID->"75c1debb-7b3b-4975-8b14-8b6391e4e9f8"],
Cell[1340003, 34690, 7404, 181, 558, "Code",ExpressionUUID->"2235d9f8-fa36-4da3-a523-d5f3eb4b06ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[1347444, 34876, 95, 0, 38, "Subsection",ExpressionUUID->"bc938ce6-3992-448f-acc2-17a2ed40c182"],
Cell[1347542, 34878, 4050, 97, 504, "Code",ExpressionUUID->"dad8f07f-6e82-4d90-82ad-f6ac6a36ef22"]
}, Closed]],
Cell[CellGroupData[{
Cell[1351629, 34980, 99, 0, 38, "Subsection",ExpressionUUID->"f5df93a4-f5be-4c26-9015-e6d6a994d7d4"],
Cell[1351731, 34982, 8862, 210, 824, "Code",ExpressionUUID->"d0f608b6-ee63-40b5-9713-1b92c874632a"],
Cell[1360596, 35194, 2601, 73, 292, "Code",ExpressionUUID->"70578e48-6ec1-4121-8b09-a14bce417e85"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1363246, 35273, 91, 0, 67, "Section",ExpressionUUID->"3a07a406-3a93-4f1d-9018-62647c8f04a2"],
Cell[CellGroupData[{
Cell[1363362, 35277, 112, 0, 54, "Subsection",ExpressionUUID->"5e57b61a-d219-4934-a890-cd59956902d1"],
Cell[1363477, 35279, 4332, 100, 471, "Code",ExpressionUUID->"b8f6c0e1-9575-4565-94e8-3146faa40eae"]
}, Closed]],
Cell[CellGroupData[{
Cell[1367846, 35384, 104, 0, 38, "Subsection",ExpressionUUID->"a8deb9f2-79d7-49c8-be55-9a0c3aec7157"],
Cell[1367953, 35386, 12191, 289, 1644, "Code",ExpressionUUID->"d4e68e5a-9602-4a4a-b440-17bbf19734d3"],
Cell[1380147, 35677, 1192, 26, 181, "Code",ExpressionUUID->"8119cb81-db64-41f8-a390-99290d243836"],
Cell[1381342, 35705, 2399, 58, 390, "Code",ExpressionUUID->"d0c74681-d7be-4943-bdb3-e78c2132a41c"],
Cell[1383744, 35765, 2081, 52, 390, "Code",ExpressionUUID->"486130dd-c91f-4635-9d83-1f3bd0aa6d73"]
}, Closed]],
Cell[CellGroupData[{
Cell[1385862, 35822, 107, 0, 38, "Subsection",ExpressionUUID->"b2ee595b-130d-48ce-a5ad-4e7ffb538f90"],
Cell[1385972, 35824, 1303, 32, 238, "Code",ExpressionUUID->"0667504c-8c02-4916-b24b-3bb7bdc2cf26"],
Cell[1387278, 35858, 7904, 195, 789, "Code",ExpressionUUID->"c18d8317-ae43-4b7f-9da1-c3475f665d7f"],
Cell[1395185, 36055, 9796, 222, 1340, "Code",ExpressionUUID->"f0a82410-c535-47a8-948b-b21f94c95228"]
}, Closed]],
Cell[CellGroupData[{
Cell[1405018, 36282, 109, 0, 38, "Subsection",ExpressionUUID->"f701af98-4573-44ce-bac9-9fc083472d2e"],
Cell[1405130, 36284, 776, 20, 143, "Code",ExpressionUUID->"c0491458-47ed-4612-a97b-234998126d75"],
Cell[1405909, 36306, 2868, 74, 352, "Code",ExpressionUUID->"258d98b1-596a-4353-9b32-6afddc286af6"],
Cell[1408780, 36382, 9699, 241, 1041, "Code",ExpressionUUID->"709fcb9c-08e6-4684-8f67-e39cfa498891"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1418528, 36629, 89, 0, 67, "Section",ExpressionUUID->"10b53468-301a-456a-9396-7a1b3738e486"],
Cell[CellGroupData[{
Cell[1418642, 36633, 100, 0, 54, "Subsection",ExpressionUUID->"4db4413b-f7dc-4706-99a3-cf121de60a27"],
Cell[1418745, 36635, 2013, 52, 219, "Code",ExpressionUUID->"2e74c90e-7216-4c80-a620-b44fa8b68c06"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1420807, 36693, 78, 0, 67, "Section",ExpressionUUID->"a9b198e2-0767-48ac-b046-37bfd6084753"],
Cell[1420888, 36695, 252, 8, 105, "Code",ExpressionUUID->"6ac1cc87-b8a2-416f-a747-62b9785cc946"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1421189, 36709, 115, 0, 58, "Chapter",ExpressionUUID->"5a8b7cb0-9767-43dc-919a-1b0b391815a1"],
Cell[1421307, 36711, 213, 6, 66, "Code",ExpressionUUID->"98df5a5e-b331-47c0-a64d-450182746a38"],
Cell[CellGroupData[{
Cell[1421545, 36721, 79, 0, 67, "Section",ExpressionUUID->"16e15631-03bf-4f3b-84e8-5ce1094fae6f"],
Cell[1421627, 36723, 523, 11, 105, "Code",ExpressionUUID->"1fefdd08-ab81-4b03-aab1-7eb192b442a9"],
Cell[1422153, 36736, 607, 15, 124, "Code",ExpressionUUID->"01f2dfa2-986a-4b95-b411-c600af854f43"],
Cell[1422763, 36753, 367, 9, 86, "Code",ExpressionUUID->"1628f146-b3f2-4871-bccb-7a246f33a144"],
Cell[1423133, 36764, 309, 8, 52, "Code",ExpressionUUID->"3583d2b8-2386-46fa-a348-7dcfe3f512df"],
Cell[1423445, 36774, 339, 8, 86, "Code",ExpressionUUID->"3ff9fc51-09cf-453d-a299-be49bcf9329b"],
Cell[1423787, 36784, 452, 10, 105, "Code",ExpressionUUID->"d62e8121-9030-4117-ab10-ad253752b5f3"],
Cell[1424242, 36796, 1152, 22, 86, "Code",ExpressionUUID->"1326e1f2-3d36-452d-b09e-f5500f477896"],
Cell[1425397, 36820, 752, 17, 124, "Code",ExpressionUUID->"e202e950-0e01-4ee2-b0a7-7987cb7e108a"],
Cell[1426152, 36839, 712, 15, 86, "Code",ExpressionUUID->"a41bca8b-ac3e-4dd2-80ef-a0645cc5e5ce"],
Cell[1426867, 36856, 732, 15, 86, "Code",ExpressionUUID->"e799e302-d427-4098-ae4e-27d9b8a64416"],
Cell[1427602, 36873, 755, 17, 143, "Code",ExpressionUUID->"83f8a726-efe7-4110-956b-bca1ea384930"],
Cell[1428360, 36892, 325, 8, 66, "Code",ExpressionUUID->"b96f0aa2-0ec5-4585-8f0e-6182e0b65a44"]
}, Closed]],
Cell[CellGroupData[{
Cell[1428722, 36905, 80, 0, 53, "Section",ExpressionUUID->"56132169-b503-4fec-ac0f-c8748f365dff"],
Cell[1428805, 36907, 469, 13, 140, "Code",ExpressionUUID->"894e1c8a-8944-40bb-90d1-36044a26fac1"]
}, Closed]],
Cell[CellGroupData[{
Cell[1429311, 36925, 96, 0, 53, "Section",ExpressionUUID->"8f3272e9-4365-46de-a73d-baaa4bf6be97"],
Cell[CellGroupData[{
Cell[1429432, 36929, 94, 0, 54, "Subsection",ExpressionUUID->"6510e159-2aac-4e44-9dbd-d54c70d36be2"],
Cell[1429529, 36931, 258, 7, 66, "Code",ExpressionUUID->"74c13a49-d78f-409b-8cae-4ac581199fcd"],
Cell[1429790, 36940, 7796, 191, 675, "Code",ExpressionUUID->"6e9c878d-02b2-4132-96ce-e8e66b822e4d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1437623, 37136, 92, 0, 38, "Subsection",ExpressionUUID->"fd1f8c0d-8cd5-461d-a1bd-d14c472d45ea"],
Cell[1437718, 37138, 718, 17, 219, "Code",ExpressionUUID->"cc6d6793-71d5-4e73-a480-e2ed6df579d6"],
Cell[1438439, 37157, 6305, 157, 694, "Code",ExpressionUUID->"66b5c38e-1661-4fc1-b3bb-2fc79ff6c3b9"],
Cell[1444747, 37316, 4826, 122, 540, "Code",ExpressionUUID->"2869981c-2b14-4190-aed6-de2de17b05d7"]
}, Closed]],
Cell[CellGroupData[{
Cell[1449610, 37443, 96, 0, 38, "Subsection",ExpressionUUID->"998277f7-e77f-481f-8d03-2b6fa89387fe"],
Cell[1449709, 37445, 5430, 134, 675, "Code",ExpressionUUID->"6d9f25cf-a57b-4e21-b29e-24805f43aeb2"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1455188, 37585, 89, 0, 67, "Section",ExpressionUUID->"8d4f30a8-a409-44fe-b780-83c10cec7e9b"],
Cell[CellGroupData[{
Cell[1455302, 37589, 93, 0, 54, "Subsection",ExpressionUUID->"6eafb23e-22a5-464e-ae73-da7c35369135"],
Cell[1455398, 37591, 1470, 40, 238, "Code",ExpressionUUID->"c7262850-b7bc-45dd-8311-e1e1990b38fb"]
}, Closed]],
Cell[CellGroupData[{
Cell[1456905, 37636, 100, 0, 38, "Subsection",ExpressionUUID->"6f76eeb7-891c-4cae-a5ac-4d64373ec68b"],
Cell[1457008, 37638, 671, 18, 105, "Code",ExpressionUUID->"6dabfa4d-8d28-41e4-86c9-de88b0ff3516"],
Cell[1457682, 37658, 1831, 46, 257, "Code",ExpressionUUID->"6ff73ef6-3c3e-43bd-9c10-d8759f822417"]
}, Closed]],
Cell[CellGroupData[{
Cell[1459550, 37709, 91, 0, 38, "Subsection",ExpressionUUID->"dec2368f-a749-4c44-a564-d70303dc01af"],
Cell[1459644, 37711, 379, 11, 124, "Code",ExpressionUUID->"e213c25d-86fb-46a8-bed2-db9cf4e00176"],
Cell[1460026, 37724, 429, 12, 86, "Code",ExpressionUUID->"27d9771e-c049-4d42-a05c-24f8aa65a359"],
Cell[1460458, 37738, 718, 20, 105, "Code",ExpressionUUID->"66c6af84-bc13-4556-a25c-ac0eee18a80e"],
Cell[1461179, 37760, 812, 24, 105, "Code",ExpressionUUID->"47d6ebf0-41ed-4fd2-a121-92c8d4158186"],
Cell[1461994, 37786, 1920, 46, 371, "Code",ExpressionUUID->"e3d20717-cfab-4fd4-94cc-77bbf18c68a2"],
Cell[1463917, 37834, 921, 25, 87, "Code",ExpressionUUID->"05eabc87-f7ca-4d0e-a158-8006e36d6e80"]
}, Closed]],
Cell[CellGroupData[{
Cell[1464875, 37864, 88, 0, 38, "Subsection",ExpressionUUID->"008e53a8-5623-407a-9675-c744ce0ab295"],
Cell[1464966, 37866, 388, 11, 124, "Code",ExpressionUUID->"a68525df-606e-4297-940a-d09936ce44be"],
Cell[1465357, 37879, 2100, 57, 333, "Code",ExpressionUUID->"a41842bb-7ef0-4b81-9c7f-a828a6df6b23"],
Cell[1467460, 37938, 1277, 35, 238, "Code",ExpressionUUID->"7e7cf3b5-db57-47e6-b6f1-c9d792881662"],
Cell[1468740, 37975, 1709, 48, 276, "Code",ExpressionUUID->"32dba077-af38-4697-a75e-e017261a5468"]
}, Closed]],
Cell[CellGroupData[{
Cell[1470486, 38028, 94, 0, 38, "Subsection",ExpressionUUID->"6f211a16-7cb3-4d11-8722-57c01e19ff28"],
Cell[1470583, 38030, 5243, 141, 471, "Code",ExpressionUUID->"e0bb26a5-0f3a-4748-bdb8-8c1e259c4ad9"]
}, Closed]],
Cell[CellGroupData[{
Cell[1475863, 38176, 92, 0, 38, "Subsection",ExpressionUUID->"5e6046c4-fd4b-49b0-b1c7-87f237226e76"],
Cell[1475958, 38178, 6678, 181, 466, "Code",ExpressionUUID->"e7f3cc07-671b-468a-9786-71394929206f"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1482685, 38365, 86, 0, 67, "Section",ExpressionUUID->"98b2155f-f47a-45bb-8fb7-4b6980d727fb"],
Cell[CellGroupData[{
Cell[1482796, 38369, 98, 0, 54, "Subsection",ExpressionUUID->"1a122a28-32d1-4a27-90a9-a1528906c8c0"],
Cell[1482897, 38371, 3152, 87, 333, "Code",ExpressionUUID->"436752b5-19a3-4653-b22e-045e8ecc949c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1486086, 38463, 112, 0, 38, "Subsection",ExpressionUUID->"1b1feca1-c8a4-423e-ae6b-4d0242a1bd3f"],
Cell[1486201, 38465, 3053, 80, 235, "Code",ExpressionUUID->"7eb36550-2677-423f-a8d8-d0ab46ad3de9"],
Cell[1489257, 38547, 2020, 52, 254, "Code",ExpressionUUID->"2e4e6074-c2e2-466f-9f4f-f2e1bbdc18b0"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1491326, 38605, 95, 0, 67, "Section",ExpressionUUID->"3a223d20-fd00-4681-bb34-d0d67287ba5a"],
Cell[CellGroupData[{
Cell[1491446, 38609, 127, 0, 54, "Subsection",ExpressionUUID->"cdb85ba4-fcc4-4d47-bebf-3f42f4284e57"],
Cell[1491576, 38611, 6714, 178, 732, "Code",ExpressionUUID->"86475d85-9a3f-4989-ab14-6a6455a4d8d0"]
}, Closed]],
Cell[CellGroupData[{
Cell[1498327, 38794, 93, 0, 38, "Subsection",ExpressionUUID->"1d7082d6-fe88-456f-bbee-ec48dcda4795"],
Cell[1498423, 38796, 2044, 50, 254, "Code",ExpressionUUID->"ca0f7ad4-e8c5-4fea-9b64-31539691bedf"],
Cell[1500470, 38848, 609, 17, 63, "Code",ExpressionUUID->"cfb7c4f0-3b35-4092-90e4-9984e62ee69e"],
Cell[1501082, 38867, 3324, 86, 368, "Code",ExpressionUUID->"e70b599e-0dc7-4b77-90cb-c44e0bd5f445"],
Cell[1504409, 38955, 4929, 129, 463, "Code",ExpressionUUID->"259c06f9-b5bb-48b2-afaf-c7bb31292e07"]
}, Closed]],
Cell[CellGroupData[{
Cell[1509375, 39089, 91, 0, 38, "Subsection",ExpressionUUID->"dd9e02cb-40b4-433d-a473-cad5e51bf190"],
Cell[1509469, 39091, 3587, 94, 428, "Code",ExpressionUUID->"3a4da837-219c-420b-a290-9b7db76205bb"]
}, Closed]],
Cell[CellGroupData[{
Cell[1513093, 39190, 86, 0, 38, "Subsection",ExpressionUUID->"db3d8342-8d8e-4752-845f-f3b764a796fb"],
Cell[1513182, 39192, 5635, 142, 642, "Code",ExpressionUUID->"63f61e01-74fc-40c9-934b-7d2c34da1f73"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1518854, 39339, 123, 0, 54, "Subsection",ExpressionUUID->"f1b04111-e3f7-4385-ae18-0bacd274da7e"],
Cell[1518980, 39341, 878, 24, 105, "Code",ExpressionUUID->"5d8708fa-cf07-414f-8126-ace947a8f0e8"]
}, Closed]],
Cell[CellGroupData[{
Cell[1519895, 39370, 99, 0, 38, "Subsection",ExpressionUUID->"e536bc67-8dac-439c-9b64-663526d4bf1d"],
Cell[1519997, 39372, 6125, 161, 580, "Code",ExpressionUUID->"a2cd35af-dbac-415c-ae7f-35b450b3699e"],
Cell[1526125, 39535, 3463, 90, 371, "Code",ExpressionUUID->"26dfeae0-7a2f-41aa-bacf-11526f181415"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1529637, 39631, 78, 0, 67, "Section",ExpressionUUID->"6ab0f874-d874-4315-8392-aaaebc7a8913"],
Cell[1529718, 39633, 252, 8, 105, "Code",ExpressionUUID->"4519db25-af3d-4f88-99eb-7a5b387934cb"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1530019, 39647, 93, 0, 69, "Chapter",ExpressionUUID->"4e117d75-efd0-4fbb-9ab5-54303adb6974"],
Cell[1530115, 39649, 214, 6, 66, "Code",ExpressionUUID->"e14f7419-89e3-4783-9198-ab1d0a95c1b9"],
Cell[CellGroupData[{
Cell[1530354, 39659, 79, 0, 67, "Section",ExpressionUUID->"6034899b-68aa-4037-b918-fc414503a490"],
Cell[1530436, 39661, 965, 24, 143, "Code",ExpressionUUID->"2cf6321a-3523-4f5a-99bf-84c1ba3196fa"],
Cell[1531404, 39687, 1280, 37, 181, "Code",ExpressionUUID->"3cf79f62-832f-451c-8e21-d75c262e0170"],
Cell[1532687, 39726, 785, 17, 162, "Code",ExpressionUUID->"fec2b29f-ac6a-4f61-b198-9ada7c9935e9"],
Cell[1533475, 39745, 1330, 33, 162, "Code",ExpressionUUID->"000feeec-bb30-48a8-8e9a-889f6914e183"],
Cell[1534808, 39780, 544, 13, 86, "Code",ExpressionUUID->"e7452ff7-4a1b-486f-843f-361c8ea558a0"],
Cell[1535355, 39795, 242, 7, 66, "Code",ExpressionUUID->"cf1d931e-3134-4092-81f5-c5441756f7b2"],
Cell[1535600, 39804, 497, 10, 86, "Code",ExpressionUUID->"d9c3b9f4-d516-4b54-ab90-6bc37fc2e6dc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1536134, 39819, 80, 0, 67, "Section",ExpressionUUID->"0f8e42dc-5f2f-405a-b230-3b1f2fd2dc43"],
Cell[1536217, 39821, 555, 15, 162, "Code",ExpressionUUID->"3298ad3f-9fe1-4719-b9e0-a54361a0a019"],
Cell[1536775, 39838, 309, 9, 66, "Code",ExpressionUUID->"52e422c9-ab38-4c95-acda-731019ee951e"],
Cell[CellGroupData[{
Cell[1537109, 39851, 92, 0, 54, "Subsection",ExpressionUUID->"9c9358fe-ae55-4130-8e30-bd7fea587b1f"],
Cell[1537204, 39853, 131, 0, 35, "Text",ExpressionUUID->"f8b993bd-1846-4c7c-abe4-19c8590cef53"],
Cell[1537338, 39855, 671, 18, 123, "Code",ExpressionUUID->"fd6b7c7f-e354-4bf8-8608-5101a71ab970"]
}, Closed]],
Cell[CellGroupData[{
Cell[1538046, 39878, 127, 0, 38, "Subsection",ExpressionUUID->"7e843407-88e6-42e6-a7fb-0d90b64f932d"],
Cell[1538176, 39880, 364, 7, 104, "Text",ExpressionUUID->"3c8f0d77-a834-4ff0-a98b-0ccc57bb7626"],
Cell[1538543, 39889, 287, 7, 83, "Code",ExpressionUUID->"ee8b7113-b14d-4213-ad7b-659d235ebec6"],
Cell[CellGroupData[{
Cell[1538855, 39900, 137, 1, 45, "Subsubsection",ExpressionUUID->"a1cb8e66-7329-4ded-baa9-cd3ec7b3c5c2"],
Cell[1538995, 39903, 1919, 47, 161, "Code",ExpressionUUID->"027b3b50-2a56-414b-88df-99e274bbffdc"],
Cell[1540917, 39952, 1268, 35, 122, "Code",ExpressionUUID->"b995dbde-19fd-43a7-8c9c-83b25c9bdef5"],
Cell[1542188, 39989, 351, 9, 63, "Code",ExpressionUUID->"5dcd21f4-b835-4d4f-97af-91a02a3405bb"],
Cell[1542542, 40000, 1136, 30, 121, "Code",ExpressionUUID->"7a12fd09-3023-4a6a-9142-c665dc720269"],
Cell[1543681, 40032, 2051, 55, 178, "Code",ExpressionUUID->"d8bca12e-1c2f-46ca-bf1e-9fc6225c2a9b"]
}, Closed]],
Cell[CellGroupData[{
Cell[1545769, 40092, 132, 0, 37, "Subsubsection",ExpressionUUID->"47b141fa-f895-4edc-9dc0-60d87ba3481f"],
Cell[1545904, 40094, 1683, 43, 142, "Code",ExpressionUUID->"9434bbe0-567d-4375-ac91-93e25ffa83ea"],
Cell[1547590, 40139, 1763, 46, 143, "Code",ExpressionUUID->"6e3767b1-9e21-4dff-8f4e-b1b419c1b1b2"],
Cell[1549356, 40187, 1181, 28, 103, "Code",ExpressionUUID->"dd5e9980-69bd-441c-8690-2ae9fd6577c5"]
}, Closed]],
Cell[CellGroupData[{
Cell[1550574, 40220, 134, 0, 37, "Subsubsection",ExpressionUUID->"471a8712-097f-4fd1-9518-c829ff43a184"],
Cell[1550711, 40222, 1451, 39, 143, "Code",ExpressionUUID->"9f080a33-4031-4746-8c35-5a48091cda2e"]
}, Closed]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1552223, 40268, 148, 2, 67, "Section",ExpressionUUID->"264055aa-257e-4658-8e88-c7a82054dd0f"],
Cell[CellGroupData[{
Cell[1552396, 40274, 96, 0, 54, "Subsection",ExpressionUUID->"7263b898-abdd-4b74-bf48-8401d5363cb9"],
Cell[1552495, 40276, 3586, 102, 273, "Code",ExpressionUUID->"987031ba-a53c-4f11-a7e4-bcab36c04d09"],
Cell[1556084, 40380, 4612, 111, 616, "Code",ExpressionUUID->"4df19566-3b22-4178-9883-43f4afe6f65f"],
Cell[1560699, 40493, 452, 12, 83, "Code",ExpressionUUID->"de3fa5c5-4fe7-44c1-9fce-7504364314cd"]
}, Closed]],
Cell[CellGroupData[{
Cell[1561188, 40510, 98, 0, 38, "Subsection",ExpressionUUID->"180e9407-b203-4d4a-b001-0e9302edeaaf"],
Cell[1561289, 40512, 1438, 37, 165, "Code",ExpressionUUID->"ba5b6647-f0b2-4b99-b15f-99f62fcaeb60"],
Cell[1562730, 40551, 2034, 57, 162, "Code",ExpressionUUID->"585395bf-edd0-4922-be90-cf3dd9378903"],
Cell[1564767, 40610, 1242, 36, 200, "Code",ExpressionUUID->"511a5fd5-e74f-4419-bf75-8c444440d319"],
Cell[1566012, 40648, 4847, 122, 470, "Code",ExpressionUUID->"475af5c7-e1c8-4503-81f4-44acaf834316"],
Cell[1570862, 40772, 9244, 223, 1017, "Code",ExpressionUUID->"36d192d4-81bd-4706-ab71-98a7e1bbfd1e"]
}, Closed]],
Cell[CellGroupData[{
Cell[1580143, 41000, 96, 0, 38, "Subsection",ExpressionUUID->"999e6f09-3bf2-414c-b3fc-0ebce2164f6e"],
Cell[1580242, 41002, 3103, 76, 335, "Code",ExpressionUUID->"4527b9b8-c59b-40fe-ac46-8b880e1d29af"],
Cell[1583348, 41080, 2943, 75, 335, "Code",ExpressionUUID->"f4924735-3c86-45f4-9002-8e27c84aebac"],
Cell[1586294, 41157, 3798, 91, 463, "Code",ExpressionUUID->"e79c1415-df48-46af-8022-f0d3c2db1b85"]
}, Closed]],
Cell[CellGroupData[{
Cell[1590129, 41253, 111, 0, 38, "Subsection",ExpressionUUID->"9b4913e6-0b4a-4a08-b7bd-200f6bcf7b03"],
Cell[1590243, 41255, 2542, 73, 235, "Code",ExpressionUUID->"d1ae3a0e-0030-4f1a-8eb0-962b8b6b9f9a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1592834, 41334, 91, 0, 67, "Section",ExpressionUUID->"efa38391-2c04-4250-a9ce-7f700dc2e797"],
Cell[1592928, 41336, 757, 23, 125, "Code",ExpressionUUID->"c7b53360-ca73-4d43-a302-859f8055c0aa"],
Cell[1593688, 41361, 651, 21, 86, "Code",ExpressionUUID->"5f25bd59-6819-41cd-a8e4-4edaba4dea77"],
Cell[1594342, 41384, 1260, 36, 124, "Code",ExpressionUUID->"438a5c06-e32f-439f-a52a-4993a1443a04"],
Cell[1595605, 41422, 120, 0, 35, "Text",ExpressionUUID->"4f6e93c9-f4a8-4076-a796-3780d86b8886"],
Cell[1595728, 41424, 158, 3, 35, "Text",ExpressionUUID->"a322905f-0464-465c-87bf-a882cd23fbe7"],
Cell[1595889, 41429, 274, 4, 58, "Text",ExpressionUUID->"56aae6d3-a747-446b-94f6-f08a5da92e0a"],
Cell[CellGroupData[{
Cell[1596188, 41437, 92, 0, 54, "Subsection",ExpressionUUID->"30beb824-411a-4da9-84d9-c2ad57b065a2"],
Cell[1596283, 41439, 677, 16, 200, "Code",ExpressionUUID->"00471e94-dc32-4777-a8a8-0f8d241e12c6"],
Cell[1596963, 41457, 11546, 288, 1227, "Code",ExpressionUUID->"68063071-c7cf-4e07-bd84-87af0c161f63"],
Cell[1608512, 41747, 3259, 76, 409, "Code",ExpressionUUID->"1ad828d7-ef66-4ba2-98e5-8dd1af748c1d"]
}, Closed]],
Cell[CellGroupData[{
Cell[1611808, 41828, 93, 0, 38, "Subsection",ExpressionUUID->"df9a98e6-583c-4e1c-9c5e-9329e90e0833"],
Cell[1611904, 41830, 526, 14, 159, "Code",ExpressionUUID->"3198f40c-a3af-4947-b0c8-cbc49f1ca5e1"],
Cell[1612433, 41846, 7532, 193, 673, "Code",ExpressionUUID->"cdcda5f5-532c-463b-899d-7293e5112f81"]
}, Closed]],
Cell[CellGroupData[{
Cell[1620002, 42044, 95, 0, 38, "Subsection",ExpressionUUID->"530308ab-a7d1-4a5c-86d3-f3a59af21d94"],
Cell[1620100, 42046, 517, 13, 159, "Code",ExpressionUUID->"3a0274b7-99dd-44b8-a623-57f7847ae21b"],
Cell[1620620, 42061, 4421, 112, 369, "Code",ExpressionUUID->"a0387762-529b-4db0-94ff-175060d25b6c"],
Cell[1625044, 42175, 5659, 152, 528, "Code",ExpressionUUID->"7d80a007-6464-43b3-9ff2-00f8fc73da18"]
}, Closed]],
Cell[CellGroupData[{
Cell[1630740, 42332, 89, 0, 38, "Subsection",ExpressionUUID->"616abae0-499a-42ac-9be1-54c477240393"],
Cell[1630832, 42334, 5022, 136, 429, "Code",ExpressionUUID->"f42eb97c-a4fa-4783-8190-ace6cf11e7a8"]
}, Closed]],
Cell[CellGroupData[{
Cell[1635891, 42475, 90, 0, 38, "Subsection",ExpressionUUID->"21ae16eb-fe33-4b07-a637-3a56dfc61929"],
Cell[1635984, 42477, 1189, 30, 219, "Code",ExpressionUUID->"0523084d-4d4b-4a9e-8f47-5ce789825232"],
Cell[1637176, 42509, 4892, 126, 562, "Code",ExpressionUUID->"deeff8cc-8a0f-4967-8ab0-c5317f85b6a6"],
Cell[1642071, 42637, 7363, 195, 610, "Code",ExpressionUUID->"b0a2f514-7a30-4fc7-9f56-23c511b2ec1b"],
Cell[1649437, 42834, 2474, 67, 238, "Code",ExpressionUUID->"c0937410-8977-4d4f-a839-ccb5f4389bde"]
}, Closed]],
Cell[CellGroupData[{
Cell[1651948, 42906, 88, 0, 38, "Subsection",ExpressionUUID->"a7a35632-47d0-4342-be07-daf07f198317"],
Cell[1652039, 42908, 323, 9, 102, "Code",ExpressionUUID->"e55e08fa-9d58-42bc-abfc-669219f4ba55"],
Cell[1652365, 42919, 3515, 98, 350, "Code",ExpressionUUID->"7befbc49-c359-459d-b8be-4c03a3cd4cbc"]
}, Closed]],
Cell[CellGroupData[{
Cell[1655917, 43022, 103, 0, 38, "Subsection",ExpressionUUID->"a4787621-3d48-4ae3-bf4b-6c35d714056b"],
Cell[1656023, 43024, 1828, 50, 181, "Code",ExpressionUUID->"321114ce-c1c2-4259-8f91-54d2a33d7886"],
Cell[1657854, 43076, 3602, 101, 243, "Code",ExpressionUUID->"521bc9c5-de42-41dd-9770-013f3407e73d"],
Cell[1661459, 43179, 13955, 343, 998, "Code",ExpressionUUID->"8a094d13-8b63-400b-b159-c54a5fd2ee60"],
Cell[1675417, 43524, 2968, 82, 186, "Code",ExpressionUUID->"bd7f0e33-5f80-428a-989f-41e32909c8eb"],
Cell[1678388, 43608, 1338, 38, 124, "Code",ExpressionUUID->"6430d36e-973c-44ca-a619-b4932b524083"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1679775, 43652, 89, 0, 67, "Section",ExpressionUUID->"39bcb497-250e-4ccc-b5cc-cc185dc1e82d"],
Cell[1679867, 43654, 2242, 55, 409, "Code",ExpressionUUID->"47c05290-a89e-4761-b409-233504c8abb9"],
Cell[1682112, 43711, 2822, 61, 334, "Code",ExpressionUUID->"d0c0ab08-9f98-424a-87df-306817a5ca19"],
Cell[1684937, 43774, 8490, 192, 827, "Code",ExpressionUUID->"1b5a7957-8a30-41e5-96a3-605e100640ae"],
Cell[1693430, 43968, 22184, 590, 1844, "Code",ExpressionUUID->"63cc1811-f31a-4ae6-b451-e596a6650ac2"],
Cell[1715617, 44560, 1487, 40, 200, "Code",ExpressionUUID->"c147ed39-8949-4292-be7f-d71a91d02de6"],
Cell[CellGroupData[{
Cell[1717129, 44604, 91, 0, 45, "Subsubsection",ExpressionUUID->"41036322-b489-45d6-a4a8-c4b2fc22031e"],
Cell[1717223, 44606, 2263, 63, 352, "Code",ExpressionUUID->"1e65c65e-c390-4436-963f-5839fb0f2d6f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1719523, 44674, 139, 1, 45, "Subsubsection",ExpressionUUID->"3158cbe2-8da5-435f-9855-4818c97962d4"],
Cell[1719665, 44677, 3724, 100, 542, "Code",ExpressionUUID->"274ece50-9947-4d40-9f3e-6f0f5cb59add"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1723426, 44782, 112, 0, 45, "Subsubsection",ExpressionUUID->"6db47837-09f4-490d-be89-995898f5d632"],
Cell[1723541, 44784, 702, 20, 91, "Code",ExpressionUUID->"33e99287-32ab-4598-b9f4-43e157e76d49"],
Cell[1724246, 44806, 2457, 64, 387, "Code",ExpressionUUID->"911928c9-1776-49d7-bdc1-00a706563c2f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1726740, 44875, 123, 0, 37, "Subsubsection",ExpressionUUID->"b5eb9bb4-86b7-4453-beb7-26e0f999bb46"],
Cell[1726866, 44877, 639, 18, 102, "Code",ExpressionUUID->"44617709-0bba-4f10-8b77-044806d4abf7"],
Cell[1727508, 44897, 1702, 43, 387, "Code",ExpressionUUID->"55774fc6-ee2b-44c0-b416-d3132ebf9238"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[1729259, 44946, 97, 0, 53, "Section",ExpressionUUID->"1bb3900a-8860-49fe-a371-094dcdb4300c"],
Cell[1729359, 44948, 12272, 322, 1188, "Code",ExpressionUUID->"1104144b-be66-40d8-bc25-ddae9d9dde62"]
}, Closed]],
Cell[CellGroupData[{
Cell[1741668, 45275, 91, 0, 53, "Section",ExpressionUUID->"3efe547a-f1ac-4ffb-8444-d2b58598608b"],
Cell[CellGroupData[{
Cell[1741784, 45279, 91, 0, 54, "Subsection",ExpressionUUID->"030fa22e-305a-45e4-b6b6-74f92db2e39b"],
Cell[1741878, 45281, 954, 25, 178, "Code",ExpressionUUID->"580bd134-fe46-489b-be75-aa685f0fcd22"]
}, Closed]],
Cell[CellGroupData[{
Cell[1742869, 45311, 94, 0, 38, "Subsection",ExpressionUUID->"50641957-a476-4037-b81c-36b8b7785b1b"],
Cell[1742966, 45313, 8666, 213, 976, "Code",ExpressionUUID->"da7e70de-e1ad-47c1-a2cd-4e867b497a28"]
}, Closed]],
Cell[CellGroupData[{
Cell[1751669, 45531, 92, 0, 38, "Subsection",ExpressionUUID->"5b510d4d-6e9e-491c-94a7-2f5adbe7cbe3"],
Cell[1751764, 45533, 3463, 90, 368, "Code",ExpressionUUID->"ae3899bf-8cac-4133-92d1-6bd45cffea08"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1755276, 45629, 103, 0, 67, "Section",ExpressionUUID->"ec7a5656-c612-4c9f-8a41-276e60b3e771"],
Cell[1755382, 45631, 15610, 376, 2002, "Code",ExpressionUUID->"2ae41128-b3d0-40d3-aeae-8440a046ff26"],
Cell[1770995, 46009, 1124, 27, 140, "Code",ExpressionUUID->"83a6a33b-3028-417b-84a0-885aea5b8a5e"]
}, Closed]],
Cell[CellGroupData[{
Cell[1772156, 46041, 78, 0, 53, "Section",ExpressionUUID->"a1375d4f-d82f-42cf-9eb3-c76f31ebb81e"],
Cell[1772237, 46043, 252, 8, 105, "Code",ExpressionUUID->"0f6f47a1-2047-4f40-a070-b68748d33cb4"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[1772538, 46057, 93, 0, 58, "Chapter",ExpressionUUID->"308511ff-4ec7-4b35-a48d-bfb752d66eba"],
Cell[1772634, 46059, 214, 6, 66, "Code",ExpressionUUID->"847fab10-bc1e-4282-8d85-92a8538e4ebf"],
Cell[CellGroupData[{
Cell[1772873, 46069, 79, 0, 67, "Section",ExpressionUUID->"9d741069-3129-48df-9c60-53f3a57972ce"],
Cell[1772955, 46071, 612, 12, 110, "Code",ExpressionUUID->"4f3a870a-9e50-4026-b27a-e8b87a14cf13"],
Cell[1773570, 46085, 1267, 25, 178, "Code",ExpressionUUID->"bc1ef241-ffd3-45c8-8ecb-42c4eca0bad8"],
Cell[1774840, 46112, 3238, 58, 292, "Code",ExpressionUUID->"2ea7c2d5-a9ce-47a1-a13c-edc9d8395651"],
Cell[1778081, 46172, 642, 17, 178, "Code",ExpressionUUID->"caba788a-424c-46e0-93f9-edcc6a8ebf3c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1778760, 46194, 89, 0, 53, "Section",ExpressionUUID->"41d5a9ce-bd01-4999-88b2-92f83d44e1ed"],
Cell[CellGroupData[{
Cell[1778874, 46198, 96, 0, 54, "Subsection",ExpressionUUID->"d9558885-b745-435a-91ff-1d45e786c0fd"],
Cell[1778973, 46200, 6237, 137, 732, "Code",ExpressionUUID->"12654168-cf0f-434b-a84e-6ffff3ee13c9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1785247, 46342, 109, 0, 54, "Subsection",ExpressionUUID->"b85ef177-5615-4a73-9aac-fbd8f733ebf8"],
Cell[1785359, 46344, 7152, 150, 1036, "Code",ExpressionUUID->"1a04ee9b-b1ac-4aaf-add3-79f073e10cf8"],
Cell[1792514, 46496, 1351, 36, 140, "Code",ExpressionUUID->"84fbe4b2-491c-4497-8b9f-d63edaab72ad"],
Cell[1793868, 46534, 7790, 194, 832, "Code",ExpressionUUID->"991e06fd-8fe9-45ef-b6b0-67713bbf7d0f"],
Cell[1801661, 46730, 4004, 95, 463, "Code",ExpressionUUID->"8f562e1a-f003-4146-bec8-e14f36883132"],
Cell[1805668, 46827, 4731, 116, 596, "Code",ExpressionUUID->"7478aac9-e1a2-4e6e-9b73-75856da510d2"],
Cell[1810402, 46945, 8774, 202, 995, "Code",ExpressionUUID->"97276aa8-2f46-4ae0-b316-a396989572ec"],
Cell[1819179, 47149, 1100, 29, 140, "Code",ExpressionUUID->"02892aa2-1225-4781-9cbe-9ab010ab7380"]
}, Closed]],
Cell[CellGroupData[{
Cell[1820316, 47183, 99, 0, 38, "Subsection",ExpressionUUID->"08eba98c-ea79-4ec8-9684-81a4c1879591"],
Cell[1820418, 47185, 5732, 129, 672, "Code",ExpressionUUID->"a2c9e3fe-ed07-4e28-aa97-7135df0ec4fa"]
}, Closed]],
Cell[CellGroupData[{
Cell[1826187, 47319, 99, 0, 38, "Subsection",ExpressionUUID->"6d3c4e18-74c4-4bfe-a5d9-f9d2d2904705"],
Cell[1826289, 47321, 5420, 128, 805, "Code",ExpressionUUID->"ee13324e-b132-40ce-9d9b-f6f4c456308a"]
}, Closed]],
Cell[CellGroupData[{
Cell[1831746, 47454, 108, 0, 38, "Subsection",ExpressionUUID->"87b8b8e7-9e6b-4d21-a402-0daf3ed773f5"],
Cell[1831857, 47456, 1389, 37, 216, "Code",ExpressionUUID->"26a12763-8a31-4ba1-9dd0-6e10bb43f188"]
}, Closed]],
Cell[CellGroupData[{
Cell[1833283, 47498, 90, 0, 38, "Subsection",ExpressionUUID->"cbfebfab-1d94-48c1-a447-a10cb79cfefc"],
Cell[1833376, 47500, 369, 10, 64, "Code",ExpressionUUID->"fce85141-c16c-4e16-a434-ecbba466ae94"]
}, Closed]],
Cell[CellGroupData[{
Cell[1833782, 47515, 118, 0, 38, "Subsection",ExpressionUUID->"23201b86-ab05-49ca-a6e6-29d0931630f1"],
Cell[1833903, 47517, 7365, 214, 482, "Code",ExpressionUUID->"1c27cd34-efe4-422b-a323-0c0f4f801927"]
}, Closed]],
Cell[CellGroupData[{
Cell[1841305, 47736, 131, 0, 38, "Subsection",ExpressionUUID->"ca238c93-e657-4f50-aa11-07ebb823fc16"],
Cell[1841439, 47738, 824, 21, 121, "Code",ExpressionUUID->"c78c3923-2e9b-43e1-a6b6-625b5145a859"],
Cell[1842266, 47761, 575, 14, 63, "Code",ExpressionUUID->"48cdaf49-aeab-436d-981c-7ed2d2fc1657"]
}, Closed]],
Cell[CellGroupData[{
Cell[1842878, 47780, 106, 0, 38, "Subsection",ExpressionUUID->"69e5ee40-3336-4520-9c33-eefe154a18a9"],
Cell[1842987, 47782, 1294, 32, 235, "Code",ExpressionUUID->"6e53d729-72e9-46a1-9633-2531053eb74b"],
Cell[1844284, 47816, 6882, 168, 710, "Code",ExpressionUUID->"51fc3778-6d33-47f5-91c6-00d9696d6fe1"],
Cell[1851169, 47986, 7680, 172, 862, "Code",ExpressionUUID->"8c748e4a-8e6c-4882-a081-f3d33f7de21f"]
}, Closed]],
Cell[CellGroupData[{
Cell[1858886, 48163, 107, 0, 38, "Subsection",ExpressionUUID->"c47a1a6f-189b-42f6-95e9-1d8af71978dd"],
Cell[1858996, 48165, 5922, 147, 672, "Code",ExpressionUUID->"b304362a-3584-4dd1-ac0a-bcdf11973baf"]
}, Closed]],
Cell[CellGroupData[{
Cell[1864955, 48317, 101, 0, 38, "Subsection",ExpressionUUID->"39852e63-921f-423b-8183-eeb2b7a02c60"],
Cell[1865059, 48319, 12507, 289, 1337, "Code",ExpressionUUID->"3496056d-8f6d-4d0c-bdb8-123d0cebdd3c"]
}, Closed]],
Cell[CellGroupData[{
Cell[1877603, 48613, 110, 0, 38, "Subsection",ExpressionUUID->"be09ca57-c4d4-4c71-97c6-4c474d6308a5"],
Cell[1877716, 48615, 4323, 107, 425, "Code",ExpressionUUID->"dccd4b33-5244-4fda-a445-aee7599831e8"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1882088, 48728, 78, 0, 67, "Section",ExpressionUUID->"e88c3418-d1b6-4d70-940f-caf4d5b07981"],
Cell[1882169, 48730, 252, 8, 105, "Code",ExpressionUUID->"b96c1413-a39a-47bf-a804-4eb56d54d55e"]
}, Open  ]]
}, Closed]]
}, Open  ]]
}
]
*)

